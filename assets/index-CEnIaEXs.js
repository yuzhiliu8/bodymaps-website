var aX=Object.defineProperty;var oX=(t,e,n)=>e in t?aX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var He=(t,e,n)=>oX(t,typeof e!="symbol"?e+"":e,n);function sX(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Or=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Yr(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var WM={exports:{}},$2={},jM={exports:{}},On={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tp=Symbol.for("react.element"),lX=Symbol.for("react.portal"),cX=Symbol.for("react.fragment"),uX=Symbol.for("react.strict_mode"),fX=Symbol.for("react.profiler"),dX=Symbol.for("react.provider"),hX=Symbol.for("react.context"),gX=Symbol.for("react.forward_ref"),pX=Symbol.for("react.suspense"),mX=Symbol.for("react.memo"),vX=Symbol.for("react.lazy"),db=Symbol.iterator;function yX(t){return t===null||typeof t!="object"?null:(t=db&&t[db]||t["@@iterator"],typeof t=="function"?t:null)}var HM={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$M=Object.assign,KM={};function $f(t,e,n){this.props=t,this.context=e,this.refs=KM,this.updater=n||HM}$f.prototype.isReactComponent={};$f.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$f.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function qM(){}qM.prototype=$f.prototype;function nS(t,e,n){this.props=t,this.context=e,this.refs=KM,this.updater=n||HM}var rS=nS.prototype=new qM;rS.constructor=nS;$M(rS,$f.prototype);rS.isPureReactComponent=!0;var hb=Array.isArray,XM=Object.prototype.hasOwnProperty,iS={current:null},YM={key:!0,ref:!0,__self:!0,__source:!0};function JM(t,e,n){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)XM.call(e,r)&&!YM.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:tp,type:t,key:a,ref:o,props:i,_owner:iS.current}}function wX(t,e){return{$$typeof:tp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function aS(t){return typeof t=="object"&&t!==null&&t.$$typeof===tp}function CX(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var gb=/\/+/g;function Pw(t,e){return typeof t=="object"&&t!==null&&t.key!=null?CX(""+t.key):e.toString(36)}function Vm(t,e,n,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case tp:case lX:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Pw(o,0):r,hb(i)?(n="",t!=null&&(n=t.replace(gb,"$&/")+"/"),Vm(i,e,n,"",function(c){return c})):i!=null&&(aS(i)&&(i=wX(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(gb,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",hb(t))for(var s=0;s<t.length;s++){a=t[s];var l=r+Pw(a,s);o+=Vm(a,e,n,l,i)}else if(l=yX(t),typeof l=="function")for(t=l.call(t),s=0;!(a=t.next()).done;)a=a.value,l=r+Pw(a,s++),o+=Vm(a,e,n,l,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function U1(t,e,n){if(t==null)return t;var r=[],i=0;return Vm(t,r,"","",function(a){return e.call(n,a,i++)}),r}function xX(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ra={current:null},Um={transition:null},SX={ReactCurrentDispatcher:ra,ReactCurrentBatchConfig:Um,ReactCurrentOwner:iS};function ZM(){throw Error("act(...) is not supported in production builds of React.")}On.Children={map:U1,forEach:function(t,e,n){U1(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return U1(t,function(){e++}),e},toArray:function(t){return U1(t,function(e){return e})||[]},only:function(t){if(!aS(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};On.Component=$f;On.Fragment=cX;On.Profiler=fX;On.PureComponent=nS;On.StrictMode=uX;On.Suspense=pX;On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SX;On.act=ZM;On.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=$M({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=iS.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(l in e)XM.call(e,l)&&!YM.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&s!==void 0?s[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){s=Array(l);for(var c=0;c<l;c++)s[c]=arguments[c+2];r.children=s}return{$$typeof:tp,type:t.type,key:i,ref:a,props:r,_owner:o}};On.createContext=function(t){return t={$$typeof:hX,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:dX,_context:t},t.Consumer=t};On.createElement=JM;On.createFactory=function(t){var e=JM.bind(null,t);return e.type=t,e};On.createRef=function(){return{current:null}};On.forwardRef=function(t){return{$$typeof:gX,render:t}};On.isValidElement=aS;On.lazy=function(t){return{$$typeof:vX,_payload:{_status:-1,_result:t},_init:xX}};On.memo=function(t,e){return{$$typeof:mX,type:t,compare:e===void 0?null:e}};On.startTransition=function(t){var e=Um.transition;Um.transition={};try{t()}finally{Um.transition=e}};On.unstable_act=ZM;On.useCallback=function(t,e){return ra.current.useCallback(t,e)};On.useContext=function(t){return ra.current.useContext(t)};On.useDebugValue=function(){};On.useDeferredValue=function(t){return ra.current.useDeferredValue(t)};On.useEffect=function(t,e){return ra.current.useEffect(t,e)};On.useId=function(){return ra.current.useId()};On.useImperativeHandle=function(t,e,n){return ra.current.useImperativeHandle(t,e,n)};On.useInsertionEffect=function(t,e){return ra.current.useInsertionEffect(t,e)};On.useLayoutEffect=function(t,e){return ra.current.useLayoutEffect(t,e)};On.useMemo=function(t,e){return ra.current.useMemo(t,e)};On.useReducer=function(t,e,n){return ra.current.useReducer(t,e,n)};On.useRef=function(t){return ra.current.useRef(t)};On.useState=function(t){return ra.current.useState(t)};On.useSyncExternalStore=function(t,e,n){return ra.current.useSyncExternalStore(t,e,n)};On.useTransition=function(){return ra.current.useTransition()};On.version="18.3.1";jM.exports=On;var vt=jM.exports;const EX=Hf(vt),TX=sX({__proto__:null,default:EX},[vt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _X=vt,DX=Symbol.for("react.element"),bX=Symbol.for("react.fragment"),IX=Object.prototype.hasOwnProperty,OX=_X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,MX={key:!0,ref:!0,__self:!0,__source:!0};function QM(t,e,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)IX.call(e,r)&&!MX.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:DX,type:t,key:a,ref:o,props:i,_owner:OX.current}}$2.Fragment=bX;$2.jsx=QM;$2.jsxs=QM;WM.exports=$2;var yt=WM.exports,Y4={},eN={exports:{}},Fa={},tN={exports:{}},nN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ie,te){var ee=ie.length;ie.push(te);e:for(;0<ee;){var we=ee-1>>>1,Ce=ie[we];if(0<i(Ce,te))ie[we]=te,ie[ee]=Ce,ee=we;else break e}}function n(ie){return ie.length===0?null:ie[0]}function r(ie){if(ie.length===0)return null;var te=ie[0],ee=ie.pop();if(ee!==te){ie[0]=ee;e:for(var we=0,Ce=ie.length,De=Ce>>>1;we<De;){var Re=2*(we+1)-1,Oe=ie[Re],Ve=Re+1,Ge=ie[Ve];if(0>i(Oe,ee))Ve<Ce&&0>i(Ge,Oe)?(ie[we]=Ge,ie[Ve]=ee,we=Ve):(ie[we]=Oe,ie[Re]=ee,we=Re);else if(Ve<Ce&&0>i(Ge,ee))ie[we]=Ge,ie[Ve]=ee,we=Ve;else break e}}return te}function i(ie,te){var ee=ie.sortIndex-te.sortIndex;return ee!==0?ee:ie.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}var l=[],c=[],d=1,f=null,h=3,p=!1,C=!1,x=!1,T=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(ie){for(var te=n(c);te!==null;){if(te.callback===null)r(c);else if(te.startTime<=ie)r(c),te.sortIndex=te.expirationTime,e(l,te);else break;te=n(c)}}function b(ie){if(x=!1,w(ie),!C)if(n(l)!==null)C=!0,fe(M);else{var te=n(c);te!==null&&pe(b,te.startTime-ie)}}function M(ie,te){C=!1,x&&(x=!1,_(k),k=-1),p=!0;var ee=h;try{for(w(te),f=n(l);f!==null&&(!(f.expirationTime>te)||ie&&!z());){var we=f.callback;if(typeof we=="function"){f.callback=null,h=f.priorityLevel;var Ce=we(f.expirationTime<=te);te=t.unstable_now(),typeof Ce=="function"?f.callback=Ce:f===n(l)&&r(l),w(te)}else r(l);f=n(l)}if(f!==null)var De=!0;else{var Re=n(c);Re!==null&&pe(b,Re.startTime-te),De=!1}return De}finally{f=null,h=ee,p=!1}}var I=!1,A=null,k=-1,U=5,B=-1;function z(){return!(t.unstable_now()-B<U)}function K(){if(A!==null){var ie=t.unstable_now();B=ie;var te=!0;try{te=A(!0,ie)}finally{te?J():(I=!1,A=null)}}else I=!1}var J;if(typeof y=="function")J=function(){y(K)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,re=X.port2;X.port1.onmessage=K,J=function(){re.postMessage(null)}}else J=function(){T(K,0)};function fe(ie){A=ie,I||(I=!0,J())}function pe(ie,te){k=T(function(){ie(t.unstable_now())},te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ie){ie.callback=null},t.unstable_continueExecution=function(){C||p||(C=!0,fe(M))},t.unstable_forceFrameRate=function(ie){0>ie||125<ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<ie?Math.floor(1e3/ie):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(ie){switch(h){case 1:case 2:case 3:var te=3;break;default:te=h}var ee=h;h=te;try{return ie()}finally{h=ee}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ie,te){switch(ie){case 1:case 2:case 3:case 4:case 5:break;default:ie=3}var ee=h;h=ie;try{return te()}finally{h=ee}},t.unstable_scheduleCallback=function(ie,te,ee){var we=t.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?we+ee:we):ee=we,ie){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=ee+Ce,ie={id:d++,callback:te,priorityLevel:ie,startTime:ee,expirationTime:Ce,sortIndex:-1},ee>we?(ie.sortIndex=ee,e(c,ie),n(l)===null&&ie===n(c)&&(x?(_(k),k=-1):x=!0,pe(b,ee-we))):(ie.sortIndex=Ce,e(l,ie),C||p||(C=!0,fe(M))),ie},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(ie){var te=h;return function(){var ee=h;h=te;try{return ie.apply(this,arguments)}finally{h=ee}}}})(nN);tN.exports=nN;var NX=tN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RX=vt,Pa=NX;function ut(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rN=new Set,cg={};function Bu(t,e){_f(t,e),_f(t+"Capture",e)}function _f(t,e){for(cg[t]=e,t=0;t<e.length;t++)rN.add(e[t])}var Js=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),J4=Object.prototype.hasOwnProperty,AX=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pb={},mb={};function LX(t){return J4.call(mb,t)?!0:J4.call(pb,t)?!1:AX.test(t)?mb[t]=!0:(pb[t]=!0,!1)}function kX(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function PX(t,e,n,r){if(e===null||typeof e>"u"||kX(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ia(t,e,n,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Ti={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ti[t]=new ia(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ti[e]=new ia(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ti[t]=new ia(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ti[t]=new ia(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ti[t]=new ia(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ti[t]=new ia(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ti[t]=new ia(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ti[t]=new ia(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ti[t]=new ia(t,5,!1,t.toLowerCase(),null,!1,!1)});var oS=/[\-:]([a-z])/g;function sS(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(oS,sS);Ti[e]=new ia(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(oS,sS);Ti[e]=new ia(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(oS,sS);Ti[e]=new ia(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ti[t]=new ia(t,1,!1,t.toLowerCase(),null,!1,!1)});Ti.xlinkHref=new ia("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ti[t]=new ia(t,1,!1,t.toLowerCase(),null,!0,!0)});function lS(t,e,n,r){var i=Ti.hasOwnProperty(e)?Ti[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(PX(e,n,i,r)&&(n=null),r||i===null?LX(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ll=RX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,B1=Symbol.for("react.element"),H0=Symbol.for("react.portal"),$0=Symbol.for("react.fragment"),cS=Symbol.for("react.strict_mode"),Z4=Symbol.for("react.profiler"),iN=Symbol.for("react.provider"),aN=Symbol.for("react.context"),uS=Symbol.for("react.forward_ref"),Q4=Symbol.for("react.suspense"),eC=Symbol.for("react.suspense_list"),fS=Symbol.for("react.memo"),Nl=Symbol.for("react.lazy"),oN=Symbol.for("react.offscreen"),vb=Symbol.iterator;function ch(t){return t===null||typeof t!="object"?null:(t=vb&&t[vb]||t["@@iterator"],typeof t=="function"?t:null)}var Nr=Object.assign,Fw;function _h(t){if(Fw===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Fw=e&&e[1]||""}return`
`+Fw+t}var Vw=!1;function Uw(t,e){if(!t||Vw)return"";Vw=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=s);break}}}finally{Vw=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?_h(t):""}function FX(t){switch(t.tag){case 5:return _h(t.type);case 16:return _h("Lazy");case 13:return _h("Suspense");case 19:return _h("SuspenseList");case 0:case 2:case 15:return t=Uw(t.type,!1),t;case 11:return t=Uw(t.type.render,!1),t;case 1:return t=Uw(t.type,!0),t;default:return""}}function tC(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $0:return"Fragment";case H0:return"Portal";case Z4:return"Profiler";case cS:return"StrictMode";case Q4:return"Suspense";case eC:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case aN:return(t.displayName||"Context")+".Consumer";case iN:return(t._context.displayName||"Context")+".Provider";case uS:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case fS:return e=t.displayName||null,e!==null?e:tC(t.type)||"Memo";case Nl:e=t._payload,t=t._init;try{return tC(t(e))}catch{}}return null}function VX(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tC(e);case 8:return e===cS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ac(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sN(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function UX(t){var e=sN(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function G1(t){t._valueTracker||(t._valueTracker=UX(t))}function lN(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=sN(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function pv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function nC(t,e){var n=e.checked;return Nr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function yb(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ac(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function cN(t,e){e=e.checked,e!=null&&lS(t,"checked",e,!1)}function rC(t,e){cN(t,e);var n=ac(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?iC(t,e.type,n):e.hasOwnProperty("defaultValue")&&iC(t,e.type,ac(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wb(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function iC(t,e,n){(e!=="number"||pv(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Dh=Array.isArray;function gf(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ac(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function aC(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ut(91));return Nr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Cb(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ut(92));if(Dh(n)){if(1<n.length)throw Error(ut(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ac(n)}}function uN(t,e){var n=ac(e.value),r=ac(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function xb(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function fN(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oC(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?fN(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var z1,dN=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(z1=z1||document.createElement("div"),z1.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=z1.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ug(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ph={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BX=["Webkit","ms","Moz","O"];Object.keys(Ph).forEach(function(t){BX.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ph[e]=Ph[t]})});function hN(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ph.hasOwnProperty(t)&&Ph[t]?(""+e).trim():e+"px"}function gN(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=hN(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var GX=Nr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sC(t,e){if(e){if(GX[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ut(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ut(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ut(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ut(62))}}function lC(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cC=null;function dS(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var uC=null,pf=null,mf=null;function Sb(t){if(t=ip(t)){if(typeof uC!="function")throw Error(ut(280));var e=t.stateNode;e&&(e=J2(e),uC(t.stateNode,t.type,e))}}function pN(t){pf?mf?mf.push(t):mf=[t]:pf=t}function mN(){if(pf){var t=pf,e=mf;if(mf=pf=null,Sb(t),e)for(t=0;t<e.length;t++)Sb(e[t])}}function vN(t,e){return t(e)}function yN(){}var Bw=!1;function wN(t,e,n){if(Bw)return t(e,n);Bw=!0;try{return vN(t,e,n)}finally{Bw=!1,(pf!==null||mf!==null)&&(yN(),mN())}}function fg(t,e){var n=t.stateNode;if(n===null)return null;var r=J2(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ut(231,e,typeof n));return n}var fC=!1;if(Js)try{var uh={};Object.defineProperty(uh,"passive",{get:function(){fC=!0}}),window.addEventListener("test",uh,uh),window.removeEventListener("test",uh,uh)}catch{fC=!1}function zX(t,e,n,r,i,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(d){this.onError(d)}}var Fh=!1,mv=null,vv=!1,dC=null,WX={onError:function(t){Fh=!0,mv=t}};function jX(t,e,n,r,i,a,o,s,l){Fh=!1,mv=null,zX.apply(WX,arguments)}function HX(t,e,n,r,i,a,o,s,l){if(jX.apply(this,arguments),Fh){if(Fh){var c=mv;Fh=!1,mv=null}else throw Error(ut(198));vv||(vv=!0,dC=c)}}function Gu(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function CN(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Eb(t){if(Gu(t)!==t)throw Error(ut(188))}function $X(t){var e=t.alternate;if(!e){if(e=Gu(t),e===null)throw Error(ut(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Eb(i),t;if(a===r)return Eb(i),e;a=a.sibling}throw Error(ut(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(ut(189))}}if(n.alternate!==r)throw Error(ut(190))}if(n.tag!==3)throw Error(ut(188));return n.stateNode.current===n?t:e}function xN(t){return t=$X(t),t!==null?SN(t):null}function SN(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=SN(t);if(e!==null)return e;t=t.sibling}return null}var EN=Pa.unstable_scheduleCallback,Tb=Pa.unstable_cancelCallback,KX=Pa.unstable_shouldYield,qX=Pa.unstable_requestPaint,zr=Pa.unstable_now,XX=Pa.unstable_getCurrentPriorityLevel,hS=Pa.unstable_ImmediatePriority,TN=Pa.unstable_UserBlockingPriority,yv=Pa.unstable_NormalPriority,YX=Pa.unstable_LowPriority,_N=Pa.unstable_IdlePriority,K2=null,us=null;function JX(t){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(K2,t,void 0,(t.current.flags&128)===128)}catch{}}var Vo=Math.clz32?Math.clz32:eY,ZX=Math.log,QX=Math.LN2;function eY(t){return t>>>=0,t===0?32:31-(ZX(t)/QX|0)|0}var W1=64,j1=4194304;function bh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wv(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var s=o&~i;s!==0?r=bh(s):(a&=o,a!==0&&(r=bh(a)))}else o=n&~i,o!==0?r=bh(o):a!==0&&(r=bh(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Vo(e),i=1<<n,r|=t[n],e&=~i;return r}function tY(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nY(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-Vo(a),s=1<<o,l=i[o];l===-1?(!(s&n)||s&r)&&(i[o]=tY(s,e)):l<=e&&(t.expiredLanes|=s),a&=~s}}function hC(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function DN(){var t=W1;return W1<<=1,!(W1&4194240)&&(W1=64),t}function Gw(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function np(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Vo(e),t[e]=n}function rY(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Vo(n),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~a}}function gS(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Vo(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Yn=0;function bN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var IN,pS,ON,MN,NN,gC=!1,H1=[],Xl=null,Yl=null,Jl=null,dg=new Map,hg=new Map,kl=[],iY="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _b(t,e){switch(t){case"focusin":case"focusout":Xl=null;break;case"dragenter":case"dragleave":Yl=null;break;case"mouseover":case"mouseout":Jl=null;break;case"pointerover":case"pointerout":dg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hg.delete(e.pointerId)}}function fh(t,e,n,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=ip(e),e!==null&&pS(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function aY(t,e,n,r,i){switch(e){case"focusin":return Xl=fh(Xl,t,e,n,r,i),!0;case"dragenter":return Yl=fh(Yl,t,e,n,r,i),!0;case"mouseover":return Jl=fh(Jl,t,e,n,r,i),!0;case"pointerover":var a=i.pointerId;return dg.set(a,fh(dg.get(a)||null,t,e,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,hg.set(a,fh(hg.get(a)||null,t,e,n,r,i)),!0}return!1}function RN(t){var e=mu(t.target);if(e!==null){var n=Gu(e);if(n!==null){if(e=n.tag,e===13){if(e=CN(n),e!==null){t.blockedOn=e,NN(t.priority,function(){ON(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=pC(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);cC=r,n.target.dispatchEvent(r),cC=null}else return e=ip(n),e!==null&&pS(e),t.blockedOn=n,!1;e.shift()}return!0}function Db(t,e,n){Bm(t)&&n.delete(e)}function oY(){gC=!1,Xl!==null&&Bm(Xl)&&(Xl=null),Yl!==null&&Bm(Yl)&&(Yl=null),Jl!==null&&Bm(Jl)&&(Jl=null),dg.forEach(Db),hg.forEach(Db)}function dh(t,e){t.blockedOn===e&&(t.blockedOn=null,gC||(gC=!0,Pa.unstable_scheduleCallback(Pa.unstable_NormalPriority,oY)))}function gg(t){function e(i){return dh(i,t)}if(0<H1.length){dh(H1[0],t);for(var n=1;n<H1.length;n++){var r=H1[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Xl!==null&&dh(Xl,t),Yl!==null&&dh(Yl,t),Jl!==null&&dh(Jl,t),dg.forEach(e),hg.forEach(e),n=0;n<kl.length;n++)r=kl[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<kl.length&&(n=kl[0],n.blockedOn===null);)RN(n),n.blockedOn===null&&kl.shift()}var vf=ll.ReactCurrentBatchConfig,Cv=!0;function sY(t,e,n,r){var i=Yn,a=vf.transition;vf.transition=null;try{Yn=1,mS(t,e,n,r)}finally{Yn=i,vf.transition=a}}function lY(t,e,n,r){var i=Yn,a=vf.transition;vf.transition=null;try{Yn=4,mS(t,e,n,r)}finally{Yn=i,vf.transition=a}}function mS(t,e,n,r){if(Cv){var i=pC(t,e,n,r);if(i===null)Jw(t,e,r,xv,n),_b(t,r);else if(aY(i,t,e,n,r))r.stopPropagation();else if(_b(t,r),e&4&&-1<iY.indexOf(t)){for(;i!==null;){var a=ip(i);if(a!==null&&IN(a),a=pC(t,e,n,r),a===null&&Jw(t,e,r,xv,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Jw(t,e,r,null,n)}}var xv=null;function pC(t,e,n,r){if(xv=null,t=dS(r),t=mu(t),t!==null)if(e=Gu(t),e===null)t=null;else if(n=e.tag,n===13){if(t=CN(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return xv=t,null}function AN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XX()){case hS:return 1;case TN:return 4;case yv:case YX:return 16;case _N:return 536870912;default:return 16}default:return 16}}var Gl=null,vS=null,Gm=null;function LN(){if(Gm)return Gm;var t,e=vS,n=e.length,r,i="value"in Gl?Gl.value:Gl.textContent,a=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[a-r];r++);return Gm=i.slice(t,1<r?1-r:void 0)}function zm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function $1(){return!0}function bb(){return!1}function Va(t){function e(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?$1:bb,this.isPropagationStopped=bb,this}return Nr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=$1)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=$1)},persist:function(){},isPersistent:$1}),e}var Kf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yS=Va(Kf),rp=Nr({},Kf,{view:0,detail:0}),cY=Va(rp),zw,Ww,hh,q2=Nr({},rp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wS,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==hh&&(hh&&t.type==="mousemove"?(zw=t.screenX-hh.screenX,Ww=t.screenY-hh.screenY):Ww=zw=0,hh=t),zw)},movementY:function(t){return"movementY"in t?t.movementY:Ww}}),Ib=Va(q2),uY=Nr({},q2,{dataTransfer:0}),fY=Va(uY),dY=Nr({},rp,{relatedTarget:0}),jw=Va(dY),hY=Nr({},Kf,{animationName:0,elapsedTime:0,pseudoElement:0}),gY=Va(hY),pY=Nr({},Kf,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),mY=Va(pY),vY=Nr({},Kf,{data:0}),Ob=Va(vY),yY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wY={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xY(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=CY[t])?!!e[t]:!1}function wS(){return xY}var SY=Nr({},rp,{key:function(t){if(t.key){var e=yY[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=zm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?wY[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wS,charCode:function(t){return t.type==="keypress"?zm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?zm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),EY=Va(SY),TY=Nr({},q2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mb=Va(TY),_Y=Nr({},rp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wS}),DY=Va(_Y),bY=Nr({},Kf,{propertyName:0,elapsedTime:0,pseudoElement:0}),IY=Va(bY),OY=Nr({},q2,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),MY=Va(OY),NY=[9,13,27,32],CS=Js&&"CompositionEvent"in window,Vh=null;Js&&"documentMode"in document&&(Vh=document.documentMode);var RY=Js&&"TextEvent"in window&&!Vh,kN=Js&&(!CS||Vh&&8<Vh&&11>=Vh),Nb=" ",Rb=!1;function PN(t,e){switch(t){case"keyup":return NY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var K0=!1;function AY(t,e){switch(t){case"compositionend":return FN(e);case"keypress":return e.which!==32?null:(Rb=!0,Nb);case"textInput":return t=e.data,t===Nb&&Rb?null:t;default:return null}}function LY(t,e){if(K0)return t==="compositionend"||!CS&&PN(t,e)?(t=LN(),Gm=vS=Gl=null,K0=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return kN&&e.locale!=="ko"?null:e.data;default:return null}}var kY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ab(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!kY[t.type]:e==="textarea"}function VN(t,e,n,r){pN(r),e=Sv(e,"onChange"),0<e.length&&(n=new yS("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Uh=null,pg=null;function PY(t){XN(t,0)}function X2(t){var e=Y0(t);if(lN(e))return t}function FY(t,e){if(t==="change")return e}var UN=!1;if(Js){var Hw;if(Js){var $w="oninput"in document;if(!$w){var Lb=document.createElement("div");Lb.setAttribute("oninput","return;"),$w=typeof Lb.oninput=="function"}Hw=$w}else Hw=!1;UN=Hw&&(!document.documentMode||9<document.documentMode)}function kb(){Uh&&(Uh.detachEvent("onpropertychange",BN),pg=Uh=null)}function BN(t){if(t.propertyName==="value"&&X2(pg)){var e=[];VN(e,pg,t,dS(t)),wN(PY,e)}}function VY(t,e,n){t==="focusin"?(kb(),Uh=e,pg=n,Uh.attachEvent("onpropertychange",BN)):t==="focusout"&&kb()}function UY(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return X2(pg)}function BY(t,e){if(t==="click")return X2(e)}function GY(t,e){if(t==="input"||t==="change")return X2(e)}function zY(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Bo=typeof Object.is=="function"?Object.is:zY;function mg(t,e){if(Bo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!J4.call(e,i)||!Bo(t[i],e[i]))return!1}return!0}function Pb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fb(t,e){var n=Pb(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Pb(n)}}function GN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?GN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function zN(){for(var t=window,e=pv();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=pv(t.document)}return e}function xS(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function WY(t){var e=zN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&GN(n.ownerDocument.documentElement,n)){if(r!==null&&xS(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=Fb(n,a);var o=Fb(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jY=Js&&"documentMode"in document&&11>=document.documentMode,q0=null,mC=null,Bh=null,vC=!1;function Vb(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;vC||q0==null||q0!==pv(r)||(r=q0,"selectionStart"in r&&xS(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Bh&&mg(Bh,r)||(Bh=r,r=Sv(mC,"onSelect"),0<r.length&&(e=new yS("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=q0)))}function K1(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var X0={animationend:K1("Animation","AnimationEnd"),animationiteration:K1("Animation","AnimationIteration"),animationstart:K1("Animation","AnimationStart"),transitionend:K1("Transition","TransitionEnd")},Kw={},WN={};Js&&(WN=document.createElement("div").style,"AnimationEvent"in window||(delete X0.animationend.animation,delete X0.animationiteration.animation,delete X0.animationstart.animation),"TransitionEvent"in window||delete X0.transitionend.transition);function Y2(t){if(Kw[t])return Kw[t];if(!X0[t])return t;var e=X0[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in WN)return Kw[t]=e[n];return t}var jN=Y2("animationend"),HN=Y2("animationiteration"),$N=Y2("animationstart"),KN=Y2("transitionend"),qN=new Map,Ub="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function dc(t,e){qN.set(t,e),Bu(e,[t])}for(var qw=0;qw<Ub.length;qw++){var Xw=Ub[qw],HY=Xw.toLowerCase(),$Y=Xw[0].toUpperCase()+Xw.slice(1);dc(HY,"on"+$Y)}dc(jN,"onAnimationEnd");dc(HN,"onAnimationIteration");dc($N,"onAnimationStart");dc("dblclick","onDoubleClick");dc("focusin","onFocus");dc("focusout","onBlur");dc(KN,"onTransitionEnd");_f("onMouseEnter",["mouseout","mouseover"]);_f("onMouseLeave",["mouseout","mouseover"]);_f("onPointerEnter",["pointerout","pointerover"]);_f("onPointerLeave",["pointerout","pointerover"]);Bu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KY=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ih));function Bb(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,HX(r,e,void 0,t),t.currentTarget=null}function XN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Bb(i,s,c),a=l}else for(o=0;o<r.length;o++){if(s=r[o],l=s.instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Bb(i,s,c),a=l}}}if(vv)throw t=dC,vv=!1,dC=null,t}function fr(t,e){var n=e[SC];n===void 0&&(n=e[SC]=new Set);var r=t+"__bubble";n.has(r)||(YN(e,t,2,!1),n.add(r))}function Yw(t,e,n){var r=0;e&&(r|=4),YN(n,t,r,e)}var q1="_reactListening"+Math.random().toString(36).slice(2);function vg(t){if(!t[q1]){t[q1]=!0,rN.forEach(function(n){n!=="selectionchange"&&(KY.has(n)||Yw(n,!1,t),Yw(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[q1]||(e[q1]=!0,Yw("selectionchange",!1,e))}}function YN(t,e,n,r){switch(AN(e)){case 1:var i=sY;break;case 4:i=lY;break;default:i=mS}n=i.bind(null,e,n,t),i=void 0,!fC||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Jw(t,e,n,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;s!==null;){if(o=mu(s),o===null)return;if(l=o.tag,l===5||l===6){r=a=o;continue e}s=s.parentNode}}r=r.return}wN(function(){var c=a,d=dS(n),f=[];e:{var h=qN.get(t);if(h!==void 0){var p=yS,C=t;switch(t){case"keypress":if(zm(n)===0)break e;case"keydown":case"keyup":p=EY;break;case"focusin":C="focus",p=jw;break;case"focusout":C="blur",p=jw;break;case"beforeblur":case"afterblur":p=jw;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Ib;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=fY;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=DY;break;case jN:case HN:case $N:p=gY;break;case KN:p=IY;break;case"scroll":p=cY;break;case"wheel":p=MY;break;case"copy":case"cut":case"paste":p=mY;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Mb}var x=(e&4)!==0,T=!x&&t==="scroll",_=x?h!==null?h+"Capture":null:h;x=[];for(var y=c,w;y!==null;){w=y;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,_!==null&&(b=fg(y,_),b!=null&&x.push(yg(y,b,w)))),T)break;y=y.return}0<x.length&&(h=new p(h,C,null,n,d),f.push({event:h,listeners:x}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==cC&&(C=n.relatedTarget||n.fromElement)&&(mu(C)||C[Zs]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(C=n.relatedTarget||n.toElement,p=c,C=C?mu(C):null,C!==null&&(T=Gu(C),C!==T||C.tag!==5&&C.tag!==6)&&(C=null)):(p=null,C=c),p!==C)){if(x=Ib,b="onMouseLeave",_="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(x=Mb,b="onPointerLeave",_="onPointerEnter",y="pointer"),T=p==null?h:Y0(p),w=C==null?h:Y0(C),h=new x(b,y+"leave",p,n,d),h.target=T,h.relatedTarget=w,b=null,mu(d)===c&&(x=new x(_,y+"enter",C,n,d),x.target=w,x.relatedTarget=T,b=x),T=b,p&&C)t:{for(x=p,_=C,y=0,w=x;w;w=N0(w))y++;for(w=0,b=_;b;b=N0(b))w++;for(;0<y-w;)x=N0(x),y--;for(;0<w-y;)_=N0(_),w--;for(;y--;){if(x===_||_!==null&&x===_.alternate)break t;x=N0(x),_=N0(_)}x=null}else x=null;p!==null&&Gb(f,h,p,x,!1),C!==null&&T!==null&&Gb(f,T,C,x,!0)}}e:{if(h=c?Y0(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var M=FY;else if(Ab(h))if(UN)M=GY;else{M=UY;var I=VY}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(M=BY);if(M&&(M=M(t,c))){VN(f,M,n,d);break e}I&&I(t,h,c),t==="focusout"&&(I=h._wrapperState)&&I.controlled&&h.type==="number"&&iC(h,"number",h.value)}switch(I=c?Y0(c):window,t){case"focusin":(Ab(I)||I.contentEditable==="true")&&(q0=I,mC=c,Bh=null);break;case"focusout":Bh=mC=q0=null;break;case"mousedown":vC=!0;break;case"contextmenu":case"mouseup":case"dragend":vC=!1,Vb(f,n,d);break;case"selectionchange":if(jY)break;case"keydown":case"keyup":Vb(f,n,d)}var A;if(CS)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else K0?PN(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(kN&&n.locale!=="ko"&&(K0||k!=="onCompositionStart"?k==="onCompositionEnd"&&K0&&(A=LN()):(Gl=d,vS="value"in Gl?Gl.value:Gl.textContent,K0=!0)),I=Sv(c,k),0<I.length&&(k=new Ob(k,t,null,n,d),f.push({event:k,listeners:I}),A?k.data=A:(A=FN(n),A!==null&&(k.data=A)))),(A=RY?AY(t,n):LY(t,n))&&(c=Sv(c,"onBeforeInput"),0<c.length&&(d=new Ob("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:c}),d.data=A))}XN(f,e)})}function yg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Sv(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=fg(t,n),a!=null&&r.unshift(yg(t,a,i)),a=fg(t,e),a!=null&&r.push(yg(t,a,i))),t=t.return}return r}function N0(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Gb(t,e,n,r,i){for(var a=e._reactName,o=[];n!==null&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(l!==null&&l===r)break;s.tag===5&&c!==null&&(s=c,i?(l=fg(n,a),l!=null&&o.unshift(yg(n,l,s))):i||(l=fg(n,a),l!=null&&o.push(yg(n,l,s)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var qY=/\r\n?/g,XY=/\u0000|\uFFFD/g;function zb(t){return(typeof t=="string"?t:""+t).replace(qY,`
`).replace(XY,"")}function X1(t,e,n){if(e=zb(e),zb(t)!==e&&n)throw Error(ut(425))}function Ev(){}var yC=null,wC=null;function CC(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xC=typeof setTimeout=="function"?setTimeout:void 0,YY=typeof clearTimeout=="function"?clearTimeout:void 0,Wb=typeof Promise=="function"?Promise:void 0,JY=typeof queueMicrotask=="function"?queueMicrotask:typeof Wb<"u"?function(t){return Wb.resolve(null).then(t).catch(ZY)}:xC;function ZY(t){setTimeout(function(){throw t})}function Zw(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),gg(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);gg(e)}function Zl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function jb(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qf=Math.random().toString(36).slice(2),ss="__reactFiber$"+qf,wg="__reactProps$"+qf,Zs="__reactContainer$"+qf,SC="__reactEvents$"+qf,QY="__reactListeners$"+qf,eJ="__reactHandles$"+qf;function mu(t){var e=t[ss];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Zs]||n[ss]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=jb(t);t!==null;){if(n=t[ss])return n;t=jb(t)}return e}t=n,n=t.parentNode}return null}function ip(t){return t=t[ss]||t[Zs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Y0(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ut(33))}function J2(t){return t[wg]||null}var EC=[],J0=-1;function hc(t){return{current:t}}function pr(t){0>J0||(t.current=EC[J0],EC[J0]=null,J0--)}function lr(t,e){J0++,EC[J0]=t.current,t.current=e}var oc={},Bi=hc(oc),ma=hc(!1),Ru=oc;function Df(t,e){var n=t.type.contextTypes;if(!n)return oc;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function va(t){return t=t.childContextTypes,t!=null}function Tv(){pr(ma),pr(Bi)}function Hb(t,e,n){if(Bi.current!==oc)throw Error(ut(168));lr(Bi,e),lr(ma,n)}function JN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ut(108,VX(t)||"Unknown",i));return Nr({},n,r)}function _v(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||oc,Ru=Bi.current,lr(Bi,t),lr(ma,ma.current),!0}function $b(t,e,n){var r=t.stateNode;if(!r)throw Error(ut(169));n?(t=JN(t,e,Ru),r.__reactInternalMemoizedMergedChildContext=t,pr(ma),pr(Bi),lr(Bi,t)):pr(ma),lr(ma,n)}var Bs=null,Z2=!1,Qw=!1;function ZN(t){Bs===null?Bs=[t]:Bs.push(t)}function tJ(t){Z2=!0,ZN(t)}function gc(){if(!Qw&&Bs!==null){Qw=!0;var t=0,e=Yn;try{var n=Bs;for(Yn=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Bs=null,Z2=!1}catch(i){throw Bs!==null&&(Bs=Bs.slice(t+1)),EN(hS,gc),i}finally{Yn=e,Qw=!1}}return null}var Z0=[],Q0=0,Dv=null,bv=0,Qa=[],eo=0,Au=null,Ws=1,js="";function lu(t,e){Z0[Q0++]=bv,Z0[Q0++]=Dv,Dv=t,bv=e}function QN(t,e,n){Qa[eo++]=Ws,Qa[eo++]=js,Qa[eo++]=Au,Au=t;var r=Ws;t=js;var i=32-Vo(r)-1;r&=~(1<<i),n+=1;var a=32-Vo(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ws=1<<32-Vo(e)+i|n<<i|r,js=a+t}else Ws=1<<a|n<<i|r,js=t}function SS(t){t.return!==null&&(lu(t,1),QN(t,1,0))}function ES(t){for(;t===Dv;)Dv=Z0[--Q0],Z0[Q0]=null,bv=Z0[--Q0],Z0[Q0]=null;for(;t===Au;)Au=Qa[--eo],Qa[eo]=null,js=Qa[--eo],Qa[eo]=null,Ws=Qa[--eo],Qa[eo]=null}var La=null,Aa=null,_r=!1,Ao=null;function eR(t,e){var n=no(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Kb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,La=t,Aa=Zl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,La=t,Aa=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Au!==null?{id:Ws,overflow:js}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=no(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,La=t,Aa=null,!0):!1;default:return!1}}function TC(t){return(t.mode&1)!==0&&(t.flags&128)===0}function _C(t){if(_r){var e=Aa;if(e){var n=e;if(!Kb(t,e)){if(TC(t))throw Error(ut(418));e=Zl(n.nextSibling);var r=La;e&&Kb(t,e)?eR(r,n):(t.flags=t.flags&-4097|2,_r=!1,La=t)}}else{if(TC(t))throw Error(ut(418));t.flags=t.flags&-4097|2,_r=!1,La=t}}}function qb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;La=t}function Y1(t){if(t!==La)return!1;if(!_r)return qb(t),_r=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!CC(t.type,t.memoizedProps)),e&&(e=Aa)){if(TC(t))throw tR(),Error(ut(418));for(;e;)eR(t,e),e=Zl(e.nextSibling)}if(qb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ut(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Aa=Zl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Aa=null}}else Aa=La?Zl(t.stateNode.nextSibling):null;return!0}function tR(){for(var t=Aa;t;)t=Zl(t.nextSibling)}function bf(){Aa=La=null,_r=!1}function TS(t){Ao===null?Ao=[t]:Ao.push(t)}var nJ=ll.ReactCurrentBatchConfig;function gh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ut(309));var r=n.stateNode}if(!r)throw Error(ut(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var s=i.refs;o===null?delete s[a]:s[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(ut(284));if(!n._owner)throw Error(ut(290,t))}return t}function J1(t,e){throw t=Object.prototype.toString.call(e),Error(ut(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Xb(t){var e=t._init;return e(t._payload)}function nR(t){function e(_,y){if(t){var w=_.deletions;w===null?(_.deletions=[y],_.flags|=16):w.push(y)}}function n(_,y){if(!t)return null;for(;y!==null;)e(_,y),y=y.sibling;return null}function r(_,y){for(_=new Map;y!==null;)y.key!==null?_.set(y.key,y):_.set(y.index,y),y=y.sibling;return _}function i(_,y){return _=nc(_,y),_.index=0,_.sibling=null,_}function a(_,y,w){return _.index=w,t?(w=_.alternate,w!==null?(w=w.index,w<y?(_.flags|=2,y):w):(_.flags|=2,y)):(_.flags|=1048576,y)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function s(_,y,w,b){return y===null||y.tag!==6?(y=o4(w,_.mode,b),y.return=_,y):(y=i(y,w),y.return=_,y)}function l(_,y,w,b){var M=w.type;return M===$0?d(_,y,w.props.children,b,w.key):y!==null&&(y.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Nl&&Xb(M)===y.type)?(b=i(y,w.props),b.ref=gh(_,y,w),b.return=_,b):(b=Xm(w.type,w.key,w.props,null,_.mode,b),b.ref=gh(_,y,w),b.return=_,b)}function c(_,y,w,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=s4(w,_.mode,b),y.return=_,y):(y=i(y,w.children||[]),y.return=_,y)}function d(_,y,w,b,M){return y===null||y.tag!==7?(y=Tu(w,_.mode,b,M),y.return=_,y):(y=i(y,w),y.return=_,y)}function f(_,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=o4(""+y,_.mode,w),y.return=_,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case B1:return w=Xm(y.type,y.key,y.props,null,_.mode,w),w.ref=gh(_,null,y),w.return=_,w;case H0:return y=s4(y,_.mode,w),y.return=_,y;case Nl:var b=y._init;return f(_,b(y._payload),w)}if(Dh(y)||ch(y))return y=Tu(y,_.mode,w,null),y.return=_,y;J1(_,y)}return null}function h(_,y,w,b){var M=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return M!==null?null:s(_,y,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case B1:return w.key===M?l(_,y,w,b):null;case H0:return w.key===M?c(_,y,w,b):null;case Nl:return M=w._init,h(_,y,M(w._payload),b)}if(Dh(w)||ch(w))return M!==null?null:d(_,y,w,b,null);J1(_,w)}return null}function p(_,y,w,b,M){if(typeof b=="string"&&b!==""||typeof b=="number")return _=_.get(w)||null,s(y,_,""+b,M);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case B1:return _=_.get(b.key===null?w:b.key)||null,l(y,_,b,M);case H0:return _=_.get(b.key===null?w:b.key)||null,c(y,_,b,M);case Nl:var I=b._init;return p(_,y,w,I(b._payload),M)}if(Dh(b)||ch(b))return _=_.get(w)||null,d(y,_,b,M,null);J1(y,b)}return null}function C(_,y,w,b){for(var M=null,I=null,A=y,k=y=0,U=null;A!==null&&k<w.length;k++){A.index>k?(U=A,A=null):U=A.sibling;var B=h(_,A,w[k],b);if(B===null){A===null&&(A=U);break}t&&A&&B.alternate===null&&e(_,A),y=a(B,y,k),I===null?M=B:I.sibling=B,I=B,A=U}if(k===w.length)return n(_,A),_r&&lu(_,k),M;if(A===null){for(;k<w.length;k++)A=f(_,w[k],b),A!==null&&(y=a(A,y,k),I===null?M=A:I.sibling=A,I=A);return _r&&lu(_,k),M}for(A=r(_,A);k<w.length;k++)U=p(A,_,k,w[k],b),U!==null&&(t&&U.alternate!==null&&A.delete(U.key===null?k:U.key),y=a(U,y,k),I===null?M=U:I.sibling=U,I=U);return t&&A.forEach(function(z){return e(_,z)}),_r&&lu(_,k),M}function x(_,y,w,b){var M=ch(w);if(typeof M!="function")throw Error(ut(150));if(w=M.call(w),w==null)throw Error(ut(151));for(var I=M=null,A=y,k=y=0,U=null,B=w.next();A!==null&&!B.done;k++,B=w.next()){A.index>k?(U=A,A=null):U=A.sibling;var z=h(_,A,B.value,b);if(z===null){A===null&&(A=U);break}t&&A&&z.alternate===null&&e(_,A),y=a(z,y,k),I===null?M=z:I.sibling=z,I=z,A=U}if(B.done)return n(_,A),_r&&lu(_,k),M;if(A===null){for(;!B.done;k++,B=w.next())B=f(_,B.value,b),B!==null&&(y=a(B,y,k),I===null?M=B:I.sibling=B,I=B);return _r&&lu(_,k),M}for(A=r(_,A);!B.done;k++,B=w.next())B=p(A,_,k,B.value,b),B!==null&&(t&&B.alternate!==null&&A.delete(B.key===null?k:B.key),y=a(B,y,k),I===null?M=B:I.sibling=B,I=B);return t&&A.forEach(function(K){return e(_,K)}),_r&&lu(_,k),M}function T(_,y,w,b){if(typeof w=="object"&&w!==null&&w.type===$0&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case B1:e:{for(var M=w.key,I=y;I!==null;){if(I.key===M){if(M=w.type,M===$0){if(I.tag===7){n(_,I.sibling),y=i(I,w.props.children),y.return=_,_=y;break e}}else if(I.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Nl&&Xb(M)===I.type){n(_,I.sibling),y=i(I,w.props),y.ref=gh(_,I,w),y.return=_,_=y;break e}n(_,I);break}else e(_,I);I=I.sibling}w.type===$0?(y=Tu(w.props.children,_.mode,b,w.key),y.return=_,_=y):(b=Xm(w.type,w.key,w.props,null,_.mode,b),b.ref=gh(_,y,w),b.return=_,_=b)}return o(_);case H0:e:{for(I=w.key;y!==null;){if(y.key===I)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){n(_,y.sibling),y=i(y,w.children||[]),y.return=_,_=y;break e}else{n(_,y);break}else e(_,y);y=y.sibling}y=s4(w,_.mode,b),y.return=_,_=y}return o(_);case Nl:return I=w._init,T(_,y,I(w._payload),b)}if(Dh(w))return C(_,y,w,b);if(ch(w))return x(_,y,w,b);J1(_,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(n(_,y.sibling),y=i(y,w),y.return=_,_=y):(n(_,y),y=o4(w,_.mode,b),y.return=_,_=y),o(_)):n(_,y)}return T}var If=nR(!0),rR=nR(!1),Iv=hc(null),Ov=null,ef=null,_S=null;function DS(){_S=ef=Ov=null}function bS(t){var e=Iv.current;pr(Iv),t._currentValue=e}function DC(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function yf(t,e){Ov=t,_S=ef=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ga=!0),t.firstContext=null)}function lo(t){var e=t._currentValue;if(_S!==t)if(t={context:t,memoizedValue:e,next:null},ef===null){if(Ov===null)throw Error(ut(308));ef=t,Ov.dependencies={lanes:0,firstContext:t}}else ef=ef.next=t;return e}var vu=null;function IS(t){vu===null?vu=[t]:vu.push(t)}function iR(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,IS(e)):(n.next=i.next,i.next=n),e.interleaved=n,Qs(t,r)}function Qs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Rl=!1;function OS(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aR(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ks(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ql(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Vn&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Qs(t,n)}return i=r.interleaved,i===null?(e.next=e,IS(r)):(e.next=i.next,i.next=e),r.interleaved=e,Qs(t,n)}function Wm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,gS(t,n)}}function Yb(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=e:a=a.next=e}else i=a=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Mv(t,e,n,r){var i=t.updateQueue;Rl=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var l=s,c=l.next;l.next=null,o===null?a=c:o.next=c,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,s=d.lastBaseUpdate,s!==o&&(s===null?d.firstBaseUpdate=c:s.next=c,d.lastBaseUpdate=l))}if(a!==null){var f=i.baseState;o=0,d=c=l=null,s=a;do{var h=s.lane,p=s.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var C=t,x=s;switch(h=e,p=n,x.tag){case 1:if(C=x.payload,typeof C=="function"){f=C.call(p,f,h);break e}f=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=x.payload,h=typeof C=="function"?C.call(p,f,h):C,h==null)break e;f=Nr({},f,h);break e;case 2:Rl=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},d===null?(c=d=p,l=f):d=d.next=p,o|=h;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;h=s,s=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(d===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);ku|=o,t.lanes=o,t.memoizedState=f}}function Jb(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(ut(191,i));i.call(r)}}}var ap={},fs=hc(ap),Cg=hc(ap),xg=hc(ap);function yu(t){if(t===ap)throw Error(ut(174));return t}function MS(t,e){switch(lr(xg,e),lr(Cg,t),lr(fs,ap),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:oC(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=oC(e,t)}pr(fs),lr(fs,e)}function Of(){pr(fs),pr(Cg),pr(xg)}function oR(t){yu(xg.current);var e=yu(fs.current),n=oC(e,t.type);e!==n&&(lr(Cg,t),lr(fs,n))}function NS(t){Cg.current===t&&(pr(fs),pr(Cg))}var Ir=hc(0);function Nv(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var e4=[];function RS(){for(var t=0;t<e4.length;t++)e4[t]._workInProgressVersionPrimary=null;e4.length=0}var jm=ll.ReactCurrentDispatcher,t4=ll.ReactCurrentBatchConfig,Lu=0,Mr=null,ii=null,di=null,Rv=!1,Gh=!1,Sg=0,rJ=0;function Ni(){throw Error(ut(321))}function AS(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Bo(t[n],e[n]))return!1;return!0}function LS(t,e,n,r,i,a){if(Lu=a,Mr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jm.current=t===null||t.memoizedState===null?sJ:lJ,t=n(r,i),Gh){a=0;do{if(Gh=!1,Sg=0,25<=a)throw Error(ut(301));a+=1,di=ii=null,e.updateQueue=null,jm.current=cJ,t=n(r,i)}while(Gh)}if(jm.current=Av,e=ii!==null&&ii.next!==null,Lu=0,di=ii=Mr=null,Rv=!1,e)throw Error(ut(300));return t}function kS(){var t=Sg!==0;return Sg=0,t}function rs(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return di===null?Mr.memoizedState=di=t:di=di.next=t,di}function co(){if(ii===null){var t=Mr.alternate;t=t!==null?t.memoizedState:null}else t=ii.next;var e=di===null?Mr.memoizedState:di.next;if(e!==null)di=e,ii=t;else{if(t===null)throw Error(ut(310));ii=t,t={memoizedState:ii.memoizedState,baseState:ii.baseState,baseQueue:ii.baseQueue,queue:ii.queue,next:null},di===null?Mr.memoizedState=di=t:di=di.next=t}return di}function Eg(t,e){return typeof e=="function"?e(t):e}function n4(t){var e=co(),n=e.queue;if(n===null)throw Error(ut(311));n.lastRenderedReducer=t;var r=ii,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var s=o=null,l=null,c=a;do{var d=c.lane;if((Lu&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(s=l=f,o=r):l=l.next=f,Mr.lanes|=d,ku|=d}c=c.next}while(c!==null&&c!==a);l===null?o=r:l.next=s,Bo(r,e.memoizedState)||(ga=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do a=i.lane,Mr.lanes|=a,ku|=a,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function r4(t){var e=co(),n=e.queue;if(n===null)throw Error(ut(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,a=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);Bo(a,e.memoizedState)||(ga=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function sR(){}function lR(t,e){var n=Mr,r=co(),i=e(),a=!Bo(r.memoizedState,i);if(a&&(r.memoizedState=i,ga=!0),r=r.queue,PS(fR.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||di!==null&&di.memoizedState.tag&1){if(n.flags|=2048,Tg(9,uR.bind(null,n,r,i,e),void 0,null),hi===null)throw Error(ut(349));Lu&30||cR(n,e,i)}return i}function cR(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Mr.updateQueue,e===null?(e={lastEffect:null,stores:null},Mr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function uR(t,e,n,r){e.value=n,e.getSnapshot=r,dR(e)&&hR(t)}function fR(t,e,n){return n(function(){dR(e)&&hR(t)})}function dR(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Bo(t,n)}catch{return!0}}function hR(t){var e=Qs(t,1);e!==null&&Uo(e,t,1,-1)}function Zb(t){var e=rs();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eg,lastRenderedState:t},e.queue=t,t=t.dispatch=oJ.bind(null,Mr,t),[e.memoizedState,t]}function Tg(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Mr.updateQueue,e===null?(e={lastEffect:null,stores:null},Mr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function gR(){return co().memoizedState}function Hm(t,e,n,r){var i=rs();Mr.flags|=t,i.memoizedState=Tg(1|e,n,void 0,r===void 0?null:r)}function Q2(t,e,n,r){var i=co();r=r===void 0?null:r;var a=void 0;if(ii!==null){var o=ii.memoizedState;if(a=o.destroy,r!==null&&AS(r,o.deps)){i.memoizedState=Tg(e,n,a,r);return}}Mr.flags|=t,i.memoizedState=Tg(1|e,n,a,r)}function Qb(t,e){return Hm(8390656,8,t,e)}function PS(t,e){return Q2(2048,8,t,e)}function pR(t,e){return Q2(4,2,t,e)}function mR(t,e){return Q2(4,4,t,e)}function vR(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function yR(t,e,n){return n=n!=null?n.concat([t]):null,Q2(4,4,vR.bind(null,e,t),n)}function FS(){}function wR(t,e){var n=co();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&AS(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function CR(t,e){var n=co();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&AS(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function xR(t,e,n){return Lu&21?(Bo(n,e)||(n=DN(),Mr.lanes|=n,ku|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ga=!0),t.memoizedState=n)}function iJ(t,e){var n=Yn;Yn=n!==0&&4>n?n:4,t(!0);var r=t4.transition;t4.transition={};try{t(!1),e()}finally{Yn=n,t4.transition=r}}function SR(){return co().memoizedState}function aJ(t,e,n){var r=tc(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ER(t))TR(e,n);else if(n=iR(t,e,n,r),n!==null){var i=na();Uo(n,t,r,i),_R(n,e,r)}}function oJ(t,e,n){var r=tc(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ER(t))TR(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,Bo(s,o)){var l=e.interleaved;l===null?(i.next=i,IS(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=iR(t,e,i,r),n!==null&&(i=na(),Uo(n,t,r,i),_R(n,e,r))}}function ER(t){var e=t.alternate;return t===Mr||e!==null&&e===Mr}function TR(t,e){Gh=Rv=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function _R(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,gS(t,n)}}var Av={readContext:lo,useCallback:Ni,useContext:Ni,useEffect:Ni,useImperativeHandle:Ni,useInsertionEffect:Ni,useLayoutEffect:Ni,useMemo:Ni,useReducer:Ni,useRef:Ni,useState:Ni,useDebugValue:Ni,useDeferredValue:Ni,useTransition:Ni,useMutableSource:Ni,useSyncExternalStore:Ni,useId:Ni,unstable_isNewReconciler:!1},sJ={readContext:lo,useCallback:function(t,e){return rs().memoizedState=[t,e===void 0?null:e],t},useContext:lo,useEffect:Qb,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Hm(4194308,4,vR.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Hm(4194308,4,t,e)},useInsertionEffect:function(t,e){return Hm(4,2,t,e)},useMemo:function(t,e){var n=rs();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=rs();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=aJ.bind(null,Mr,t),[r.memoizedState,t]},useRef:function(t){var e=rs();return t={current:t},e.memoizedState=t},useState:Zb,useDebugValue:FS,useDeferredValue:function(t){return rs().memoizedState=t},useTransition:function(){var t=Zb(!1),e=t[0];return t=iJ.bind(null,t[1]),rs().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Mr,i=rs();if(_r){if(n===void 0)throw Error(ut(407));n=n()}else{if(n=e(),hi===null)throw Error(ut(349));Lu&30||cR(r,e,n)}i.memoizedState=n;var a={value:n,getSnapshot:e};return i.queue=a,Qb(fR.bind(null,r,a,t),[t]),r.flags|=2048,Tg(9,uR.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=rs(),e=hi.identifierPrefix;if(_r){var n=js,r=Ws;n=(r&~(1<<32-Vo(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Sg++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=rJ++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},lJ={readContext:lo,useCallback:wR,useContext:lo,useEffect:PS,useImperativeHandle:yR,useInsertionEffect:pR,useLayoutEffect:mR,useMemo:CR,useReducer:n4,useRef:gR,useState:function(){return n4(Eg)},useDebugValue:FS,useDeferredValue:function(t){var e=co();return xR(e,ii.memoizedState,t)},useTransition:function(){var t=n4(Eg)[0],e=co().memoizedState;return[t,e]},useMutableSource:sR,useSyncExternalStore:lR,useId:SR,unstable_isNewReconciler:!1},cJ={readContext:lo,useCallback:wR,useContext:lo,useEffect:PS,useImperativeHandle:yR,useInsertionEffect:pR,useLayoutEffect:mR,useMemo:CR,useReducer:r4,useRef:gR,useState:function(){return r4(Eg)},useDebugValue:FS,useDeferredValue:function(t){var e=co();return ii===null?e.memoizedState=t:xR(e,ii.memoizedState,t)},useTransition:function(){var t=r4(Eg)[0],e=co().memoizedState;return[t,e]},useMutableSource:sR,useSyncExternalStore:lR,useId:SR,unstable_isNewReconciler:!1};function Io(t,e){if(t&&t.defaultProps){e=Nr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function bC(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Nr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ey={isMounted:function(t){return(t=t._reactInternals)?Gu(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=na(),i=tc(t),a=Ks(r,i);a.payload=e,n!=null&&(a.callback=n),e=Ql(t,a,i),e!==null&&(Uo(e,t,i,r),Wm(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=na(),i=tc(t),a=Ks(r,i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Ql(t,a,i),e!==null&&(Uo(e,t,i,r),Wm(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=na(),r=tc(t),i=Ks(n,r);i.tag=2,e!=null&&(i.callback=e),e=Ql(t,i,r),e!==null&&(Uo(e,t,r,n),Wm(e,t,r))}};function eI(t,e,n,r,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!mg(n,r)||!mg(i,a):!0}function DR(t,e,n){var r=!1,i=oc,a=e.contextType;return typeof a=="object"&&a!==null?a=lo(a):(i=va(e)?Ru:Bi.current,r=e.contextTypes,a=(r=r!=null)?Df(t,i):oc),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ey,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function tI(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ey.enqueueReplaceState(e,e.state,null)}function IC(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},OS(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=lo(a):(a=va(e)?Ru:Bi.current,i.context=Df(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(bC(t,e,a,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&ey.enqueueReplaceState(i,i.state,null),Mv(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Mf(t,e){try{var n="",r=e;do n+=FX(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function i4(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function OC(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var uJ=typeof WeakMap=="function"?WeakMap:Map;function bR(t,e,n){n=Ks(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){kv||(kv=!0,UC=r),OC(t,e)},n}function IR(t,e,n){n=Ks(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){OC(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){OC(t,e),typeof r!="function"&&(ec===null?ec=new Set([this]):ec.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function nI(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new uJ;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=TJ.bind(null,t,e,n),e.then(t,t))}function rI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function iI(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ks(-1,1),e.tag=2,Ql(n,e,1))),n.lanes|=1),t)}var fJ=ll.ReactCurrentOwner,ga=!1;function Qi(t,e,n,r){e.child=t===null?rR(e,null,n,r):If(e,t.child,n,r)}function aI(t,e,n,r,i){n=n.render;var a=e.ref;return yf(e,i),r=LS(t,e,n,r,a,i),n=kS(),t!==null&&!ga?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,el(t,e,i)):(_r&&n&&SS(e),e.flags|=1,Qi(t,e,r,i),e.child)}function oI(t,e,n,r,i){if(t===null){var a=n.type;return typeof a=="function"&&!HS(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,OR(t,e,a,r,i)):(t=Xm(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:mg,n(o,r)&&t.ref===e.ref)return el(t,e,i)}return e.flags|=1,t=nc(a,r),t.ref=e.ref,t.return=e,e.child=t}function OR(t,e,n,r,i){if(t!==null){var a=t.memoizedProps;if(mg(a,r)&&t.ref===e.ref)if(ga=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(ga=!0);else return e.lanes=t.lanes,el(t,e,i)}return MC(t,e,n,r,i)}function MR(t,e,n){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},lr(nf,Oa),Oa|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,lr(nf,Oa),Oa|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,lr(nf,Oa),Oa|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,lr(nf,Oa),Oa|=r;return Qi(t,e,i,n),e.child}function NR(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function MC(t,e,n,r,i){var a=va(n)?Ru:Bi.current;return a=Df(e,a),yf(e,i),n=LS(t,e,n,r,a,i),r=kS(),t!==null&&!ga?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,el(t,e,i)):(_r&&r&&SS(e),e.flags|=1,Qi(t,e,n,i),e.child)}function sI(t,e,n,r,i){if(va(n)){var a=!0;_v(e)}else a=!1;if(yf(e,i),e.stateNode===null)$m(t,e),DR(e,n,r),IC(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,s=e.memoizedProps;o.props=s;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=lo(c):(c=va(n)?Ru:Bi.current,c=Df(e,c));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||l!==c)&&tI(e,o,r,c),Rl=!1;var h=e.memoizedState;o.state=h,Mv(e,r,o,i),l=e.memoizedState,s!==r||h!==l||ma.current||Rl?(typeof d=="function"&&(bC(e,n,d,r),l=e.memoizedState),(s=Rl||eI(e,n,s,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,aR(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:Io(e.type,s),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=lo(l):(l=va(n)?Ru:Bi.current,l=Df(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||h!==l)&&tI(e,o,r,l),Rl=!1,h=e.memoizedState,o.state=h,Mv(e,r,o,i);var C=e.memoizedState;s!==f||h!==C||ma.current||Rl?(typeof p=="function"&&(bC(e,n,p,r),C=e.memoizedState),(c=Rl||eI(e,n,c,r,h,C,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,C,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,C,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),o.props=r,o.state=C,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return NC(t,e,n,r,a,i)}function NC(t,e,n,r,i,a){NR(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&$b(e,n,!1),el(t,e,a);r=e.stateNode,fJ.current=e;var s=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=If(e,t.child,null,a),e.child=If(e,null,s,a)):Qi(t,e,s,a),e.memoizedState=r.state,i&&$b(e,n,!0),e.child}function RR(t){var e=t.stateNode;e.pendingContext?Hb(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Hb(t,e.context,!1),MS(t,e.containerInfo)}function lI(t,e,n,r,i){return bf(),TS(i),e.flags|=256,Qi(t,e,n,r),e.child}var RC={dehydrated:null,treeContext:null,retryLane:0};function AC(t){return{baseLanes:t,cachePool:null,transitions:null}}function AR(t,e,n){var r=e.pendingProps,i=Ir.current,a=!1,o=(e.flags&128)!==0,s;if((s=o)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),lr(Ir,i&1),t===null)return _C(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=ry(o,r,0,null),t=Tu(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=AC(n),e.memoizedState=RC,t):VS(e,o));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return dJ(t,e,o,r,s,i,n);if(a){a=r.fallback,o=e.mode,i=t.child,s=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=nc(i,l),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=nc(s,a):(a=Tu(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?AC(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=RC,r}return a=t.child,t=a.sibling,r=nc(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function VS(t,e){return e=ry({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Z1(t,e,n,r){return r!==null&&TS(r),If(e,t.child,null,n),t=VS(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function dJ(t,e,n,r,i,a,o){if(n)return e.flags&256?(e.flags&=-257,r=i4(Error(ut(422))),Z1(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=ry({mode:"visible",children:r.children},i,0,null),a=Tu(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&If(e,t.child,null,o),e.child.memoizedState=AC(o),e.memoizedState=RC,a);if(!(e.mode&1))return Z1(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,a=Error(ut(419)),r=i4(a,r,void 0),Z1(t,e,o,r)}if(s=(o&t.childLanes)!==0,ga||s){if(r=hi,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Qs(t,i),Uo(r,t,i,-1))}return jS(),r=i4(Error(ut(421))),Z1(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=_J.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,Aa=Zl(i.nextSibling),La=e,_r=!0,Ao=null,t!==null&&(Qa[eo++]=Ws,Qa[eo++]=js,Qa[eo++]=Au,Ws=t.id,js=t.overflow,Au=e),e=VS(e,r.children),e.flags|=4096,e)}function cI(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),DC(t.return,e,n)}function a4(t,e,n,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function LR(t,e,n){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(Qi(t,e,r.children,n),r=Ir.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&cI(t,n,e);else if(t.tag===19)cI(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(lr(Ir,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Nv(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),a4(e,!1,i,n,a);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Nv(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}a4(e,!0,n,null,a);break;case"together":a4(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $m(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function el(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ku|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ut(153));if(e.child!==null){for(t=e.child,n=nc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=nc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function hJ(t,e,n){switch(e.tag){case 3:RR(e),bf();break;case 5:oR(e);break;case 1:va(e.type)&&_v(e);break;case 4:MS(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;lr(Iv,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(lr(Ir,Ir.current&1),e.flags|=128,null):n&e.child.childLanes?AR(t,e,n):(lr(Ir,Ir.current&1),t=el(t,e,n),t!==null?t.sibling:null);lr(Ir,Ir.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return LR(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),lr(Ir,Ir.current),r)break;return null;case 22:case 23:return e.lanes=0,MR(t,e,n)}return el(t,e,n)}var kR,LC,PR,FR;kR=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};LC=function(){};PR=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,yu(fs.current);var a=null;switch(n){case"input":i=nC(t,i),r=nC(t,r),a=[];break;case"select":i=Nr({},i,{value:void 0}),r=Nr({},r,{value:void 0}),a=[];break;case"textarea":i=aC(t,i),r=aC(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ev)}sC(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var s=i[c];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(cg.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in r){var l=r[c];if(s=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==s&&(l!=null||s!=null))if(c==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(a||(a=[]),a.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(a=a||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(a=a||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(cg.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&fr("scroll",t),a||s===l||(a=[])):(a=a||[]).push(c,l))}n&&(a=a||[]).push("style",n);var c=a;(e.updateQueue=c)&&(e.flags|=4)}};FR=function(t,e,n,r){n!==r&&(e.flags|=4)};function ph(t,e){if(!_r)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ri(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function gJ(t,e,n){var r=e.pendingProps;switch(ES(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(e),null;case 1:return va(e.type)&&Tv(),Ri(e),null;case 3:return r=e.stateNode,Of(),pr(ma),pr(Bi),RS(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Y1(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ao!==null&&(zC(Ao),Ao=null))),LC(t,e),Ri(e),null;case 5:NS(e);var i=yu(xg.current);if(n=e.type,t!==null&&e.stateNode!=null)PR(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ut(166));return Ri(e),null}if(t=yu(fs.current),Y1(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[ss]=e,r[wg]=a,t=(e.mode&1)!==0,n){case"dialog":fr("cancel",r),fr("close",r);break;case"iframe":case"object":case"embed":fr("load",r);break;case"video":case"audio":for(i=0;i<Ih.length;i++)fr(Ih[i],r);break;case"source":fr("error",r);break;case"img":case"image":case"link":fr("error",r),fr("load",r);break;case"details":fr("toggle",r);break;case"input":yb(r,a),fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},fr("invalid",r);break;case"textarea":Cb(r,a),fr("invalid",r)}sC(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?r.textContent!==s&&(a.suppressHydrationWarning!==!0&&X1(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&X1(r.textContent,s,t),i=["children",""+s]):cg.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&fr("scroll",r)}switch(n){case"input":G1(r),wb(r,a,!0);break;case"textarea":G1(r),xb(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Ev)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=fN(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[ss]=e,t[wg]=r,kR(t,e,!1,!1),e.stateNode=t;e:{switch(o=lC(n,r),n){case"dialog":fr("cancel",t),fr("close",t),i=r;break;case"iframe":case"object":case"embed":fr("load",t),i=r;break;case"video":case"audio":for(i=0;i<Ih.length;i++)fr(Ih[i],t);i=r;break;case"source":fr("error",t),i=r;break;case"img":case"image":case"link":fr("error",t),fr("load",t),i=r;break;case"details":fr("toggle",t),i=r;break;case"input":yb(t,r),i=nC(t,r),fr("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Nr({},r,{value:void 0}),fr("invalid",t);break;case"textarea":Cb(t,r),i=aC(t,r),fr("invalid",t);break;default:i=r}sC(n,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var l=s[a];a==="style"?gN(t,l):a==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&dN(t,l)):a==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&ug(t,l):typeof l=="number"&&ug(t,""+l):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(cg.hasOwnProperty(a)?l!=null&&a==="onScroll"&&fr("scroll",t):l!=null&&lS(t,a,l,o))}switch(n){case"input":G1(t),wb(t,r,!1);break;case"textarea":G1(t),xb(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ac(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?gf(t,!!r.multiple,a,!1):r.defaultValue!=null&&gf(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ev)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ri(e),null;case 6:if(t&&e.stateNode!=null)FR(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ut(166));if(n=yu(xg.current),yu(fs.current),Y1(e)){if(r=e.stateNode,n=e.memoizedProps,r[ss]=e,(a=r.nodeValue!==n)&&(t=La,t!==null))switch(t.tag){case 3:X1(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&X1(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ss]=e,e.stateNode=r}return Ri(e),null;case 13:if(pr(Ir),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_r&&Aa!==null&&e.mode&1&&!(e.flags&128))tR(),bf(),e.flags|=98560,a=!1;else if(a=Y1(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(ut(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(ut(317));a[ss]=e}else bf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ri(e),a=!1}else Ao!==null&&(zC(Ao),Ao=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ir.current&1?ai===0&&(ai=3):jS())),e.updateQueue!==null&&(e.flags|=4),Ri(e),null);case 4:return Of(),LC(t,e),t===null&&vg(e.stateNode.containerInfo),Ri(e),null;case 10:return bS(e.type._context),Ri(e),null;case 17:return va(e.type)&&Tv(),Ri(e),null;case 19:if(pr(Ir),a=e.memoizedState,a===null)return Ri(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)ph(a,!1);else{if(ai!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Nv(t),o!==null){for(e.flags|=128,ph(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return lr(Ir,Ir.current&1|2),e.child}t=t.sibling}a.tail!==null&&zr()>Nf&&(e.flags|=128,r=!0,ph(a,!1),e.lanes=4194304)}else{if(!r)if(t=Nv(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ph(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!_r)return Ri(e),null}else 2*zr()-a.renderingStartTime>Nf&&n!==1073741824&&(e.flags|=128,r=!0,ph(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=zr(),e.sibling=null,n=Ir.current,lr(Ir,r?n&1|2:n&1),e):(Ri(e),null);case 22:case 23:return WS(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Oa&1073741824&&(Ri(e),e.subtreeFlags&6&&(e.flags|=8192)):Ri(e),null;case 24:return null;case 25:return null}throw Error(ut(156,e.tag))}function pJ(t,e){switch(ES(e),e.tag){case 1:return va(e.type)&&Tv(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Of(),pr(ma),pr(Bi),RS(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return NS(e),null;case 13:if(pr(Ir),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ut(340));bf()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pr(Ir),null;case 4:return Of(),null;case 10:return bS(e.type._context),null;case 22:case 23:return WS(),null;case 24:return null;default:return null}}var Q1=!1,ki=!1,mJ=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function tf(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Pr(t,e,r)}else n.current=null}function kC(t,e,n){try{n()}catch(r){Pr(t,e,r)}}var uI=!1;function vJ(t,e){if(yC=Cv,t=zN(),xS(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,s=-1,l=-1,c=0,d=0,f=t,h=null;t:for(;;){for(var p;f!==n||i!==0&&f.nodeType!==3||(s=o+i),f!==a||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++c===i&&(s=o),h===a&&++d===r&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=s===-1||l===-1?null:{start:s,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(wC={focusedElem:t,selectionRange:n},Cv=!1,Rt=e;Rt!==null;)if(e=Rt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Rt=t;else for(;Rt!==null;){e=Rt;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var x=C.memoizedProps,T=C.memoizedState,_=e.stateNode,y=_.getSnapshotBeforeUpdate(e.elementType===e.type?x:Io(e.type,x),T);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ut(163))}}catch(b){Pr(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,Rt=t;break}Rt=e.return}return C=uI,uI=!1,C}function zh(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&kC(e,n,a)}i=i.next}while(i!==r)}}function ty(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function PC(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function VR(t){var e=t.alternate;e!==null&&(t.alternate=null,VR(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ss],delete e[wg],delete e[SC],delete e[QY],delete e[eJ])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function UR(t){return t.tag===5||t.tag===3||t.tag===4}function fI(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||UR(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function FC(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ev));else if(r!==4&&(t=t.child,t!==null))for(FC(t,e,n),t=t.sibling;t!==null;)FC(t,e,n),t=t.sibling}function VC(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(VC(t,e,n),t=t.sibling;t!==null;)VC(t,e,n),t=t.sibling}var wi=null,No=!1;function Sl(t,e,n){for(n=n.child;n!==null;)BR(t,e,n),n=n.sibling}function BR(t,e,n){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(K2,n)}catch{}switch(n.tag){case 5:ki||tf(n,e);case 6:var r=wi,i=No;wi=null,Sl(t,e,n),wi=r,No=i,wi!==null&&(No?(t=wi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):wi.removeChild(n.stateNode));break;case 18:wi!==null&&(No?(t=wi,n=n.stateNode,t.nodeType===8?Zw(t.parentNode,n):t.nodeType===1&&Zw(t,n),gg(t)):Zw(wi,n.stateNode));break;case 4:r=wi,i=No,wi=n.stateNode.containerInfo,No=!0,Sl(t,e,n),wi=r,No=i;break;case 0:case 11:case 14:case 15:if(!ki&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&kC(n,e,o),i=i.next}while(i!==r)}Sl(t,e,n);break;case 1:if(!ki&&(tf(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Pr(n,e,s)}Sl(t,e,n);break;case 21:Sl(t,e,n);break;case 22:n.mode&1?(ki=(r=ki)||n.memoizedState!==null,Sl(t,e,n),ki=r):Sl(t,e,n);break;default:Sl(t,e,n)}}function dI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new mJ),e.forEach(function(r){var i=DJ.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function So(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=t,o=e,s=o;e:for(;s!==null;){switch(s.tag){case 5:wi=s.stateNode,No=!1;break e;case 3:wi=s.stateNode.containerInfo,No=!0;break e;case 4:wi=s.stateNode.containerInfo,No=!0;break e}s=s.return}if(wi===null)throw Error(ut(160));BR(a,o,i),wi=null,No=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Pr(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)GR(e,t),e=e.sibling}function GR(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(So(e,t),Yo(t),r&4){try{zh(3,t,t.return),ty(3,t)}catch(x){Pr(t,t.return,x)}try{zh(5,t,t.return)}catch(x){Pr(t,t.return,x)}}break;case 1:So(e,t),Yo(t),r&512&&n!==null&&tf(n,n.return);break;case 5:if(So(e,t),Yo(t),r&512&&n!==null&&tf(n,n.return),t.flags&32){var i=t.stateNode;try{ug(i,"")}catch(x){Pr(t,t.return,x)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,s=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&cN(i,a),lC(s,o);var c=lC(s,a);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?gN(i,f):d==="dangerouslySetInnerHTML"?dN(i,f):d==="children"?ug(i,f):lS(i,d,f,c)}switch(s){case"input":rC(i,a);break;case"textarea":uN(i,a);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;p!=null?gf(i,!!a.multiple,p,!1):h!==!!a.multiple&&(a.defaultValue!=null?gf(i,!!a.multiple,a.defaultValue,!0):gf(i,!!a.multiple,a.multiple?[]:"",!1))}i[wg]=a}catch(x){Pr(t,t.return,x)}}break;case 6:if(So(e,t),Yo(t),r&4){if(t.stateNode===null)throw Error(ut(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(x){Pr(t,t.return,x)}}break;case 3:if(So(e,t),Yo(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{gg(e.containerInfo)}catch(x){Pr(t,t.return,x)}break;case 4:So(e,t),Yo(t);break;case 13:So(e,t),Yo(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(GS=zr())),r&4&&dI(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(ki=(c=ki)||d,So(e,t),ki=c):So(e,t),Yo(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!d&&t.mode&1)for(Rt=t,d=t.child;d!==null;){for(f=Rt=d;Rt!==null;){switch(h=Rt,p=h.child,h.tag){case 0:case 11:case 14:case 15:zh(4,h,h.return);break;case 1:tf(h,h.return);var C=h.stateNode;if(typeof C.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(x){Pr(r,n,x)}}break;case 5:tf(h,h.return);break;case 22:if(h.memoizedState!==null){gI(f);continue}}p!==null?(p.return=h,Rt=p):gI(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{i=f.stateNode,c?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=hN("display",o))}catch(x){Pr(t,t.return,x)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(x){Pr(t,t.return,x)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:So(e,t),Yo(t),r&4&&dI(t);break;case 21:break;default:So(e,t),Yo(t)}}function Yo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(UR(n)){var r=n;break e}n=n.return}throw Error(ut(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ug(i,""),r.flags&=-33);var a=fI(t);VC(t,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,s=fI(t);FC(t,s,o);break;default:throw Error(ut(161))}}catch(l){Pr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function yJ(t,e,n){Rt=t,zR(t)}function zR(t,e,n){for(var r=(t.mode&1)!==0;Rt!==null;){var i=Rt,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Q1;if(!o){var s=i.alternate,l=s!==null&&s.memoizedState!==null||ki;s=Q1;var c=ki;if(Q1=o,(ki=l)&&!c)for(Rt=i;Rt!==null;)o=Rt,l=o.child,o.tag===22&&o.memoizedState!==null?pI(i):l!==null?(l.return=o,Rt=l):pI(i);for(;a!==null;)Rt=a,zR(a),a=a.sibling;Rt=i,Q1=s,ki=c}hI(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Rt=a):hI(t)}}function hI(t){for(;Rt!==null;){var e=Rt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ki||ty(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ki)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Io(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&Jb(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Jb(e,o,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&gg(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ut(163))}ki||e.flags&512&&PC(e)}catch(h){Pr(e,e.return,h)}}if(e===t){Rt=null;break}if(n=e.sibling,n!==null){n.return=e.return,Rt=n;break}Rt=e.return}}function gI(t){for(;Rt!==null;){var e=Rt;if(e===t){Rt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Rt=n;break}Rt=e.return}}function pI(t){for(;Rt!==null;){var e=Rt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ty(4,e)}catch(l){Pr(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Pr(e,i,l)}}var a=e.return;try{PC(e)}catch(l){Pr(e,a,l)}break;case 5:var o=e.return;try{PC(e)}catch(l){Pr(e,o,l)}}}catch(l){Pr(e,e.return,l)}if(e===t){Rt=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Rt=s;break}Rt=e.return}}var wJ=Math.ceil,Lv=ll.ReactCurrentDispatcher,US=ll.ReactCurrentOwner,ao=ll.ReactCurrentBatchConfig,Vn=0,hi=null,qr=null,Ei=0,Oa=0,nf=hc(0),ai=0,_g=null,ku=0,ny=0,BS=0,Wh=null,ha=null,GS=0,Nf=1/0,Vs=null,kv=!1,UC=null,ec=null,em=!1,zl=null,Pv=0,jh=0,BC=null,Km=-1,qm=0;function na(){return Vn&6?zr():Km!==-1?Km:Km=zr()}function tc(t){return t.mode&1?Vn&2&&Ei!==0?Ei&-Ei:nJ.transition!==null?(qm===0&&(qm=DN()),qm):(t=Yn,t!==0||(t=window.event,t=t===void 0?16:AN(t.type)),t):1}function Uo(t,e,n,r){if(50<jh)throw jh=0,BC=null,Error(ut(185));np(t,n,r),(!(Vn&2)||t!==hi)&&(t===hi&&(!(Vn&2)&&(ny|=n),ai===4&&Pl(t,Ei)),ya(t,r),n===1&&Vn===0&&!(e.mode&1)&&(Nf=zr()+500,Z2&&gc()))}function ya(t,e){var n=t.callbackNode;nY(t,e);var r=wv(t,t===hi?Ei:0);if(r===0)n!==null&&Tb(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Tb(n),e===1)t.tag===0?tJ(mI.bind(null,t)):ZN(mI.bind(null,t)),JY(function(){!(Vn&6)&&gc()}),n=null;else{switch(bN(r)){case 1:n=hS;break;case 4:n=TN;break;case 16:n=yv;break;case 536870912:n=_N;break;default:n=yv}n=YR(n,WR.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function WR(t,e){if(Km=-1,qm=0,Vn&6)throw Error(ut(327));var n=t.callbackNode;if(wf()&&t.callbackNode!==n)return null;var r=wv(t,t===hi?Ei:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Fv(t,r);else{e=r;var i=Vn;Vn|=2;var a=HR();(hi!==t||Ei!==e)&&(Vs=null,Nf=zr()+500,Eu(t,e));do try{SJ();break}catch(s){jR(t,s)}while(!0);DS(),Lv.current=a,Vn=i,qr!==null?e=0:(hi=null,Ei=0,e=ai)}if(e!==0){if(e===2&&(i=hC(t),i!==0&&(r=i,e=GC(t,i))),e===1)throw n=_g,Eu(t,0),Pl(t,r),ya(t,zr()),n;if(e===6)Pl(t,r);else{if(i=t.current.alternate,!(r&30)&&!CJ(i)&&(e=Fv(t,r),e===2&&(a=hC(t),a!==0&&(r=a,e=GC(t,a))),e===1))throw n=_g,Eu(t,0),Pl(t,r),ya(t,zr()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ut(345));case 2:cu(t,ha,Vs);break;case 3:if(Pl(t,r),(r&130023424)===r&&(e=GS+500-zr(),10<e)){if(wv(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){na(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=xC(cu.bind(null,t,ha,Vs),e);break}cu(t,ha,Vs);break;case 4:if(Pl(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Vo(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=zr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wJ(r/1960))-r,10<r){t.timeoutHandle=xC(cu.bind(null,t,ha,Vs),r);break}cu(t,ha,Vs);break;case 5:cu(t,ha,Vs);break;default:throw Error(ut(329))}}}return ya(t,zr()),t.callbackNode===n?WR.bind(null,t):null}function GC(t,e){var n=Wh;return t.current.memoizedState.isDehydrated&&(Eu(t,e).flags|=256),t=Fv(t,e),t!==2&&(e=ha,ha=n,e!==null&&zC(e)),t}function zC(t){ha===null?ha=t:ha.push.apply(ha,t)}function CJ(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Bo(a(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Pl(t,e){for(e&=~BS,e&=~ny,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Vo(e),r=1<<n;t[n]=-1,e&=~r}}function mI(t){if(Vn&6)throw Error(ut(327));wf();var e=wv(t,0);if(!(e&1))return ya(t,zr()),null;var n=Fv(t,e);if(t.tag!==0&&n===2){var r=hC(t);r!==0&&(e=r,n=GC(t,r))}if(n===1)throw n=_g,Eu(t,0),Pl(t,e),ya(t,zr()),n;if(n===6)throw Error(ut(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,cu(t,ha,Vs),ya(t,zr()),null}function zS(t,e){var n=Vn;Vn|=1;try{return t(e)}finally{Vn=n,Vn===0&&(Nf=zr()+500,Z2&&gc())}}function Pu(t){zl!==null&&zl.tag===0&&!(Vn&6)&&wf();var e=Vn;Vn|=1;var n=ao.transition,r=Yn;try{if(ao.transition=null,Yn=1,t)return t()}finally{Yn=r,ao.transition=n,Vn=e,!(Vn&6)&&gc()}}function WS(){Oa=nf.current,pr(nf)}function Eu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,YY(n)),qr!==null)for(n=qr.return;n!==null;){var r=n;switch(ES(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Tv();break;case 3:Of(),pr(ma),pr(Bi),RS();break;case 5:NS(r);break;case 4:Of();break;case 13:pr(Ir);break;case 19:pr(Ir);break;case 10:bS(r.type._context);break;case 22:case 23:WS()}n=n.return}if(hi=t,qr=t=nc(t.current,null),Ei=Oa=e,ai=0,_g=null,BS=ny=ku=0,ha=Wh=null,vu!==null){for(e=0;e<vu.length;e++)if(n=vu[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}vu=null}return t}function jR(t,e){do{var n=qr;try{if(DS(),jm.current=Av,Rv){for(var r=Mr.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Rv=!1}if(Lu=0,di=ii=Mr=null,Gh=!1,Sg=0,US.current=null,n===null||n.return===null){ai=1,_g=e,qr=null;break}e:{var a=t,o=n.return,s=n,l=e;if(e=Ei,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=s,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=rI(o);if(p!==null){p.flags&=-257,iI(p,o,s,a,e),p.mode&1&&nI(a,c,e),e=p,l=c;var C=e.updateQueue;if(C===null){var x=new Set;x.add(l),e.updateQueue=x}else C.add(l);break e}else{if(!(e&1)){nI(a,c,e),jS();break e}l=Error(ut(426))}}else if(_r&&s.mode&1){var T=rI(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),iI(T,o,s,a,e),TS(Mf(l,s));break e}}a=l=Mf(l,s),ai!==4&&(ai=2),Wh===null?Wh=[a]:Wh.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var _=bR(a,l,e);Yb(a,_);break e;case 1:s=l;var y=a.type,w=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(ec===null||!ec.has(w)))){a.flags|=65536,e&=-e,a.lanes|=e;var b=IR(a,s,e);Yb(a,b);break e}}a=a.return}while(a!==null)}KR(n)}catch(M){e=M,qr===n&&n!==null&&(qr=n=n.return);continue}break}while(!0)}function HR(){var t=Lv.current;return Lv.current=Av,t===null?Av:t}function jS(){(ai===0||ai===3||ai===2)&&(ai=4),hi===null||!(ku&268435455)&&!(ny&268435455)||Pl(hi,Ei)}function Fv(t,e){var n=Vn;Vn|=2;var r=HR();(hi!==t||Ei!==e)&&(Vs=null,Eu(t,e));do try{xJ();break}catch(i){jR(t,i)}while(!0);if(DS(),Vn=n,Lv.current=r,qr!==null)throw Error(ut(261));return hi=null,Ei=0,ai}function xJ(){for(;qr!==null;)$R(qr)}function SJ(){for(;qr!==null&&!KX();)$R(qr)}function $R(t){var e=XR(t.alternate,t,Oa);t.memoizedProps=t.pendingProps,e===null?KR(t):qr=e,US.current=null}function KR(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=pJ(n,e),n!==null){n.flags&=32767,qr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ai=6,qr=null;return}}else if(n=gJ(n,e,Oa),n!==null){qr=n;return}if(e=e.sibling,e!==null){qr=e;return}qr=e=t}while(e!==null);ai===0&&(ai=5)}function cu(t,e,n){var r=Yn,i=ao.transition;try{ao.transition=null,Yn=1,EJ(t,e,n,r)}finally{ao.transition=i,Yn=r}return null}function EJ(t,e,n,r){do wf();while(zl!==null);if(Vn&6)throw Error(ut(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ut(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(rY(t,a),t===hi&&(qr=hi=null,Ei=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||em||(em=!0,YR(yv,function(){return wf(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=ao.transition,ao.transition=null;var o=Yn;Yn=1;var s=Vn;Vn|=4,US.current=null,vJ(t,n),GR(n,t),WY(wC),Cv=!!yC,wC=yC=null,t.current=n,yJ(n),qX(),Vn=s,Yn=o,ao.transition=a}else t.current=n;if(em&&(em=!1,zl=t,Pv=i),a=t.pendingLanes,a===0&&(ec=null),JX(n.stateNode),ya(t,zr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(kv)throw kv=!1,t=UC,UC=null,t;return Pv&1&&t.tag!==0&&wf(),a=t.pendingLanes,a&1?t===BC?jh++:(jh=0,BC=t):jh=0,gc(),null}function wf(){if(zl!==null){var t=bN(Pv),e=ao.transition,n=Yn;try{if(ao.transition=null,Yn=16>t?16:t,zl===null)var r=!1;else{if(t=zl,zl=null,Pv=0,Vn&6)throw Error(ut(331));var i=Vn;for(Vn|=4,Rt=t.current;Rt!==null;){var a=Rt,o=a.child;if(Rt.flags&16){var s=a.deletions;if(s!==null){for(var l=0;l<s.length;l++){var c=s[l];for(Rt=c;Rt!==null;){var d=Rt;switch(d.tag){case 0:case 11:case 15:zh(8,d,a)}var f=d.child;if(f!==null)f.return=d,Rt=f;else for(;Rt!==null;){d=Rt;var h=d.sibling,p=d.return;if(VR(d),d===c){Rt=null;break}if(h!==null){h.return=p,Rt=h;break}Rt=p}}}var C=a.alternate;if(C!==null){var x=C.child;if(x!==null){C.child=null;do{var T=x.sibling;x.sibling=null,x=T}while(x!==null)}}Rt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Rt=o;else e:for(;Rt!==null;){if(a=Rt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:zh(9,a,a.return)}var _=a.sibling;if(_!==null){_.return=a.return,Rt=_;break e}Rt=a.return}}var y=t.current;for(Rt=y;Rt!==null;){o=Rt;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,Rt=w;else e:for(o=y;Rt!==null;){if(s=Rt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:ty(9,s)}}catch(M){Pr(s,s.return,M)}if(s===o){Rt=null;break e}var b=s.sibling;if(b!==null){b.return=s.return,Rt=b;break e}Rt=s.return}}if(Vn=i,gc(),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(K2,t)}catch{}r=!0}return r}finally{Yn=n,ao.transition=e}}return!1}function vI(t,e,n){e=Mf(n,e),e=bR(t,e,1),t=Ql(t,e,1),e=na(),t!==null&&(np(t,1,e),ya(t,e))}function Pr(t,e,n){if(t.tag===3)vI(t,t,n);else for(;e!==null;){if(e.tag===3){vI(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ec===null||!ec.has(r))){t=Mf(n,t),t=IR(e,t,1),e=Ql(e,t,1),t=na(),e!==null&&(np(e,1,t),ya(e,t));break}}e=e.return}}function TJ(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=na(),t.pingedLanes|=t.suspendedLanes&n,hi===t&&(Ei&n)===n&&(ai===4||ai===3&&(Ei&130023424)===Ei&&500>zr()-GS?Eu(t,0):BS|=n),ya(t,e)}function qR(t,e){e===0&&(t.mode&1?(e=j1,j1<<=1,!(j1&130023424)&&(j1=4194304)):e=1);var n=na();t=Qs(t,e),t!==null&&(np(t,e,n),ya(t,n))}function _J(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),qR(t,n)}function DJ(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ut(314))}r!==null&&r.delete(e),qR(t,n)}var XR;XR=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ma.current)ga=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ga=!1,hJ(t,e,n);ga=!!(t.flags&131072)}else ga=!1,_r&&e.flags&1048576&&QN(e,bv,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$m(t,e),t=e.pendingProps;var i=Df(e,Bi.current);yf(e,n),i=LS(null,e,r,t,i,n);var a=kS();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,va(r)?(a=!0,_v(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,OS(e),i.updater=ey,e.stateNode=i,i._reactInternals=e,IC(e,r,t,n),e=NC(null,e,r,!0,a,n)):(e.tag=0,_r&&a&&SS(e),Qi(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch($m(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=IJ(r),t=Io(r,t),i){case 0:e=MC(null,e,r,t,n);break e;case 1:e=sI(null,e,r,t,n);break e;case 11:e=aI(null,e,r,t,n);break e;case 14:e=oI(null,e,r,Io(r.type,t),n);break e}throw Error(ut(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),MC(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),sI(t,e,r,i,n);case 3:e:{if(RR(e),t===null)throw Error(ut(387));r=e.pendingProps,a=e.memoizedState,i=a.element,aR(t,e),Mv(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=Mf(Error(ut(423)),e),e=lI(t,e,r,n,i);break e}else if(r!==i){i=Mf(Error(ut(424)),e),e=lI(t,e,r,n,i);break e}else for(Aa=Zl(e.stateNode.containerInfo.firstChild),La=e,_r=!0,Ao=null,n=rR(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bf(),r===i){e=el(t,e,n);break e}Qi(t,e,r,n)}e=e.child}return e;case 5:return oR(e),t===null&&_C(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,CC(r,i)?o=null:a!==null&&CC(r,a)&&(e.flags|=32),NR(t,e),Qi(t,e,o,n),e.child;case 6:return t===null&&_C(e),null;case 13:return AR(t,e,n);case 4:return MS(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=If(e,null,r,n):Qi(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),aI(t,e,r,i,n);case 7:return Qi(t,e,e.pendingProps,n),e.child;case 8:return Qi(t,e,e.pendingProps.children,n),e.child;case 12:return Qi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,lr(Iv,r._currentValue),r._currentValue=o,a!==null)if(Bo(a.value,o)){if(a.children===i.children&&!ma.current){e=el(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var l=s.firstContext;l!==null;){if(l.context===r){if(a.tag===1){l=Ks(-1,n&-n),l.tag=2;var c=a.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),DC(a.return,n,e),s.lanes|=n;break}l=l.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(ut(341));o.lanes|=n,s=o.alternate,s!==null&&(s.lanes|=n),DC(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}Qi(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,yf(e,n),i=lo(i),r=r(i),e.flags|=1,Qi(t,e,r,n),e.child;case 14:return r=e.type,i=Io(r,e.pendingProps),i=Io(r.type,i),oI(t,e,r,i,n);case 15:return OR(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),$m(t,e),e.tag=1,va(r)?(t=!0,_v(e)):t=!1,yf(e,n),DR(e,r,i),IC(e,r,i,n),NC(null,e,r,!0,t,n);case 19:return LR(t,e,n);case 22:return MR(t,e,n)}throw Error(ut(156,e.tag))};function YR(t,e){return EN(t,e)}function bJ(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function no(t,e,n,r){return new bJ(t,e,n,r)}function HS(t){return t=t.prototype,!(!t||!t.isReactComponent)}function IJ(t){if(typeof t=="function")return HS(t)?1:0;if(t!=null){if(t=t.$$typeof,t===uS)return 11;if(t===fS)return 14}return 2}function nc(t,e){var n=t.alternate;return n===null?(n=no(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Xm(t,e,n,r,i,a){var o=2;if(r=t,typeof t=="function")HS(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case $0:return Tu(n.children,i,a,e);case cS:o=8,i|=8;break;case Z4:return t=no(12,n,e,i|2),t.elementType=Z4,t.lanes=a,t;case Q4:return t=no(13,n,e,i),t.elementType=Q4,t.lanes=a,t;case eC:return t=no(19,n,e,i),t.elementType=eC,t.lanes=a,t;case oN:return ry(n,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case iN:o=10;break e;case aN:o=9;break e;case uS:o=11;break e;case fS:o=14;break e;case Nl:o=16,r=null;break e}throw Error(ut(130,t==null?t:typeof t,""))}return e=no(o,n,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function Tu(t,e,n,r){return t=no(7,t,r,e),t.lanes=n,t}function ry(t,e,n,r){return t=no(22,t,r,e),t.elementType=oN,t.lanes=n,t.stateNode={isHidden:!1},t}function o4(t,e,n){return t=no(6,t,null,e),t.lanes=n,t}function s4(t,e,n){return e=no(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function OJ(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gw(0),this.expirationTimes=Gw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gw(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function $S(t,e,n,r,i,a,o,s,l){return t=new OJ(t,e,n,s,l),e===1?(e=1,a===!0&&(e|=8)):e=0,a=no(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},OS(a),t}function MJ(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H0,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function JR(t){if(!t)return oc;t=t._reactInternals;e:{if(Gu(t)!==t||t.tag!==1)throw Error(ut(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(va(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ut(171))}if(t.tag===1){var n=t.type;if(va(n))return JN(t,n,e)}return e}function ZR(t,e,n,r,i,a,o,s,l){return t=$S(n,r,!0,t,i,a,o,s,l),t.context=JR(null),n=t.current,r=na(),i=tc(n),a=Ks(r,i),a.callback=e??null,Ql(n,a,i),t.current.lanes=i,np(t,i,r),ya(t,r),t}function iy(t,e,n,r){var i=e.current,a=na(),o=tc(i);return n=JR(n),e.context===null?e.context=n:e.pendingContext=n,e=Ks(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ql(i,e,o),t!==null&&(Uo(t,i,o,a),Wm(t,i,o)),o}function Vv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function yI(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function KS(t,e){yI(t,e),(t=t.alternate)&&yI(t,e)}function NJ(){return null}var QR=typeof reportError=="function"?reportError:function(t){console.error(t)};function qS(t){this._internalRoot=t}ay.prototype.render=qS.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ut(409));iy(t,e,null,null)};ay.prototype.unmount=qS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Pu(function(){iy(null,t,null,null)}),e[Zs]=null}};function ay(t){this._internalRoot=t}ay.prototype.unstable_scheduleHydration=function(t){if(t){var e=MN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<kl.length&&e!==0&&e<kl[n].priority;n++);kl.splice(n,0,t),n===0&&RN(t)}};function XS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function oy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function wI(){}function RJ(t,e,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var c=Vv(o);a.call(c)}}var o=ZR(e,r,t,0,null,!1,!1,"",wI);return t._reactRootContainer=o,t[Zs]=o.current,vg(t.nodeType===8?t.parentNode:t),Pu(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var c=Vv(l);s.call(c)}}var l=$S(t,0,!1,null,null,!1,!1,"",wI);return t._reactRootContainer=l,t[Zs]=l.current,vg(t.nodeType===8?t.parentNode:t),Pu(function(){iy(e,l,n,r)}),l}function sy(t,e,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var l=Vv(o);s.call(l)}}iy(e,o,t,i)}else o=RJ(n,e,t,i,r);return Vv(o)}IN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=bh(e.pendingLanes);n!==0&&(gS(e,n|1),ya(e,zr()),!(Vn&6)&&(Nf=zr()+500,gc()))}break;case 13:Pu(function(){var r=Qs(t,1);if(r!==null){var i=na();Uo(r,t,1,i)}}),KS(t,1)}};pS=function(t){if(t.tag===13){var e=Qs(t,134217728);if(e!==null){var n=na();Uo(e,t,134217728,n)}KS(t,134217728)}};ON=function(t){if(t.tag===13){var e=tc(t),n=Qs(t,e);if(n!==null){var r=na();Uo(n,t,e,r)}KS(t,e)}};MN=function(){return Yn};NN=function(t,e){var n=Yn;try{return Yn=t,e()}finally{Yn=n}};uC=function(t,e,n){switch(e){case"input":if(rC(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=J2(r);if(!i)throw Error(ut(90));lN(r),rC(r,i)}}}break;case"textarea":uN(t,n);break;case"select":e=n.value,e!=null&&gf(t,!!n.multiple,e,!1)}};vN=zS;yN=Pu;var AJ={usingClientEntryPoint:!1,Events:[ip,Y0,J2,pN,mN,zS]},mh={findFiberByHostInstance:mu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},LJ={bundleType:mh.bundleType,version:mh.version,rendererPackageName:mh.rendererPackageName,rendererConfig:mh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ll.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=xN(t),t===null?null:t.stateNode},findFiberByHostInstance:mh.findFiberByHostInstance||NJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tm.isDisabled&&tm.supportsFiber)try{K2=tm.inject(LJ),us=tm}catch{}}Fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AJ;Fa.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!XS(e))throw Error(ut(200));return MJ(t,e,null,n)};Fa.createRoot=function(t,e){if(!XS(t))throw Error(ut(299));var n=!1,r="",i=QR;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=$S(t,1,!1,null,null,n,!1,r,i),t[Zs]=e.current,vg(t.nodeType===8?t.parentNode:t),new qS(e)};Fa.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ut(188)):(t=Object.keys(t).join(","),Error(ut(268,t)));return t=xN(e),t=t===null?null:t.stateNode,t};Fa.flushSync=function(t){return Pu(t)};Fa.hydrate=function(t,e,n){if(!oy(e))throw Error(ut(200));return sy(null,t,e,!0,n)};Fa.hydrateRoot=function(t,e,n){if(!XS(t))throw Error(ut(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=QR;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=ZR(e,null,t,1,n??null,i,!1,a,o),t[Zs]=e.current,vg(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new ay(e)};Fa.render=function(t,e,n){if(!oy(e))throw Error(ut(200));return sy(null,t,e,!1,n)};Fa.unmountComponentAtNode=function(t){if(!oy(t))throw Error(ut(40));return t._reactRootContainer?(Pu(function(){sy(null,null,t,!1,function(){t._reactRootContainer=null,t[Zs]=null})}),!0):!1};Fa.unstable_batchedUpdates=zS;Fa.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!oy(n))throw Error(ut(200));if(t==null||t._reactInternals===void 0)throw Error(ut(38));return sy(t,e,n,!1,r)};Fa.version="18.3.1-next-f1338f8080-20240426";function eA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eA)}catch(t){console.error(t)}}eA(),eN.exports=Fa;var kJ=eN.exports,CI=kJ;Y4.createRoot=CI.createRoot,Y4.hydrateRoot=CI.hydrateRoot;/**
 * @remix-run/router v1.18.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dg(){return Dg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Dg.apply(this,arguments)}var Wl;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Wl||(Wl={}));const xI="popstate";function PJ(t){t===void 0&&(t={});function e(i,a){let{pathname:o="/",search:s="",hash:l=""}=zu(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),WC("",{pathname:o,search:s,hash:l},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(i,a){let o=i.document.querySelector("base"),s="";if(o&&o.getAttribute("href")){let l=i.location.href,c=l.indexOf("#");s=c===-1?l:l.slice(0,c)}return s+"#"+(typeof a=="string"?a:tA(a))}function r(i,a){YS(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return VJ(e,n,r,t)}function oi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function YS(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function FJ(){return Math.random().toString(36).substr(2,8)}function SI(t,e){return{usr:t.state,key:t.key,idx:e}}function WC(t,e,n,r){return n===void 0&&(n=null),Dg({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?zu(e):e,{state:n,key:e&&e.key||r||FJ()})}function tA(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function zu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function VJ(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,s=Wl.Pop,l=null,c=d();c==null&&(c=0,o.replaceState(Dg({},o.state,{idx:c}),""));function d(){return(o.state||{idx:null}).idx}function f(){s=Wl.Pop;let T=d(),_=T==null?null:T-c;c=T,l&&l({action:s,location:x.location,delta:_})}function h(T,_){s=Wl.Push;let y=WC(x.location,T,_);n&&n(y,T),c=d()+1;let w=SI(y,c),b=x.createHref(y);try{o.pushState(w,"",b)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(b)}a&&l&&l({action:s,location:x.location,delta:1})}function p(T,_){s=Wl.Replace;let y=WC(x.location,T,_);n&&n(y,T),c=d();let w=SI(y,c),b=x.createHref(y);o.replaceState(w,"",b),a&&l&&l({action:s,location:x.location,delta:0})}function C(T){let _=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof T=="string"?T:tA(T);return y=y.replace(/ $/,"%20"),oi(_,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,_)}let x={get action(){return s},get location(){return t(i,o)},listen(T){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(xI,f),l=T,()=>{i.removeEventListener(xI,f),l=null}},createHref(T){return e(i,T)},createURL:C,encodeLocation(T){let _=C(T);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:h,replace:p,go(T){return o.go(T)}};return x}var EI;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(EI||(EI={}));function UJ(t,e,n){return n===void 0&&(n="/"),BJ(t,e,n,!1)}function BJ(t,e,n,r){let i=typeof e=="string"?zu(e):e,a=iA(i.pathname||"/",n);if(a==null)return null;let o=nA(t);GJ(o);let s=null;for(let l=0;s==null&&l<o.length;++l){let c=ZJ(a);s=YJ(o[l],c,r)}return s}function nA(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(a,o,s)=>{let l={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};l.relativePath.startsWith("/")&&(oi(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=_u([r,l.relativePath]),d=n.concat(l);a.children&&a.children.length>0&&(oi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),nA(a.children,e,d,c)),!(a.path==null&&!a.index)&&e.push({path:c,score:qJ(c,a.index),routesMeta:d})};return t.forEach((a,o)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))i(a,o);else for(let l of rA(a.path))i(a,o,l)}),e}function rA(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return i?[a,""]:[a];let o=rA(r.join("/")),s=[];return s.push(...o.map(l=>l===""?a:[a,l].join("/"))),i&&s.push(...o),s.map(l=>t.startsWith("/")&&l===""?"/":l)}function GJ(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:XJ(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const zJ=/^:[\w-]+$/,WJ=3,jJ=2,HJ=1,$J=10,KJ=-2,TI=t=>t==="*";function qJ(t,e){let n=t.split("/"),r=n.length;return n.some(TI)&&(r+=KJ),e&&(r+=jJ),n.filter(i=>!TI(i)).reduce((i,a)=>i+(zJ.test(a)?WJ:a===""?HJ:$J),r)}function XJ(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function YJ(t,e,n){let{routesMeta:r}=t,i={},a="/",o=[];for(let s=0;s<r.length;++s){let l=r[s],c=s===r.length-1,d=a==="/"?e:e.slice(a.length)||"/",f=_I({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),h=l.route;if(!f&&c&&n&&!r[r.length-1].route.index&&(f=_I({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:_u([a,f.pathname]),pathnameBase:iZ(_u([a,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(a=_u([a,f.pathnameBase]))}return o}function _I(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=JJ(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((c,d,f)=>{let{paramName:h,isOptional:p}=d;if(h==="*"){let x=s[f]||"";o=a.slice(0,a.length-x.length).replace(/(.)\/+$/,"$1")}const C=s[f];return p&&!C?c[h]=void 0:c[h]=(C||"").replace(/%2F/g,"/"),c},{}),pathname:a,pathnameBase:o,pattern:t}}function JJ(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),YS(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,s,l)=>(r.push({paramName:s,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function ZJ(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return YS(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function iA(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function QJ(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?zu(t):t;return{pathname:n?n.startsWith("/")?n:eZ(n,e):e,search:aZ(r),hash:oZ(i)}}function eZ(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function l4(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tZ(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function nZ(t,e){let n=tZ(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function rZ(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=zu(t):(i=Dg({},t),oi(!i.pathname||!i.pathname.includes("?"),l4("?","pathname","search",i)),oi(!i.pathname||!i.pathname.includes("#"),l4("#","pathname","hash",i)),oi(!i.search||!i.search.includes("#"),l4("#","search","hash",i)));let a=t===""||i.pathname==="",o=a?"/":i.pathname,s;if(o==null)s=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),f-=1;i.pathname=h.join("/")}s=f>=0?e[f]:"/"}let l=QJ(i,s),c=o&&o!=="/"&&o.endsWith("/"),d=(a||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}const _u=t=>t.join("/").replace(/\/\/+/g,"/"),iZ=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),aZ=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,oZ=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function sZ(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const aA=["post","put","patch","delete"];new Set(aA);const lZ=["get",...aA];new Set(lZ);/**
 * React Router v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bg(){return bg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},bg.apply(this,arguments)}const JS=vt.createContext(null),cZ=vt.createContext(null),ly=vt.createContext(null),cy=vt.createContext(null),Xf=vt.createContext({outlet:null,matches:[],isDataRoute:!1}),oA=vt.createContext(null);function uy(){return vt.useContext(cy)!=null}function ZS(){return uy()||oi(!1),vt.useContext(cy).location}function sA(t){vt.useContext(ly).static||vt.useLayoutEffect(t)}function lA(){let{isDataRoute:t}=vt.useContext(Xf);return t?SZ():uZ()}function uZ(){uy()||oi(!1);let t=vt.useContext(JS),{basename:e,future:n,navigator:r}=vt.useContext(ly),{matches:i}=vt.useContext(Xf),{pathname:a}=ZS(),o=JSON.stringify(nZ(i,n.v7_relativeSplatPath)),s=vt.useRef(!1);return sA(()=>{s.current=!0}),vt.useCallback(function(c,d){if(d===void 0&&(d={}),!s.current)return;if(typeof c=="number"){r.go(c);return}let f=rZ(c,JSON.parse(o),a,d.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:_u([e,f.pathname])),(d.replace?r.replace:r.push)(f,d.state,d)},[e,r,o,a,t])}function fZ(t,e){return dZ(t,e)}function dZ(t,e,n,r){uy()||oi(!1);let{navigator:i}=vt.useContext(ly),{matches:a}=vt.useContext(Xf),o=a[a.length-1],s=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=ZS(),d;if(e){var f;let T=typeof e=="string"?zu(e):e;l==="/"||(f=T.pathname)!=null&&f.startsWith(l)||oi(!1),d=T}else d=c;let h=d.pathname||"/",p=h;if(l!=="/"){let T=l.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(T.length).join("/")}let C=UJ(t,{pathname:p}),x=vZ(C&&C.map(T=>Object.assign({},T,{params:Object.assign({},s,T.params),pathname:_u([l,i.encodeLocation?i.encodeLocation(T.pathname).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?l:_u([l,i.encodeLocation?i.encodeLocation(T.pathnameBase).pathname:T.pathnameBase])})),a,n,r);return e&&x?vt.createElement(cy.Provider,{value:{location:bg({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Wl.Pop}},x):x}function hZ(){let t=xZ(),e=sZ(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return vt.createElement(vt.Fragment,null,vt.createElement("h2",null,"Unexpected Application Error!"),vt.createElement("h3",{style:{fontStyle:"italic"}},e),n?vt.createElement("pre",{style:i},n):null,null)}const gZ=vt.createElement(hZ,null);class pZ extends vt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?vt.createElement(Xf.Provider,{value:this.props.routeContext},vt.createElement(oA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function mZ(t){let{routeContext:e,match:n,children:r}=t,i=vt.useContext(JS);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),vt.createElement(Xf.Provider,{value:e},r)}function vZ(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var a;if((a=n)!=null&&a.errors)t=n.matches;else return null}let o=t,s=(i=n)==null?void 0:i.errors;if(s!=null){let d=o.findIndex(f=>f.route.id&&(s==null?void 0:s[f.route.id])!==void 0);d>=0||oi(!1),o=o.slice(0,Math.min(o.length,d+1))}let l=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<o.length;d++){let f=o[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=d),f.route.id){let{loaderData:h,errors:p}=n,C=f.route.loader&&h[f.route.id]===void 0&&(!p||p[f.route.id]===void 0);if(f.route.lazy||C){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((d,f,h)=>{let p,C=!1,x=null,T=null;n&&(p=s&&f.route.id?s[f.route.id]:void 0,x=f.route.errorElement||gZ,l&&(c<0&&h===0?(C=!0,T=null):c===h&&(C=!0,T=f.route.hydrateFallbackElement||null)));let _=e.concat(o.slice(0,h+1)),y=()=>{let w;return p?w=x:C?w=T:f.route.Component?w=vt.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,vt.createElement(mZ,{match:f,routeContext:{outlet:d,matches:_,isDataRoute:n!=null},children:w})};return n&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?vt.createElement(pZ,{location:n.location,revalidation:n.revalidation,component:x,error:p,children:y(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):y()},null)}var cA=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(cA||{}),Uv=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Uv||{});function yZ(t){let e=vt.useContext(JS);return e||oi(!1),e}function wZ(t){let e=vt.useContext(cZ);return e||oi(!1),e}function CZ(t){let e=vt.useContext(Xf);return e||oi(!1),e}function uA(t){let e=CZ(),n=e.matches[e.matches.length-1];return n.route.id||oi(!1),n.route.id}function xZ(){var t;let e=vt.useContext(oA),n=wZ(Uv.UseRouteError),r=uA(Uv.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function SZ(){let{router:t}=yZ(cA.UseNavigateStable),e=uA(Uv.UseNavigateStable),n=vt.useRef(!1);return sA(()=>{n.current=!0}),vt.useCallback(function(i,a){a===void 0&&(a={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,bg({fromRouteId:e},a)))},[t,e])}function Ym(t){oi(!1)}function EZ(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Wl.Pop,navigator:a,static:o=!1,future:s}=t;uy()&&oi(!1);let l=e.replace(/^\/*/,"/"),c=vt.useMemo(()=>({basename:l,navigator:a,static:o,future:bg({v7_relativeSplatPath:!1},s)}),[l,s,a,o]);typeof r=="string"&&(r=zu(r));let{pathname:d="/",search:f="",hash:h="",state:p=null,key:C="default"}=r,x=vt.useMemo(()=>{let T=iA(d,l);return T==null?null:{location:{pathname:T,search:f,hash:h,state:p,key:C},navigationType:i}},[l,d,f,h,p,C,i]);return x==null?null:vt.createElement(ly.Provider,{value:c},vt.createElement(cy.Provider,{children:n,value:x}))}function TZ(t){let{children:e,location:n}=t;return fZ(jC(e),n)}new Promise(()=>{});function jC(t,e){e===void 0&&(e=[]);let n=[];return vt.Children.forEach(t,(r,i)=>{if(!vt.isValidElement(r))return;let a=[...e,i];if(r.type===vt.Fragment){n.push.apply(n,jC(r.props.children,a));return}r.type!==Ym&&oi(!1),!r.props.index||!r.props.children||oi(!1);let o={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=jC(r.props.children,a)),n.push(o)}),n}/**
 * React Router DOM v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const _Z="6";try{window.__reactRouterVersion=_Z}catch{}const DZ="startTransition",DI=TX[DZ];function bZ(t){let{basename:e,children:n,future:r,window:i}=t,a=vt.useRef();a.current==null&&(a.current=PJ({window:i,v5Compat:!0}));let o=a.current,[s,l]=vt.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},d=vt.useCallback(f=>{c&&DI?DI(()=>l(f)):l(f)},[l,c]);return vt.useLayoutEffect(()=>o.listen(d),[o,d]),vt.createElement(EZ,{basename:e,children:n,location:s.location,navigationType:s.action,navigator:o,future:r})}var bI;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(bI||(bI={}));var II;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(II||(II={}));var HC;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.VOLUME_SCROLL_OUT_OF_BOUNDS="VOLUME_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED"})(HC||(HC={}));const xt=HC;var $C;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})($C||($C={}));const Tr=$C;var KC;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WholeSlide="wholeSlide"})(KC||(KC={}));const dr=KC;var qC;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(qC||(qC={}));const wu=qC,fA={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5},IZ={OFF:0,NORMALIZED:1,RAW:2};var OZ={BlendMode:fA,FilterMode:IZ},XC;(function(t){t[t.COMPOSITE=0]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"})(XC||(XC={}));const MZ=XC;var YC;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(YC||(YC={}));const jl=YC;var JC;(function(t){t.TRUE="true",t.FALSE="false",t.AUTO="auto"})(JC||(JC={}));const Al=JC;var ZC;(function(t){t.CONTOUR="contour",t.SURFACE="Surface"})(ZC||(ZC={}));const Ig=ZC;var QC;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(QC||(QC={}));const NZ=QC;var ex;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID"})(ex||(ex={}));const Du=ex;var tx;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(tx||(tx={}));const RZ=tx;var nx;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated"})(nx||(nx={}));const AZ=nx;var rx;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(rx||(rx={}));const Ma=rx;var ix;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(ix||(ix={}));const Hh=ix;var Og;(function(t){t.FRAME="f",t.SECOND="s"})(Og||(Og={}));const LZ=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return Og}},Symbol.toStringTag,{value:"Module"}));var ax;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(ax||(ax={}));const ls=ax,kZ=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:MZ,CalibrationTypes:AZ,ContourType:NZ,DynamicOperatorType:RZ,Events:xt,GeometryType:Ig,ImageQualityStatus:Hh,InterpolationType:wu,MetadataModules:ls,OrientationAxis:jl,RequestType:Tr,SharedArrayBufferModes:Al,VOILUTFunctionType:Du,VideoEnums:LZ,ViewportStatus:Ma,ViewportType:dr},Symbol.toStringTag,{value:"Module"})),PZ={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},ox=PZ,dA={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(dA);const Ra=dA,FZ=.001,sc=FZ;function hA(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&hA(r)}return Object.freeze(t)}const VZ={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1]}},UZ=hA(VZ),Hl=UZ,BZ=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],gA=BZ,GZ={slicer3D:[160/255,164/255,217/255]},zZ=GZ,WZ=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:zZ,CPU_COLORMAPS:ox,EPSILON:sc,MPR_CAMERA_VALUES:Hl,RENDERING_DEFAULTS:Ra,VIEWPORT_PRESETS:gA},Symbol.toStringTag,{value:"Module"})),vh={},Mg={get:t=>vh[t],set:t=>{const e=t.id;vh[e]=t},delete:t=>delete vh[t],getAll:()=>{const e=Object.keys(vh).map(n=>vh[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};class jZ{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=o=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,o)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){if(this.debouncedListeners[e]&&this.debouncedListeners[e][n]){const r=this.debouncedListeners[e][n];this.removeEventListener(e,r.handle),clearTimeout(r.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const HZ=new jZ,Hn=HZ;var _o;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(_o||(_o={}));class fy{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i);let s=this._children.get(o);s||(s=new fy(this._target),this._children.set(o,s)),e=e.substring(i+1),s.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i),s=this._children.get(o);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,n,r),s.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=(r==null?void 0:r.capture)??!1?_o.Capture:_o.Bubble,s=i.get(n)??_o.None;if(s&o){console.warn("A listener is already registered for this phase");return}i.set(n,s|o),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=(r==null?void 0:r.capture)??!1?_o.Capture:_o.Bubble,o=this._eventListeners.get(e);if(!o)return;(n?[n]:Array.from(o.keys())).forEach(l=>{const c=o.get(l)??_o.None;if(!!!(c&a))return;this._target.removeEventListener(e,l,r);const f=c^a;f===_o.None?o.delete(l):o.set(l,f)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=_o.Capture;for(let o=a;i;o<<=1){if(!(i&o))continue;const s=o===_o.Capture;this.removeEventListener(e,r,{capture:s}),i^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>this._unregisterAllListeners(e,n))}}class $Z{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new fy(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const KZ=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:$Z,TargetEventListeners:fy},Symbol.toStringTag,{value:"Module"}));function $h(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}var qZ=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n};const pA=Hf(qZ);var OI=Object.prototype.toString,mA=function(e){var n=OI.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&OI.call(e.callee)==="[object Function]"),r},c4,MI;function XZ(){if(MI)return c4;MI=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=mA,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(h){var p=h.constructor;return p&&p.prototype===h},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!c["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{l(window[h])}catch{return!0}}catch{return!0}return!1}(),f=function(h){if(typeof window>"u"||!d)return l(h);try{return l(h)}catch{return!1}};t=function(p){var C=p!==null&&typeof p=="object",x=n.call(p)==="[object Function]",T=r(p),_=C&&n.call(p)==="[object String]",y=[];if(!C&&!x&&!T)throw new TypeError("Object.keys called on a non-object");var w=o&&x;if(_&&p.length>0&&!e.call(p,0))for(var b=0;b<p.length;++b)y.push(String(b));if(T&&p.length>0)for(var M=0;M<p.length;++M)y.push(String(M));else for(var I in p)!(w&&I==="prototype")&&e.call(p,I)&&y.push(String(I));if(a)for(var A=f(p),k=0;k<s.length;++k)!(A&&s[k]==="constructor")&&e.call(p,s[k])&&y.push(s[k]);return y}}return c4=t,c4}var YZ=Array.prototype.slice,JZ=mA,NI=Object.keys,Jm=NI?function(e){return NI(e)}:XZ(),RI=Object.keys;Jm.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return JZ(r)?RI(YZ.call(r)):RI(r)})}else Object.keys=Jm;return Object.keys||Jm};var ZZ=Jm,QZ=Error,eQ=EvalError,tQ=RangeError,nQ=ReferenceError,vA=SyntaxError,yA=TypeError,rQ=URIError,iQ=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,n);if(o.value!==i||o.enumerable!==!0)return!1}return!0},AI=typeof Symbol<"u"&&Symbol,aQ=iQ,oQ=function(){return typeof AI!="function"||typeof Symbol!="function"||typeof AI("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:aQ()},u4={__proto__:null,foo:{}},sQ=Object,lQ=function(){return{__proto__:u4}.foo===u4.foo&&!(u4 instanceof sQ)},cQ="Function.prototype.bind called on incompatible ",uQ=Object.prototype.toString,fQ=Math.max,dQ="[object Function]",LI=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var a=0;a<n.length;a+=1)r[a+e.length]=n[a];return r},hQ=function(e,n){for(var r=[],i=n,a=0;i<e.length;i+=1,a+=1)r[a]=e[i];return r},gQ=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},pQ=function(e){var n=this;if(typeof n!="function"||uQ.apply(n)!==dQ)throw new TypeError(cQ+n);for(var r=hQ(arguments,1),i,a=function(){if(this instanceof i){var d=n.apply(this,LI(r,arguments));return Object(d)===d?d:this}return n.apply(e,LI(r,arguments))},o=fQ(0,n.length-r.length),s=[],l=0;l<o;l++)s[l]="$"+l;if(i=Function("binder","return function ("+gQ(s,",")+"){ return binder.apply(this,arguments); }")(a),n.prototype){var c=function(){};c.prototype=n.prototype,i.prototype=new c,c.prototype=null}return i},mQ=pQ,wA=Function.prototype.bind||mQ,vQ=Function.prototype.call,yQ=Object.prototype.hasOwnProperty,wQ=wA,CQ=wQ.call(vQ,yQ),Nn,xQ=QZ,SQ=eQ,EQ=tQ,TQ=nQ,Rf=vA,Cf=yA,_Q=rQ,CA=Function,f4=function(t){try{return CA('"use strict"; return ('+t+").constructor;")()}catch{}},bu=Object.getOwnPropertyDescriptor;if(bu)try{bu({},"")}catch{bu=null}var d4=function(){throw new Cf},DQ=bu?function(){try{return arguments.callee,d4}catch{try{return bu(arguments,"callee").get}catch{return d4}}}():d4,R0=oQ(),bQ=lQ(),fi=Object.getPrototypeOf||(bQ?function(t){return t.__proto__}:null),B0={},IQ=typeof Uint8Array>"u"||!fi?Nn:fi(Uint8Array),Iu={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Nn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Nn:ArrayBuffer,"%ArrayIteratorPrototype%":R0&&fi?fi([][Symbol.iterator]()):Nn,"%AsyncFromSyncIteratorPrototype%":Nn,"%AsyncFunction%":B0,"%AsyncGenerator%":B0,"%AsyncGeneratorFunction%":B0,"%AsyncIteratorPrototype%":B0,"%Atomics%":typeof Atomics>"u"?Nn:Atomics,"%BigInt%":typeof BigInt>"u"?Nn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Nn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Nn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Nn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":xQ,"%eval%":eval,"%EvalError%":SQ,"%Float32Array%":typeof Float32Array>"u"?Nn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Nn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Nn:FinalizationRegistry,"%Function%":CA,"%GeneratorFunction%":B0,"%Int8Array%":typeof Int8Array>"u"?Nn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Nn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Nn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":R0&&fi?fi(fi([][Symbol.iterator]())):Nn,"%JSON%":typeof JSON=="object"?JSON:Nn,"%Map%":typeof Map>"u"?Nn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!R0||!fi?Nn:fi(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Nn:Promise,"%Proxy%":typeof Proxy>"u"?Nn:Proxy,"%RangeError%":EQ,"%ReferenceError%":TQ,"%Reflect%":typeof Reflect>"u"?Nn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Nn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!R0||!fi?Nn:fi(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Nn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":R0&&fi?fi(""[Symbol.iterator]()):Nn,"%Symbol%":R0?Symbol:Nn,"%SyntaxError%":Rf,"%ThrowTypeError%":DQ,"%TypedArray%":IQ,"%TypeError%":Cf,"%Uint8Array%":typeof Uint8Array>"u"?Nn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Nn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Nn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Nn:Uint32Array,"%URIError%":_Q,"%WeakMap%":typeof WeakMap>"u"?Nn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Nn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Nn:WeakSet};if(fi)try{null.error}catch(t){var OQ=fi(fi(t));Iu["%Error.prototype%"]=OQ}var MQ=function t(e){var n;if(e==="%AsyncFunction%")n=f4("async function () {}");else if(e==="%GeneratorFunction%")n=f4("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=f4("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&fi&&(n=fi(i.prototype))}return Iu[e]=n,n},kI={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},op=wA,Bv=CQ,NQ=op.call(Function.call,Array.prototype.concat),RQ=op.call(Function.apply,Array.prototype.splice),PI=op.call(Function.call,String.prototype.replace),Gv=op.call(Function.call,String.prototype.slice),AQ=op.call(Function.call,RegExp.prototype.exec),LQ=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,kQ=/\\(\\)?/g,PQ=function(e){var n=Gv(e,0,1),r=Gv(e,-1);if(n==="%"&&r!=="%")throw new Rf("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new Rf("invalid intrinsic syntax, expected opening `%`");var i=[];return PI(e,LQ,function(a,o,s,l){i[i.length]=s?PI(l,kQ,"$1"):o||a}),i},FQ=function(e,n){var r=e,i;if(Bv(kI,r)&&(i=kI[r],r="%"+i[0]+"%"),Bv(Iu,r)){var a=Iu[r];if(a===B0&&(a=MQ(r)),typeof a>"u"&&!n)throw new Cf("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:a}}throw new Rf("intrinsic "+e+" does not exist!")},xA=function(e,n){if(typeof e!="string"||e.length===0)throw new Cf("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Cf('"allowMissing" argument must be a boolean');if(AQ(/^%?[^%]*%?$/,e)===null)throw new Rf("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=PQ(e),i=r.length>0?r[0]:"",a=FQ("%"+i+"%",n),o=a.name,s=a.value,l=!1,c=a.alias;c&&(i=c[0],RQ(r,NQ([0,1],c)));for(var d=1,f=!0;d<r.length;d+=1){var h=r[d],p=Gv(h,0,1),C=Gv(h,-1);if((p==='"'||p==="'"||p==="`"||C==='"'||C==="'"||C==="`")&&p!==C)throw new Rf("property names with quotes must have matching quotes");if((h==="constructor"||!f)&&(l=!0),i+="."+h,o="%"+i+"%",Bv(Iu,o))s=Iu[o];else if(s!=null){if(!(h in s)){if(!n)throw new Cf("base intrinsic for "+e+" exists, but the property is not available.");return}if(bu&&d+1>=r.length){var x=bu(s,h);f=!!x,f&&"get"in x&&!("originalValue"in x.get)?s=x.get:s=s[h]}else f=Bv(s,h),s=s[h];f&&!l&&(Iu[o]=s)}}return s},VQ=xA,Zm=VQ("%Object.defineProperty%",!0)||!1;if(Zm)try{Zm({},"a",{value:1})}catch{Zm=!1}var SA=Zm,UQ=xA,Qm=UQ("%Object.getOwnPropertyDescriptor%",!0);if(Qm)try{Qm([],"length")}catch{Qm=null}var BQ=Qm,FI=SA,GQ=vA,A0=yA,VI=BQ,zQ=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new A0("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new A0("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new A0("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new A0("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new A0("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new A0("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,l=!!VI&&VI(e,n);if(FI)FI(e,n,{configurable:o===null&&l?l.configurable:!o,enumerable:i===null&&l?l.enumerable:!i,value:r,writable:a===null&&l?l.writable:!a});else if(s||!i&&!a&&!o)e[n]=r;else throw new GQ("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},sx=SA,EA=function(){return!!sx};EA.hasArrayLengthDefineBug=function(){if(!sx)return null;try{return sx([],"length",{value:1}).length!==1}catch{return!0}};var WQ=EA,jQ=ZZ,HQ=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",$Q=Object.prototype.toString,KQ=Array.prototype.concat,UI=zQ,qQ=function(t){return typeof t=="function"&&$Q.call(t)==="[object Function]"},TA=WQ(),XQ=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!qQ(r)||!r())return}TA?UI(t,e,n,!0):UI(t,e,n)},_A=function(t,e){var n=arguments.length>2?arguments[2]:{},r=jQ(e);HQ&&(r=KQ.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)XQ(t,r[i],e[r[i]],n[r[i]])};_A.supportsDescriptors=!!TA;var DA=_A,ev={exports:{}};typeof self<"u"?ev.exports=self:typeof window<"u"?ev.exports=window:ev.exports=Function("return this")();var bA=ev.exports,YQ=bA,IA=function(){return typeof Or!="object"||!Or||Or.Math!==Math||Or.Array!==Array?YQ:Or},JQ=DA,ZQ=IA,QQ=function(){var e=ZQ();if(JQ.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},eee=DA,tee=bA,OA=IA,nee=QQ,ree=OA(),MA=function(){return ree};eee(MA,{getPolyfill:OA,implementation:tee,shim:nee});var iee=MA;const aee=Hf(iee),Lo=aee(),NA={vtkObject:()=>null};function Po(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Lo.console&&Lo.console.error&&Lo.console.error("Invalid VTK object"),null;const e=NA[t.vtkClass];if(!e)return Lo.console&&Lo.console.error&&Lo.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=Po(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function oee(t,e){NA[t]=e}Po.register=oee;class h4 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let lx=0;const RA=Symbol("void");function see(){return lx}const AA={};function du(){}const lee=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];lee.forEach(t=>{AA[t]=du});Lo.console=console.hasOwnProperty("log")?console:AA;const lc={debug:du,error:Lo.console.error||du,info:Lo.console.info||du,log:Lo.console.log||du,warn:Lo.console.warn||du};function LA(t,e){lc[t]&&(lc[t]=e||du)}function kA(){lc.log(...arguments)}function PA(){lc.info(...arguments)}function zv(){lc.debug(...arguments)}function Sn(){lc.error(...arguments)}function QS(){lc.warn(...arguments)}const BI={};function FA(t){BI[t]||(lc.error(t),BI[t]=!0)}const Gi=Object.create(null);Gi.Float32Array=Float32Array;Gi.Float64Array=Float64Array;Gi.Uint8Array=Uint8Array;Gi.Int8Array=Int8Array;Gi.Uint16Array=Uint16Array;Gi.Int16Array=Int16Array;Gi.Uint32Array=Uint32Array;Gi.Int32Array=Int32Array;Gi.Uint8ClampedArray=Uint8ClampedArray;try{Gi.BigInt64Array=BigInt64Array,Gi.BigUint64Array=BigUint64Array}catch{}function Yf(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(Gi[t]||Float64Array)(...n)}function dy(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(Gi[t]||Float64Array).from(...n)}function hy(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Fr(t){return hy(t[0]==="_"?t.slice(1):t)}function VA(t){return t.charAt(0).toLowerCase()+t.slice(1)}function UA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function BA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function GA(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function cee(t){return Object.values(Gi).some(e=>t instanceof e)}function uee(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function fee(t,e){return Object.keys(t).find(n=>t[n]===e)}function zA(t){return t&&t.isA?t.getState():t}function eE(t){setTimeout(t,0)}function WA(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function ir(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};GA(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++lx),!("classHierarchy"in e))e.classHierarchy=new h4("vtkObject");else if(!(e.classHierarchy instanceof h4)){const a=new h4;for(let o=0;o<e.classHierarchy.length;o++)a.push(e.classHierarchy[o]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function o(){r(a)}return Object.freeze({unsubscribe:o})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){Sn("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++lx,n.forEach(o=>o&&o(t)))},t.onModified=a=>{if(e.deleted)return Sn("instance deleted - cannot call any method"),null;const o=n.length;return n.push(a),i(o)},t.getMTime=()=>e.mtime,t.isA=a=>{let o=e.classHierarchy.length;for(;o--;)if(e.classHierarchy[o]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=!1;return Object.keys(a).forEach(c=>{const d=s?null:t[`set${hy(c)}`];d&&Array.isArray(a[c])&&d.length>1?l=d(...a[c])||l:d?l=d(a[c])||l:(["mtime"].indexOf(c)===-1&&!o&&QS(`Warning: Set value to model directly ${c}, ${a[c]}`),l=e[c]!==a[c]||l,e[c]=a[c])}),l},t.get=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(!o.length)return e;const l={};return o.forEach(c=>{l[c]=e[c]}),l},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,o)=>r(o)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(s=>{a[s]===null||a[s]===void 0||s[0]==="_"?delete a[s]:a[s].isA?a[s]=a[s].getState():Array.isArray(a[s])?a[s]=a[s].map(zA):cee(a[s])&&(a[s]=Array.from(a[s]))});const o={};return Object.keys(a).sort().forEach(s=>{o[s]=a[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const s=a.get(),l=Object.keys(e).sort();Object.keys(s).sort().forEach(d=>{const f=l.indexOf(d);f===-1?o&&zv(`add ${d} in shallowCopy`):l.splice(f,1),e[d]=s[d]}),l.length&&o&&zv(`Untouched keys: ${l.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const dee={object(t,e,n){return function(){return{...e[n.name]}}}};function aa(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=dee[r.type];i?t[`get${Fr(r.name)}`]=i(t,e,r):t[`get${Fr(r.name)}`]=()=>e[r.name]}else t[`get${Fr(r)}`]=()=>e[r]})}const hee={enum(t,e,n){const r=`_on${Fr(n.name)}Changed`;return i=>{var a;if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw Sn(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(o=>n.enum[o]).indexOf(i)!==-1){const o=e[n.name];return e[n.name]=i,(a=e[r])==null||a.call(e,t,e,i,o),t.modified(),!0}throw Sn(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw Sn(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){const r=`_on${Fr(n.name)}Changed`;return i=>{var a;if(!pA(e[n.name],i)){const o=e[n.name];return e[n.name]=i,(a=e[r])==null||a.call(e,t,e,i,o),t.modified(),!0}return!1}}};function GI(t){if(typeof t=="object"){const e=hee[t.type];if(e)return(n,r)=>e(n,r,t);throw Sn(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${Fr(t)}Changed`;return function(o){var s;if(r.deleted)return Sn("instance deleted - cannot call any method"),!1;if(r[t]!==o){const l=r[t.name];return r[t]=o,(s=r[i])==null||s.call(r,n,r,o,l),n.modified(),!0}return!1}}}function sp(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${Fr(r.name)}`]=GI(r)(t,e):t[`set${Fr(r)}`]=GI(r)(t,e)})}function Ur(t,e,n){aa(t,e,n),sp(t,e,n)}function Jf(t,e,n){n.forEach(r=>{t[`get${Fr(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${Fr(r)}ByReference`]=()=>e[r]})}function tE(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const o=`_on${Fr(a)}Changed`;t[`set${Fr(a)}`]=function(){var p;if(e.deleted)return Sn("instance deleted - cannot call any method"),!1;for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];let d=l,f,h=!1;if(d.length===1&&(d[0]==null||d[0].length>=0)&&(d=d[0],h=!0),d==null)f=e[a]!==d;else{if(r&&d.length!==r)if(d.length<r&&i!==void 0)for(d=Array.from(d),h=!1;d.length<r;)d.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);f=e[a]==null||e[a].length!==d.length;for(let C=0;!f&&C<d.length;++C)f=e[a][C]!==d[C];f&&h&&(d=Array.from(d))}if(f){const C=e[a.name];e[a]=d,(p=e[o])==null||p.call(e,t,e,d,C),t.modified()}return f},t[`set${Fr(a)}From`]=s=>{const l=e[a];s.forEach((c,d)=>{l[d]=c})}})}function nE(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Jf(t,e,n),tE(t,e,n,r,i)}function lp(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function rE(t,e,n,r){e.inputData?e.inputData=e.inputData.map(Po):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Po):e.inputConnection=[],e.output?e.output=e.output.map(Po):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Po):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(p){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Sn("instance deleted - cannot call any method");return}if(C>=e.numberOfInputs){Sn(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[C]!==p||e.inputConnection[C])&&(e.inputData[C]=p,e.inputConnection[C]=null,t.modified&&t.modified())}function a(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function o(p){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Sn("instance deleted - cannot call any method");return}if(C>=e.numberOfInputs){let x=`algorithm ${t.getClassName()} only has `;x+=`${e.numberOfInputs}`,x+=" input ports. To add more input ports, use addInputConnection()",Sn(x);return}e.inputData[C]=null,e.inputConnection[C]=p}function s(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function l(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function c(p){if(e.deleted){Sn("instance deleted - cannot call any method");return}o(p,l())}function d(p){if(e.deleted){Sn("instance deleted - cannot call any method");return}i(p,l())}function f(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(Sn("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{var T,_;const p=t.getMTime();let C=1/0,x=r;for(;x--;){if(!e.output[x]||e.output[x].isDeleted())return!0;const y=e.output[x].getMTime();if(y<p)return!0;y<C&&(C=y)}for(x=e.numberOfInputs;x--;)if((T=e.inputConnection[x])!=null&&T.filter.shouldUpdate()||((_=t.getInputData(x))==null?void 0:_.getMTime())>C)return!0;return!1};function h(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const C=()=>f(p);return C.filter=t,C}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=o,t.addInputData=d,t.addInputConnection=c,t.getInputData=a,t.getInputConnection=s}r&&(t.getOutputData=f,t.getOutputPort=h),t.update=()=>{const p=[];if(e.numberOfInputs){let C=0;for(;C<e.numberOfInputs;)p[C]=t.getInputData(C),C++}t.shouldUpdate()&&t.requestData&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=p=>{const C=e.inputArrayToProcess[p],x=e.inputData[p];return C&&x?x[`get${C.fieldAssociation}`]().getArray(C.arrayName):null},t.setInputArrayToProcess=function(p,C,x){let T=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:C,fieldAssociation:x,attributeType:T}}}const iE=Symbol("Event abort");function jA(t,e,n){const r=[],i=t.delete;let a=1;function o(c){for(let d=0;d<r.length;++d){const[f]=r[d];if(f===c){r.splice(d,1);return}}}function s(c){function d(){o(c)}return Object.freeze({unsubscribe:d})}function l(){if(e.deleted){Sn("instance deleted - cannot call any method");return}const c=r.slice();for(let d=0;d<c.length;++d){const[,f,h]=c[d];if(f){if(h<0)setTimeout(()=>f.apply(t,arguments),1-h);else if(f.apply(t,arguments)===iE)break}}}t[`invoke${Fr(n)}`]=l,t[`on${Fr(n)}`]=function(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!c.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return Sn("instance deleted - cannot call any method"),null;const f=a++;return r.push([f,c,d]),r.sort((h,p)=>p[2]-h[2]),s(f)},t.delete=()=>{i(),r.forEach(c=>{let[d]=c;return o(d)})}}function Ln(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&Po.register(e,n),n}function aE(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(o=>!!o).map(o=>o(...i))}}function oE(t){return t&&t.isA&&t.isA("vtkObject")}function Wv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(oE(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(o=>{const s=a[o];Array.isArray(s)?s.forEach(l=>{Wv(l,e,n,r)}):Wv(s,e,n,r)})}return n}function HA(t,e,n){var r=this;let i;const a=function(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const c=r,d=()=>{i=null,n||t.apply(c,s)},f=n&&!i;clearTimeout(i),i=setTimeout(d,e),f&&t.apply(c,s)};return a.cancel=()=>clearTimeout(i),a}function $A(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];if(n){r=s;return}n=!0,t(...s),setTimeout(i,e)}return a}function sE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let gee=1;const nm="__root__";function KA(t,e){sE(t,e);const n=t.delete;e.proxyId=`${gee++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),aa(t,e,["proxyId","proxyGroup","proxyName"]),Ur(t,e,["proxyManager"]);const r={},i={};function a(c,d){i[d]||(i[d]=[]);const f=i[d];for(let h=0;h<c.length;h++)f.push(c[h].name),r[c[h].name]=c[h],c[h].children&&c[h].children.length&&a(c[h].children,c[h].name)}a(e.ui,nm),t.updateUI=c=>{e.ui=JSON.parse(JSON.stringify(c||[])),Object.keys(r).forEach(d=>delete r[d]),Object.keys(i).forEach(d=>delete i[d]),a(e.ui,nm),t.modified()};function o(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nm;return i[c]}t.updateProxyProperty=(c,d)=>{const f=r[c];f?Object.assign(f,d):r[c]={...d}},t.activate=()=>{if(e.proxyManager){const c=`setActive${Fr(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[c]&&e.proxyManager[c](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(c,d)=>{d in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[d]=[]),e.propertyLinkSubscribers[d].push(c)},t.gcPropertyLinks=c=>{const d=e.propertyLinkSubscribers[c]||[];for(;d.length;)d.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[c])return e.propertyLinkMap[c];let f=null;const h=[];let p=0,C=!1;function x(b){let M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(C)return null;const I=[];let A=null;for(p=h.length;p--;){const U=h[p];U.instance===b?A=U:I.push(U)}if(!A)return null;const k=A.instance[`get${Fr(A.propertyName)}`]();if(!uee(k,f)||M){for(f=k,C=!0;I.length;){const U=I.pop();U.instance.set({[U.propertyName]:f})}C=!1}return e.propertyLinkMap[c].persistent&&(e.propertyLinkMap[c].value=k),k}function T(b,M){const I=[];for(p=h.length;p--;){const A=h[p];A.instance===b&&(A.propertyName===M||M===void 0)&&(A.subscription.unsubscribe(),I.push(p))}for(;I.length;)h.splice(I.pop(),1)}function _(b,M){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const A=b.onModified(x),k=h[0];return h.push({instance:b,propertyName:M,subscription:A}),I&&(e.propertyLinkMap[c].persistent&&e.propertyLinkMap[c].value!==void 0?b.set({[M]:e.propertyLinkMap[c].value}):k&&x(k.instance,!0)),{unsubscribe:()=>T(b,M)}}function y(){for(;h.length;)h.pop().subscription.unsubscribe()}const w={bind:_,unbind:T,unsubscribe:y,persistent:d};return e.propertyLinkMap[c]=w,w};function s(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nm;const d=[],f=e.proxyId,h=o(c)||[];for(let p=0;p<h.length;p++){const C=h[p],x=t[`get${Fr(C)}`],T=x?x():void 0,_={id:f,name:C,value:T},y=s(C);y.length&&(_.children=y),d.push(_)}return d}t.listPropertyNames=()=>s().map(c=>c.name),t.getPropertyByName=c=>s().find(d=>d.name===c),t.getPropertyDomainByName=c=>(r[c]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const c=Object.keys(e.propertyLinkMap);let d=c.length;for(;d--;)e.propertyLinkMap[c[d]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function l(){if(e.links)for(let c=0;c<e.links.length;c++){const{link:d,property:f,persistent:h,updateOnBind:p,type:C}=e.links[c];if(C==="application"){const x=e.proxyManager.getPropertyLink(d,h);t.registerPropertyLinkForGC(x,"application"),x.bind(t,f,p)}}}eE(l)}function qA(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let o=a.length;for(;o--;){const s=a[o],{modelKey:l,property:c,modified:d=!0}=n[s],f=Fr(c),h=Fr(s);t[`get${h}`]=e[l][`get${f}`],t[`set${h}`]=e[l][`set${f}`],d&&i.push(e[l].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function XA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const l=Object.keys(s);let c=l.length;for(;c--;){const d=l[c];e[d].set(s[d])}}const a=Object.keys(r);let o=a.length;for(;o--;){const s=a[o];e[s]=r[s];const l=n[s];t[`set${Fr(s)}`]=c=>{if(c!==e[s]){e[s]=c;const d=l[c];i(d),t.modified()}}}a.length&&aa(t,e,a)}const zI=10,WI=40,jI=800;function YA(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*zI,i=n*zI,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=WI,i*=WI):(r*=jI,i*=jI)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var de={algo:rE,capitalize:hy,chain:aE,debounce:HA,enumToString:fee,event:jA,EVENT_ABORT:iE,formatBytesToProperUnit:UA,formatNumbersWithThousandSeparator:BA,get:aa,getArray:Jf,getCurrentGlobalMTime:see,getStateArrayMapFunc:zA,isVtkObject:oE,keystore:sE,measurePromiseExecution:WA,moveToProtected:lp,newInstance:Ln,newTypedArray:Yf,newTypedArrayFrom:dy,normalizeWheel:YA,obj:ir,proxy:KA,proxyPropertyMapping:qA,proxyPropertyState:XA,safeArrays:GA,set:sp,setArray:tE,setGet:Ur,setGetArray:nE,setImmediate:eE,setLoggerFunction:LA,throttle:$A,traverseInstanceTree:Wv,TYPED_ARRAYS:Gi,uncapitalize:VA,VOID:RA,vtkDebugMacro:zv,vtkErrorMacro:Sn,vtkInfoMacro:PA,vtkLogMacro:kA,vtkOnceErrorMacro:FA,vtkWarningMacro:QS},_i=Object.freeze({__proto__:null,VOID:RA,setLoggerFunction:LA,vtkLogMacro:kA,vtkInfoMacro:PA,vtkDebugMacro:zv,vtkErrorMacro:Sn,vtkWarningMacro:QS,vtkOnceErrorMacro:FA,TYPED_ARRAYS:Gi,newTypedArray:Yf,newTypedArrayFrom:dy,capitalize:hy,_capitalize:Fr,uncapitalize:VA,formatBytesToProperUnit:UA,formatNumbersWithThousandSeparator:BA,setImmediateVTK:eE,measurePromiseExecution:WA,obj:ir,get:aa,set:sp,setGet:Ur,getArray:Jf,setArray:tE,setGetArray:nE,moveToProtected:lp,algo:rE,EVENT_ABORT:iE,event:jA,newInstance:Ln,chain:aE,isVtkObject:oE,traverseInstanceTree:Wv,debounce:HA,throttle:$A,keystore:sE,proxy:KA,proxyPropertyMapping:qA,proxyPropertyState:XA,normalizeWheel:YA,default:de}),lE={exports:{}};lE.exports;(function(t){(function(e,n,r){function i(l){var c=this,d=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(l),c.s0<0&&(c.s0+=1),c.s1-=d(l),c.s1<0&&(c.s1+=1),c.s2-=d(l),c.s2<0&&(c.s2+=1),d=null}function a(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var d=new i(l),f=c&&c.state,h=d.next;return h.int32=function(){return d.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&a(f,d),h.state=function(){return a(d,{})}),h}function s(){var l=4022871197,c=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:this.alea=o})(Or,t)})(lE);var pee=lE.exports,cE={exports:{}};cE.exports;(function(t){(function(e,n,r){function i(s){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},s===(s|0)?l.x=s:c+=s;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,l.next()}function a(s,l){return l.x=s.x,l.y=s.y,l.z=s.z,l.w=s.w,l}function o(s,l){var c=new i(s),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,C=(h+p)/(1<<21);while(C===0);return C},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&a(d,c),f.state=function(){return a(c,{})}),f}n&&n.exports?n.exports=o:this.xor128=o})(Or,t)})(cE);var mee=cE.exports,uE={exports:{}};uE.exports;(function(t){(function(e,n,r){function i(s){var l=this,c="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,s===(s|0)?l.x=s:c+=s;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,d==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function a(s,l){return l.x=s.x,l.y=s.y,l.z=s.z,l.w=s.w,l.v=s.v,l.d=s.d,l}function o(s,l){var c=new i(s),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,C=(h+p)/(1<<21);while(C===0);return C},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&a(d,c),f.state=function(){return a(c,{})}),f}n&&n.exports?n.exports=o:this.xorwow=o})(Or,t)})(uE);var vee=uE.exports,fE={exports:{}};fE.exports;(function(t){(function(e,n,r){function i(s){var l=this;l.next=function(){var d=l.x,f=l.i,h,p;return h=d[f],h^=h>>>7,p=h^h<<24,h=d[f+1&7],p^=h^h>>>10,h=d[f+3&7],p^=h^h>>>3,h=d[f+4&7],p^=h^h<<7,h=d[f+7&7],h=h^h<<13,p^=h^h<<9,d[f]=p,l.i=f+1&7,p};function c(d,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],d.x=p,d.i=0,h=256;h>0;--h)d.next()}c(l,s)}function a(s,l){return l.x=s.x.slice(),l.i=s.i,l}function o(s,l){s==null&&(s=+new Date);var c=new i(s),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,C=(h+p)/(1<<21);while(C===0);return C},f.int32=c.next,f.quick=f,d&&(d.x&&a(d,c),f.state=function(){return a(c,{})}),f}n&&n.exports?n.exports=o:this.xorshift7=o})(Or,t)})(fE);var yee=fE.exports,dE={exports:{}};dE.exports;(function(t){(function(e,n,r){function i(s){var l=this;l.next=function(){var d=l.w,f=l.X,h=l.i,p,C;return l.w=d=d+1640531527|0,C=f[h+34&127],p=f[h=h+1&127],C^=C<<13,p^=p<<17,C^=C>>>15,p^=p>>>12,C=f[h]=C^p,l.i=h,C+(d^d>>>16)|0};function c(d,f){var h,p,C,x,T,_=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),C=0,x=-32;x<y;++x)f&&(p^=f.charCodeAt((x+32)%f.length)),x===0&&(T=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,x>=0&&(T=T+1640531527|0,h=_[x&127]^=p+T,C=h==0?C+1:0);for(C>=128&&(_[(f&&f.length||0)&127]=-1),C=127,x=4*128;x>0;--x)p=_[C+34&127],h=_[C=C+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,_[C]=p^h;d.w=T,d.X=_,d.i=C}c(l,s)}function a(s,l){return l.i=s.i,l.w=s.w,l.X=s.X.slice(),l}function o(s,l){s==null&&(s=+new Date);var c=new i(s),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,C=(h+p)/(1<<21);while(C===0);return C},f.int32=c.next,f.quick=f,d&&(d.X&&a(d,c),f.state=function(){return a(c,{})}),f}n&&n.exports?n.exports=o:this.xor4096=o})(Or,t)})(dE);var wee=dE.exports,hE={exports:{}};hE.exports;(function(t){(function(e,n,r){function i(s){var l=this,c="";l.next=function(){var f=l.b,h=l.c,p=l.d,C=l.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^C,C=C-f|0,l.b=f=f<<20^f>>>12^h,l.c=h=h-p|0,l.d=p<<16^h>>>16^C,l.a=C-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,s===Math.floor(s)?(l.a=s/4294967296|0,l.b=s|0):c+=s;for(var d=0;d<c.length+20;d++)l.b^=c.charCodeAt(d)|0,l.next()}function a(s,l){return l.a=s.a,l.b=s.b,l.c=s.c,l.d=s.d,l}function o(s,l){var c=new i(s),d=l&&l.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,C=(h+p)/(1<<21);while(C===0);return C},f.int32=c.next,f.quick=f,d&&(typeof d=="object"&&a(d,c),f.state=function(){return a(c,{})}),f}n&&n.exports?n.exports=o:this.tychei=o})(Or,t)})(hE);var Cee=hE.exports,JA={exports:{}};const xee={},See=Object.freeze(Object.defineProperty({__proto__:null,default:xee},Symbol.toStringTag,{value:"Module"})),Eee=Yr(See);(function(t){(function(e,n,r){var i=256,a=6,o=52,s="random",l=r.pow(i,a),c=r.pow(2,o),d=c*2,f=i-1,h;function p(b,M,I){var A=[];M=M==!0?{entropy:!0}:M||{};var k=_(T(M.entropy?[b,w(n)]:b??y(),3),A),U=new C(A),B=function(){for(var z=U.g(a),K=l,J=0;z<c;)z=(z+J)*i,K*=i,J=U.g(1);for(;z>=d;)z/=2,K/=2,J>>>=1;return(z+J)/K};return B.int32=function(){return U.g(4)|0},B.quick=function(){return U.g(4)/4294967296},B.double=B,_(w(U.S),n),(M.pass||I||function(z,K,J,X){return X&&(X.S&&x(X,U),z.state=function(){return x(U,{})}),J?(r[s]=z,K):z})(B,k,"global"in M?M.global:this==r,M.state)}function C(b){var M,I=b.length,A=this,k=0,U=A.i=A.j=0,B=A.S=[];for(I||(b=[I++]);k<i;)B[k]=k++;for(k=0;k<i;k++)B[k]=B[U=f&U+b[k%I]+(M=B[k])],B[U]=M;(A.g=function(z){for(var K,J=0,X=A.i,re=A.j,fe=A.S;z--;)K=fe[X=f&X+1],J=J*i+fe[f&(fe[X]=fe[re=f&re+K])+(fe[re]=K)];return A.i=X,A.j=re,J})(i)}function x(b,M){return M.i=b.i,M.j=b.j,M.S=b.S.slice(),M}function T(b,M){var I=[],A=typeof b,k;if(M&&A=="object")for(k in b)try{I.push(T(b[k],M-1))}catch{}return I.length?I:A=="string"?b:b+"\0"}function _(b,M){for(var I=b+"",A,k=0;k<I.length;)M[f&k]=f&(A^=M[f&k]*19)+I.charCodeAt(k++);return w(M)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(i):(b=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var M=e.navigator,I=M&&M.plugins;return[+new Date,e,I,e.screen,w(n)]}}function w(b){return String.fromCharCode.apply(0,b)}if(_(r.random(),n),t.exports){t.exports=p;try{h=Eee}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:Or,[],Math)})(JA);var Tee=JA.exports,_ee=pee,Dee=mee,bee=vee,Iee=yee,Oee=wee,Mee=Cee,Wu=Tee;Wu.alea=_ee;Wu.xor128=Dee;Wu.xorwow=bee;Wu.xorshift7=Iee;Wu.xor4096=Oee;Wu.tychei=Mee;var Nee=Wu;const Ree=Hf(Nee),gE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Aee=[1,0,0,0,1,0,0,0,1],pE=1e-6,mE=1e-12,{vtkErrorMacro:ZA,vtkWarningMacro:Fu}=de;let QA=0;const HI=20;function cp(t){return()=>ZA(`vtkMath::${t} - NOT IMPLEMENTED`)}function Kh(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function Oh(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function rr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const eL=()=>Math.PI;function Cr(t){return t/180*Math.PI}function Ng(t){return t*180/Math.PI}const{round:rf,floor:gy,ceil:tL,min:nL,max:rL}=Math;function iL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function aL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function oL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,o=t.length;a<o;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const sL=cp("ceilLog2"),lL=cp("factorial");function Na(t){let e=1;for(;e<t;)e*=2;return e}function af(t){return t===Na(t)}function cL(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function uL(t,e){if(t<e)return 0;const n=rr(e);for(let r=0;r<e;++r)n[r]=r;return n}function fL(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function dL(t){Ree(`${t}`,{global:!0}),QA=t}function hL(){return QA}function gL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const pL=cp("gaussian");function Rg(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function ds(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function vE(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function yE(t,e){return t[0]*=e,t[1]*=e,t}function jv(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function mL(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function on(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vL(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function uo(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function cs(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function cc(t){const e=cs(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function yL(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(i+a+o);let l,c,d;i>a&&i>o?(l=0,c=1,d=2):a>o?(l=1,c=2,d=0):(l=2,c=0,d=1);const f=t[l]/s,h=t[c]/s,p=t[d]/s,C=Math.sqrt(f*f+p*p);if(r!==0){const x=Math.sin(r),T=Math.cos(r);e&&(e[l]=(p*T-f*h*x)/C,e[c]=x*C,e[d]=(-(f*T)-h*p*x)/C),n&&(n[l]=(-(p*x)-f*h*T)/C,n[c]=T*C,n[d]=(f*x-h*p*T)/C)}else e&&(e[l]=p/C,e[c]=0,e[d]=-f/C),n&&(n[l]=-f*h/C,n[c]=C,n[d]=-h*p/C)}function wL(t,e,n){const r=on(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=on(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return vE(n,i),!0}function Hv(t,e){return t[0]*e[0]+t[1]*e[1]}function CL(t,e,n){const r=Hv(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=Hv(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return yE(n,i),!0}function Ro(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function xL(t,e){const n=[0,0,0];return uo(t,e,n),Math.atan2(cs(n),on(t,e))}function Lee(t,e,n){const r=[0,0,0];uo(t,e,r);const i=Math.atan2(cs(r),on(t,e));return on(r,n)>=0?i:-i}function SL(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function EL(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function TL(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function wE(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function CE(t){const e=wE(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function kee(t,e,n,r,i){for(let a=0;a<4;a++)i[a]=t[a],i[4+a]=e[a],i[8+a]=n[a],i[12+a]=r[a];return i}function Pee(t,e,n,r,i){for(let a=0;a<4;a++)i[4*a]=t[a],i[4*a+1]=e[a],i[4*a+2]=n[a],i[4*a+3]=r[a];return i}function Fee(t,e,n,r){for(let i=0;i<3;i++)r[i]=t[i],r[3+i]=e[i],r[6+i]=n[i];return r}function Vee(t,e,n,r){for(let i=0;i<3;i++)r[3*i]=t[i],r[3*i+1]=e[i],r[3*i+2]=n[i];return r}function Sr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function _L(t,e){let n,r,i;const a=[0,0,0];for(let o=0;o<3;o++)i=Math.abs(t[o*3]),(r=Math.abs(t[o*3+1]))>i&&(i=r),(r=Math.abs(t[o*3+2]))>i&&(i=r),a[o]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(Kh(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,Kh(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function DL(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function bL(t,e,n){const r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],d=t[7],f=t[8],h=+Sr(s,d,l,f),p=-Sr(o,c,l,f),C=+Sr(o,c,s,d),x=-Sr(i,d,a,f),T=+Sr(r,c,a,f),_=-Sr(r,c,i,d),y=+Sr(i,s,a,l),w=-Sr(r,o,a,l),b=+Sr(r,o,i,s),M=r*h+i*p+a*C,I=h*e[0]+x*e[1]+y*e[2],A=p*e[0]+T*e[1]+w*e[2],k=C*e[0]+_*e[1]+b*e[2];n[0]=I/M,n[1]=A/M,n[2]=k/M}function qh(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function $v(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function IL(t,e,n,r,i,a,o){r!==i&&ZA("Number of columns of A must match number of rows of B.");const s=[...t],l=[...e];for(let c=0;c<n;c++)for(let d=0;d<a;d++){o[c*a+d]=0;for(let f=0;f<r;f++)o[c*a+d]+=s[c*r+f]*l[d+a*f]}}function Ou(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function OL(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],d=t[8],f=+Sr(o,c,s,d),h=-Sr(a,l,s,d),p=+Sr(a,l,o,c),C=-Sr(r,c,i,d),x=+Sr(n,l,i,d),T=-Sr(n,l,r,c),_=+Sr(r,o,i,s),y=-Sr(n,a,i,s),w=+Sr(n,a,r,o),b=n*f+r*h+i*p;b===0&&Fu("Matrix has 0 determinant"),e[0]=f/b,e[3]=h/b,e[6]=p/b,e[1]=C/b,e[4]=x/b,e[7]=T/b,e[2]=_/b,e[5]=y/b,e[8]=w/b}function up(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function xE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pE;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const Zf=xE;function SE(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function EE(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function ML(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pE;return Zf(t,gE,e)}function NL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pE;return Zf(t,Aee,e)}function TE(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],l=t[3]*t[3],c=t[1]*t[2],d=t[1]*t[3],f=t[2]*t[3],h=o+s+l;let p=1/(n+h);const C=(n-h)*p;p*=2,e[0]=o*p+C,e[3]=(c+a)*p,e[6]=(d-i)*p,e[1]=(c-a)*p,e[4]=s*p+C,e[7]=(f+r)*p,e[2]=(d+i)*p,e[5]=(f-r)*p,e[8]=l*p+C}function Xh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function Kv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Xh(t[0],n),e[1]=Xh(t[1],n),e[2]=Xh(t[2],n),e}function Qf(t,e,n,r){let i,a,o,s,l,c,d,f,h,p,C,x,T,_,y,w;const b=rr(e),M=rr(e),I=(k,U,B)=>{_=k[U],T=k[B],k[U]=_-x*(T+_*p),k[B]=T+x*(_-T*p)};for(EE(e,r),l=0;l<e;l++)b[l]=n[l]=t[l+l*e],M[l]=0;for(i=0;i<HI;i++){for(C=0,l=0;l<e-1;l++)for(s=l+1;s<e;s++)C+=Math.abs(t[l*e+s]);if(C===0)break;for(i<3?d=.2*C/(e*e):d=0,l=0;l<e-1;l++)for(s=l+1;s<e;s++)if(_=100*Math.abs(t[l*e+s]),i>3&&Math.abs(n[l])+_===Math.abs(n[l])&&Math.abs(n[s])+_===Math.abs(n[s]))t[l*e+s]=0;else if(Math.abs(t[l*e+s])>d){for(T=n[s]-n[l],Math.abs(T)+_===Math.abs(T)?h=t[l*e+s]/T:(f=.5*T/t[l*e+s],h=1/(Math.abs(f)+Math.sqrt(1+f*f)),f<0&&(h=-h)),y=1/Math.sqrt(1+h*h),x=h*y,p=x/(1+y),T=h*t[l*e+s],M[l]-=T,M[s]+=T,n[l]-=T,n[s]+=T,t[l*e+s]=0,a=0;a<=l-1;a++)I(t,a*e+l,a*e+s);for(a=l+1;a<=s-1;a++)I(t,l*e+a,a*e+s);for(a=s+1;a<e;a++)I(t,l*e+a,s*e+a);for(a=0;a<e;a++)I(r,a*e+l,a*e+s)}for(l=0;l<e;l++)b[l]+=M[l],n[l]=b[l],M[l]=0}if(i>=HI)return Fu("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(o=a,w=n[o],i=a+1;i<e;i++)(n[i]>=w||Math.abs(n[i]-w)<mE)&&(o=i,w=n[o]);o!==a&&(n[o]=n[a],n[a]=w,Oh(r,e,a,o))}const A=(e>>1)+(e&1);for(c=0,i=0;i<e*e;i++)r[i]>=0&&c++;if(c<A)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function _E(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];Qf(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function RL(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],l=t[1]*e[1],c=t[1]*e[2],d=t[1]*e[3],f=t[2]*e[0],h=t[2]*e[1],p=t[2]*e[2],C=t[2]*e[3],x=t[3]*e[0],T=t[3]*e[1],_=t[3]*e[2],y=t[3]*e[3];n[0]=r-l-p-y,n[1]=i+s+C-_,n[2]=a-d+f+T,n[3]=o+c-h+x}function DE(t,e){for(let h=0;h<9;h++)e[h]=t[h];const n=rr(3),r=rr(3);let i;for(let h=0;h<3;h++){const p=Math.abs(e[h*3]),C=Math.abs(e[h*3+1]),x=Math.abs(e[h*3+2]);i=C>p?C:p,i=x>i?x:i,n[h]=1,i!==0&&(n[h]/=i)}const a=Math.abs(e[0])*n[0],o=Math.abs(e[3])*n[1],s=Math.abs(e[6])*n[2];r[0]=0,i=a,o>=i&&(i=o,r[0]=1),s>=i&&(r[0]=2),r[0]!==0&&(Oh(e,3,r[0],0),n[r[0]]=n[0]);const l=Math.abs(e[4])*n[1],c=Math.abs(e[7])*n[2];r[1]=1,i=l,c>=i&&(r[1]=2,Oh(e,3,1,2)),r[2]=2;let d=0;if(up(e)<0){d=1;for(let h=0;h<9;h++)e[h]=-e[h]}const f=rr(4);if(_E(e,f),TE(f,e),d)for(let h=0;h<9;h++)e[h]=-e[h];r[1]!==1&&Oh(e,3,r[1],1),r[0]!==0&&Oh(e,3,r[0],0)}function bE(t,e,n){let r,i,a,o,s,l;const c=[...t];if(Qf(c,3,e,n),e[0]===e[1]&&e[0]===e[2]){SE(n);return}for(Ou(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(l=Math.abs(n[r*3]),o=0,i=1;i<3;i++)l<(s=Math.abs(n[r*3+i]))&&(l=s,o=i);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,Kh(n,3,r,o)),n[o*3+o]<0&&(n[o*3]=-n[o*3],n[o*3+1]=-n[o*3+1],n[o*3+2]=-n[o*3+2]),i=(o+1)%3,a=(o+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const d=uo([n[o*3],n[o*3+1],n[o*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);cc(d);const f=uo(d,[n[o*3],n[o*3+1],n[o*3+2]],[]);for(let h=0;h<3;h++)n[a*3+h]=d[h],n[i*3+h]=f[h];Ou(n,n);return}for(l=Math.abs(n[0]),o=0,r=1;r<3;r++)l<(s=Math.abs(n[r*3]))&&(l=s,o=r);if(o!==0){const d=e[o];e[o]=e[0],e[0]=d,Kh(n,3,o,0)}if(Math.abs(n[4])<Math.abs(n[7])){const d=e[2];e[2]=e[1],e[1]=d,Kh(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);up(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Ou(n,n)}function AL(t,e,n,r){let i;const a=[...t],o=up(a);if(o<0)for(i=0;i<9;i++)a[i]=-a[i];DE(a,e),Ou(a,a),$v(a,e,r),bE(r,n,r),$v(e,r,e),Ou(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function py(t,e,n){let r,i,a,o,s=0,l,c,d;const f=rr(n);for(r=0;r<n;r++){for(o=0,i=0;i<n;i++)(d=Math.abs(t[r*n+i]))>o&&(o=d);if(o===0)return Fu("Unable to factor linear system"),0;f[r]=1/o}for(i=0;i<n;i++){for(r=0;r<i;r++){for(l=t[r*n+i],a=0;a<r;a++)l-=t[r*n+a]*t[a*n+i];t[r*n+i]=l}for(o=0,r=i;r<n;r++){for(l=t[r*n+i],a=0;a<i;a++)l-=t[r*n+a]*t[a*n+i];t[r*n+i]=l,(c=f[r]*Math.abs(l))>=o&&(o=c,s=r)}if(i!==s){for(a=0;a<n;a++)c=t[s*n+a],t[s*n+a]=t[i*n+a],t[i*n+a]=c;f[s]=f[i]}if(e[i]=s,Math.abs(t[i*n+i])<=mE)return Fu("Unable to factor linear system"),0;if(i!==n-1)for(c=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=c}return 1}function my(t,e,n,r){let i,a,o,s,l;for(o=-1,i=0;i<r;i++){if(s=e[i],l=n[s],n[s]=n[i],o>=0)for(a=o;a<=i-1;a++)l-=t[i*r+a]*n[a];else l!==0&&(o=i);n[i]=l}for(i=r-1;i>=0;i--){for(l=n[i],a=i+1;a<r;a++)l-=t[i*r+a]*n[a];n[i]=l/t[i*r+i]}}function IE(t,e,n){if(n===2){const i=rr(2),a=Sr(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=rr(n);return py(t,r,n)===0?0:(my(t,r,e,n),1)}function OE(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||rr(n),o=i||rr(n);if(py(t,a,n)===0)return null;for(let s=0;s<n;s++){for(let l=0;l<n;l++)o[l]=0;o[s]=1,my(t,a,o,n);for(let l=0;l<n;l++)e[l*n+s]=o[l]}return e}function LL(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function kL(t,e,n){return Qf(t,3,e,n)}function qv(t,e,n,r){if(t<n)return Fu("Insufficient number of samples. Underdetermined."),0;let i,a,o;const s=rr(n*n),l=rr(n),c=rr(n*n);for(o=0;o<t;o++)for(i=0;i<n;i++)for(a=i;a<n;a++)s[i*n+a]+=e[o*n+i]*e[o*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)s[i*n+a]=s[a*n+i];for(Qf(s,n,l,c),i=0;i<n;i++)r[i]=c[i*n+n-1];return 1}function PL(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return Fu("Insufficient number of samples. Underdetermined."),0;const s=rr(i);let l=1,c,d=0,f,h,p,C=0;if(o){for(h=0;h<i;h++)s[h]=1;for(f=0;f<t;f++)for(h=0;h<i;h++)Math.abs(r[f*i+h])>mE&&(l=0,s[h]=0);if(l&&i===1)return Fu("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),qv(t,e,n,a);if(l)C=1;else for(h=0;h<i;h++)s[h]&&(C=1)}C&&(c=rr(n),d=qv(t,e,n,c));const x=rr(n*n),T=rr(n*n),_=rr(n*i);for(p=0;p<t;p++)for(f=0;f<n;f++){for(h=f;h<n;h++)x[f*n+h]+=e[p*n+f]*e[p*n+h];for(h=0;h<i;h++)_[f*i+h]+=e[p*n+f]*r[p*i+h]}for(f=0;f<n;f++)for(h=0;h<f;h++)x[f*n+h]=x[h*n+f];const y=OE(x,T,n);if(y)for(f=0;f<n;f++)for(h=0;h<i;h++)for(a[f*i+h]=0,p=0;p<n;p++)a[f*i+h]+=T[f*n+p]*_[p*i+h];if(C){for(h=0;h<i;h++)if(s[h])for(f=0;f<n;f++)a[f*i+h]=c[f*i]}return C?d&&y:y}function FL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function of(t,e){let n,r;const[i,a,o]=t,s=1/3,l=1/6,c=2/3;let d=i,f=i;a>d?d=a:a<f&&(f=a),o>d?d=o:o<f&&(f=o);const h=d;h>0?r=(d-f)/d:r=0,r>0?(i===d?n=l*(a-o)/(d-f):a===d?n=s+l*(o-i)/(d-f):n=c+l*(i-a)/(d-f),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=h}function Fl(t,e){const[n,r,i]=t,a=1/3,o=1/6,s=2/3,l=5/6;let c,d,f;n>o&&n<=a?(d=1,c=(a-n)/o,f=0):n>a&&n<=.5?(d=1,f=(n-a)/o,c=0):n>.5&&n<=s?(f=1,d=(s-n)/o,c=0):n>s&&n<=l?(f=1,c=(n-s)/o,d=0):n>l&&n<=1?(c=1,f=(1-n)/o,d=0):(c=1,d=n/o,f=0),c=r*c+(1-r),d=r*d+(1-r),f=r*f+(1-r),c*=i,d*=i,f*=i,e[0]=c,e[1]=d,e[2]=f}function ME(t,e){const[n,r,i]=t;let a=(n+16)/116,o=r/500+a,s=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const l=.9505,c=1,d=1.089;e[0]=l*o,e[1]=c*a,e[2]=d*s}function NE(t,e){const[n,r,i]=t,a=.9505,o=1,s=1.089;let l=n/a,c=r/o,d=i/s;l>.008856?l**=1/3:l=7.787*l+16/116,c>.008856?c**=1/3:c=7.787*c+16/116,d>.008856?d**=1/3:d=7.787*d+16/116,e[0]=116*c-16,e[1]=500*(l-c),e[2]=200*(c-d)}function RE(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,o=n*-.9689+r*1.8758+i*.0415,s=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let l=a;l<o&&(l=o),l<s&&(l=s),l>1&&(a/=l,o/=l,s/=l),a<0&&(a=0),o<0&&(o=0),s<0&&(s=0),e[0]=a,e[1]=o,e[2]=s}function AE(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function $l(t,e){const n=[0,0,0];AE(t,n),NE(n,e)}function Ag(t,e){const n=[0,0,0];ME(t,n),RE(n,e)}function ju(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Yh(t){return!(t[1]-t[0]<0)}function VL(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function ro(t,e,n){return t<e?e:t>n?n:t}function Xv(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=ro(t[0],e[0],n[0]),r[1]=ro(t[1],e[1],n[1]),r[2]=ro(t[2],e[2],n[2]),r}function UL(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const BL=cp("GetScalarTypeFittingRange"),GL=cp("GetAdjustedScalarRange");function zL(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function WL(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function jL(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function HL(t,e,n,r){const i=rr(3),a=rr(3),o=rr(3),s=rr(3),l=rr(3),c=rr(3);for(let b=0;b<3;++b)i[b]=t[b]-e[b],a[b]=e[b]-n[b],o[b]=n[b]-t[b],s[b]=-i[b],l[b]=-a[b],c[b]=-o[b];const d=cs(s),f=cs(l),h=cs(o),p=rr(3);uo(i,a,p);const C=cs(p),x=d*f*h/(2*C),T=2*C*C,_=f*f*on(i,c)/T,y=h*h*on(s,a)/T,w=d*d*on(o,l)/T;for(let b=0;b<3;++b)r[b]=_*t[b]+y*e[b]+w*n[b];return x}const $L=1/0,KL=-1/0,LE=t=>!Number.isFinite(t),{isFinite:qL,isNaN:Yv}=Number,Lg=Yv;function tl(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function XL(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function kE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let o=-1/0,s=0,l=0;for(let c=0;c<=a;++c){const d=n[c];for(let f=0;f<=a;++f){const h=r[f],p=Math.abs(t[d+e*h]);p>o&&(o=p,s=c,l=f)}}[n[a],n[s]]=[n[s],n[a]],[r[a],r[l]]=[r[l],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const o=n[a]+e*r[a];i[o]=t[o]<0?-1:1}return i}function PE(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function YL(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(PE).join("")}`}function rm(t){return Math.round(t*255)}function JL(t){return t.length===3?`rgb(${t.map(rm).join(", ")})`:`rgba(${rm(t[0]||0)}, ${rm(t[1]||0)}, ${rm(t[2]||0)}, ${t[3]||0})`}var to={Pi:eL,radiansFromDegrees:Cr,degreesFromRadians:Ng,round:rf,floor:gy,ceil:tL,ceilLog2:sL,min:nL,max:rL,arrayMin:iL,arrayMax:aL,arrayRange:oL,isPowerOfTwo:af,nearestPowerOfTwo:Na,factorial:lL,binomial:cL,beginCombination:uL,nextCombination:fL,randomSeed:dL,getSeed:hL,random:gL,gaussian:pL,add:Rg,subtract:ds,multiplyScalar:vE,multiplyScalar2D:yE,multiplyAccumulate:jv,multiplyAccumulate2D:mL,dot:on,outer:vL,cross:uo,norm:cs,normalize:cc,perpendiculars:yL,projectVector:wL,projectVector2D:CL,distance2BetweenPoints:Ro,angleBetweenVectors:xL,gaussianAmplitude:SL,gaussianWeight:EL,dot2D:Hv,outer2D:TL,norm2D:wE,normalize2D:CE,determinant2x2:Sr,LUFactor3x3:_L,LUSolve3x3:DL,linearSolve3x3:bL,multiply3x3_vect3:qh,multiply3x3_mat3:$v,multiplyMatrix:IL,transpose3x3:Ou,invert3x3:OL,identity3x3:SE,identity:EE,isIdentity:ML,isIdentity3x3:NL,determinant3x3:up,quaternionToMatrix3x3:TE,areEquals:xE,areMatricesEqual:Zf,roundNumber:Xh,roundVector:Kv,matrix3x3ToQuaternion:_E,multiplyQuaternion:RL,orthogonalize3x3:DE,diagonalize3x3:bE,singularValueDecomposition3x3:AL,solveLinearSystem:IE,invertMatrix:OE,luFactorLinearSystem:py,luSolveLinearSystem:my,estimateMatrixCondition:LL,jacobi:kL,jacobiN:Qf,solveHomogeneousLeastSquares:qv,solveLeastSquares:PL,hex2float:FL,rgb2hsv:of,hsv2rgb:Fl,lab2xyz:ME,xyz2lab:NE,xyz2rgb:RE,rgb2xyz:AE,rgb2lab:$l,lab2rgb:Ag,uninitializeBounds:ju,areBoundsInitialized:Yh,computeBoundsFromPoints:VL,clampValue:ro,clampVector:Xv,clampAndNormalizeValue:UL,getScalarTypeFittingRange:BL,getAdjustedScalarRange:GL,extentIsWithinOtherExtent:zL,boundsIsWithinOtherBounds:WL,pointIsWithinBounds:jL,solve3PointCircle:HL,inf:$L,negInf:KL,isInf:LE,isNan:Yv,isNaN:Yv,isFinite:qL,createUninitializedBounds:tl,getMajorAxisIndex:XL,getSparseOrthogonalMatrix:kE,floatToHex2:PE,floatRGB2HexCode:YL,float2CssRGBA:JL};const ZL={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},un={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Uee=un.FLOAT;var QL={DefaultDataType:Uee,DataTypeByteSize:ZL,VtkDataTypes:un};const{vtkErrorMacro:Bee}=_i,{DefaultDataType:Gee}=QL,zee=1e-6;function cx(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o,s;for(s=e;s<r;s+=n)if(!Number.isNaN(t[s])){i=t[s],a=i;break}for(;s<r;s+=n)o=t[s],o<i?i=o:o>a&&(a=o);return{min:i,max:a}}function Wee(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function ek(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let o=0,s=0;o<i;++o){for(let l=s+n;s<l;++s)a[o]+=t[s]*t[s];a[o]**=.5}return cx(a,0,1)}return cx(t,e<0?0:e,n)}function $I(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function FE(t){return Object.prototype.toString.call(t).slice(8,-1)}function jee(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=cs(r,e);a>n&&(n=a)}return n}const tk={computeRange:ek,createRangeHelper:Wee,fastComputeRange:cx,getDataType:FE,getMaxNorm:jee};function Hee(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const o=e.values;return e.values=Yf(e.dataType,(r+a)*i),e.values.set(o),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,o=r%e.numberOfComponents;t.setComponent(a,o,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=$I(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=ek(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=$I(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let o=0;o<e.numberOfComponents;o++)e.values[a+o]=i[o]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const o=Math.min(i.length,e.size-a);for(let s=0;s<o;)e.values[a++]=i[s++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zee;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let o=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(r[s]-e.values[a+s])>i){o=!1;break}if(o)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,o=r*a;switch(a){case 4:i[3]=e.values[o+3];case 3:i[2]=e.values[o+2];case 2:i[1]=e.values[o+1];case 1:i[0]=e.values[o];break;default:for(let s=a-1;s>=0;--s)i[s]=e.values[o+s]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,o=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(a,o);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>UE({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=FE(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),(a==null?void 0:a.length)>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,o,s,l)=>{const c=e.numberOfComponents||1;(c!==i.getNumberOfComponents()||c!==o.getNumberOfComponents())&&Bee("numberOfComponents must match");const d=i.getTuple(a),f=o.getTuple(s),h=[];switch(h.length=c,c){case 4:h[3]=d[3]+(f[3]-d[3])*l;case 3:h[2]=d[2]+(f[2]-d[2])*l;case 2:h[1]=d[1]+(f[1]-d[1])*l;case 1:h[0]=d[0]+(f[0]-d[0])*l;break;default:for(let p=0;p<c;p++)h[p]=d[p]+(f[p]-d[p])*l}return t.insertTuple(r,h)}}const $ee={name:"",numberOfComponents:1,dataType:Gee,rangeTuple:[0,0]};function VE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,$ee,n),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=dy(e.dataType,e.values)):e.values=Yf(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=FE(e.values)),ir(t,e),sp(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");Hee(t,e)}const UE=Ln(VE,"vtkDataArray");var Bt={newInstance:UE,extend:VE,...tk,...QL};const Kee=Object.freeze(Object.defineProperty({__proto__:null,STATIC:tk,default:Bt,extend:VE,newInstance:UE},Symbol.toStringTag,{value:"Module"})),qee={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},ux={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var BE={VectorMode:qee,ScalarMappingTarget:ux};const Xee={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},Yee={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},Jee={BY_ID:0,BY_NAME:1};var vy={ColorMode:Xee,GetArray:Jee,ScalarMode:Yee};const{ScalarMappingTarget:KI,VectorMode:es}=BE,{VtkDataTypes:El}=Bt,{ColorMode:im}=vy,{vtkErrorMacro:qI}=de;function Zee(t){return t}function XI(t){return Math.floor(t*255+.5)}function Qee(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(es.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(es.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(es.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){qI("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let o=null;if(r===im.DEFAULT&&(n.getDataType()===El.UNSIGNED_CHAR||n.getDataType()===El.UNSIGNED_CHAR_CLAMPED)||r===im.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:El.UNSIGNED_CHAR},l=de.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=l,s.size=l.length,o=Bt.newInstance(s);let c=i;c<0&&a>1?t.mapVectorsThroughTable(n,o,KI.RGBA,-1,-1):(c<0&&(c=0),c>=a&&(c=a-1),t.mapScalarsThroughTable(n,o,KI.RGBA,c))}return o},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),l=n.getData();for(let c=0;c<a;c++){let d=0;for(let f=0;f<i;f++)d+=l[c*o+f]*l[c*o+f];s[c]=Math.sqrt(d)}},t.mapVectorsThroughTable=(n,r,i,a,o)=>{let s=t.getVectorMode(),l=o,c=a;const d=n.getNumberOfComponents();s===es.COMPONENT?(c===-1&&(c=t.getVectorComponent()),c<0&&(c=0),c>=d&&(c=d-1)):(l===-1&&(l=t.getVectorSize()),l<=0?(c=0,l=d):(c<0&&(c=0),c>=d&&(c=d-1),c+l>d&&(l=d-c)),s===es.MAGNITUDE&&(d===1||l===1)&&(s=es.COMPONENT));let f=0;switch(c>0&&(f=c),s){case es.COMPONENT:{t.mapScalarsThroughTable(n,r,i,f);break}case es.RGBCOLORS:break;case es.MAGNITUDE:default:{const h=Bt.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,h,l),t.mapScalarsThroughTable(h,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const o=a(i),s=r.getData(),l=n.getData(),c=s.length,d=0,f=1;let h=0;for(let p=d;p<c;p+=f){const C=a(s[p]);l[h*4]=C,l[h*4+1]=C,l[h*4+2]=C,l[h*4+3]=o,h++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),l=o.length,c=0,d=2;let f=0;for(let h=c;h<l;h+=d){const p=a(o[h]);s[f]=p,s[f+1]=p,s[f+2]=p,s[f+3]=a(o[h+1])*i,f+=4}},t.rGBToRGBA=(n,r,i,a)=>{const o=XI(i),s=r.getData(),l=n.getData(),c=s.length,d=0,f=3;let h=0;for(let p=d;p<c;p+=f)l[h*4]=a(s[p]),l[h*4+1]=a(s[p+1]),l[h*4+2]=a(s[p+2]),l[h*4+3]=o,h++},t.rGBAToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),l=o.length,c=0,d=4;let f=0;for(let h=c;h<l;h+=d)s[f*4]=a(o[h]),s[f*4+1]=a(o[h+1]),s[f*4+2]=a(o[h+2]),s[f*4+3]=a(o[h+3])*i,f++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===El.UNSIGNED_CHAR)return n;const o=Bt.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:El.UNSIGNED_CHAR});if(i<=0)return o;a=a>0?a:0,a=a<1?a:1;let s=Zee;switch((n.getDataType()===El.FLOAT||n.getDataType()===El.DOUBLE)&&(s=XI),r){case 1:t.luminanceToRGBA(o,n,a,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,a,s);break;case 4:t.rGBAToRGBA(o,n,a,s);break;default:return qI("Cannot convert colors"),null}return o},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===im.DEFAULT&&n.getDataType()===El.UNSIGNED_CHAR||r===im.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const ete={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:es.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function nk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ete,n),de.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],de.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),de.setArray(t,e,["mappingRange"],2),de.getArray(t,e,["mappingRange"]),Qee(t,e)}const tte=de.newInstance(nk,"vtkScalarsToColors");var yy={newInstance:tte,extend:nk,...BE};const nte={RGB:0,HSV:1,LAB:2,DIVERGING:3},rte={LINEAR:0,LOG10:1};var rk={ColorSpace:nte,Scale:rte};const{ColorSpace:To,Scale:ik}=rk,{ScalarMappingTarget:am}=yy,{vtkDebugMacro:ite,vtkErrorMacro:Ls,vtkWarningMacro:ate}=de;function YI(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),o=a>.001?Math.acos(n/a):0,s=o>.001?Math.atan2(i,r):0;e[0]=a,e[1]=o,e[2]=s}function ote(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function JI(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function ste(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function ZI(t,e,n,r){const i=[],a=[];$l(e,i),$l(n,a);const o=[],s=[];YI(i,o),YI(a,s);let l=t;if(o[1]>.05&&s[1]>.05&&ste(o[2],s[2])>.33*Math.PI){let f=Math.max(o[0],s[0]);f=Math.max(88,f),t<.5?(s[0]=f,s[1]=0,s[2]=0,l*=2):(o[0]=f,o[1]=0,o[2]=0,l=2*l-1)}o[1]<.05&&s[1]>.05?o[2]=JI(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=JI(o,s[0]));const c=[];c[0]=(1-l)*o[0]+l*s[0],c[1]=(1-l)*o[1]+l*s[1],c[2]=(1-l)*o[2]+l*s[2];const d=[];ote(c,d),Ag(d,r)}function lte(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return Ls("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return Ls("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const l={x:n,r,g:i,b:a,midpoint:o,sharpness:s};e.nodes.push(l),t.sortAndUpdateRange();let c=0;for(;c<e.nodes.length&&e.nodes[c].x!==n;c++);return c<e.nodes.length?c:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const l=[];return Fl([r,i,a],l),t.addRGBPoint(n,l[0],l[1],l[2],o,s)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,o)=>a.x-o.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,o,s,l,c)=>{t.sortAndUpdateRange();for(let d=0;d<e.nodes.length;)e.nodes[d].x>=n&&e.nodes[d].x<=o?e.nodes.splice(d,1):d++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(o,s,l,c,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,o,s,l,c)=>{const d=[r,i,a],f=[s,l,c],h=[],p=[];Fl(d,h),Fl(f,p),t.addRGBSegment(n,h[0],h[1],h[2],o,p[0],p[1],p[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const o=t.getNanColorByReference();r[0]=o[0],r[1]=o[1],r[2]=o[2]}else{const o=[];t.getNodeValue(a%i,o),r[0]=o[1],r[1]=o[2],r[2]=o[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,i,a)=>{const o=Number(n),s=Number(r);if(Lg(o)||Lg(s)){for(let U=0;U<i;U++)a[U*3+0]=e.nanColor[0],a[U*3+1]=e.nanColor[1],a[U*3+2]=e.nanColor[2];return}let l=0;const c=e.nodes.length;let d=0,f=0,h=0;c!==0&&(d=e.nodes[c-1].r,f=e.nodes[c-1].g,h=e.nodes[c-1].b);let p=0,C=0,x=0;const T=[0,0,0],_=[0,0,0];let y=0,w=0;const b=[];let M=e.scale===ik.LOG10;M&&(M=e.mappingRange[0]>0);let I=0,A=0,k=0;M&&(I=Math.log10(o),A=Math.log10(s));for(let U=0;U<i;U++){const B=3*U;if(i>1?M?(k=I+U/(i-1)*(A-I),p=10**k):p=o+U/(i-1)*(s-o):M?(k=.5*(I+A),p=10**k):p=.5*(o+s),e.discretize){const z=e.mappingRange;if(p>=z[0]&&p<=z[1]){const K=e.numberOfValues,J=z[1]-z[0];if(K<=1)p=z[0]+J/2;else{const X=(p-z[0])/J,re=gy(K*X);p=z[0]+re/(K-1)*J}}}for(;l<c&&p>e.nodes[l].x;)l++,l<c&&(C=e.nodes[l-1].x,x=e.nodes[l].x,M&&(C=Math.log10(C),x=Math.log10(x)),T[0]=e.nodes[l-1].r,_[0]=e.nodes[l].r,T[1]=e.nodes[l-1].g,_[1]=e.nodes[l].g,T[2]=e.nodes[l-1].b,_[2]=e.nodes[l].b,y=e.nodes[l-1].midpoint,w=e.nodes[l-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(p>e.mappingRange[1])a[B]=0,a[B+1]=0,a[B+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[B]=e.aboveRangeColor[0],a[B+1]=e.aboveRangeColor[1],a[B+2]=e.aboveRangeColor[2]):(a[B]=d,a[B+1]=f,a[B+2]=h));else if(p<e.mappingRange[0]||LE(p)&&p<0)a[B]=0,a[B+1]=0,a[B+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[B]=e.belowRangeColor[0],a[B+1]=e.belowRangeColor[1],a[B+2]=e.belowRangeColor[2]):c>0&&(a[B]=e.nodes[0].r,a[B+1]=e.nodes[0].g,a[B+2]=e.nodes[0].b));else if(l===0&&(Math.abs(p-o)<1e-6||e.discretize))c>0?(a[B]=e.nodes[0].r,a[B+1]=e.nodes[0].g,a[B+2]=e.nodes[0].b):(a[B]=0,a[B+1]=0,a[B+2]=0);else{let z=0;if(M?z=(k-C)/(x-C):z=(p-C)/(x-C),z<y?z=.5*z/y:z=.5+.5*(z-y)/(1-y),w>.99)if(z<.5){a[B]=T[0],a[B+1]=T[1],a[B+2]=T[2];continue}else{a[B]=_[0],a[B+1]=_[1],a[B+2]=_[2];continue}if(w<.01){if(e.colorSpace===To.RGB)a[B]=(1-z)*T[0]+z*_[0],a[B+1]=(1-z)*T[1]+z*_[1],a[B+2]=(1-z)*T[2]+z*_[2];else if(e.colorSpace===To.HSV){const ee=[],we=[];of(T,ee),of(_,we),e.hSVWrap&&(ee[0]-we[0]>.5||we[0]-ee[0]>.5)&&(ee[0]>we[0]?ee[0]-=1:we[0]-=1);const Ce=[];Ce[0]=(1-z)*ee[0]+z*we[0],Ce[0]<0&&(Ce[0]+=1),Ce[1]=(1-z)*ee[1]+z*we[1],Ce[2]=(1-z)*ee[2]+z*we[2],Fl(Ce,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]}else if(e.colorSpace===To.LAB){const ee=[],we=[];$l(T,ee),$l(_,we);const Ce=[];Ce[0]=(1-z)*ee[0]+z*we[0],Ce[1]=(1-z)*ee[1]+z*we[1],Ce[2]=(1-z)*ee[2]+z*we[2],Ag(Ce,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]}else e.colorSpace===To.DIVERGING?(ZI(z,T,_,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]):Ls("ColorSpace set to invalid value.",e.colorSpace);continue}z<.5?z=.5*(z*2)**(1+10*w):z>.5&&(z=1-.5*((1-z)*2)**(1+10*w));const K=z*z,J=K*z,X=2*J-3*K+1,re=-2*J+3*K,fe=J-2*K+z,pe=J-K;let ie,te;if(e.colorSpace===To.RGB)for(let ee=0;ee<3;ee++)ie=_[ee]-T[ee],te=(1-w)*ie,a[B+ee]=X*T[ee]+re*_[ee]+fe*te+pe*te;else if(e.colorSpace===To.HSV){const ee=[],we=[];of(T,ee),of(_,we),e.hSVWrap&&(ee[0]-we[0]>.5||we[0]-ee[0]>.5)&&(ee[0]>we[0]?ee[0]-=1:we[0]-=1);const Ce=[];for(let De=0;De<3;De++)ie=we[De]-ee[De],te=(1-w)*ie,Ce[De]=X*ee[De]+re*we[De]+fe*te+pe*te,De===0&&Ce[De]<0&&(Ce[De]+=1);Fl(Ce,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]}else if(e.colorSpace===To.LAB){const ee=[],we=[];$l(T,ee),$l(_,we);const Ce=[];for(let De=0;De<3;De++)ie=we[De]-ee[De],te=(1-w)*ie,Ce[De]=X*ee[De]+re*we[De]+fe*te+pe*te;Ag(Ce,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]}else e.colorSpace===To.DIVERGING?(ZI(z,T,_,b),a[B]=b[0],a[B+1]=b[1],a[B+2]=b[2]):Ls("ColorSpace set to invalid value.");for(let ee=0;ee<3;ee++)a[B+ee]=a[B+ee]<0?0:a[B+ee],a[B+ee]=a[B+ee]>1?1:a[B+ee]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return Ls("Attempting to lookup a value with no points in the function"),e.table;const o=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*o),e.tableSize=i,e.tableWithAlpha=a);const s=[];t.getTable(n,r,i,s);for(let l=0;l<i;l++)e.table[l*o+0]=Math.floor(s[l*3+0]*255+.5),e.table[l*o+1]=Math.floor(s[l*3+1]*255+.5),e.table[l*o+2]=Math.floor(s[l*3+2]*255+.5),a&&(e.table[l*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let o=0;t.removeAllPoints(),i>1&&(o=(r-n)/(i-1));for(let s=0;s<i;s++){const l={x:n+o*s,r:a[s*3],g:a[s*3+1],b:a[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(l)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(Ls("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return Ls("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>e.indexedLookup&&t.getSize()?t.getSize():e.tableSize?e.tableSize:16777216,t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const o=[];t.getNodeValue(n%i,o);for(let s=0;s<3;++s)r[s]=o[s+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=t.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){Ls("attempt to set zero width color range");return}const o=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*o;for(let l=0;l<e.nodes.length;++l)e.nodes[l].x=e.nodes[l].x*o+s;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){ite("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){ate("Transfer Function Has No Points!");return}const o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),l=n.getNumberOfComponents(),c=r.getData(),d=n.getData(),f=[];if(i===am.RGBA)for(let h=0;h<s;h++){const p=d[h*l+a];t.getColor(p,f),c[h*4]=Math.floor(f[0]*255+.5),c[h*4+1]=Math.floor(f[1]*255+.5),c[h*4+2]=Math.floor(f[2]*255+.5),c[h*4+3]=o}if(i===am.RGB)for(let h=0;h<s;h++){const p=d[h*l+a];t.getColor(p,f),c[h*3]=Math.floor(f[0]*255+.5),c[h*3+1]=Math.floor(f[1]*255+.5),c[h*3+2]=Math.floor(f[2]*255+.5)}if(i===am.LUMINANCE)for(let h=0;h<s;h++){const p=d[h*l+a];t.getColor(p,f),c[h]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5)}if(i===am.LUMINANCE_ALPHA)for(let h=0;h<s;h++){const p=d[h*l+a];t.getColor(p,f),c[h*2]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5),c[h*2+1]=o}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=To[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Ls(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=To.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const o=i||JSON.stringify(e.nodes);if(n.RGBPoints){const c=n.RGBPoints.length;e.nodes=[];const d=.5,f=0;for(let h=0;h<c;h+=4)e.nodes.push({x:n.RGBPoints[h],r:n.RGBPoints[h+1],g:n.RGBPoints[h+2],b:n.RGBPoints[h+3],midpoint:d,sharpness:f})}const s=t.sortAndUpdateRange(),l=!s&&(i||o!==JSON.stringify(e.nodes));return l&&t.modified(),s||l}}const cte={clamping:!0,colorSpace:To.RGB,hSVWrap:!0,scale:ik.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function GE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cte,n),yy.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},de.obj(e.buildTime),de.get(t,e,["buildTime","mappingRange"]),de.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),de.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),de.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),lte(t,e)}const ak=de.newInstance(GE,"vtkColorTransferFunction");var uc={newInstance:ak,extend:GE,...rk};const ute=Object.freeze(Object.defineProperty({__proto__:null,default:uc,extend:GE,newInstance:ak},Symbol.toStringTag,{value:"Module"}));function zE(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function Jh(t,e){const n=e-.5-(t-1)/2,r=e-.5+(t-1)/2;return{lower:n,upper:r}}const fte=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:Jh,toWindowLevel:zE},Symbol.toStringTag,{value:"Module"}));function WE(t,e=1024){const{windowWidth:n,windowCenter:r}=zE(t.lower,t.upper),i=(l,c,d)=>c-d/4*Math.log((1-l)/l),o=[...Array(e+2).keys()].map(l=>l/(e+2)).slice(1,-1).reduce((l,c)=>{const d=i(c,r,n);return l.concat(d,c,c,c,.5,0)},[]),s=uc.newInstance();return s.buildFunctionFromArray(Bt.newInstance({values:o,numberOfComponents:6})),s}function ok(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((p,C)=>C%3===0);const i=[...Array(1024).keys()].map((p,C)=>n+(r-n)/1023*C),a=e[256],o=Math.log((1-a)/a),s=i[256],l=e[256*3],c=Math.log((1-l)/l),d=i[256*3],f=Math.round(4*(d-s)/(o-c)),h=Math.round(s+f*o/4);return[Math.round(h-f/2),Math.round(h+f/2)]}function sk(t){const e=uc.newInstance();let n=0,r=1024;return t&&t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function dte(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}function Kt(t=Hn,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t.dispatchEvent(r)}function pc(){var t;return((t=crypto.randomUUID)==null?void 0:t.call(crypto))||("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function jE(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const hte=Symbol("LastRuntimeId"),gte={},pte=4294967295,mte="-";function vte(t,e,n){return yte(t!==null&&typeof t=="object"?t:gte,hte,(typeof n=="number"&&n>0?n:pte)>>>0).join(typeof e=="string"?e:mte)}function yte(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let o=r[a]|0;o<n?(i=!1,o=o+1):(o=0,a+1===r.length&&r.push(0)),r[a]=o}return r}function qs(t){const e=t.indexOf(":");return t.substring(e+1)}const QI={},wte={add:(t,e)=>{const n=qs(t);QI[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=qs(e);return QI[n]}}},Cte=wte;function fx(t,e,n){return Math.max(e,Math.min(n,t))}function lk(t,e,n){return Math.abs(t-e)<=n}function xte(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!lk(t[r],e[r],n))return!1;return!0}function eO(t){return typeof t=="number"}function tO(t){return"length"in t&&typeof t[0]=="number"}function Pi(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:eO(t)&&eO(e)?lk(t,e,n):tO(t)&&tO(e)?xte(t,e,n):!1}const ck=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(ck):!t,dx=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map(dx):t,uk=(t,e,n=void 0)=>Pi(t,ck(e),n),Ste=(t,e,n=void 0)=>Pi(dx(t),dx(e),n);function Ete(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function g4(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(c){try{l(r.next(c))}catch(d){a(d)}}function s(c){try{l(r.throw(c))}catch(d){a(d)}}function l(c){var d;c.done?i(c.value):(d=c.value,d instanceof n?d:new n(function(f){f(d)})).then(o,s)}l((r=r.apply(t,[])).next())})}const Tte=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function nO(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const fk=typeof window>"u",is=(()=>{if(fk)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function _te(t,e,n){if(!n)return[e];const r=function(c){const d=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,f=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,h=c.createShader(35633),p=c.createShader(35632),C=c.createProgram();if(!(p&&h&&C))return;c.shaderSource(h,d),c.shaderSource(p,f),c.compileShader(h),c.compileShader(p),c.attachShader(C,h),c.attachShader(C,p),c.linkProgram(C),c.detachShader(C,h),c.detachShader(C,p),c.deleteShader(h),c.deleteShader(p),c.useProgram(C);const x=c.createBuffer();c.bindBuffer(34962,x),c.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const T=c.getAttribLocation(C,"aPosition");c.vertexAttribPointer(T,3,5126,!1,0,0),c.enableVertexAttribArray(T),c.clearColor(1,1,1,1),c.clear(16384),c.viewport(0,0,1,1),c.drawArrays(4,0,3);const _=new Uint8Array(4);return c.readPixels(0,0,1,1,6408,5121,_),c.deleteProgram(C),c.deleteBuffer(x),_.join("")}(t),i="801621810",a="8016218135",o="80162181161",s=is!=null&&is.isIpad?[["a7",o,12],["a8",a,15],["a8x",a,15],["a9",a,15],["a9x",a,15],["a10",a,15],["a10x",a,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",a,12],["a9",a,15],["a10",a,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let l;return r==="80162181255"?l=s.filter(([,,c])=>c>=14):(l=s.filter(([,c])=>c===r),l.length||(l=s)),l.map(([c])=>`apple ${c} gpu`)}let rO=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const p4=[],iO=[];function Dte(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let a,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let s,l,c=0,d=0,f=0;for(;d<r;)iO[d]=t.charCodeAt(o+d),p4[d]=++d;for(;f<i;)for(a=e.charCodeAt(o+f),s=f++,c=f,d=0;d<r;d++)l=a===iO[d]?s:s+1,s=p4[d],c=p4[d]=s>c?l>c?c+1:l:l>s?s+1:l;return c}function bte(t){return t!=null}const Ite=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@5.0.40/dist/benchmarks"}={})=>g4(void 0,void 0,void 0,function*(){const o={};if(fk)return{tier:0,type:"SSR"};const{isIpad:s=!!(is!=null&&is.isIpad),isMobile:l=!!(is!=null&&is.isMobile),screenSize:c=window.screen,loadBenchmarks:d=M=>g4(void 0,void 0,void 0,function*(){const I=yield fetch(`${a}/${M}`).then(A=>A.json());if(parseInt(I.shift().split(".")[0],10)<4)throw new rO("Detect GPU benchmark data is out of date. Please update to version 4x");return I})}=n;let{renderer:f}=n;const h=(M,I,A,k,U)=>({device:U,fps:k,gpu:A,isMobile:l,tier:M,type:I});let p,C="";if(f)f=nO(f),p=[f];else{const M=r||function(A,k=!1){const U={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:k,powerPreference:"high-performance",stencil:!1};A&&delete U.powerPreference;const B=window.document.createElement("canvas"),z=B.getContext("webgl",U)||B.getContext("experimental-webgl",U);return z??void 0}(is==null?void 0:is.isSafari12,i);if(!M)return h(0,"WEBGL_UNSUPPORTED");const I=is!=null&&is.isFirefox?null:M.getExtension("WEBGL_debug_renderer_info");if(f=I?M.getParameter(I.UNMASKED_RENDERER_WEBGL):M.getParameter(M.RENDERER),!f)return h(1,"FALLBACK");C=f,f=nO(f),p=function(A,k,U){return k==="apple gpu"?_te(A,k,U):[k]}(M,f,l)}const x=(yield Promise.all(p.map(function(M){var I;return g4(this,void 0,void 0,function*(){const A=(De=>{const Re=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const Oe of Re)if(De.includes(Oe))return Oe})(M);if(!A)return;const k=`${l?"m":"d"}-${A}${s?"-ipad":""}.json`,U=o[k]=(I=o[k])!==null&&I!==void 0?I:d(k);let B;try{B=yield U}catch(De){if(De instanceof rO)throw De;return}const z=function(De){var Re;const Oe=(De=De.replace(/\([^)]+\)/,"")).match(/\d+/)||De.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(Re=Oe==null?void 0:Oe.join("").replace(/\W|amd/g,""))!==null&&Re!==void 0?Re:""}(M);let K=B.filter(([,De])=>De===z);K.length||(K=B.filter(([De])=>De.includes(M)));const J=K.length;if(J===0)return;const X=M.split(/[.,()\[\]/\s]/g).sort().filter((De,Re,Oe)=>Re===0||De!==Oe[Re-1]).join(" ");let re,[fe,,,,pe]=J>1?K.map(De=>[De,Dte(X,De[2])]).sort(([,De],[,Re])=>De-Re)[0][0]:K[0],ie=Number.MAX_VALUE;const{devicePixelRatio:te}=window,ee=c.width*te*c.height*te;for(const De of pe){const[Re,Oe]=De,Ve=Re*Oe,Ge=Math.abs(ee-Ve);Ge<ie&&(ie=Ge,re=De)}if(!re)return;const[,,we,Ce]=re;return[ie,we,fe,Ce]})}))).filter(bte).sort(([M=Number.MAX_VALUE,I],[A=Number.MAX_VALUE,k])=>M===A?I-k:M-A);if(!x.length){const M=Tte.find(I=>f.includes(I));return M?h(0,"BLOCKLISTED",M):h(1,"FALLBACK",`${f} (${C})`)}const[,T,_,y]=x[0];if(T===-1)return h(0,"BLOCKLISTED",_,T,y);const w=l?t:e;let b=0;for(let M=0;M<w.length;M++)T>=w[M]&&(b=M);return h(b,"BENCHMARK",_,T,y)});function mc(t){return Mg.get(t)}function Hu(){return Mg.getAll()}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dk=Symbol("Comlink.proxy"),Ote=Symbol("Comlink.endpoint"),hk=Symbol("Comlink.releaseProxy"),m4=Symbol("Comlink.finalizer"),tv=Symbol("Comlink.thrown"),gk=t=>typeof t=="object"&&t!==null||typeof t=="function",Mte={canHandle:t=>gk(t)&&t[dk],serialize(t){const{port1:e,port2:n}=new MessageChannel;return mk(t,e),[n,[n]]},deserialize(t){return t.start(),hx(t)}},Nte={canHandle:t=>gk(t)&&tv in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},pk=new Map([["proxy",Mte],["throw",Nte]]);function Rte(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function mk(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!Rte(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:o,path:s}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(hu);let c;try{const d=s.slice(0,-1).reduce((h,p)=>h[p],t),f=s.reduce((h,p)=>h[p],t);switch(o){case"GET":c=f;break;case"SET":d[s.slice(-1)[0]]=hu(i.data.value),c=!0;break;case"APPLY":c=f.apply(d,l);break;case"CONSTRUCT":{const h=new f(...l);c=Ck(h)}break;case"ENDPOINT":{const{port1:h,port2:p}=new MessageChannel;mk(t,p),c=Fte(h,[h])}break;case"RELEASE":c=void 0;break;default:return}}catch(d){c={value:d,[tv]:0}}Promise.resolve(c).catch(d=>({value:d,[tv]:0})).then(d=>{const[f,h]=Qv(d);e.postMessage(Object.assign(Object.assign({},f),{id:a}),h),o==="RELEASE"&&(e.removeEventListener("message",r),vk(e),m4 in t&&typeof t[m4]=="function"&&t[m4]())}).catch(d=>{const[f,h]=Qv({value:new TypeError("Unserializable return value"),[tv]:0});e.postMessage(Object.assign(Object.assign({},f),{id:a}),h)})}),e.start&&e.start()}function Ate(t){return t.constructor.name==="MessagePort"}function vk(t){Ate(t)&&t.close()}function hx(t,e){return gx(t,[],e)}function om(t){if(t)throw new Error("Proxy has been released and is not useable")}function yk(t){return G0(t,{type:"RELEASE"}).then(()=>{vk(t)})}const Jv=new WeakMap,Zv="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Jv.get(t)||0)-1;Jv.set(t,e),e===0&&yk(t)});function Lte(t,e){const n=(Jv.get(e)||0)+1;Jv.set(e,n),Zv&&Zv.register(t,e,t)}function kte(t){Zv&&Zv.unregister(t)}function gx(t,e=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(a,o){if(om(r),o===hk)return()=>{kte(i),yk(t),r=!0};if(o==="then"){if(e.length===0)return{then:()=>i};const s=G0(t,{type:"GET",path:e.map(l=>l.toString())}).then(hu);return s.then.bind(s)}return gx(t,[...e,o])},set(a,o,s){om(r);const[l,c]=Qv(s);return G0(t,{type:"SET",path:[...e,o].map(d=>d.toString()),value:l},c).then(hu)},apply(a,o,s){om(r);const l=e[e.length-1];if(l===Ote)return G0(t,{type:"ENDPOINT"}).then(hu);if(l==="bind")return gx(t,e.slice(0,-1));const[c,d]=aO(s);return G0(t,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:c},d).then(hu)},construct(a,o){om(r);const[s,l]=aO(o);return G0(t,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:s},l).then(hu)}});return Lte(i,t),i}function Pte(t){return Array.prototype.concat.apply([],t)}function aO(t){const e=t.map(Qv);return[e.map(n=>n[0]),Pte(e.map(n=>n[1]))]}const wk=new WeakMap;function Fte(t,e){return wk.set(t,e),t}function Ck(t){return Object.assign(t,{[dk]:!0})}function Qv(t){for(const[e,n]of pk)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},wk.get(t)||[]]}function hu(t){switch(t.type){case"HANDLER":return pk.get(t.name).deserialize(t.value);case"RAW":return t.value}}function G0(t,e,n){return new Promise(r=>{const i=Vte();t.addEventListener("message",function a(o){!o.data||!o.data.id||o.data.id!==i||(t.removeEventListener("message",a),r(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),n)})}function Vte(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class HE{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.id=e||pc(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]},compute:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5,compute:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let o;try{o=a.requestFn()}catch(s){console.warn("sendRequest failed",s)}o!=null&&o.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(Tr.Interaction),n=this.sendRequests(Tr.Thumbnail),r=this.sendRequests(Tr.Prefetch),i=this.sendRequests(Tr.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}class xk{constructor(){this.workerRegistry={},this.workerPoolManager=new HE("webworker")}registerWorker(e,n,r={}){var l;const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a){console.warn(`Worker type '${e}' is already registered...`);return}a&&((l=this.workerRegistry[e])!=null&&l.idleCheckIntervalId)&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let c=0;c<i;c++){const d=n();s.instances.push(hx(d)),s.nativeWorkers.push(d),s.workerFn=n}this.workerRegistry[e]=s}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(o=>o!==null);let i=0,a=n.loadCounters[0]||0;for(let o=1;o<r.length;o++){const s=n.loadCounters[o]||0;s<a&&(i=o,a=s)}if(n.instances[i]===null){const o=n.workerFn();n.instances[i]=hx(o),n.nativeWorkers[i]=o}return n.loadCounters[i]+=1,{api:n.instances[i],index:i}}executeTask(e,n,r={},{requestType:i=Tr.Compute,priority:a=0,options:o={},callbacks:s=[]}={}){return new Promise((l,c)=>{const d=async()=>{const{api:f,index:h}=this.getNextWorkerAPI(e);if(!f){const p=new Error(`No available worker instance for '${e}'`);console.error(p),c(p);return}try{let p=[];s.length&&(p=s.map(T=>Ck(T)));const C=this.workerRegistry[e];C.processing=!0;const x=await f[n](r,...p);C.processing=!1,C.lastActiveTime[h]=Date.now(),C.autoTerminateOnIdle&&!C.idleCheckIntervalId&&C.idleTimeThreshold&&(C.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,C.idleTimeThreshold)},C.idleTimeThreshold)),l(x)}catch(p){console.error(`Error executing method '${n}' on worker '${e}':`,p),c(p)}finally{this.workerRegistry[e].loadCounters[h]--}};this.workerPoolManager.addRequest(d,i,o,a)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const i=Date.now();r.instances.forEach((a,o)=>{const s=r.lastActiveTime[o],l=s!==null&&r.loadCounters[o]>0,c=i-s;!l&&c>n&&this.terminateWorkerInstance(e,o)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],i=r.instances[n];i!==null&&(i[hk](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}let Cu=!1,Mh=!0,Zh=Al.TRUE;const px={gpuTier:void 0,detectGPUConfig:{},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useNorm16Texture:!1,strictZSpacingForVolumeViewport:!0},enableCacheOptimization:!0,peerImport:t=>null};let ri={...px,rendering:{...px.rendering}},Qh=null;function Sk(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function Ek(){const t=Sk();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function Ute(){try{return!!new SharedArrayBuffer(0)}catch{return!1}}function Bte(){const t=Sk();return!!(t&&t.getExtension("EXT_texture_norm16"))}function Tk(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}async function _k(t=ri){var n,r;return Cu||(ri=TB(px,t),Tk()&&(ri.rendering.useNorm16Texture=Bte(),ri.rendering.useNorm16Texture||((n=t.rendering)!=null&&n.preferSizeOverAccuracy?ri.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits"))),Ek()?(ri.gpuTier=ri.gpuTier||await Ite(ri.detectGPUConfig),console.log("CornerstoneRender: Using detect-gpu to get the GPU benchmark:",ri.gpuTier),((r=ri.gpuTier)==null?void 0:r.tier)<1?(console.log("CornerstoneRender: GPU is not powerful enough, using CPU rendering"),ri.rendering.useCPURendering=!0):console.log("CornerstoneRender: using GPU rendering")):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),ri.rendering.useCPURendering=!0),$E(Zh),Cu=!0,Qh||(Qh=new xk),Cu)}function Gte(t){ri.rendering.useCPURendering=t,Cu=!0,wy()}function zte(t){ri.rendering.preferSizeOverAccuracy=t,Cu=!0,wy()}function Dk(){return!Tk()}function Wte(){ri.rendering.useCPURendering=!Ek(),wy()}function xf(){return ri.rendering.useCPURendering}function $E(t){if(t==Al.AUTO){Zh=Al.AUTO,Ute()?(Mh=!0,console.log("CornerstoneRender: using SharedArrayBuffer")):(Mh=!1,console.warn(`CornerstoneRender: SharedArray Buffer not allowed, performance may be slower.
        Try ensuring page is cross-origin isolated to enable SharedArrayBuffer.`));return}if(t==Al.TRUE||t==!0){Zh=Al.TRUE,Mh=!0;return}if(t==Al.FALSE||t==!1){Zh=Al.FALSE,Mh=!1;return}}function jte(){$E(Zh)}function $u(){return Mh}function bk(){return Cu}function vs(){return ri}function Hte(t){ri=t,wy()}function wy(){Hu().forEach(t=>t.getViewports().forEach(e=>{var n;return(n=e.updateRenderingPipeline)==null?void 0:n.call(e)}))}function $te(){return Qh||(Qh=new xk),Qh}function Ik(t){return ri.peerImport(t)}function e2(t){if(!$u())throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=new SharedArrayBuffer(t);return new Uint8Array(e)}const Ok=2*1024*1024*1024-2,Kte=Ok*2,qte=65536;function eg(t){if(!$u())throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=t*4;if(e<Ok){const n=new SharedArrayBuffer(e);return new Float32Array(n)}else if(e<Kte){const n=Math.ceil(e/qte),r=new WebAssembly.Memory({initial:n,maximum:n,shared:!0});return new Float32Array(r.buffer,0,t)}}function t2(t){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=new SharedArrayBuffer(t*2);return new Uint16Array(e)}function Mk(t){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(window.SharedArrayBuffer===void 0)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const e=new SharedArrayBuffer(t*2);return new Int16Array(e)}var Lt=1e-6,Tn=typeof Float32Array<"u"?Float32Array:Array,Fo=Math.random;function Xte(t){Tn=t}var Yte=Math.PI/180;function Nk(t){return t*Yte}function mx(t,e){return Math.abs(t-e)<=Lt*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});const Jte=Object.freeze(Object.defineProperty({__proto__:null,get ARRAY_TYPE(){return Tn},EPSILON:Lt,RANDOM:Fo,equals:mx,setMatrixArrayType:Xte,toRadian:Nk},Symbol.toStringTag,{value:"Module"}));function Zte(){var t=new Tn(4);return Tn!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function Qte(t){var e=new Tn(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ene(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function tne(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function nne(t,e,n,r){var i=new Tn(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function rne(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function ine(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function ane(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*a-i*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null}function one(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function sne(t){return t[0]*t[3]-t[2]*t[1]}function Rk(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],l=n[1],c=n[2],d=n[3];return t[0]=r*s+a*l,t[1]=i*s+o*l,t[2]=r*c+a*d,t[3]=i*c+o*d,t}function lne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+a*s,t[1]=i*l+o*s,t[2]=r*-s+a*l,t[3]=i*-s+o*l,t}function cne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],l=n[1];return t[0]=r*s,t[1]=i*s,t[2]=a*l,t[3]=o*l,t}function une(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function fne(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function dne(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function hne(t){return Math.hypot(t[0],t[1],t[2],t[3])}function gne(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function pne(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Ak(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function mne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function vne(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(n-o)<=Lt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=Lt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=Lt*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=Lt*Math.max(1,Math.abs(a),Math.abs(c))}function yne(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function wne(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}var Cne=Rk,xne=Ak;const Sne=Object.freeze(Object.defineProperty({__proto__:null,LDU:gne,add:pne,adjoint:one,clone:Qte,copy:ene,create:Zte,determinant:sne,equals:vne,exactEquals:mne,frob:hne,fromRotation:une,fromScaling:fne,fromValues:nne,identity:tne,invert:ane,mul:Cne,multiply:Rk,multiplyScalar:yne,multiplyScalarAndAdd:wne,rotate:lne,scale:cne,set:rne,str:dne,sub:xne,subtract:Ak,transpose:ine},Symbol.toStringTag,{value:"Module"}));function Ene(){var t=new Tn(6);return Tn!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Tne(t){var e=new Tn(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function _ne(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Dne(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function bne(t,e,n,r,i,a){var o=new Tn(6);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o[4]=i,o[5]=a,o}function Ine(t,e,n,r,i,a,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t}function One(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=n*a-r*i;return l?(l=1/l,t[0]=a*l,t[1]=-r*l,t[2]=-i*l,t[3]=n*l,t[4]=(i*s-a*o)*l,t[5]=(r*o-n*s)*l,t):null}function Mne(t){return t[0]*t[3]-t[1]*t[2]}function Lk(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=n[0],d=n[1],f=n[2],h=n[3],p=n[4],C=n[5];return t[0]=r*c+a*d,t[1]=i*c+o*d,t[2]=r*f+a*h,t[3]=i*f+o*h,t[4]=r*p+a*C+s,t[5]=i*p+o*C+l,t}function Nne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=Math.sin(n),d=Math.cos(n);return t[0]=r*d+a*c,t[1]=i*d+o*c,t[2]=r*-c+a*d,t[3]=i*-c+o*d,t[4]=s,t[5]=l,t}function Rne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=n[0],d=n[1];return t[0]=r*c,t[1]=i*c,t[2]=a*d,t[3]=o*d,t[4]=s,t[5]=l,t}function Ane(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=r*c+a*d+s,t[5]=i*c+o*d+l,t}function Lne(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function kne(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Pne(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Fne(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Vne(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Une(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function kk(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function Bne(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function Gne(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function zne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Wne(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=e[0],c=e[1],d=e[2],f=e[3],h=e[4],p=e[5];return Math.abs(n-l)<=Lt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-c)<=Lt*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-d)<=Lt*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=Lt*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-h)<=Lt*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=Lt*Math.max(1,Math.abs(s),Math.abs(p))}var jne=Lk,Hne=kk;const $ne=Object.freeze(Object.defineProperty({__proto__:null,add:Une,clone:Tne,copy:_ne,create:Ene,determinant:Mne,equals:Wne,exactEquals:zne,frob:Vne,fromRotation:Lne,fromScaling:kne,fromTranslation:Pne,fromValues:bne,identity:Dne,invert:One,mul:jne,multiply:Lk,multiplyScalar:Bne,multiplyScalarAndAdd:Gne,rotate:Nne,scale:Rne,set:Ine,str:Fne,sub:Hne,subtract:kk,translate:Ane},Symbol.toStringTag,{value:"Module"}));function Pk(){var t=new Tn(9);return Tn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Cy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Kne(t){var e=new Tn(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qne(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function sf(t,e,n,r,i,a,o,s,l){var c=new Tn(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=a,c[6]=o,c[7]=s,c[8]=l,c}function Xne(t,e,n,r,i,a,o,s,l,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=c,t}function fo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function KE(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function fp(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],d=e[8],f=d*o-s*c,h=-d*a+s*l,p=c*a-o*l,C=n*f+r*h+i*p;return C?(C=1/C,t[0]=f*C,t[1]=(-d*r+i*c)*C,t[2]=(s*r-i*o)*C,t[3]=h*C,t[4]=(d*n-i*l)*C,t[5]=(-s*n+i*a)*C,t[6]=p*C,t[7]=(-c*n+r*l)*C,t[8]=(o*n-r*a)*C,t):null}function Yne(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],d=e[8];return t[0]=o*d-s*c,t[1]=i*c-r*d,t[2]=r*s-i*o,t[3]=s*l-a*d,t[4]=n*d-i*l,t[5]=i*a-n*s,t[6]=a*c-o*l,t[7]=r*l-n*c,t[8]=n*o-r*a,t}function uu(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8];return e*(c*a-o*l)+n*(-c*i+o*s)+r*(l*i-a*s)}function Af(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=e[8],h=n[0],p=n[1],C=n[2],x=n[3],T=n[4],_=n[5],y=n[6],w=n[7],b=n[8];return t[0]=h*r+p*o+C*c,t[1]=h*i+p*s+C*d,t[2]=h*a+p*l+C*f,t[3]=x*r+T*o+_*c,t[4]=x*i+T*s+_*d,t[5]=x*a+T*l+_*f,t[6]=y*r+w*o+b*c,t[7]=y*i+w*s+b*d,t[8]=y*a+w*l+b*f,t}function Jne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=e[8],h=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=h*r+p*o+c,t[7]=h*i+p*s+d,t[8]=h*a+p*l+f,t}function Zne(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=e[8],h=Math.sin(n),p=Math.cos(n);return t[0]=p*r+h*o,t[1]=p*i+h*s,t[2]=p*a+h*l,t[3]=p*o-h*r,t[4]=p*s-h*i,t[5]=p*l-h*a,t[6]=c,t[7]=d,t[8]=f,t}function Qne(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ere(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function tre(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function nre(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function rre(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function ire(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,l=i+i,c=n*o,d=r*o,f=r*s,h=i*o,p=i*s,C=i*l,x=a*o,T=a*s,_=a*l;return t[0]=1-f-C,t[3]=d-_,t[6]=h+T,t[1]=d+_,t[4]=1-c-C,t[7]=p-x,t[2]=h-T,t[5]=p+x,t[8]=1-c-f,t}function are(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],d=e[8],f=e[9],h=e[10],p=e[11],C=e[12],x=e[13],T=e[14],_=e[15],y=n*s-r*o,w=n*l-i*o,b=n*c-a*o,M=r*l-i*s,I=r*c-a*s,A=i*c-a*l,k=d*x-f*C,U=d*T-h*C,B=d*_-p*C,z=f*T-h*x,K=f*_-p*x,J=h*_-p*T,X=y*J-w*K+b*z+M*B-I*U+A*k;return X?(X=1/X,t[0]=(s*J-l*K+c*z)*X,t[1]=(l*B-o*J-c*U)*X,t[2]=(o*K-s*B+c*k)*X,t[3]=(i*K-r*J-a*z)*X,t[4]=(n*J-i*B+a*U)*X,t[5]=(r*B-n*K-a*k)*X,t[6]=(x*A-T*I+_*M)*X,t[7]=(T*b-C*A-_*w)*X,t[8]=(C*I-x*b+_*y)*X,t):null}function ore(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function sre(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function lre(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function cre(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Fk(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function ure(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function fre(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function dre(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function hre(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],d=t[8],f=e[0],h=e[1],p=e[2],C=e[3],x=e[4],T=e[5],_=e[6],y=e[7],w=e[8];return Math.abs(n-f)<=Lt*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-h)<=Lt*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=Lt*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-C)<=Lt*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(o-x)<=Lt*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-T)<=Lt*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(l-_)<=Lt*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=Lt*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-w)<=Lt*Math.max(1,Math.abs(d),Math.abs(w))}var gre=Af,pre=Fk;const Vk=Object.freeze(Object.defineProperty({__proto__:null,add:cre,adjoint:Yne,clone:Kne,copy:qne,create:Pk,determinant:uu,equals:hre,exactEquals:dre,frob:lre,fromMat2d:rre,fromMat4:Cy,fromQuat:ire,fromRotation:tre,fromScaling:nre,fromTranslation:ere,fromValues:sf,identity:fo,invert:fp,mul:gre,multiply:Af,multiplyScalar:ure,multiplyScalarAndAdd:fre,normalFromMat4:are,projection:ore,rotate:Zne,scale:Qne,set:Xne,str:sre,sub:pre,subtract:Fk,translate:Jne,transpose:KE},Symbol.toStringTag,{value:"Module"}));function vc(){var t=new Tn(16);return Tn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function mre(t){var e=new Tn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Uk(t,e,n,r,i,a,o,s,l,c,d,f,h,p,C,x){var T=new Tn(16);return T[0]=t,T[1]=e,T[2]=n,T[3]=r,T[4]=i,T[5]=a,T[6]=o,T[7]=s,T[8]=l,T[9]=c,T[10]=d,T[11]=f,T[12]=h,T[13]=p,T[14]=C,T[15]=x,T}function vre(t,e,n,r,i,a,o,s,l,c,d,f,h,p,C,x,T){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=c,t[9]=d,t[10]=f,t[11]=h,t[12]=p,t[13]=C,t[14]=x,t[15]=T,t}function kt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yn(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Vr(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],d=e[8],f=e[9],h=e[10],p=e[11],C=e[12],x=e[13],T=e[14],_=e[15],y=n*s-r*o,w=n*l-i*o,b=n*c-a*o,M=r*l-i*s,I=r*c-a*s,A=i*c-a*l,k=d*x-f*C,U=d*T-h*C,B=d*_-p*C,z=f*T-h*x,K=f*_-p*x,J=h*_-p*T,X=y*J-w*K+b*z+M*B-I*U+A*k;return X?(X=1/X,t[0]=(s*J-l*K+c*z)*X,t[1]=(i*K-r*J-a*z)*X,t[2]=(x*A-T*I+_*M)*X,t[3]=(h*I-f*A-p*M)*X,t[4]=(l*B-o*J-c*U)*X,t[5]=(n*J-i*B+a*U)*X,t[6]=(T*b-C*A-_*w)*X,t[7]=(d*A-h*b+p*w)*X,t[8]=(o*K-s*B+c*k)*X,t[9]=(r*B-n*K-a*k)*X,t[10]=(C*I-x*b+_*y)*X,t[11]=(f*b-d*I-p*y)*X,t[12]=(s*U-o*z-l*k)*X,t[13]=(n*z-r*U+i*k)*X,t[14]=(x*w-C*M-T*y)*X,t[15]=(d*M-f*w+h*y)*X,t):null}function yre(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],d=e[8],f=e[9],h=e[10],p=e[11],C=e[12],x=e[13],T=e[14],_=e[15];return t[0]=s*(h*_-p*T)-f*(l*_-c*T)+x*(l*p-c*h),t[1]=-(r*(h*_-p*T)-f*(i*_-a*T)+x*(i*p-a*h)),t[2]=r*(l*_-c*T)-s*(i*_-a*T)+x*(i*c-a*l),t[3]=-(r*(l*p-c*h)-s*(i*p-a*h)+f*(i*c-a*l)),t[4]=-(o*(h*_-p*T)-d*(l*_-c*T)+C*(l*p-c*h)),t[5]=n*(h*_-p*T)-d*(i*_-a*T)+C*(i*p-a*h),t[6]=-(n*(l*_-c*T)-o*(i*_-a*T)+C*(i*c-a*l)),t[7]=n*(l*p-c*h)-o*(i*p-a*h)+d*(i*c-a*l),t[8]=o*(f*_-p*x)-d*(s*_-c*x)+C*(s*p-c*f),t[9]=-(n*(f*_-p*x)-d*(r*_-a*x)+C*(r*p-a*f)),t[10]=n*(s*_-c*x)-o*(r*_-a*x)+C*(r*c-a*s),t[11]=-(n*(s*p-c*f)-o*(r*p-a*f)+d*(r*c-a*s)),t[12]=-(o*(f*T-h*x)-d*(s*T-l*x)+C*(s*h-l*f)),t[13]=n*(f*T-h*x)-d*(r*T-i*x)+C*(r*h-i*f),t[14]=-(n*(s*T-l*x)-o*(r*T-i*x)+C*(r*l-i*s)),t[15]=n*(s*h-l*f)-o*(r*h-i*f)+d*(r*l-i*s),t}function wre(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],d=t[9],f=t[10],h=t[11],p=t[12],C=t[13],x=t[14],T=t[15],_=e*o-n*a,y=e*s-r*a,w=e*l-i*a,b=n*s-r*o,M=n*l-i*o,I=r*l-i*s,A=c*C-d*p,k=c*x-f*p,U=c*T-h*p,B=d*x-f*C,z=d*T-h*C,K=f*T-h*x;return _*K-y*z+w*B+b*U-M*k+I*A}function En(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=e[8],h=e[9],p=e[10],C=e[11],x=e[12],T=e[13],_=e[14],y=e[15],w=n[0],b=n[1],M=n[2],I=n[3];return t[0]=w*r+b*s+M*f+I*x,t[1]=w*i+b*l+M*h+I*T,t[2]=w*a+b*c+M*p+I*_,t[3]=w*o+b*d+M*C+I*y,w=n[4],b=n[5],M=n[6],I=n[7],t[4]=w*r+b*s+M*f+I*x,t[5]=w*i+b*l+M*h+I*T,t[6]=w*a+b*c+M*p+I*_,t[7]=w*o+b*d+M*C+I*y,w=n[8],b=n[9],M=n[10],I=n[11],t[8]=w*r+b*s+M*f+I*x,t[9]=w*i+b*l+M*h+I*T,t[10]=w*a+b*c+M*p+I*_,t[11]=w*o+b*d+M*C+I*y,w=n[12],b=n[13],M=n[14],I=n[15],t[12]=w*r+b*s+M*f+I*x,t[13]=w*i+b*l+M*h+I*T,t[14]=w*a+b*c+M*p+I*_,t[15]=w*o+b*d+M*C+I*y,t}function xr(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,l,c,d,f,h,p,C,x,T,_;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],l=e[2],c=e[3],d=e[4],f=e[5],h=e[6],p=e[7],C=e[8],x=e[9],T=e[10],_=e[11],t[0]=o,t[1]=s,t[2]=l,t[3]=c,t[4]=d,t[5]=f,t[6]=h,t[7]=p,t[8]=C,t[9]=x,t[10]=T,t[11]=_,t[12]=o*r+d*i+C*a+e[12],t[13]=s*r+f*i+x*a+e[13],t[14]=l*r+h*i+T*a+e[14],t[15]=c*r+p*i+_*a+e[15]),t}function nl(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Do(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),l,c,d,f,h,p,C,x,T,_,y,w,b,M,I,A,k,U,B,z,K,J,X,re;return s<Lt?null:(s=1/s,i*=s,a*=s,o*=s,l=Math.sin(n),c=Math.cos(n),d=1-c,f=e[0],h=e[1],p=e[2],C=e[3],x=e[4],T=e[5],_=e[6],y=e[7],w=e[8],b=e[9],M=e[10],I=e[11],A=i*i*d+c,k=a*i*d+o*l,U=o*i*d-a*l,B=i*a*d-o*l,z=a*a*d+c,K=o*a*d+i*l,J=i*o*d+a*l,X=a*o*d-i*l,re=o*o*d+c,t[0]=f*A+x*k+w*U,t[1]=h*A+T*k+b*U,t[2]=p*A+_*k+M*U,t[3]=C*A+y*k+I*U,t[4]=f*B+x*z+w*K,t[5]=h*B+T*z+b*K,t[6]=p*B+_*z+M*K,t[7]=C*B+y*z+I*K,t[8]=f*J+x*X+w*re,t[9]=h*J+T*X+b*re,t[10]=p*J+_*X+M*re,t[11]=C*J+y*X+I*re,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function qE(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],d=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*r,t[5]=o*i+d*r,t[6]=s*i+f*r,t[7]=l*i+h*r,t[8]=c*i-a*r,t[9]=d*i-o*r,t[10]=f*i-s*r,t[11]=h*i-l*r,t}function XE(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[8],d=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*r,t[1]=o*i-d*r,t[2]=s*i-f*r,t[3]=l*i-h*r,t[8]=a*r+c*i,t[9]=o*r+d*i,t[10]=s*r+f*i,t[11]=l*r+h*i,t}function YE(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],d=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*r,t[1]=o*i+d*r,t[2]=s*i+f*r,t[3]=l*i+h*r,t[4]=c*i-a*r,t[5]=d*i-o*r,t[6]=f*i-s*r,t[7]=h*i-l*r,t}function xy(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function JE(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ZE(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,l,c;return o<Lt?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),l=Math.cos(e),c=1-l,t[0]=r*r*c+l,t[1]=i*r*c+a*s,t[2]=a*r*c-i*s,t[3]=0,t[4]=r*i*c-a*s,t[5]=i*i*c+l,t[6]=a*i*c+r*s,t[7]=0,t[8]=r*a*c+i*s,t[9]=i*a*c-r*s,t[10]=a*a*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Cre(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xre(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sre(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bk(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,l=i+i,c=a+a,d=r*s,f=r*l,h=r*c,p=i*l,C=i*c,x=a*c,T=o*s,_=o*l,y=o*c;return t[0]=1-(p+x),t[1]=f+y,t[2]=h-_,t[3]=0,t[4]=f-y,t[5]=1-(d+x),t[6]=C+T,t[7]=0,t[8]=h+_,t[9]=C-T,t[10]=1-(d+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ere(t,e){var n=new Tn(3),r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=r*r+i*i+a*a+o*o;return f>0?(n[0]=(s*o+d*r+l*a-c*i)*2/f,n[1]=(l*o+d*i+c*r-s*a)*2/f,n[2]=(c*o+d*a+s*i-l*r)*2/f):(n[0]=(s*o+d*r+l*a-c*i)*2,n[1]=(l*o+d*i+c*r-s*a)*2,n[2]=(c*o+d*a+s*i-l*r)*2),Bk(t,e,n),t}function Gk(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function zk(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],l=e[8],c=e[9],d=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(l,c,d),t}function n2(t,e){var n=new Tn(3);zk(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],o=e[0]*r,s=e[1]*i,l=e[2]*a,c=e[4]*r,d=e[5]*i,f=e[6]*a,h=e[8]*r,p=e[9]*i,C=e[10]*a,x=o+d+C,T=0;return x>0?(T=Math.sqrt(x+1)*2,t[3]=.25*T,t[0]=(f-p)/T,t[1]=(h-l)/T,t[2]=(s-c)/T):o>d&&o>C?(T=Math.sqrt(1+o-d-C)*2,t[3]=(f-p)/T,t[0]=.25*T,t[1]=(s+c)/T,t[2]=(h+l)/T):d>C?(T=Math.sqrt(1+d-o-C)*2,t[3]=(h-l)/T,t[0]=(s+c)/T,t[1]=.25*T,t[2]=(f+p)/T):(T=Math.sqrt(1+C-o-d)*2,t[3]=(s-c)/T,t[0]=(h+l)/T,t[1]=(f+p)/T,t[2]=.25*T),t}function Wk(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],l=i+i,c=a+a,d=o+o,f=i*l,h=i*c,p=i*d,C=a*c,x=a*d,T=o*d,_=s*l,y=s*c,w=s*d,b=r[0],M=r[1],I=r[2];return t[0]=(1-(C+T))*b,t[1]=(h+w)*b,t[2]=(p-y)*b,t[3]=0,t[4]=(h-w)*M,t[5]=(1-(f+T))*M,t[6]=(x+_)*M,t[7]=0,t[8]=(p+y)*I,t[9]=(x-_)*I,t[10]=(1-(f+C))*I,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Tre(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],l=e[3],c=a+a,d=o+o,f=s+s,h=a*c,p=a*d,C=a*f,x=o*d,T=o*f,_=s*f,y=l*c,w=l*d,b=l*f,M=r[0],I=r[1],A=r[2],k=i[0],U=i[1],B=i[2],z=(1-(x+_))*M,K=(p+b)*M,J=(C-w)*M,X=(p-b)*I,re=(1-(h+_))*I,fe=(T+y)*I,pe=(C+w)*A,ie=(T-y)*A,te=(1-(h+x))*A;return t[0]=z,t[1]=K,t[2]=J,t[3]=0,t[4]=X,t[5]=re,t[6]=fe,t[7]=0,t[8]=pe,t[9]=ie,t[10]=te,t[11]=0,t[12]=n[0]+k-(z*k+X*U+pe*B),t[13]=n[1]+U-(K*k+re*U+ie*B),t[14]=n[2]+B-(J*k+fe*U+te*B),t[15]=1,t}function r2(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,l=i+i,c=n*o,d=r*o,f=r*s,h=i*o,p=i*s,C=i*l,x=a*o,T=a*s,_=a*l;return t[0]=1-f-C,t[1]=d+_,t[2]=h-T,t[3]=0,t[4]=d-_,t[5]=1-c-C,t[6]=p+x,t[7]=0,t[8]=h+T,t[9]=p-x,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _re(t,e,n,r,i,a,o){var s=1/(n-e),l=1/(i-r),c=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*l,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0,t}function jk(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Dre=jk;function bre(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function Ire(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),c=2/(i+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((o-s)*l*.5),t[9]=(i-a)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Hk(t,e,n,r,i,a,o){var s=1/(e-n),l=1/(r-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=(o+a)*c,t[15]=1,t}var QE=Hk;function Ore(t,e,n,r,i,a,o){var s=1/(e-n),l=1/(r-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=a*c,t[15]=1,t}function $k(t,e,n,r){var i,a,o,s,l,c,d,f,h,p,C=e[0],x=e[1],T=e[2],_=r[0],y=r[1],w=r[2],b=n[0],M=n[1],I=n[2];return Math.abs(C-b)<Lt&&Math.abs(x-M)<Lt&&Math.abs(T-I)<Lt?kt(t):(d=C-b,f=x-M,h=T-I,p=1/Math.hypot(d,f,h),d*=p,f*=p,h*=p,i=y*h-w*f,a=w*d-_*h,o=_*f-y*d,p=Math.hypot(i,a,o),p?(p=1/p,i*=p,a*=p,o*=p):(i=0,a=0,o=0),s=f*o-h*a,l=h*i-d*o,c=d*a-f*i,p=Math.hypot(s,l,c),p?(p=1/p,s*=p,l*=p,c*=p):(s=0,l=0,c=0),t[0]=i,t[1]=s,t[2]=d,t[3]=0,t[4]=a,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(i*C+a*x+o*T),t[13]=-(s*C+l*x+c*T),t[14]=-(d*C+f*x+h*T),t[15]=1,t)}function Mre(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],l=r[1],c=r[2],d=i-n[0],f=a-n[1],h=o-n[2],p=d*d+f*f+h*h;p>0&&(p=1/Math.sqrt(p),d*=p,f*=p,h*=p);var C=l*h-c*f,x=c*d-s*h,T=s*f-l*d;return p=C*C+x*x+T*T,p>0&&(p=1/Math.sqrt(p),C*=p,x*=p,T*=p),t[0]=C,t[1]=x,t[2]=T,t[3]=0,t[4]=f*T-h*x,t[5]=h*C-d*T,t[6]=d*x-f*C,t[7]=0,t[8]=d,t[9]=f,t[10]=h,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function Nre(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Rre(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Are(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Kk(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Lre(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function kre(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Pre(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Fre(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],d=t[8],f=t[9],h=t[10],p=t[11],C=t[12],x=t[13],T=t[14],_=t[15],y=e[0],w=e[1],b=e[2],M=e[3],I=e[4],A=e[5],k=e[6],U=e[7],B=e[8],z=e[9],K=e[10],J=e[11],X=e[12],re=e[13],fe=e[14],pe=e[15];return Math.abs(n-y)<=Lt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-w)<=Lt*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-b)<=Lt*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-M)<=Lt*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-I)<=Lt*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(s-A)<=Lt*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(l-k)<=Lt*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-U)<=Lt*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(d-B)<=Lt*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(f-z)<=Lt*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-K)<=Lt*Math.max(1,Math.abs(h),Math.abs(K))&&Math.abs(p-J)<=Lt*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(C-X)<=Lt*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(x-re)<=Lt*Math.max(1,Math.abs(x),Math.abs(re))&&Math.abs(T-fe)<=Lt*Math.max(1,Math.abs(T),Math.abs(fe))&&Math.abs(_-pe)<=Lt*Math.max(1,Math.abs(_),Math.abs(pe))}var i2=En,Vre=Kk;const Lf=Object.freeze(Object.defineProperty({__proto__:null,add:Are,adjoint:yre,clone:mre,copy:hr,create:vc,determinant:wre,equals:Fre,exactEquals:Pre,frob:Rre,fromQuat:r2,fromQuat2:Ere,fromRotation:ZE,fromRotationTranslation:Bk,fromRotationTranslationScale:Wk,fromRotationTranslationScaleOrigin:Tre,fromScaling:JE,fromTranslation:xy,fromValues:Uk,fromXRotation:Cre,fromYRotation:xre,fromZRotation:Sre,frustum:_re,getRotation:n2,getScaling:zk,getTranslation:Gk,identity:kt,invert:Vr,lookAt:$k,mul:i2,multiply:En,multiplyScalar:Lre,multiplyScalarAndAdd:kre,ortho:QE,orthoNO:Hk,orthoZO:Ore,perspective:Dre,perspectiveFromFieldOfView:Ire,perspectiveNO:jk,perspectiveZO:bre,rotate:Do,rotateX:qE,rotateY:XE,rotateZ:YE,scale:nl,set:vre,str:Nre,sub:Vre,subtract:Kk,targetTo:Mre,translate:xr,transpose:yn},Symbol.toStringTag,{value:"Module"}));function zt(){var t=new Tn(3);return Tn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qk(t){var e=new Tn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Xs(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function wa(t,e,n){var r=new Tn(3);return r[0]=t,r[1]=e,r[2]=n,r}function eT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Dn(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function io(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Er(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Xk(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function tT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Ure(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Bre(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Gre(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function zre(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Wre(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Za(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Li(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function Sy(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function Yk(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function Jk(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function rc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function nT(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ui(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function er(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xr(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=i*l-a*s,t[1]=a*o-r*l,t[2]=r*s-i*o,t}function jre(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t}function Hre(t,e,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,c=o*(a-1),d=o*(3-2*a);return t[0]=e[0]*s+n[0]*l+r[0]*c+i[0]*d,t[1]=e[1]*s+n[1]*l+r[1]*c+i[1]*d,t[2]=e[2]*s+n[2]*l+r[2]*c+i[2]*d,t}function $re(t,e,n,r,i,a){var o=1-a,s=o*o,l=a*a,c=s*o,d=3*a*s,f=3*l*o,h=l*a;return t[0]=e[0]*c+n[0]*d+r[0]*f+i[0]*h,t[1]=e[1]*c+n[1]*d+r[1]*f+i[1]*h,t[2]=e[2]*c+n[2]*d+r[2]*f+i[2]*h,t}function Kre(t,e){e=e||1;var n=Fo()*2*Math.PI,r=Fo()*2-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function vn(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function tg(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function qre(t,e,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],l=e[1],c=e[2],d=i*c-a*l,f=a*s-r*c,h=r*l-i*s,p=i*h-a*f,C=a*d-r*h,x=r*f-i*d,T=o*2;return d*=T,f*=T,h*=T,p*=2,C*=2,x*=2,t[0]=s+d+p,t[1]=l+f+C,t[2]=c+h+x,t}function Xre(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function Yre(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function Jre(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function rT(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],l=Math.sqrt(n*n+r*r+i*i),c=Math.sqrt(a*a+o*o+s*s),d=l*c,f=d&&er(t,e)/d;return Math.acos(Math.min(Math.max(f,-1),1))}function Zk(t){return t[0]=0,t[1]=0,t[2]=0,t}function Zre(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function vx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function yx(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=Lt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=Lt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Lt*Math.max(1,Math.abs(i),Math.abs(s))}var ka=Er,Qk=Xk,Qre=tT,eie=Sy,tie=Yk,iT=Xs,nie=Jk,rie=function(){var t=zt();return function(e,n,r,i,a,o){var s,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,s=r;s<l;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}();const iie=Object.freeze(Object.defineProperty({__proto__:null,add:io,angle:rT,bezier:$re,ceil:Ure,clone:qk,copy:eT,create:zt,cross:Xr,dist:eie,distance:Sy,div:Qre,divide:tT,dot:er,equals:yx,exactEquals:vx,floor:Bre,forEach:rie,fromValues:wa,hermite:Hre,inverse:nT,len:iT,length:Xs,lerp:jre,max:zre,min:Gre,mul:Qk,multiply:Xk,negate:rc,normalize:Ui,random:Kre,rotateX:Xre,rotateY:Yre,rotateZ:Jre,round:Wre,scale:Za,scaleAndAdd:Li,set:Dn,sqrDist:tie,sqrLen:nie,squaredDistance:Yk,squaredLength:Jk,str:Zre,sub:ka,subtract:Er,transformMat3:tg,transformMat4:vn,transformQuat:qre,zero:Zk},Symbol.toStringTag,{value:"Module"}));function eP(){var t=new Tn(4);return Tn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tP(t){var e=new Tn(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function nP(t,e,n,r){var i=new Tn(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function rP(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function iP(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function aP(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function a2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function oP(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function sP(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function aie(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function oie(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function sie(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function lie(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function cie(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function lP(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function uie(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function cP(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.hypot(n,r,i,a)}function uP(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return n*n+r*r+i*i+a*a}function aT(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function oT(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function fie(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function die(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function fP(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function dP(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function hie(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],a=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],d=e[0],f=e[1],h=e[2],p=e[3];return t[0]=f*c-h*l+p*s,t[1]=-(d*c)+h*o-p*a,t[2]=d*l-f*o+p*i,t[3]=-(d*s)+f*a-h*i,t}function hP(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t}function gie(t,e){e=e||1;var n,r,i,a,o,s;do n=Fo()*2-1,r=Fo()*2-1,o=n*n+r*r;while(o>=1);do i=Fo()*2-1,a=Fo()*2-1,s=i*i+a*a;while(s>=1);var l=Math.sqrt((1-o)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*l,t[3]=e*a*l,t}function Kl(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}function pie(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],l=n[2],c=n[3],d=c*r+s*a-l*i,f=c*i+l*r-o*a,h=c*a+o*i-s*r,p=-o*r-s*i-l*a;return t[0]=d*c+p*-o+f*-l-h*-s,t[1]=f*c+p*-s+h*-o-d*-l,t[2]=h*c+p*-l+d*-s-f*-o,t[3]=e[3],t}function mie(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function vie(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function gP(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function pP(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(n-o)<=Lt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=Lt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=Lt*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=Lt*Math.max(1,Math.abs(a),Math.abs(c))}var yie=a2,wie=oP,Cie=sP,xie=cP,Sie=uP,Eie=aT,Tie=oT,_ie=function(){var t=eP();return function(e,n,r,i,a,o){var s,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,s=r;s<l;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();const Die=Object.freeze(Object.defineProperty({__proto__:null,add:aP,ceil:aie,clone:tP,copy:rP,create:eP,cross:hie,dist:xie,distance:cP,div:Cie,divide:sP,dot:dP,equals:pP,exactEquals:gP,floor:oie,forEach:_ie,fromValues:nP,inverse:die,len:Eie,length:aT,lerp:hP,max:lie,min:sie,mul:wie,multiply:oP,negate:fie,normalize:fP,random:gie,round:cie,scale:lP,scaleAndAdd:uie,set:iP,sqrDist:Sie,sqrLen:Tie,squaredDistance:uP,squaredLength:oT,str:vie,sub:yie,subtract:a2,transformMat4:Kl,transformQuat:pie,zero:mie},Symbol.toStringTag,{value:"Module"}));function rl(){var t=new Tn(4);return Tn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function bie(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ey(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function mP(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>Lt?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Iie(t,e){var n=lT(t,e);return Math.acos(2*n*n-1)}function o2(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],l=n[1],c=n[2],d=n[3];return t[0]=r*d+o*s+i*c-a*l,t[1]=i*d+o*l+a*s-r*c,t[2]=a*d+o*c+r*l-i*s,t[3]=o*d-r*s-i*l-a*c,t}function vP(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+o*s,t[1]=i*l+a*s,t[2]=a*l-i*s,t[3]=o*l-r*s,t}function yP(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l-a*s,t[1]=i*l+o*s,t[2]=a*l+r*s,t[3]=o*l-i*s,t}function wP(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*s,t[1]=i*l-r*s,t[2]=a*l+o*s,t[3]=o*l-a*s,t}function Oie(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function CP(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=Math.sqrt(n*n+r*r+i*i),s=Math.exp(a),l=o>0?s*Math.sin(o)/o:0;return t[0]=n*l,t[1]=r*l,t[2]=i*l,t[3]=s*Math.cos(o),t}function xP(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=Math.sqrt(n*n+r*r+i*i),s=o>0?Math.atan2(o,a)/o:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+a*a),t}function Mie(t,e,n){return xP(t,e),TP(t,t,n),CP(t,t),t}function ng(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],l=n[0],c=n[1],d=n[2],f=n[3],h,p,C,x,T;return p=i*l+a*c+o*d+s*f,p<0&&(p=-p,l=-l,c=-c,d=-d,f=-f),1-p>Lt?(h=Math.acos(p),C=Math.sin(h),x=Math.sin((1-r)*h)/C,T=Math.sin(r*h)/C):(x=1-r,T=r),t[0]=x*i+T*l,t[1]=x*a+T*c,t[2]=x*o+T*d,t[3]=x*s+T*f,t}function Nie(t){var e=Fo(),n=Fo(),r=Fo(),i=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=a*Math.sin(2*Math.PI*r),t[3]=a*Math.cos(2*Math.PI*r),t}function Rie(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=a*s,t}function SP(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function EP(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+o]-e[o*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}function Aie(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),l=Math.cos(n),c=Math.sin(r),d=Math.cos(r);return t[0]=a*l*d-o*s*c,t[1]=o*s*d+a*l*c,t[2]=o*l*c-a*s*d,t[3]=o*l*d+a*s*c,t}function Lie(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var kie=tP,wx=nP,sT=rP,Pie=iP,Fie=aP,Vie=o2,TP=lP,lT=dP,Uie=hP,cT=aT,Bie=cT,uT=oT,Gie=uT,fT=fP,zie=gP,Wie=pP,jie=function(){var t=zt(),e=wa(1,0,0),n=wa(0,1,0);return function(r,i,a){var o=er(i,a);return o<-.999999?(Xr(t,e,i),iT(t)<1e-6&&Xr(t,n,i),Ui(t,t),Ey(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Xr(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,fT(r,r))}}(),Hie=function(){var t=rl(),e=rl();return function(n,r,i,a,o,s){return ng(t,r,o,s),ng(e,i,a,s),ng(n,t,e,2*s*(1-s)),n}}(),$ie=function(){var t=Pk();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],fT(e,EP(e,t))}}();const Kie=Object.freeze(Object.defineProperty({__proto__:null,add:Fie,calculateW:Oie,clone:kie,conjugate:SP,copy:sT,create:rl,dot:lT,equals:Wie,exactEquals:zie,exp:CP,fromEuler:Aie,fromMat3:EP,fromValues:wx,getAngle:Iie,getAxisAngle:mP,identity:bie,invert:Rie,len:Bie,length:cT,lerp:Uie,ln:xP,mul:Vie,multiply:o2,normalize:fT,pow:Mie,random:Nie,rotateX:vP,rotateY:yP,rotateZ:wP,rotationTo:jie,scale:TP,set:Pie,setAxes:$ie,setAxisAngle:Ey,slerp:ng,sqlerp:Hie,sqrLen:Gie,squaredLength:uT,str:Lie},Symbol.toStringTag,{value:"Module"}));function qie(){var t=new Tn(8);return Tn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function Xie(t){var e=new Tn(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Yie(t,e,n,r,i,a,o,s){var l=new Tn(8);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l}function Jie(t,e,n,r,i,a,o){var s=new Tn(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var l=i*.5,c=a*.5,d=o*.5;return s[4]=l*r+c*n-d*e,s[5]=c*r+d*t-l*n,s[6]=d*r+l*e-c*t,s[7]=-l*t-c*e-d*n,s}function _P(t,e,n){var r=n[0]*.5,i=n[1]*.5,a=n[2]*.5,o=e[0],s=e[1],l=e[2],c=e[3];return t[0]=o,t[1]=s,t[2]=l,t[3]=c,t[4]=r*c+i*l-a*s,t[5]=i*c+a*o-r*l,t[6]=a*c+r*s-i*o,t[7]=-r*o-i*s-a*l,t}function Zie(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function Qie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function eae(t,e){var n=rl();n2(n,e);var r=new Tn(3);return Gk(r,e),_P(t,n,r),t}function DP(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function tae(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function nae(t,e,n,r,i,a,o,s,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t}var rae=sT;function iae(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var aae=sT;function oae(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function sae(t,e){var n=e[4],r=e[5],i=e[6],a=e[7],o=-e[0],s=-e[1],l=-e[2],c=e[3];return t[0]=(n*c+a*o+r*l-i*s)*2,t[1]=(r*c+a*s+i*o-n*l)*2,t[2]=(i*c+a*l+n*s-r*o)*2,t}function lae(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0]*.5,l=n[1]*.5,c=n[2]*.5,d=e[4],f=e[5],h=e[6],p=e[7];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=o*s+i*c-a*l+d,t[5]=o*l+a*s-r*c+f,t[6]=o*c+r*l-i*s+h,t[7]=-r*s-i*l-a*c+p,t}function cae(t,e,n){var r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=s*o+d*r+l*a-c*i,h=l*o+d*i+c*r-s*a,p=c*o+d*a+s*i-l*r,C=d*o-s*r-l*i-c*a;return vP(t,e,n),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+C*r+h*a-p*i,t[5]=h*o+C*i+p*r-f*a,t[6]=p*o+C*a+f*i-h*r,t[7]=C*o-f*r-h*i-p*a,t}function uae(t,e,n){var r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=s*o+d*r+l*a-c*i,h=l*o+d*i+c*r-s*a,p=c*o+d*a+s*i-l*r,C=d*o-s*r-l*i-c*a;return yP(t,e,n),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+C*r+h*a-p*i,t[5]=h*o+C*i+p*r-f*a,t[6]=p*o+C*a+f*i-h*r,t[7]=C*o-f*r-h*i-p*a,t}function fae(t,e,n){var r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],f=s*o+d*r+l*a-c*i,h=l*o+d*i+c*r-s*a,p=c*o+d*a+s*i-l*r,C=d*o-s*r-l*i-c*a;return wP(t,e,n),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+C*r+h*a-p*i,t[5]=h*o+C*i+p*r-f*a,t[6]=p*o+C*a+f*i-h*r,t[7]=C*o-f*r-h*i-p*a,t}function dae(t,e,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],l=e[1],c=e[2],d=e[3];return t[0]=s*o+d*r+l*a-c*i,t[1]=l*o+d*i+c*r-s*a,t[2]=c*o+d*a+s*i-l*r,t[3]=d*o-s*r-l*i-c*a,s=e[4],l=e[5],c=e[6],d=e[7],t[4]=s*o+d*r+l*a-c*i,t[5]=l*o+d*i+c*r-s*a,t[6]=c*o+d*a+s*i-l*r,t[7]=d*o-s*r-l*i-c*a,t}function hae(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],l=n[1],c=n[2],d=n[3];return t[0]=r*d+o*s+i*c-a*l,t[1]=i*d+o*l+a*s-r*c,t[2]=a*d+o*c+r*l-i*s,t[3]=o*d-r*s-i*l-a*c,s=n[4],l=n[5],c=n[6],d=n[7],t[4]=r*d+o*s+i*c-a*l,t[5]=i*d+o*l+a*s-r*c,t[6]=a*d+o*c+r*l-i*s,t[7]=o*d-r*s-i*l-a*c,t}function gae(t,e,n,r){if(Math.abs(r)<Lt)return DP(t,e);var i=Math.hypot(n[0],n[1],n[2]);r=r*.5;var a=Math.sin(r),o=a*n[0]/i,s=a*n[1]/i,l=a*n[2]/i,c=Math.cos(r),d=e[0],f=e[1],h=e[2],p=e[3];t[0]=d*c+p*o+f*l-h*s,t[1]=f*c+p*s+h*o-d*l,t[2]=h*c+p*l+d*s-f*o,t[3]=p*c-d*o-f*s-h*l;var C=e[4],x=e[5],T=e[6],_=e[7];return t[4]=C*c+_*o+x*l-T*s,t[5]=x*c+_*s+T*o-C*l,t[6]=T*c+_*l+C*s-x*o,t[7]=_*c-C*o-x*s-T*l,t}function pae(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function bP(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[4],l=n[5],c=n[6],d=n[7],f=e[4],h=e[5],p=e[6],C=e[7],x=n[0],T=n[1],_=n[2],y=n[3];return t[0]=r*y+o*x+i*_-a*T,t[1]=i*y+o*T+a*x-r*_,t[2]=a*y+o*_+r*T-i*x,t[3]=o*y-r*x-i*T-a*_,t[4]=r*d+o*s+i*c-a*l+f*y+C*x+h*_-p*T,t[5]=i*d+o*l+a*s-r*c+h*y+C*T+p*x-f*_,t[6]=a*d+o*c+r*l-i*s+p*y+C*_+f*T-h*x,t[7]=o*d-r*s-i*l-a*c+C*y-f*x-h*T-p*_,t}var mae=bP;function vae(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var IP=lT;function yae(t,e,n,r){var i=1-r;return IP(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function wae(t,e){var n=Ty(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Cae(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var OP=cT,xae=OP,Ty=uT,Sae=Ty;function Eae(t,e){var n=Ty(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,a=e[2]/n,o=e[3]/n,s=e[4],l=e[5],c=e[6],d=e[7],f=r*s+i*l+a*c+o*d;t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=(s-r*f)/n,t[5]=(l-i*f)/n,t[6]=(c-a*f)/n,t[7]=(d-o*f)/n}return t}function Tae(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function _ae(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Dae(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],d=e[0],f=e[1],h=e[2],p=e[3],C=e[4],x=e[5],T=e[6],_=e[7];return Math.abs(n-d)<=Lt*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-f)<=Lt*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-h)<=Lt*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-p)<=Lt*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-C)<=Lt*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(s-x)<=Lt*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(l-T)<=Lt*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-_)<=Lt*Math.max(1,Math.abs(c),Math.abs(_))}const bae=Object.freeze(Object.defineProperty({__proto__:null,add:pae,clone:Xie,conjugate:Cae,copy:DP,create:qie,dot:IP,equals:Dae,exactEquals:_ae,fromMat4:eae,fromRotation:Qie,fromRotationTranslation:_P,fromRotationTranslationValues:Jie,fromTranslation:Zie,fromValues:Yie,getDual:iae,getReal:rae,getTranslation:sae,identity:tae,invert:wae,len:xae,length:OP,lerp:yae,mul:mae,multiply:bP,normalize:Eae,rotateAroundAxis:gae,rotateByQuatAppend:dae,rotateByQuatPrepend:hae,rotateX:cae,rotateY:uae,rotateZ:fae,scale:vae,set:nae,setDual:oae,setReal:aae,sqrLen:Sae,squaredLength:Ty,str:Tae,translate:lae},Symbol.toStringTag,{value:"Module"}));function dT(){var t=new Tn(2);return Tn!=Float32Array&&(t[0]=0,t[1]=0),t}function Iae(t){var e=new Tn(2);return e[0]=t[0],e[1]=t[1],e}function Cx(t,e){var n=new Tn(2);return n[0]=t,n[1]=e,n}function Oae(t,e){return t[0]=e[0],t[1]=e[1],t}function Mae(t,e,n){return t[0]=e,t[1]=n,t}function _y(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function kg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function MP(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function NP(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Nae(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Rae(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Aae(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Lae(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function kae(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function xx(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Pae(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function RP(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function AP(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function LP(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function kP(t){var e=t[0],n=t[1];return e*e+n*n}function Fae(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Vae(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Uae(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Bae(t,e){return t[0]*e[0]+t[1]*e[1]}function Gae(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function zae(t,e,n,r){var i=e[0],a=e[1];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t}function Wae(t,e){e=e||1;var n=Fo()*2*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function jae(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function Hae(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function $ae(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Kae(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function qae(t,e,n,r){var i=e[0]-n[0],a=e[1]-n[1],o=Math.sin(r),s=Math.cos(r);return t[0]=i*s-a*o+n[0],t[1]=i*o+a*s+n[1],t}function Xae(t,e){var n=t[0],r=t[1],i=e[0],a=e[1],o=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+a*a),s=o&&(n*i+r*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function Yae(t){return t[0]=0,t[1]=0,t}function Jae(t){return"vec2("+t[0]+", "+t[1]+")"}function Zae(t,e){return t[0]===e[0]&&t[1]===e[1]}function Qae(t,e){var n=t[0],r=t[1],i=e[0],a=e[1];return Math.abs(n-i)<=Lt*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-a)<=Lt*Math.max(1,Math.abs(r),Math.abs(a))}var eoe=LP,Pg=kg,toe=MP,noe=NP,roe=RP,ioe=AP,aoe=kP,ooe=function(){var t=dT();return function(e,n,r,i,a,o){var s,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,s=r;s<l;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}();const soe=Object.freeze(Object.defineProperty({__proto__:null,add:_y,angle:Xae,ceil:Nae,clone:Iae,copy:Oae,create:dT,cross:Gae,dist:roe,distance:RP,div:noe,divide:NP,dot:Bae,equals:Qae,exactEquals:Zae,floor:Rae,forEach:ooe,fromValues:Cx,inverse:Vae,len:eoe,length:LP,lerp:zae,max:Lae,min:Aae,mul:toe,multiply:MP,negate:Fae,normalize:Uae,random:Wae,rotate:qae,round:kae,scale:xx,scaleAndAdd:Pae,set:Mae,sqrDist:ioe,sqrLen:aoe,squaredDistance:AP,squaredLength:kP,str:Jae,sub:Pg,subtract:kg,transformMat2:jae,transformMat2d:Hae,transformMat3:$ae,transformMat4:Kae,zero:Yae},Symbol.toStringTag,{value:"Module"})),loe=Object.freeze(Object.defineProperty({__proto__:null,glMatrix:Jte,mat2:Sne,mat2d:$ne,mat3:Vk,mat4:Lf,quat:Kie,quat2:bae,vec2:soe,vec3:iie,vec4:Die},Symbol.toStringTag,{value:"Module"})),Sx=1e-6,PP="coincide",FP="disjoint";function coe(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function VP(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function UP(t,e,n,r){const i=[];ds(t,e,i);const a=on(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function BP(t,e,n){const r=on(t,e);let i=on(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function GP(t,e,n,r){const i=[];ds(t,e,i);const a=on(n,i),o=on(n,n);o!==0?(r[0]=t[0]-a*n[0]/o,r[1]=t[1]-a*n[1]/o,r[2]=t[2]-a*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function zP(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],o=[];ds(e,t,a),ds(n,t,o);const s=on(r,o),l=on(r,a);let c,d;return l<0?c=-l:c=l,s<0?d=-s*Sx:d=s*Sx,c<=d||(i.t=s/l,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function WP(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];uo(e,r,a);const o=a.map(f=>Math.abs(f));if(o[0]+o[1]+o[2]<Sx){const f=[];return ds(t,n,f),on(e,f)===0?i.error=PP:i.error=FP,i}let s;o[0]>o[1]&&o[0]>o[2]?s="x":o[1]>o[2]?s="y":s="z";const l=[],c=-on(e,t),d=-on(r,n);switch(s){case"x":l[0]=0,l[1]=(d*e[2]-c*r[2])/a[0],l[2]=(c*r[1]-d*e[1])/a[0];break;case"y":l[0]=(c*r[2]-d*e[2])/a[1],l[1]=0,l[2]=(d*e[0]-c*r[0])/a[1];break;case"z":l[0]=(d*e[1]-c*r[1])/a[2],l[1]=(c*r[0]-d*e[0])/a[2],l[2]=0;break}return i.l0=l,Rg(l,a,i.l1),i.intersection=!0,i}const uoe={evaluate:coe,distanceToPlane:VP,projectPoint:UP,projectVector:BP,generalizedProjectPoint:GP,intersectWithLine:zP,intersectWithPlane:WP,DISJOINT:FP,COINCIDE:PP};function foe(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>VP(n,e.origin,e.normal),t.projectPoint=(n,r)=>{UP(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>BP(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{GP(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>zP(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>WP(n,r,e.origin,e.normal)}const doe={normal:[0,0,1],origin:[0,0,0]};function jP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,doe,n),de.obj(t,e),de.setGetArray(t,e,["normal","origin"],3),foe(t,e)}const hoe=de.newInstance(jP,"vtkPlane");var Fi={newInstance:hoe,extend:jP,...uoe};const Dy=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function HP(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function il(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function hT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function gT(t){return hT(t,Dy)}function s2(t,e,n,r){const[i,a,o,s,l,c]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=o<n?o:n,t[3]=s>n?s:n,t[4]=l<r?l:r,t[5]=c>r?c:r,t}function pT(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)s2(t,...e[n]);else for(let n=0;n<e.length;n+=3)s2(t,...e.slice(n,n+3));return t}function $P(t,e,n,r,i,a,o){const[s,l,c,d,f,h]=t;return o===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],l),t[2]=Math.min(e[2],c),t[3]=Math.max(e[3],d),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],h)):(t[0]=Math.min(e,s),t[1]=Math.max(n,l),t[2]=Math.min(r,c),t[3]=Math.max(i,d),t[4]=Math.min(a,f),t[5]=Math.max(o,h)),t}function KP(t,e,n,r){const[i,a,o,s,l,c]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>s?n:s,t[4]=r,t[5]=r>c?r:c,i!==e||o!==n||l!==r}function qP(t,e,n,r){const[i,a,o,s,l,c]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<o?n:o,t[3]=n,t[4]=r<l?r:l,t[5]=r,a!==e||s!==n||c!==r}function XP(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function mT(t,e,n,r){return il(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function vT(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function goe(t,e,n,r){if(!il(t))return!1;const i=vT(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],mT(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function rg(t,e){return t[e*2+1]-t[e*2]}function by(t){return[rg(t,0),rg(t,1),rg(t,2)]}function YP(t){return t.slice(0,2)}function JP(t){return t.slice(2,4)}function ZP(t){return t.slice(4,6)}function QP(t){const e=by(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function eF(t){if(il(t)){const e=by(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function yT(t){return[t[0],t[2],t[4]]}function wT(t){return[t[1],t[3],t[5]]}function sm(t,e){return t<=0&&e>=0||t>=0&&e<=0}function CT(t,e){let n=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let a=4;a<6;a++)e[n++]=[t[r],t[i],t[a]];return e}function tF(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function nF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=CT(t,[]);for(let i=0;i<r.length;++i)vn(r[i],r[i],e);return gT(n),pT(n,r)}function rF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function iF(t,e,n,r){const i=[].concat(Dy),a=t.getData();for(let o=0;o<a.length;o+=3){const s=[a[o],a[o+1],a[o+2]],l=on(s,e);i[0]=Math.min(l,i[0]),i[1]=Math.max(l,i[1]);const c=on(s,n);i[2]=Math.min(c,i[2]),i[3]=Math.max(c,i[3]);const d=on(s,r);i[4]=Math.min(d,i[4]),i[5]=Math.max(d,i[5])}return i}function aF(t,e,n,r,i){let a=!0;const o=[];let s=0;const l=[],c=[0,0,0],d=0,f=1,h=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(o[p]=f,c[p]=t[2*p],a=!1):e[p]>t[2*p+1]?(o[p]=d,c[p]=t[2*p+1],a=!1):o[p]=h;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let p=0;p<3;p++)o[p]!==h&&n[p]!==0?l[p]=(c[p]-e[p])/n[p]:l[p]=-1;for(let p=0;p<3;p++)l[s]<l[p]&&(s=p);if(l[s]>1||l[s]<0)return 0;i[0]=l[s];for(let p=0;p<3;p++)if(s!==p){if(r[p]=e[p]+l[s]*n[p],r[p]<t[2*p]||r[p]>t[2*p+1])return 0}else r[p]=c[p];return 1}function oF(t,e,n){const r=[];let i=0,a=1,o=1;for(let s=4;s<=5;++s){r[2]=t[s];for(let l=2;l<=3;++l){r[1]=t[l];for(let c=0;c<=1;++c)if(r[0]=t[c],i=Fi.evaluate(n,e,r),o&&(a=i>=0?1:-1,o=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function sF(t,e){if(!(il(t)&&il(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function l2(t,e){if(!(il(t)&&il(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function c2(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function poe(t,e){return!(!l2(t,e)||!c2(t,...yT(e))||!c2(t,...wT(e)))}function lF(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let f=0;f<2;f++)for(let h=2;h<4;h++)for(let p=4;p<6;p++){const C=[t[f],t[h],t[p]];i[a++]=Fi.evaluate(n,e,C)}let o=2;for(;o--&&!(sm(i[r[o][0]],i[r[o][4]])&&sm(i[r[o][1]],i[r[o][5]])&&sm(i[r[o][2]],i[r[o][6]])&&sm(i[r[o][3]],i[r[o][7]])););if(o<0)return!1;const s=Math.sign(n[o]),l=Math.abs((t[o*2+1]-t[o*2])*n[o]);let c=s>0?1:0;for(let f=0;f<4;f++){if(l===0)continue;const h=Math.abs(i[r[o][f]])/l;s>0&&h<c&&(c=h),s<0&&h>c&&(c=h)}const d=(1-c)*t[o*2]+c*t[o*2+1];return s>0?t[o*2]=d:t[o*2+1]=d,!0}class moe{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Dy))}getBounds(){return this.bounds}equals(e){return HP(this.bounds,e)}isValid(){return il(this.bounds)}setBounds(e){return hT(this.bounds,e)}reset(){return gT(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s2(this.bounds,...n)}addPoints(e){return pT(this.bounds,e)}addBounds(e,n,r,i,a,o){return $P(this.bounds,e,n,r,i,a,o)}setMinPoint(e,n,r){return KP(this.bounds,e,n,r)}setMaxPoint(e,n,r){return qP(this.bounds,e,n,r)}inflate(e){return XP(this.bounds,e)}scale(e,n,r){return mT(this.bounds,e,n,r)}getCenter(){return vT(this.bounds)}getLength(e){return rg(this.bounds,e)}getLengths(){return by(this.bounds)}getMaxLength(){return QP(this.bounds)}getDiagonalLength(){return eF(this.bounds)}getMinPoint(){return yT(this.bounds)}getMaxPoint(){return wT(this.bounds)}getXRange(){return YP(this.bounds)}getYRange(){return JP(this.bounds)}getZRange(){return ZP(this.bounds)}getCorners(e){return CT(this.bounds,e)}computeCornerPoints(e,n){return tF(this.bounds,e,n)}computeLocalBounds(e,n,r){return iF(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return nF(this.bounds,e,n)}computeScale3(e){return rF(this.bounds,e)}cutWithPlane(e,n){return lF(this.bounds,e,n)}intersectBox(e,n,r,i){return aF(this.bounds,e,n,r,i)}intersectPlane(e,n){return oF(this.bounds,e,n)}intersect(e){return sF(this.bounds,e)}intersects(e){return l2(this.bounds,e)}containsPoint(e,n,r){return c2(this.bounds,e,n,r)}contains(e){return l2(this.bounds,e)}}function voe(t){const e=t&&t.bounds;return new moe(e)}const yoe={equals:HP,isValid:il,setBounds:hT,reset:gT,addPoint:s2,addPoints:pT,addBounds:$P,setMinPoint:KP,setMaxPoint:qP,inflate:XP,scale:mT,scaleAboutCenter:goe,getCenter:vT,getLength:rg,getLengths:by,getMaxLength:QP,getDiagonalLength:eF,getMinPoint:yT,getMaxPoint:wT,getXRange:YP,getYRange:JP,getZRange:ZP,getCorners:CT,computeCornerPoints:tF,computeLocalBounds:iF,transformBounds:nF,computeScale3:rF,cutWithPlane:lF,intersectBox:aF,intersectPlane:oF,intersect:sF,intersects:l2,containsPoint:c2,contains:poe,INIT_BOUNDS:Dy};var Gn={newInstance:voe,...yoe};const{vtkErrorMacro:oO,vtkWarningMacro:woe}=de;function Coe(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:Po(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:o}=t.getArrayWithIndex(i);return a!=null?(e.arrays[o]={data:r},o):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,o)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(o=>{const s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){let l=t.getArrayByName(o.getName());if(l)if(o.getNumberOfComponents()===l.getNumberOfComponents())if(i>-1&&i<o.getNumberOfTuples()){const c=a>-1?a:i;l.insertTuple(c,o.getTuple(i))}else l.insertTuples(0,o.getTuples());else oO("Unhandled case in passData");else if(i<0||i>o.getNumberOfTuples())t.addArray(o),r.getAttributes(o).forEach(c=>{t.setAttribute(o,c)});else{const c=o.getNumberOfComponents();let d=o.getNumberOfValues();const f=a>-1?a:i;d<=f*c&&(d=(f+1)*c),l=Bt.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:c,values:de.newTypedArray(o.getDataType(),d),size:0}),l.insertTuple(f,o.getTuple(i)),t.addArray(l),r.getAttributes(o).forEach(h=>{t.setAttribute(l,h)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(l=>{const c=t.getFlag(l.getName());if(c!==!1&&!(e.doCopyAllOff&&c!==!0)&&l){let d=t.getArrayByName(l.getName());if(d)if(l.getNumberOfComponents()===d.getNumberOfComponents())if(i>-1&&i<l.getNumberOfTuples()){const f=o>-1?o:i;d.interpolateTuple(f,l,i,l,a,s),woe("Unexpected case in interpolateData")}else d.insertTuples(l.getTuples());else oO("Unhandled case in interpolateData");else if(i<0||a<0||i>l.getNumberOfTuples())t.addArray(l),r.getAttributes(l).forEach(f=>{t.setAttribute(l,f)});else{const f=l.getNumberOfComponents();let h=l.getNumberOfValues();const p=o>-1?o:i;h<=p*f&&(h=(p+1)*f),d=Bt.newInstance({name:l.getName(),dataType:l.getDataType(),numberOfComponents:f,values:de.newTypedArray(l.getDataType(),h),size:0}),d.interpolateTuple(p,l,i,l,a,s),t.addArray(d),r.getAttributes(l).forEach(C=>{t.setAttribute(d,C)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const xoe={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function cF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xoe,n),de.obj(t,e),Coe(t,e)}const Soe=de.newInstance(cF,"vtkFieldData");var Eoe={newInstance:Soe,extend:cF};const Toe={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},_oe={MAX:0,EXACT:1,NOLIMIT:2},Doe={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},boe={DUPLICATEPOINT:1,HIDDENPOINT:2},Ioe={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Ooe="vtkGhostType",u2={DEFAULT:0,SINGLE:1,DOUBLE:2};var uF={AttributeCopyOperations:Ioe,AttributeLimitTypes:_oe,AttributeTypes:Toe,CellGhostTypes:Doe,DesiredOutputPrecision:u2,PointGhostTypes:boe,ghostArrayName:Ooe};const{AttributeTypes:Tl,AttributeCopyOperations:Zc}=uF,{vtkWarningMacro:lm}=de;function Moe(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(o){let s=n.find(l=>Tl[l.toUpperCase()]===o||typeof o!="number"&&l.toLowerCase()===o.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=o=>!0,t.setAttribute=(o,s)=>{const l=r(s);if(o&&l.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return lm(`Cannot set attribute ${l}. The attribute must be a vtkDataArray.`),-1;if(o&&!t.checkNumberOfComponents(o,l))return lm(`Cannot set attribute ${l}. Incorrect number of components.`),-1;let c=e[`active${l}`];if(c>=0&&c<e.arrays.length){if(e.arrays[c]===o)return c;t.removeArrayByIndex(c)}return o?(c=t.addArray(o),e[`active${l}`]=c):e[`active${l}`]=-1,t.modified(),e[`active${l}`]},t.getAttributes=o=>n.filter(s=>t[`get${s}`]()===o),t.setActiveAttributeByName=(o,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s),t.setActiveAttributeByIndex=(o,s)=>{const l=r(s);if(o>=0&&o<e.arrays.length){if(l.toUpperCase()!=="PEDIGREEIDS"){const c=t.getArrayByIndex(o);if(!c.isA("vtkDataArray"))return lm(`Cannot set attribute ${l}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(c,l))return lm(`Cannot set attribute ${l}. Incorrect number of components.`),-1}return e[`active${l}`]=o,t.modified(),o}return o===-1&&(e[`active${l}`]=o,t.modified()),-1},t.getActiveAttribute=o=>{const s=r(o);return t[`get${s}`]()},t.removeAllArrays=()=>{n.forEach(o=>{e[`active${o}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=o=>(o!==-1&&n.forEach(s=>{o===e[`active${s}`]?e[`active${s}`]=-1:o<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(o)),n.forEach(o=>{const s=`active${o}`;t[`get${o}`]=()=>t.getArrayByIndex(e[s]),t[`set${o}`]=l=>t.setAttribute(l,o),t[`setActive${o}`]=l=>t.setActiveAttributeByIndex(t.getArrayWithIndex(l).index,o),t[`copy${o}Off`]=()=>{const l=o.toUpperCase();e.copyAttributeFlags[Zc.PASSDATA][Tl[l]]=!1},t[`copy${o}On`]=()=>{const l=o.toUpperCase();e.copyAttributeFlags[Zc.PASSDATA][Tl[l]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Zc).filter(o=>o!=="ALLCOPY").forEach(o=>{e.copyAttributeFlags[Zc[o]]=Object.keys(Tl).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,l)=>(s[Tl[l]]=!0,s),[])}),e.copyAttributeFlags[Zc.COPYTUPLE][Tl.GLOBALIDS]=!1,e.copyAttributeFlags[Zc.INTERPOLATE][Tl.GLOBALIDS]=!1,e.copyAttributeFlags[Zc.COPYTUPLE][Tl.PEDIGREEIDS]=!1},t.initialize=de.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(o=>{!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(Bt.newInstance(e.dataArrays[o]))});const a=t.shallowCopy;t.shallowCopy=(o,s)=>{a(o,s),e.arrays=o.getArrays().map(l=>{const c=l.newClone();return c.shallowCopy(l,s),{data:c}})},t.initializeAttributeCopyFlags()}const Noe={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function fF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Noe,n),Eoe.extend(t,e,n),de.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),Moe(t,e)}const Roe=de.newInstance(fF,"vtkDataSetAttributes");var sO={newInstance:Roe,extend:fF,...uF};const Aoe={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},Loe={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var koe={FieldDataTypes:Aoe,FieldAssociations:Loe};const Ex=["pointData","cellData","fieldData"];function Poe(t,e){e.classHierarchy.push("vtkDataSet"),Ex.forEach(r=>{e[r]?e[r]=Po(e[r]):e[r]=sO.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),Ex.forEach(a=>{e[a]=sO.newInstance(),e[a].shallowCopy(r.getReferenceByName(a))})}}const Foe={};function dF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Foe,n),de.obj(t,e),de.setGet(t,e,Ex),Poe(t,e)}const Voe=de.newInstance(dF,"vtkDataSet");var ed={newInstance:Voe,extend:dF,...koe};const bo={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var hF={StructuredType:bo};const{StructuredType:ks}=hF;function Uoe(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?ks.EMPTY:e===3?ks.XYZ_GRID:e===2?t[0]===t[1]?ks.YZ_PLANE:t[2]===t[3]?ks.XZ_PLANE:ks.XY_PLANE:e===1?t[0]<t[1]?ks.X_LINE:t[2]<t[3]?ks.Y_LINE:ks.Z_LINE:ks.SINGLE_POINT}var Boe={getDataDescriptionFromExtent:Uoe,...hF};const{vtkErrorMacro:Qc}=de;function Goe(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Qc("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const o=e.extent.some((s,l)=>s!==a[l]);return o&&(e.extent=a.slice(),e.dataDescription=Boe.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,r,i;if(e.deleted){Qc("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],i=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{Qc("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(r*=n[i]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return Qc("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case bo.EMPTY:return null;case bo.SINGLE_POINT:break;case bo.X_LINE:i[0]=n;break;case bo.Y_LINE:i[1]=n;break;case bo.Z_LINE:i[2]=n;break;case bo.XY_PLANE:i[0]=n%r[0],i[1]=n/r[0];break;case bo.YZ_PLANE:i[1]=n%r[1],i[2]=n/r[1];break;case bo.XZ_PLANE:i[0]=n%r[0],i[2]=n/r[0];break;case bo.XYZ_GRID:i[0]=n%r[0],i[1]=n/r[0]%r[1],i[2]=n/(r[0]*r[1]);break;default:Qc("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(i,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>Gn.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>Gn.inflate([...e.extent],.5),t.computeTransforms=()=>{xy(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],nl(e.indexToWorld,e.indexToWorld,e.spacing),Vr(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return vn(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return vn(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Gn.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Gn.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>Gn.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);const a=[0,0,0],o=[0,0,0];Gn.computeCornerPoints(i,a,o),Kv(a,a),Kv(o,o);const s=t.getDimensions();Xv(a,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],a),Xv(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);const l=s[0],c=s[0]*s[1],d=t.getPointData().getScalars().getData();let f=-1/0,h=1/0,p=0,C=0,x=0;for(let w=a[2];w<=o[2];w++)for(let b=a[1];b<=o[1];b++){let M=a[0]+b*l+w*c;for(let I=a[0];I<=o[0];I++){if(!r||r([I,b,w],i)){const A=d[M];A>f&&(f=A),A<h&&(h=A),p+=A*A,C+=A,x+=1}++M}}const T=x>0?C/x:0,_=x?Math.abs(p/x-T*T):0,y=Math.sqrt(_);return{minimum:h,maximum:f,average:T,variance:_,sigma:y,count:x}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let a=r;for(let o=0;o<3;++o)i[o]=a,a*=n[o*2+1]-n[o*2]+1;return i},t.computeOffsetIndex=n=>{let[r,i,a]=n;const o=t.getExtent(),s=t.getPointData().getScalars().getNumberOfComponents(),l=t.computeIncrements(o,s);return Math.floor((Math.round(r)-o[0])*l[0]+(Math.round(i)-o[2])*l[1]+(Math.round(a)-o[4])*l[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),i=t.worldToIndex(n);for(let a=0;a<3;++a)if(i[a]<r[a*2]||i[a]>r[a*2+1])return Qc(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=i)return Qc(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,r)}}const zoe={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:bo.EMPTY};function xT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zoe,n),ed.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=fo(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),de.get(t,e,["indexToWorld","worldToIndex"]),de.setGetArray(t,e,["origin","spacing"],3),de.setGetArray(t,e,["direction"],9),de.getArray(t,e,["extent"],6),Goe(t,e)}const gF=de.newInstance(xT,"vtkImageData");var yc={newInstance:gF,extend:xT};const Woe=Object.freeze(Object.defineProperty({__proto__:null,default:yc,extend:xT,newInstance:gF},Symbol.toStringTag,{value:"Module"}));function joe(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array}const Hoe="WebGL",f2=Object.create(null);function pF(t,e){f2[t]=e}function $oe(){return Object.keys(f2)}function mF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return f2[t]&&f2[t](e)}function Koe(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mF(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const i=r.getViewProps(),a=e._views[0].getViewNodeFor(r);i.forEach(o=>{if(o.getVisibility()){n.propCount+=1;const s=o.getMapper&&o.getMapper();if(s&&s.getPrimitiveCount){const l=a.getViewNodeFor(s);if(l){l.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=l.getAllocatedGPUMemoryInBytes()/1e6);const c=s.getPrimitiveCount();Object.keys(c).forEach(d=>{n[d]||(n[d]=0),n[d]+=c[d]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return de.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(n,r):void 0).filter(i=>!!i)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0)}const qoe={defaultViewAPI:Hoe,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function vF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qoe,n),de.obj(t,e),de.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),de.get(t,e,["neverRendered"]),de.getArray(t,e,["renderers","childRenderWindows"]),de.moveToProtected(t,e,["views"]),de.event(t,e,"completion"),Koe(t,e)}const Xoe=de.newInstance(vF,"vtkRenderWindow");var Yoe={newInstance:Xoe,extend:vF,registerViewConstructor:pF,listViewAPIs:$oe,newAPISpecificView:mF};const Fg={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Ft={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var yF={Wrap:Fg,Filter:Ft};const wF=new Float32Array(1),Joe=new Int32Array(wF.buffer);function Zoe(t){wF[0]=t;const e=Joe[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function Qoe(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var Vl={fromHalf:Qoe,toHalf:Zoe};const{vtkErrorMacro:ese}=de,tse=["Build","Render"];function nse(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let o=0;o<e.children.length;o++)e.children[o].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const o=e.children[i].getViewNodeFor(r);if(o)return o}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];t.addMissingNode(a)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const s=a.getRenderable();s&&e._renderableChildMap.set(s,a)}a.setVisited(!0)}},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const s=a.getRenderable();s&&e._renderableChildMap.delete(s),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return ese("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const rse={renderable:null,myFactory:null,children:[],visited:!1};function CF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rse,n),de.obj(t,e),de.event(t,e,"event"),e._renderableChildMap=new Map,de.get(t,e,["visited"]),de.setGet(t,e,["_parent","renderable","myFactory"]),de.getArray(t,e,["children"]),de.moveToProtected(t,e,["parent"]),nse(t,e)}const ise=de.newInstance(CF,"vtkViewNode");var $n={newInstance:ise,extend:CF,PASS_TYPES:tse};function ase(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const ose={};function xF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ose,n),de.obj(t,e),ase(t,e)}const sse=de.newInstance(xF,"vtkViewNodeFactory");var ST={newInstance:sse,extend:xF};const SF=Object.create(null);function jr(t,e){SF[t]=e}function lse(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const cse={};function EF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cse,n),e.overrides=SF,ST.extend(t,e,n),lse(t,e)}const use=de.newInstance(EF,"vtkOpenGLViewNodeFactory");var fse={newInstance:use,extend:EF};const{Wrap:Gs,Filter:yi}=yF,{VtkDataTypes:Fn}=Bt,{vtkDebugMacro:v4,vtkErrorMacro:L0,vtkWarningMacro:lO}=_i,{toHalf:dse}=Vl;function hse(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent()),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(yi.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(yi.LINEAR),t.setMagnificationFilter(yi.LINEAR)):(t.setMinificationFilter(yi.NEAREST),t.setMagnificationFilter(yi.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Gs.REPEAT),t.setWrapS(Gs.REPEAT),t.setWrapT(Gs.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(yi.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(yi.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,Fn.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(yi.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,Fn.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const d=e.renderable.getInputData(0);if(d&&d.getPointData().getScalars()){const f=d.getExtent(),h=d.getPointData().getScalars(),p=[];for(let C=0;C<e.renderable.getNumberOfInputPorts();++C){const x=e.renderable.getInputData(C),T=x?x.getPointData().getScalars().getData():null;T&&p.push(T)}e.renderable.getInterpolate()&&h.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(yi.LINEAR_MIPMAP_LINEAR)),p.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,h.getNumberOfComponents(),h.getDataType(),p):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,h.getNumberOfComponents(),h.getDataType(),h.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=c=>{c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let c=!1;if(e.context&&e.handle){let d=0;switch(e.target){case e.context.TEXTURE_2D:d=e.context.TEXTURE_BINDING_2D;break;default:lO("impossible case");break}c=e.context.getIntegerv(d)===e.handle}return c},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(c,d)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,d)),e.internalFormat||v4(`Unable to find suitable internal format for T=${c} NC= ${d}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&lO("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(c,d)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,d,e.oglNorm16Ext,e.useHalfFloat),f||(f||(v4("Unsupported internal texture type!"),v4(`Unable to find suitable internal format for T=${c} NC= ${d}`)),f)},t.setInternalFormat=c=>{e._forceInternalFormat=!0,c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=(c,d)=>(e.format=t.getDefaultFormat(c,d),e.format),t.getDefaultFormat=(c,d)=>{if(e._openGLRenderWindow.getWebgl2())switch(d){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(d){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=c=>{if(e._openGLRenderWindow.getWebgl2())switch(c){case Fn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(e.oglNorm16Ext&&!e.useHalfFloat&&Fn.SHORT):return e.context.SHORT;case(e.oglNorm16Ext&&!e.useHalfFloat&&Fn.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(e.useHalfFloat&&Fn.SHORT):return e.context.HALF_FLOAT;case(e.useHalfFloat&&Fn.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case Fn.FLOAT:case Fn.VOID:default:return e.context.FLOAT}switch(c){case Fn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case Fn.FLOAT:case Fn.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const d=e.context.getExtension("OES_texture_half_float");if(d&&e.context.getExtension("OES_texture_half_float_linear"))return d.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||d)&&(e.openGLDataType=t.getDefaultDataType(c)),e.openGLDataType},t.getShiftAndScale=()=>{let c=0,d=1;switch(e.openGLDataType){case e.context.BYTE:d=127.5,c=d-128;break;case e.context.UNSIGNED_BYTE:d=255,c=0;break;case e.context.SHORT:d=32767.5,c=d-32768;break;case e.context.UNSIGNED_SHORT:d=65536,c=0;break;case e.context.INT:d=21474836475e-1,c=d-2147483648;break;case e.context.UNSIGNED_INT:d=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:d}},t.getOpenGLFilterMode=c=>{switch(c){case yi.NEAREST:return e.context.NEAREST;case yi.LINEAR:return e.context.LINEAR;case yi.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case yi.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case yi.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case yi.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=c=>{switch(c){case Gs.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Gs.REPEAT:return e.context.REPEAT;case Gs.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function n(c,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const h=[];let p=e.width*e.height*e.components;if(f&&(p*=e.depth),c!==Fn.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let x=0;x<d.length;x++)if(d[x]){const T=d[x].length>p?d[x].subarray(0,p):d[x];h.push(new Float32Array(T))}else h.push(null);if(c!==Fn.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let x=0;x<d.length;x++)if(d[x]){const T=d[x].length>p?d[x].subarray(0,p):d[x];h.push(new Uint8Array(T))}else h.push(null);let C=!1;if(e._openGLRenderWindow.getWebgl2())C=e.openGLDataType===e.context.HALF_FLOAT;else{const x=e.context.getExtension("OES_texture_half_float");C=x&&e.openGLDataType===x.HALF_FLOAT_OES}if(C)for(let x=0;x<d.length;x++)if(d[x]){const T=new Uint16Array(p),_=d[x];for(let y=0;y<p;y++)T[y]=dse(_[y]);h.push(T)}else h.push(null);if(h.length===0)for(let x=0;x<d.length;x++)h.push(d[x]);return h}function r(c){if(e._openGLRenderWindow.getWebgl2())return c;const d=[],f=e.width,h=e.height,p=e.components;if(c&&(!af(f)||!af(h))){const C=e.context.getExtension("OES_texture_half_float"),x=Na(f),T=Na(h),_=x*T*e.components;for(let y=0;y<c.length;y++)if(c[y]!==null){let w=null;const b=h/T,M=f/x;let I=!1;e.openGLDataType===e.context.FLOAT?w=new Float32Array(_):C&&e.openGLDataType===C.HALF_FLOAT_OES?(w=new Uint16Array(_),I=!0):w=new Uint8Array(_);for(let A=0;A<T;A++){const k=A*x*p,U=A*b;let B=Math.floor(U),z=Math.ceil(U);z>=h&&(z=h-1);const K=U-B,J=1-K;B=B*f*p,z=z*f*p;for(let X=0;X<x;X++){const re=X*p,fe=X*M;let pe=Math.floor(fe),ie=Math.ceil(fe);ie>=f&&(ie=f-1);const te=fe-pe;pe*=p,ie*=p;for(let ee=0;ee<p;ee++)I?w[k+re+ee]=Vl.toHalf(Vl.fromHalf(c[y][B+pe+ee])*J*(1-te)+Vl.fromHalf(c[y][B+ie+ee])*J*te+Vl.fromHalf(c[y][z+pe+ee])*K*(1-te)+Vl.fromHalf(c[y][z+ie+ee])*K*te):w[k+re+ee]=c[y][B+pe+ee]*J*(1-te)+c[y][B+ie+ee]*J*te+c[y][z+pe+ee]*K*(1-te)+c[y][z+ie+ee]*K*te}}d.push(w),e.width=x,e.height=T}else d.push(null)}if(d.length===0)for(let C=0;C<c.length;C++)d.push(c[C]);return d}function i(c){var d;return e._openGLRenderWindow?e.resizable||(d=e.renderable)!=null&&d.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&e.oglNorm16Ext&&(c===Fn.UNSIGNED_SHORT||c===Fn.SHORT)):!1:!1}t.create2DFromRaw=function(c,d,f,h,p){let C=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(h,!0),t.getInternalFormat(h,f),t.getFormat(h,f),!e.internalFormat||!e.format||!e.openGLDataType)return L0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=c,e.height=d,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const T=n(h,[p]),_=r(T);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,C),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(h)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),_[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,_[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,_[0]),e.generateMipmap&&e.context.generateMipmap(e.target),C&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(h,e.oglNorm16Ext,e.useHalfFloat),t.deactivate(),!0},t.createCubeFromRaw=(c,d,f,h,p)=>{if(t.getOpenGLDataType(h),t.getInternalFormat(h,f),t.getFormat(h,f),!e.internalFormat||!e.format||!e.openGLDataType)return L0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=c,e.height=d,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=p.length/6-1,t.createTexture(),t.bind();const C=n(h,p),x=r(C),T=[];let _=e.width,y=e.height;for(let w=0;w<x.length;w++){w%6===0&&w!==0&&(_/=2,y/=2),T[w]=Yf(h,y*_*e.components);for(let b=0;b<y;++b){const M=b*_*e.components,I=(y-b-1)*_*e.components;T[w].set(x[w].slice(I,I+_*e.components),M)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(h)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let w=0;w<6;w++){let b=0,M=e.width,I=e.height;for(;M>=1&&I>=1;){let A=null;b<=e.maxLevel&&(A=T[6*b+w]),i(h)?A!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+w,b,0,0,M,I,e.format,e.openGLDataType,A):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+w,b,e.internalFormat,M,I,0,e.format,e.openGLDataType,A),b++,M/=2,I/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(h,e.oglNorm16Ext,e.useHalfFloat),t.deactivate(),!0},t.createDepthFromRaw=(c,d,f,h)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===Fn.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(L0("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=d,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),h!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,h)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,h),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,e.oglNorm16Ext,e.useHalfFloat),t.deactivate(),!0)),t.create2DFromImage=c=>{if(t.getOpenGLDataType(Fn.UNSIGNED_CHAR),t.getInternalFormat(Fn.UNSIGNED_CHAR,4),t.getFormat(Fn.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return L0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const d=!e._openGLRenderWindow.getWebgl2()&&(!af(c.width)||!af(c.height)),f=document.createElement("canvas");f.width=d?Na(c.width):c.width,f.height=d?Na(c.height):c.height,e.width=f.width,e.height=f.height;const h=f.getContext("2d");h.translate(0,f.height),h.scale(1,-1),h.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height);const p=f;return i(Fn.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),p!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,p)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,p),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(Fn.UNSIGNED_CHAR,e.oglNorm16Ext,e.useHalfFloat),t.deactivate(),!0};function a(c,d,f){const h=new Array(f),p=new Array(f);for(let C=0;C<f;++C)h[C]=c[C],p[C]=d[C]-c[C]||1;return{scale:p,offset:h}}function o(c,d){for(let f=0;f<c.length;f++){const h=c[f],p=d[f]+h;if(h<-2048||h>2048||p<-2048||p>2048)return!1}return!0}function s(c,d,f,h){t.getOpenGLDataType(c);let p=!1;if(e._openGLRenderWindow.getWebgl2())p=e.openGLDataType===e.context.HALF_FLOAT;else{const x=e.context.getExtension("OES_texture_half_float");p=x&&e.openGLDataType===x.HALF_FLOAT_OES}const C=p&&(o(d,f)||h);e.useHalfFloat=C}function l(c,d){const f=c.getNumberOfComponents(),h=c.getDataType(),p=c.getData(),C=new Array(f),x=new Array(f);for(let _=0;_<f;++_){const[y,w]=c.getRange(_);C[_]=y,x[_]=w}const T=a(C,x,f);return s(h,T.offset,T.scale,d),e.useHalfFloat||t.getOpenGLDataType(h,!0),{numComps:f,dataType:h,data:p,scaleOffsets:T}}t.create2DFilterableFromRaw=function(c,d,f,h,p){let C=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(c,d,Bt.newInstance({numberOfComponents:f,dataType:h,values:p}),C)},t.create2DFilterableFromDataArray=function(c,d,f){let h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:p,dataType:C,data:x}=l(f,h);t.create2DFromRaw(c,d,p,C,x)},t.create3DFromRaw=(c,d,f,h,p,C)=>{if(t.getOpenGLDataType(p),t.getInternalFormat(p,h),t.getFormat(p,h),!e.internalFormat||!e.format||!e.openGLDataType)return L0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=h,e.width=c,e.height=d,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const _=n(p,[C],!0),y=r(_);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(p)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),y[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,y[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,y[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(p,e.oglNorm16Ext,e.useHalfFloat),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,d,f,h,p,C){let x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(c,d,f,Bt.newInstance({numberOfComponents:h,dataType:p,values:C}),x)},t.create3DFilterableFromDataArray=function(c,d,f,h){let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:C,dataType:x,data:T,scaleOffsets:_}=l(h,p),y=c*d*f,w=[],b=[];for(let ee=0;ee<C;++ee)w[ee]=0,b[ee]=1;e.volumeInfo={scale:b,offset:w,dataComputedScale:_.scale,dataComputedOffset:_.offset,width:c,height:d,depth:f};const M=structuredClone(_);if(e._openGLRenderWindow.getWebgl2()){if(e.oglNorm16Ext&&!e.useHalfFloat&&x===Fn.SHORT){for(let De=0;De<C;++De)e.volumeInfo.scale[De]=32767;return t.create3DFromRaw(c,d,f,C,x,T)}if(e.oglNorm16Ext&&!e.useHalfFloat&&x===Fn.UNSIGNED_SHORT){for(let De=0;De<C;++De)e.volumeInfo.scale[De]=65535;return t.create3DFromRaw(c,d,f,C,x,T)}if(x===Fn.FLOAT||e.useHalfFloat&&(x===Fn.SHORT||x===Fn.UNSIGNED_SHORT))return t.create3DFromRaw(c,d,f,C,x,T);if(x===Fn.UNSIGNED_CHAR){for(let De=0;De<C;++De)e.volumeInfo.scale[De]=255;return t.create3DFromRaw(c,d,f,C,x,T)}const ee=new Float32Array(y*C);e.volumeInfo.offset=M.offset,e.volumeInfo.scale=M.scale;let we=0;const Ce=M.scale.map(De=>1/De);for(let De=0;De<y;De++)for(let Re=0;Re<C;Re++)ee[we]=(T[we]-M.offset[Re])*Ce[Re],we++;return t.create3DFromRaw(c,d,f,C,Fn.FLOAT,ee)}let I=(ee,we,Ce,De,Re)=>{ee[we]=Ce},A=Fn.UNSIGNED_CHAR;if(x===Fn.UNSIGNED_CHAR)for(let ee=0;ee<C;++ee)M.offset[ee]=0,M.scale[ee]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(A=Fn.FLOAT,I=(ee,we,Ce,De,Re)=>{ee[we]=(Ce-De)/Re}):(A=Fn.UNSIGNED_CHAR,I=(ee,we,Ce,De,Re)=>{ee[we]=255*(Ce-De)/Re});if(t.getOpenGLDataType(A),t.getInternalFormat(A,C),t.getFormat(A,C),!e.internalFormat||!e.format||!e.openGLDataType)return L0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=C,e.depth=1,e.numberOfDimensions=2;let k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);k>4096&&(A===Fn.FLOAT||C>=3)&&(k=4096);let U=1,B=1;y>k*k&&(U=Math.ceil(Math.sqrt(y/(k*k))),B=U);let z=Math.sqrt(y)/U;z=Na(z);const K=Math.floor(z*U/c),J=Math.ceil(f/K),X=Na(d*J/B);e.width=z,e.height=X,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=K,e.volumeInfo.yreps=J,e.volumeInfo.xstride=U,e.volumeInfo.ystride=B,e.volumeInfo.offset=M.offset,e.volumeInfo.scale=M.scale;let re;const fe=z*X*C;A===Fn.FLOAT?re=new Float32Array(fe):re=new Uint8Array(fe);let pe=0;const ie=Math.floor(c/U),te=Math.floor(d/B);for(let ee=0;ee<J;ee++){const we=Math.min(K,f-ee*K),Ce=C*(e.width-we*Math.floor(c/U));for(let De=0;De<te;De++){for(let Re=0;Re<we;Re++){const Oe=C*((ee*K+Re)*c*d+B*De*c);for(let Ve=0;Ve<ie;Ve++)for(let Ge=0;Ge<C;Ge++)I(re,pe,T[Oe+U*Ve*C+Ge],M.offset[Ge],M.scale[Ge]),pe++}pe+=Ce}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(A)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),re!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,re)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,re),t.deactivate(),!0},t.setOpenGLRenderWindow=c=>{e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=c=>c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1}const gse={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Gs.CLAMP_TO_EDGE,wrapT:Gs.CLAMP_TO_EDGE,wrapR:Gs.CLAMP_TO_EDGE,minificationFilter:yi.NEAREST,magnificationFilter:yi.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,useHalfFloat:!0,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0};function TF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gse,n),$n.extend(t,e,n),e.sendParametersTime={},ir(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},ir(e.textureBuildTime,{mtime:0}),sp(t,e,["format","openGLDataType"]),Ur(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),aa(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),lp(t,e,["openGLRenderWindow"]),hse(t,e)}const _F=Ln(TF,"vtkOpenGLTexture");var Dr={newInstance:_F,extend:TF,...yF};jr("vtkTexture",_F);function pse(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){Sn("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{Sn("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){Sn("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{Sn("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else Sn("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else Sn("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){Sn("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=Dr.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(Ft.LINEAR),r.setMagnificationFilter(Ft.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,un.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const mse={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function DF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mse,n),ir(t,e),e.colorBuffers&&Sn("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Jf(t,e,["colorBuffers"]),pse(t,e)}const vse=Ln(DF,"vtkFramebuffer");var Iy={newInstance:vse,extend:DF};function yse(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${de.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}),e.delegates.forEach(i=>{i.traverse(n,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}))}}const wse={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function bF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wse,n),de.obj(t,e),de.get(t,e,["currentOperation"]),de.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),de.moveToProtected(t,e,["currentParent"]),yse(t,e)}const Cse=de.newInstance(bF,"vtkRenderPass");var ET={newInstance:Cse,extend:bF};const Ys={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var IF={ObjectType:Ys};const{ObjectType:nv}=IF,xse={};function Sse(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case nv.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case nv.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case nv.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,o="";t.getType=()=>r,t.setType=s=>{r=s},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=s=>{const l=n(s);return i===null&&(i=e.context.createBuffer(),r=s),n(r)===l},t.upload=(s,l)=>t.generateBuffer(l)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,a=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>o}const Ese={objectType:nv.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function OF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ese,n),de.obj(t,e),de.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),de.moveToProtected(t,e,["openGLRenderWindow"]),Sse(t,e)}const Tse=de.newInstance(OF);var Hs={newInstance:Tse,extend:OF,...xse,...IF};const MF={FLAT:0,GOURAUD:1,PHONG:2},Si={POINTS:0,WIREFRAME:1,SURFACE:2},_se=MF;var NF={Shading:MF,Representation:Si,Interpolation:_se};const{vtkErrorMacro:cO}=de;function Dse(t,e){const n=new Float64Array(3);nT(n,e);const r=new Float64Array(16);return Wk(r,rl(),t,n),r}function bse(t,e){return t===null||e===null?!1:!(vx(t,[0,0,0])&&vx(e,[1,1,1]))}function Ise(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Ys.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=a.points.getData();let l=null,c=null,d=null;const f=a.colors?a.colors.getNumberOfComponents():0,h=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,l=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(te=>{te&&(e.customData.push({data:te.getData(),offset:4*e.blockSize,components:te.getNumberOfComponents(),name:te.getName()}),e.blockSize+=te.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=h,e.blockSize+=h,c=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,d=a.colors.getData(),e.colorBO||(e.colorBO=Hs.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,C=0,x=0,T=0,_=0,y=0,w;const b={anythingToPoints(te,ee,we){for(let Ce=0;Ce<te;++Ce)w(ee[we+Ce])},linesToWireframe(te,ee,we){for(let Ce=0;Ce<te-1;++Ce)w(ee[we+Ce]),w(ee[we+Ce+1])},polysToWireframe(te,ee,we){if(te>2)for(let Ce=0;Ce<te;++Ce)w(ee[we+Ce]),w(ee[we+(Ce+1)%te])},stripsToWireframe(te,ee,we){if(te>2){for(let Ce=0;Ce<te-1;++Ce)w(ee[we+Ce]),w(ee[we+Ce+1]);for(let Ce=0;Ce<te-2;Ce++)w(ee[we+Ce]),w(ee[we+Ce+2])}},polysToSurface(te,ee,we){for(let Ce=0;Ce<te-2;Ce++)w(ee[we+0]),w(ee[we+Ce+1]),w(ee[we+Ce+2])},stripsToSurface(te,ee,we){for(let Ce=0;Ce<te-2;Ce++)w(ee[we+Ce]),w(ee[we+Ce+1+Ce%2]),w(ee[we+Ce+1+(Ce+1)%2])}},M={anythingToPoints(te,ee){return te},linesToWireframe(te,ee){return te>1?(te-1)*2:0},polysToWireframe(te,ee){return te>2?te*2:0},stripsToWireframe(te,ee){return te>2?te*4-6:0},polysToSurface(te,ee){return te>2?(te-2)*3:0},stripsToSurface(te,ee,we){return te>2?(te-2)*3:0}};let I=null,A=null;i===Si.POINTS||r==="verts"?(I=b.anythingToPoints,A=M.anythingToPoints):i===Si.WIREFRAME||r==="lines"?(I=b[`${r}ToWireframe`],A=M[`${r}ToWireframe`]):(I=b[`${r}ToSurface`],A=M[`${r}ToSurface`]);const k=n.getData(),U=k.length;let B=0;for(let te=0;te<U;)B+=A(k[te],k),te+=k[te]+1;let z=null;const K=new Float32Array(B*e.blockSize);d&&(z=new Uint8Array(B*4));let J=0,X=0,re=0,fe=0;for(let te=0;te<3;++te){const ee=a.points.getRange(te),we=ee[1]-ee[0];re+=we*we;const Ce=.5*(ee[1]+ee[0]);fe+=Ce*Ce}if(re>0&&(Math.abs(fe)/re>1e6||Math.abs(Math.log10(re))>3||re===0&&fe>1e6)){const te=new Float64Array(3),ee=new Float64Array(3);for(let we=0;we<3;++we){const Ce=a.points.getRange(we),De=Ce[1]-Ce[0];te[we]=.5*(Ce[1]+Ce[0]),ee[we]=De>0?1/De:1}t.setCoordShiftAndScale(te,ee)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(B),o.cells=new Int32Array(B);else{const te=new Int32Array(B+o.points.length);te.set(o.points),o.points=te;const ee=new Int32Array(B+o.cells.length);ee.set(o.cells),o.cells=ee}let ie=a.vertexOffset;w=function(ee){if(o&&(o.points[ie]=ee,o.cells[ie]=y+a.cellOffset),++ie,p=ee*3,e.coordShiftAndScaleEnabled?(K[J++]=(s[p++]-e.coordShift[0])*e.coordScale[0],K[J++]=(s[p++]-e.coordShift[1])*e.coordScale[1],K[J++]=(s[p++]-e.coordShift[2])*e.coordScale[2]):(K[J++]=s[p++],K[J++]=s[p++],K[J++]=s[p++]),l!==null&&(a.haveCellNormals?C=(y+a.cellOffset)*3:C=ee*3,K[J++]=l[C++],K[J++]=l[C++],K[J++]=l[C++]),e.customData.forEach(we=>{_=ee*we.components;for(let Ce=0;Ce<we.components;++Ce)K[J++]=we.data[_++]}),c!==null){x=ee*h;for(let we=0;we<h;++we)K[J++]=c[x++]}d!==null&&(a.haveCellScalars?T=(y+a.cellOffset)*f:T=ee*f,z[X++]=d[T++],z[X++]=d[T++],z[X++]=d[T++],z[X++]=f===4?d[T++]:255)};for(let te=0;te<U;)I(k[te],k,te+1),te+=k[te]+1,y++;return e.elementCount=B,t.upload(K,Ys.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(z,Ys.ARRAY_BUFFER)),y},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){cO("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){cO("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!yx(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!yx(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=bse(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=Dse(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const Ose={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function RF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ose,n),Hs.extend(t,e,n),de.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),de.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),Ise(t,e)}const Mse=de.newInstance(RF);var Nse={newInstance:Mse,extend:RF};const{vtkErrorMacro:Rse}=de;function Ase(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return Rse(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const Lse={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function AF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lse,n),de.obj(t,e),de.setGet(t,e,["shaderType","source","error","handle","context"]),Ase(t,e)}const kse=de.newInstance(AF,"vtkShader");var y4={newInstance:kse,extend:AF};const{vtkErrorMacro:Jo}=de;function Pse(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),o=t.replace(a,i);return{replace:o!==i,result:o}}function Fse(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Jo(e.error),0):t.link()?(t.setCompiled(!0),1):(Jo(`Links failed: ${e.error}`),0):(Jo(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Jo(e.fragmentShader.getError()),0):(Jo(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Jo(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return Jo(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const o=t.findUniform(n);if(o===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(Jo("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return Jo("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const Vse={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function LF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vse,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=y4.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=y4.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=y4.newInstance(),e.geometryShader.setShaderType("Geometry"),de.obj(t,e),de.get(t,e,["lastCameraMTime"]),de.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Fse(t,e)}const Use=de.newInstance(LF,"vtkShaderProgram");var Le={newInstance:Use,extend:LF,substitute:Pse};function Bse(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let l=0;l<s;++l)n.enableVertexAttribArray(o.index+l),n.vertexAttribPointer(o.index+l,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*l/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+l,1):n.vertexAttribDivisor(o.index+l,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let l=0;l<s;++l)n.enableVertexAttribArray(o.index+l),n.vertexAttribPointer(o.index+l,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*l/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+l,0):n.vertexAttribDivisor(o.index+l,0)),n.disableVertexAttribArray(o.index+l)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,o,s,l,c)=>t.addAttributeArrayWithDivisor(n,r,i,a,o,s,l,c,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,o,s,l,c,d,f)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==Ys.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const h=e.context,p={};if(p.name=i,p.index=h.getAttribLocation(e.handleProgram,i),p.offset=a,p.stride=o,p.type=s,p.size=l,p.normalize=c,p.isMatrix=f,p.divisor=d,p.Index===-1)return!1;if(r.bind(),h.enableVertexAttribArray(p.index),h.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):h.vertexAttribDivisor(p.index,1)),p.buffer=r.getHandle(),!e.supported){let C=!1;for(let x=0;x<e.buffers.length;++x){const T=e.buffers[x];if(T.buffer===p.buffer){C=!0;let _=!1;for(let y=0;y<T.attributes.length;++y)T.attributes[y].name===i&&(_=!0,T.attributes[y]=p);_||T.attributes.push(p)}}C||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,o,s,l,c,d)=>{const f=t.addAttributeArrayWithDivisor(n,r,i,a,o,s,l,c,d,!0);if(!f)return f;const h=e.context,p=h.getAttribLocation(e.handleProgram,i);for(let C=1;C<l;C++)h.enableVertexAttribArray(p+C),h.vertexAttribPointer(p+C,l,s,c,o,a+o*C/l),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+C,1):h.vertexAttribDivisor(p+C,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const Gse={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function kF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gse,n),e.buffers=[],de.obj(t,e),de.get(t,e,["supported"]),de.setGet(t,e,["forceEmulation"]),Bse(t,e)}const zse=de.newInstance(kF,"vtkOpenGLVertexArrayObject");var TT={newInstance:zse,extend:kF};const Il={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function Wse(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const o=t.getOpenGLMode(i),s=t.haveWideLines(n,r),l=e.context,c=l.getParameter(l.DEPTH_WRITEMASK);e.pointPicking&&l.depthMask(!1),o===l.LINES&&s?(t.updateShaders(n,r,a),l.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(l.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),l.drawArrays(o,0,e.CABO.getElementCount()),l.lineWidth(1));const f=(o===l.POINTS?1:0)||(o===l.LINES?2:3);return e.pointPicking&&l.depthMask(c),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===Si.POINTS||r===Il.Points?e.context.POINTS:n===Si.WIREFRAME||r===Il.Lines||r===Il.TrisEdges||r===Il.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),o=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===Il.Points||r.getProperty().getRepresentation()===Si.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=Le.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=Le.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=Le.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=Le.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Il.Points?2:e.primitiveType===Il.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const jse={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function PF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jse,n),de.obj(t,e),e.shaderSourceTime={},de.obj(e.shaderSourceTime),e.attributeUpdateTime={},de.obj(e.attributeUpdateTime),de.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=Le.newInstance(),e.VAO=TT.newInstance(),e.CABO=Nse.newInstance(),Wse(t,e)}const Hse=de.newInstance(PF);var ys={newInstance:Hse,extend:PF,primTypes:Il};const{Representation:Nh,Interpolation:Rh}=NF;function uO(t){return()=>de.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function $se(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=uO("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=uO("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Rh.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Rh.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Rh.PHONG),t.getInterpolationAsString=()=>de.enumToString(Rh,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Nh.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Nh.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Nh.POINTS),t.getRepresentationAsString=()=>de.enumToString(Nh,e.representation)}const Kse={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Rh.GOURAUD,representation:Nh.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function FF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kse,n),de.obj(t,e),de.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),de.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),$se(t,e)}const qse=de.newInstance(FF,"vtkProperty");var td={newInstance:qse,extend:FF,...NF};const{Representation:Xse}=td,{vtkErrorMacro:fO}=de;function Yse(t){const e=Le.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const Jse=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function Zse(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=Bt.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=Bt.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=Bt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",Xse.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),i=n.getContext();e.framebuffer=Iy.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Dr.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=Dr.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=Dr.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),Jse,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||fO("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||fO("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,i)=>{if(e.deleted)return;const a=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const l=e.framebuffer.getSize();l===null||l[0]!==a[0]||l[1]!==a[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=TT.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();o.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),o.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?Yse:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const Qse={framebuffer:null,copyShader:null,tris:null};function VF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qse,n),ET.extend(t,e,n),e.VBOBuildTime={},de.obj(e.VBOBuildTime,{mtime:0}),e.tris=ys.newInstance(),de.get(t,e,["framebuffer"]),Zse(t,e)}const ele=de.newInstance(VF,"vtkOpenGLOrderIndependentTranslucentPass");var tle={newInstance:ele,extend:VF};function nle(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const i=n.getRenderable().getNumberOfLayers(),a=n.getRenderable().getRenderersByReference();for(let o=0;o<i;o++)for(let s=0;s<a.length;s++){const l=a[s],c=n.getViewNodeFor(l);if(l.getDraw()&&l.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),c.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const d=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Iy.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const f=e.framebuffer.getSize();(f===null||f[0]!==d[0]||f[1]!==d[1])&&(e.framebuffer.create(d[0],d[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),c.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),c.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=tle.newInstance()),e.translucentPass.traverse(n,c,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),c.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),c.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const rle={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function UF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rle,n),ET.extend(t,e,n),de.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),nle(t,e)}const ile=de.newInstance(UF,"vtkForwardPass");var ale={newInstance:ile,extend:UF};const ea={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var BF={PassTypes:ea};const{FieldAssociations:ole}=ed;function sle(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,i,a,o)=>{},t.selectAsync=async(n,r,i,a,o)=>{const s=await t.getSourceDataAsync(n,r,i,a,o);return s?s.generateSelection(r,i,a,o):[]}}const lle={fieldAssociation:ole.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function GF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lle,n),de.obj(t,e),de.setGet(t,e,["fieldAssociation","captureZValues"]),sle(t,e)}const cle=de.newInstance(GF,"vtkHardwareSelector");var ule={newInstance:cle,extend:GF};const fle={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},dle={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var hle={SelectionContent:fle,SelectionField:dle};function gle(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const ple={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function zF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ple,n),de.obj(t,e),e.properties={},de.setGet(t,e,["contentType","fieldType","properties","selectionList"]),gle(t,e)}const mle=de.newInstance(zF,"vtkSelectionNode");var WF={newInstance:mle,extend:zF,...hle};const{PassTypes:Kr}=BF,{SelectionContent:vle,SelectionField:dO}=WF,{FieldAssociations:ig}=ed,{vtkErrorMacro:jF}=de,Ul=1;function HF(t){return`${t.propID} ${t.compositeID}`}function $F(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4;return n[i+3]}function zs(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4,a=n[i],o=n[i+1];return(n[i+2]*256+o)*256+a}function KF(t,e){let n=e;return n<<=24,n|=t,n}function yle(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],a=zs(i[0],i[1],t.pixBuffer[Kr.ACTOR_PASS],t.area);if(a<=0||a-Ul>=t.props.length)return null;const o={};o.valid=!0,o.propID=a-Ul,o.prop=t.props[o.propID];let s=zs(i[0],i[1],t.pixBuffer[Kr.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),o.compositeID=s-Ul,t.captureZValues){const d=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;o.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,o.displayPosition=e}if(t.pixBuffer[Kr.ID_LOW24]&&$F(i[0],i[1],t.pixBuffer[Kr.ID_LOW24],t.area)===0)return o;const l=zs(i[0],i[1],t.pixBuffer[Kr.ID_LOW24],t.area),c=zs(i[0],i[1],t.pixBuffer[Kr.ID_HIGH24],t.area);return o.attributeID=KF(l,c),o}}function qF(t,e,n,r,i){const a=[];let o=0;return e.forEach((s,l)=>{const c=WF.newInstance();switch(c.setContentType(vle.INDICES),t){case ig.FIELD_ASSOCIATION_CELLS:c.setFieldType(dO.CELL);break;case ig.FIELD_ASSOCIATION_POINTS:c.setFieldType(dO.POINT);break;default:jF("Unknown field association")}c.getProperties().propID=s.info.propID,c.getProperties().prop=s.info.prop,c.getProperties().compositeID=s.info.compositeID,c.getProperties().attributeID=s.info.attributeID,c.getProperties().pixelCount=s.pixelCount,n&&(c.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],c.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),c.setSelectionList(s.attributeIDs),a[o]=c,o++}),a}function wle(t,e,n,r,i){const a=Math.floor(e),o=Math.floor(n),s=Math.floor(r),l=Math.floor(i),c=new Map,d=[0,0];for(let f=o;f<=l;f++)for(let h=a;h<=s;h++){const C=yle(t,[h,f],0,d);if(C&&C.valid){const x=HF(C);if(!c.has(x))c.set(x,{info:C,pixelCount:1,attributeIDs:[C.attributeID]});else{const T=c.get(x);T.pixelCount++,t.captureZValues&&C.zValue<T.info.zValue&&(T.info=C),T.attributeIDs.indexOf(C.attributeID)===-1&&T.attributeIDs.push(C.attributeID)}}}return qF(t.fieldAssociation,c,t.captureZValues,t.renderer,t.openGLRenderWindow)}function Cle(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Iy.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==r[0]||i[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===ig.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),a=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),a&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,i,a,o,s)=>{if(e._renderer=r,i===void 0){const c=e._openGLRenderWindow.getSize();t.setArea(0,0,c[0]-1,c[1]-1)}else t.setArea(i,a,o,s);if(!t.captureBuffers())return!1;const l={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return l.generateSelection=function(){for(var c=arguments.length,d=new Array(c),f=0;f<c;f++)d[f]=arguments[f];return wle(l,...d)},l},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return jF("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();for(t.beginSelection(),e.currentPass=Kr.MIN_KNOWN_PASS;e.currentPass<=Kr.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Kr.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),t.processPixelBuffers());return t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,i)=>{t.isPropHit(i)&&r.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=r=>{if(r===Kr.ID_HIGH24){if(e.fieldAssociation===ig.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===ig.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(i),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Kr.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const a=i[0].getFramebuffer();a.saveCurrentBindingsAndBuffers(),a.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),a.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let i=0;for(let a=0;a<=e.area[3]-e.area[1];a++)for(let o=0;o<=e.area[2]-e.area[0];o++){let s=zs(o,a,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=r=>{e.currentPass===Kr.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Ul),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Kr.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Ul)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>de.enumToString(Kr,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,i,a)=>{const o=i<0?0:i;if(o===0){if(a[0]=r[0],a[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const d=[r[0]-e.area[0],r[1]-e.area[1]],f=zs(d[0],d[1],e.pixBuffer[Kr.ACTOR_PASS],e.area);if(f<=0||f-Ul>=e.props.length)return null;const h={};h.valid=!0,h.propID=f-Ul,h.prop=e.props[h.propID];let p=zs(d[0],d[1],e.pixBuffer[Kr.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),h.compositeID=p-Ul,e.captureZValues){const T=(d[1]*(e.area[2]-e.area[0]+1)+d[0])*4;h.zValue=(256*e.zBuffer[T]+e.zBuffer[T+1])/65535,h.displayPosition=r}if(e.pixBuffer[Kr.ID_LOW24]&&$F(d[0],d[1],e.pixBuffer[Kr.ID_LOW24],e.area)===0)return h;const C=zs(d[0],d[1],e.pixBuffer[Kr.ID_LOW24],e.area),x=zs(d[0],d[1],e.pixBuffer[Kr.ID_HIGH24],e.area);return h.attributeID=KF(C,x),h}const s=[r[0],r[1]],l=[0,0];let c=t.getPixelInformation(r,0,a);if(c&&c.valid)return c;for(let d=1;d<o;++d){for(let f=s[1]>d?s[1]-d:0;f<=s[1]+d;++f)if(l[1]=f,s[0]>=d&&(l[0]=s[0]-d,c=t.getPixelInformation(l,0,a),c&&c.valid)||(l[0]=s[0]+d,c=t.getPixelInformation(l,0,a),c&&c.valid))return c;for(let f=s[0]>=d?s[0]-(d-1):0;f<=s[0]+(d-1);++f)if(l[0]=f,s[1]>=d&&(l[1]=s[1]-d,c=t.getPixelInformation(l,0,a),c&&c.valid)||(l[1]=s[1]+d,c=t.getPixelInformation(l,0,a),c&&c.valid))return c}return a[0]=r[0],a[1]=r[1],null},t.generateSelection=(r,i,a,o)=>{const s=Math.floor(r),l=Math.floor(i),c=Math.floor(a),d=Math.floor(o),f=new Map,h=[0,0];for(let p=l;p<=d;p++)for(let C=s;C<=c;C++){const x=[C,p],T=t.getPixelInformation(x,0,h);if(T&&T.valid){const _=HF(T);if(!f.has(_))f.set(_,{info:T,pixelCount:1,attributeIDs:[T.attributeID]});else{const y=f.get(_);y.pixelCount++,e.captureZValues&&T.zValue<y.info.zValue&&(y.info=T),y.attributeIDs.indexOf(T.attributeID)===-1&&y.attributeIDs.push(T.attributeID)}}}return qF(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,i)=>{e._openGLRenderWindow=r,e._renderer=i};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const xle={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function XF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xle,n),ule.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),de.setGetArray(t,e,["area"],4),de.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),de.setGetArray(t,e,["propColorValue"],3),de.moveToProtected(t,e,["renderer","openGLRenderWindow"]),de.event(t,e,"event"),Cle(t,e)}const Sle=de.newInstance(XF,"vtkOpenGLHardwareSelector");var _T={newInstance:Sle,extend:XF,...BF},YF={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(_,y){var w=_[0],b=_[1],M=_[2],I=_[3];w+=(b&M|~b&I)+y[0]-680876936|0,w=(w<<7|w>>>25)+b|0,I+=(w&b|~w&M)+y[1]-389564586|0,I=(I<<12|I>>>20)+w|0,M+=(I&w|~I&b)+y[2]+606105819|0,M=(M<<17|M>>>15)+I|0,b+=(M&I|~M&w)+y[3]-1044525330|0,b=(b<<22|b>>>10)+M|0,w+=(b&M|~b&I)+y[4]-176418897|0,w=(w<<7|w>>>25)+b|0,I+=(w&b|~w&M)+y[5]+1200080426|0,I=(I<<12|I>>>20)+w|0,M+=(I&w|~I&b)+y[6]-1473231341|0,M=(M<<17|M>>>15)+I|0,b+=(M&I|~M&w)+y[7]-45705983|0,b=(b<<22|b>>>10)+M|0,w+=(b&M|~b&I)+y[8]+1770035416|0,w=(w<<7|w>>>25)+b|0,I+=(w&b|~w&M)+y[9]-1958414417|0,I=(I<<12|I>>>20)+w|0,M+=(I&w|~I&b)+y[10]-42063|0,M=(M<<17|M>>>15)+I|0,b+=(M&I|~M&w)+y[11]-1990404162|0,b=(b<<22|b>>>10)+M|0,w+=(b&M|~b&I)+y[12]+1804603682|0,w=(w<<7|w>>>25)+b|0,I+=(w&b|~w&M)+y[13]-40341101|0,I=(I<<12|I>>>20)+w|0,M+=(I&w|~I&b)+y[14]-1502002290|0,M=(M<<17|M>>>15)+I|0,b+=(M&I|~M&w)+y[15]+1236535329|0,b=(b<<22|b>>>10)+M|0,w+=(b&I|M&~I)+y[1]-165796510|0,w=(w<<5|w>>>27)+b|0,I+=(w&M|b&~M)+y[6]-1069501632|0,I=(I<<9|I>>>23)+w|0,M+=(I&b|w&~b)+y[11]+643717713|0,M=(M<<14|M>>>18)+I|0,b+=(M&w|I&~w)+y[0]-373897302|0,b=(b<<20|b>>>12)+M|0,w+=(b&I|M&~I)+y[5]-701558691|0,w=(w<<5|w>>>27)+b|0,I+=(w&M|b&~M)+y[10]+38016083|0,I=(I<<9|I>>>23)+w|0,M+=(I&b|w&~b)+y[15]-660478335|0,M=(M<<14|M>>>18)+I|0,b+=(M&w|I&~w)+y[4]-405537848|0,b=(b<<20|b>>>12)+M|0,w+=(b&I|M&~I)+y[9]+568446438|0,w=(w<<5|w>>>27)+b|0,I+=(w&M|b&~M)+y[14]-1019803690|0,I=(I<<9|I>>>23)+w|0,M+=(I&b|w&~b)+y[3]-187363961|0,M=(M<<14|M>>>18)+I|0,b+=(M&w|I&~w)+y[8]+1163531501|0,b=(b<<20|b>>>12)+M|0,w+=(b&I|M&~I)+y[13]-1444681467|0,w=(w<<5|w>>>27)+b|0,I+=(w&M|b&~M)+y[2]-51403784|0,I=(I<<9|I>>>23)+w|0,M+=(I&b|w&~b)+y[7]+1735328473|0,M=(M<<14|M>>>18)+I|0,b+=(M&w|I&~w)+y[12]-1926607734|0,b=(b<<20|b>>>12)+M|0,w+=(b^M^I)+y[5]-378558|0,w=(w<<4|w>>>28)+b|0,I+=(w^b^M)+y[8]-2022574463|0,I=(I<<11|I>>>21)+w|0,M+=(I^w^b)+y[11]+1839030562|0,M=(M<<16|M>>>16)+I|0,b+=(M^I^w)+y[14]-35309556|0,b=(b<<23|b>>>9)+M|0,w+=(b^M^I)+y[1]-1530992060|0,w=(w<<4|w>>>28)+b|0,I+=(w^b^M)+y[4]+1272893353|0,I=(I<<11|I>>>21)+w|0,M+=(I^w^b)+y[7]-155497632|0,M=(M<<16|M>>>16)+I|0,b+=(M^I^w)+y[10]-1094730640|0,b=(b<<23|b>>>9)+M|0,w+=(b^M^I)+y[13]+681279174|0,w=(w<<4|w>>>28)+b|0,I+=(w^b^M)+y[0]-358537222|0,I=(I<<11|I>>>21)+w|0,M+=(I^w^b)+y[3]-722521979|0,M=(M<<16|M>>>16)+I|0,b+=(M^I^w)+y[6]+76029189|0,b=(b<<23|b>>>9)+M|0,w+=(b^M^I)+y[9]-640364487|0,w=(w<<4|w>>>28)+b|0,I+=(w^b^M)+y[12]-421815835|0,I=(I<<11|I>>>21)+w|0,M+=(I^w^b)+y[15]+530742520|0,M=(M<<16|M>>>16)+I|0,b+=(M^I^w)+y[2]-995338651|0,b=(b<<23|b>>>9)+M|0,w+=(M^(b|~I))+y[0]-198630844|0,w=(w<<6|w>>>26)+b|0,I+=(b^(w|~M))+y[7]+1126891415|0,I=(I<<10|I>>>22)+w|0,M+=(w^(I|~b))+y[14]-1416354905|0,M=(M<<15|M>>>17)+I|0,b+=(I^(M|~w))+y[5]-57434055|0,b=(b<<21|b>>>11)+M|0,w+=(M^(b|~I))+y[12]+1700485571|0,w=(w<<6|w>>>26)+b|0,I+=(b^(w|~M))+y[3]-1894986606|0,I=(I<<10|I>>>22)+w|0,M+=(w^(I|~b))+y[10]-1051523|0,M=(M<<15|M>>>17)+I|0,b+=(I^(M|~w))+y[1]-2054922799|0,b=(b<<21|b>>>11)+M|0,w+=(M^(b|~I))+y[8]+1873313359|0,w=(w<<6|w>>>26)+b|0,I+=(b^(w|~M))+y[15]-30611744|0,I=(I<<10|I>>>22)+w|0,M+=(w^(I|~b))+y[6]-1560198380|0,M=(M<<15|M>>>17)+I|0,b+=(I^(M|~w))+y[13]+1309151649|0,b=(b<<21|b>>>11)+M|0,w+=(M^(b|~I))+y[4]-145523070|0,w=(w<<6|w>>>26)+b|0,I+=(b^(w|~M))+y[11]-1120210379|0,I=(I<<10|I>>>22)+w|0,M+=(w^(I|~b))+y[2]+718787259|0,M=(M<<15|M>>>17)+I|0,b+=(I^(M|~w))+y[9]-343485551|0,b=(b<<21|b>>>11)+M|0,_[0]=w+_[0]|0,_[1]=b+_[1]|0,_[2]=M+_[2]|0,_[3]=I+_[3]|0}function a(_){var y=[],w;for(w=0;w<64;w+=4)y[w>>2]=_.charCodeAt(w)+(_.charCodeAt(w+1)<<8)+(_.charCodeAt(w+2)<<16)+(_.charCodeAt(w+3)<<24);return y}function o(_){var y=[],w;for(w=0;w<64;w+=4)y[w>>2]=_[w]+(_[w+1]<<8)+(_[w+2]<<16)+(_[w+3]<<24);return y}function s(_){var y=_.length,w=[1732584193,-271733879,-1732584194,271733878],b,M,I,A,k,U;for(b=64;b<=y;b+=64)i(w,a(_.substring(b-64,b)));for(_=_.substring(b-64),M=_.length,I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;b<M;b+=1)I[b>>2]|=_.charCodeAt(b)<<(b%4<<3);if(I[b>>2]|=128<<(b%4<<3),b>55)for(i(w,I),b=0;b<16;b+=1)I[b]=0;return A=y*8,A=A.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(A[2],16),U=parseInt(A[1],16)||0,I[14]=k,I[15]=U,i(w,I),w}function l(_){var y=_.length,w=[1732584193,-271733879,-1732584194,271733878],b,M,I,A,k,U;for(b=64;b<=y;b+=64)i(w,o(_.subarray(b-64,b)));for(_=b-64<y?_.subarray(b-64):new Uint8Array(0),M=_.length,I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;b<M;b+=1)I[b>>2]|=_[b]<<(b%4<<3);if(I[b>>2]|=128<<(b%4<<3),b>55)for(i(w,I),b=0;b<16;b+=1)I[b]=0;return A=y*8,A=A.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(A[2],16),U=parseInt(A[1],16)||0,I[14]=k,I[15]=U,i(w,I),w}function c(_){var y="",w;for(w=0;w<4;w+=1)y+=r[_>>w*8+4&15]+r[_>>w*8&15];return y}function d(_){var y;for(y=0;y<_.length;y+=1)_[y]=c(_[y]);return _.join("")}d(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function _(y,w){return y=y|0||0,y<0?Math.max(y+w,0):Math.min(y,w)}ArrayBuffer.prototype.slice=function(y,w){var b=this.byteLength,M=_(y,b),I=b,A,k,U,B;return w!==n&&(I=_(w,b)),M>I?new ArrayBuffer(0):(A=I-M,k=new ArrayBuffer(A),U=new Uint8Array(k),B=new Uint8Array(this,M,A),U.set(B),k)}}();function f(_){return/[\u0080-\uFFFF]/.test(_)&&(_=unescape(encodeURIComponent(_))),_}function h(_,y){var w=_.length,b=new ArrayBuffer(w),M=new Uint8Array(b),I;for(I=0;I<w;I+=1)M[I]=_.charCodeAt(I);return y?M:b}function p(_){return String.fromCharCode.apply(null,new Uint8Array(_))}function C(_,y,w){var b=new Uint8Array(_.byteLength+y.byteLength);return b.set(new Uint8Array(_)),b.set(new Uint8Array(y),_.byteLength),b}function x(_){var y=[],w=_.length,b;for(b=0;b<w-1;b+=2)y.push(parseInt(_.substr(b,2),16));return String.fromCharCode.apply(String,y)}function T(){this.reset()}return T.prototype.append=function(_){return this.appendBinary(f(_)),this},T.prototype.appendBinary=function(_){this._buff+=_,this._length+=_.length;var y=this._buff.length,w;for(w=64;w<=y;w+=64)i(this._hash,a(this._buff.substring(w-64,w)));return this._buff=this._buff.substring(w-64),this},T.prototype.end=function(_){var y=this._buff,w=y.length,b,M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I;for(b=0;b<w;b+=1)M[b>>2]|=y.charCodeAt(b)<<(b%4<<3);return this._finish(M,w),I=d(this._hash),_&&(I=x(I)),this.reset(),I},T.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},T.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},T.prototype.setState=function(_){return this._buff=_.buff,this._length=_.length,this._hash=_.hash,this},T.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},T.prototype._finish=function(_,y){var w=y,b,M,I;if(_[w>>2]|=128<<(w%4<<3),w>55)for(i(this._hash,_),w=0;w<16;w+=1)_[w]=0;b=this._length*8,b=b.toString(16).match(/(.*?)(.{0,8})$/),M=parseInt(b[2],16),I=parseInt(b[1],16)||0,_[14]=M,_[15]=I,i(this._hash,_)},T.hash=function(_,y){return T.hashBinary(f(_),y)},T.hashBinary=function(_,y){var w=s(_),b=d(w);return y?x(b):b},T.ArrayBuffer=function(){this.reset()},T.ArrayBuffer.prototype.append=function(_){var y=C(this._buff.buffer,_),w=y.length,b;for(this._length+=_.byteLength,b=64;b<=w;b+=64)i(this._hash,o(y.subarray(b-64,b)));return this._buff=b-64<w?new Uint8Array(y.buffer.slice(b-64)):new Uint8Array(0),this},T.ArrayBuffer.prototype.end=function(_){var y=this._buff,w=y.length,b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M,I;for(M=0;M<w;M+=1)b[M>>2]|=y[M]<<(M%4<<3);return this._finish(b,w),I=d(this._hash),_&&(I=x(I)),this.reset(),I},T.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},T.ArrayBuffer.prototype.getState=function(){var _=T.prototype.getState.call(this);return _.buff=p(_.buff),_},T.ArrayBuffer.prototype.setState=function(_){return _.buff=h(_.buff,!0),T.prototype.setState.call(this,_)},T.ArrayBuffer.prototype.destroy=T.prototype.destroy,T.ArrayBuffer.prototype._finish=T.prototype._finish,T.ArrayBuffer.hash=function(_,y){var w=l(new Uint8Array(_)),b=d(w);return y?x(b):b},T})})(YF);var Ele=YF.exports;const Tle=Hf(Ele),_le=["lastShaderProgramBound","context","_openGLRenderWindow"];function Dle(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,i)=>{let a=r;i.length>0&&(a=Le.substitute(a,"VSOut","GSOut").result);const o=e._openGLRenderWindow.getWebgl2();let s=`
`,l=`#version 100
`;o?l=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),a=Le.substitute(a,"//VTK::System::Dec",[`${l}
`,o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let c=Le.substitute(n,"//VTK::System::Dec",[`${l}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){c=Le.substitute(c,"varying","out").result,a=Le.substitute(a,"varying","in").result;let f="",h=0;for(;a.includes(`gl_FragData[${h}]`);)a=Le.substitute(a,`gl_FragData\\[${h}\\]`,`fragOutput${h}`).result,f+=`layout(location = ${h}) out vec4 fragOutput${h};
`,h++;a=Le.substitute(a,"//VTK::Output::Dec",f).result}const d=Le.substitute(i,"//VTK::System::Dec",l).result;return{VSSource:c,FSSource:a,GSSource:d}},t.readyShaderProgramArray=(n,r,i)=>{const a=t.replaceShaderValues(n,r,i),o=t.getShaderProgram(a.VSSource,a.FSSource,a.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,i)=>{const a=`${n}${r}${i}`,o=Tle.hash(a);if(!(o in e.shaderPrograms)){const s=Le.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(n),s.getFragmentShader().setSource(r),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const ble={lastShaderProgramBound:null,shaderPrograms:null,context:null};function JF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ble,n),e.shaderPrograms={},de.obj(t,e),de.setGet(t,e,_le),de.moveToProtected(t,e,["openGLRenderWindow"]),Dle(t,e)}const Ile=de.newInstance(JF,"vtkShaderCache");var Ole={newInstance:Ile,extend:JF};const{vtkErrorMacro:Mle}=de;function Nle(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&Mle("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const Rle={context:null,numberOfTextureUnits:0,textureUnits:0};function ZF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rle,n),de.obj(t,e),e.textureUnits=[],de.get(t,e,["numberOfTextureUnits"]),de.setGet(t,e,["context"]),Nle(t,e)}const Ale=de.newInstance(ZF,"vtkOpenGLTextureUnitManager");var Lle={newInstance:Ale,extend:ZF};function kle(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,i)=>{const a=i.getViewportByReference(),o=t.getFramebufferSize();return a[0]*o[0]<=n&&a[2]*o[0]>=n&&a[1]*o[1]<=r&&a[3]*o[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),i=t.getFramebufferSize();return[(r[2]-r[0])*i[0],(r[3]-r[1])*i[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n/a[0],r/a[1],i]},t.normalizedDisplayToDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n*a[0],r*a[1],i]},t.worldToView=(n,r,i,a)=>a.worldToView(n,r,i),t.viewToWorld=(n,r,i,a)=>a.viewToWorld(n,r,i),t.worldToDisplay=(n,r,i,a)=>{const o=a.worldToView(n,r,i),s=t.getViewportSize(a),l=a.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),c=a.projectionToNormalizedDisplay(l[0],l[1],l[2]);return t.normalizedDisplayToDisplay(c[0],c[1],c[2])},t.displayToWorld=(n,r,i,a)=>{const o=t.displayToNormalizedDisplay(n,r,i),s=a.normalizedDisplayToProjection(o[0],o[1],o[2]),l=t.getViewportSize(a),c=a.projectionToView(s[0],s[1],s[2],l[0]/l[1]);return a.viewToWorld(c[0],c[1],c[2])},t.normalizedDisplayToViewport=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=t.normalizedDisplayToDisplay(n,r,i);return[s[0]-o[0]-.5,s[1]-o[1]-.5,i]},t.viewportToNormalizedViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),i]:[n,r,i]},t.normalizedViewportToViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return[n*(o[0]-1),r*(o[1]-1),i]},t.displayToLocalDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n,a[1]-r-1,i]},t.viewportToNormalizedDisplay=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=n+o[0]+.5,l=r+o[1]+.5;return t.displayToNormalizedDisplay(s,l,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{de.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,i,a)=>{de.vtkErrorMacro("not implemented")},t.createSelector=()=>{de.vtkErrorMacro("not implemented")}}const Ple={size:void 0,selector:void 0};function QF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ple,n),e.size||(e.size=[300,300]),de.getArray(t,e,["size"],2),de.get(t,e,["selector"]),$n.extend(t,e,n),kle(t,e)}const Fle=de.newInstance(QF,"vtkRenderWindowViewNode");var Vle={newInstance:Fle,extend:QF};const Ule="__getUnderlyingContext";function Ble(){const t=new Map,e={apply(i,a,o){return t.has(o[0])?t.get(o[0]):i.apply(a,o)}};function n(i){return{apply(a,o,s){return t.set(i,s[0]),a.apply(o,s)}}}const r=Object.create(null);return r.getParameter=(i,a,o,s)=>new Proxy(s.bind(i),e),r.depthMask=(i,a,o,s)=>new Proxy(s.bind(i),n(i.DEPTH_WRITEMASK)),{get(i,a,o){if(a===Ule)return()=>i;let s=Reflect.get(i,a,i);s instanceof Function&&(s=s.bind(i));const l=r[a];return l?l(i,a,o,s):s}}}const{vtkDebugMacro:hO,vtkErrorMacro:gO}=de,Gle={position:"absolute",top:0,left:0,width:"100%",height:"100%"},zle=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","releaseGraphicsResourcesForObject","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Ji(t,e,n){const r=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a===t.FRAMEBUFFER_COMPLETE}let d2=0;const Oy=[];function Wle(){d2++,Oy.forEach(t=>t(d2))}function jle(){d2--,Oy.forEach(t=>t(d2))}function Hle(t){Oy.push(t)}function $le(t){return Oy.pop()}function pO(t){t.preventDefault()}function Kle(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=Ble()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",pO,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function a(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=f=>{if(f){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(h=>{var p;(p=h.setOpenGLRenderWindow)==null||p.call(h,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&Wle(),e.textureUnitManager=Lle.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const f=e.context;f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA),f.depthFunc(f.LEQUAL),f.enable(f.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=f=>{e.el&&e.el!==f&&(e.canvas.parentNode!==e.el&&gO("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==f&&(e.el=f,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:f,height:h}=e.el.getBoundingClientRect();e.containerSize=[f,h]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var h;return((h=e.activeFramebuffer)==null?void 0:h.getSize())||e.size},t.getPixelData=(f,h,p,C)=>{const x=new Uint8Array((p-f+1)*(C-h+1)*4);return e.context.readPixels(f,h,p-f+1,C-h+1,e.context.RGBA,e.context.UNSIGNED_BYTE,x),x},t.get3DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},h=null;const p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(h=e.canvas.getContext("webgl2",f),h&&(e.webgl2=!0,hO("using webgl2"))),h||(hO("using webgl1"),h=e.canvas.getContext("webgl",f)||e.canvas.getContext("experimental-webgl",f)),new Proxy(h,r())},t.get2DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",f)},t.restoreContext=()=>{const f=ET.newInstance();f.setCurrentOperation("Release"),f.traverse(t,null)},t.activateTexture=f=>{const h=e._textureResourceIds.get(f);if(h!==void 0){e.context.activeTexture(e.context.TEXTURE0+h);return}const p=t.getTextureUnitManager().allocate();if(p<0){gO("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(f,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=f=>{const h=e._textureResourceIds.get(f);h!==void 0&&(t.getTextureUnitManager().free(h),e._textureResourceIds.delete(f))},t.getTextureUnitForTexture=f=>{const h=e._textureResourceIds.get(f);return h!==void 0?h:-1},t.getDefaultTextureByteSize=function(f){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(f){case un.CHAR:case un.SIGNED_CHAR:case un.UNSIGNED_CHAR:return 1;case h:case p:case un.UNSIGNED_SHORT:case un.SHORT:case un.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(f,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(f){case un.UNSIGNED_CHAR:switch(h){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!C&&un.UNSIGNED_SHORT):switch(h){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!C&&un.SHORT):switch(h){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case un.UNSIGNED_SHORT:case un.SHORT:case un.FLOAT:default:switch(h){case 1:return C?e.context.R16F:e.context.R32F;case 2:return C?e.context.RG16F:e.context.RG32F;case 3:return C?e.context.RGB16F:e.context.RGB32F;case 4:default:return C?e.context.RGBA16F:e.context.RGBA32F}}switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=f=>{e.bgImage.src=f.src},t.setUseBackgroundImage=f=>{e.useBackgroundImage=f,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const h=document.createElement("canvas"),p=h.getContext("2d");h.width=e.canvas.width,h.height=e.canvas.height,p.drawImage(e.canvas,0,0);const C=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(y=>{y.getViewProps().forEach(b=>{if(b.getContainer){const I=b.getContainer().getElementsByTagName("canvas");for(let A=0;A<I.length;A++){const k=I[A],U=k.getBoundingClientRect(),B=U.x-C.x,z=U.y-C.y;p.drawImage(k,B,z)}}})});const _=h.toDataURL(f);h.remove(),t.invokeImageReady(_)}t.captureNextImage=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:h=!1,size:p=null,scale:C=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=f;const x=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||C!==1?p||e.size.map(T=>T*C):null},new Promise((T,_)=>{const y=t.onImageReady(w=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=x,y.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(b=>{let{restoreParamsFn:M,arg:I}=b;return M(I)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),T(w);else{const b=document.createElement("img");if(b.style=Gle,b.src=w,e._screenshot.placeHolder=e.el.appendChild(b),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),h){const M=h!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(I=>{const A=I.getActiveCamera(),k=A.get("focalPoint","position","parallelScale");return{resetCameraArgs:M?{renderer:I}:void 0,resetCameraFn:M?h:I.resetCamera,restoreParamsFn:A.set,arg:JSON.parse(JSON.stringify(k))}}),e._screenshot.cameras.forEach(I=>{let{resetCameraFn:A,resetCameraArgs:k}=I;return A(k)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const f=t.get3DContext(),h=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);return s=h[1],h[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const f=t.get3DContext(),h=f.getExtension("OES_texture_float"),p=f.getExtension("OES_texture_half_float"),C=f.getExtension("WEBGL_debug_renderer_info"),x=f.getExtension("WEBGL_draw_buffers"),T=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),_=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",f.getParameter(f.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",f.getParameter(f.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",f.getParameter(f.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",T&&f.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",f.getParameter(f.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",f.getParameter(f.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",f.getParameter(f.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",f.getParameter(f.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",f.getParameter(f.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",f.getParameter(f.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",f.getParameter(f.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",f.getParameter(f.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",f.getParameter(f.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",f.getParameter(f.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",f.getParameter(f.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",f.getParameter(f.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",f.getParameter(f.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[h&&Ji(f,f.RGBA,f.UNSIGNED_BYTE)?"RGBA":"",h&&Ji(f,f.RGB,f.UNSIGNED_BYTE)?"RGB":"",h&&Ji(f,f.LUMINANCE,f.UNSIGNED_BYTE)?"LUMINANCE":"",h&&Ji(f,f.ALPHA,f.UNSIGNED_BYTE)?"ALPHA":"",h&&Ji(f,f.LUMINANCE_ALPHA,f.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&Ji(f,f.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&Ji(f,f.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&Ji(f,f.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&Ji(f,f.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&Ji(f,f.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[h&&Ji(f,f.RGBA,f.FLOAT)?"RGBA":"",h&&Ji(f,f.RGB,f.FLOAT)?"RGB":"",h&&Ji(f,f.LUMINANCE,f.FLOAT)?"LUMINANCE":"",h&&Ji(f,f.ALPHA,f.FLOAT)?"ALPHA":"",h&&Ji(f,f.LUMINANCE_ALPHA,f.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",x?f.getParameter(x.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",f.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",f.getParameter(f.RENDERER)],["WebGL Vendor","VENDOR",f.getParameter(f.VENDOR)],["WebGL Version","VERSION",f.getParameter(f.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",f.getParameter(f.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",C&&f.getParameter(C.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",C&&f.getParameter(C.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],y={};for(;_.length;){const[w,b,M]=_.pop();b&&(y[b]={label:w,value:M})}return e._glInformation=y,y},t.traverseAllPasses=()=>{var h;if(e.renderPasses)for(let p=0;p<e.renderPasses.length;++p)e.renderPasses[p].traverse(t,null);e.notifyStartCaptureImage&&o(),t.copyParentContent();const f=e.renderable.getChildRenderWindowsByReference();for(let p=0;p<f.length;++p)(h=t.getViewNodeFor(f[p]))==null||h.traverseAllPasses()},t.copyParentContent=()=>{const f=e.rootOpenGLRenderWindow;if(!f||!e.context2D)return;const h=f.getCanvas(),p=e.canvas;e.context2D.drawImage(h,0,h.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{var h;const f=e.renderable.getChildRenderWindowsByReference();if(f.length>0){const p=[0,0];for(let C=0;C<f.length;++C){const x=(h=t.getViewNodeFor(f[C]))==null?void 0:h.getSize();x&&(p[0]=x[0]>p[0]?x[0]:p[0],p[1]=x[1]>p[1]?x[1]:p[1])}t.setSize(...p)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=f=>{if(e.viewStream===f)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=f,e.viewStream){const h=e.renderable.getRenderers()[0];h.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const f=_T.newInstance();return f.setOpenGLRenderWindow(t),f};function l(){e.canvas.removeEventListener("webglcontextlost",pO),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=de.chain(()=>{e.context&&jle()},l,t.delete,t.setViewStream),t.setActiveFramebuffer=f=>{e.activeFramebuffer=f};const c=t.setSize;t.setSize=(f,h)=>{const p=c(f,h);return p&&t.invokeWindowResizeEvent({width:f,height:h}),p},t.getGraphicsResourceForObject=f=>{if(!f)return null;const h=e._graphicsResources.get(f),p=e._graphicsResourceHash.get(f);return{vtkObj:h,hash:p}},t.setGraphicsResourceForObject=(f,h,p)=>{f&&(e._graphicsResources.set(f,h),e._graphicsResourceHash.set(f,p))},t.getGraphicsMemoryInfo=()=>{let f=0;return e._graphicsResources.forEach((h,p)=>{f+=h.getAllocatedGPUMemoryInBytes()}),f},t.releaseGraphicsResourcesForObject=f=>{var h;return f?((h=e._graphicsResources.get(f))==null||h.releaseGraphicsResources(t),e._graphicsResources.delete(f)&&e._graphicsResourceHash.delete(f)):!1},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach((f,h)=>{f.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e._graphicsResourceHash.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(f=>{const h=t.getViewNodeFor(f);h==null||h.releaseGraphicsResources()})};const d={...t};zle.forEach(f=>{t[f]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[f](...arguments):d[f](...arguments)}})}const qle={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function eV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qle,n),Vle.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=_T.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._graphicsResourceHash=new Map,e._glInformation=null,e.myFactory=fse.newInstance(),e.shaderCache=Ole.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=ale.newInstance(),de.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),de.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),de.setGetArray(t,e,["size"],2),de.event(t,e,"imageReady"),de.event(t,e,"windowResizeEvent"),Kle(t,e)}const DT=de.newInstance(eV,"vtkOpenGLRenderWindow");pF("WebGL",DT);var Xle={newInstance:DT,extend:eV,pushMonitorGLContextCount:Hle,popMonitorGLContextCount:$le};jr("vtkRenderWindow",DT);function Yle(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),hr(e.keyMatrices.mcwc,e.renderable.getMatrix()),yn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?fo(e.keyMatrices.normalMatrix):(Cy(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),fp(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),KE(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const Jle={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function tV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jle,n),$n.extend(t,e,n),e.keyMatrixTime={},ir(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:fo(new Float64Array(9)),mcwc:kt(new Float64Array(16))},Ur(t,e,["context"]),aa(t,e,["activeTextures"]),Yle(t,e)}const nV=Ln(tV);var Zle={newInstance:nV,extend:tV};jr("vtkActor",nV);function Qle(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const ece={context:null,activeTextures:null};function rV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ece,n),$n.extend(t,e,n),Ur(t,e,["context"]),aa(t,e,["activeTextures"]),Qle(t,e)}const iV=Ln(rV);var tce={newInstance:iV,extend:rV};jr("vtkActor2D",iV);function nce(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){hr(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),Cy(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),fp(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),yn(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();hr(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),yn(e.keyMatrices.vcpc,e.keyMatrices.vcpc),En(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const rce={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function aV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rce,n),$n.extend(t,e,n),e.keyMatrixTime={},ir(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Ur(t,e,["context","keyMatrixTime"]),nce(t,e)}const oV=Ln(aV);var ice={newInstance:oV,extend:aV};jr("vtkCamera",oV);function ace(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,o=n;if(a){const s=a.length;if(r>=0&&r<s){const l=a[r],c=l.getNormal(),d=l.getOrigin(),f=c[0],h=c[1],p=c[2],C=-(f*d[0]+h*d[1]+p*d[2]);i[0]=f*o[0]+h*o[4]+p*o[8]+C*o[12],i[1]=f*o[1]+h*o[5]+p*o[9]+C*o[13],i[2]=f*o[2]+h*o[6]+p*o[10]+C*o[14],i[3]=f*o[3]+h*o[7]+p*o[11]+C*o[15];return}}de.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const oce={clippingPlanes:[]};function sce(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oce,n),de.obj(t,e),de.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),ace(t,e)}var sV={extend:sce};function lce(t,e){t.getBounds=()=>(de.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),tl()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=Gn.isValid(n)?Gn.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return Gn.getDiagonalLength(n)}}const cce=t=>({bounds:[...Gn.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function uce(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cce(n)),sV.extend(t,e,n),de.setGet(t,e,["viewSpecificProperties"]),lce(t,e)}var bT={extend:uce};const{vtkErrorMacro:mO}=de,vO=0,yO=1,w4=2;function fce(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4,t.linearIndexLookup=(n,r)=>{let i=0;const a=Number(n);return a<r.range[0]?i=r.maxIndex+vO+1.5:a>r.range[1]?i=r.maxIndex+yO+1.5:(i=(a+r.shift)*r.scale,i=i<r.maxIndex?i:r.maxIndex),Math.floor(i)},t.linearLookup=(n,r,i)=>{let a=0;Lg(n)?a=Math.floor(i.maxIndex+1.5+w4):a=t.linearIndexLookup(n,i);const o=4*a;return r.slice(o,o+4)},t.indexedLookupFunction=(n,r,i)=>{let a=t.getAnnotatedValueIndexInternal(n);a===-1&&(a=e.numberOfColors+w4);const o=4*a;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,i,a)=>{let o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);const s=t.getMappingRange(),l={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,l);const c=t.getAlpha(),d=n.getNumberOfTuples(),f=n.getNumberOfComponents(),h=r.getData(),p=n.getData();if(c>=1){if(i===ux.RGBA)for(let C=0;C<d;C++){const x=o(p[C*f+a],e.table,l);h[C*4]=x[0],h[C*4+1]=x[1],h[C*4+2]=x[2],h[C*4+3]=x[3]}}else if(i===ux.RGBA)for(let C=0;C<d;C++){const x=o(p[C*f+a],e.table,l);h[C*4]=x[0],h[C*4+1]=x[1],h[C*4+2]=x[2],h[C*4+3]=Math.floor(x[3]*c+.5)}},t.forceBuild=()=>{let n=0,r=0,i=0,a=0;const o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,i=(e.valueRange[1]-e.valueRange[0])/o,a=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;const s=[],l=[];for(let c=0;c<=o;c++)s[0]=e.hueRange[0]+c*n,s[1]=e.saturationRange[0]+c*r,s[2]=e.valueRange[0]+c*i,Fl(s,l),l[3]=e.alphaRange[0]+c*a,e.table[c*4]=l[0]*255+.5,e.table[c*4+1]=l[1]*255+.5,e.table[c*4+2]=l[2]*255+.5,e.table[c*4+3]=l[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const i=n[0].length;e.numberOfColors=n.length;const a=4-i;let o=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<n.length;s++){const l=n[s];for(let c=0;c<i;c++)e.table[o++]=l[c];o+=a}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return mO("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==un.UNSIGNED_CHAR)return mO("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let i=0;i<r.length;i++)e.table[i]=r[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let i=(n+vO)*4;e.useBelowRangeColor||n===0?(r[i]=e.belowRangeColor[0]*255+.5,r[i+1]=e.belowRangeColor[1]*255+.5,r[i+2]=e.belowRangeColor[2]*255+.5,r[i+3]=e.belowRangeColor[3]*255+.5):(r[i]=r[0],r[i+1]=r[1],r[i+2]=r[2],r[i+3]=r[3]),i=(n+yO)*4,e.useAboveRangeColor||n===0?(r[i]=e.aboveRangeColor[0]*255+.5,r[i+1]=e.aboveRangeColor[1]*255+.5,r[i+2]=e.aboveRangeColor[2]*255+.5,r[i+3]=e.aboveRangeColor[3]*255+.5):(r[i]=r[4*(n-1)+0],r[i+1]=r[4*(n-1)+1],r[i+2]=r[4*(n-1)+2],r[i+3]=r[4*(n-1)+3]),i=(n+w4)*4,r[i]=e.nanColor[0]*255+.5,r[i+1]=e.nanColor[1]*255+.5,r[i+2]=e.nanColor[2]*255+.5,r[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const dce={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function lV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dce,n),yy.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},de.obj(e.buildTime),e.opaqueFlagBuildTime={},de.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},de.obj(e.insertTime,{mtime:0}),de.get(t,e,["buildTime"]),de.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),de.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),de.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),de.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),fce(t,e)}const hce=de.newInstance(lV,"vtkLookupTable");var Ah={newInstance:hce,extend:lV};let cV=1,IT=0;const gce=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function pce(){return cV}function mce(t){cV=t}function vce(){return IT}function My(){IT=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0}function yce(){My(0)}function wce(){My(0)}function Cce(){My(1)}function xce(){return gce[IT]}var Tx={getResolveCoincidentTopologyAsString:xce,getResolveCoincidentTopologyPolygonOffsetFaces:pce,getResolveCoincidentTopology:vce,setResolveCoincidentTopology:My,setResolveCoincidentTopologyPolygonOffsetFaces:mce,setResolveCoincidentTopologyToDefault:yce,setResolveCoincidentTopologyToOff:wce,setResolveCoincidentTopologyToPolygonOffset:Cce};function uV(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=(i,a)=>{e[r.key]={factor:i,offset:a}}})}const OT=["Polygon","Line","Point"],Sce={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},gu={};uV(gu,Sce,OT.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function Ece(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),de.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(Tx).forEach(n=>{t[n]=Tx[n]}),Object.keys(gu).forEach(n=>{t[n]=gu[n]}),uV(t,e.topologyOffset,OT.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=gu.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=gu.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=gu.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var Ny={implementCoincidentTopologyMethods:Ece,staticOffsetAPI:gu,otherStaticMethods:Tx,CATEGORIES:OT};const{FieldAssociations:wO}=ed,{staticOffsetAPI:Tce,otherStaticMethods:_ce}=Ny,{ColorMode:C4,ScalarMode:eu,GetArray:x4}=vy,{VectorMode:Dce}=BE,{VtkDataTypes:bce}=Bt;function yh(t){return()=>de.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function Ice(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=tl(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=Ah.newInstance()},t.getColorModeAsString=()=>de.enumToString(C4,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>de.enumToString(eu,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let s=null,l=!1;if(r===eu.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),l=!0);else if(r===eu.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===eu.USE_CELL_DATA)s=n.getCellData().getScalars(),l=!0;else if(r===eu.USE_POINT_FIELD_DATA){const c=n.getPointData();i===x4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}else if(r===eu.USE_CELL_FIELD_DATA){const c=n.getCellData();l=!0,i===x4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}else if(r===eu.USE_FIELD_DATA){const c=n.getFieldData();i===x4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}return{scalars:s,cellFlag:l}},t.mapScalars=(n,r)=>{const i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString!==a){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(n))t.mapScalarsToTexture(i,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`}},t.scalarToTextureCoordinate=(n,r,i)=>{let a=.5,o=1;return Lg(n)||(o=.49,a=(n-r)*i,a>1e3?a=1e3:a<-1e3&&(a=-1e3)),{texCoordS:a,texCoordT:o}},t.createColorTextureCoordinates=(n,r,i,a,o,s,l,c,d)=>{const f=(s[1]-s[0])/c,h=[];h[0]=s[0]-f,h[1]=s[1]+f;const p=1/(h[1]-h[0]),C=r.getData(),x=n.getData();let T=0,_=0;if(o<0||o>=a)for(let y=0;y<i;++y){let w=0;for(let I=0;I<a;++I)w+=x[T]*x[T],T++;let b=Math.sqrt(w);d&&(b=Ah.applyLogScale(b,l,s));const M=t.scalarToTextureCoordinate(b,h[0],p);C[_]=M.texCoordS,C[_+1]=M.texCoordT,_+=2}else{T+=o;for(let y=0;y<i;++y){let w=x[T];d&&(w=Ah.applyLogScale(w,l,s));const b=t.scalarToTextureCoordinate(w,h[0],p);C[_]=b.texCoordS,C[_+1]=b.texCoordT,_+=2,T+=a}}},t.mapScalarsToTexture=(n,r)=>{const i=e.lookupTable.getRange(),a=e.lookupTable.usingLogScale();a&&Ah.getLogRange(i,i);const o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==r){e.lookupTable.setAlpha(r),e.colorTextureMap=null,e.lookupTable.build();let s=e.lookupTable.getNumberOfAvailableColors();s>4094&&(s=4094),s<64&&(s=64),s+=2;const l=(i[1]-i[0])/(s-2),c=new Float64Array(s*2);for(let f=0;f<s;++f)c[f]=i[0]+f*l-l/2,a&&(c[f]=10**c[f]);for(let f=0;f<s;++f)c[f+s]=NaN;e.colorTextureMap=yc.newInstance(),e.colorTextureMap.setExtent(0,s-1,0,1,0,0);const d=Bt.newInstance({numberOfComponents:1,values:c});e.colorTextureMap.getPointData().setScalars(e.lookupTable.mapScalars(d,e.colorMode,0)),e.lookupTable.setAlpha(o)}if(!e.colorCoordinates||t.getMTime()>e.colorCoordinates.getMTime()||t.getInputData(0).getMTime()>e.colorCoordinates.getMTime()||e.lookupTable.getMTime()>e.colorCoordinates.getMTime()){e.colorCoordinates=null;const s=n.getNumberOfComponents(),l=n.getNumberOfTuples();e.colorCoordinates=Bt.newInstance({numberOfComponents:2,values:new Float32Array(l*2)});let c=e.lookupTable.getVectorComponent();e.lookupTable.getVectorMode()===Dce.MAGNITUDE&&n.getNumberOfComponents()>1&&(c=-1),t.createColorTextureCoordinates(n,e.colorCoordinates,l,s,c,i,e.lookupTable.getRange(),e.colorTextureMap.getPointData().getScalars().getNumberOfTuples()/2-2,a)}},t.getIsOpaque=()=>{const n=t.getInputData(),i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const a=t.getLookupTable();return a?(a.build(),a.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=n=>{if(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup())return!1;const r=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName),i=r.scalars;return!(!i||r.cellFlag||e.colorMode===C4.DEFAULT&&i.getDataType()===bce.UNSIGNED_CHAR||e.colorMode===C4.DIRECT_SCALARS)},t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=yh("AcquireInvertibleLookupTable"),t.valueToColor=yh("ValueToColor"),t.colorToValue=yh("ColorToValue"),t.useInvertibleColorFor=yh("UseInvertibleColorFor"),t.clearInvertibleColor=yh("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=n.getRawPixelBuffer(ea.ID_LOW24),a=n.getRawPixelBuffer(ea.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation();let l=null;s===wO.FIELD_ASSOCIATION_POINTS?l=e.selectionWebGLIdsToVTKIds.points:s===wO.FIELD_ASSOCIATION_CELLS&&(l=e.selectionWebGLIdsToVTKIds.cells),l&&r.forEach(c=>{if(o===ea.ID_LOW24){let d=0;a&&(d+=a[c],d*=256),d+=i[c+2],d*=256,d+=i[c+1],d*=256,d+=i[c];const f=l[d],h=n.getPixelBuffer(ea.ID_LOW24);h[c]=f&255,h[c+1]=(f&65280)>>8,h[c+2]=(f&16711680)>>16}else if(o===ea.ID_HIGH24&&a){let d=0;d+=a[c],d*=256,d+=i[c],d*=256,d+=i[c+1],d*=256,d+=i[c+2];const f=l[d],h=n.getPixelBuffer(ea.ID_HIGH24);h[c]=(f&4278190080)>>24}})}}const Oce={colorMapColors:null,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function MT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oce,n),bT.extend(t,e,n),de.get(t,e,["colorCoordinates","colorMapColors","colorTextureMap","selectionWebGLIdsToVTKIds"]),de.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),de.setGetArray(t,e,["scalarRange"],2),Ny.implementCoincidentTopologyMethods(t,e),Ice(t,e)}const fV=de.newInstance(MT,"vtkMapper");var al={newInstance:fV,extend:MT,...Tce,..._ce,...vy};const Mce=Object.freeze(Object.defineProperty({__proto__:null,default:al,extend:MT,newInstance:fV},Symbol.toStringTag,{value:"Module"})),Nce={DISPLAY:0,WORLD:1};var dV={CoordinateSystem:Nce};const{CoordinateSystem:_x}=dV;function CO(t){return()=>de.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function Rce(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=CO("pick"),t.hasKey=CO("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(_x.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(_x.DISPLAY)}const Ace={allocatedRenderTime:10,coordinateSystem:_x.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function hV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ace,n),de.obj(t,e),de.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),de.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),de.moveToProtected(t,e,["parentProp"]),Rce(t,e)}const Lce=de.newInstance(hV,"vtkProp");var dp={newInstance:Lce,extend:hV,...dV},NT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,hp=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function kce(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let o=n.Fragment;o=Le.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(o=Le.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=Le.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=Le.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(o=Le.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=Le.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=Le.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}function Pce(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let o=0;o<a.length;o++){const s=a[o];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const l=s.shaderType,c=n[l],d=Le.substitute(c,s.originalValue,s.replacementValue,s.replaceAll);n[l]=d.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let o=n.Vertex;if(a){const c=a.VertexShaderCode;c!==void 0&&c!==""&&(o=c)}n.Vertex=o;let s=n.Fragment;if(a){const c=a.FragmentShaderCode;c!==void 0&&c!==""&&(s=c)}n.Fragment=s;let l=n.Geometry;if(a){const c=a.GeometryShaderCode;c!==void 0&&(l=c)}n.Geometry=l}}var ps={implementReplaceShaderCoincidentOffset:kce,implementBuildShadersWithReplacements:Pce};const{FieldAssociations:S4}=ed,{primTypes:ni}=ys,{Representation:k0,Shading:xO}=td,{ScalarMode:cm}=al,{Filter:SO,Wrap:EO}=Dr,{vtkErrorMacro:tu}=_i,Fce={type:"StartEvent"},Vce={type:"EndEvent"},{CoordinateSystem:Uce}=dp;function Bce(t){const e=t.getSelector();return e?e.getCurrentPass():ea.MIN_KNOWN_PASS-1}function Gce(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=ni.Start;o<ni.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=NT,r.Fragment=hp,r.Geometry=""},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,l=r.Fragment;const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];c&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];c&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),c&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(d=d.concat(["varying vec4 vertexColorVSOutput;"]),o=Le.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=Le.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Le.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Le.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?l=Le.substitute(l,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:e.renderable.getInterpolateScalarsBeforeMapping()&&e.renderable.getColorCoordinates()&&!e.drawingEdges?l=Le.substitute(l,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(a.getBackfaceProperty()&&!e.drawingEdges&&(d=d.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),c?(d=d.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(d=d.concat(["uniform samplerBuffer texture1;"])),l=Le.substitute(l,"//VTK::Color::Impl",f).result),l=Le.substitute(l,"//VTK::Color::Dec",d).result,r.Vertex=o,r.Geometry=s,r.Fragment=l},t.replaceShaderLight=(r,i,a)=>{let o=r.Fragment;const s="",l=e.lastBoundBO.getReferenceByName("lastLightComplexity"),c=e.lastBoundBO.getReferenceByName("lastLightCount");let d=[];switch(l){case 0:o=Le.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=Le.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let f=0;f<c;++f)d=d.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`]);o=Le.substitute(o,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let f=0;f<c;++f)d=d.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${f}));`,`  diffuseL += ((df${s}) * lightColor${f});`,`  if (dot(normalVCVSOutput, lightDirectionVC${f}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${f},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${f});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=Le.substitute(o,"//VTK::Light::Impl",d,!1).result;break;case 3:for(let f=0;f<c;++f)d=d.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`,`uniform vec3 lightPositionVC${f};`,`uniform vec3 lightAttenuation${f};`,`uniform float lightConeAngle${f};`,`uniform float lightExponent${f};`,`uniform int lightPositional${f};`]);o=Le.substitute(o,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let f=0;f<c;++f)d=d.concat(["  attenuation = 1.0;",`  if (lightPositional${f} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${f};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${f};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${f}.x`,`       + lightAttenuation${f}.y * distanceVC`,`       + lightAttenuation${f}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${f} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${f});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${f})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${f});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${f});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${f},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${f});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=Le.substitute(o,"//VTK::Light::Impl",d,!1).result;break;default:tu("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=(r,i,a)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex,l=r.Geometry,c=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=Le.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Le.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,l=Le.substitute(l,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,l=Le.substitute(l,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,c=Le.substitute(c,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,c=Le.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(c=Le.substitute(c,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,c=Le.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES?(c=Le.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=Le.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(c=Le.substitute(c,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,c=Le.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=Le.substitute(c,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=l,r.Fragment=c}},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a);let o=r.Vertex,s=r.Geometry,l=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=Le.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=Le.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=Le.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=Le.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=Le.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,l=Le.substitute(l,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,l=Le.substitute(l,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=Le.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=Le.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=l},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,l=r.Fragment;if(e.drawingEdges)return;o=Le.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const c=e.openGLActor.getActiveTextures();let d=2,f=2;if(c&&c.length>0&&(d=c[0].getComponents(),c[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(d=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(o=Le.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=Le.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=Le.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,l=Le.substitute(l,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c&&c.length>=1)switch(d){case 1:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=Le.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=Le.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=Le.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,l=Le.substitute(l,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,d){case 1:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:l=Le.substitute(l,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=l}},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const l=e.renderable.getNumberOfClippingPlanes();o=Le.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${l}];`,`varying float clipDistancesVSOutput[${l}];`]).result,o=Le.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${l}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Le.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${l}];`]).result,s=Le.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${l}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=(r,i)=>{let a={factor:0,offset:0};const o=i.getProperty();if(e.renderable.getResolveCoincidentTopology()||o.getEdgeVisibility()&&o.getRepresentation()===k0.SURFACE){const l=e.lastBoundBO.getPrimitiveType();l===ni.Points||o.getRepresentation()===k0.POINTS?a=e.renderable.getCoincidentTopologyPointOffsetParameter():l===ni.Lines||o.getRepresentation()===k0.WIREFRAME?a=e.renderable.getCoincidentTopologyLineOffsetParameters():(l===ni.Tris||l===ni.TriStrips)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(l===ni.TrisEdges||l===ni.TriStripsEdges)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),a.factor/=2,a.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===S4.FIELD_ASSOCIATION_POINTS&&(a.offset-=2),a},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment,s=r.Vertex;if(o=Le.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===ea.ID_LOW24||e.lastSelectionState===ea.ID_HIGH24)&&(s=Le.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=Le.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=Le.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=Le.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case ea.ID_LOW24:o=Le.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case ea.ID_HIGH24:o=Le.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=Le.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=Le.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderColor(r,i,a),t.replaceShaderNormal(r,i,a),t.replaceShaderLight(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=Le.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=Le.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=(r,i,a)=>{let o=0,s=0;const l=r.getPrimitiveType(),c=e.currentInput;let d=!1;const f=c.getPointData().getNormals(),h=c.getCellData().getNormals(),p=a.getProperty().getInterpolation()===xO.FLAT,C=a.getProperty().getRepresentation(),x=r.getOpenGLMode(C,l);if((x===e.context.TRIANGLES||h&&!f||!p&&f||!p&&x===e.context.LINES)&&(d=!0),a.getProperty().getLighting()&&d){o=0;const w=i.getLightsByReference();for(let b=0;b<w.length;++b){const M=w[b];M.getSwitch()>0&&(s++,o===0&&(o=1)),o===1&&(s>1||M.getIntensity()!==1||!M.lightTypeIsHeadLight())&&(o=2),o<3&&M.getPositional()&&(o=3)}}let T=!1;const _=e.lastBoundBO.getReferenceByName("lastLightComplexity"),y=e.lastBoundBO.getReferenceByName("lastLightCount");return(_!==o||y!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),T=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(T=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||T?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||tu("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&l>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||tu("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((c,d)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[d].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[d].components,!1)||tu(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||tu("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||tu("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const l=e.renderable.getNumberOfClippingPlanes(),c=[],f=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,h=f?hr(e.tmpMat4,a.getMatrix()):a.getMatrix();f&&(yn(h,h),En(h,h,f),yn(h,h));for(let p=0;p<l;p++){const C=[];e.renderable.getClippingPlaneInDataCoords(h,p,C);for(let x=0;x<4;x++)c.push(C[x])}r.getProgram().setUniformi("numClipPlanes",l),r.getProgram().setUniform4fv("clipPlanes",c)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor.getActiveTextures();if(o)for(let l=0;l<o.length;++l){const d=o[l].getTextureUnit(),f=`texture${d+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const l=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",l.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",l.factor)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,i,a)=>{const o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const s=r.getProgram();let l=0;const c=i.getLightsByReference();for(let h=0;h<c.length;++h){const p=c[h];if(p.getSwitch()>0){const x=p.getColorByReference(),T=p.getIntensity();e.lightColor[0]=x[0]*T,e.lightColor[1]=x[1]*T,e.lightColor[2]=x[2]*T;const _=p.getDirection(),y=i.getActiveCamera().getViewMatrix(),w=[..._];p.lightTypeIsSceneLight()&&(w[0]=y[0]*_[0]+y[1]*_[1]+y[2]*_[2],w[1]=y[4]*_[0]+y[5]*_[1]+y[6]*_[2],w[2]=y[8]*_[0]+y[9]*_[1]+y[10]*_[2],cc(w)),e.lightDirection[0]=w[0],e.lightDirection[1]=w[1],e.lightDirection[2]=w[2],cc(e.lightDirection),s.setUniform3fArray(`lightColor${l}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${l}`,e.lightDirection),l++}}if(o<3)return;const f=i.getActiveCamera().getViewMatrix();yn(f,f),l=0;for(let h=0;h<c.length;++h){const p=c[h];if(p.getSwitch()>0){const x=p.getTransformedPosition(),T=new Float64Array(3);vn(T,x,f),s.setUniform3fArray(`lightAttenuation${l}`,p.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${l}`,p.getPositional()),s.setUniformf(`lightExponent${l}`,p.getExponent()),s.setUniformf(`lightConeAngle${l}`,p.getConeAngle()),s.setUniform3fArray(`lightPositionVC${l}`,[T[0],T[1],T[2]]),l++}}};function n(r,i,a){return i.identity(a),r.reduce((o,s,l)=>l===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(i),l=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrixTime().getMTime(),d=o.getLastCameraMTime(),h=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,p=a.getIsIdentity(),C=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(a.getCoordinateSystem()===Uce.DISPLAY){const x=e._openGLRenderer.getTiledSizeAndOrigin();kt(e.tmpMat4),e.tmpMat4[0]=2/x.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/x.vsize,e.tmpMat4[13]=-1,En(e.tmpMat4,e.tmpMat4,h),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",n([s.wcpc,C.mcwc,h],Lf,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,C.mcwc,h],Lf,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,C.normalMatrix],Vk,e.tmpMat3)),d!==c&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",l.getParallelProjection()),o.setLastCameraMTime(c)),p||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();let s=a.getProperty(),l=s.getOpacity(),c=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),d=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),f=e.drawingEdges?1:s.getAmbient(),h=e.drawingEdges?0:s.getDiffuse(),p=e.drawingEdges?0:s.getSpecular();const C=s.getSpecularPower();o.setUniformf("opacityUniform",l),o.setUniform3fArray("ambientColorUniform",c),o.setUniform3fArray("diffuseColorUniform",d),o.setUniformf("ambient",f),o.setUniformf("diffuse",h);const x=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(x<1)return;let T=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",T),o.setUniformf("specularPowerUniform",C),o.setUniformf("specular",p),o.isUniformUsed("ambientIntensityBF")){if(s=a.getBackfaceProperty(),l=s.getOpacity(),c=s.getAmbientColor(),f=s.getAmbient(),d=s.getDiffuseColor(),h=s.getDiffuse(),T=s.getSpecularColor(),p=s.getSpecular(),o.setUniformf("ambientIntensityBF",f),o.setUniformf("diffuseIntensityBF",h),o.setUniformf("opacityUniformBF",l),o.setUniform3fArray("ambientColorUniformBF",c),o.setUniform3fArray("diffuseColorUniformBF",d),x<1)return;o.setUniformf("specularIntensityBF",p),o.setUniform3fArray("specularColorUniformBF",T),o.setUniformf("specularPowerUniformBF",C)}},t.updateMaximumPointCellIds=(r,i)=>{var s,l,c,d;const a=e._openGLRenderer.getSelector();if(!a)return;if((l=(s=e.selectionWebGLIdsToVTKIds)==null?void 0:s.points)!=null&&l.length){const f=e.selectionWebGLIdsToVTKIds.points.length;a.setMaximumPointId(f-1)}if((d=(c=e.selectionWebGLIdsToVTKIds)==null?void 0:c.cells)!=null&&d.length){const f=e.selectionWebGLIdsToVTKIds.cells.length;a.setMaximumCellId(f-1)}a.getFieldAssociation()===S4.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const a=Bce(e._openGLRenderer);if(e.lastSelectionState!==a&&(e.selectionStateChanged.modified(),e.lastSelectionState=a),e._openGLRenderer.getSelector())switch(a){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=i.getProperty().getEdgeVisibility()&&a===k0.SURFACE,s=e._openGLRenderer.getSelector(),l=s&&s.getFieldAssociation()===S4.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===ea.ID_LOW24||e.lastSelectionState===ea.ID_HIGH24);for(let c=ni.Start;c<ni.End;c++)e.primitives[c].setPointPicking(l),e.primitives[c].getCABO().getElementCount()&&(e.drawingEdges=o&&(c===ni.TrisEdges||c===ni.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[c],e.primitiveIDOffset+=e.primitives[c].drawArrays(r,i,a,t),e.vertexIDOffset+=e.primitives[c].getCABO().getElementCount()))},t.renderPieceFinish=(r,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,i)=>{if(t.invokeEvent(Fce),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(Vce),!e.currentInput){tu("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context,o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){ju(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===cm.USE_CELL_DATA||s===cm.USE_CELL_FIELD_DATA||s===cm.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==cm.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);let l=i.getProperty().getInterpolation()!==xO.FLAT?a.getPointData().getNormals():null;l===null&&a.getCellData().getNormals()&&(e.haveCellNormals=!0,l=a.getCellData().getNormals());const c=i.getProperty().getRepresentation();let d=a.getPointData().getTCoords();if(e.openGLActor.getActiveTextures()||(d=null),e.renderable.getColorCoordinates()){d=e.renderable.getColorCoordinates(),e.internalColorTexture||(e.internalColorTexture=Dr.newInstance({resizable:!0}));const h=e.internalColorTexture;h.setMinificationFilter(SO.NEAREST),h.setMagnificationFilter(SO.NEAREST),h.setWrapS(EO.CLAMP_TO_EDGE),h.setWrapT(EO.CLAMP_TO_EDGE),h.setOpenGLRenderWindow(e._openGLRenderWindow);const p=e.renderable.getColorTextureMap(),C=p.getExtent(),x=p.getPointData().getScalars();h.create2DFromRaw(C[1]-C[0]+1,C[3]-C[2]+1,x.getNumberOfComponents(),x.getDataType(),x.getData()),h.activate(),h.sendParameters(),h.deactivate()}const f=`${a.getMTime()}A${c}B${a.getMTime()}C${l?l.getMTime():1}D${o?o.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${d?d.getMTime():1}`;if(e.VBOBuildString!==f){const p={points:a.getPoints(),normals:l,tcoords:d,colors:o,cellOffset:0,vertexOffset:0,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(T=>a.getPointData().getArrayByName(T))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const C=[{inRep:"verts",cells:a.getVerts()},{inRep:"lines",cells:a.getLines()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()}],x=i.getProperty().getEdgeVisibility()&&c===k0.SURFACE;for(let T=ni.Start;T<ni.End;T++)T!==ni.TrisEdges&&T!==ni.TriStripsEdges?(p.cellOffset+=e.primitives[T].getCABO().createVBO(C[T].cells,C[T].inRep,c,p,e.selectionWebGLIdsToVTKIds),p.vertexOffset+=e.primitives[T].getCABO().getElementCount()):x?e.primitives[T].getCABO().createVBO(C[T].cells,C[T].inRep,k0.WIREFRAME,{...p,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[T].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&(e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),t.updateMaximumPointCellIds()),e.VBOBuildTime.modified(),e.VBOBuildString=f}},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const zce={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:ea.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function gV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zce,n),$n.extend(t,e,n),ps.implementReplaceShaderCoincidentOffset(t,e,n),ps.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=ni,e.tmpMat3=fo(new Float64Array(9)),e.tmpMat4=kt(new Float64Array(16));for(let r=ni.Start;r<ni.End;r++)e.primitives[r]=ys.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ur(t,e,["context"]),e.VBOBuildTime={},ir(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},ir(e.selectionStateChanged,{mtime:0}),Gce(t,e)}const pV=Ln(gV,"vtkOpenGLPolyDataMapper");var Ry={newInstance:pV,extend:gV};jr("vtkMapper",pV);const{vtkErrorMacro:wh}=_i,{Representation:Wce}=td,{ObjectType:um}=Hs,{PassTypes:jce}=_T,Hce={type:"StartEvent"},$ce={type:"EndEvent"};function Kce(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,i)=>{if(t.invokeEvent(Hce),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent($ce),!e.currentInput){wh("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.multiply4x4WithOffset=(r,i,a,o)=>{const s=i[0],l=i[1],c=i[2],d=i[3],f=i[4],h=i[5],p=i[6],C=i[7],x=i[8],T=i[9],_=i[10],y=i[11],w=i[12],b=i[13],M=i[14],I=i[15];let A=a[o],k=a[o+1],U=a[o+2],B=a[o+3];r[0]=A*s+k*f+U*x+B*w,r[1]=A*l+k*h+U*T+B*b,r[2]=A*c+k*p+U*_+B*M,r[3]=A*d+k*C+U*y+B*I,A=a[o+4],k=a[o+5],U=a[o+6],B=a[o+7],r[4]=A*s+k*f+U*x+B*w,r[5]=A*l+k*h+U*T+B*b,r[6]=A*c+k*p+U*_+B*M,r[7]=A*d+k*C+U*y+B*I,A=a[o+8],k=a[o+9],U=a[o+10],B=a[o+11],r[8]=A*s+k*f+U*x+B*w,r[9]=A*l+k*h+U*T+B*b,r[10]=A*c+k*p+U*_+B*M,r[11]=A*d+k*C+U*y+B*I,A=a[o+12],k=a[o+13],U=a[o+14],B=a[o+15],r[12]=A*s+k*f+U*x+B*w,r[13]=A*l+k*h+U*T+B*b,r[14]=A*c+k*p+U*_+B*M,r[15]=A*d+k*C+U*y+B*I},t.replaceShaderNormal=(r,i,a)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=Le.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Le.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}n.replaceShaderNormal(r,i,a)},t.replaceShaderColor=(r,i,a)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let o=r.Vertex,s=r.Geometry,l=r.Fragment;const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];c&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];c&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  opacity = opacityUniform;"]),c&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(d=d.concat(["varying vec4 vertexColorVSOutput;"]),o=Le.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=Le.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=Le.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Le.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,f=f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),l=Le.substitute(l,"//VTK::Color::Impl",f).result,l=Le.substitute(l,"//VTK::Color::Dec",d).result,r.Vertex=o,r.Geometry=s,r.Fragment=l}n.replaceShaderColor(r,i,a)},t.replaceShaderPositionVC=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=Le.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=Le.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=Le.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=Le.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,i,a)},t.replaceShaderPicking=(r,i,a)=>{if(e.hardwareSupport){let o=r.Fragment,s=r.Vertex;s=Le.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=Le.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=Le.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=Le.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,i,a)},t.updateGlyphShaderParameters=(r,i,a,o,s,l,c,d)=>{const f=a.getProgram();if(r){const h=e.normalMatrix,p=l,C=c*9,x=e.tmpMat3,T=h[0],_=h[1],y=h[2],w=h[3],b=h[4],M=h[5],I=h[6],A=h[7],k=h[8],U=p[C],B=p[C+1],z=p[C+2],K=p[C+3],J=p[C+4],X=p[C+5],re=p[C+6],fe=p[C+7],pe=p[C+8];x[0]=U*T+B*w+z*I,x[1]=U*_+B*b+z*A,x[2]=U*y+B*M+z*k,x[3]=K*T+J*w+X*I,x[4]=K*_+J*b+X*A,x[5]=K*y+J*M+X*k,x[6]=re*T+fe*w+pe*I,x[7]=re*_+fe*b+pe*A,x[8]=re*y+fe*M+pe*k,f.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,c*16),f.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,c*16),f.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){const h=o.getData();e.tmpColor[0]=h[c*4]/255,e.tmpColor[1]=h[c*4+1]/255,e.tmpColor[2]=h[c*4+2]/255,f.setUniform3fArray("ambientColorUniform",e.tmpColor),f.setUniform3fArray("diffuseColorUniform",e.tmpColor)}d&&f.setUniform3fArray("mapperIndex",d.getPropColorValue())},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=e.context,s=i.getProperty().getEdgeVisibility()&&a===Wce.SURFACE,l=e.openGLCamera.getKeyMatrices(r),c=e.openGLActor.getKeyMatrices();Af(e.normalMatrix,l.normalMatrix,c.normalMatrix),En(e.mcpcMatrix,l.wcpc,c.mcwc),En(e.mcvcMatrix,l.wcvc,c.mcwc);const d=e.renderable.getMatrixArray(),f=e.renderable.getNormalArray(),h=e.renderable.getColorArray(),p=d.length/16;let C=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===jce.COMPOSITE_INDEX_PASS&&(C=!0);for(let x=e.primTypes.Start;x<e.primTypes.End;x++){const T=e.primitives[x].getCABO();if(T.getElementCount()){e.drawingEdges=s&&(x===e.primTypes.TrisEdges||x===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[x],e.primitives[x].updateShaders(r,i,t);const _=e.primitives[x].getProgram(),y=e.primitives[x].getOpenGLMode(a),w=_.isUniformUsed("normalMatrix"),b=_.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(y,0,T.getElementCount(),p):o.drawArraysInstanced(y,0,T.getElementCount(),p);else for(let M=0;M<p;++M)C&&e._openGLRenderer.getSelector().renderCompositeIndex(M),t.updateGlyphShaderParameters(w,b,e.primitives[x],h,d,f,M,C?e._openGLRenderer.getSelector():null),o.drawArrays(y,0,T.getElementCount())}}},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||wh("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||wh("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||wh("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||wh("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,i,a),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,i,a)},t.getNeedToRebuildBufferObjects=(r,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,i)),t.getNeedToRebuildShaders=(r,i,a)=>!!(n.getNeedToRebuildShaders(r,i,a)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,i)=>{if(e.hardwareSupport){const a=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Hs.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Hs.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Hs.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Hs.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(a,um.ARRAY_BUFFER),e.normalBuffer.upload(o,um.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),um.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const l=a.length/16,c=new Uint8Array(4*l);for(let d=0;d<l;++d){let f=d+1;const h=d*4;c[h]=f%256,f-=c[h],f/=256,c[h+1]=f%256,f-=c[h+1],f/=256,c[h+2]=f%256,c[h+3]=255}e.pickBuffer.upload(c,um.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,i)}}const qce={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function mV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qce,n),Ry.extend(t,e,n),e.tmpMat3=fo(new Float64Array(9)),e.normalMatrix=fo(new Float64Array(9)),e.mcpcMatrix=kt(new Float64Array(16)),e.mcvcMatrix=kt(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},ir(e.glyphBOBuildTime,{mtime:0}),Kce(t,e)}const vV=Ln(mV,"vtkOpenGLGlyph3DMapper");var Xce={newInstance:vV,extend:mV};jr("vtkGlyph3DMapper",vV);const Yce={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Ay={SlicingMode:Yce};const Mu={NEAREST:0,LINEAR:1};var Jce={InterpolationType:Mu};const{vtkErrorMacro:P0}=_i,{SlicingMode:Eo}=Ay;function TO(t,e,n){if(e){const r=t.getIndependentComponents();return`${e.getMTime()}-${r}-${n}`}return"0"}function Zce(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function Qce(t,e){e.classHierarchy.push("vtkOpenGLImageMapper"),t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(r.getActiveCamera())}},t.translucentPass=(n,r)=>{n&&(e.currentRenderPass=r,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.getCoincidentParameters=(n,r)=>e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),r=e._openGLRenderer.getRenderable();t.renderPiece(r,n)},t.getShaderTemplate=(n,r,i)=>{n.Vertex=NT,n.Fragment=hp,n.Geometry=""},t.replaceShaderValues=(n,r,i)=>{let a=n.Vertex,o=n.Fragment;a=Le.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Le.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Le.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,a=Le.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const s=e.openGLTexture.getComponents(),l=i.getProperty().getIndependentComponents();let c=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let f=1;f<s;f++)c=c.concat([`uniform float cshift${f};`,`uniform float cscale${f};`,`uniform float pwfshift${f};`,`uniform float pwfscale${f};`]);switch(s){case 1:c=c.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:c=c.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:P0("Unsupported number of independent coordinates.")}}if(o=Le.substitute(o,"//VTK::TCoord::Dec",c).result,i.getProperty().getUseLabelOutline()===!0&&(o=Le.substitute(o,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;"]).result,o=Le.substitute(o,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,o=Le.substitute(o,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","#endif"]).result),l){const f=["r","g","b","a"];let h=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let p=0;p<s;p++)h=h.concat([`vec3 tcolor${p} = mix${p} * texture2D(colorTexture1, vec2(tvalue.${f[p]} * cscale${p} + cshift${p}, height${p})).rgb;`,`float compWeight${p} = mix${p} * texture2D(pwfTexture1, vec2(tvalue.${f[p]} * pwfscale${p} + pwfshift${p}, height${p})).r;`]);switch(s){case 1:h=h.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:h=h.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:P0("Unsupported number of independent coordinates.")}o=Le.substitute(o,"//VTK::TCoord::Impl",h).result}else switch(s){case 1:o=Le.substitute(o,"//VTK::TCoord::Impl",[...Zce(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); 
                  float centerValue = texture2D(texture1, centerPosIS.xy).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 1.0, 1.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, neighborPosIS.xy).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:o=Le.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=Le.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=Le.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=Le.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=Le.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=o,t.replaceShaderClip(n,r,i),t.replaceShaderCoincidentOffset(n,r,i)},t.replaceShaderClip=(n,r,i)=>{let a=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let s=e.renderable.getNumberOfClippingPlanes();s>6&&(Sn("OpenGL has a limit of 6 clipping planes"),s=6),a=Le.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Le.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=Le.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=Le.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=o},t.getNeedToRebuildShaders=(n,r,i)=>{var l;const a=e.openGLTexture.getComponents(),o=i.getProperty().getIndependentComponents();let s=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(s=!0),s||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=n.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==a||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=o,!0):!1},t.updateShaders=(n,r,i)=>{if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,r,i);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,r,i),t.setCameraShaderParameters(n,r,i),t.setPropertyShaderParameters(n,r,i)},t.setMapperShaderParameters=(n,r,i)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||P0("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||P0("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());const a=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",a);const o=e.openGLTexture.getComponents(),s=i.getProperty().getIndependentComponents();if(s)for(let p=0;p<o;p++)n.getProgram().setUniformf(`mix${p}`,i.getProperty().getComponentWeight(p));const l=e.openGLTexture.getShiftAndScale();for(let p=0;p<o;p++){let C=i.getProperty().getColorWindow(),x=i.getProperty().getColorLevel();const T=s?p:0,_=i.getProperty().getRGBTransferFunction(T);if(_&&i.getProperty().getUseLookupTableScalarRange()){const b=_.getRange();C=b[1]-b[0],x=.5*(b[1]+b[0])}const y=l.scale/C,w=(l.shift-x)/C+.5;n.getProgram().setUniformf(`cshift${p}`,w),n.getProgram().setUniformf(`cscale${p}`,y)}for(let p=0;p<o;p++){let C=1,x=0;const T=s?p:0,_=i.getProperty().getPiecewiseFunction(T);if(_){const y=_.getRange(),w=y[1]-y[0],b=.5*(y[0]+y[1]);C=l.scale/w,x=(l.shift-b)/w+.5}n.getProgram().setUniformf(`pwfshift${p}`,x),n.getProgram().setUniformf(`pwfscale${p}`,C)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const p=t.getCoincidentParameters(r,i);n.getProgram().setUniformf("coffset",p.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",p.factor)}const c=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",c);const d=e.pwfTexture.getTextureUnit();n.getProgram().setUniformi("pwfTexture1",d);const f=e.labelOutlineThicknessTexture.getTextureUnit();if(n.getProgram().setUniformi("labelOutlineTexture1",f),e.renderable.getNumberOfClippingPlanes()){let p=e.renderable.getNumberOfClippingPlanes();p>6&&(Sn("OpenGL has a limit of 6 clipping planes"),p=6);const x=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,T=x?hr(e.imagematinv,i.getMatrix()):i.getMatrix();x&&(yn(T,T),En(T,T,x),yn(T,T)),yn(e.imagemat,e.currentInput.getIndexToWorld()),En(e.imagematinv,T,e.imagemat);const _=[];for(let y=0;y<p;y++){const w=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,w);for(let b=0;b<4;b++)_.push(w[b])}n.getProgram().setUniformi("numClipPlanes",p),n.getProgram().setUniform4fv("clipPlanes",_)}if(i.getProperty().getUseLabelOutline()===!0){const p=i.getProperty().getLabelOutlineOpacity();n.getProgram().setUniformf("outlineOpacity",p)}},t.setCameraShaderParameters=(n,r,i)=>{const a=n.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),s=e.currentInput,l=s.getIndexToWorld();En(e.imagemat,o.mcwc,l);const c=e.openGLCamera.getKeyMatrices(r);if(En(e.imagemat,c.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){const f=n.getCABO().getInverseShiftAndScaleMatrix();En(e.imagemat,e.imagemat,f)}if(a.setUniformMatrix("MCPCMatrix",e.imagemat),i.getProperty().getUseLabelOutline()===!0){const f=s.getWorldToIndex(),h=s.getDimensions();a.setUniform3i("imageDimensions",h[0],h[1],1),a.setUniformMatrix("vWCtoIDX",f);const p=e.openGLCamera.getKeyMatrices(r);Vr(e.projectionToWorld,p.wcpc),e.openGLCamera.getKeyMatrices(r),a.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const C=t.getRenderTargetSize();a.setUniformf("vpWidth",C[0]),a.setUniformf("vpHeight",C[1]);const x=t.getRenderTargetOffset();a.setUniformf("vpOffsetX",x[0]/C[0]),a.setUniformf("vpOffsetY",x[1]/C[1])}},t.setPropertyShaderParameters=(n,r,i)=>{const a=n.getProgram(),s=i.getProperty().getOpacity();a.setUniformf("opacity",s)},t.renderPieceStart=(n,r)=>{t.updateBufferObjects(n,r),e.lastBoundBO=null},t.renderPieceDraw=(n,r)=>{const i=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,r),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,r)=>{},t.renderPiece=(n,r)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){P0("No input!");return}t.renderPieceStart(n,r),t.renderPieceDraw(n,r),t.renderPieceFinish(n,r)},t.computeBounds=(n,r)=>{if(!t.getInput()){ju(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(n,r)=>{t.getNeedToRebuildBufferObjects(n,r)&&t.buildBufferObjects(n,r)},t.getNeedToRebuildBufferObjects=(n,r)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime(),t.buildBufferObjects=(n,r)=>{var z,K;const i=e.currentInput;if(!i)return;const a=i.getPointData()&&i.getPointData().getScalars();if(!a)return;const o=a.getDataType(),s=a.getNumberOfComponents(),l=r.getProperty(),c=l.getInterpolationType(),d=l.getIndependentComponents(),f=d?s:1,h=d?2*f:1,p=l.getRGBTransferFunction(),C=TO(l,p,f),x=e._openGLRenderWindow.getGraphicsResourceForObject(p);if(!(x!=null&&x.vtkObj)||(x==null?void 0:x.hash)!==C||e.colorTextureString!==C){const X=1024*h*3,re=new Uint8ClampedArray(X);if(e.colorTexture||(e.colorTexture=Dr.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow)),c===Mu.NEAREST?(e.colorTexture.setMinificationFilter(Ft.NEAREST),e.colorTexture.setMagnificationFilter(Ft.NEAREST)):(e.colorTexture.setMinificationFilter(Ft.LINEAR),e.colorTexture.setMagnificationFilter(Ft.LINEAR)),p){const fe=new Float32Array(3072);for(let pe=0;pe<f;pe++){const ie=l.getRGBTransferFunction(pe),te=ie.getRange();if(ie.getTable(te[0],te[1],1024,fe,1),d)for(let ee=0;ee<1024*3;ee++)re[pe*1024*6+ee]=255*fe[ee],re[pe*1024*6+ee+1024*3]=255*fe[ee];else for(let ee=0;ee<1024*3;ee++)re[pe*1024*6+ee]=255*fe[ee]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,h,3,un.UNSIGNED_CHAR,re)}else{for(let fe=0;fe<1024*3;++fe)re[fe]=255*fe/(1023*3),re[fe+1]=255*fe/(1023*3),re[fe+2]=255*fe/(1023*3);e.colorTexture.create2DFromRaw(1024,1,3,un.UNSIGNED_CHAR,re)}e.colorTextureString=C,p&&e._openGLRenderWindow.setGraphicsResourceForObject(p,e.colorTexture,e.colorTextureString)}else e.colorTexture=x.vtkObj,e.colorTextureString=x.hash;const _=l.getPiecewiseFunction(),y=TO(l,_,f),w=e._openGLRenderWindow.getGraphicsResourceForObject(_);if(!(w!=null&&w.vtkObj)||(w==null?void 0:w.hash)!==y||e.pwfTextureString!==y){const X=1024*h,re=new Uint8ClampedArray(X);if(e.pwfTexture||(e.pwfTexture=Dr.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow)),c===Mu.NEAREST?(e.pwfTexture.setMinificationFilter(Ft.NEAREST),e.pwfTexture.setMagnificationFilter(Ft.NEAREST)):(e.pwfTexture.setMinificationFilter(Ft.LINEAR),e.pwfTexture.setMagnificationFilter(Ft.LINEAR)),_){const fe=new Float32Array(X),pe=new Float32Array(1024);for(let ie=0;ie<f;++ie){const te=l.getPiecewiseFunction(ie);if(te===null)fe.fill(1);else{const ee=te.getRange();if(te.getTable(ee[0],ee[1],1024,pe,1),d)for(let we=0;we<1024;we++)fe[ie*1024*2+we]=pe[we],fe[ie*1024*2+we+1024]=pe[we];else for(let we=0;we<1024;we++)fe[ie*1024*2+we]=pe[we]}}e.pwfTexture.releaseGraphicsResources(e._openGLRenderWindow),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,h,1,un.FLOAT,fe)}else re.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,un.UNSIGNED_CHAR,re);e.pwfTextureString=y,_&&e._openGLRenderWindow.setGraphicsResourceForObject(_,e.pwfTexture,e.pwfTextureString)}else e.pwfTexture=w.vtkObj,e.pwfTextureString=w.hash;t.updatelabelOutlineThicknessTexture(r);const{ijkMode:M}=e.renderable.getClosestIJKAxis();let I=e.renderable.getSlice();M!==e.renderable.getSlicingMode()&&(I=e.renderable.getSliceAtPosition(I));const A=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(I),k=i.getExtent();let U;M===Eo.I&&(U=A-k[0]),M===Eo.J&&(U=A-k[2]),(M===Eo.K||M===Eo.NONE)&&(U=A-k[4]);const B=`${I}A${i.getMTime()}A${a.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${r.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==B){const J=i.getDimensions();e.openGLTexture||(e.openGLTexture=Dr.newInstance({resizable:!0}),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow)),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),c===Mu.NEAREST?(new Set([1,3,4]).has(s)&&o===un.UNSIGNED_CHAR&&!d&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Ft.NEAREST),e.openGLTexture.setMagnificationFilter(Ft.NEAREST)):(s===4&&o===un.UNSIGNED_CHAR&&!d?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Ft.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(Ft.LINEAR),e.openGLTexture.setMagnificationFilter(Ft.LINEAR)),e.openGLTexture.setWrapS(Fg.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Fg.CLAMP_TO_EDGE);const X=J[0]*J[1]*s,re=new Float32Array(12),fe=new Float32Array(8);for(let Ve=0;Ve<4;Ve++)fe[Ve*2]=Ve%2?1:0,fe[Ve*2+1]=Ve>1?1:0;const pe=[Eo.X,Eo.Y,Eo.Z].includes(e.renderable.getSlicingMode())?I:A,ie=i.getSpatialExtent(),te=a.getData();let ee=null;if(M===Eo.I){ee=new te.constructor(J[2]*J[1]*s);let Ve=0;for(let Ge=0;Ge<J[2];Ge++)for(let qe=0;qe<J[1];qe++){let Be=(U+qe*J[0]+Ge*J[0]*J[1])*s;Ve=(Ge*J[1]+qe)*s;const ae=Be+s;for(;Be<ae;)ee[Ve++]=te[Be++]}J[0]=J[1],J[1]=J[2],re[0]=pe,re[1]=ie[2],re[2]=ie[4],re[3]=pe,re[4]=ie[3],re[5]=ie[4],re[6]=pe,re[7]=ie[2],re[8]=ie[5],re[9]=pe,re[10]=ie[3],re[11]=ie[5]}else if(M===Eo.J){ee=new te.constructor(J[2]*J[0]*s);let Ve=0;for(let Ge=0;Ge<J[2];Ge++)for(let qe=0;qe<J[0];qe++){let Be=(qe+U*J[0]+Ge*J[0]*J[1])*s;Ve=(Ge*J[0]+qe)*s;const ae=Be+s;for(;Be<ae;)ee[Ve++]=te[Be++]}J[1]=J[2],re[0]=ie[0],re[1]=pe,re[2]=ie[4],re[3]=ie[1],re[4]=pe,re[5]=ie[4],re[6]=ie[0],re[7]=pe,re[8]=ie[5],re[9]=ie[1],re[10]=pe,re[11]=ie[5]}else M===Eo.K||M===Eo.NONE?(ee=te.subarray(U*X,(U+1)*X),re[0]=ie[0],re[1]=ie[2],re[2]=pe,re[3]=ie[1],re[4]=ie[2],re[5]=pe,re[6]=ie[0],re[7]=ie[3],re[8]=pe,re[9]=ie[1],re[10]=ie[3],re[11]=pe):P0("Reformat slicing not yet supported.");const we=e._openGLRenderWindow.getGraphicsResourceForObject(ee);we!=null&&we.vtkObj?(e.openGLTexture=we.vtkObj,e.VBOBuildString=we.hash):(e._scalars!==ee&&(e._openGLRenderWindow.releaseGraphicsResourcesForObject(e._scalars),e._scalars=ee),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(J[0],J[1],s,a.getDataType(),ee,(K=(z=e.renderable).getPreferSizeOverAccuracy)==null?void 0:K.call(z)),e._openGLRenderWindow.setGraphicsResourceForObject(ee,e.openGLTexture,e.VBOBuildString)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const Ce=Bt.newInstance({numberOfComponents:3,values:re});Ce.setName("points");const De=Bt.newInstance({numberOfComponents:2,values:fe});De.setName("tcoords");const Re=new Uint16Array(8);Re[0]=3,Re[1]=0,Re[2]=1,Re[3]=3,Re[4]=3,Re[5]=0,Re[6]=3,Re[7]=2;const Oe=Bt.newInstance({numberOfComponents:1,values:Re});e.tris.getCABO().createVBO(Oe,"polys",Si.SURFACE,{points:Ce,tcoords:De,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=B}},t.updatelabelOutlineThicknessTexture=n=>{e.labelOutlineThicknessTexture||(e.labelOutlineThicknessTexture=Dr.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow));const r=n.getProperty().getLabelOutlineThickness(),i=e._openGLRenderWindow.getGraphicsResourceForObject(r),a=`${r.join("-")}`;if(!(i!=null&&i.vtkObj)||(i==null?void 0:i.hash)!==a||e.labelOutlineThicknessTextureString!==a){const d=new Uint8Array(1024);for(let f=0;f<1024;++f){const h=typeof r[f]<"u"?r[f]:r[0];d[f]=h}e.labelOutlineThicknessTexture.releaseGraphicsResources(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Ft.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Ft.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,un.UNSIGNED_CHAR,d),e.labelOutlineThicknessTextureString=a,r&&e._openGLRenderWindow.setGraphicsResourceForObject(r,e.labelOutlineThicknessTexture,e.labelOutlineThicknessTextureString)}else e.labelOutlineThicknessTexture=i.vtkObj,e.labelOutlineThicknessTextureString=i.hash},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:r}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,r]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:r}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,r]}}const eue={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,_scalars:null};function yV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eue,n),$n.extend(t,e,n),ps.implementReplaceShaderCoincidentOffset(t,e,n),ps.implementBuildShadersWithReplacements(t,e,n),e.tris=ys.newInstance(),e.imagemat=kt(new Float64Array(16)),e.imagematinv=kt(new Float64Array(16)),e.projectionToWorld=kt(new Float64Array(16)),e.idxToView=kt(new Float64Array(16)),e.idxNormalMatrix=fo(new Float64Array(9)),e.modelToView=kt(new Float64Array(16)),e.projectionToView=kt(new Float64Array(16)),Ur(t,e,[]),e.VBOBuildTime={},ir(e.VBOBuildTime),Qce(t,e)}const wV=Ln(yV,"vtkOpenGLImageMapper");var tue={newInstance:wV,extend:yV};jr("vtkAbstractImageMapper",wV);function nue(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(hr(e.keyMatrices.mcwc,e.renderable.getMatrix()),yn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const rue={context:null,keyMatrixTime:null,keyMatrices:null};function CV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rue,n),$n.extend(t,e,n),e.keyMatrixTime={},ir(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:kt(new Float64Array(16))},Ur(t,e,["context"]),nue(t,e)}const xV=Ln(CV,"vtkOpenGLImageSlice");var iue={newInstance:xV,extend:CV};jr("vtkImageSlice",xV);const{vtkDebugMacro:aue}=_i;function oue(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent();const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const l=r.getZBufferTexture(),c=Math.floor(l.getWidth()),d=Math.floor(l.getHeight()),f=e._openGLRenderWindow.getContext();l.bind();const h=r.getFramebuffer();h?h.saveCurrentBindingsAndBuffers():aue("No framebuffer to save/restore");const p=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,p),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(c*d*4),f.viewport(0,0,c,d),f.readPixels(0,0,c,d,f.RGBA,f.UNSIGNED_BYTE,s)),h&&h.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const sue={};function SV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sue,n),$n.extend(t,e,n),oue(t,e)}const EV=Ln(SV,"vtkOpenGLPixelSpaceCallbackMapper");var lue={newInstance:EV,extend:SV};jr("vtkPixelSpaceCallbackMapper",EV);const{vtkDebugMacro:cue}=_i;function uue(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(cue("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),l=Math.round(o[1]),c=n[2]-r[0],d=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(c,d);let h=Math.round(f[0])-s,p=Math.round(f[1])-l;return h<0&&(h=0),p<0&&(p=0),{usize:h,vsize:p,lowerLeftU:s,lowerLeftV:l}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const fue={context:null,_openGLRenderWindow:null,selector:null};function TV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fue,n),$n.extend(t,e,n),aa(t,e,["shaderCache"]),Ur(t,e,["selector"]),lp(t,e,["openGLRenderWindow"]),uue(t,e)}const _V=Ln(TV,"vtkOpenGLRenderer");var due={newInstance:_V,extend:TV};jr("vtkRenderer",_V);const{vtkErrorMacro:_O}=_i;function hue(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const a=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(a),s=new Float64Array(16);if(Vr(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const l=a.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",l[0],l[1],l[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let s=0;s<4;s++)r[s*3]=s%2*2-1,r[s*3+1]=s>1?1:-1,r[s*3+2]=1;const i=Bt.newInstance({numberOfComponents:3,values:r});i.setName("points");const a=new Uint16Array(8);a[0]=3,a[1]=0,a[2]=1,a[3]=3,a[4]=3,a[5]=0,a[6]=3,a[7]=2;const o=Bt.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",Si.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||_O("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||_O("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const gue={context:null};function DV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gue,n),$n.extend(t,e,n),e.openGLTexture=Dr.newInstance(),e.tris=ys.newInstance(),e.keyMatrixTime={},ir(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:fo(new Float64Array(9)),mcwc:kt(new Float64Array(16))},Ur(t,e,["context"]),aa(t,e,["activeTextures"]),hue(t,e)}const bV=Ln(DV);var pue={newInstance:bV,extend:DV};jr("vtkSkybox",bV);var mue=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:vue}=_i;function yue(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=mue,r.Fragment=hp,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=Le.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Le.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=Le.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const l=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Le.substitute(s,"//VTK::Normal::Dec",l).result;let c="";e.context.getExtension("EXT_frag_depth")&&(c=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(c=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Le.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,c]).result,s=Le.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Le.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||vue("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",l.vcpc),o.isUniformUsed("MCVCMatrix"))if(a.getIsIdentity())o.setUniformMatrix("MCVCMatrix",l.wcvc);else{const c=e.openGLActor.getKeyMatrices(),d=new Float64Array(16);En(d,l.wcvc,c.mcwc),o.setUniformMatrix("MCVCMatrix",d)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),l=a.getPointData(),c=a.getPoints(),d=c.getNumberOfPoints(),f=c.getData(),h=5;let p=null;e.renderable.getScaleArray()!=null&&l.hasArray(e.renderable.getScaleArray())&&(p=l.getArray(e.renderable.getScaleArray()).getData());let C=null,x=0,T=null;o?(x=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),C=o.getData(),T=new Uint8Array(3*d*4),s.getColorBO()||s.setColorBO(Hs.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(x);const _=new Float32Array(h*d*3);s.setStride(h*4);const y=Math.cos(Cr(30));let w=0,b=0,M=0,I=0;for(let A=0;A<d;++A){let k=e.renderable.getRadius();p&&(k=p[A]),w=A*3,_[M++]=f[w++],_[M++]=f[w++],_[M++]=f[w++],_[M++]=-2*k*y,_[M++]=-k,C&&(b=A*x,T[I++]=C[b],T[I++]=C[b+1],T[I++]=C[b+2],T[I++]=C[b+3]),w=A*3,_[M++]=f[w++],_[M++]=f[w++],_[M++]=f[w++],_[M++]=2*k*y,_[M++]=-k,C&&(T[I++]=C[b],T[I++]=C[b+1],T[I++]=C[b+2],T[I++]=C[b+3]),w=A*3,_[M++]=f[w++],_[M++]=f[w++],_[M++]=f[w++],_[M++]=0,_[M++]=2*k,C&&(T[I++]=C[b],T[I++]=C[b+1],T[I++]=C[b+2],T[I++]=C[b+3])}s.setElementCount(M/h),s.upload(_,Ys.ARRAY_BUFFER),o&&s.getColorBO().upload(T,Ys.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const wue={};function IV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wue,n),Ry.extend(t,e,n),yue(t,e)}const OV=Ln(IV,"vtkOpenGLSphereMapper");var Cue={newInstance:OV,extend:IV};jr("vtkSphereMapper",OV);var xue=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:fm}=_i;function Sue(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=xue,r.Fragment=hp,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=Le.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Le.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=Le.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const l=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Le.substitute(s,"//VTK::Normal::Dec",l).result;let c="";e.context.getExtension("EXT_frag_depth")&&(c=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(c=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Le.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,c]).result,s=Le.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Le.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||fm("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||fm("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||fm("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",l.vcpc),a.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",l.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",l.normalMatrix);else{const c=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){const d=new Float64Array(16);En(d,l.wcvc,c.mcwc),o.setUniformMatrix("MCVCMatrix",d)}if(o.isUniformUsed("normalMatrix")){const d=new Float64Array(9);Af(d,l.normalMatrix,c.normalMatrix),o.setUniformMatrix3x3("normalMatrix",d)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),l=a.getPointData(),c=a.getPoints(),d=c.getNumberOfPoints(),f=c.getData();let h=3;h+=4;let p=null,C=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(Hs.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(C=o.getNumberOfComponents(),s.setColorOffset(4),p=o.getData(),s.setColorBOStride(8)),s.setColorComponents(C),s.setStride(h*4);const x=new Float32Array(h*d*12),T=new Uint8Array(12*d*(p?8:4));let _=null,y=null;e.renderable.getScaleArray()!=null&&l.hasArray(e.renderable.getScaleArray())&&(_=l.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&l.hasArray(e.renderable.getOrientationArray())?y=l.getArray(e.renderable.getOrientationArray()).getData():fm([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const w=[0,1,3,0,3,2,2,3,5,2,5,4];let b=0,M=0,I=0,A=0;for(let k=0;k<d;++k){let U=e.renderable.getLength(),B=e.renderable.getRadius();_&&(U=_[k*2],B=_[k*2+1]);for(let z=0;z<w.length;++z)b=k*3,x[I++]=f[b++],x[I++]=f[b++],x[I++]=f[b++],b=k*3,x[I++]=y[b++]*U,x[I++]=y[b++]*U,x[I++]=y[b++]*U,x[I++]=B,T[A++]=255*(w[z]%2),T[A++]=w[z]>=4?255:0,T[A++]=w[z]>=2?255:0,T[A++]=255,M=k*C,p&&(T[A++]=p[M],T[A++]=p[M+1],T[A++]=p[M+2],T[A++]=p[M+3])}s.setElementCount(I/h),s.upload(x,Ys.ARRAY_BUFFER),s.getColorBO().upload(T,Ys.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const Eue={};function MV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eue,n),Ry.extend(t,e,n),Sue(t,e)}const NV=Ln(MV,"vtkOpenGLStickMapper");var Tue={newInstance:NV,extend:MV};jr("vtkStickMapper",NV);function _ue(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),hr(e.MCWCMatrix,e.renderable.getMatrix()),yn(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?fo(e.normalMatrix):(Cy(e.normalMatrix,e.MCWCMatrix),fp(e.normalMatrix,e.normalMatrix),KE(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const Due={};function RV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Due,n),$n.extend(t,e,n),e.keyMatrixTime={},ir(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Ur(t,e,["context"]),_ue(t,e)}const AV=Ln(RV,"vtkOpenGLVolume");var bue={newInstance:AV,extend:RV};jr("vtkVolume",AV);const Dx={NEAREST:0,LINEAR:1,FAST_LINEAR:2},LV={FRACTIONAL:0,PROPORTIONAL:1},rv={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var kV={InterpolationType:Dx,OpacityMode:LV,ColorMixPreset:rv},Iue=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,Oue=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

#ifdef vtkImageLabelOutlineOn

uniform float outlineOpacity;
uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;
uniform mat4 PCWCMatrix;
uniform mat4 vWCtoIDX;
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;

// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif

#ifdef vtkImageLabelOutlineOn
vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = vec4(
    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
    (fragCoord.z - 0.5) * 2.0,
    1.0);

  vec4 worldCoord = PCWCMatrix * pcPos;
  vec4 vertex = (worldCoord/worldCoord.w);

  vec3 index = (vWCtoIDX * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) / vec3(volumeDimensions);
}
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

//=======================================================================
// Given a texture value compute the color and opacity
//
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{
#ifdef vtkImageLabelOutlineOn
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents
    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);

  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:Mue,vtkErrorMacro:E4}=_i;function DO(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function Nue(t){switch(t){case rv.CUSTOM:return"//VTK::CustomColorMix";case rv.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case rv.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function Rue(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper"),t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(r,i)=>{if(r){const a=i.getZBufferTexture();a!==e.zBufferTexture&&(e.zBufferTexture=a)}},t.opaqueZBufferPass=(r,i)=>t.zBufferPass(r,i),t.volumePass=(r,i)=>{if(r){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const a=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const o=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(o.getActiveCamera()),t.renderPiece(o,a)}},t.getShaderTemplate=(r,i,a)=>{r.Vertex=Iue,r.Fragment=Oue,r.Geometry=""},t.useIndependentComponents=r=>{var l,c;const i=r.getIndependentComponents(),a=e.currentInput,o=(c=(l=a==null?void 0:a.getPointData())==null?void 0:l.getScalars())==null?void 0:c.getNumberOfComponents(),s=r.getColorMixPreset();return i&&o>=2||!!s},t.replaceShaderValues=(r,i,a)=>{const o=a.getProperty();let s=r.Fragment;o.getInterpolationType()===Dx.LINEAR&&(s=Le.substitute(s,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),o.getUseLabelOutline()===!0&&(s=Le.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result);const d=e.scalarTexture.getComponents();s=Le.substitute(s,"//VTK::NumComponents",`#define vtkNumComponents ${d}`).result;const f=t.useIndependentComponents(o);f&&(s=Le.substitute(s,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const h=[],p=[];for(let M=0;M<d;M++)o.getOpacityMode(M)===LV.PROPORTIONAL&&h.push(`#define vtkComponent${M}Proportional`),o.getForceNearestInterpolation(M)&&p.push(`#define vtkComponent${M}ForceNearest`);s=Le.substitute(s,"//VTK::vtkProportionalComponents",h.join(`
`)).result,s=Le.substitute(s,"//VTK::vtkForceNearestComponents",p.join(`
`)).result;const C=o.getColorMixPreset(),x=Nue(C);x&&(s=Le.substitute(s,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,s=Le.substitute(s,"//VTK::CustomComponentsColorMix::Impl",x).result);const T=e.currentInput.getSpatialExtent(),_=e.currentInput.getSpacing(),y=new Float64Array(3);Dn(y,(T[1]-T[0])*_[0],(T[3]-T[2])*_[1],(T[5]-T[4])*_[2]);const w=Xs(y)/t.getCurrentSampleDistance(i);s=Le.substitute(s,"//VTK::MaximumSamplesValue",`${Math.ceil(w)}`).result,s=Le.substitute(s,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(s=Le.substitute(s,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(s=Le.substitute(s,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&o.getAmbient()>0&&(s=Le.substitute(s,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const b=f?d:1;e.gopacity=!1;for(let M=0;!e.gopacity&&M<b;++M)e.gopacity||(e.gopacity=o.getUseGradientOpacity(M));e.gopacity&&(s=Le.substitute(s,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(s=Le.substitute(s,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(s=Le.substitute(s,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,s=Le.substitute(s,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),s=Le.substitute(s,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,r.Fragment=s,t.replaceShaderLight(r,i,a),t.replaceShaderClippingPlane(r,i,a)},t.replaceShaderLight=(r,i,a)=>{if(e.lightComplexity===0)return;let o=r.Fragment,s=0;i.getLights().forEach(l=>{l.getSwitch()&&(s+=1)}),o=Le.substitute(o,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${s}];`,`uniform vec3 lightDirectionVC[${s}]; // normalized`,`uniform vec3 lightHalfAngleVC[${s}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(o=Le.substitute(o,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${s}];`,`uniform vec3 lightAttenuation[${s}];`,`uniform float lightConeAngle[${s}];`,`uniform float lightExponent[${s}];`,`uniform int lightPositional[${s}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(o=Le.substitute(o,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0&&(o=Le.substitute(o,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),r.Fragment=o},t.replaceShaderClippingPlane=(r,i,a)=>{let o=r.Fragment;if(e.renderable.getClippingPlanes().length>0){const s=e.renderable.getClippingPlanes().length;o=Le.substitute(o,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,o=Le.substitute(o,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${s}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}r.Fragment=o};const n=(r,i)=>{let a=0;r.getProperty().getShade()&&e.renderable.getBlendMode()===fA.COMPOSITE_BLEND&&(a=0,e.numberOfLights=0,i.forEach(o=>{o.getSwitch()>0&&(e.numberOfLights++,a===0&&(a=1)),a===1&&(e.numberOfLights>1||o.getIntensity()!==1||!o.lightTypeIsHeadLight())&&(a=2),a<3&&o.getPositional()&&(a=3)})),a!==e.lightComplexity&&(e.lightComplexity=a,t.modified())};t.getNeedToRebuildShaders=(r,i,a)=>{var T;const o=a.getProperty();n(a,i.getLights());const s=e.scalarTexture.getComponents(),l=[],c=[];for(let _=0;_<s;_++)l.push(o.getOpacityMode(_)),c.push(o.getForceNearestInterpolation(_));const d=e.currentInput.getSpatialExtent(),f=e.currentInput.getSpacing(),h=new Float64Array(3);Dn(h,(d[1]-d[0])*f[0],(d[3]-d[2])*f[1],(d[5]-d[4])*f[2]);const p=Xs(h)/t.getCurrentSampleDistance(i),C=!!e.zBufferTexture,x={iComps:o.getIndependentComponents(),colorMixPreset:o.getColorMixPreset(),interpolationType:o.getInterpolationType(),useLabelOutline:o.getUseLabelOutline(),numComp:s,maxSamples:p,useGradientOpacity:o.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:C,opacityModes:l,forceNearestInterps:c};return((T=r.getProgram())==null?void 0:T.getHandle())===0||r.getShaderSourceTime().getMTime()<t.getMTime()||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!pA(e.previousState,x)?(e.previousState=x,!0):!1},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a),t.getClippingPlaneShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram();r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexDC")&&(r.getVAO().addAttributeArray(o,r.getCABO(),"vertexDC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||E4("Error setting vertexDC in shader VAO.")),r.getAttributeUpdateTime().modified()),o.setUniformi("texture1",e.scalarTexture.getTextureUnit()),o.setUniformf("sampleDistance",t.getCurrentSampleDistance(i));const s=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange(),c=[],d=[];for(let f=0;f<4;f++)c[f]=l[0]*s.dataComputedScale[f]+s.dataComputedOffset[f],d[f]=l[1]*s.dataComputedScale[f]+s.dataComputedOffset[f],c[f]=(c[f]-s.offset[f])/s.scale[f],d[f]=(d[f]-s.offset[f])/s.scale[f];if(o.setUniform4f("ipScalarRangeMin",c[0],c[1],c[2],c[3]),o.setUniform4f("ipScalarRangeMax",d[0],d[1],d[2],d[3]),e.zBufferTexture!==null){o.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const f=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();o.setUniformf("vpZWidth",f[0]),o.setUniformf("vpZHeight",f[1])}},t.setCameraShaderParameters=(r,i,a)=>{const o=e.openGLCamera.getKeyMatrices(i),s=e.openGLVolume.getKeyMatrices();En(e.modelToView,o.wcvc,s.mcwc);const l=r.getProgram(),c=e.openGLCamera.getRenderable(),d=c.getClippingRange();l.setUniformf("camThick",d[1]-d[0]),l.setUniformf("camNear",d[0]),l.setUniformf("camFar",d[1]);const f=e.currentInput.getBounds(),h=e.currentInput.getDimensions(),p=new Float64Array(3),C=new Float64Array(3);let x=1,T=-1,_=1,y=-1;for(let re=0;re<8;++re){if(Dn(p,f[re%2],f[2+Math.floor(re/2)%2],f[4+Math.floor(re/4)]),vn(p,p,e.modelToView),!c.getParallelProjection()){Ui(C,p);const fe=-d[0]/p[2];Za(p,C,fe)}vn(p,p,o.vcpc),x=Math.min(p[0],x),T=Math.max(p[0],T),_=Math.min(p[1],_),y=Math.max(p[1],y)}l.setUniformf("dcxmin",x),l.setUniformf("dcxmax",T),l.setUniformf("dcymin",_),l.setUniformf("dcymax",y),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",c.getParallelProjection());const w=e.currentInput.getSpatialExtent(),b=e.currentInput.getSpacing(),M=new Float64Array(3);Dn(M,(w[1]-w[0])*b[0],(w[3]-w[2])*b[1],(w[5]-w[4])*b[2]),l.setUniform3f("vSpacing",b[0],b[1],b[2]),Dn(p,w[0],w[2],w[4]),e.currentInput.indexToWorldVec3(p,p),vn(p,p,e.modelToView),l.setUniform3f("vOriginVC",p[0],p[1],p[2]);const I=e.currentInput.getIndexToWorld();En(e.idxToView,e.modelToView,I),Af(e.idxNormalMatrix,o.normalMatrix,s.normalMatrix),Af(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const A=Xs(M)/t.getCurrentSampleDistance(i);A>e.renderable.getMaximumSamplesPerRay()&&Mue(`The number of steps required ${Math.ceil(A)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const k=new Float64Array(3);if(Dn(k,1,1,1),tT(k,k,M),l.setUniform3f("vVCToIJK",k[0],k[1],k[2]),l.setUniform3i("volumeDimensions",h[0],h[1],h[2]),!e._openGLRenderWindow.getWebgl2()){const re=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",re.xreps),l.setUniformi("xstride",re.xstride),l.setUniformi("ystride",re.ystride)}const U=new Float64Array(3),B=new Float64Array(3);for(let re=0;re<6;++re){switch(re){case 1:Dn(U,-1,0,0),Dn(B,w[0],w[2],w[4]);break;case 2:Dn(U,0,1,0),Dn(B,w[1],w[3],w[5]);break;case 3:Dn(U,0,-1,0),Dn(B,w[0],w[2],w[4]);break;case 4:Dn(U,0,0,1),Dn(B,w[1],w[3],w[5]);break;case 5:Dn(U,0,0,-1),Dn(B,w[0],w[2],w[4]);break;case 0:default:Dn(U,1,0,0),Dn(B,w[1],w[3],w[5]);break}tg(U,U,e.idxNormalMatrix),vn(B,B,e.idxToView);const fe=-1*er(B,U);l.setUniform3f(`vPlaneNormal${re}`,U[0],U[1],U[2]),l.setUniformf(`vPlaneDistance${re}`,fe)}if(a.getProperty().getUseLabelOutline()){const fe=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",fe);const pe=i.getActiveCamera(),[ie,te]=pe.getClippingRange(),ee=pe.getDistance();pe.setClippingRange(ee,ee+.1);const we=e.openGLCamera.getKeyMatrices(i);Vr(e.projectionToWorld,we.wcpc),pe.setClippingRange(ie,te),e.openGLCamera.getKeyMatrices(i),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const Ce=t.getRenderTargetSize();l.setUniformf("vpWidth",Ce[0]),l.setUniformf("vpHeight",Ce[1]);const De=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",De[0]/Ce[0]),l.setUniformf("vpOffsetY",De[1]/Ce[1])}if(Vr(e.projectionToView,o.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let z=0;const K=[],J=[],X=[];if(i.getLights().forEach(re=>{if(re.getSwitch()>0){const pe=re.getColor(),ie=re.getIntensity();K[0+z*3]=pe[0]*ie,K[1+z*3]=pe[1]*ie,K[2+z*3]=pe[2]*ie;const te=re.getDirection();Dn(U,te[0],te[1],te[2]),tg(U,U,o.normalMatrix),Ui(U,U),J[0+z*3]=U[0],J[1+z*3]=U[1],J[2+z*3]=U[2],X[0+z*3]=-.5*U[0],X[1+z*3]=-.5*U[1],X[2+z*3]=-.5*(U[2]-1),z++}}),l.setUniformi("twoSidedLighting",i.getTwoSidedLighting()),l.setUniformi("lightNum",z),l.setUniform3fv("lightColor",K),l.setUniform3fv("lightDirectionVC",J),l.setUniform3fv("lightHalfAngleVC",X),e.lightComplexity===3){z=0;const re=[],fe=[],pe=[],ie=[],te=[];i.getLights().forEach(ee=>{if(ee.getSwitch()>0){const Ce=ee.getAttenuationValues();fe[0+z*3]=Ce[0],fe[1+z*3]=Ce[1],fe[2+z*3]=Ce[2],ie[z]=ee.getExponent(),pe[z]=ee.getConeAngle(),te[z]=ee.getPositional();const De=ee.getTransformedPosition();vn(De,De,e.modelToView),re[0+z*3]=De[0],re[1+z*3]=De[1],re[2+z*3]=De[2],z+=1}}),l.setUniform3fv("lightPositionVC",re),l.setUniform3fv("lightAttenuation",fe),l.setUniformfv("lightConeAngle",pe),l.setUniformfv("lightExponent",ie),l.setUniformiv("lightPositional",te)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0){const re=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",re);const fe=[];for(let pe=0;pe<re;pe++)fe[pe*2]=Math.random()*.5,fe[pe*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",fe),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();o.setUniformi("ctexture",e.colorTexture.getTextureUnit()),o.setUniformi("otexture",e.opacityTexture.getTextureUnit()),o.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),o.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const s=e.scalarTexture.getVolumeInfo(),l=a.getProperty(),c=e.scalarTexture.getComponents(),d=t.useIndependentComponents(l);if(d)for(let h=0;h<c;h++)o.setUniformf(`mix${h}`,a.getProperty().getComponentWeight(h));for(let h=0;h<c;h++){const p=d?h:0,C=s.scale[h],T=l.getScalarOpacity(p).getRange(),_=C/(T[1]-T[0]),y=(s.offset[h]-T[0])/(T[1]-T[0]);o.setUniformf(`oshift${h}`,y),o.setUniformf(`oscale${h}`,_);const b=l.getRGBTransferFunction(p).getRange(),M=(s.offset[h]-b[0])/(b[1]-b[0]),I=C/(b[1]-b[0]);o.setUniformf(`cshift${h}`,M),o.setUniformf(`cscale${h}`,I)}if(e.gopacity)if(d)for(let h=0;h<c;++h){const p=s.scale[h];if(l.getUseGradientOpacity(h)){const x=l.getGradientOpacityMinimumOpacity(h),T=l.getGradientOpacityMaximumOpacity(h);o.setUniformf(`gomin${h}`,x),o.setUniformf(`gomax${h}`,T);const _=[l.getGradientOpacityMinimumValue(h),l.getGradientOpacityMaximumValue(h)];o.setUniformf(`goscale${h}`,p*(T-x)/(_[1]-_[0])),o.setUniformf(`goshift${h}`,-_[0]*(T-x)/(_[1]-_[0])+x)}else o.setUniformf(`gomin${h}`,1),o.setUniformf(`gomax${h}`,1),o.setUniformf(`goscale${h}`,0),o.setUniformf(`goshift${h}`,1)}else{const h=s.scale[c-1],p=l.getGradientOpacityMinimumOpacity(0),C=l.getGradientOpacityMaximumOpacity(0);o.setUniformf("gomin0",p),o.setUniformf("gomax0",C);const x=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];o.setUniformf("goscale0",h*(C-p)/(x[1]-x[0])),o.setUniformf("goshift0",-x[0]*(C-p)/(x[1]-x[0])+p)}if(a.getProperty().getUseLabelOutline()===!0){const h=a.getProperty().getLabelOutlineOpacity();o.setUniformf("outlineOpacity",h)}e.lightComplexity>0&&(o.setUniformf("vAmbient",l.getAmbient()),o.setUniformf("vDiffuse",l.getDiffuse()),o.setUniformf("vSpecular",l.getSpecular()),o.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(r,i,a)=>{if(e.renderable.getClippingPlanes().length>0){const o=e.openGLCamera.getKeyMatrices(i),s=[],l=[],c=[],d=e.renderable.getClippingPlanes(),f=d.length;for(let p=0;p<f;++p){const C=d[p].getNormal(),x=d[p].getOrigin();tg(C,C,o.normalMatrix),vn(x,x,o.wcvc);const T=-1*er(x,C);s.push(C[0]),s.push(C[1]),s.push(C[2]),l.push(T),c.push(x[0]),c.push(x[1]),c.push(x[2])}const h=r.getProgram();h.setUniform3fv("vClipPlaneNormals",s),h.setUniformfv("vClipPlaneDistances",l),h.setUniform3fv("vClipPlaneOrigins",c),h.setUniformi("clip_numPlanes",f)}},t.delete=aE(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getCurrentSampleDistance=r=>{const i=r.getVTKWindow().getInteractor(),a=e.renderable.getSampleDistance();if(i.isAnimating()){const o=e.renderable.getInteractionSampleDistanceFactor();return a*o}return a},t.renderPieceStart=(r,i)=>{const a=r.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,a.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=a.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const s=a.getRecentAnimationFrameRate(),l=a.getDesiredUpdateRate()/s;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const s=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*s[0]),e._smallViewportHeight=Math.ceil(l*s[1]),e._smallViewportHeight>s[1]&&(e._smallViewportHeight=s[1]),e._smallViewportWidth>s[0]&&(e._smallViewportWidth=s[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(s[0],s[1]),e.framebuffer.populateFramebuffer();else{const d=e.framebuffer.getSize();(!d||d[0]!==s[0]||d[1]!==s[1])&&(e.framebuffer.create(s[0],s[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const c=e.context;c.clearColor(0,0,0,0),c.colorMask(!0,!0,!0,!0),c.clear(c.COLOR_BUFFER_BIT),c.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/s[0],e._smallViewportHeight/s[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(r,i),i.getProperty().getInterpolationType()===Dx.NEAREST?(e.scalarTexture.setMinificationFilter(Ft.NEAREST),e.scalarTexture.setMagnificationFilter(Ft.NEAREST)):(e.scalarTexture.setMinificationFilter(Ft.LINEAR),e.scalarTexture.setMagnificationFilter(Ft.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(r,i)=>{const a=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(r,i)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=TT.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||E4("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const a=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,a[0],a[1]);const o=e.framebuffer.getColorTexture();o.activate(),e.copyShader.setUniformi("texture",o.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const s=e.context;s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.deactivate(),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){E4("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){ju(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime(),t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(!a)return;const o=a.getPointData()&&a.getPointData().getScalars();if(!o)return;e._scalars!==o&&(e._openGLRenderWindow.releaseGraphicsResourcesForObject(e._scalars),e._scalars=o);const s=i.getProperty();if(!e.jitterTexture.getHandle()){const b=new Uint8Array(1024);for(let M=0;M<32*32;++M)b[M]=255*Math.random();e.jitterTexture.setMinificationFilter(Ft.LINEAR),e.jitterTexture.setMagnificationFilter(Ft.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,un.UNSIGNED_CHAR,b)}const l=o.getNumberOfComponents(),c=t.useIndependentComponents(s),d=c?l:1,f=s.getScalarOpacity(),h=e._openGLRenderWindow.getGraphicsResourceForObject(f);let p=DO(f,c,d);if(!h.vtkObj||h.hash!==p||e.opacityTextureString!==p){const M=2048*d,I=new Float32Array(M),A=new Float32Array(1024);for(let k=0;k<d;++k){const U=s.getScalarOpacity(k),B=t.getCurrentSampleDistance(r)/s.getScalarOpacityUnitDistance(k),z=U.getRange();U.getTable(z[0],z[1],1024,A,1);for(let K=0;K<1024;++K)I[k*1024*2+K]=1-(1-A[K])**B,I[k*1024*2+K+1024]=I[k*1024*2+K]}if(e.opacityTexture.releaseGraphicsResources(e._openGLRenderWindow),e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(Ft.LINEAR),e.opacityTexture.setMagnificationFilter(Ft.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(1024,2*d,1,un.FLOAT,I);else{const k=new Uint8ClampedArray(M);for(let U=0;U<M;++U)k[U]=255*I[U];e.opacityTexture.create2DFromRaw(1024,2*d,1,un.UNSIGNED_CHAR,k)}e.opacityTextureString=p,f&&e._openGLRenderWindow.setGraphicsResourceForObject(f,e.opacityTexture,e.opacityTextureString)}else e.opacityTexture=h.vtkObj,e.opacityTextureString=h.hash;const x=s.getRGBTransferFunction();p=DO(x,c,d);const T=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!(T!=null&&T.vtkObj)||(T==null?void 0:T.hash)!==p||e.colorTextureString!==p){const M=2048*d*3,I=new Uint8ClampedArray(M),A=new Float32Array(1024*3);for(let k=0;k<d;++k){const U=s.getRGBTransferFunction(k),B=U.getRange();U.getTable(B[0],B[1],1024,A,1);for(let z=0;z<1024*3;++z)I[k*1024*6+z]=255*A[z],I[k*1024*6+z+1024*3]=255*A[z]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(Ft.LINEAR),e.colorTexture.setMagnificationFilter(Ft.LINEAR),e.colorTexture.create2DFromRaw(1024,2*d,3,un.UNSIGNED_CHAR,I),e.colorTextureString=p,x&&e._openGLRenderWindow.setGraphicsResourceForObject(x,e.colorTexture,e.colorTextureString)}else e.colorTexture=T.vtkObj,e.colorTextureString=T.hash;t.updateLabelOutlineThicknessTexture(i);const y=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(p=`${a.getMTime()}A${o.getMTime()}`,!(y!=null&&y.vtkObj)||(y==null?void 0:y.hash)!==p){const b=a.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.releaseGraphicsResources(e._openGLRenderWindow),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(b[0],b[1],b[2],o,e.renderable.getPreferSizeOverAccuracy()),o&&e._openGLRenderWindow.setGraphicsResourceForObject(o,e.scalarTexture,p)}else e.scalarTexture=y.vtkObj;if(!e.tris.getCABO().getElementCount()){const b=new Float32Array(12);for(let k=0;k<4;k++)b[k*3]=k%2*2-1,b[k*3+1]=k>1?1:-1,b[k*3+2]=-1;const M=new Uint16Array(8);M[0]=3,M[1]=0,M[2]=1,M[3]=3,M[4]=3,M[5]=0,M[6]=3,M[7]=2;const I=Bt.newInstance({numberOfComponents:3,values:b});I.setName("points");const A=Bt.newInstance({numberOfComponents:1,values:M});e.tris.getCABO().createVBO(A,"polys",Si.SURFACE,{points:I,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=r=>{const i=r.getProperty().getLabelOutlineThickness(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!(a!=null&&a.vtkObj)||(a==null?void 0:a.hash)!==o||e.labelOutlineThicknessTextureString!==o){const f=new Uint8Array(1024);for(let h=0;h<1024;++h){const p=typeof i[h]<"u"?i[h]:i[0];f[h]=p}e.labelOutlineThicknessTexture.releaseGraphicsResources(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Ft.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Ft.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,un.UNSIGNED_CHAR,f),e.labelOutlineThicknessTextureString=o,i&&e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,e.labelOutlineThicknessTextureString)}else e.labelOutlineThicknessTexture=a.vtkObj,e.labelOutlineThicknessTextureString=a.hash}}const Aue={context:null,VBOBuildTime:null,scalarTexture:null,scalarTextureString:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0,_scalars:null};function PV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Aue,n),$n.extend(t,e,n),ps.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},ir(e.VBOBuildTime,{mtime:0}),e.tris=ys.newInstance(),e.scalarTexture=Dr.newInstance(),e.opacityTexture=Dr.newInstance(),e.colorTexture=Dr.newInstance(),e.jitterTexture=Dr.newInstance(),e.jitterTexture.setWrapS(Fg.REPEAT),e.jitterTexture.setWrapT(Fg.REPEAT),e.labelOutlineThicknessTexture=Dr.newInstance(),e.framebuffer=Iy.newInstance(),e.idxToView=kt(new Float64Array(16)),e.idxNormalMatrix=fo(new Float64Array(9)),e.modelToView=kt(new Float64Array(16)),e.projectionToView=kt(new Float64Array(16)),e.projectionToWorld=kt(new Float64Array(16)),Ur(t,e,["context"]),Rue(t,e)}const FV=Ln(PV,"vtkOpenGLVolumeMapper");var VV={newInstance:FV,extend:PV};jr("vtkVolumeMapper",FV);function Lue(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{const i=e.currentInput;if(!i)return;const a=i.getPointData()&&i.getPointData().getScalars();if(!a)return;const o=r.getProperty();if(!e.jitterTexture.getHandle()){const f=new Uint8Array(1024);for(let h=0;h<32*32;++h)f[h]=255*Math.random();e.jitterTexture.setMinificationFilter(Ft.LINEAR),e.jitterTexture.setMagnificationFilter(Ft.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,un.UNSIGNED_CHAR,f)}const s=a.getNumberOfComponents(),c=o.getIndependentComponents()?s:1;let d=`${o.getMTime()}`;if(e.opacityTextureString!==d){const h=2048*c,p=new Float32Array(h),C=new Float32Array(1024);for(let x=0;x<c;++x){const T=o.getScalarOpacity(x),_=e.renderable.getSampleDistance()/o.getScalarOpacityUnitDistance(x),y=T.getRange();T.getTable(y[0],y[1],1024,C,1);for(let w=0;w<1024;++w)p[x*1024*2+w]=1-(1-C[w])**_,p[x*1024*2+w+1024]=p[x*1024*2+w]}if(e.opacityTexture.releaseGraphicsResources(e._openGLRenderWindow),e.opacityTexture.setMinificationFilter(Ft.LINEAR),e.opacityTexture.setMagnificationFilter(Ft.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(1024,2*c,1,un.FLOAT,p);else{const x=new Uint8Array(h);for(let T=0;T<h;++T)x[T]=255*p[T];e.opacityTexture.create2DFromRaw(1024,2*c,1,un.UNSIGNED_CHAR,x)}e.opacityTextureString=d}if(d=`${o.getMTime()}`,e.colorTextureString!==d){const h=2048*c*3,p=new Uint8Array(h),C=new Float32Array(1024*3);for(let x=0;x<c;++x){const T=o.getRGBTransferFunction(x),_=T.getRange();T.getTable(_[0],_[1],1024,C,1);for(let y=0;y<1024*3;++y)p[x*1024*6+y]=255*C[y],p[x*1024*6+y+1024*3]=255*C[y]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.setMinificationFilter(Ft.LINEAR),e.colorTexture.setMagnificationFilter(Ft.LINEAR),e.colorTexture.create2DFromRaw(1024,2*c,3,un.UNSIGNED_CHAR,p),e.colorTextureString=d}if(t.updateLabelOutlineThicknessTexture(r),d=`${i.getMTime()}`,e.scalarTextureString!==d){const f=i.getDimensions(),h=e.scalarTexture.getTextureParameters(),p=i.getPointData().getScalars().getDataType(),C=i.getPointData().getScalars().getData();let x=!0;if(h.dataType&&h.dataType===p){const T=h.width*h.height*h.depth*h.numComps;C.length===T&&(x=!1)}x?(e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.releaseGraphicsResources(e._openGLRenderWindow),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromRaw(f[0],f[1],f[2],s,a.getDataType(),a.getData(),e.renderable.getPreferSizeOverAccuracy())):(e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw(C)),e.scalarTextureString=d}if(!e.tris.getCABO().getElementCount()){const f=new Float32Array(12);for(let x=0;x<4;x++)f[x*3]=x%2*2-1,f[x*3+1]=x>1?1:-1,f[x*3+2]=-1;const h=new Uint16Array(8);h[0]=3,h[1]=0,h[2]=1,h[3]=3,h[4]=3,h[5]=0,h[6]=3,h[7]=2;const p=Bt.newInstance({numberOfComponents:3,values:f});p.setName("points");const C=Bt.newInstance({numberOfComponents:1,values:h});e.tris.getCABO().createVBO(C,"polys",Si.SURFACE,{points:p,cellOffset:0})}e.VBOBuildTime.modified()},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:r}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,r]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:r}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,r]}}const kue={};function UV(t,e,n={}){Object.assign(e,kue,n),VV.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},Lue(t,e)}const Pue=de.newInstance(UV,"vtkStreamingOpenGLVolumeMapper"),Fue={newInstance:Pue,extend:UV},BV=Object.create(null);function vi(t,e){BV[t]=e}function Vue(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.getModelInitialValues(n),l=e.overrides[i](s);return l.setMyFactory(t),l},e.overrides=BV,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const Uue={};function GV(t,e,n={}){Object.assign(e,Uue,n),ST.extend(t,e,n),Vue(t,e),vi("vtkActor",Zle.newInstance),vi("vtkActor2D",tce.newInstance),vi("vtkCamera",ice.newInstance),vi("vtkGlyph3DMapper",Xce.newInstance),vi("vtkImageMapper",tue.newInstance),vi("vtkImageSlice",iue.newInstance),vi("vtkMapper",Ry.newInstance),vi("vtkPixelSpaceCallbackMapper",lue.newInstance),vi("vtkRenderer",due.newInstance),vi("vtkSkybox",pue.newInstance),vi("vtkSphereMapper",Cue.newInstance),vi("vtkStickMapper",Tue.newInstance),vi("vtkTexture",Dr.newInstance),vi("vtkVolume",bue.newInstance),vi("vtkVolumeMapper",VV.newInstance),vi("vtkSharedVolumeMapper",Fue.newInstance)}const Bue=de.newInstance(GV,"vtkStreamingOpenGLViewNodeFactory"),Gue={newInstance:Bue,extend:GV};function zue(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function zV(t,e,n={}){Object.assign(e,n),Xle.extend(t,e,n),e.myFactory=Gue.newInstance(),vi("vtkRenderWindow",WV),zue(t,e)}const WV=de.newInstance(zV,"vtkStreamingOpenGLRenderWindow"),Wue={newInstance:WV,extend:zV},{vtkDebugMacro:dm}=de;function jue(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=kt(new Float64Array(16)),o=kt(new Float64Array(16)),s=new Float64Array(3),l=new Float64Array(3),c=new Float64Array(3),d=kt(new Float64Array(16)),f=kt(new Float64Array(16)),h=new Float64Array(3),p=new Float64Array(3);function C(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const x=t.getViewMatrix();e.viewUp[0]=x[4],e.viewUp[1]=x[5],e.viewUp[2]=x[6],t.modified()},t.setPosition=(x,T,_)=>{x===e.position[0]&&T===e.position[1]&&_===e.position[2]||(e.position[0]=x,e.position[1]=T,e.position[2]=_,t.computeDistance(),t.modified())},t.setFocalPoint=(x,T,_)=>{x===e.focalPoint[0]&&T===e.focalPoint[1]&&_===e.focalPoint[2]||(e.focalPoint[0]=x,e.focalPoint[1]=T,e.focalPoint[2]=_,t.computeDistance(),t.modified())},t.setDistance=x=>{if(e.distance===x)return;e.distance=x,e.distance<1e-20&&(e.distance=1e-20,dm("Distance is set to minimum."));const T=e.directionOfProjection;e.focalPoint[0]=e.position[0]+T[0]*e.distance,e.focalPoint[1]=e.position[1]+T[1]*e.distance,e.focalPoint[2]=e.position[2]+T[2]*e.distance,t.modified()},t.computeDistance=()=>{const x=e.focalPoint[0]-e.position[0],T=e.focalPoint[1]-e.position[1],_=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(x*x+T*T+_*_),e.distance<1e-20){e.distance=1e-20,dm("Distance is set to minimum.");const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance}e.directionOfProjection[0]=x/e.distance,e.directionOfProjection[1]=T/e.distance,e.directionOfProjection[2]=_/e.distance,C()},t.dolly=x=>{if(x<=0)return;const T=e.distance/x;t.setPosition(e.focalPoint[0]-T*e.directionOfProjection[0],e.focalPoint[1]-T*e.directionOfProjection[1],e.focalPoint[2]-T*e.directionOfProjection[2])},t.roll=x=>{const T=e.position,_=e.focalPoint,y=e.viewUp,w=new Float64Array([y[0],y[1],y[2],0]);kt(d);const b=new Float64Array([_[0]-T[0],_[1]-T[1],_[2]-T[2]]);Do(d,d,Cr(x),b),Kl(w,w,d),e.viewUp[0]=w[0],e.viewUp[1]=w[1],e.viewUp[2]=w[2],t.modified()},t.azimuth=x=>{const T=e.focalPoint;kt(f),xr(f,f,T),Do(f,f,Cr(x),e.viewUp),xr(f,f,[-T[0],-T[1],-T[2]]),vn(h,e.position,f),t.setPosition(h[0],h[1],h[2])},t.yaw=x=>{const T=e.position;kt(f),xr(f,f,T),Do(f,f,Cr(x),e.viewUp),xr(f,f,[-T[0],-T[1],-T[2]]),vn(p,e.focalPoint,f),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=x=>{const T=e.focalPoint,_=t.getViewMatrix(),y=[-_[0],-_[1],-_[2]];kt(f),xr(f,f,T),Do(f,f,Cr(x),y),xr(f,f,[-T[0],-T[1],-T[2]]),vn(h,e.position,f),t.setPosition(h[0],h[1],h[2])},t.pitch=x=>{const T=e.position,_=t.getViewMatrix(),y=[_[0],_[1],_[2]];kt(f),xr(f,f,T),Do(f,f,Cr(x),y),xr(f,f,[-T[0],-T[1],-T[2]]),vn(p,e.focalPoint,f),t.setFocalPoint(...p)},t.zoom=x=>{x<=0||(e.parallelProjection?e.parallelScale/=x:e.viewAngle/=x,t.modified())},t.translate=(x,T,_)=>{const y=[x,T,_];Rg(e.position,y,e.position),Rg(e.focalPoint,y,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=x=>{const T=[...e.viewUp,1],_=[],y=[],w=[];T[0]+=e.position[0],T[1]+=e.position[1],T[2]+=e.position[2],Kl(_,[...e.position,1],x),Kl(y,[...e.focalPoint,1],x),Kl(w,T,x),w[0]-=_[0],w[1]-=_[1],w[2]-=_[2],t.setPosition(..._.slice(0,3)),t.setFocalPoint(...y.slice(0,3)),t.setViewUp(...w.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=x=>{let T=x;T<1e-20&&(T=1e-20,dm("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+T)},t.setThicknessFromFocalPoint=x=>{let T=x;T<1e-20&&(T=1e-20,dm("Thickness is set to minimum.")),t.setClippingRange(e.distance-T/2,e.distance+T/2)},t.setRoll=x=>{},t.getRoll=()=>{},t.setObliqueAngles=(x,T)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=x=>{},t.getCameraLightTransformMatrix=x=>(hr(x,e.cameraLightTransform),x),t.computeCameraLightTransform=()=>{hr(a,t.getViewMatrix()),Vr(a,a),JE(o,[e.distance,e.distance,e.distance]),En(a,a,o),kt(e.cameraLightTransform),xr(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=x=>{},t.physicalOrientationToWorldDirection=x=>{const T=wx(x[0],x[1],x[2],x[3]),_=rl(),y=wx(0,0,1,0);return SP(_,T),o2(y,T,y),o2(y,y,_),[y[0],y[1],y[2]]},t.getPhysicalToWorldMatrix=x=>{t.getWorldToPhysicalMatrix(x),Vr(x,x)},t.getWorldToPhysicalMatrix=x=>{kt(x);const T=[3];uo(e.physicalViewNorth,e.physicalViewUp,T),x[0]=T[0],x[1]=T[1],x[2]=T[2],x[4]=e.physicalViewUp[0],x[5]=e.physicalViewUp[1],x[6]=e.physicalViewUp[2],x[8]=-e.physicalViewNorth[0],x[9]=-e.physicalViewNorth[1],x[10]=-e.physicalViewNorth[2],yn(x,x),Dn(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),nl(x,x,s),xr(x,x,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=x=>{Vr(a,x),vn(s,n,a),t.computeDistance();const T=e.distance;t.setPosition(s[0],s[1],s[2]),vn(l,r,a),Er(l,l,s),Ui(l,l),t.setDirectionOfProjection(l[0],l[1],l[2]),vn(c,i,a),Er(c,c,s),Ui(c,c),t.setViewUp(c[0],c[1],c[2]),t.setDistance(T)},t.computeViewParametersFromPhysicalMatrix=x=>{t.getWorldToPhysicalMatrix(a),En(a,x,a),t.computeViewParametersFromViewMatrix(a)},t.setViewMatrix=x=>{e.viewMatrix=x,e.viewMatrix&&(hr(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),yn(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;$k(a,e.position,e.focalPoint,e.viewUp),yn(a,a);const x=new Float64Array(16);return hr(x,a),x},t.setProjectionMatrix=x=>{e.projectionMatrix=x},t.getProjectionMatrix=(x,T,_)=>{const y=new Float64Array(16);if(kt(y),e.projectionMatrix){const M=1/e.physicalScale;return Dn(s,M,M,M),hr(y,e.projectionMatrix),nl(y,y,s),yn(y,y),y}kt(a);const w=e.clippingRange[1]-e.clippingRange[0],b=[e.clippingRange[0]+(T+1)*w/2,e.clippingRange[0]+(_+1)*w/2];if(e.parallelProjection){const M=e.parallelScale*x,I=e.parallelScale,A=(e.windowCenter[0]-1)*M,k=(e.windowCenter[0]+1)*M,U=(e.windowCenter[1]-1)*I,B=(e.windowCenter[1]+1)*I;QE(a,A,k,U,B,b[0],b[1]),yn(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const M=Math.tan(Cr(e.viewAngle)/2);let I,A;e.useHorizontalViewAngle===!0?(I=e.clippingRange[0]*M,A=e.clippingRange[0]*M/x):(I=e.clippingRange[0]*M*x,A=e.clippingRange[0]*M);const k=(e.windowCenter[0]-1)*I,U=(e.windowCenter[0]+1)*I,B=(e.windowCenter[1]-1)*A,z=(e.windowCenter[1]+1)*A,K=b[0],J=b[1];a[0]=2*K/(U-k),a[5]=2*K/(z-B),a[2]=(k+U)/(U-k),a[6]=(B+z)/(z-B),a[10]=-(K+J)/(J-K),a[14]=-1,a[11]=-2*K*J/(J-K),a[15]=0}}return hr(y,a),y},t.getCompositeProjectionMatrix=(x,T,_)=>{const y=t.getViewMatrix(),w=t.getProjectionMatrix(x,T,_);return En(w,y,w),w},t.setDirectionOfProjection=(x,T,_)=>{if(e.directionOfProjection[0]===x&&e.directionOfProjection[1]===T&&e.directionOfProjection[2]===_)return;e.directionOfProjection[0]=x,e.directionOfProjection[1]=T,e.directionOfProjection[2]=_;const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,C()},t.setDeviceAngles=(x,T,_,y)=>{const w=[3];uo(e.physicalViewNorth,e.physicalViewUp,w);const b=kt(new Float64Array(16));Do(b,b,Cr(x),e.physicalViewUp),Do(b,b,Cr(T),w),Do(b,b,Cr(_),e.physicalViewNorth),Do(b,b,Cr(-y),e.physicalViewUp);const M=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),I=new Float64Array(e.physicalViewNorth);vn(M,M,b),vn(I,I,b),t.setDirectionOfProjection(M[0],M[1],M[2]),t.setViewUp(I[0],I[1],I[2]),t.modified()},t.setOrientationWXYZ=(x,T,_,y)=>{const w=kt(new Float64Array(16));if(x!==0&&(T!==0||_!==0||y!==0)){const I=Cr(x),A=rl();Ey(A,[T,_,y],I),r2(w,A)}const b=new Float64Array(3);vn(b,[0,0,-1],w);const M=new Float64Array(3);vn(M,[0,1,0],w),t.setDirectionOfProjection(...b),t.setViewUp(...M),t.modified()},t.computeClippingRange=x=>{let T=null,_=null;T=e.viewPlaneNormal,_=e.position;const y=-T[0],w=-T[1],b=-T[2],M=-(y*_[0]+w*_[1]+b*_[2]),I=[y*x[0]+w*x[2]+b*x[4]+M,1e-18];for(let A=0;A<2;A++)for(let k=0;k<2;k++)for(let U=0;U<2;U++){const B=y*x[U]+w*x[2+k]+b*x[4+A]+M;I[0]=B<I[0]?B:I[0],I[1]=B>I[1]?B:I[1]}return I}}const Hue={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:vc(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function jV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hue,n),de.obj(t,e),de.get(t,e,["distance"]),de.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),de.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),de.setGetArray(t,e,["clippingRange","windowCenter"],2),de.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),jue(t,e)}const $ue=de.newInstance(jV,"vtkCamera");var RT={newInstance:$ue,extend:jV};const Kue=["HeadLight","CameraLight","SceneLight"];function que(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?vn(n,e.position,e.transformMatrix):Dn(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?vn(n,e.focalPoint,e.transformMatrix):Dn(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(ka(e.direction,e.focalPoint,e.position),cc(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const i=new Float64Array(3);ka(i,e.position,r),e.focalPoint=i},t.setDirectionAngle=(r,i)=>{const a=Cr(r),o=Cr(i);t.setPosition(Math.cos(a)*Math.sin(o),Math.sin(a),Math.cos(a)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const Xue={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function HV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xue,n),de.obj(t,e),de.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),de.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),que(t,e)}const Yue=de.newInstance(HV,"vtkLight");var Jue={newInstance:Yue,extend:HV,LIGHT_TYPES:Kue};const{vtkErrorMacro:iv}=de;function Zue(t){return()=>iv(`vtkViewport::${t} - NOT IMPLEMENTED`)}function Que(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const i=e.props.filter(a=>a!==r);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(r);const a=r.getNestedProps();if(a&&a.length)for(let o=0;o<a.length;o++)n(a[o],i);return i}t.getViewPropsWithNestedProps=()=>{const r=[];for(let i=0;i<e.props.length;i++)n(e.props[i],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>iv("call displayToView on your view instead"),t.viewToDisplay=()=>iv("callviewtodisplay on your view instead"),t.getSize=()=>iv("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,i,a)=>{const o=t.normalizedDisplayToNormalizedViewport(r,i,a);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(i-e.viewport[1])/o[1],a]},t.normalizedViewportToProjection=(r,i,a)=>[r*2-1,i*2-1,a*2-1],t.projectionToNormalizedDisplay=(r,i,a)=>{const o=t.projectionToNormalizedViewport(r,i,a);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],i*o[1]+e.viewport[1],a]},t.projectionToNormalizedViewport=(r,i,a)=>[(r+1)*.5,(i+1)*.5,(a+1)*.5],t.PickPropFrom=Zue("PickPropFrom")}const e0e={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function $V(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,e0e,n),de.obj(t,e),de.event(t,e,"event"),de.setGetArray(t,e,["viewport"],4),de.setGetArray(t,e,["background","background2"],3),Que(t,e)}const t0e=de.newInstance($V,"vtkViewport");var n0e={newInstance:t0e,extend:$V};const{vtkDebugMacro:Ch,vtkErrorMacro:Ol,vtkWarningMacro:r0e}=_i;function bO(t){return()=>Ol(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function i0e(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Ch("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const a=t.getActiveCameraAndResetIfCreated();e.lights.forEach(o=>{o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(a.getPositionByReference()),o.setFocalPointFrom(a.getFocalPointByReference()),o.modified(a.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(a.getCameraLightTransformMatrix(vc())):Ol("light has unknown light type",o.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=bO("allocateTime"),t.updateGeometry=bO("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=a=>{Ch(t.getClassName(),t,"setting Layer to ",a),e.layer!==a&&(e.layer=a,t.modified()),t.setPreserveColorBuffer(!!a)},t.setActiveCamera=a=>e.activeCamera===a?!1:(e.activeCamera=a,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:a}),!0),t.makeCamera=()=>{const a=RT.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:a}),a},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(a=>{e.actors=e.actors.concat(a.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=a=>{e.actors=e.actors.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(o=>{t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(a=>{e.volumes=e.volumes.concat(a.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=a=>{e.volumes=e.volumes.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(o=>{t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=a=>e.lights.includes(a),t.addLight=a=>{a&&!t.hasLight(a)&&(e.lights.push(a),t.modified())},t.removeLight=a=>{e.lights=e.lights.filter(o=>o!==a),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=a=>{e.lights=a,t.modified()},t.makeLight=Jue.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(a,o,s,l)=>{let c=t.normalizedDisplayToProjection(a,o,s);return c=t.projectionToView(c[0],c[1],c[2],l),t.viewToWorld(c[0],c[1],c[2])},t.worldToNormalizedDisplay=(a,o,s,l)=>{let c=t.worldToView(a,o,s);return c=t.viewToProjection(c[0],c[1],c[2],l),t.projectionToNormalizedDisplay(c[0],c[1],c[2])},t.viewToWorld=(a,o,s)=>{if(e.activeCamera===null)return Ol("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getViewMatrix();Vr(l,l),yn(l,l);const c=new Float64Array([a,o,s]);return vn(c,c,l),c},t.projectionToView=(a,o,s,l)=>{if(e.activeCamera===null)return Ol("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getProjectionMatrix(l,-1,1);Vr(c,c),yn(c,c);const d=new Float64Array([a,o,s]);return vn(d,d,c),d},t.worldToView=(a,o,s)=>{if(e.activeCamera===null)return Ol("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getViewMatrix();yn(l,l);const c=new Float64Array([a,o,s]);return vn(c,c,l),c},t.viewToProjection=(a,o,s,l)=>{if(e.activeCamera===null)return Ol("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getProjectionMatrix(l,-1,1);yn(c,c);const d=new Float64Array([a,o,s]);return vn(d,d,c),d},t.computeVisiblePropBounds=()=>{e.allBounds[0]=Gn.INIT_BOUNDS[0],e.allBounds[1]=Gn.INIT_BOUNDS[1],e.allBounds[2]=Gn.INIT_BOUNDS[2],e.allBounds[3]=Gn.INIT_BOUNDS[3],e.allBounds[4]=Gn.INIT_BOUNDS[4],e.allBounds[5]=Gn.INIT_BOUNDS[5];let a=!0;t.invokeEvent(n);for(let o=0;o<e.props.length;++o){const s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){const l=s.getBounds();l&&Yh(l)&&(a=!1,l[0]<e.allBounds[0]&&(e.allBounds[0]=l[0]),l[1]>e.allBounds[1]&&(e.allBounds[1]=l[1]),l[2]<e.allBounds[2]&&(e.allBounds[2]=l[2]),l[3]>e.allBounds[3]&&(e.allBounds[3]=l[3]),l[4]<e.allBounds[4]&&(e.allBounds[4]=l[4]),l[5]>e.allBounds[5]&&(e.allBounds[5]=l[5]))}}return a&&(ju(e.allBounds),Ch("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!Yh(o))return Ch("Cannot reset camera!"),!1;let l=null;if(t.getActiveCamera())l=e.activeCamera.getViewPlaneNormal();else return Ol("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;let c=o[1]-o[0],d=o[3]-o[2],f=o[5]-o[4];c*=c,d*=d,f*=f;let h=c+d+f;h=h===0?1:h,h=Math.sqrt(h)*.5;const p=Cr(e.activeCamera.getViewAngle()),C=h,x=h/Math.sin(p*.5),T=e.activeCamera.getViewUp();return Math.abs(on(T,l))>.999&&(r0e("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-T[2],T[0],T[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+x*l[0],s[1]+x*l[1],s[2]+x*l[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(C),e.activeCamera.setPhysicalScale(h),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Yh(o))return Ch("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Ol("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(o);let l=0;if(e.activeCamera.getParallelProjection())l=.2*e.activeCamera.getParallelScale();else{const c=Cr(e.activeCamera.getViewAngle());l=.2*Math.tan(c/2)*s[1]}return s[1]-s[0]<l&&(l=l-s[1]+s[0],s[1]+=l/2,s[0]-=l/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=a=>{a!==e._renderWindow&&(e._vtkWindow=a,e._renderWindow=a)},t.visibleActorCount=()=>e.props.filter(a=>a.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let a=e.mtime;const o=e.activeCamera?e.activeCamera.getMTime():0;o>a&&(a=o);const s=e._createdLight?e._createdLight.getMTime():0;return s>a&&(a=s),a},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const a0e={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:tl(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function KV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,a0e,n),n0e.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),aa(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Ur(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Jf(t,e,["actors","volumes","lights"]),nE(t,e,["background"],4,1),lp(t,e,["renderWindow"]),i0e(t,e)}const o0e=Ln(KV,"vtkRenderer");var qV={newInstance:o0e,extend:KV};const s0e={Unknown:0,LeftController:1,RightController:2},l0e={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},c0e={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var XV={Device:s0e,Input:l0e,Axis:c0e};const{Device:hm,Input:fu}=XV,{vtkWarningMacro:gm,vtkErrorMacro:pm,normalizeWheel:u0e,vtkOnceErrorMacro:f0e}=de,F0={ctrlKey:!1,altKey:!1,shiftKey:!1},T4={"xr-standard":[fu.Trigger,fu.Grip,fu.TrackPad,fu.Thumbstick,fu.A,fu.B]},AT=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function xh(t){t.cancelable&&t.preventDefault()}function mm(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:i}=n;e[r]=i}),e}function d0e(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,i=new Map;let a=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=x=>{pm("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=x=>{e.interactorStyle!==x&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=x,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>gm("empty event loop");function o(x,T){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(x,T))}t.getCurrentRenderer=()=>(e.currentRenderer||o(0,0),e.currentRenderer);function s(x){const T=e._view.getCanvas(),_=T.getBoundingClientRect(),y=T.width/_.width,w=T.height/_.height,b={x:y*(x.clientX-_.left),y:w*(_.height-x.clientY+_.top),z:0};return(i.size<=1||!e.currentRenderer)&&o(b.x,b.y),b}const l=e._getScreenEventPositionFor||s;function c(x){return{controlKey:x.ctrlKey,altKey:x.altKey,shiftKey:x.shiftKey}}function d(x){const T=c(x);return{key:x.key,keyCode:x.charCode,...T}}function f(x){return x.pointerType||""}const h=()=>{if(e.container===null)return;const{container:x}=e;x.addEventListener("contextmenu",xh),x.addEventListener("wheel",t.handleWheel),x.addEventListener("DOMMouseScroll",t.handleWheel),x.addEventListener("pointerenter",t.handlePointerEnter),x.addEventListener("pointerleave",t.handlePointerLeave),x.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),x.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),x.addEventListener("pointerup",t.handlePointerUp),x.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),x.style.touchAction="none",x.style.userSelect="none",x.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=x=>{if(x===null)return;n.setContainer(x)&&h()};const p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,a=1;const{container:x}=e;x&&(x.removeEventListener("contextmenu",xh),x.removeEventListener("wheel",t.handleWheel),x.removeEventListener("DOMMouseScroll",t.handleWheel),x.removeEventListener("pointerenter",t.handlePointerEnter),x.removeEventListener("pointerleave",t.handlePointerLeave),x.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),x.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),x.removeEventListener("pointerup",t.handlePointerUp),x.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{p(),n.setContainer(null)},t.handleKeyPress=x=>{const T=d(x);t.keyPressEvent(T)},t.handleKeyDown=x=>{const T=d(x);t.keyDownEvent(T)},t.handleKeyUp=x=>{const T=d(x);t.keyUpEvent(T)},t.handlePointerEnter=x=>{const T={...c(x),position:l(x),deviceType:f(x)};t.pointerEnterEvent(T),T.deviceType==="mouse"&&t.mouseEnterEvent(T)},t.handlePointerLeave=x=>{const T={...c(x),position:l(x),deviceType:f(x)};t.pointerLeaveEvent(T),T.deviceType==="mouse"&&t.mouseLeaveEvent(T)},t.handlePointerDown=x=>{if(!(x.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&xh(x),x.target.hasPointerCapture(x.pointerId)&&x.target.releasePointerCapture(x.pointerId),e.container.setPointerCapture(x.pointerId),i.has(x.pointerId)&&gm("[RenderWindowInteractor] duplicate pointerId detected"),i.set(x.pointerId,{pointerId:x.pointerId,position:l(x)}),x.pointerType){case"pen":case"touch":t.handleTouchStart(x);break;case"mouse":default:t.handleMouseDown(x);break}},t.handlePointerUp=x=>{if(i.has(x.pointerId))switch(e.preventDefaultOnPointerUp&&xh(x),i.delete(x.pointerId),e.container.releasePointerCapture(x.pointerId),x.pointerType){case"pen":case"touch":t.handleTouchEnd(x);break;case"mouse":default:t.handleMouseUp(x);break}},t.handlePointerCancel=x=>{if(i.has(x.pointerId))switch(i.delete(x.pointerId),x.pointerType){case"pen":case"touch":t.handleTouchEnd(x);break;case"mouse":default:t.handleMouseUp(x);break}},t.handlePointerMove=x=>{if(i.has(x.pointerId)){const T=i.get(x.pointerId);T.position=l(x)}switch(x.pointerType){case"pen":case"touch":t.handleTouchMove(x);break;case"mouse":default:t.handleMouseMove(x);break}},t.handleMouseDown=x=>{const T={...c(x),position:l(x),deviceType:f(x)};switch(x.button){case 0:t.leftButtonPressEvent(T);break;case 1:t.middleButtonPressEvent(T);break;case 2:t.rightButtonPressEvent(T);break;default:pm(`Unknown mouse button pressed: ${x.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var x;return(x=document.exitPointerLock)==null?void 0:x.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function C(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=x=>{if(x===void 0){pm("undefined requester, can not start animating");return}if(r.has(x)){gm("requester is already registered for animating");return}r.add(x),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=x=>{const T=Date.now()+x;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,T),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(x){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(x)){if(!T){const _=x&&x.getClassName?x.getClassName():x;gm(`${_} did not request an animation`)}return}r.delete(x),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(x,T,_)=>{x.inputSources.forEach(y=>{const w=y.gripSpace==null?null:T.getPose(y.gripSpace,_),b=y.gripSpace==null?null:T.getPose(y.targetRaySpace,_),M=y.gamepad,I=y.handedness;if(M){M.index in e.lastGamepadValues||(e.lastGamepadValues[M.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let A=0;A<M.buttons.length;++A)A in e.lastGamepadValues[M.index][I].buttons||(e.lastGamepadValues[M.index][I].buttons[A]=!1),e.lastGamepadValues[M.index][I].buttons[A]!==M.buttons[A].pressed&&w!=null&&(t.button3DEvent({gamepad:M,position:w.transform.position,orientation:w.transform.orientation,targetPosition:b.transform.position,targetOrientation:b.transform.orientation,pressed:M.buttons[A].pressed,device:y.handedness==="left"?hm.LeftController:hm.RightController,input:T4[M.mapping]&&T4[M.mapping][A]?T4[M.mapping][A]:fu.Trigger}),e.lastGamepadValues[M.index][I].buttons[A]=M.buttons[A].pressed),e.lastGamepadValues[M.index][I].buttons[A]&&w!=null&&t.move3DEvent({gamepad:M,position:w.transform.position,orientation:w.transform.orientation,targetPosition:b.transform.position,targetOrientation:b.transform.orientation,device:y.handedness==="left"?hm.LeftController:hm.RightController})}})},t.handleMouseMove=x=>{const T={...c(x),position:l(x),deviceType:f(x)};e.moveTimeoutID===0?t.startMouseMoveEvent(T):(t.mouseMoveEvent(T),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const x=Date.now();e._animationFrameCount++,x-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(x-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=x,e._animationFrameCount=1),t.animationEvent(),C(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=x=>{xh(x);const T={...u0e(x),...c(x),position:l(x),deviceType:f(x)};e.wheelTimeoutID===0&&(Math.abs(T.spinY)>=.3?a=Math.abs(T.spinY):a=1),T.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(T),t.mouseWheelEvent(T)):(t.mouseWheelEvent(T),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=x=>{const T={...c(x),position:l(x),deviceType:f(x)};switch(x.button){case 0:t.leftButtonReleaseEvent(T);break;case 1:t.middleButtonReleaseEvent(T);break;case 2:t.rightButtonReleaseEvent(T);break;default:pm(`Unknown mouse button released: ${x.button}`);break}},t.handleTouchStart=x=>{const T=[...i.values()];if(e.recognizeGestures&&T.length>1){const _=mm(i);if(T.length===2){const y={...c(F0),position:T[0].position,deviceType:f(x)};t.leftButtonReleaseEvent(y)}t.recognizeGesture("TouchStart",_)}else if(T.length===1){const _={...c(F0),position:l(x),deviceType:f(x)};t.leftButtonPressEvent(_)}},t.handleTouchMove=x=>{const T=[...i.values()];if(e.recognizeGestures&&T.length>1){const _=mm(i);t.recognizeGesture("TouchMove",_)}else if(T.length===1){const _={...c(F0),position:T[0].position,deviceType:f(x)};t.mouseMoveEvent(_)}},t.handleTouchEnd=x=>{const T=[...i.values()];if(e.recognizeGestures)if(T.length===0){const _={...c(F0),position:l(x),deviceType:f(x)};t.leftButtonReleaseEvent(_)}else if(T.length===1){const _=mm(i);t.recognizeGesture("TouchEnd",_);const y={...c(F0),position:T[0].position,deviceType:f(x)};t.leftButtonPressEvent(y)}else{const _=mm(i);t.recognizeGesture("TouchMove",_)}else if(T.length===1){const _={...c(F0),position:T[0].position,deviceType:f(x)};t.leftButtonReleaseEvent(_)}},t.setView=x=>{e._view!==x&&(e._view=x,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var x,T,_;return(_=(T=(x=e._view)==null?void 0:x.getRenderable())==null?void 0:T.getRenderersByReference())==null?void 0:_[0]},t.findPokedRenderer=function(){var I,A;let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const _=(A=(I=e._view)==null?void 0:I.getRenderable())==null?void 0:A.getRenderers();if(!_||_.length===0)return null;_.sort((k,U)=>k.getLayer()-U.getLayer());let y=null,w=null,b=null,M=_.length;for(;M--;){const k=_[M];if(e._view.isInViewport(x,T,k)&&k.getInteractive()){b=k;break}y===null&&k.getInteractive()&&(y=k),w===null&&e._view.isInViewport(x,T,k)&&(w=k)}return b===null&&(b=y),b===null&&(b=w),b==null&&(b=_[0]),b},t.render=()=>{!t.isAnimating()&&!e.inRender&&C()},AT.forEach(x=>{const T=x.charAt(0).toLowerCase()+x.slice(1);t[`${T}Event`]=_=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){f0e(`
          Can not forward events without a current renderer on the interactor.
        `);return}const w={type:x,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),..._};t[`invoke${x}`](w)}}),t.recognizeGesture=(x,T)=>{if(Object.keys(T).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),x==="TouchStart"){Object.keys(T).forEach(B=>{e.startingEventPositions[B]=T[B]}),e.currentGesture="Start";return}if(x==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let _=0;const y=[],w=[];Object.keys(T).forEach(B=>{y[_]=T[B],w[_]=e.startingEventPositions[B],_++});const b=Math.sqrt((w[0].x-w[1].x)*(w[0].x-w[1].x)+(w[0].y-w[1].y)*(w[0].y-w[1].y)),M=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y));let I=Ng(Math.atan2(w[1].y-w[0].y,w[1].x-w[0].x)),A=Ng(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),k=A-I;A=A+180>=360?A-180:A+180,I=I+180>=360?I-180:I+180,Math.abs(A-I)<Math.abs(k)&&(k=A-I);const U=[];if(U[0]=(y[0].x-w[0].x+y[1].x-w[1].x)/2,U[1]=(y[0].y-w[0].y+y[1].y-w[1].y)/2,x==="TouchMove")if(e.currentGesture==="Start"){let B=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);B<15&&(B=15);const z=Math.abs(M-b),K=M*3.1415926*Math.abs(k)/360,J=Math.sqrt(U[0]*U[0]+U[1]*U[1]);if(z>B&&z>K&&z>J){e.currentGesture="Pinch";const X={scale:1,touches:T};t.startPinchEvent(X)}else if(K>B&&K>J){e.currentGesture="Rotate";const X={rotation:0,touches:T};t.startRotateEvent(X)}else if(J>B){e.currentGesture="Pan";const X={translation:[0,0],touches:T};t.startPanEvent(X)}}else{if(e.currentGesture==="Rotate"){const B={rotation:k,touches:T};t.rotateEvent(B)}if(e.currentGesture==="Pinch"){const B={scale:M/b,touches:T};t.pinchEvent(B)}if(e.currentGesture==="Pan"){const B={translation:U,touches:T};t.panEvent(B)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=x=>{e._forcedRenderer=!!x,e.currentRenderer=x},t.setContainer=x=>{p();const T=n.setContainer(x??null);return T&&h(),T},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const h0e={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function YV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h0e,n),de.obj(t,e),e._animationExtendedEnd=0,de.event(t,e,"RenderEvent"),AT.forEach(r=>de.event(t,e,r)),de.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),de.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),de.moveToProtected(t,e,["view"]),d0e(t,e)}const g0e=de.newInstance(YV,"vtkRenderWindowInteractor");var p0e={newInstance:g0e,extend:YV,handledEvents:AT,...XV};const{vtkErrorMacro:m0e}=de,v0e=[1,-1,1,-1,1,-1];function y0e(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=de.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.setTuple(n,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,i)=>t.insertNextTuple([n,r,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const o=t.getRange(2);return e.bounds[4]=o[0],e.bounds[5]=o[1],e.bounds}if(t.getNumberOfComponents()!==2)return m0e(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),v0e;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const w0e={empty:!0,numberOfComponents:3,dataType:un.FLOAT,bounds:[1,-1,1,-1,1,-1]};function LT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,w0e,n),Bt.extend(t,e,n),y0e(t,e)}const JV=de.newInstance(LT,"vtkPoints");var kf={newInstance:JV,extend:LT};const C0e=Object.freeze(Object.defineProperty({__proto__:null,default:kf,extend:LT,newInstance:JV},Symbol.toStringTag,{value:"Module"}));function ZV(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function QV(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const eU={extractCellSizes:ZV,getNumberOfCells:QV};function x0e(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=QV(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=ZV(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{const i=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),i}}function S0e(t){return{empty:!0,numberOfComponents:1,dataType:un.UNSIGNED_INT,...t}}function kT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Bt.extend(t,e,S0e(n)),x0e(t,e)}const tU=de.newInstance(kT,"vtkCellArray");var Pf={newInstance:tU,extend:kT,...eU};const E0e=Object.freeze(Object.defineProperty({__proto__:null,STATIC:eU,default:Pf,extend:kT,newInstance:tU},Symbol.toStringTag,{value:"Module"}));function T0e(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=de.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((o,s)=>{let l=3*o,c=3*s;i[c]=a[l],i[++c]=a[++l],i[++c]=a[++l]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let i=1;i<n;i++)e.points.getPoint(i,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else ju(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let i=0;i<3;i++)r=e.bounds[2*i+1]-e.bounds[2*i],n+=r*r;return n},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,o,s,l)=>{},t.evaluatePosition=(n,r,i,a,o,s)=>{de.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const _0e={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function nU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_0e,n),de.obj(t,e),e.points||(e.points=kf.newInstance()),de.get(t,e,["points","pointsIds"]),T0e(t,e)}const D0e=de.newInstance(nU,"vtkCell");var h2={newInstance:D0e,extend:nU};function b0e(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function I0e(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(l=>{t.incrementLinkCount(l)})}t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(l=>{t.insertCellReference(l,a[l]++,o)})}}else{for(let o=0;o<i;o++)h2.newInstance().getPointsIds().forEach(l=>{t.incrementLinkCount(l)});t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o)h2.newInstance().getPointsIds().forEach(l=>{t.insertCellReference(l,a[l]++,o)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{b0e(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const O0e={array:null,maxId:0,extend:0};function rU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,O0e,n),de.obj(t,e),I0e(t,e)}const M0e=de.newInstance(rU,"vtkCellLinks");var N0e={newInstance:M0e,extend:rU};const sr={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},bx=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function R0e(t){return t<bx.length?bx[t]:"UnknownClass"}function A0e(t){return bx.findIndex(t)}function L0e(t){return t<sr.VTK_QUADRATIC_EDGE||t===sr.VTK_CONVEX_POINT_SET||t===sr.VTK_POLYHEDRON}function k0e(t){return t===sr.VTK_TRIANGLE_STRIP||t===sr.VTK_POLY_LINE||t===sr.VTK_POLY_VERTEX}const P0e={getClassNameFromTypeId:R0e,getTypeIdFromClassName:A0e,isLinear:L0e,hasSubCells:k0e};function F0e(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=sr.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const V0e={size:0,maxId:-1,extend:1e3};function iU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V0e,n),de.obj(t,e),de.get(t,e,["size","maxId","extend"]),de.getArray(t,e,["typeArray","locationArray"]),F0e(t,e)}const U0e=de.newInstance(iU,"vtkCellTypes");var B0e={newInstance:U0e,extend:iU,...P0e};const G0e={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var aU={IntersectionState:G0e};const{IntersectionState:av}=aU;function lf(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let o;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const s=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),l=on(a,a);let c=1e-5*s;return l!==0&&(i.t=s/l),c<0&&(c=-c),-c<l&&l<c||l<=0||i.t<0?o=e:i.t>1?o=n:(o=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),i.distance=Ro(o,t),i}function oU(t,e,n,r,i,a){const o=[],s=[],l=[];i[0]=0,a[0]=0,ds(e,t,o),ds(r,n,s),ds(n,t,l);const c=[on(o,o),-on(o,s),-on(o,s),on(s,s)],d=[];if(d[0]=on(o,l),d[1]=-on(s,l),IE(c,d,2)===0){let f=Number.MAX_VALUE;const h=[t,e,n,r],p=[n,n,t,t],C=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let x;for(let T=0;T<4;T++)x=lf(h[T],p[T],C[T]),x.distance<f&&(f=x.distance);return av.ON_LINE}return i[0]=d[0],a[0]=d[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?av.YES_INTERSECTION:av.NO_INTERSECTION}const z0e={distanceToLine:lf,intersection:oU};function W0e(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s)=>{const l={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const c=[],d=[],f=[];e.points.getPoint(0,d),e.points.getPoint(1,f);const h=[],p=[],C=oU(r,i,d,f,h,p);if(l.t=h[0],l.betweenPoints=n(l.t),s[0]=p[0],C===av.YES_INTERSECTION){for(let x=0;x<3;x++)o[x]=d[x]+s[0]*(f[x]-d[x]),c[x]=r[x]+l.t*(i[x]-r[x]);if(Ro(o,c)<=a*a)return l.intersect=1,l}else{let x;if(l.t<0)return x=lf(r,d,f,o),x.distance<=a*a&&(l.t=0,l.intersect=1,l.betweenPoints=!0),l;if(l.t>1)return x=lf(i,d,f,o),x.distance<=a*a&&(l.t=1,l.intersect=1,l.betweenPoints=!0),l;if(s[0]<0)return s[0]=0,x=lf(d,r,i,o),l.t=x.t,x.distance<=a*a&&(l.intersect=1),l;if(s[0]>1)return s[0]=1,x=lf(f,r,i,o),l.t=x.t,x.distance<=a*a&&(l.intersect=1),l}return l},t.evaluateLocation=(r,i,a)=>{const o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(let l=0;l<3;l++)i[l]=o[l]+r[0]*(s[l]-o[l]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(ng(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const j0e={orientations:null};function sU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j0e,n),h2.extend(t,e,n),de.setGet(t,e,["orientations"]),W0e(t,e)}const H0e=de.newInstance(sU,"vtkLine");var Ja={newInstance:H0e,extend:sU,...z0e,...aU};function $0e(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Po(e.points):e.points=kf.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),e.points=kf.newInstance(),e.points.shallowCopy(r.getPoints())}}const K0e={};function lU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K0e,n),ed.extend(t,e,n),de.setGet(t,e,["points"]),$0e(t,e)}const q0e=de.newInstance(lU,"vtkPointSet");var X0e={newInstance:q0e,extend:lU};function PT(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2];r[0]=a*c-o*l,r[1]=o*s-i*c,r[2]=i*l-a*s}function g2(t,e,n,r){PT(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function Y0e(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const l=[],c=[],d=[],f=[],h=[];g2(t,e,n,f),g2(r,i,a,h);const p=-on(f,t),C=-on(h,r),x=[on(h,t)+C,on(h,e)+C,on(h,n)+C];if(x[0]*x[1]>o&&x[0]*x[2]>o)return{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d};const T=[on(f,r)+p,on(f,i)+p,on(f,a)+p];if(T[0]*T[1]>o&&T[0]*T[2]>o)return{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d};if(Math.abs(f[0]-h[0])<1e-9&&Math.abs(f[1]-h[1])<1e-9&&Math.abs(f[2]-h[2])<1e-9&&Math.abs(p-C)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d};const _=[t,e,n],y=[r,i,a],w=on(f,h),b=(p-C*w)/(w*w-1),M=(C-p*w)/(w*w-1),I=[b*f[0]+M*h[0],b*f[1]+M*h[1],b*f[2]+M*h[2]],A=uo(f,h,[]);cc(A);let k=0,U=0;const B=[],z=[];let K=50,J=50;for(let fe=0;fe<3;fe++){const pe=fe,ie=(fe+1)%3,te=Fi.intersectWithLine(_[pe],_[ie],r,h);te.intersection&&te.t>0-o&&te.t<1+o&&(te.t<1+o&&te.t>1-o&&(K=k),B[k++]=on(te.x,A)-on(I,A));const ee=Fi.intersectWithLine(y[pe],y[ie],t,f);ee.intersection&&ee.t>0-o&&ee.t<1+o&&(ee.t<1+o&&ee.t>1-o&&(J=U),z[U++]=on(ee.x,A)-on(I,A))}if(k>2){k--;const fe=B[2];B[2]=B[K],B[K]=fe}if(U>2){U--;const fe=z[2];z[2]=z[J],z[J]=fe}if(k!==2||U!==2)return{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d};if(Number.isNaN(B[0])||Number.isNaN(B[1])||Number.isNaN(z[0])||Number.isNaN(z[1]))return{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d};if(B[0]>B[1]){const fe=B[1];B[1]=B[0],B[0]=fe}if(z[0]>z[1]){const fe=z[1];z[1]=z[0],z[0]=fe}let X,re;return B[1]<z[0]||z[1]<B[0]?{intersect:!1,coplanar:s,pt1:l,pt2:c,surfaceId:d}:(B[0]<z[0]?B[1]<z[1]?(d[0]=2,d[1]=1,X=z[0],re=B[1]):(d[0]=2,d[1]=2,X=z[0],re=z[1]):B[1]<z[1]?(d[0]=1,d[1]=1,X=B[0],re=B[1]):(d[0]=1,d[1]=2,X=B[0],re=z[1]),jv(I,A,X,l),jv(I,A,re,c),{intersect:!0,coplanar:s,pt1:l,pt2:c,surfaceId:d})}const J0e={computeNormalDirection:PT,computeNormal:g2,intersectWithTriangle:Y0e};function Z0e(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,o)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;const l=[],c=i*i,d=[],f=[],h=[];e.points.getPoint(0,d),e.points.getPoint(1,f),e.points.getPoint(2,h);const p=[],C=[];if(g2(d,f,h,p),p[0]!==0||p[1]!==0||p[2]!==0){const w=Fi.intersectWithLine(n,r,d,p);if(s.betweenPoints=w.betweenPoints,s.t=w.t,a[0]=w.x[0],a[1]=w.x[1],a[2]=w.x[2],!w.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;const b=t.evaluatePosition(a,l,o,C);if(b.evaluation>=0)return b.dist2<=c?(s.intersect=1,s):(s.intersect=b.evaluation,s)}const x=Ro(d,f),T=Ro(f,h),_=Ro(h,d);e.line||(e.line=Ja.newInstance()),x>T&&x>_?(e.line.getPoints().setPoint(0,d),e.line.getPoints().setPoint(1,f)):T>_&&T>x?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,h)):(e.line.getPoints().setPoint(0,h),e.line.getPoints().setPoint(1,d));const y=e.line.intersectWithLine(n,r,i,a,o);if(s.betweenPoints=y.betweenPoints,s.t=y.t,y.intersect){const w=[],b=[],M=[];for(let I=0;I<3;I++)w[I]=d[I]-h[I],b[I]=f[I]-h[I],M[I]=a[I]-h[I];return o[0]=on(M,w)/_,o[1]=on(M,b)/T,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=(n,r,i,a)=>{const o={subId:0,dist2:0,evaluation:-1};let s,l;const c=[],d=[],f=[],h=[];let p;const C=[],x=[],T=[];let _=0,y=0;const w=[];let b,M,I,A=[];const k=[],U=[],B=[];o.subId=0,i[2]=0,e.points.getPoint(1,c),e.points.getPoint(2,d),e.points.getPoint(0,f),PT(c,d,f,h),Fi.generalizedProjectPoint(n,c,h,B);let z=0;for(s=0;s<3;s++)h[s]<0?p=-h[s]:p=h[s],p>z&&(z=p,y=s);for(l=0,s=0;s<3;s++)s!==y&&(w[l++]=s);for(s=0;s<2;s++)C[s]=B[w[s]]-f[w[s]],x[s]=c[w[s]]-f[w[s]],T[s]=d[w[s]]-f[w[s]];if(_=Sr(x,T),_===0)return i[0]=0,i[1]=0,o.evaluation=-1,o;if(i[0]=Sr(C,T)/_,i[1]=Sr(x,C)/_,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(o.dist2=Ro(B,n),r[0]=B[0],r[1]=B[1],r[2]=B[2]),o.evaluation=1;else{let K;if(r){if(a[1]<0&&a[2]<0)for(b=Ro(n,f),M=Ja.distanceToLine(n,c,f,K,k),I=Ja.distanceToLine(n,f,d,K,U),b<M?(o.dist2=b,A=f):(o.dist2=M,A=k),I<o.dist2&&(o.dist2=I,A=U),s=0;s<3;s++)r[s]=A[s];else if(a[2]<0&&a[0]<0)for(b=Ro(n,c),M=Ja.distanceToLine(n,c,f,K,k),I=Ja.distanceToLine(n,c,d,K,U),b<M?(o.dist2=b,A=c):(o.dist2=M,A=k),I<o.dist2&&(o.dist2=I,A=U),s=0;s<3;s++)r[s]=A[s];else if(a[1]<0&&a[0]<0)for(b=Ro(n,d),M=Ja.distanceToLine(n,d,f,K,k),I=Ja.distanceToLine(n,c,d,K,U),b<M?(o.dist2=b,A=d):(o.dist2=M,A=k),I<o.dist2&&(o.dist2=I,A=U),s=0;s<3;s++)r[s]=A[s];else if(a[0]<0){const J=Ja.distanceToLine(n,c,d,r);o.dist2=J.distance}else if(a[1]<0){const J=Ja.distanceToLine(n,d,f,r);o.dist2=J.distance}else if(a[2]<0){const J=Ja.distanceToLine(n,c,f,r);o.dist2=J.distance}}o.evaluation=0}return o},t.evaluateLocation=(n,r,i)=>{const a=[],o=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,o),e.points.getPoint(2,s);const l=1-n[0]-n[1];for(let c=0;c<3;c++)r[c]=a[c]*l+o[c]*n[0]+s[c]*n[1];i[0]=l,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let o=0;o<3;o++)a[o]<0?r=-a[o]:a[o]>1?r=a[o]-1:r=0,r>i&&(i=r);return i}}const Q0e={};function cU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Q0e,n),h2.extend(t,e,n),Z0e(t,e)}const efe=de.newInstance(cU,"vtkTriangle");var tfe={newInstance:efe,extend:cU,...J0e};const _4=["verts","lines","polys","strips"],{vtkWarningMacro:IO}=de,uU={[sr.VTK_LINE]:Ja,[sr.VTK_POLY_LINE]:Ja,[sr.VTK_TRIANGLE]:tfe};function nfe(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}_4.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=Po(e[i]):e[i]=Pf.newInstance()}),t.getNumberOfCells=()=>_4.reduce((i,a)=>i+e[a].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,a),_4.forEach(o=>{e[o]=Pf.newInstance(),e[o].shallowCopy(i.getReferenceByName(o))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),a=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),l=i+a+o+s,c=new Uint8Array(l);let d=c;const f=new Uint32Array(l);let h=f;if(i){let p=0;e.verts.getCellSizes().forEach((C,x)=>{h[x]=p,d[x]=C>1?sr.VTK_POLY_VERTEX:sr.VTK_VERTEX,p+=C+1}),h=h.subarray(i),d=d.subarray(i)}if(a){let p=0;e.lines.getCellSizes().forEach((C,x)=>{h[x]=p,d[x]=C>2?sr.VTK_POLY_LINE:sr.VTK_LINE,C===1&&IO("Building VTK_LINE ",x," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=C+1}),h=h.subarray(a),d=d.subarray(a)}if(o){let p=0;e.polys.getCellSizes().forEach((C,x)=>{switch(h[x]=p,C){case 3:d[x]=sr.VTK_TRIANGLE;break;case 4:d[x]=sr.VTK_QUAD;break;default:d[x]=sr.VTK_POLYGON;break}C<3&&IO("Building VTK_TRIANGLE ",x," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),p+=C+1}),h+=h.subarray(o),d+=d.subarray(o)}if(s){let p=0;d.fill(sr.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach((C,x)=>{h[x]=p,p+=C+1})}e.cells=B0e.newInstance(),e.cells.setCellTypes(l,c,f)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=N0e.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const a=t.getCellType(i);let o=null;switch(a){case sr.VTK_VERTEX:case sr.VTK_POLY_VERTEX:o=e.verts;break;case sr.VTK_LINE:case sr.VTK_POLY_LINE:o=e.lines;break;case sr.VTK_TRIANGLE:case sr.VTK_QUAD:case sr.VTK_POLYGON:o=e.polys;break;case sr.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}const s=e.cells.getCellLocation(i),l=o.getCell(s);return{cellType:a,cellPointIds:l}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,a,o)=>{const s=e.links.getLink(a),l=e.links.getLink(o);return s.cells.filter(c=>c!==i&&l.cells.indexOf(c)!==-1)},t.getCell=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=t.getCellPoints(i),s=a||uU[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}const rfe={};function FT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rfe,n),X0e.extend(t,e,n),de.get(t,e,["cells","links"]),de.setGet(t,e,["verts","lines","polys","strips"]),nfe(t,e)}const fU=de.newInstance(FT,"vtkPolyData");var gi={newInstance:fU,extend:FT};const ife=Object.freeze(Object.defineProperty({__proto__:null,CELL_FACTORY:uU,default:gi,extend:FT,newInstance:fU},Symbol.toStringTag,{value:"Module"})),afe=1e-6;function ofe(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=rl();n2(r,e.rotation);const i=new Float64Array(3),a=mP(i,r);return[Ng(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return n2(r,e.rotation)},t.rotateX=r=>{r!==0&&(qE(e.rotation,e.rotation,Cr(r)),t.modified())},t.rotateY=r=>{r!==0&&(XE(e.rotation,e.rotation,Cr(r)),t.modified())},t.rotateZ=r=>{r!==0&&(YE(e.rotation,e.rotation,Cr(r)),t.modified())},t.rotateWXYZ=(r,i,a,o)=>{if(r===0||i===0&&a===0&&o===0)return;const s=Cr(r),l=rl();Ey(l,[i,a,o],s);const c=new Float64Array(16);r2(c,l),En(e.rotation,e.rotation,c),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-afe)return;const i=r2(new Float64Array(16),r);En(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],kt(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setUserMatrix=r=>Zf(e.userMatrix,r)?!1:(hr(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){kt(e.matrix),e.userMatrix&&En(e.matrix,e.matrix,e.userMatrix),xr(e.matrix,e.matrix,e.origin),xr(e.matrix,e.matrix,e.position),En(e.matrix,e.matrix,e.rotation),nl(e.matrix,e.matrix,e.scale),xr(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),yn(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>Gn.getCenter(e.bounds),t.getLength=()=>Gn.getLength(e.bounds),t.getXRange=()=>Gn.getXRange(e.bounds),t.getYRange=()=>Gn.getYRange(e.bounds),t.getZRange=()=>Gn.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const sfe={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function dU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sfe,n),dp.extend(t,e,n),e.matrixMTime={},de.obj(e.matrixMTime),de.get(t,e,["bounds","isIdentity"]),de.getArray(t,e,["orientation"]),de.setGetArray(t,e,["origin","position","scale"],3),e.matrix=kt(new Float64Array(16)),e.rotation=kt(new Float64Array(16)),e.userMatrix=kt(new Float64Array(16)),e.transform=null,ofe(t,e)}const lfe=de.newInstance(dU,"vtkProp3D");var VT={newInstance:lfe,extend:dU};const{vtkDebugMacro:cfe}=de;function ufe(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=td.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){cfe("Recomputing bounds..."),e.mapperBounds=r.concat();const i=[];Gn.getCorners(r,i),t.computeMatrix();const a=new Float64Array(16);yn(a,e.matrix),i.forEach(o=>vn(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((l,c)=>l>c[s/2]?c[s/2]:l,o):i.reduce((l,c)=>l<c[(s-1)/2]?c[(s-1)/2]:l,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const i=e.property.getMTime();r=i>r?i:r}if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();r=i>r?i:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),r=i>r?i:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,i)}}const ffe={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function UT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ffe,n),VT.extend(t,e,n),e.boundsMTime={},de.obj(e.boundsMTime),de.set(t,e,["property"]),de.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),ufe(t,e)}const hU=de.newInstance(UT,"vtkActor");var ol={newInstance:hU,extend:UT};const dfe=Object.freeze(Object.defineProperty({__proto__:null,default:ol,extend:UT,newInstance:hU},Symbol.toStringTag,{value:"Module"}));function hfe(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=Yoe.newInstance(),e.rendererMap={},e.openGLRenderWindow=Wue.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=p0e.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:i,background:a})=>{const o=qV.newInstance({viewport:r,background:a||e.background});e.renderWindow.addRenderer(o),e.rendererMap[i]=o},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const i=t.getRenderer(r);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(a=>({id:a,renderer:r[a]}))},t.resize=()=>{if(e.container){const{width:r,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(i)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=de.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const gfe={background:[0,0,0],container:null};function gU(t,e,n={}){Object.assign(e,gfe,n),de.obj(t,e),de.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),de.event(t,e,"resize"),hfe(t,e)}const pfe=de.newInstance(gU),mfe={newInstance:pfe,extend:gU},{vtkErrorMacro:vm}=de;function vfe(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(vm("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return vm("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return vm("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return vm("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const o={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(o),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=i?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,l=0;const c=e.nodes.length;let d=0;c!==0&&(d=e.nodes[c-1].y);let f=0,h=0,p=0,C=0,x=0,T=0,_=0;for(s=0;s<i;s++){const y=o*s;for(i>1?f=n+s/(i-1)*(r-n):f=.5*(n+r);l<c&&f>e.nodes[l].x;)l++,l<c&&(h=e.nodes[l-1].x,p=e.nodes[l].x,C=e.nodes[l-1].y,x=e.nodes[l].y,T=e.nodes[l-1].midpoint,_=e.nodes[l-1].sharpness,T<1e-5&&(T=1e-5),T>.99999&&(T=.99999));if(l>=c)a[y]=e.clamping?d:0;else if(l===0)a[y]=e.clamping?e.nodes[0].y:0;else{let w=(f-h)/(p-h);if(w<T?w=.5*w/T:w=.5+.5*(w-T)/(1-T),_>.99)if(w<.5){a[y]=C;continue}else{a[y]=x;continue}if(_<.01){a[y]=(1-w)*C+w*x;continue}w<.5?w=.5*(w*2)**(1+10*_):w>.5&&(w=1-.5*((1-w)*2)**(1+10*_));const b=w*w,M=b*w,I=2*M-3*b+1,A=-2*M+3*b,k=M-2*b+w,U=M-b,B=x-C,z=(1-_)*B;a[y]=I*C+A*x+k*z+U*z;const K=C<x?C:x,J=C>x?C:x;a[y]=a[y]<K?K:a[y],a[y]=a[y]>J?J:a[y]}}}}const yfe={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function BT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yfe,n),de.obj(t,e),e.nodes=[],de.setGet(t,e,["allowDuplicateScalars","clamping"]),de.setArray(t,e,["range"],2),de.getArray(t,e,["range"]),vfe(t,e)}const pU=de.newInstance(BT,"vtkPiecewiseFunction");var Ff={newInstance:pU,extend:BT};const wfe=Object.freeze(Object.defineProperty({__proto__:null,default:Ff,extend:BT,newInstance:pU},Symbol.toStringTag,{value:"Module"})),{BlendMode:Ml,FilterMode:Lh}=OZ;function Cfe(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=Ff.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const xfe={createRadonTransferFunction:Cfe};function Sfe(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=tl(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(Ml.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(Ml.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(Ml.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(Ml.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(Ml.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(Ml.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>de.enumToString(Ml,e.blendMode),t.setAverageIPScalarRange=(r,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,i)},t.getFilterModeAsString=()=>de.enumToString(Lh,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(Lh.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(Lh.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(Lh.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(ro(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(ro(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(ro(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(gy(ro(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const Efe={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:Ml.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:Lh.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function mU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Efe,n),bT.extend(t,e,n),de.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),de.setGetArray(t,e,["ipScalarRange"],2),de.event(t,e,"lightingActivated"),Sfe(t,e)}const Tfe=de.newInstance(mU,"vtkVolumeMapper");var _fe={newInstance:Tfe,extend:mU,...xfe};function Dfe(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const bfe={scalarTexture:null};function vU(t,e,n={}){Object.assign(e,bfe,n),_fe.extend(t,e,n),de.setGet(t,e,["scalarTexture"]),Dfe(t,e)}const Ife=de.newInstance(vU,"vtkSharedVolumeMapper"),Ofe={newInstance:Ife,extend:vU};function Mfe(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture");const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(r,i,a,o,s,l,c)=>{e.inputDataType=s,e.inputNumComps=o,n(r,i,a,o,s,l,c)},t.update3DFromRaw=r=>{const{updatedFrames:i}=e;if(!i.length)return;e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let a,o;if(r instanceof Uint8Array)a=1,o=Uint8Array;else if(r instanceof Int16Array)a=2,o=Int16Array;else if(r instanceof Uint16Array)a=2,o=Uint16Array;else if(r instanceof Float32Array)a=4,o=Float32Array;else throw new Error("No support for given TypedArray.");for(let s=0;s<i.length;s++)i[s]&&e.fillSubImage3D(r,s,a,o);return e.updatedFrames=[],e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0},e.fillSubImage3D=(r,i,a,o)=>{const s=r.buffer,c=e.width*e.height*e.components*a,d=i*c,f=e.width*e.components,h=e.context,p=h.getParameter(h.MAX_TEXTURE_SIZE);let C=Math.floor(a*p/e.width);C=Math.min(C,e.height);const{useNorm16Texture:x,preferSizeOverAccuracy:T}=vs().rendering;x&&!T&&(C=1);const _=f*C,y=_*a,w=Math.floor(e.height/C),b=e.height%C,M=f*b;for(let I=0;I<w;I++){const A=I*C;let k=new o(s,d+I*y,_);if(e.useHalfFloat&&(o===Uint16Array||o===Int16Array)){for(let U=0;U<k.length;U++)k[U]=Vl.toHalf(k[U]);o===Int16Array&&(k=new Uint16Array(k))}h.texSubImage3D(e.target,0,0,A,i,e.width,C,1,e.format,e.openGLDataType,k)}if(b!==0){const I=w*C,A=new o(s,d+w*y,M);h.texSubImage3D(e.target,0,0,I,i,e.width,b,1,e.format,e.openGLDataType,A)}},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numComps:e.inputNumComps,dataType:e.inputDataType}),t.setUpdatedFrame=r=>{e.updatedFrames[r]=!0}}const Nfe={updatedFrames:[]};function yU(t,e,n={}){Object.assign(e,Nfe,n),Dr.extend(t,e,n),Mfe(t,e)}const Rfe=de.newInstance(yU,"vtkStreamingOpenGLTexture"),Afe={newInstance:Rfe,extend:yU},Lfe=Object.freeze(Object.defineProperty({__proto__:null,LUFactor3x3:_L,LUSolve3x3:DL,Pi:eL,add:Rg,angleBetweenVectors:xL,areBoundsInitialized:Yh,areEquals:xE,areMatricesEqual:Zf,arrayMax:aL,arrayMin:iL,arrayRange:oL,beginCombination:uL,binomial:cL,boundsIsWithinOtherBounds:WL,ceil:tL,ceilLog2:sL,clampAndNormalizeValue:UL,clampValue:ro,clampVector:Xv,columnsToMat3:Vee,columnsToMat4:Pee,computeBoundsFromPoints:VL,createArray:rr,createUninitializedBounds:tl,cross:uo,default:to,degreesFromRadians:Ng,determinant2x2:Sr,determinant3x3:up,diagonalize3x3:bE,distance2BetweenPoints:Ro,dot:on,dot2D:Hv,estimateMatrixCondition:LL,extentIsWithinOtherExtent:zL,factorial:lL,float2CssRGBA:JL,floatRGB2HexCode:YL,floatToHex2:PE,floor:gy,gaussian:pL,gaussianAmplitude:SL,gaussianWeight:EL,getAdjustedScalarRange:GL,getMajorAxisIndex:XL,getScalarTypeFittingRange:BL,getSeed:hL,getSparseOrthogonalMatrix:kE,hex2float:FL,hsv2rgb:Fl,identity:EE,identity3x3:SE,inf:$L,invert3x3:OL,invertMatrix:OE,isFinite:qL,isIdentity:ML,isIdentity3x3:NL,isInf:LE,isNaN:Yv,isNan:Lg,isPowerOfTwo:af,jacobi:kL,jacobiN:Qf,lab2rgb:Ag,lab2xyz:ME,linearSolve3x3:bL,luFactorLinearSystem:py,luSolveLinearSystem:my,matrix3x3ToQuaternion:_E,max:rL,min:nL,multiply3x3_mat3:$v,multiply3x3_vect3:qh,multiplyAccumulate:jv,multiplyAccumulate2D:mL,multiplyMatrix:IL,multiplyQuaternion:RL,multiplyScalar:vE,multiplyScalar2D:yE,nearestPowerOfTwo:Na,negInf:KL,nextCombination:fL,norm:cs,norm2D:wE,normalize:cc,normalize2D:CE,orthogonalize3x3:DE,outer:vL,outer2D:TL,perpendiculars:yL,pointIsWithinBounds:jL,projectVector:wL,projectVector2D:CL,quaternionToMatrix3x3:TE,radiansFromDegrees:Cr,random:gL,randomSeed:dL,rgb2hsv:of,rgb2lab:$l,rgb2xyz:AE,round:rf,roundNumber:Xh,roundVector:Kv,rowsToMat3:Fee,rowsToMat4:kee,signedAngleBetweenVectors:Lee,singularValueDecomposition3x3:AL,solve3PointCircle:HL,solveHomogeneousLeastSquares:qv,solveLeastSquares:PL,solveLinearSystem:IE,subtract:ds,transpose3x3:Ou,uninitializeBounds:ju,xyz2lab:NE,xyz2rgb:RE},Symbol.toStringTag,{value:"Module"})),kfe={isPerformingCoordinateTransformation:!1};function wU(t,e,n={}){Object.assign(e,kfe,n),RT.extend(t,e,n),de.setGet(t,e,["isPerformingCoordinateTransformation"]),Ffe(t,e)}const Pfe=de.newInstance(wU,"vtkSlabCamera");function Ffe(t,e){e.classHierarchy.push("vtkSlabCamera");const n=kt(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,o)=>{const s=vc();if(e.projectionMatrix){const h=1/e.physicalScale;return Dn(r,h,h,h),hr(s,e.projectionMatrix),nl(s,s,r),yn(s,s),s}kt(n);let l=e.clippingRange[0],c=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(l=e.distance,c=e.distance+.1);const d=c-l,f=[l+(a+1)*d/2,l+(o+1)*d/2];if(e.parallelProjection){const h=e.parallelScale*i,p=e.parallelScale,C=(e.windowCenter[0]-1)*h,x=(e.windowCenter[0]+1)*h,T=(e.windowCenter[1]-1)*p,_=(e.windowCenter[1]+1)*p;QE(n,C,x,T,_,f[0],f[1]),yn(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const h=Math.tan(to.radiansFromDegrees(e.viewAngle)/2);let p,C;e.useHorizontalViewAngle===!0?(p=l*h,C=l*h/i):(p=l*h*i,C=l*h);const x=(e.windowCenter[0]-1)*p,T=(e.windowCenter[0]+1)*p,_=(e.windowCenter[1]-1)*C,y=(e.windowCenter[1]+1)*C,w=f[0],b=f[1];n[0]=2*w/(T-x),n[5]=2*w/(y-_),n[2]=(x+T)/(T-x),n[6]=(_+y)/(y-_),n[10]=-(w+b)/(b-w),n[14]=-1,n[11]=-2*w*b/(b-w),n[15]=0}}return hr(s,n),s}}const Vfe={newInstance:Pfe,extend:wU},hs=[];function Ly(t,e=0){let n;for(n=0;n<hs.length&&!(hs[n].priority<=e);n++);hs.splice(n,0,{priority:e,provider:t})}function Ufe(t){for(let e=0;e<hs.length;e++)if(hs[e].provider===t){hs.splice(e,1);break}}function Bfe(){for(;hs.length>0;)hs.pop()}function tn(t,...e){for(let n=0;n<hs.length;n++){const r=hs[n].provider(t,...e);if(r!==void 0)return r}}const Gfe=Object.freeze(Object.defineProperty({__proto__:null,addProvider:Ly,get:tn,removeAllProviders:Bfe,removeProvider:Ufe},Symbol.toStringTag,{value:"Module"}));class gp{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.imageCacheOffsetMap=new Map,this.isPreScaled=!1;const{imageIds:n,scalarData:r,scaling:i,dimensions:a,spacing:o,origin:s,direction:l,volumeId:c,referencedVolumeId:d,sizeInBytes:f,imageData:h,metadata:p,referencedImageIds:C,additionalDetails:x}=e;if(this.imageIds=n,this.volumeId=c,this.metadata=p,this.dimensions=a,this.spacing=o,this.origin=s,this.direction=l,this.scalarData=r,this.sizeInBytes=f,this.vtkOpenGLTexture=Afe.newInstance(),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],h)this.imageData=h;else{const T=yc.newInstance(),_=Bt.newInstance({name:"Pixels",numberOfComponents:1,values:r});T.setDimensions(a),T.setSpacing(o),T.setDirection(l),T.setOrigin(s),T.getPointData().setScalars(_),this.imageData=T}this.numFrames=this._getNumFrames(),this._reprocessImageIds(),this._createCornerstoneImageMetaData(),i&&(this.scaling=i),d&&(this.referencedVolumeId=d),C&&(this.referencedImageIds=C),x&&(this.additionalDetails=x)}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=qs(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return!1}getScalarData(){if(joe(this.scalarData))return this.scalarData;throw new Error("Unknown scalar data type")}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}destroy(){this.imageData.delete(),this.imageData=null,this.scalarData=null,this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}getScalarDataArrays(){return this.isDynamicVolume()?this.scalarData:[this.scalarData]}modified(){if(this.imageData.modified(),this.isDynamicVolume())throw new Error("Not implemented");this.scalarData=this.imageData.getPointData().getScalars().getData(),this.numFrames=this._getNumFrames()}decache(e=!1){e?this.removeFromCache():this.convertToImageSlicesAndCache()}removeFromCache(){bt.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_getNumFrames(){const{imageIds:e,scalarData:n}=this,r=this.isDynamicVolume()?n.length:1;return e.length/r}_getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_createCornerstoneImageMetaData(){const{numFrames:e}=this;if(e===0)return;const n=this.sizeInBytes/e,i=this._getScalarDataLength()/this.numVoxels,a=this.dimensions[0]*this.dimensions[1]*i,{PhotometricInterpretation:o,voiLut:s,VOILUTFunction:l}=this.metadata;let c=[],d=[];s&&s.length&&(c=s.map(h=>h.windowCenter),d=s.map(h=>h.windowWidth));const f=i>1;this.cornerstoneImageMetaData={bytesPerImage:n,numComponents:i,pixelsPerImage:a,windowCenter:c,windowWidth:d,color:f,rgba:!1,spacing:this.spacing,dimensions:this.dimensions,photometricInterpretation:o,voiLUTFunction:l,invert:o==="MONOCHROME1"}}getScalarDataByImageIdIndex(e){if(e<0||e>=this.imageIds.length)throw new Error("imageIdIndex out of range");const n=this.getScalarDataArrays(),r=Math.floor(e/this.numFrames);return n[r]}getCornerstoneImage(e,n){const{imageIds:r}=this,i=this.imageIdIndexToFrameIndex(n),{bytesPerImage:a,pixelsPerImage:o,windowCenter:s,windowWidth:l,numComponents:c,color:d,dimensions:f,spacing:h,invert:p,voiLUTFunction:C,photometricInterpretation:x}=this.cornerstoneImageMetaData,T=this.getScalarDataByImageIdIndex(n),_=T.buffer,y=T.constructor,w=a/o;let b=a*i;T.BYTES_PER_ELEMENT!==w&&(b*=T.BYTES_PER_ELEMENT/w);const M=new y(o),I=new y(_,b,o);M.set(I);const A=r[n],k=tn("modalityLutModule",A)||{},U=jE(M),B=k.rescaleIntercept?k.rescaleIntercept:0;return{imageId:e,intercept:B,windowCenter:s,windowWidth:l,voiLUTFunction:C,color:d,rgba:!1,numComps:c,rows:f[1],columns:f[0],sizeInBytes:M.byteLength,getPixelData:()=>M,minPixelValue:U.min,maxPixelValue:U.max,slope:k.rescaleSlope?k.rescaleSlope:1,getCanvas:void 0,height:f[0],width:f[1],columnPixelSpacing:h[0],rowPixelSpacing:h[1],invert:p,photometricInterpretation:x}}imageIdIndexToFrameIndex(e){return e%this.numFrames}convertToCornerstoneImage(e,n){return this.getCornerstoneImageLoadObject(e,n)}getCornerstoneImageLoadObject(e,n){const r=this.getCornerstoneImage(e,n);return{promise:Promise.resolve(r)}}getCornerstoneImages(){const{imageIds:e}=this;return e.map((n,r)=>this.getCornerstoneImage(n,r))}convertToImageSlicesAndCache(){var o,s;const e=this.sizeInBytes;if(!((o=this.imageIds)!=null&&o.length)){const l=this.referencedVolumeId;let c=this.dimensions[2];if(l){const d=bt.getVolume(l);c=((s=d==null?void 0:d.imageIds)==null?void 0:s.length)??c}this.imageIds=Array.from({length:c},(d,f)=>`generated:${this.volumeId}:${f}`),this._reprocessImageIds(),this.numFrames=this._getNumFrames(),this._createCornerstoneImageMetaData()}const n=this.imageIds.length,{bytesPerImage:r}=this.cornerstoneImageMetaData;let i=bt.decacheIfNecessaryUntilBytesAvailable(e,this.imageIds);for(let l=0;l<n;l++){const c=this.imageIds[l];i=i-r;const d=this.getCornerstoneImage(c,l),f={promise:Promise.resolve(d)};if(bt.getImageLoadObject(c)||bt.putImageLoadObject(c,f).catch(M=>{console.error(M)}),i<=r)break;const h=[this.direction[0],this.direction[1],this.direction[2],this.direction[3],this.direction[4],this.direction[5]],p=6,C=[parseFloat((this.origin[0]+l*this.direction[6]*this.spacing[0]).toFixed(p)),parseFloat((this.origin[1]+l*this.direction[7]*this.spacing[1]).toFixed(p)),parseFloat((this.origin[2]+l*this.direction[8]*this.spacing[2]).toFixed(p))],_={bitsAllocated:d.getPixelData().BYTES_PER_ELEMENT*8,photometricInterpretation:d.photometricInterpretation,windowWidth:d.windowWidth,windowCenter:d.windowCenter,voiLUTFunction:d.voiLUTFunction},y={rowCosines:[this.direction[0],this.direction[1],this.direction[2]],columnCosines:[this.direction[3],this.direction[4],this.direction[5]],pixelSpacing:[this.spacing[0],this.spacing[1]],imageOrientationPatient:h,imagePositionPatient:C,columnPixelSpacing:d.columnPixelSpacing,rowPixelSpacing:d.rowPixelSpacing,columns:d.columns,rows:d.rows},b={imagePixelModule:_,imagePlaneModule:y,generalSeriesModule:{}};["imagePixelModule","imagePlaneModule","generalSeriesModule"].forEach(M=>{x2.add(c,{type:M,metadata:b[M]})})}const a=bt.filterVolumesByReferenceId(this.volumeId);return a.length&&a.forEach(l=>{l.referencedImageIds=this.imageIds}),this.removeFromCache(),this.imageIds}}const pp=gp,OO=1073741824;class zfe{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=3*OO,this._maxInstanceSize=4*OO-8,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{if(e>this._maxInstanceSize)return!1;const n=this.getBytesAvailable(),r=this._imageCacheSize;return n+r>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getMaxInstanceSize=()=>this._maxInstanceSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const n=this._imageCache.get(e);if(!n)return;const{imageLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),this._restoreImagesFromBuffer(i),r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n),Kt(Hn,xt.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),Kt(Hn,xt.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.getGeometry=e=>{if(e==null)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.getImage=e=>{if(e===void 0)throw new Error("getImage: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.image},this.getVolume=e=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volume},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=e=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(!n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this.incrementImageCacheSize(-n.sizeInBytes);const r={image:n,imageId:e};Kt(Hn,xt.IMAGE_CACHE_IMAGE_REMOVED,r),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this.incrementVolumeCacheSize(-n.sizeInBytes);const r={volume:n,volumeId:e};Kt(Hn,xt.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.putGeometryLoadObject=(e,n)=>{if(e==null)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");const r={geometryId:e,geometryLoadObject:n,loaded:!1,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{if(!this._geometryCache.has(e)){console.warn("putGeometryLoadObject: geometryId was removed from geometryCache");return}if(Number.isNaN(i.sizeInBytes))throw new Error("putGeometryLoadObject: geometry.sizeInBytes is not a number");r.loaded=!0,r.geometry=i,r.sizeInBytes=i.sizeInBytes;const a={geometry:i,geometryId:e};Kt(Hn,xt.GEOMETRY_CACHE_GEOMETRY_ADDED,a)}).catch(i=>{throw this._geometryCache.delete(e),i})},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.decrementVolumeCacheSize=e=>{this._volumeCacheSize-=e},this._geometryCache=new Map}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;let i=Array.from(this._imageCache.values());function a(l,c){return l.timeStamp>c.timeStamp?1:l.timeStamp<c.timeStamp?-1:0}i.sort(a);let o=i.map(l=>l.imageId),s=o;n&&(s=o.filter(l=>!n.includes(l)));for(const l of s)if(this.removeImageLoadObject(l),Kt(Hn,xt.IMAGE_CACHE_IMAGE_REMOVED,{imageId:l}),r=this.getBytesAvailable(),r>=e)return r;i=Array.from(this._imageCache.values()),o=i.map(l=>l.imageId);for(const l of o)if(this.removeImageLoadObject(l),Kt(Hn,xt.IMAGE_CACHE_IMAGE_REMOVED,{imageId:l}),r=this.getBytesAvailable(),r>=e)return r}putImageLoadObject(e,n){if(e===void 0)throw new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,r),n.promise.then(i=>{if(!this._imageCache.get(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(i.sizeInBytes===void 0||Number.isNaN(i.sizeInBytes))throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(i.sizeInBytes.toFixed===void 0)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(i.sizeInBytes))throw new Error(xt.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(i.sizeInBytes),r.loaded=!0,r.image=i,r.sizeInBytes=i.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const a={image:r};Kt(Hn,xt.IMAGE_CACHE_IMAGE_ADDED,a),r.sharedCacheKey=i.sharedCacheKey}).catch(i=>{throw this._imageCache.delete(e),i})}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){var i;const n=Array.from(this._volumeCache.keys()),r=qs(e);for(const a of n){const o=this._volumeCache.get(a);if(!o)return;const{volume:s}=o;if(!((i=s==null?void 0:s.imageIds)!=null&&i.length))return;const l=s.getImageURIIndex(r);if(l>-1)return{volume:s,imageIdIndex:l}}}getCachedImageBasedOnImageURI(e){const n=qs(e),i=Array.from(this._imageCache.keys()).find(a=>qs(a)===n);if(i)return this._imageCache.get(i)}putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{if(!this._volumeCache.get(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(Number.isNaN(i.sizeInBytes))throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(i.sizeInBytes.toFixed===void 0)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(i.sizeInBytes,i.imageIds),r.volume=i,r.sizeInBytes=i.sizeInBytes,this.incrementVolumeCacheSize(r.sizeInBytes);const a={volume:r};Kt(Hn,xt.VOLUME_CACHE_VOLUME_ADDED,a)}).catch(i=>{throw this._volumeCache.delete(e),i})}_restoreImagesFromBuffer(e){if(!(e instanceof gp)){console.warn("Volume is not an ImageVolume. Cannot restore images from buffer.");return}const n=e.getScalarData(),r=e.imageCacheOffsetMap;if(r.size!==0){for(const[i,{offset:a}]of r){const o=this.getImage(i);if(!o){console.warn(`Image with id ${i} not found in cache.`);continue}const s=o.getPixelData(),l=s.length,c=new s.constructor(n.buffer,a,l);o.getPixelData=()=>c,o.imageFrame&&(o.imageFrame.pixelData=c),delete o.bufferView,this.incrementImageCacheSize(o.sizeInBytes)}console.log(`Images restored from buffer for volume ${e.volumeId}.`)}}}const bt=new zfe;class CU{constructor(e){this.color=[200,0,0],this.id=e.id,this.points=e.data.points,this.polys=e.data.polys,this.color=e.color??this.color,this.frameOfReferenceUID=e.frameOfReferenceUID,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return this.points.length*4+this.polys.length*4}getColor(){return this.color}getPoints(){return this.points}getPolys(){return this.polys}setColor(e){this.color=e}setPoints(e){this.points=e}setPolys(e){this.polys=e}getSizeInBytes(){return this.sizeInBytes}}function Wfe(t,e){var n,r;if(t.modality)return t.modality;if(t.setVolumes)return e=e??((n=t.getDefaultActor())==null?void 0:n.uid),e?(r=bt.getVolume(e))==null?void 0:r.metadata.Modality:void 0;throw new Error("Invalid viewport type")}function Vg(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),o=n.slice(6,9),s=[er(i,e),er(a,e),er(o,e)],l=zt();return Dn(l,s[0]*r[0],s[1]*r[1],s[2]*r[2]),Xs(l)}function Ix(t,e,n){if(!t)return;const{direction:r,imageIds:i}=t;if(!i||!i.length)return;const a=r.slice(6,9),o=er(a,n);if(Math.abs(o)<1-sc)return;const l=Vg(t,n)/2;let c;for(let d=0;d<i.length;d++){const f=i[d],{imagePositionPatient:h}=tn("imagePlaneModule",f),p=zt();ka(p,e,h);const C=er(p,n);Math.abs(C)<l&&(c=f)}return c}const{vtkErrorMacro:jfe}=de;class Hfe{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const o=i<a?a:i,s=this.segments[o];if(i>0)for(let l=1;l<e.length-1;l++)s.push(e[l]);else for(let l=1;l<e.length-1;l++)s.unshift(e[e.length-1-l]);this.faces.push(s),this.segments[o]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const o=Math.abs(i),s=Math.abs(a),l=this.segments[o],c=this.segments[s];this.segments[o]=null,this.segments[s]=null,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.addSegment(e),this.addSegment(l),this.addSegment(c)}else if(i!==void 0){if(i>0){const o=this.segments[i];for(let s=1;s<e.length;s++)o.push(e[s]);this.segmentMapping[r]=i}else{const o=this.segments[-i];this.segmentMapping[r]=i;for(let s=1;s<e.length;s++)o.unshift(e[s])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const o=this.segments[a];for(let s=1;s<e.length;s++)o.push(e[e.length-1-s]);this.segmentMapping[n]=a}else{const o=this.segments[-a];this.segmentMapping[n]=a;for(let s=1;s<e.length;s++)o.unshift(e[e.length-s-1])}this.segmentMapping[r]=void 0}else{const o=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-o,this.segmentMapping[r]=o}}}function $fe(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){jfe("Invalid or missing input");return}const a=gi.newInstance();a.shallowCopy(i);const o=new Hfe,s=i.getLines().getData();let l=0;for(;l<s.length;){const h=s[l++],p=[];for(let C=0;C<h;C++)p.push(s[l+C]);o.addSegment(p),l+=h}const{faces:c}=o;let d=c.length;for(let h=0;h<c.length;h++)d+=c[h].length;const f=new Uint16Array(d);l=0;for(let h=0;h<c.length;h++){const p=c[h];f[l++]=p.length;for(let C=0;C<p.length;C++)f[l++]=p[C]}a.setPolys(Pf.newInstance({values:f,name:"faces"})),r[0]=a}}const Kfe={};function xU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kfe,n),de.obj(t,e),de.algo(t,e,1,1),$fe(t,e)}const qfe=de.newInstance(xU,"vtkClosedPolyLineToSurfaceFilter");var Xfe={newInstance:qfe,extend:xU};const{vtkErrorMacro:MO}=_i;function Yfe(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let o=0;for(let s=i;s<a;++s)r.cell[o++]=e[s]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let o=0;for(let s=i;s<a;++s)r.cell[o++]=n[s]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function Jfe(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const o=i.getPoints(),s=o.getData(),l=o.getNumberOfPoints(),c=[],d=[],f=[];(!e.cutScalars||e.cutScalars.length<l)&&(e.cutScalars=new Float32Array(l));let h=0,p=0;for(;h<s.length;)e.cutScalars[p++]=e.cutFunction.evaluateFunction(s[h++],s[h++],s[h++]);const C=[],x=new Array(3),T=new Array(3),_=[];for(const w=Yfe(i);!w.done;w.next()){if(w.cellSize<=2)continue;for(let k=0;k<w.cellSize;)_[k]=e.cutScalars[w.cell[k++]];const b=_[0]>0;let M=!0;for(let k=1;k<w.cell.length;k++)if(_[k]>0!==b){M=!1;break}if(M)continue;const I=[];for(let k=0;k<w.cellSize;k++){const U=k+1===w.cellSize?0:k+1,B=_[k]>0;if(_[U]>0===B)continue;let K=k,J=U,X=_[J]-_[K];X<=0&&(K=U,J=k,X*=-1);let re=0;X!==0&&(re=(e.cutValue-_[K])/X);const fe=w.cell[K],pe=w.cell[J];x[0]=s[fe*3],x[1]=s[fe*3+1],x[2]=s[fe*3+2],T[0]=s[pe*3],T[1]=s[pe*3+1],T[2]=s[pe*3+2];const ie=[x[0]+re*(T[0]-x[0]),x[1]+re*(T[1]-x[1]),x[2]+re*(T[2]-x[2])];I.push({pointEdge1:fe,pointEdge2:pe,intersectedPoint:ie,newPointID:-1})}for(let k=0;k<I.length;k++){const U=I[k];let B=!1;for(let z=0;z<C.length;z++){const K=C[z],J=U.pointEdge1===K.pointEdge1&&U.pointEdge2===K.pointEdge2,X=U.intersectedPoint[0]===K.intersectedPoint[0]&&U.intersectedPoint[1]===K.intersectedPoint[1]&&U.intersectedPoint[2]===K.intersectedPoint[2];if(J||X){B=!0,I[k].newPointID=C[z].newPointID;break}}B||(c.push(U.intersectedPoint[0]),c.push(U.intersectedPoint[1]),c.push(U.intersectedPoint[2]),I[k].newPointID=c.length/3-1,C.push(I[k]))}const A=I.length;A===2?d.push(A,I[0].newPointID,I[1].newPointID):A>2&&(f.push(A),I.forEach(k=>{f.push(k.newPointID)}))}a.getPoints().setData(dy(o.getDataType(),c),3),d.length!==0&&a.getLines().setData(Uint16Array.from(d)),f.length!==0&&a.getPolys().setData(Uint16Array.from(f))}t.requestData=(i,a)=>{const o=i[0];if(!o){MO("Invalid or missing input");return}if(!e.cutFunction){MO("Missing cut function");return}const s=gi.newInstance();r(o,s),a[0]=s}}const Zfe={cutFunction:null,cutScalars:null,cutValue:0};function SU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zfe,n),ir(t,e),rE(t,e,1,1),Ur(t,e,["cutFunction","cutValue"]),Jfe(t,e)}const Qfe=Ln(SU,"vtkCutter");var ede={newInstance:Qfe,extend:SU};const tde=t=>t,NO=1e-6;let EU=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=kt(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Nk:tde}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);Dn(r,e[0],e[1],e[2]),Dn(i,n[0],n[1],n[2]),Ui(r,r),Ui(i,i);const o=er(r,i);return o>=1?this:(Xr(this.tmp,r,i),Xs(this.tmp)<NO&&(Xr(this.tmp,[1,0,0],e),Xs(this.tmp)<NO&&Xr(this.tmp,[0,1,0],e)),ZE(a,Math.acos(o),this.tmp),En(this.matrix,this.matrix,a),this)}rotate(e,n){return Dn(this.tmp,...n),Ui(this.tmp,this.tmp),Do(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return qE(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return XE(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return YE(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Dn(this.tmp,e,n,r),xr(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Dn(this.tmp,e,n,r),nl(this.matrix,this.matrix,this.tmp),this}multiply(e){return En(this.matrix,this.matrix,e),this}multiply3x3(e){return En(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Vr(this.matrix,this.matrix),this}identity(){return kt(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Zf(gE,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)Dn(this.tmp,e[a],e[a+1],e[a+2]),vn(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&hr(this.matrix,e),this}};function nde(){return new EU(!0)}function rde(){return new EU(!1)}var Ci={buildFromDegree:nde,buildFromRadian:rde};const ide=Object.freeze(Object.defineProperty({__proto__:null,default:Ci},Symbol.toStringTag,{value:"Module"})),ade=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],ode=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function sde(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,i){if(e.deleted)return;const a=gi.newInstance();i[0]=a;const o=24,s=de.newTypedArray(e.pointType,o*3);a.getPoints().setData(s,3);const l=de.newTypedArray(e.pointType,o*3),c=Bt.newInstance({name:"Normals",values:l,numberOfComponents:3});a.getPointData().setNormals(c);let d=2;e.generate3DTextureCoordinates===!0&&(d=3);const f=de.newTypedArray(e.pointType,o*d),h=Bt.newInstance({name:"TextureCoordinates",values:f,numberOfComponents:d});a.getPointData().setTCoords(h);const p=[0,0,0],C=[0,0,0],x=[0,0];let T=0;p[0]=-e.xLength/2,C[0]=-1,C[1]=0,C[2]=0;for(let _=0;_<2;_++){p[1]=-e.yLength/2;for(let y=0;y<2;y++){x[1]=p[1]+.5,p[2]=-e.zLength/2;for(let w=0;w<2;w++)x[0]=(p[2]+.5)*(1-2*_),s[T*3]=p[0],s[T*3+1]=p[1],s[T*3+2]=p[2],l[T*3]=C[0],l[T*3+1]=C[1],l[T*3+2]=C[2],d===2?(f[T*d]=x[0],f[T*d+1]=x[1]):(f[T*d]=2*_-1,f[T*d+1]=2*y-1,f[T*d+2]=2*w-1),T++,p[2]+=e.zLength;p[1]+=e.yLength}p[0]+=e.xLength,C[0]+=2}p[1]=-e.yLength/2,C[1]=-1,C[0]=0,C[2]=0;for(let _=0;_<2;_++){p[0]=-e.xLength/2;for(let y=0;y<2;y++){x[0]=(p[0]+.5)*(2*_-1),p[2]=-e.zLength/2;for(let w=0;w<2;w++)x[1]=(p[2]+.5)*-1,s[T*3]=p[0],s[T*3+1]=p[1],s[T*3+2]=p[2],l[T*3]=C[0],l[T*3+1]=C[1],l[T*3+2]=C[2],d===2?(f[T*d]=x[0],f[T*d+1]=x[1]):(f[T*d]=2*y-1,f[T*d+1]=2*_-1,f[T*d+2]=2*w-1),T++,p[2]+=e.zLength;p[0]+=e.xLength}p[1]+=e.yLength,C[1]+=2}p[2]=-e.zLength/2,C[2]=-1,C[0]=0,C[1]=0;for(let _=0;_<2;_++){p[1]=-e.yLength/2;for(let y=0;y<2;y++){x[1]=p[1]+.5,p[0]=-e.xLength/2;for(let w=0;w<2;w++)x[0]=(p[0]+.5)*(2*_-1),s[T*3]=p[0],s[T*3+1]=p[1],s[T*3+2]=p[2],l[T*3]=C[0],l[T*3+1]=C[1],l[T*3+2]=C[2],d===2?(f[T*d]=x[0],f[T*d+1]=x[1]):(f[T*d]=2*w-1,f[T*d+1]=2*y-1,f[T*d+2]=2*_-1),T++,p[0]+=e.xLength;p[1]+=e.yLength}p[2]+=e.zLength,C[2]+=2}if(e.rotations&&Ci.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(l),e.center&&Ci.buildFromRadian().translate(...e.center).apply(s),e.matrix){Ci.buildFromRadian().setMatrix(e.matrix).apply(s);const _=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];Ci.buildFromRadian().setMatrix(_).apply(l)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)r.push(i<0||arguments.length<=i?void 0:arguments[i]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const lde={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function TU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lde,n),de.obj(t,e),de.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),de.setGetArray(t,e,["center","rotations"],3),de.setGetArray(t,e,["matrix"],16),e._polys=Pf.newInstance({values:Uint16Array.from(ode)}),e._lineCells=Pf.newInstance({values:Uint16Array.from(ade)}),de.moveToProtected(t,e,["polys","lineCells"]),de.algo(t,e,0,1),sde(t,e)}const cde=de.newInstance(TU,"vtkCubeSource");var _U={newInstance:cde,extend:TU};const{vtkErrorMacro:RO}=de;function ude(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){RO("Invalid or missing input");return}const o=a.getSpatialExtent();if(!o){RO("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(o),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const fde={};function DU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fde,n),de.obj(t,e),de.algo(t,e,1,1),e._cubeSource=_U.newInstance(),de.moveToProtected(t,e,["cubeSource","tmpOut"]),ude(t,e)}const dde=de.newInstance(DU,"vtkImageDataOutlineFilter");var hde={newInstance:dde,extend:DU};let GT;function gde(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(vn(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<n.length;o+=3)i[0]=n[o],i[1]=n[o+1],i[2]=n[o+2],vn(a,i,e.matrix),r[o]=a[0],r[o+1]=a[1],r[o+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?En(r,e.matrix,n):En(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),o=e.preMultiplyFlag?()=>En(a,e.matrix,i):()=>En(a,i,e.matrix);for(let s=0;s<n.length;s+=16){for(let l=0;l<16;++l)i[l]=n[s+l];o();for(let l=0;l<16;++l)r[s+l]=a[l]}return r},t.getInverse=()=>GT({matrix:to.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const pde={preMultiplyFlag:!1,matrix:[...gE]};function bU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pde,n),de.obj(t,e),de.setGet(t,e,["preMultiplyFlag"]),de.setGetArray(t,e,["matrix"],16),gde(t,e)}GT=de.newInstance(bU,"vtkTransform");var mde={newInstance:GT,extend:bU},vde=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,yde=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:nu}=_i;function AO(t,e,n){if(e){const r=t.getIndependentComponents();return`${e.getMTime()}-${r}-${n}`}return"0"}function LO(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function wde(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper"),t.buildPass=r=>{if(r){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(i.getActiveCamera()),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e._openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){nu("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),i.getProperty().getInterpolationType()===Mu.NEAREST?(e.openGLTexture.setMinificationFilter(Ft.NEAREST),e.openGLTexture.setMagnificationFilter(Ft.NEAREST),e.colorTexture.setMinificationFilter(Ft.NEAREST),e.colorTexture.setMagnificationFilter(Ft.NEAREST),e.pwfTexture.setMinificationFilter(Ft.NEAREST),e.pwfTexture.setMagnificationFilter(Ft.NEAREST)):(e.openGLTexture.setMinificationFilter(Ft.LINEAR),e.openGLTexture.setMagnificationFilter(Ft.LINEAR),e.colorTexture.setMinificationFilter(Ft.LINEAR),e.colorTexture.setMagnificationFilter(Ft.LINEAR),e.pwfTexture.setMinificationFilter(Ft.LINEAR),e.pwfTexture.setMagnificationFilter(Ft.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime(),t.buildBufferObjects=(r,i)=>{var I;const a=e.currentInput;if(!a)return;const o=(I=a.getPointData())==null?void 0:I.getScalars();if(!o)return;e._scalars!==o&&(e._openGLRenderWindow.releaseGraphicsResourcesForObject(e._scalars),e._scalars=o);const s=o.getNumberOfComponents();let l=`${a.getMTime()}A${o.getMTime()}`;const c=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(!(c!=null&&c.vtkObj)||(c==null?void 0:c.hash)!==l||e.openGLTextureString!==l){e.openGLTexture||(e.openGLTexture=Dr.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow));const A=a.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(A[0],A[1],A[2],o),e.openGLTextureString=l,o&&e._openGLRenderWindow.setGraphicsResourceForObject(o,e.openGLTexture,e.openGLTextureString)}else e.openGLTexture=c.vtkObj,e.openGLTextureString=c.hash;const f=i.getProperty(),h=f.getIndependentComponents(),p=h?s:1,C=h?2*p:1,x=f.getRGBTransferFunction();l=AO(f,x,p);const T=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!(T!=null&&T.vtkObj)||(T==null?void 0:T.hash)!==l||e.colorTextureString!==l){const k=1024*C*3,U=new Uint8ClampedArray(k);if(e.colorTexture||(e.colorTexture=Dr.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow)),x){const B=new Float32Array(3072);for(let z=0;z<p;z++){const K=f.getRGBTransferFunction(z),J=K.getRange();if(K.getTable(J[0],J[1],1024,B,1),h)for(let X=0;X<1024*3;X++)U[z*1024*6+X]=255*B[X],U[z*1024*6+X+1024*3]=255*B[X];else for(let X=0;X<1024*3;X++)U[z*1024*6+X]=255*B[X]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,C,3,un.UNSIGNED_CHAR,U)}else{for(let B=0;B<1024*3;++B)U[B]=255*B/(1023*3),U[B+1]=255*B/(1023*3),U[B+2]=255*B/(1023*3);e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,un.UNSIGNED_CHAR,U)}e.colorTextureString=l,x&&e._openGLRenderWindow.setGraphicsResourceForObject(x,e.colorTexture,e.colorTextureString)}else e.colorTexture=T.vtkObj,e.colorTextureString=T.hash;const y=f.getPiecewiseFunction();l=AO(f,y,p);const w=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!(w!=null&&w.vtkObj)||(w==null?void 0:w.hash)!==l||e.pwfTextureString!==l){const k=1024*C,U=new Uint8ClampedArray(k);if(e.pwfTexture||(e.pwfTexture=Dr.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow)),y){const B=new Float32Array(k),z=new Float32Array(1024);for(let K=0;K<p;++K){const J=f.getPiecewiseFunction(K);if(J===null)B.fill(1);else{const X=J.getRange();if(J.getTable(X[0],X[1],1024,z,1),h)for(let re=0;re<1024;re++)B[K*1024*2+re]=z[re],B[K*1024*2+re+1024]=z[re];else for(let re=0;re<1024;re++)B[K*1024*2+re]=z[re]}}e.pwfTexture.releaseGraphicsResources(e._openGLRenderWindow),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,C,1,un.FLOAT,B)}else U.fill(255),e.pwfTexture.releaseGraphicsResources(e._openGLRenderWindow),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,un.UNSIGNED_CHAR,U);e.pwfTextureString=l,y&&e._openGLRenderWindow.setGraphicsResourceForObject(y,e.pwfTexture,e.pwfTextureString)}else e.pwfTexture=w.vtkObj,e.pwfTextureString=w.hash;const M=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==M){const A=Bt.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});A.setName("points");const k=Bt.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),U={points:A,cellOffset:0};if(e.renderable.getSlabThickness()>0){const B=e.resliceGeom.getPointData().getNormals();B?U.normals=B:nu("Slab mode requested without normals")}e.tris.getCABO().createVBO(k,"polys",Si.SURFACE,U)}e.VBOBuildString=M,e.VBOBuildTime.modified()},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram();if(r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){o.isUniformUsed("texture1")&&o.setUniformi("texture1",e.openGLTexture.getTextureUnit()),o.isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(o,r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||nu("Error setting vertexWC in shader VAO.")),o.isAttributeUsed("normalWC")&&(r.getVAO().addAttributeArray(o,r.getCABO(),"normalWC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||nu("Error setting normalWC in shader VAO.")),o.isUniformUsed("slabThickness")&&o.setUniformf("slabThickness",e.renderable.getSlabThickness()),o.isUniformUsed("spacing")&&o.setUniform3fv("spacing",e.currentInput.getSpacing()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabTrapezoid")&&o.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null;if(o.isUniformUsed("WCTCMatrix")){const c=e.currentInput,d=c.getDimensions();hr(e.tmpMat4,c.getIndexToWorld()),nl(e.tmpMat4,e.tmpMat4,d),Vr(e.tmpMat4,e.tmpMat4),l&&En(e.tmpMat4,e.tmpMat4,l),o.setUniformMatrix("WCTCMatrix",e.tmpMat4)}o.isUniformUsed("vboScaling")&&o.setUniform3fv("vboScaling",r.getCABO().getCoordScale()),r.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const s=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",s.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",s.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const o=e._openGLCamera.getKeyMatrices(i),s=e._openGLImageSlice.getKeyMatrices(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,d=r.getProgram();d.isUniformUsed("MCPCMatrix")&&(kt(e.tmpMat4),d.setUniformMatrix("MCPCMatrix",LO([o.wcpc,s.mcwc,c],Lf,e.tmpMat4))),d.isUniformUsed("MCVCMatrix")&&(kt(e.tmpMat4),d.setUniformMatrix("MCVCMatrix",LO([o.wcvc,s.mcwc,c],Lf,e.tmpMat4)))},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=a.getProperty(),l=s.getOpacity();o.setUniformf("opacity",l);const c=e.openGLTexture.getComponents(),d=s.getIndependentComponents();if(d)for(let C=0;C<c;++C)o.setUniformf(`mix${C}`,s.getComponentWeight(C));const f=e.openGLTexture.getVolumeInfo();for(let C=0;C<c;C++){let x=s.getColorWindow(),T=s.getColorLevel();const _=d?C:0,y=s.getRGBTransferFunction(_);if(y&&s.getUseLookupTableScalarRange()){const M=y.getRange();x=M[1]-M[0],T=.5*(M[1]+M[0])}const w=f.scale[C]/x,b=(f.offset[C]-T)/x+.5;o.setUniformf(`cshift${C}`,b),o.setUniformf(`cscale${C}`,w)}const h=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",h);for(let C=0;C<c;C++){let x=1,T=0;const _=d?C:0,y=s.getPiecewiseFunction(_);if(y){const w=y.getRange(),b=w[1]-w[0],M=.5*(w[0]+w[1]);x=f.scale[C]/b,T=(f.offset[C]-M)/b+.5}o.setUniformf(`pwfshift${C}`,T),o.setUniformf(`pwfscale${C}`,x)}const p=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",p),o.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(r,i,a)=>{var h;const o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),c=e.renderable.getSlabType(),d=e.renderable.getSlabTrapezoidIntegration();let f=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(f=!0),f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((h=r.getProgram())==null?void 0:h.getHandle())===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==s||e.lastSlabThickness!==l||e.lastSlabType!==c||e.lastSlabTrapezoidIntegration!==d?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,e.lastSlabThickness=l,e.lastSlabType=c,e.lastSlabTrapezoidIntegration=d,!0):!1},t.getShaderTemplate=(r,i,a)=>{r.Vertex=vde,r.Fragment=yde,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderTCoord(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=Le.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=Le.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderTCoord=(r,i,a)=>{let o=r.Vertex;const s=r.Geometry;let l=r.Fragment;const c=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],d=e.renderable.getSlabThickness();o=Le.substitute(o,"//VTK::TCoord::Dec",c).result;const f=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];o=Le.substitute(o,"//VTK::TCoord::Impl",f).result;const h=e.openGLTexture.getComponents(),p=a.getProperty().getIndependentComponents();let C=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(p){for(let T=1;T<h;T++)C=C.concat([`uniform float cshift${T};`,`uniform float cscale${T};`,`uniform float pwfshift${T};`,`uniform float pwfscale${T};`]);switch(h){case 1:C=C.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:C=C.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:C=C.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:C=C.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:nu("Unsupported number of independent coordinates.")}}d>0&&(C=C.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),C=C.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=Le.substitute(l,"//VTK::TCoord::Dec",C).result;let x=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(d>0&&(x=x.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),p){const T=["r","g","b","a"];for(let _=0;_<h;++_)x=x.concat([`vec3 tcolor${_} = mix${_} * texture2D(colorTexture1, vec2(tvalue.${T[_]} * cscale${_} + cshift${_}, height${_})).rgb;`,`float compWeight${_} = mix${_} * texture2D(pwfTexture1, vec2(tvalue.${T[_]} * pwfscale${_} + pwfshift${_}, height${_})).r;`]);switch(h){case 1:x=x.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:x=x.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:x=x.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:x=x.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:nu("Unsupported number of independent coordinates.")}}else switch(h){case 1:x=x.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:x=x.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:x=x.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:x=x.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=Le.substitute(l,"//VTK::TCoord::Impl",x).result,r.Vertex=o,r.Fragment=l,r.Geometry=s},t.replaceShaderPositionVC=(r,i,a)=>{let o=r.Vertex;const s=r.Geometry;let l=r.Fragment;const c=e.renderable.getSlabThickness();let d=["attribute vec4 vertexWC;"];d=d.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),c>0&&(d=d.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),o=Le.substitute(o,"//VTK::PositionVC::Dec",d).result;let f=["gl_Position = MCPCMatrix * vertexWC;"];c>0&&(f=f.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),o=Le.substitute(o,"//VTK::PositionVC::Impl",f).result,o=Le.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let h=[];c>0&&(h=h.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=Le.substitute(l,"//VTK::PositionVC::Dec",h).result,r.Vertex=o,r.Geometry=s,r.Fragment=l};function n(r){to.normalize(r);const i=[0,0,0];for(let a=0;a<3;++a){Zk(i),i[a]=1;const o=to.dot(r,i);if(o<-.999||o>.999)return[!0,a]}return[!1,2]}t.updateResliceGeometry=()=>{var d;let r="";const i=e.currentInput,a=i==null?void 0:i.getBounds();let o=!0,s=2;const l=e.renderable.getSlicePolyData(),c=e.renderable.getSlicePlane();if(l)r=r.concat(`PolyData${l.getMTime()}`);else if(c){r=r.concat(`Plane${c.getMTime()}`),i&&(r=r.concat(`Image${i.getMTime()}`));const f=sf(i==null?void 0:i.getDirection());fp(f,f);const h=[...c.getNormal()];tg(h,h,f),[o,s]=n(h)}else{const f=Fi.newInstance();f.setNormal(0,0,1);let h=[0,1,0,1,0,1];i&&(h=a),f.setOrigin(h[0],h[2],.5*(h[5]+h[4])),e.renderable.setSlicePlane(f),r=r.concat(`Plane${c==null?void 0:c.getMTime()}`),i&&(r=r.concat(`Image${i.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==r){if(l)e.resliceGeom||(e.resliceGeom=gi.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(c)if(o){const f=new Float32Array(12),h=i.worldToIndex(c.getOrigin(),[0,0,0]),p=[(s+1)%3,(s+2)%3].sort(),C=i.getDimensions(),x=[0,C[0]-1,0,C[1]-1,0,C[2]-1];let T=0;for(let M=0;M<2;++M)for(let I=0;I<2;++I)f[T+s]=h[s],f[T+p[0]]=x[2*p[0]+I],f[T+p[1]]=x[2*p[1]+M],T+=3;e.transform.setMatrix(i.getIndexToWorld()),e.transform.transformPoints(f,f);const _=new Uint16Array(8);_[0]=3,_[1]=0,_[2]=1,_[3]=3,_[4]=3,_[5]=0,_[6]=3,_[7]=2;const y=c.getNormal();to.normalize(y);const w=new Float32Array(12);for(let M=0;M<4;++M)w[3*M]=y[0],w[3*M+1]=y[1],w[3*M+2]=y[2];e.resliceGeom||(e.resliceGeom=gi.newInstance()),e.resliceGeom.getPoints().setData(f,3),e.resliceGeom.getPolys().setData(_,1);const b=Bt.newInstance({numberOfComponents:3,values:w,name:"Normals"});e.resliceGeom.getPointData().setNormals(b)}else{e.outlineFilter.setInputData(i),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(c),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=gi.newInstance());const f=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(f.getPoints().getData(),3),e.resliceGeom.getPolys().setData(f.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(f.getPointData().getNormals());const h=c.getNormal(),p=e.resliceGeom.getNumberOfPoints();to.normalize(h);const C=new Float32Array(p*3);for(let T=0;T<p;++T)C[3*T]=h[0],C[3*T+1]=h[1],C[3*T+2]=h[2];const x=Bt.newInstance({numberOfComponents:3,values:C,name:"Normals"});e.resliceGeom.getPointData().setNormals(x)}else nu("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=r,(d=e.resliceGeom)==null||d.modified()}},t.setOpenGLTexture=r=>{r&&(e.openGLTexture=r,e._externalOpenGLTexture=!0)}}const Cde={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,openGLTextureString:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1,_scalars:null};function xde(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cde,n),$n.extend(t,e,n),ps.implementReplaceShaderCoincidentOffset(t,e,n),ps.implementBuildShadersWithReplacements(t,e,n),e.tris=ys.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},ir(e.VBOBuildTime),e.tmpMat4=kt(new Float64Array(16)),e.outlineFilter=hde.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=gi.newInstance(),e.cutter=ede.newInstance(),e.lineToSurfaceFilter=Xfe.newInstance(),e.transform=mde.newInstance(),aa(t,e,["openGLTexture"]),wde(t,e)}const Sde=Ln(xde,"vtkOpenGLImageResliceMapper");jr("vtkImageResliceMapper",Sde);const ru={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:ym}=de;function kO(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}function Ede(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow))},t.opaquePass=(n,r)=>{n&&(e.currentRenderPass=r,t.render())},t.opaqueZBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(n,r)=>e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),r=e._openGLRenderer.getRenderable();t.renderPiece(r,n)},t.renderPiece=(n,r)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(n,r),t.renderPieceDraw(n,r),t.renderPieceFinish(n,r))},t.renderPieceStart=(n,r)=>{t.updateBufferObjects(n,r)},t.renderPieceDraw=(n,r)=>{const i=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,r),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,r)=>{},t.updateBufferObjects=(n,r)=>{t.getNeedToRebuildBufferObjects(n,r)&&t.buildBufferObjects(n,r)},t.getNeedToRebuildBufferObjects=(n,r)=>{const i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<r.getMTime()||i<e.currentImageDataInput.getMTime()||i<e.currentCenterlineInput.getMTime()},t.buildBufferObjects=(n,r)=>{const i=e.currentImageDataInput,a=e.currentCenterlineInput;r.getProperty().getInterpolationType()===Mu.NEAREST?(e.volumeTexture.setMinificationFilter(Ft.NEAREST),e.volumeTexture.setMagnificationFilter(Ft.NEAREST),e.colorTexture.setMinificationFilter(Ft.NEAREST),e.colorTexture.setMagnificationFilter(Ft.NEAREST),e.pwfTexture.setMinificationFilter(Ft.NEAREST),e.pwfTexture.setMagnificationFilter(Ft.NEAREST)):(e.volumeTexture.setMinificationFilter(Ft.LINEAR),e.volumeTexture.setMagnificationFilter(Ft.LINEAR),e.colorTexture.setMinificationFilter(Ft.LINEAR),e.colorTexture.setMagnificationFilter(Ft.LINEAR),e.pwfTexture.setMinificationFilter(Ft.LINEAR),e.pwfTexture.setMagnificationFilter(Ft.LINEAR));const s=i.getMTime();if(e.volumeTextureTime!==s){const T=i.getDimensions(),_=i.getPointData().getScalars();if(!_)return;e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.releaseGraphicsResources(e._openGLRenderWindow),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromRaw(T[0],T[1],T[2],_.getNumberOfComponents(),_.getDataType(),_.getData(),e.renderable.getPreferSizeOverAccuracy()),e.volumeTextureTime=s}const l=i.getPointData()&&i.getPointData().getScalars();if(!l)return;const c=l.getNumberOfComponents(),d=r.getProperty(),f=d.getIndependentComponents(),h=f?c:1,p=f?2*h:1,C=kO(d,d.getRGBTransferFunction,h);if(e.colorTextureString!==C){const _=1024*p*3,y=new Uint8ClampedArray(_);let w=d.getRGBTransferFunction();if(w){const b=new Float32Array(3072);for(let M=0;M<h;M++){w=d.getRGBTransferFunction(M);const I=w.getRange();if(w.getTable(I[0],I[1],1024,b,1),f)for(let A=0;A<1024*3;A++)y[M*1024*6+A]=255*b[A],y[M*1024*6+A+1024*3]=255*b[A];else for(let A=0;A<1024*3;A++)y[M*1024*6+A]=255*b[A]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,un.UNSIGNED_CHAR,y)}else{for(let b=0;b<1024*3;++b)y[b]=255*b/(1023*3),y[b+1]=255*b/(1023*3),y[b+2]=255*b/(1023*3);e.colorTexture.create2DFromRaw(1024,1,3,un.UNSIGNED_CHAR,y)}e.colorTextureString=C}const x=kO(d,d.getPiecewiseFunction,h);if(e.pwfTextureString!==x){const _=1024*p,y=new Uint8ClampedArray(_);let w=d.getPiecewiseFunction();if(e.pwfTexture.releaseGraphicsResources(e._openGLRenderWindow),e.pwfTexture.resetFormatAndType(),w){const b=new Float32Array(_),M=new Float32Array(1024);for(let I=0;I<h;++I)if(w=d.getPiecewiseFunction(I),w===null)b.fill(1);else{const A=w.getRange();if(w.getTable(A[0],A[1],1024,M,1),f)for(let k=0;k<1024;k++)b[I*1024*2+k]=M[k],b[I*1024*2+k+1024]=M[k];else for(let k=0;k<1024;k++)b[I*1024*2+k]=M[k]}e.pwfTexture.create2DFromRaw(1024,p,1,un.FLOAT,b)}else y.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,un.UNSIGNED_CHAR,y);e.pwfTextureString=x}if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()){const T=a.getNumberOfPoints(),_=T<=1?0:T-1,y=a.getDistancesToFirstPoint(),w=e.renderable.getHeight(),b=4*_,M=new Float32Array(3*b),I=e.renderable.getWidth();for(let ie=0,te=0;ie<_;++ie)M.set([0,w-y[ie],0],te),te+=3,M.set([I,w-y[ie],0],te),te+=3,M.set([I,w-y[ie+1],0],te),te+=3,M.set([0,w-y[ie+1],0],te),te+=3;const A=Bt.newInstance({numberOfComponents:3,values:M});A.setName("points");const k=new Uint16Array(5*_);for(let ie=0,te=0,ee=0;ie<_;++ie)k.set([4,ee+3,ee+2,ee+1,ee],te),te+=5,ee+=4;const U=Bt.newInstance({numberOfComponents:1,values:k}),B=a.getPoints(),z=new Float32Array(3*b),K=new Array(3),J=new Array(3);for(let ie=0,te=0;ie<_;++ie)B.getPoint(ie,K),B.getPoint(ie+1,J),z.set(K,te),te+=3,z.set(K,te),te+=3,z.set(J,te),te+=3,z.set(J,te),te+=3;const X=Bt.newInstance({numberOfComponents:3,values:z,name:"centerlinePosition"}),re=new Float32Array(b);for(let ie=0,te=0;ie<_;++ie)re.set([0,1,3,2],te),te+=4;const fe=Bt.newInstance({numberOfComponents:1,values:re,name:"quadIndex"}),pe=[X,fe];if(!e.renderable.getUseUniformOrientation()){const ie=e.renderable.getOrientedCenterline().getOrientations()??[],te=new Float32Array(4*b),ee=new Float32Array(4*b);for(let De=0;De<_;++De){const Re=ie[De],Oe=ie[De+1];for(let Ve=0;Ve<4;++Ve){const qe=4*(Ve+4*De);te.set(Re,qe),ee.set(Oe,qe)}}const we=Bt.newInstance({numberOfComponents:4,values:te,name:"centerlineTopOrientation"}),Ce=Bt.newInstance({numberOfComponents:4,values:ee,name:"centerlineBotOrientation"});pe.push(we,Ce)}e.tris.getCABO().createVBO(U,"polys",Si.SURFACE,{points:A,customAttributes:pe}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(n,r,i)=>{const a=e.volumeTexture.getComponents(),o=i.getProperty().getIndependentComponents(),s=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),c=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return n.getProgram()===0||e.lastUseCenterPoint!==s||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==a||e.lastIndependentComponents!==o?(e.lastUseCenterPoint=s,e.lastUseUniformOrientation=l,e.lastProjectionMode=c,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=o,!0):!1},t.buildShaders=(n,r,i)=>{t.getShaderTemplate(n,r,i),t.replaceShaderValues(n,r,i)},t.replaceShaderValues=(n,r,i)=>{let a=n.Vertex,o=n.Fragment;const s=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];a=Le.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Le.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],c=e.renderable.isProjectionEnabled(),d=e.renderable.getUseUniformOrientation();d?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...s),c&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),a=Le.substitute(a,"//VTK::Color::Dec",l).result;const f=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];d?(f.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),c&&f.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):f.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),a=Le.substitute(a,"//VTK::Color::Impl",f).result;const h=e.volumeTexture.getComponents(),p=i.getProperty().getIndependentComponents();let C=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];c&&C.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),d?(C.push("in vec3 samplingDirVSOutput;"),c&&C.push("in vec3 projectionDirVSOutput;")):(C.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...s),c&&C.push("uniform vec3 bitangentDirection;"));const x=e.renderable.getCenterPoint();if(x&&C.push("uniform vec3 globalCenterPoint;"),p){for(let _=1;_<h;_++)C=C.concat([`uniform float cshift${_};`,`uniform float cscale${_};`,`uniform float pwfshift${_};`,`uniform float pwfscale${_};`]);switch(h){case 1:C=C.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:C=C.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:C=C.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:C=C.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:ym("Unsupported number of independent coordinates.")}}o=Le.substitute(o,"//VTK::TCoord::Dec",C).result;let T=[];if(d?(T.push("vec3 samplingDirection = samplingDirVSOutput;"),c&&T.push("vec3 projectionDirection = projectionDirVSOutput;")):(T.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),c&&T.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),x?T.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):T.push("float horizontalOffset = quadOffsetVSOutput.x;"),T.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),c){const _=e.renderable.getProjectionMode();switch(_){case ru.MIN:T.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case ru.MAX:case ru.AVERAGE:default:T.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(T.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),_){case ru.MAX:T.push("  tvalue = max(tvalue, sampledTextureValue);");break;case ru.MIN:T.push("  tvalue = min(tvalue, sampledTextureValue);");break;case ru.AVERAGE:default:T.push("  tvalue = tvalue + sampledTextureValue;");break}T.push("}"),_===ru.AVERAGE&&T.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else T.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(p){const _=["r","g","b","a"];for(let y=0;y<h;++y)T=T.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${_[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${_[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(h){case 1:T=T.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:T=T.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:T=T.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:T=T.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:ym("Unsupported number of independent coordinates.")}}else switch(h){case 1:T=T.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:T=T.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:T=T.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:T=T.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}o=Le.substitute(o,"//VTK::TCoord::Impl",T).result,e.haveSeenDepthRequest&&(o=Le.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=Le.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=o,t.replaceShaderClip(n,r,i),t.replaceShaderCoincidentOffset(n,r,i)},t.replaceShaderClip=(n,r,i)=>{let a=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let s=e.renderable.getNumberOfClippingPlanes();s>6&&(de.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),s=6),a=Le.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Le.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=Le.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=Le.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=o},t.getShaderTemplate=(n,r,i)=>{n.Vertex=NT,n.Fragment=hp,n.Geometry=""},t.setMapperShaderParameters=(n,r,i)=>{const a=n.getProgram(),o=n.getCABO();o.getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(a.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(a,o,"vertexMC",o.getVertexOffset(),o.getStride(),e.context.FLOAT,3,e.context.FALSE)||ym("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(h=>{h&&a.isAttributeUsed(h.name)&&!n.getVAO().addAttributeArray(a,o,h.name,h.offset,o.getStride(),e.context.FLOAT,h.components,e.context.FALSE)&&ym(`Error setting ${h.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());const s=e.volumeTexture.getTextureUnit();if(a.setUniformi("volumeTexture",s),a.setUniformf("width",e.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),a.isUniformUsed("tangentDirection")){const h=e.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",h)}if(a.isUniformUsed("bitangentDirection")){const h=e.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",h)}if(a.isUniformUsed("centerlineOrientation")){const h=e.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",h)}if(a.isUniformUsed("globalCenterPoint")){const h=e.renderable.getCenterPoint();a.setUniform3fArray("globalCenterPoint",h)}if(e.renderable.isProjectionEnabled()){const h=e.currentImageDataInput,p=h.getSpacing(),C=h.getDimensions(),x=e.renderable.getProjectionSlabThickness(),T=e.renderable.getProjectionSlabNumberOfSamples(),_=Qk([],p,C);a.setUniform3fArray("volumeSizeMC",_),a.setUniformi("projectionSlabNumberOfSamples",T);const y=-.5*x;a.setUniformf("projectionConstantOffset",y);const w=x/(T-1);a.setUniformf("projectionStepLength",w)}const l=e.currentImageDataInput,c=l.getWorldToIndex(),d=JE(new Float32Array(16),nT([],l.getDimensions())),f=i2(d,d,c);if(a.setUniformMatrix("MCTCMatrix",f),e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(de.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),h=6);const C=o.getCoordShiftAndScaleEnabled()?o.getInverseShiftAndScaleMatrix():null,x=C?hr(e.imagematinv,i.getMatrix()):i.getMatrix();C&&(yn(x,x),En(x,x,C),yn(x,x)),yn(e.imagemat,e.currentImageDataInput.getIndexToWorld()),En(e.imagematinv,x,e.imagemat);const T=[];for(let _=0;_<h;_++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,_,y);for(let w=0;w<4;w++)T.push(y[w])}a.setUniformi("numClipPlanes",h),a.setUniform4fv("clipPlanes",T)}if(a.isUniformUsed("coffset")){const h=t.getCoincidentParameters(r,i);a.setUniformf("coffset",h.offset),a.isUniformUsed("cfactor")&&a.setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(n,r,i)=>{const a=e.openGLImageSlice.getKeyMatrices().mcwc,o=e.openGLCamera.getKeyMatrices(r).wcpc;if(En(e.imagemat,o,a),n.getCABO().getCoordShiftAndScaleEnabled()){const s=n.getCABO().getInverseShiftAndScaleMatrix();En(e.imagemat,e.imagemat,s)}n.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(n,r,i)=>{const a=n.getProgram(),o=i.getProperty(),s=o.getOpacity();a.setUniformf("opacity",s);const l=e.volumeTexture.getComponents(),c=o.getIndependentComponents();if(c)for(let p=0;p<l;++p)a.setUniformf(`mix${p}`,o.getComponentWeight(p));const d=e.volumeTexture.getVolumeInfo();for(let p=0;p<l;p++){let C=o.getColorWindow(),x=o.getColorLevel();const T=c?p:0,_=o.getRGBTransferFunction(T);if(_&&o.getUseLookupTableScalarRange()){const b=_.getRange();C=b[1]-b[0],x=.5*(b[1]+b[0])}const y=d.scale[p]/C,w=(d.offset[p]-x)/C+.5;a.setUniformf(`cshift${p}`,w),a.setUniformf(`cscale${p}`,y)}const f=e.colorTexture.getTextureUnit();a.setUniformi("colorTexture1",f);for(let p=0;p<l;p++){let C=1,x=0;const T=c?p:0,_=o.getPiecewiseFunction(T);if(_){const y=_.getRange(),w=y[1]-y[0],b=.5*(y[0]+y[1]);C=d.scale[p]/w,x=(d.offset[p]-b)/w+.5}a.setUniformf(`pwfshift${p}`,x),a.setUniformf(`pwfscale${p}`,C)}const h=e.pwfTexture.getTextureUnit();a.setUniformi("pwfTexture1",h)},t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,r,i);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==n.getProgram()&&(n.setProgram(o),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,r,i),t.setCameraShaderParameters(n,r,i),t.setPropertyShaderParameters(n,r,i)}}const Tde={currentRenderPass:null,volumeTexture:null,volumeTextureTime:0,colorTexture:null,colorTextureString:null,pwfTexture:null,pwfTextureString:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function _de(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tde,n),$n.extend(t,e,n),ps.implementReplaceShaderCoincidentOffset(t,e,n),de.algo(t,e,2,0),e.tris=ys.newInstance(),e.volumeTexture=Dr.newInstance(),e.colorTexture=Dr.newInstance(),e.pwfTexture=Dr.newInstance(),e.imagemat=kt(new Float64Array(16)),e.imagematinv=kt(new Float64Array(16)),e.VBOBuildTime={},de.obj(e.VBOBuildTime,{mtime:0}),Ede(t,e)}const Dde=de.newInstance(_de,"vtkOpenGLImageCPRMapper");jr("vtkImageCPRMapper",Dde);const IU=Object.create(null);function po(t,e){IU[t]=e}function bde(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const Ide={};function Ode(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ide,n),e.overrides=IU,ST.extend(t,e,n),bde(t,e)}de.newInstance(Ode,"vtkWebGPUViewNodeFactory");function Mde(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(kt(n),e.renderable.getParallelProjection()){const o=e.renderable.getParallelScale(),s=o*r,l=o,c=(a[0]-1)*s,d=(a[0]+1)*s,f=(a[1]-1)*l,h=(a[1]+1)*l,p=1/(d-c),C=1/(h-f);n[0]=2*p,n[5]=2*C,n[10]=1/(i[1]-i[0]),n[12]=(d+c)*p,n[13]=(h+f)*C,n[14]=i[1]/(i[1]-i[0])}else{const o=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,l;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*o,l=i[0]*o/r):(s=i[0]*o*r,l=i[0]*o);const c=(a[0]-1)*s,d=(a[0]+1)*s,f=(a[1]-1)*l,h=(a[1]+1)*l;n[0]=2*i[0]/(d-c),n[5]=2*i[0]/(h-f),n[12]=(c+d)/(d-c),n[13]=(f+h)/(h-f),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();hr(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Vr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),yn(e.keyMatrices.wcvc,a);const o=n.getStabilizedCenterByReference();xr(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);const s=n.getAspectRatio(),l=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,l,e.renderable.getWindowCenterByReference()),En(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Vr(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const Nde={keyMatrixTime:null,keyMatrices:null};function Rde(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nde,n),$n.extend(t,e,n),e.keyMatrixTime={},de.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},de.setGet(t,e,["keyMatrixTime"]),Mde(t,e)}const Ade=de.newInstance(Rde);po("vtkCamera",Ade);function Lde(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupEntry();o.binding=a,i.push(o)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const kde={device:null,handle:null,label:null};function OU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kde,n),de.obj(t,e),e.bindables=[],e.bindGroupTime={},de.obj(e.bindGroupTime,{mtime:0}),de.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),de.setGet(t,e,["label","device","arrayInformation"]),Lde(t,e)}const Pde=de.newInstance(OU);var MU={newInstance:Pde,extend:OU};function Fde(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const Vde={device:null,handle:null};function NU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vde,n),de.obj(t,e),de.get(t,e,["lastCameraMTime"]),de.setGet(t,e,["device","handle"]),Fde(t,e)}const Ude=de.newInstance(NU,"vtkWebGPUShaderModule");var Bde={newInstance:Ude,extend:NU};function Gde(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let o="";r&&(o="g");const s=new RegExp(e,o),l=t.replace(s,i);return{replace:a,result:l}}function zde(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let s=0;s<a.length;s++){const l=a[s];if(l.getHash()===i&&l.getType()===r)return e._shaderModules.get(l)}const o=Bde.newInstance();return o.initialize(e.device,n),e._shaderModules.set(n,o),o}}const Wde={shaderModules:null,device:null,window:null};function RU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wde,n),e._shaderModules=new Map,de.obj(t,e),de.setGet(t,e,["device","window"]),zde(t,e)}const jde=de.newInstance(RU,"vtkWebGPUShaderCache");var Wn={newInstance:jde,extend:RU,substitute:Gde};function Hde(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const o=e.shaderDescriptions[a],s=n.getShaderModule(o);o.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),o.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const $de={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function AU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$de,n),ir(t,e),e.layouts=[],e.shaderDescriptions=[],aa(t,e,["handle","pipelineDescription"]),Ur(t,e,["device","renderEncoder","topology","vertexState"]),Hde(t,e)}const Kde=Ln(AU,"vtkWebGPUPipeline");var qde={newInstance:Kde,extend:AU};function Xde(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const o=[];if(o.push(`struct ${e.type}Input
{`),n){const s=n.getOutputNamesByReference(),l=n.getOutputTypesByReference(),c=n.getOutputInterpolationsByReference();for(let d=0;d<s.length;d++)c[d]!==void 0?o.push(`  @location(${d}) @interpolate(${c[d]}) ${s[d]} : ${l[d]},`):o.push(`  @location(${d}) ${s[d]} : ${l[d]},`)}for(let s=0;s<e.builtinInputNames.length;s++)o.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);o.length>1&&(o.push("};"),a=o,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=Wn.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const o=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?o.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):o.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)o.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);o.push("};"),a=a.concat(o),e.code=Wn.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=Wn.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const Yde={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function LU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yde,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],de.obj(t,e),de.setGet(t,e,["type","hash","code"]),de.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Xde(t,e)}const Jde=de.newInstance(LU,"vtkWebGPUShaderDescription");var PO={newInstance:Jde,extend:LU};const FO={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Zde(t){return!t||t.length<6?0:t in FO?FO[t]:(Sn(`unknown format ${t}`),null)}function Qde(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return Sn(`unknown format ${t}`),0;const i=5-r/2;return e*i}function ehe(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function the(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{Sn(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){Sn(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function nhe(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{Sn(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function rhe(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function ihe(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";Sn(`unknown format ${t}`)}}var xi={getDetailsFromTextureFormat:Zde,getByteStrideFromBufferFormat:Qde,getNumberOfComponentsFromBufferFormat:ehe,getNativeTypeFromBufferFormat:the,getShaderTypeFromBufferFormat:nhe,getByteStrideFromShaderFormat:rhe,getNativeTypeFromShaderFormat:ihe};function ahe(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function ohe(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let o=0;o<e.inputs.length;o++)if(ahe(e.inputs[o].names,a)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((o,s)=>o.names[0]<s.names[0]?-1:o.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const o=e.inputs[i].buffer.getArrayInformation()[a],s=xi.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${s}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const o=e.inputs[a].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},l=o.getArrayInformation();for(let c=0;c<e.inputs[a].names.length;c++)s.attributes.push({shaderLocation:i,offset:l[c].offset,format:l[c].format}),i++;r.push(s)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const she={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function kU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,she,n),ir(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Ur(t,e,["created","device","handle","indexBuffer"]),ohe(t,e)}const lhe=Ln(kU,"vtkWebGPUVertexInput");var che={newInstance:lhe,extend:kU};const uhe=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,fhe=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function dhe(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=PO.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=PO.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(a),s.push(o);const l=e.vertexShaderTemplate+e.fragmentShaderTemplate,c=new RegExp("//VTK::[^:]*::","g"),f=l.match(c).filter((h,p,C)=>C.indexOf(h)===p).map(h=>`replaceShader${h.substring(7,h.length-2)}`);for(let h=0;h<f.length;h++){const p=f[h];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=Wn.substitute(s,"//VTK::Renderer::Dec",[a]).result,o.setCode(s);const l=r.getShaderDescription("fragment");s=l.getCode(),s=Wn.substitute(s,"//VTK::Renderer::Dec",[a]).result,l.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=Wn.substitute(s,"//VTK::Mapper::Dec",[a]).result,o.setCode(s);const l=r.getShaderDescription("fragment");l.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=l.getCode(),s=Wn.substitute(s,"//VTK::Mapper::Dec",[a]).result,l.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=a.getCode();o=Wn.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=qde.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const hhe={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function PU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hhe,n),$n.extend(t,e,n),e.textureViews=[],e.vertexInput=che.newInstance(),e.bindGroup=MU.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||fhe,e.vertexShaderTemplate=e.vertexShaderTemplate||uhe,e.shaderReplacements=new Map,de.get(t,e,["pipeline","vertexInput"]),de.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),dhe(t,e)}const ghe=de.newInstance(PU,"vtkWebGPUSimpleMapper");var FU={newInstance:ghe,extend:PU};function phe(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();o=Wn.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const mhe={};function VU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mhe,n),FU.extend(t,e,n),phe(t,e)}const vhe=de.newInstance(VU,"vtkWebGPUFullScreenQuad");var Ox={newInstance:vhe,extend:VU};const yhe={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},whe={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var mp={BufferUsage:yhe,PrimitiveTypes:whe};const D4=["getMappedRange","mapAsync","unmap"];function Che(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=a.getMappedRange(0,i);new Uint8Array(o).set(new Uint8Array(r)),a.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(a,0,e,n,i);const l=s.finish();t.queue.submit([l]),a.destroy()}function xhe(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{Che(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<D4.length;n++)t[D4[n]]=function(){return e.handle[D4[n]](...arguments)}}const She={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function UU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,She,n),de.obj(t,e),de.get(t,e,["handle","sizeInBytes","usage"]),de.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),xhe(t,e)}const Ehe=de.newInstance(UU);var Mx={newInstance:Ehe,extend:UU,...mp};const{Representation:VO}=td,{PrimitiveTypes:Ll}=mp;class The{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function _he(t){switch(t){case Ll.Points:return"points";case Ll.Lines:return"lines";case Ll.Triangles:case Ll.TriangleEdges:return"polys";case Ll.TriangleStripEdges:case Ll.TriangleStrips:return"strips";default:return""}}function wm(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function Dhe(t,e,n){const r=t.length;for(let o=0;o<r;o++){let s=t[o];if(n.cellProvokedMap.has(s)){n.ibo[n.iboId++]=n.cellProvokedMap.get(s);for(let l=o+1;l<o+r;l++){s=t[l%r];const c=wm(n,s,e);n.ibo[n.iboId++]=c}return}}for(let o=0;o<r;o++){let s=t[o];if(!n.provokedPointIds[s]){let l=wm(n,s,e);n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,l),n.flatIdToCellId[l]=e,n.ibo[n.iboId++]=l;for(let c=o+1;c<o+r;c++)s=t[c%r],l=wm(n,s,e),n.ibo[n.iboId++]=l;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let o=1;o<r;o++)i=t[o],a=wm(n,i,e),n.ibo[n.iboId++]=a}function bhe(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let Us;const UO=new Uint32Array(1),qa=new Uint32Array(2),_l=new Uint32Array(3),b4={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)UO[0]=e[n+a],Us(UO,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)qa[0]=e[n+a],qa[1]=e[n+a+1],Us(qa,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)qa[0]=e[n+a],qa[1]=e[n+(a+1)%t],Us(qa,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)qa[0]=e[n+a],qa[1]=e[n+a+1],Us(qa,r,i);for(let a=0;a<t-2;a++)qa[0]=e[n+a],qa[1]=e[n+a+2],Us(qa,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)_l[0]=e[n],_l[1]=e[n+a+1],_l[2]=e[n+a+2],Us(_l,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)_l[0]=e[n+a],_l[1]=e[n+a+1+a%2],_l[2]=e[n+a+1+(a+1)%2],Us(_l,r,i)}};function Ihe(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,o=n.cellOffset,s=r.getData(),l=s.length,c=_he(i),d=n.numberOfPoints,f={provokedPointIds:new Uint8Array(d),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new The};let h=null;a===VO.POINTS||i===Ll.Points?h=b4.anythingToPoints:a===VO.WIREFRAME||i===Ll.Lines?h=b4[`${c}ToWireframe`]:h=b4[`${c}ToSurface`],Us=bhe;let p=o||0;for(let C=0;C<l;)f.cellProvokedMap.clear(),h(s[C],s,C+1,p,f),C+=s[C]+1,p++;d<=65535?f.flatIdToPointId=new Uint16Array(d+f.extraPoints):f.flatIdToPointId=new Uint32Array(d+f.extraPoints),d+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(d):f.pointIdToFlatId=new Int32Array(d),d+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),p<=65535?f.flatIdToCellId=new Uint16Array(d+f.extraPoints):f.flatIdToCellId=new Uint32Array(d+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),Us=Dhe,p=o||0;for(let C=0;C<l;)f.cellProvokedMap.clear(),h(s[C],s,C+1,p,f),C+=s[C]+1,p++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const Ohe={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function BU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ohe,n),Mx.extend(t,e,n),de.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Ihe(t,e)}const Mhe=de.newInstance(BU);var Nhe={newInstance:Mhe,extend:BU,...mp};const{BufferUsage:Dl}=mp,{vtkErrorMacro:Rhe}=_i,{VtkDataTypes:iu}=Bt,Ahe={};function Lhe(t){let e;switch(t.getDataType()){case iu.UNSIGNED_CHAR:e="uint8";break;case iu.FLOAT:e="float32";break;case iu.UNSIGNED_INT:e="uint32";break;case iu.INT:e="sint32";break;case iu.DOUBLE:e="float32";break;case iu.UNSIGNED_SHORT:e="uint16";break;case iu.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Rhe(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function BO(t,e,n,r,i){const a={},o=t.getFlatSize();if(!o)return a;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let l=[1,1,1,1];i.scale&&(i.scale.length?l=i.scale:l.fill(i.scale));const c=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let d,f=0;const h=n+(c?1:0),p=Yf(r,o*h);let C=t.getFlatIdToPointId();i.cellData&&(C=t.getFlatIdToCellId()),n===1?d=function(T){p[f++]=l[0]*e[T]+s[0]}:n===2?d=function(T){p[f++]=l[0]*e[T]+s[0],p[f++]=l[1]*e[T+1]+s[1]}:n===3&&!c?d=function(T){p[f++]=l[0]*e[T]+s[0],p[f++]=l[1]*e[T+1]+s[1],p[f++]=l[2]*e[T+2]+s[2]}:n===3&&c?d=function(T){p[f++]=l[0]*e[T]+s[0],p[f++]=l[1]*e[T+1]+s[1],p[f++]=l[2]*e[T+2]+s[2],p[f++]=l[3]*1+s[3]}:n===4&&(d=function(T){p[f++]=l[0]*e[T]+s[0],p[f++]=l[1]*e[T+1]+s[1],p[f++]=l[2]*e[T+2]+s[2],p[f++]=l[3]*e[T+3]+s[3]});for(let x=0;x<o;x++){const T=n*C[x];d(T)}return a.nativeArray=p,a}function khe(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return uo(i,a,o),cc(o),o}function Phe(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let o=0;for(let s=0;s<a;){const l=khe(n,r[s+1],r[s+2],r[s+3]);i[o++]=127*l[0],i[o++]=127*l[1],i[o++]=127*l[2],i[o++]=127,s+=r[s]+1}return i}function Fhe(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===Dl.Index&&(i=Nhe.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=Mx.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===Dl.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===Dl.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===Dl.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===Dl.PointArray){a=GPUBufferUsage.VERTEX;const o=xi.getNativeTypeFromBufferFormat(r.format),s=BO(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(s.nativeArray,a),i.setStrideInBytes(xi.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===Dl.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const o=xi.getNativeTypeFromBufferFormat(r.format),s=Phe(r.cells,r.dataArray),l=BO(r.indexBuffer,s,4,o,{cellData:!0});i.createAndWrite(l.nativeArray,a),i.setStrideInBytes(xi.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===Dl.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(xi.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=Lhe(r),o={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:Dl.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(o)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=Mx.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const Vhe={device:null,fullScreenQuadBuffer:null};function GU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vhe,n),ir(t,e),Ur(t,e,["device"]),Fhe(t,e)}const Uhe=Ln(GU);var nd={newInstance:Uhe,extend:GU,...Ahe,...mp};const{BufferUsage:Bhe}=nd,{vtkErrorMacro:V0}=de;function Ghe(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){V0(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=xi.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:xi.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:Bhe.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=de.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){V0(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType];s[(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){V0(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType],l=(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let c=0;c<i.length;c++)s[l+c]=i[c]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){V0(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let l=0;l<e.numberOfInstances;l++){const c=(a.offset+l*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)o[c+d]=r[l*s+d]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){V0(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let l=0;l<e.numberOfInstances;l++){const c=(a.offset+l*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)o[c+d]=r[l*s+d]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){V0(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=9;for(let l=0;l<e.numberOfInstances;l++){const c=(a.offset+l*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let d=0;d<3;d++)for(let f=0;f<3;f++)o[c+d*4+f]=r[l*s+d*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const zhe={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function zU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zhe,n),de.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},de.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},de.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},de.get(t,e,["bindGroupTime"]),de.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Ghe(t,e)}const Whe=de.newInstance(zU,"vtkWebGPUStorageBuffer");var jhe={newInstance:Whe,extend:zU};const{BufferUsage:Hhe}=nd,{vtkErrorMacro:I4}=de;function $he(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){I4(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:xi.getByteStrideFromShaderFormat(r),offset:-1,nativeType:xi.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.sizeInBytes%16===0&&(i=Math.max(16,i)),o.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed===!1&&o.sizeInBytes%16===0&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(o.packed===!1&&o.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const l=e.bufferEntries[s];if(l.packed===!1&&l.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0)for(let s=a+1;s<e.bufferEntries.length;s++){const l=e.bufferEntries[s];if(!l.packed&&l.sizeInBytes%8===0){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0){let s=!1;for(let l=0;!s&&l<e.bufferEntries.length;l++){const c=e.bufferEntries[l];if(!c.packed&&c.sizeInBytes===4)for(let d=l+1;d<e.bufferEntries.length;d++){const f=e.bufferEntries[d];if(!f.packed&&f.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes,f.packed=!0,f.offset=n,r.push(f),n+=f.sizeInBytes,s=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];!o.packed&&o.sizeInBytes>4&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed||(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:Hhe.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=de.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){I4(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];a.lastValue!==r&&(o[a.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){I4(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];let s=!1;for(let l=0;l<r.length;l++)(!a.lastValue||a.lastValue[l]!==r[l])&&(o[a.offset/o.BYTES_PER_ELEMENT+l]=r[l],s=!0);s&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const Khe={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function WU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Khe,n),de.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},de.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},de.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,de.get(t,e,["binding","bindGroupTime"]),de.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),$he(t,e)}const qhe=de.newInstance(WU,"vtkWebGPUUniformBuffer");var Sf={newInstance:qhe,extend:WU};const{vtkDebugMacro:Xhe}=_i,GO=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,Yhe=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Cm=new Float64Array(16),zO=new Float64Array(16);function Jhe(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function Zhe(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],o=[];Za(o,i,.5*(n[0]+n[1])),io(a,r,o),ka(o,a,e.stabilizedCenter),iT(o)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(Xhe("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const i=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",i.wcvc),e.UBO.setArray("SCPCMatrix",i.scpc),e.UBO.setArray("PCSCMatrix",i.pcsc),e.UBO.setArray("SCVCMatrix",i.scvc),e.UBO.setArray("VCPCMatrix",i.vcpc),e.UBO.setArray("WCVCNormals",i.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const o=e._parent.getDevice();e.UBO.sendIfNeeded(o)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),s=new Float32Array(n.length*4),l=new Float32Array(n.length*4);for(let d=0;d<n.length;d++){const f=d*4,h=n[d].getPosition();vn(h,h,r.wcvc),a[f]=h[0],a[f+1]=h[1],a[f+2]=h[2],a[f+3]=0,o[f]=-n[d].getDirection()[0],o[f+1]=-n[d].getDirection()[1],o[f+2]=-n[d].getDirection()[2],o[f+3]=0,s[f]=n[d].getColor()[0],s[f+1]=n[d].getColor()[1],s[f+2]=n[d].getColor()[2],s[f+3]=n[d].getIntensity()*5,l[f]=Jhe(n[d]),l[f+1]=Math.cos(Cr(n[d].getConeAngle())),l[f+2]=Math.cos(Cr(n[d].getConeAngle()+n[d].getConeFalloff())),l[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",o),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",l);const c=e._parent.getDevice();e.SSBO.send(c)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var a;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=Ox.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(GO);const o=Sf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((a=e.backgroundTex)!=null&&a.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(Yhe);const o=Sf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o);const s=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(s.getReady()){const l=s.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([l]),e.backgroundTexLoaded=!0;const c=e.backgroundTex.getInterpolate()?"linear":"nearest";l.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=Ox.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(GO);const o=Sf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),yn(zO,r.normalMatrix),i2(Cm,r.scvc,r.pcsc),i2(Cm,zO,Cm),e.clearFSQ.getUBO().setArray("FSQMatrix",Cm),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),l=Math.round(o[1]),c=n[2]-r[0],d=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(c,d);let h=Math.round(f[0])-s,p=Math.round(f[1])-l;return h<0&&(h=0),p<0&&(p=0),{usize:h,vsize:p,lowerLeftU:s,lowerLeftV:l}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const Qhe={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function ege(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qhe,n),$n.extend(t,e,n),e.UBO=Sf.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=jhe.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=MU.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=kt(new Float64Array(16)),e.stabilizedTime={},ir(e.stabilizedTime,{mtime:0}),aa(t,e,["bindGroup","stabilizedTime"]),Jf(t,e,["stabilizedCenter"]),Ur(t,e,["renderEncoder","selector","suppressClear","UBO"]),Zhe(t,e)}const tge=Ln(ege,"vtkWebGPURenderer");po("vtkRenderer",tge);function nge(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const rge={device:null,handle:null,label:null,options:null};function jU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rge,n),de.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},de.obj(e.bindGroupTime,{mtime:0}),de.get(t,e,["bindGroupTime","handle","options"]),de.setGet(t,e,["bindGroupLayoutEntry","device","label"]),nge(t,e)}const ige=de.newInstance(jU);var HU={newInstance:ige,extend:jU};const{SlicingMode:WO}=Ay,age=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function oge(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const ba=new Float64Array(16),Zo=new Float64Array(16),xm=new Float64Array(16),Ps=new Float64Array(4),$r=new Float64Array(4);function sge(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),o=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const s=o.getInputData(),l=e.WebGPURenderer.getStabilizedCenterByReference();kt(ba),xr(ba,ba,l);const c=a.getMatrix();yn(Zo,c),Vr(Zo,Zo),En(ba,Zo,ba);const d=s.getWorldToIndex();En(ba,d,ba),Vr(xm,ba),xy(Zo,[.5,.5,.5]),En(ba,Zo,ba);const f=s.getDimensions();kt(Zo),nl(Zo,Zo,[1/f[0],1/f[1],1/f[2]]),En(ba,Zo,ba),e.UBO.setArray("SCTCMatrix",ba);const h=e.currentInput.getExtent(),{ijkMode:p}=e.renderable.getClosestIJKAxis();let C=e.renderable.getSlice();p!==e.renderable.getSlicingMode()&&(C=e.renderable.getSliceAtPosition(C));let x=2,T=0,_=1;p===WO.I?(x=0,T=1,_=2):p===WO.J&&(x=1,T=2,_=0),Ps[x]=C,Ps[T]=h[T*2]-.5,Ps[_]=h[_*2]-.5,Ps[3]=1,Kl(Ps,Ps,xm),e.UBO.setArray("Origin",Ps),$r[x]=C,$r[T]=h[T*2+1]+.5,$r[_]=h[_*2]-.5,$r[3]=1,Kl($r,$r,xm),a2($r,$r,Ps),$r[3]=1,e.UBO.setArray("Axis1",$r),$r[x]=C,$r[T]=h[T*2]-.5,$r[_]=h[_*2+1]+.5,$r[3]=1,Kl($r,$r,xm),a2($r,$r,Ps),$r[3]=1,e.UBO.setArray("Axis2",$r);const y=[1,1,1,1],w=[0,0,0,0],b=e.textureViews[0],M=b.getTexture().getScale(),I=b.getTexture().getNumberOfComponents();for(let A=0;A<I;A++){let k=a.getProperty().getColorWindow(),U=a.getProperty().getColorLevel();const z=a.getProperty().getRGBTransferFunction(0);if(z){const K=z.getRange();k=K[1]-K[0],U=.5*(K[1]+K[0])}y[A]=M/k,w[A]=-U/k+.5}e.UBO.setArray("cScale",y),e.UBO.setArray("cShift",w),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const o=1,s=oge(i,i.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;const l=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let c=i.getRGBTransferFunction();if(c){const d=new Float32Array(e.rowLength*3);for(let f=0;f<o;f++){c=i.getRGBTransferFunction(f);const h=c.getRange();c.getTable(h[0],h[1],e.rowLength,d,1);for(let p=0;p<e.rowLength;p++){const C=f*e.rowLength*8+p*4;l[C]=255*d[p*3],l[C+1]=255*d[p*3+1],l[C+2]=255*d[p*3+2],l[C+3]=255;for(let x=0;x<4;x++)l[C+e.rowLength*4+x]=l[C+x]}}}else for(let d=0;d<e.rowLength;++d){const f=255*d/(e.rowLength-1);l[d*4]=f,l[d*4+1]=f,l[d*4+2]=f,l[d*4+3]=255;for(let h=0;h<4;h++)l[d*4+e.rowLength*4+h]=l[d*4+h]}{const d={nativeArray:l,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},h=e.device.getTextureManager().getTexture(d).createView("tfunTexture");e.textureViews[1]=h}e.colorTextureString=s}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const l=i.createView("imgTexture");a[0]=l}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Mu.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=HU.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,o)=>{const s=a.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let l=s.getCode();const c=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?c.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):c.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),c.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),l=Wn.substitute(l,"//VTK::Position::Impl",c).result,s.setCode(l)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,o)=>{const s=a.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,o)=>{const s=a.getShaderDescription("fragment");let l=s.getCode();e.dimensions===3?l=Wn.substitute(l,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:l=Wn.substitute(l,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,l=Wn.substitute(l,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(l)},r.set("replaceShaderImage",t.replaceShaderImage)}const lge={rowLength:1024};function cge(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lge,n),Ox.extend(t,e,n),t.setFragmentShaderTemplate(age),e.UBO=Sf.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},ir(e.lutBuildTime,{mtime:0}),e.imagemat=kt(new Float64Array(16)),e.imagematinv=kt(new Float64Array(16)),e.VBOBuildTime={},ir(e.VBOBuildTime),sge(t,e)}const uge=Ln(cge,"vtkWebGPUImageMapper");po("vtkImageMapper",uge);function fge(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],yn(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?kt(e.keyMatrices.normalMatrix):(hr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Vr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),yn(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),xr(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),xr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const dge={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function hge(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dge,n),$n.extend(t,e,n),e.keyMatricesTime={},ir(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},ir(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:kt(new Float64Array(16))},e.bufferShift=[0,0,0,0],aa(t,e,["propID","keyMatricesTime"]),fge(t,e)}const gge=Ln(hge,"vtkWebGPUImageSlice");po("vtkImageSlice",gge);function pge(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const o=e.renderable.getMapper().getInputData();if(!o)return;const s=o.getExtent(),l=e.renderable.getMatrix();let c=0;for(let d=4;d<6;d++){n[2]=s[d];for(let f=2;f<4;f++){n[1]=s[f];for(let h=0;h<2;h++){n[0]=s[h],o.indexToWorld(n,r);let p=a+c*3;i[p++]=l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3],i[p++]=l[4]*r[0]+l[5]*r[1]+l[6]*r[2]+l[7],i[p++]=l[8]*r[0]+l[9]*r[1]+l[10]*r[2]+l[11],c++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),o=i.getStabilizedCenterByReference();yn(e.keyMatrices.bcwc,a),xr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const mge={propID:void 0,keyMatricesTime:null};function vge(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mge,n),$n.extend(t,e,n),e.keyMatricesTime={},de.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},de.get(t,e,["propID","keyMatricesTime"]),pge(t,e)}const yge=de.newInstance(vge,"vtkWebGPUVolume");po("vtkVolume",yge);function wge(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)}}const Cge={};function xge(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cge,n),$n.extend(t,e,n),wge(t,e)}const Sge=de.newInstance(xge,"vtkWebGPUPixelSpaceCallbackMapper");po("vtkPixelSpaceCallbackMapper",Sge);var p2={exports:{}};p2.exports;(function(t,e){var n=200,r="__lodash_hash_undefined__",i=9007199254740991,a="[object Arguments]",o="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",C="[object Object]",x="[object Promise]",T="[object RegExp]",_="[object Set]",y="[object String]",w="[object Symbol]",b="[object WeakMap]",M="[object ArrayBuffer]",I="[object DataView]",A="[object Float32Array]",k="[object Float64Array]",U="[object Int8Array]",B="[object Int16Array]",z="[object Int32Array]",K="[object Uint8Array]",J="[object Uint8ClampedArray]",X="[object Uint16Array]",re="[object Uint32Array]",fe=/[\\^$.*+?()[\]{}|]/g,pe=/\w*$/,ie=/^\[object .+?Constructor\]$/,te=/^(?:0|[1-9]\d*)$/,ee={};ee[a]=ee[o]=ee[M]=ee[I]=ee[s]=ee[l]=ee[A]=ee[k]=ee[U]=ee[B]=ee[z]=ee[h]=ee[p]=ee[C]=ee[T]=ee[_]=ee[y]=ee[w]=ee[K]=ee[J]=ee[X]=ee[re]=!0,ee[c]=ee[d]=ee[b]=!1;var we=typeof Or=="object"&&Or&&Or.Object===Object&&Or,Ce=typeof self=="object"&&self&&self.Object===Object&&self,De=we||Ce||Function("return this")(),Re=e&&!e.nodeType&&e,Oe=Re&&!0&&t&&!t.nodeType&&t,Ve=Oe&&Oe.exports===Re;function Ge(Te,$e){return Te.set($e[0],$e[1]),Te}function qe(Te,$e){return Te.add($e),Te}function Be(Te,$e){for(var nt=-1,Pt=Te?Te.length:0;++nt<Pt&&$e(Te[nt],nt,Te)!==!1;);return Te}function ae(Te,$e){for(var nt=-1,Pt=$e.length,Qr=Te.length;++nt<Pt;)Te[Qr+nt]=$e[nt];return Te}function H(Te,$e,nt,Pt){for(var Qr=-1,Zn=Te?Te.length:0;++Qr<Zn;)nt=$e(nt,Te[Qr],Qr,Te);return nt}function ce(Te,$e){for(var nt=-1,Pt=Array(Te);++nt<Te;)Pt[nt]=$e(nt);return Pt}function se(Te,$e){return Te==null?void 0:Te[$e]}function he(Te){var $e=!1;if(Te!=null&&typeof Te.toString!="function")try{$e=!!(Te+"")}catch{}return $e}function ve(Te){var $e=-1,nt=Array(Te.size);return Te.forEach(function(Pt,Qr){nt[++$e]=[Qr,Pt]}),nt}function ye(Te,$e){return function(nt){return Te($e(nt))}}function Ae(Te){var $e=-1,nt=Array(Te.size);return Te.forEach(function(Pt){nt[++$e]=Pt}),nt}var Ue=Array.prototype,Je=Function.prototype,et=Object.prototype,lt=De["__core-js_shared__"],_t=function(){var Te=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||"");return Te?"Symbol(src)_1."+Te:""}(),nn=Je.toString,Ot=et.hasOwnProperty,ft=et.toString,_n=RegExp("^"+nn.call(Ot).replace(fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=Ve?De.Buffer:void 0,Gt=De.Symbol,Vt=De.Uint8Array,wt=ye(Object.getPrototypeOf,Object),Fe=Object.create,Qe=et.propertyIsEnumerable,ze=Ue.splice,je=Object.getOwnPropertySymbols,rt=Se?Se.isBuffer:void 0,dt=ye(Object.keys,Object),ht=ur(De,"DataView"),mt=ur(De,"Map"),At=ur(De,"Promise"),kn=ur(De,"Set"),Kn=ur(De,"WeakMap"),Xt=ur(Object,"create"),j=Ar(ht),zi=Ar(mt),$=Ar(At),Xe=Ar(kn),it=Ar(Kn),Qt=Gt?Gt.prototype:void 0,Q=Qt?Qt.valueOf:void 0;function Rr(Te){var $e=-1,nt=Te?Te.length:0;for(this.clear();++$e<nt;){var Pt=Te[$e];this.set(Pt[0],Pt[1])}}function ws(){this.__data__=Xt?Xt(null):{}}function Xu(Te){return this.has(Te)&&delete this.__data__[Te]}function hd(Te){var $e=this.__data__;if(Xt){var nt=$e[Te];return nt===r?void 0:nt}return Ot.call($e,Te)?$e[Te]:void 0}function cr(Te){var $e=this.__data__;return Xt?$e[Te]!==void 0:Ot.call($e,Te)}function Cc(Te,$e){var nt=this.__data__;return nt[Te]=Xt&&$e===void 0?r:$e,this}Rr.prototype.clear=ws,Rr.prototype.delete=Xu,Rr.prototype.get=hd,Rr.prototype.has=cr,Rr.prototype.set=Cc;function si(Te){var $e=-1,nt=Te?Te.length:0;for(this.clear();++$e<nt;){var Pt=Te[$e];this.set(Pt[0],Pt[1])}}function cl(){this.__data__=[]}function ul(Te){var $e=this.__data__,nt=jo($e,Te);if(nt<0)return!1;var Pt=$e.length-1;return nt==Pt?$e.pop():ze.call($e,nt,1),!0}function fl(Te){var $e=this.__data__,nt=jo($e,Te);return nt<0?void 0:$e[nt][1]}function Go(Te){return jo(this.__data__,Te)>-1}function Yu(Te,$e){var nt=this.__data__,Pt=jo(nt,Te);return Pt<0?nt.push([Te,$e]):nt[Pt][1]=$e,this}si.prototype.clear=cl,si.prototype.delete=ul,si.prototype.get=fl,si.prototype.has=Go,si.prototype.set=Yu;function Jr(Te){var $e=-1,nt=Te?Te.length:0;for(this.clear();++$e<nt;){var Pt=Te[$e];this.set(Pt[0],Pt[1])}}function oa(){this.__data__={hash:new Rr,map:new(mt||si),string:new Rr}}function xc(Te){return sn(this,Te).delete(Te)}function Ju(Te){return sn(this,Te).get(Te)}function Zu(Te){return sn(this,Te).has(Te)}function zo(Te,$e){return sn(this,Te).set(Te,$e),this}Jr.prototype.clear=oa,Jr.prototype.delete=xc,Jr.prototype.get=Ju,Jr.prototype.has=Zu,Jr.prototype.set=zo;function Di(Te){this.__data__=new si(Te)}function sa(){this.__data__=new si}function mo(Te){return this.__data__.delete(Te)}function vo(Te){return this.__data__.get(Te)}function yo(Te){return this.__data__.has(Te)}function Wo(Te,$e){var nt=this.__data__;if(nt instanceof si){var Pt=nt.__data__;if(!mt||Pt.length<n-1)return Pt.push([Te,$e]),this;nt=this.__data__=new Jr(Pt)}return nt.set(Te,$e),this}Di.prototype.clear=sa,Di.prototype.delete=mo,Di.prototype.get=vo,Di.prototype.has=yo,Di.prototype.set=Wo;function Sc(Te,$e){var nt=Ht(Te)||Un(Te)?ce(Te.length,String):[],Pt=nt.length,Qr=!!Pt;for(var Zn in Te)Ot.call(Te,Zn)&&!(Qr&&(Zn=="length"||an(Zn,Pt)))&&nt.push(Zn);return nt}function mr(Te,$e,nt){var Pt=Te[$e];(!(Ot.call(Te,$e)&&fn(Pt,nt))||nt===void 0&&!($e in Te))&&(Te[$e]=nt)}function jo(Te,$e){for(var nt=Te.length;nt--;)if(fn(Te[nt][0],$e))return nt;return-1}function Cs(Te,$e){return Te&&St($e,md($e),Te)}function Sa(Te,$e,nt,Pt,Qr,Zn,Ea){var bi;if(Pt&&(bi=Zn?Pt(Te,Qr,Zn,Ea):Pt(Te)),bi!==void 0)return bi;if(!Nt(Te))return Te;var Wi=Ht(Te);if(Wi){if(bi=tr(Te),!$e)return tt(Te,bi)}else{var Ss=Zr(Te),vd=Ss==d||Ss==f;if(Gy(Te))return e0(Te,$e);if(Ss==C||Ss==a||vd&&!Zn){if(he(Te))return Zn?Te:{};if(bi=xs(vd?{}:Te),!$e)return Ut(Te,Cs(bi,Te))}else{if(!ee[Ss])return Zn?Te:{};bi=t0(Te,Ss,Sa,$e)}}Ea||(Ea=new Di);var ji=Ea.get(Te);if(ji)return ji;if(Ea.set(Te,bi),!Wi)var Ta=nt?Yt(Te):md(Te);return Be(Ta||Te,function(pi,n0){Ta&&(n0=pi,pi=Te[n0]),mr(bi,n0,Sa(pi,$e,nt,Pt,n0,Te,Ea))}),bi}function Ec(Te){return Nt(Te)?Fe(Te):{}}function Ua(Te,$e,nt){var Pt=$e(Te);return Ht(Te)?Pt:ae(Pt,nt(Te))}function Qu(Te){return ft.call(Te)}function Tc(Te){if(!Nt(Te)||Pn(Te))return!1;var $e=pd(Te)||he(Te)?_n:ie;return $e.test(Ar(Te))}function Ba(Te){if(!ar(Te))return dt(Te);var $e=[];for(var nt in Object(Te))Ot.call(Te,nt)&&nt!="constructor"&&$e.push(nt);return $e}function e0(Te,$e){if($e)return Te.slice();var nt=new Te.constructor(Te.length);return Te.copy(nt),nt}function Ho(Te){var $e=new Te.constructor(Te.byteLength);return new Vt($e).set(new Vt(Te)),$e}function vr(Te,$e){var nt=$e?Ho(Te.buffer):Te.buffer;return new Te.constructor(nt,Te.byteOffset,Te.byteLength)}function _c(Te,$e,nt){var Pt=$e?nt(ve(Te),!0):ve(Te);return H(Pt,Ge,new Te.constructor)}function Dc(Te){var $e=new Te.constructor(Te.source,pe.exec(Te));return $e.lastIndex=Te.lastIndex,$e}function Ke(Te,$e,nt){var Pt=$e?nt(Ae(Te),!0):Ae(Te);return H(Pt,qe,new Te.constructor)}function dl(Te){return Q?Object(Q.call(Te)):{}}function ke(Te,$e){var nt=$e?Ho(Te.buffer):Te.buffer;return new Te.constructor(nt,Te.byteOffset,Te.length)}function tt(Te,$e){var nt=-1,Pt=Te.length;for($e||($e=Array(Pt));++nt<Pt;)$e[nt]=Te[nt];return $e}function St(Te,$e,nt,Pt){nt||(nt={});for(var Qr=-1,Zn=$e.length;++Qr<Zn;){var Ea=$e[Qr],bi=void 0;mr(nt,Ea,bi===void 0?Te[Ea]:bi)}return nt}function Ut(Te,$e){return St(Te,Jn(Te),$e)}function Yt(Te){return Ua(Te,md,Jn)}function sn(Te,$e){var nt=Te.__data__;return Jt($e)?nt[typeof $e=="string"?"string":"hash"]:nt.map}function ur(Te,$e){var nt=se(Te,$e);return Tc(nt)?nt:void 0}var Jn=je?ye(je,Object):bp,Zr=Qu;(ht&&Zr(new ht(new ArrayBuffer(1)))!=I||mt&&Zr(new mt)!=h||At&&Zr(At.resolve())!=x||kn&&Zr(new kn)!=_||Kn&&Zr(new Kn)!=b)&&(Zr=function(Te){var $e=ft.call(Te),nt=$e==C?Te.constructor:void 0,Pt=nt?Ar(nt):void 0;if(Pt)switch(Pt){case j:return I;case zi:return h;case $:return x;case Xe:return _;case it:return b}return $e});function tr(Te){var $e=Te.length,nt=Te.constructor($e);return $e&&typeof Te[0]=="string"&&Ot.call(Te,"index")&&(nt.index=Te.index,nt.input=Te.input),nt}function xs(Te){return typeof Te.constructor=="function"&&!ar(Te)?Ec(wt(Te)):{}}function t0(Te,$e,nt,Pt){var Qr=Te.constructor;switch($e){case M:return Ho(Te);case s:case l:return new Qr(+Te);case I:return vr(Te,Pt);case A:case k:case U:case B:case z:case K:case J:case X:case re:return ke(Te,Pt);case h:return _c(Te,Pt,nt);case p:case y:return new Qr(Te);case T:return Dc(Te);case _:return Ke(Te,Pt,nt);case w:return dl(Te)}}function an(Te,$e){return $e=$e??i,!!$e&&(typeof Te=="number"||te.test(Te))&&Te>-1&&Te%1==0&&Te<$e}function Jt(Te){var $e=typeof Te;return $e=="string"||$e=="number"||$e=="symbol"||$e=="boolean"?Te!=="__proto__":Te===null}function Pn(Te){return!!_t&&_t in Te}function ar(Te){var $e=Te&&Te.constructor,nt=typeof $e=="function"&&$e.prototype||et;return Te===nt}function Ar(Te){if(Te!=null){try{return nn.call(Te)}catch{}try{return Te+""}catch{}}return""}function Ga(Te){return Sa(Te,!0,!0)}function fn(Te,$e){return Te===$e||Te!==Te&&$e!==$e}function Un(Te){return gd(Te)&&Ot.call(Te,"callee")&&(!Qe.call(Te,"callee")||ft.call(Te)==a)}var Ht=Array.isArray;function Bn(Te){return Te!=null&&Dp(Te.length)&&!pd(Te)}function gd(Te){return zy(Te)&&Bn(Te)}var Gy=rt||Wy;function pd(Te){var $e=Nt(Te)?ft.call(Te):"";return $e==d||$e==f}function Dp(Te){return typeof Te=="number"&&Te>-1&&Te%1==0&&Te<=i}function Nt(Te){var $e=typeof Te;return!!Te&&($e=="object"||$e=="function")}function zy(Te){return!!Te&&typeof Te=="object"}function md(Te){return Bn(Te)?Sc(Te):Ba(Te)}function bp(){return[]}function Wy(){return!1}t.exports=Ga})(p2,p2.exports);var Ege=p2.exports;const Oo=Hf(Ege);function $U(t){const{enableCacheOptimization:e}=vs(),n=$u();e&&n&&Hn.addEventListenerOnce(xt.IMAGE_VOLUME_LOADING_COMPLETED,i=>{if(i.detail.volumeId!==t)return;const a=bt.getVolume(t);zT(a)})}function zT(t){if(!(t instanceof pp))return;const e=t.getScalarData();t.imageCacheOffsetMap.size>0?Tge(t,e):_ge(t,e)}function Tge(t,e){t.imageCacheOffsetMap.forEach(({offset:n},r)=>{const i=bt.getImage(r);i&&(KU(i,e,n),bt.decrementImageCacheSize(i.sizeInBytes))})}function _ge(t,e){var o;let n=e;const r=t.imageIds.find(s=>bt.getImage(s));if(!r)return;const i=bt.getImage(r),a=((o=i.imageFrame)==null?void 0:o.pixelData)||i.getPixelData();e.constructor!==a.constructor&&(n=new a.constructor(e.length),n.set(e)),t.imageIds.forEach(s=>{const l=bt.getImage(s);if(!l)return;const d=t.getImageIdIndex(s)*l.getPixelData().byteLength;KU(l,n,d),bt.decrementImageCacheSize(l.sizeInBytes)})}function KU(t,e,n){const r=t.imageFrame?t.imageFrame.pixelData:t.getPixelData(),i=new r.constructor(e.buffer,n,r.length);t.getPixelData=()=>i,t.imageFrame&&(t.imageFrame.pixelData=i),t.bufferView={buffer:e.buffer,offset:n}}const Dge=Object.freeze(Object.defineProperty({__proto__:null,performCacheOptimizationForVolume:zT,setupCacheOptimizationEventListener:$U},Symbol.toStringTag,{value:"Module"}));function bge(t,e,n){const r=Bt.newInstance({name:"Pixels",values:e,...n});t.getPointData().setScalars(r)}function Ige(t,e,n){e.forEach((r,i)=>{const a=Bt.newInstance({name:`timePoint-${i}`,values:r,...n});t.getPointData().addArray(a)}),t.getPointData().setActiveScalars("timePoint-0")}function qU(t){const{dimensions:e,metadata:n,spacing:r,direction:i,origin:a}=t,{PhotometricInterpretation:o}=n;let s=1;o==="RGB"&&(s=3);const l=yc.newInstance(),c={numberOfComponents:s};if(l.setDimensions(e),l.setSpacing(r),l.setDirection(i),l.setOrigin(a),t.isDynamicVolume()){const d=t.getScalarDataArrays();Ige(l,d,c)}else{const d=t.getScalarData();bge(l,d,c)}return l}const WT={};let Ef;function XU(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=WT[r];if(i==null){if(Ef==null||typeof Ef!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=Ef}const a=i(t,e);return $U(t),a.promise.then(function(o){Kt(Hn,xt.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};Kt(Hn,xt.VOLUME_LOADED_FAILED,s)}),a}function jT(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=bt.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=XU(t,e),n.promise.then(r=>(r.imageData=qU(r),r)))}async function ky(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=bt.getVolumeLoadObject(t);return n!==void 0||(n=XU(t,e),n.promise.then(r=>{r.imageData=qU(r)}),bt.putVolumeLoadObject(t,n).catch(r=>{throw r})),n.promise}async function YU(t,e){const n=bt.getVolume(t);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:r}=e;const{targetBuffer:i}=e;r===void 0&&(r=pc());const{metadata:a,dimensions:o,spacing:s,origin:l,direction:c}=n,f=n.getScalarData().length,{volumeScalarData:h,numBytes:p}=tB(i,f),C=Bt.newInstance({name:"Pixels",numberOfComponents:1,values:h}),x=yc.newInstance();x.setDimensions(o),x.setSpacing(s),x.setDirection(c),x.setOrigin(l),x.getPointData().setScalars(C);const T=new gp({volumeId:r,metadata:Oo(a),dimensions:[o[0],o[1],o[2]],spacing:s,origin:l,direction:c,imageData:x,scalarData:h,sizeInBytes:p,imageIds:[],referencedVolumeId:t}),_={promise:Promise.resolve(T)};return await bt.putVolumeLoadObject(r,_),T}function JU(t,e,n=!1){const{metadata:r,dimensions:i,spacing:a,origin:o,direction:s,targetBuffer:l}=t;let{scalarData:c}=t;const d=["Uint8Array","Float32Array","Uint16Array","Int16Array"],f=i[0]*i[1]*i[2];if(!c||!d.includes(c.constructor.name)){if(!(l!=null&&l.type)||!d.includes(l.type))throw new Error("createLocalVolume: parameter scalarData must be provided and must be either Uint8Array, Float32Array, Uint16Array or Int16Array");({volumeScalarData:c}=tB(l,f))}e===void 0&&(e=pc());const h=bt.getVolume(e);if(h)return h;const p=c?c.buffer.byteLength:f*4;if(!bt.isCacheable(p))throw new Error(xt.CACHE_SIZE_EXCEEDED);const x=Bt.newInstance({name:"Pixels",numberOfComponents:1,values:c}),T=yc.newInstance();T.setDimensions(i),T.setSpacing(a),T.setDirection(s),T.setOrigin(o),T.getPointData().setScalars(x);const _=new gp({volumeId:e,metadata:Oo(r),dimensions:[i[0],i[1],i[2]],spacing:a,origin:o,direction:s,imageData:T,scalarData:c,sizeInBytes:p,referencedImageIds:t.referencedImageIds||[],referencedVolumeId:t.referencedVolumeId,imageIds:t.imageIds||[]});if(n)return _;const y={promise:Promise.resolve(_)};return bt.putVolumeLoadObject(e,y),_}async function Oge(t,e,n={}){const{preventCache:r=!1}=n;if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const i=bt.getVolume(t);if(i)return Promise.resolve(i);const a=RB(e,t),o=a.imageIds.map((c,d)=>bt.getImageLoadObject(c).promise.then(h=>{const p=h.getPixelData(),C=d*h.rows*h.columns;a.scalarData.set(p,C)}));await Promise.all(o);const s=new gp({...a,referencedImageIds:e,...n});zT(s);const l={promise:Promise.resolve(s)};return r||bt.putVolumeLoadObject(t,l),l.promise}function ZU(t,e){WT[t]=e}function QU(){return Object.keys(WT)}function Mge(t){const e=Ef;return Ef=t,e}function eB(){return Ef.name}async function Nge(t,e={}){return YU(t,{...e,targetBuffer:{type:"Uint8Array"}})}async function Rge(t,e,n=!1){return t.scalarData||(t.scalarData=new Uint8Array(t.dimensions[0]*t.dimensions[1]*t.dimensions[2])),JU(t,e,n)}function tB(t,e){const{useNorm16Texture:n}=vs().rendering,{TypedArrayConstructor:r,numBytes:i}=Vy(t==null?void 0:t.type,e,{use16BitTexture:n,isVolumeBuffer:!0});if(!bt.isCacheable(i))throw new Error(xt.CACHE_SIZE_EXCEEDED);let o;if((t==null?void 0:t.sharedArrayBuffer)??$u())switch(t.type){case"Float32Array":o=eg(e);break;case"Uint8Array":o=e2(e);break;case"Uint16Array":o=t2(e);break;case"Int16Array":o=t2(e);break;default:throw new Error("generateVolumeScalarData: SharedArrayBuffer is not supported for the specified target buffer type")}else o=new r(e);return{volumeScalarData:o,numBytes:i}}const Age=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheDerivedSegmentationVolume:Nge,createAndCacheDerivedVolume:YU,createAndCacheVolume:ky,createAndCacheVolumeFromImages:Oge,createLocalSegmentationVolume:Rge,createLocalVolume:JU,getUnknownVolumeLoaderSchema:eB,getVolumeLoaderSchemes:QU,loadVolume:jT,registerUnknownVolumeLoader:Mge,registerVolumeLoader:ZU},Symbol.toStringTag,{value:"Module"})),nB=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},Lge=1+sc,kge=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),jO=t=>!!QU().find(e=>kge(t.volumeId,e));function HT(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a||!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o=a.map(c=>{const d=c.referenceId??c.uid;return bt.getVolume(d)}).filter(c=>!!c);if(n){const c=nB(n),d=o.findIndex(C=>c.includes(C.volumeId)),f=o[d],{uid:h}=a[d],p=HO(f,i,t,r);return{imageVolume:f,spacingInNormalDirection:p,actorUID:h}}if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},l=o.find(jO);for(let c=0;c<o.length;c++){const d=o[c];if(l&&!jO(d))continue;const f=HO(d,i,t);f*Lge<s.spacingInNormalDirection&&(s.spacingInNormalDirection=f,s.imageVolume=d,s.actorUID=a[c].uid)}return s}function HO(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||r===!1)&&(a=Vg(t,e)),a}function rB(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}function Pge(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function Fge(t,e){let n;e?n=[mc(e)]:n=Hu();const r=[];return n.forEach(i=>{const a=t.getActors(),o=i.getVolumeViewports();for(const s of o){const l=s.getActors();if(l.length!==a.length)continue;a.every(({uid:d})=>l.find(f=>d===f.uid))&&r.push(s)}}),r}function Vge(t,e){let n;e?n=[mc(e)]:n=Hu();const r=[];return n.forEach(i=>{const o=i.getVolumeViewports().filter(s=>s.hasVolumeId(t));r.push(...o)}),r}function $T(t,e){return t.worldToIndex(e).map(Math.round)}function iB(t,e){return t.indexToWorld(e)}const ho=new HE("imageLoadPool");ho.grabDelay=0;ho.setMaxSimultaneousRequests(Tr.Interaction,1e3);ho.setMaxSimultaneousRequests(Tr.Thumbnail,1e3);ho.setMaxSimultaneousRequests(Tr.Prefetch,1e3);const m2={};let Ug;function $O(t,e){const n=t.indexOf(":"),r=t.substring(0,n),i=m2[r];if(i==null){if(Ug!==void 0)return Ug(t);throw new Error("loadImageFromImageLoader: no image loader for imageId")}const a=i(t,e);return a.promise.then(function(o){Kt(Hn,xt.IMAGE_LOADED,{image:o})},function(o){const s={imageId:t,error:o};Kt(Hn,xt.IMAGE_LOAD_FAILED,s)}),a}function aB(t,e){var a,o;if(e.ignoreCache)return $O(t,e);let n=bt.getImageLoadObject(t);if(n!==void 0)return n;const r=bt.getVolumeContainingImageId(t);if((o=(a=r==null?void 0:r.volume)==null?void 0:a.loadStatus)!=null&&o.loaded){const{volume:s,imageIdIndex:l}=r;return s instanceof pp&&(n=s.convertToCornerstoneImage(t,l)),n}const i=bt.getCachedImageBasedOnImageURI(t);return i?(n=i.imageLoadObject,n):(n=$O(t,e),n)}function Uge(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return aB(t,e).promise}function Vu(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=aB(t,e);return bt.getImageLoadObject(t)||bt.putImageLoadObject(t,n).catch(r=>{console.warn(r)}),n.promise}function Bge(t,e={priority:0,requestType:"prefetch"}){if(!t||t.length===0)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return t.map(r=>Vu(r,e))}function KT(t,e={},n=!1){if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${pc()}`);const{imageId:r,skipCreateBuffer:i,onCacheAdd:a}=e,o=tn("imagePlaneModule",t),s=o.rows*o.columns,{TypedArrayConstructor:l}=Vy(e.targetBufferType,s),c=new l(i?1:s),d=r;["imagePlaneModule","generalSeriesModule"].forEach(C=>{x2.add(d,{type:C,metadata:tn(C,t)})});const f=tn("imagePixelModule",t);x2.add(d,{type:"imagePixelModule",metadata:{...f,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const h=sB({scalarData:c,onCacheAdd:a,skipCreateBuffer:i},r,!0),p={promise:Promise.resolve(h)};return n||bt.putImageLoadObject(d,p),p.promise}function oB(t,e={}){if((t==null?void 0:t.length)===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[],r=t.map(i=>{var o;const a={imageId:((o=e.getDerivedImageId)==null?void 0:o.call(e,i))||`derived:${pc()}`,...e};return n.push(a.imageId),KT(i,a)});return{imageIds:n,promises:r}}function sB(t,e,n=!1){var s;const r=tn("imagePlaneModule",e),i=r.rows*r.columns,a={imageId:e,intercept:0,windowCenter:0,windowWidth:0,color:!1,numComps:1,slope:1,minPixelValue:0,maxPixelValue:255,voiLUTFunction:void 0,rows:r.rows,columns:r.columns,getCanvas:void 0,height:r.rows,width:r.columns,rgba:void 0,columnPixelSpacing:r.columnPixelSpacing,rowPixelSpacing:r.rowPixelSpacing,invert:!1};if(t.scalarData){const l=t.scalarData;if(!(l instanceof Uint8Array||l instanceof Float32Array||l instanceof Uint16Array||l instanceof Int16Array))throw new Error("To use createLocalVolume you should pass scalarData of type Uint8Array, Uint16Array, Int16Array or Float32Array");a.sizeInBytes=l.byteLength,a.getPixelData=()=>l}else if(t.skipCreateBuffer!==!0){const{numBytes:l,TypedArrayConstructor:c}=Vy(t.targetBufferType,i),d=new c(i);a.sizeInBytes=l,a.getPixelData=()=>d}(s=t.onCacheAdd)==null||s.call(t,a);const o={promise:Promise.resolve(a)};return n||bt.putImageLoadObject(a.imageId,o),a}function lB(t){const e=({additionalDetails:r})=>r.imageId?r.imageId!==t:!0;ho.filterRequests(e);const n=bt.getImageLoadObject(t);n&&n.cancelFn()}function Gge(t){t.forEach(e=>lB(e))}function zge(){const t=ho.getRequestPool();Object.keys(t).forEach(e=>{const n=t[e];Object.keys(n).forEach(r=>{const a=n[r].pop().additionalDetails,{imageId:o,volumeId:s}=a;let l;o?l=bt.getImageLoadObject(o):s&&(l=bt.getVolumeLoadObject(s)),l&&l.cancel()}),ho.clearRequestStack(e)})}function cB(t,e){m2[t]=e}function Wge(t){const e=Ug;return Ug=t,e}function jge(){Object.keys(m2).forEach(t=>delete m2[t]),Ug=void 0}function Hge(t,e={targetBufferType:"Uint8Array"}){return oB(t,e)}function $ge(t,e={targetBufferType:"Uint8Array"}){return KT(t,e)}const Kge=Object.freeze(Object.defineProperty({__proto__:null,cancelLoadAll:zge,cancelLoadImage:lB,cancelLoadImages:Gge,createAndCacheDerivedImage:KT,createAndCacheDerivedImages:oB,createAndCacheDerivedSegmentationImage:$ge,createAndCacheDerivedSegmentationImages:Hge,createAndCacheLocalImage:sB,loadAndCacheImage:Vu,loadAndCacheImages:Bge,loadImage:Uge,registerImageLoader:cB,registerUnknownImageLoader:Wge,unregisterAllImageLoaders:jge},Symbol.toStringTag,{value:"Module"})),uB="viewport-element",fB="cornerstone-canvas",v2=1e-4;function qge(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(fB),t.appendChild(e),e}function Xge(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(uB),t.appendChild(e),e}function os(t){const e=`canvas.${fB}`,n=`div.${uB}`,r=t.querySelector(n)||Xge(t),i=r.querySelector(e)||qge(r),a=r.getBoundingClientRect(),o=window.devicePixelRatio||1,s=Math.ceil(a.width*o),l=Math.ceil(a.height*o);return i.width=s,i.height=l,i.style.width=(s+v2)/o+"px",i.style.height=(l+v2)/o+"px",i}const dB=t=>{var e,n;return((e=t.preScale)==null?void 0:e.scaled)&&((n=t.preScale.scalingParameters)==null?void 0:n.suvbw)};function hB(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,o=!a&&e,s=a&&e,c=`renderGPUViewport-${(o==null?void 0:o.imageId)||(s==null?void 0:s.volumeId)}`,d=document.createElement("div"),f=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const h=t.width,p=t.height;d.style.width=`${h/f+v2}px`,d.style.height=`${p/f+v2}px`,d.style.visibility="hidden",d.style.position="absolute",document.body.appendChild(d);const C=c.split(":").join("-");d.setAttribute("viewport-id-for-remove",C);const x=os(d),T=mc(r)||new _2(r);let _=T.getViewport(c);if(!_){const y={viewportId:c,type:a?dr.ORTHOGRAPHIC:dr.STACK,element:d,defaultOptions:{...i,suppressEvents:!0}};T.enableElement(y),_=T.getViewport(c)}return new Promise(y=>{let w=!1,{viewReference:b}=i;const M=I=>{if(w)return;if(b){const K=b;b=null,_.setViewReference(K),_.render();return}t.getContext("2d").drawImage(x,0,0,x.width,x.height,0,0,t.width,t.height);const k=_.canvasToWorld([0,0]),U=_.canvasToWorld([x.width/f,0]),B=_.canvasToWorld([0,x.height/f]),z=1;w=!0,d.removeEventListener(xt.IMAGE_RENDERED,M),setTimeout(()=>{T.disableElement(c),document.querySelectorAll(`[viewport-id-for-remove="${C}"]`).forEach(J=>{J.remove()})},0),y({origin:k,bottomLeft:B,topRight:U,thicknessMm:z})};d.addEventListener(xt.IMAGE_RENDERED,M),a?_.setVolumes([s],!1,!0):_.renderImageObject(e),_.resetCamera(),n==="PT"&&!dB(o)&&_.setProperties({voiRange:{lower:o.minPixelValue,upper:o.maxPixelValue}}),_.render()})}const Yge={viewport:{}};function Jge(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function Zge(){const t=Jge();return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t},Yge.viewport)}function ag(t,e){if(t==null)throw new Error(e)}function Qge(t){return!(t==null||t===0||t===180)}function gB(t,e=null){return ag(t,"getImageSize: parameter image must not be undefined"),ag(t.width,"getImageSize: parameter image must have width"),ag(t.height,"getImageSize: parameter image must have height"),Qge(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function qT(t,e,n=null){ag(t,"getImageScale: parameter canvas must not be undefined"),ag(e,"getImageScale: parameter image must not be undefined");const r=gB(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let o=1,s=1;i<a?s=a/i:o=i/a;const l=t.height/r.height/o,c=t.width/r.width/s;return{verticalScale:l,horizontalScale:c,scaleFactor:Math.min(c,l)}}function pB(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return Zge();const i=qT(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}class rd{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new rd;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function Bg(t,e){const n=new rd;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const l=t.canvas.height/(s*a),c=t.canvas.width/(o*i);i=a=Math.min(c,l),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function wn(){return window.performance?performance.now():Date.now()}function epe(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function tpe(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=a?i:t.lut[o-t.firstValueMapped]>>n}}function mB(t,e,n){return n?tpe(n):epe(t,e)}function npe(t,e,n,r,i){const a=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const d=a-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(d)}const l=t.cachedLut.lutArray,c=mB(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r===!0)for(let d=o;d<=a;d++)l[d+-s]=255-c(d);else for(let d=o;d<=a;d++)l[d+-s]=c(d);return l}function rpe(t,e,n){let r=wn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-r;const a=t.minPixelValue;let o=0,s=0;const l=i.length;if(r=wn(),a<0)for(;s<l;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o]=e[i[s]+-a],s+=2,o+=2;else for(;s<l;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o]=e[i[s]],s+=2,o+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-r}function ipe(t,e,n){let r=wn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-r;const a=t.minPixelValue;let o=0,s=0;const l=i.length;if(r=wn(),a<0)for(;s<l;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=i[s++];else for(;s<l;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-r}function XT(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=Bg(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function YT(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function y2(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function JT(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function ape(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(npe(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function ope(t,e,n){const r=t.renderingTools.lastRenderedIsColor===!0;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:o}=t.viewport.voi;if((a===256||a===255)&&(o===128||o===127)&&t.viewport.invert===!1&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(YT(t,e)===!1&&n!==!0)return i;(i.width!==e.width||i.height!==e.height)&&y2(t,e);let s=wn();const l=ape(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=wn()-s;const c=t.renderingTools.renderCanvasData,d=t.renderingTools.renderCanvasContext;return e.rgba?ipe(e,l,c.data):rpe(e,l,c.data),s=wn(),d.putImageData(c,0,0),e.stats.lastPutImageDataTime=wn()-s,i}function spe(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,XT(t,r);const i=ope(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,l=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,l,0,0,s,l),t.renderingTools=JT(t)}function lpe(t,e,n){let r=wn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-r;const a=i.length,o=t.minPixelValue;let s=3,l=0;if(r=wn(),i instanceof Int16Array)if(o<0)for(;l<a;)n[s]=e[i[l++]+-o],s+=4;else for(;l<a;)n[s]=e[i[l++]],s+=4;else if(i instanceof Uint16Array)for(;l<a;)n[s]=e[i[l++]],s+=4;else if(o<0)for(;l<a;)n[s]=e[i[l++]+-o],s+=4;else for(;l<a;)n[s]=e[i[l++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-r}function cpe(t,e,n){let r=wn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-r;const a=i.length;let o=3,s=0;for(r=wn();s<a;)n[o]=e(i[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-r}function upe(t,e,n){let r=wn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-r;const a=i.length,o=t.minPixelValue;let s=0,l=0,c;if(r=wn(),i instanceof Int16Array)if(o<0)for(;l<a;)c=e[i[l++]+-o],n[s++]=c,n[s++]=c,n[s++]=c,n[s++]=255;else for(;l<a;)c=e[i[l++]],n[s++]=c,n[s++]=c,n[s++]=c,n[s++]=255;else if(i instanceof Uint16Array)for(;l<a;)c=e[i[l++]],n[s++]=c,n[s++]=c,n[s++]=c,n[s++]=255;else if(o<0)for(;l<a;)c=e[i[l++]+-o],n[s++]=c,n[s++]=c,n[s++]=c,n[s++]=255;else for(;l<a;)c=e[i[l++]],n[s++]=c,n[s++]=c,n[s++]=c,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-r}function fpe(t,e){if(dpe(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function dpe(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function KO(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function hpe(t,e){return n=>n*t+e}function gpe(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function ppe(t,e,n){return n?gpe(n):hpe(t,e)}function mpe(t,e,n,r,i,a){const o=t.maxPixelValue,s=t.minPixelValue,l=Math.min(s,0);if(t.cachedLut===void 0){const h=o-l+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(h)}const c=t.cachedLut.lutArray,d=ppe(t.slope,t.intercept,i),f=mB(e,n,a);if(t.isPreScaled)if(r===!0)for(let h=s;h<=o;h++)c[h+-l]=255-f(h);else for(let h=s;h<=o;h++)c[h+-l]=f(h);else if(r===!0)for(let h=s;h<=o;h++)c[h+-l]=255-f(d(h));else for(let h=s;h<=o;h++)c[h+-l]=f(d(h));return c}function vB(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&KO(t.cachedLut.modalityLUT,e.modalityLUT)&&KO(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&n!==!0||(fpe(e,t),mpe(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function vpe(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor===!0;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),y2(t,e));const a=t.renderingTools.renderCanvas;if(YT(t,e)===!1&&n!==!0)return a;(a.width!==e.width||a.height!==e.height)&&y2(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let l=wn();e.stats.lastLutGenerateTime=wn()-l;const{viewport:c}=t;if(c.modality==="PT"&&e.isPreScaled){const{windowWidth:d,windowCenter:f}=c.voi,h=f-d/2,x=255/(f+d/2-h);let T;c.invert?T=_=>255-(_-h)*x:T=_=>(_-h)*x,cpe(e,T,o.data)}else{const d=vB(e,c,n);r?lpe(e,d,o.data):upe(e,d,o.data)}return l=wn(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=wn()-l,a}function ype(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,XT(t,r);const i=vpe(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,l=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,l,0,0,s,l),t.renderingTools=JT(t)}const Nx=0,Rx=1,wpe=2;function Cpe(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,o=n*(1-e),s=n*(1-e*a),l=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=l,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=l;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=l,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function xpe(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+Nx+1.5:t>e.Range[1]?n=e.MaxIndex+Rx+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class ZT{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=o=0;for(let s=0;s<=n;s++){const l=this.HueRange[0]+s*r,c=this.SaturationRange[0]+s*i,d=this.ValueRange[0]+s*a,f=this.AlphaRange[0]+s*o,h=Cpe(l,c,d),p=[0,0,0,0];switch(this.Ramp){case"scurve":p[0]=Math.floor(127.5*(1+Math.cos((1-h[0])*Math.PI))),p[1]=Math.floor(127.5*(1+Math.cos((1-h[1])*Math.PI))),p[2]=Math.floor(127.5*(1+Math.cos((1-h[2])*Math.PI))),p[3]=Math.floor(f*255);break;case"linear":p[0]=Math.floor(h[0]*255+.5),p[1]=Math.floor(h[1]*255+.5),p[2]=Math.floor(h[2]*255+.5),p[3]=Math.floor(f*255+.5);break;case"sqrt":p[0]=Math.floor(Math.sqrt(h[0])*255+.5),p[1]=Math.floor(Math.sqrt(h[1])*255+.5),p[2]=Math.floor(Math.sqrt(h[2])*255+.5),p[3]=Math.floor(Math.sqrt(f)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(p)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+Nx,r=e+Rx,i=e+wpe;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=xpe(e,n);return r===this.NumberOfColors+Nx?r=0:r===this.NumberOfColors+Rx&&(r=this.NumberOfColors-1),r}setTableValue(e,n){if(arguments.length===5&&(n=Array.prototype.slice.call(arguments,1)),e<0)throw new Error(`Can't set the table value for negative index (${e})`);e>=this.NumberOfColors&&new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`),this.Table[e]=n,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const qO=[0,0,0,0];function Spe(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function Epe(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function Tpe(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,o){return a-o}),n=0;n<i;n++)r[n]=Epe(t,e[n]);return r}function O4(t,e,n){let r;const i=[],a=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const d=e[r];i.push((t-1)*d[0]),a.push(d[1]),o.push(d[1])}const l=Spe(0,1,t);for(r=0;r<t;r++)l[r]=(t-1)*Math.pow(l[r],n);const c=Tpe(i,l);for(r=1;r<t-1;r++){const d=c[r],f=(l[r]-i[d-1])/(i[d]-i[d-1]),h=a[d]-o[d-1];s[r]=f*h+o[d-1]}return s[0]=o[0],s[t-1]=a[e.length-1],s}function _pe(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=O4(e,t.red,n),o=O4(e,t.green,n),s=O4(e,t.blue,n);for(r=0;r<e;r++){const l=Math.round(a[r]*255),c=Math.round(o[r]*255),d=Math.round(s[r]*255),f=[l,c,d,255];i.push(f)}return i}function yB(t,e){let n=ox[t];return n||(n=ox[t]=e||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=_pe(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(qO);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:qO},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let o=0;o<a;o++)i.setTableValue(o,n.colors[o])},createLookupTable(){const i=new ZT;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function Dpe(t,e,n,r){let i=wn();const a=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-i;const o=a.length,s=t.minPixelValue;let l=0,c=0,d,f,h;if(i=wn(),n instanceof ZT?h=n.Table:h=n,s<0)for(;c<o;)d=e[a[c++]+-s],f=h[d],r[l++]=f[0],r[l++]=f[1],r[l++]=f[2],r[l++]=f[3];else for(;c<o;)d=e[a[c++]],f=h[d],r[l++]=f[0],r[l++]=f[1],r[l++]=f[2],r[l++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-i}function bpe(t,e,n,r){let i=wn();const a=t.getPixelData();t.stats.lastGetPixelDataTime=wn()-i;const o=a.length,s=t.minPixelValue;let l=0,c=0,d,f,h;if(i=wn(),n instanceof ZT?h=n.Table:h=n,s<0)for(;c<o;)d=e(a[c++]+-s),f=h[d],r[l++]=f[0],r[l++]=f[1],r[l++]=f[2],r[l++]=f[3];else for(;c<o;)d=e(a[c++]),f=h[d],r[l++]=f[0],r[l++]=f[1],r[l++]=f[2],r[l++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=wn()-i}function Ipe(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=yB(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(YT(t,e)===!1&&n!==!0&&t.renderingTools.colormapId===a)return r;(r.width!==e.width||r.height!==e.height)&&y2(t,e);let o=wn();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const s=t.renderingTools.renderCanvasData,l=t.renderingTools.renderCanvasContext,{viewport:c}=t,d=t.renderingTools.colorLUT;if(c.modality==="PT"){const{windowWidth:f,windowCenter:h}=c.voi,p=h-f/2,T=255/(h+f/2-p);let _;c.invert?_=y=>fx(Math.floor(255-(y-p)*T),0,255):_=y=>fx(Math.floor((y-p)*T),0,255),bpe(e,_,d,s.data)}else{const f=vB(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=wn()-o,Dpe(e,f,d,s.data)}return o=wn(),l.putImageData(s,0,0),e.stats.lastPutImageDataTime=wn()-o,r}function Ope(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,XT(t,r);const i=Ipe(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,l=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,l,0,0,s,l),t.renderingTools=JT(t)}function wB(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=wn();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=Ope:n.color?a=spe:a=ype),a(t,e)}const i=wn()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function CB(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=e,s=pB(t,o,n),l={canvas:t,viewport:s,image:o,renderingTools:{}};l.transform=Bg(l);const c=!0;return new Promise((d,f)=>{wB(l,c),d(null)})}function Mpe(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=Tr.Thumbnail,priority:a=-5,renderingEngineId:o="_thumbnails",useCPURendering:s=!1,thumbnail:l=!1,imageAspect:c=!1,viewportOptions:d}=t,f=r==null?void 0:r.volumeId,h=f&&!n,p=r&&d?{...d,viewReference:r}:d,C=s?CB:hB;return new Promise((x,T)=>{function _(I,A){var z;const{modality:k}=tn("generalSeriesModule",A)||{},U=!h&&I,B=h&&I;U&&(U.isPreScaled=U.isPreScaled||((z=U.preScale)==null?void 0:z.scaled)),l&&(e.height=256,e.width=256),c&&U&&(e.width=U&&e.height*U.width/U.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,B&&s&&T(new Error("CPU rendering of volume not supported")),C(e,I,k,o,p).then(x)}function y(I,A){console.error(I,A),T(I)}function w(I,A,k){return Vu(I,k).then(U=>{_.call(this,U,I)},U=>{y.call(this,U,I)})}const{useNorm16Texture:b}=vs().rendering,M={targetBuffer:{type:b?void 0:"Float32Array"},preScale:{enabled:!0},useRGBA:!!s,requestType:i};if(f){const I=bt.getVolume(f);I||T(new Error(`Volume id ${f} not found in cache`));const A=I.imageIds[0];_(I,A)}else ho.addRequest(w.bind(null,n,null,M),i,{imageId:n},a)})}function Npe(t,e){const n=tn("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const l=zt();Li(l,a,r,-o/2),Li(l,l,i,-s/2);const c=zt();ka(c,e,l);const d=er(c,i),f=er(c,r);return[d/s,f/o]}function Rpe(t,e){const n=tn("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const l=zt();return Li(l,a,i,s*(e[0]-.5)),Li(l,l,r,o*(e[1]-.5)),Array.from(l)}const Ape=sc*sc,M4=t=>Math.abs(Math.abs(t)-1)<Ape,N4=(t,e)=>M4(t[e])||M4(t[e+1])||M4(t[e+2]),Lpe=t=>N4(t,0)&&N4(t,3)&&N4(t,6);function Py(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(Lpe(a))i=rB(t);else{const[f,h,p]=r.getDimensions();i=[[0,0,0],[f-1,0,0],[0,h-1,0],[f-1,h-1,0],[0,0,p-1],[f-1,0,p-1],[0,h-1,p-1],[f-1,h-1,p-1]].map(x=>r.indexToWorld(x))}const o=Ci.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(f=>o.apply(f));const s=[...n];o.apply(s);const l=s[0];let c=1/0,d=-1/0;for(let f=0;f<8;f++){const h=i[f][0];h>d&&(d=h),h<c&&(c=h)}return{min:c,max:d,current:l,actor:t,viewPlaneNormal:e,focalPoint:n}}function xB(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:o,actorUID:s}=HT(t,r,e,n);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const l=t.getActor(s);if(!l)return console.warn("No actor found for with actorUID of",s),null;const c=l.actor;return{sliceRange:Py(c,a,i),spacingInNormalDirection:o,camera:r}}function ov(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=xB(t,e,n),{min:o,max:s,current:l}=r,c=Math.round((s-o)/i),f=(l-o)/(s-o)*c,h=Math.round(f);return{numScrollSteps:c,currentStepIndex:h,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function og(t,e,n,r,i,a){const{min:o,max:s,current:l}=n,c=zt();ka(c,e,t);const d=Math.round((s-o)/i),h=(l-o)/(s-o)*d;let p=Math.round(h),C=[t[0]-r[0]*h*i,t[1]-r[1]*h*i,t[2]-r[2]*h*i];p+=a,p>d?p=d:p<0&&(p=0);const x=p*i;C=[C[0]+r[0]*x,C[1]+r[1]*x,C[2]+r[2]*x];const T=[C[0]+c[0],C[1]+c[1],C[2]+c[2]];return{newFocalPoint:C,newPosition:T}}function w2(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=HT(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,o=t.getActors().find(C=>C.referenceId===r.volumeId||C.uid===r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,l=Py(s,i,a),{min:c,max:d,current:f}=l,h=Math.round((d-c)/n)+1;let p=(f-c)/(d-c)*h;return p=Math.floor(p),p>h-1?p=h-1:p<0&&(p=0),{numberOfSlices:h,imageIndex:p}}function Bl(t){return Ca(t,"vtkVolume")||Ca(t,"vtkImageSlice")}function Ca(t,e){return!!("isA"in t?t:t.actor).isA(e)}function kpe(t,e){let n;e?n=[mc(e)]:n=Hu();const r=[];return n.forEach(i=>{i.getViewports().forEach(o=>{o.hasImageURI(t)&&r.push(o)})}),r}function Ppe(t,e){const n=Fpe(t,e);return n?n.index:null}function Fpe(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=l=>{const c=Vpe(l);if(!c)return null;const d=GB(c.planeNormal,c.imagePositionPatient);return zB(d,t)},a={distance:i(n[r])??1/0,index:r},o=n.slice(r+1);for(let l=0;l<o.length;l++){const c=o[l],d=i(c);if(d!==null)if(d<=a.distance)a.distance=d,a.index=l+r+1;else break}const s=n.slice(0,r);for(let l=s.length-1;l>=0;l--){const c=s[l],d=i(c);if(!(d===null||d===a.distance))if(d<a.distance)a.distance=d,a.index=l;else break}return a.distance===1/0?null:a}function Vpe(t){const e=tn("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=Dn(zt(),...n),o=Dn(zt(),...r),s=Xr(zt(),a,o);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}function Upe(t,e){const{imageData:n}=t.getImageData(),r=iB(n,e);return t.worldToCanvas(r)}function Sh(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return $T(n,r)}function Bpe(t){const{dimensions:e,scalarData:n}=t.getImageData(),{width:r,height:i}=t.getCanvas(),a=Sh(t,[0,0]),o=Sh(t,[r-1,0]),s=Sh(t,[0,i-1]),l=ka(zt(),o,a),c=ka(zt(),s,a),d=Xr(zt(),l,c);Ui(l,l),Ui(c,c),Ui(d,d);const f=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])),h=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]));if(!mx(1,f)||!mx(1,h))throw new Error("Livewire is not available for rotate/oblique viewports");const[p,C,x]=e,y=[[0,0,0],[p-1,0,0],[0,C-1,0],[p-1,C-1,0],[0,0,x-1],[p-1,0,x-1],[0,C-1,x-1],[p-1,C-1,x-1]].map(fe=>Upe(t,fe)).reduce((fe,pe)=>(fe.minX=Math.min(fe.minX,pe[0]),fe.minY=Math.min(fe.minY,pe[1]),fe.maxX=Math.max(fe.maxX,pe[0]),fe.maxY=Math.max(fe.maxY,pe[1]),fe),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),w=Sh(t,[y.minX,y.minY]),b=Sh(t,[y.maxX,y.maxY]),M=ka(zt(),b,w),I=Uk(l[0],l[1],l[2],0,c[0],c[1],c[2],0,d[0],d[1],d[2],0,w[0],w[1],w[2],1),A=Vr(vc(),I),k=er(l,M)+1,U=er(c,M)+1,B=n.constructor,z=new B(k*U),K=e[0]*e[1],J=qk(w),X=zt();let re=0;for(let fe=0;fe<U;fe++){eT(X,J);for(let pe=0;pe<k;pe++){const ie=X[2]*K+X[1]*e[0]+X[0];ie<n.length&&(z[re]=n[ie]),re++,io(X,X,l)}io(J,J,c)}return{width:k,height:U,scalarData:z,sliceToIndexMatrix:I,indexToSliceMatrix:A}}const au={},Ax={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;au[i]||(au[i]={}),au[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(au[r])return au[r];const i=`${n}_${e}`;if(au[i])return Vr(vc(),au[i])}};Ly(Ax.get.bind(Ax));const SB=Ax,Gpe=.05;function zpe(t,e){const n=t.getCurrentImageId(),r=e.getCurrentImageId(),i=tn("imagePlaneModule",n),a=tn("imagePlaneModule",r);if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:o}=a;if(!i.imageOrientationPatient.every((h,p)=>Math.abs(h-o[p])<Gpe)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i==null?void 0:i.imageOrientationPatient,a==null?void 0:a.imageOrientationPatient);return}const l=i.imagePositionPatient,c=a.imagePositionPatient,d=Er(zt(),l,c),f=xy(vc(),d);SB.add([t.id,e.id],f)}function Wpe(t){const{imageData:e,dimensions:n}=t.getImageData(),{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],o=[r.width/i,0],s=[r.width/i,r.height/i],l=[0,r.height/i],c=t.canvasToWorld(a),d=t.canvasToWorld(o),f=t.canvasToWorld(s),h=t.canvasToWorld(l),p=e.worldToIndex(c),C=e.worldToIndex(d),x=e.worldToIndex(f),T=e.worldToIndex(h);return jpe({dimensions:n,imageData:e,topLeftImage:p,topRightImage:C,bottomRightImage:x,bottomLeftImage:T,topLeftWorld:c,topRightWorld:d,bottomRightWorld:f,bottomLeftWorld:h})}function jpe({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:o,topRightWorld:s,bottomRightWorld:l,bottomLeftWorld:c}){const d=Sm(n,t)?o:e.indexToWorld([0,0,0]),f=Sm(r,t)?s:e.indexToWorld([t[0]-1,0,0]),h=Sm(i,t)?l:e.indexToWorld([t[0]-1,t[1]-1,0]),p=Sm(a,t)?c:e.indexToWorld([0,t[1]-1,0]);return[d,f,p,h]}function Sm(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function Lx(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function EB(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=Hpe(n),i=r[0],a=r[1]-r[0],o=uc.newInstance(),s=[];for(let b=0;b<n.length;b+=4){let M=n[b];const I=n[b+1],A=n[b+2],k=n[b+3];M=(M-i)/a,s.push([M,I,A,k])}$pe(s,r,o),t.getProperty().setRGBTransferFunction(0,o);const l=e.scalarOpacity.split(" ").splice(1).map(parseFloat),c=Ff.newInstance(),d=[];for(let b=0;b<l.length;b+=2){let M=l[b];const I=l[b+1];M=(M-i)/a,d.push([M,I])}Kpe(d,r,c);const f=t.getProperty();f.setScalarOpacity(0,c);const[h,p,C,x]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);f.setUseGradientOpacity(0,!0),f.setGradientOpacityMinimumValue(0,h),f.setGradientOpacityMinimumOpacity(0,p),f.setGradientOpacityMaximumValue(0,C),f.setGradientOpacityMaximumOpacity(0,x),e.interpolation==="1"&&f.setInterpolationTypeToFastLinear(),f.setShade(e.shade==="1");const T=parseFloat(e.ambient),_=parseFloat(e.diffuse),y=parseFloat(e.specular),w=parseFloat(e.specularPower);f.setAmbient(T),f.setDiffuse(_),f.setSpecular(y),f.setSpecularPower(w)}function Hpe(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function $pe(t,e,n){const r=e[1]-e[0],i=t.map(([a,o,s,l])=>[a*r+e[0],o,s,l]);return n.removeAllPoints(),i.forEach(([a,o,s,l])=>n.addRGBPoint(a,o,s,l)),i}function Kpe(t,e,n){const r=e[1]-e[0],i=t.map(([a,o])=>[a*r+e[0],o]);return n.removeAllPoints(),i.forEach(([a,o])=>n.addPoint(a,o)),i}class cf{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const o=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=o}}}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=cf.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=n[o],i.data[a++]=r?r[o]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new cf({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128){return new cf({initialSize:e,dimensions:3})}static create2(e=128){return new cf({initialSize:e,dimensions:2})}}const C2=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",qpe=t=>Array.isArray(t)?[]:{},Gg=(t,e)=>e&&e.clone===!0&&C2(t)?Fy(qpe(t),t,e):t,XO=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=Gg(i,n):C2(i)?r[a]=Fy(t[a],i,n):t.indexOf(i)===-1&&(r[a]=Gg(i,n))}),r},Xpe=(t,e,n)=>{const r={};return C2(t)&&Object.keys(t).forEach(function(i){r[i]=Gg(t[i],n)}),Object.keys(e).forEach(function(i){!C2(e[i])||!t[i]?r[i]=Gg(e[i],n):r[i]=Fy(t[i],e[i],n)}),r},Fy=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:XO}).arrayMerge||XO;return r?Array.isArray(t)?a(t,e,n):Gg(e,n):Xpe(t,e,n)},TB=Fy;function _B(t){const e=tn("modalityLutModule",t)||{},n=tn("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=tn("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm}}}function Ype(t,e){let n;if(e&&e instanceof Uint8Array)n="Uint8Array";else if(e instanceof Float32Array)n="Float32Array";else if(e instanceof Int16Array)n="Int16Array";else if(e instanceof Uint16Array)n="Uint16Array";else throw new Error("Unsupported array type");return n}function QT(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return e8(e,n)}function e8(t,e){if(!e||!t)return;const n=mc(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function Jpe(t){const e=Hu();for(let n=0;n<e.length;n++){const r=e[n];if(r.getViewport(t))return e8(t,r.id)}}function sv(){const t=[];return Hu().forEach(n=>{n.getViewports().forEach(({element:i})=>{t.push(QT(i))})}),t}function Zpe(t){const e=QT(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof jg))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function DB(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=tn("imagePlaneModule",t[0]);if(!e){const C=wa(r[0],r[1],r[2]),x=wa(r[3],r[4],r[5]);e=zt(),Xr(e,C,x)}const i=zt(),a=t[0].split(":")[0]==="wadouri";Dn(i,n[0],n[1],n[2]);let o,s;function l(C){const{imagePositionPatient:x}=tn("imagePlaneModule",C),T=zt();return ka(T,n,x),er(T,e)}if(a){const C=[t[0],t[Math.floor(t.length/2)]];o=t;const x=l(C[0]),T=l(C[1]);x-T<0&&o.reverse();const _=tn("imagePlaneModule",C[1]);if(!_)throw new Error("Incomplete metadata required for volume construction.");const y=zt();ka(y,n,_.imagePositionPatient);const w=er(y,e);s=Math.abs(w)/Math.floor(t.length/2)}else{const C=t.map(T=>({distance:l(T),imageId:T}));C.sort((T,_)=>_.distance-T.distance),o=C.map(T=>T.imageId);const x=C.length;s=Math.abs(C[x-1].distance-C[0].distance)/(x-1)}const{imagePositionPatient:c,sliceThickness:d,spacingBetweenSlices:f}=tn("imagePlaneModule",o[0]),{strictZSpacingForVolumeViewport:h}=vs().rendering;return s===0&&!h&&(d&&f?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),s=f):d?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),s=d):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),s=1)),{zSpacing:s,origin:c,sortedImageIds:o}}function bB(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=tn("imagePixelModule",e),l=[],c=tn("voiLutModule",e);let d;if(c){const{windowWidth:y,windowCenter:w}=c;if(d=c==null?void 0:c.voiLUTFunction,Array.isArray(y))for(let b=0;b<y.length;b++)l.push({windowWidth:y[b],windowCenter:w[b]});else l.push({windowWidth:y,windowCenter:w})}else l.push({windowWidth:void 0,windowCenter:void 0});const{modality:f,seriesInstanceUID:h}=tn("generalSeriesModule",e),{imageOrientationPatient:p,pixelSpacing:C,frameOfReferenceUID:x,columns:T,rows:_}=tn("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:a,PhotometricInterpretation:o,PixelRepresentation:n,Modality:f,ImageOrientationPatient:p,PixelSpacing:C,FrameOfReferenceUID:x,Columns:T,Rows:_,voiLut:l,VOILUTFunction:d,SeriesInstanceUID:h}}let Eh={};const t8={add:(t,e)=>{t8.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;Eh[t]||(Eh[t]={}),Eh[t][n]=e.metadata},get:(t,e)=>{var n;return(n=Eh[e])==null?void 0:n[t]},clear:()=>{Eh={}}};Ly(t8.get);const x2=t8;function Qpe(t){const e=t[0],{modality:n,seriesInstanceUID:r}=tn("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:l}=tn("imagePlaneModule",e),c={modality:n,imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:l,seriesInstanceUID:r};return t.every(f=>{const{modality:h,seriesInstanceUID:p}=tn("generalSeriesModule",f),{imageOrientationPatient:C,pixelSpacing:x,columns:T,rows:_}=tn("imagePlaneModule",f);return p===c.seriesInstanceUID&&h===c.modality&&T===c.columns&&_===c.rows&&Pi(C,c.imageOrientationPatient)&&Pi(x,c.pixelSpacing)})}function IB(t,e){const n=e.getPixelData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}class zg{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new zg("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>n.reject(r)),n}add(e,n=!1){this.nextValue=e,this.done||(this.done=n),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var n;this.rejectReason=e,(n=this.waiting)==null||n.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(o){if(!a){console.warn("Caught exception in intermediate value",o);continue}if(n)n(o,a);else throw o}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}function OB(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}const R4=new Map,YO="imageRetrieveConfiguration",kx={IMAGE_RETRIEVE_CONFIGURATION:YO,clear:()=>{R4.clear()},add:(t,e)=>{R4.set(t,e)},get:(t,...e)=>{if(t===YO)return e.map(n=>R4.get(n)).find(n=>n!==void 0)}};Ly(kx.get.bind(kx));const MB=kx,e1e=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function t1e(t){return t?(Array.isArray(t)?t:[t]).find(n=>e1e.has(n)):!1}function Vy(t,e,n={}){const{use16BitTexture:r=!1,isVolumeBuffer:i=!1}=n;switch(t){case"Float32Array":return{numBytes:e*4,TypedArrayConstructor:Float32Array};case"Uint8Array":return{numBytes:e,TypedArrayConstructor:Uint8Array};case"Uint16Array":return i?r?{numBytes:e*2,TypedArrayConstructor:Uint16Array}:(console.warn("Uint16Array is not supported for volume rendering, switching back to Float32Array"),{numBytes:e*4,TypedArrayConstructor:Float32Array}):{numBytes:e*2,TypedArrayConstructor:Uint16Array};case"Int16Array":return i?r?{numBytes:e*2,TypedArrayConstructor:Int16Array}:(console.warn("Int16Array is not supported for volume rendering, switching back to Float32Array"),{numBytes:e*4,TypedArrayConstructor:Float32Array}):{numBytes:e*2,TypedArrayConstructor:Int16Array};default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return{numBytes:e*4,TypedArrayConstructor:Float32Array}}}const NB=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n));function RB(t,e){const{useNorm16Texture:n,preferSizeOverAccuracy:r}=vs().rendering,i=n||r,a=bB(t),o=Math.floor(t.length/2),s=t[o],l=_B(s),c=l.rescaleIntercept<0||l.rescaleSlope<0,d=NB(l),f=Dk(),{BitsAllocated:h,PixelRepresentation:p,PhotometricInterpretation:C,ImageOrientationPatient:x,PixelSpacing:T,Columns:_,Rows:y}=a,w=wa(x[0],x[1],x[2]),b=wa(x[3],x[4],x[5]),M=zt();Xr(M,w,b);const{zSpacing:I,origin:A,sortedImageIds:k}=DB(t,M),U=t.length,B=[T[1],T[0],I],z=[_,y,U],K=[...w,...b,...M],J=p===1,X=C==="RGB"?3:1,re=$u(),fe=z[0]*z[1]*z[2],pe=ee=>{if(!bt.isCacheable(ee))throw new Error(xt.CACHE_SIZE_EXCEEDED);bt.decacheIfNecessaryUntilBytesAvailable(ee)};let ie,te;switch(h){case 8:if(J)throw new Error("8 Bit signed images are not yet supported by this plugin.");te=fe*X,pe(te),ie=re?e2(fe*X):new Uint8Array(fe*X);break;case 16:if(!i||f&&d){te=fe*4,ie=re?eg(fe):new Float32Array(fe);break}if(te=fe*2,J||c){pe(te),ie=re?Mk(fe):new Int16Array(fe);break}if(!J&&!c){pe(te),ie=re?t2(fe):new Uint16Array(fe);break}te=fe*4,pe(te),ie=re?eg(fe):new Float32Array(fe);break;case 24:te=fe*X,pe(te),ie=re?e2(fe*X):new Uint8Array(fe*X);break;case 32:te=fe*4,pe(te),ie=re?eg(fe):new Float32Array(fe);break;default:throw new Error(`Bits allocated of ${h} is not defined to generate scalarData for the volume.`)}return{dimensions:z,spacing:B,origin:A,direction:K,scalarData:ie,sizeInBytes:te,metadata:a,imageIds:k,volumeId:e}}const{InterpolationType:kh,OpacityMode:n1e}=kV,{vtkErrorMacro:A4}=de,lv=4;function r1e(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,a;for(let o=0;o<lv;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(a=e.componentData[o].grayTransferFunction.getMTime(),i=i>a?i:a):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(a=e.componentData[o].rGBTransferFunction.getMTime(),i=i>a?i:a),e.componentData[o].scalarOpacity&&(a=e.componentData[o].scalarOpacity.getMTime(),i=i>a?i:a),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(a=e.componentData[o].gradientOpacity.getMTime(),i=i>a?i:a));return i},t.getColorChannels=i=>i<0||i>3?(A4("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].grayTransferFunction!==a&&(e.componentData[i].grayTransferFunction=a,o=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=Ff.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].rGBTransferFunction!==a&&(e.componentData[i].rGBTransferFunction=a,o=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=uc.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==a?(e.componentData[i].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=Ff.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=lv)return A4("Invalid index"),!1;const o=Math.min(1,Math.max(0,a));return e.componentData[i].componentWeight!==o?(e.componentData[i].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=lv?(A4("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(kh.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(kh.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(kh.FAST_LINEAR),t.getInterpolationTypeAsString=()=>de.enumToString(kh,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=de.capitalize(i);t[`set${a}`]=(o,s)=>e.componentData[o][`${i}`]!==s?(e.componentData[o][`${i}`]=s,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=de.capitalize(i);t[`get${a}`]=o=>e.componentData[o][`${i}`]})}const i1e={colorMixPreset:null,independentComponents:!0,interpolationType:kh.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function AB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,i1e,n),de.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<lv;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:n1e.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}de.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),de.setGetArray(t,e,["labelOutlineThickness"]),r1e(t,e)}const a1e=de.newInstance(AB,"vtkVolumeProperty");var o1e={newInstance:a1e,extend:AB,...kV};const{vtkDebugMacro:s1e}=de;function l1e(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=o1e.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){s1e("Recomputing bounds..."),e.mapperBounds=n.map(o=>o);const i=[];Gn.getCorners(n,i),t.computeMatrix();const a=new Float64Array(16);yn(a,e.matrix),i.forEach(o=>vn(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((l,c)=>l>c[s/2]?c[s/2]:l,o):i.reduce((l,c)=>l<c[(s-1)/2]?c[(s-1)/2]:l,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const c1e={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function LB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c1e,n),VT.extend(t,e,n),e.boundsMTime={},de.obj(e.boundsMTime),de.set(t,e,["property"]),de.setGet(t,e,["mapper"]),de.getArray(t,e,["bounds"],6),l1e(t,e)}const u1e=de.newInstance(LB,"vtkVolume");var f1e={newInstance:u1e,extend:LB};function kB(t,e){const n=Ofe.newInstance();vs().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),i=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(i),n.setScalarTexture(e),n}const d1e=0,h1e=Tr.Prefetch;async function PB(t,e,n){var i;let r=p1e(e);!r&&((i=e==null?void 0:e.imageIds)!=null&&i.length)&&(r=await m1e(e,n),r=g1e(e,r)),!((r==null?void 0:r.lower)===0&&(r==null?void 0:r.upper)===0||(r==null?void 0:r.lower)===void 0||(r==null?void 0:r.upper)===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}function g1e(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=tn("generalSeriesModule",i)||{};return y1e(a.modality,t)?{lower:0,upper:5}:e}function p1e(t){var i;const{imageIds:e,metadata:n}=t;let r;if(e.length){const a=Math.floor(e.length/2),o=e[a],s=tn("voiLutModule",o);if(s&&s.windowWidth&&s.windowCenter){const{windowWidth:l,windowCenter:c}=s;r={windowWidth:Array.isArray(l)?l[0]:l,windowCenter:Array.isArray(c)?c[0]:c}}}else r=(i=n==null?void 0:n.voiLut)==null?void 0:i[0];if(r){const{lower:a,upper:o}=Jh(Number(r.windowWidth),Number(r.windowCenter));return{lower:a,upper:o}}}async function m1e(t,e){var M;const{imageIds:n}=t,r=t.getScalarData(),i=Math.floor(n.length/2),a=t.imageIds[i],o=tn("generalSeriesModule",a)||{},{modality:s}=o,l=tn("modalityLutModule",a)||{},c=n.length,d=r.byteLength/c,f=r.length/c,h=r.BYTES_PER_ELEMENT,p={rescaleSlope:l.rescaleSlope,rescaleIntercept:l.rescaleIntercept,modality:s};let C;if(s==="PT"){const I=tn("scalingModule",a);I&&(C={...p,suvbw:I.suvbw})}const x=i*d,T={targetBuffer:{type:e?void 0:"Float32Array"},priority:d1e,requestType:h1e,useNativeDataType:e,preScale:{enabled:!0,scalingParameters:C}};let _=bt.getImage(a);(M=t.referencedImageIds)!=null&&M.length||(_=await Vu(a,{...T,ignoreCache:!0}));const y=_?_.getPixelData():v1e(t,x,h,f),{min:w,max:b}=jE(y);return{lower:w,upper:b}}function v1e(t,e,n,r){const{scalarData:i}=t,{buffer:a}=i;i.BYTES_PER_ELEMENT!==n&&(e*=i.BYTES_PER_ELEMENT/n);const o=i.constructor,s=new o(r),l=new o(a,e,r);return s.set(l),s}function y1e(t,e){var n;return!(t!=="PT"||!e.isPreScaled||!((n=e.scaling)!=null&&n.PT.suvbw))}async function Px(t,e,n,r=!1,i=!1){const{volumeId:a,callback:o,blendMode:s}=t,l=await jT(a);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:d}=l,f=kB(c,d);s&&f.setBlendMode(s);const h=f1e.newInstance();return h.setMapper(f),c.getPointData().getScalars().getNumberOfComponents()===3&&h.getProperty().setIndependentComponents(!1),await PB(h,l,i),o&&o({volumeActor:h,volumeId:a}),r||w1e(e,n,h,a),h}function w1e(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};Kt(t,xt.VOI_MODIFIED,a)}var C1e=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const Vf=Object.create(null);C1e.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{Vf[t.Name]=t});const Uf=Object.keys(Vf);Uf.sort();function x1e(t){return Vf[t]}function S1e(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(Vf[t.Name]||(Uf.push(t.Name),Uf.sort()),Vf[t.Name]=t)}function E1e(t){const e=Uf.indexOf(t);e>-1&&Uf.splice(e,1),delete Vf[t]}var S2={addPreset:S1e,removePresetByName:E1e,getPresetByName:x1e,rgbPresetNames:Uf};const uf={};function T1e(t){uf[t]!==void 0&&delete uf[t]}function _1e(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=mc(e).getViewport(n);if(!(i instanceof Ku))throw new Error("volumeNewImageEventDispatcher: viewport is not a BaseVolumeViewport");uf[i.id]===void 0&&(uf[i.id]=0);const a=w2(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:o,imageIndex:s}=a;if(uf[i.id]===s)return;uf[i.id]=s;const l={imageIndex:s,viewportId:n,renderingEngineId:e,numberOfSlices:o};Kt(i.element,xt.VOLUME_NEW_IMAGE,l)}const sg=class sg{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Ma.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Oo(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Oo(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Ma.NO_DATA||this.viewportStatus===Ma.LOADING||(this.viewportStatus=Ma.RENDERED)}getRenderingEngine(){return Mg.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){var r,i;this.options=Oo(e),(r=this.options)!=null&&r.displayArea&&this.setDisplayArea((i=this.options)==null?void 0:i.displayArea),n&&this.render()}reset(e=!1){this.options=Oo(this.defaultOptions),e&&this.render()}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:o,focalPoint:s,position:l}=i,c=Xr(zt(),a,o);let d=eT(zt(),o);const f=rc(zt(),a),h=Sy(l,s),C=r.getDimensions().map(M=>Math.floor(M/2)),x=[C[0],C[1],C[2]],T=r.indexToWorld(x,zt()),_=this._getFocalPointForResetCamera(T,i,{resetPan:!0,resetToCenter:!1}),y=Er(zt(),s,_),w=Xs(y),b=M=>{const I=Za(zt(),M,2*er(y,M));return Er(I,I,y),Ui(I,I),I};if(e){const M=b(d),I=Li(zt(),_,M,w),A=Li(zt(),I,f,h);this.setCamera({viewPlaneNormal:f,position:A,focalPoint:I}),this.flipHorizontal=!this.flipHorizontal}if(n){d=rc(d,o);const M=b(c),I=Li(zt(),_,M,w),A=Li(zt(),I,f,h);this.setCamera({focalPoint:I,viewPlaneNormal:f,viewUp:d,position:A}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&Bl(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,!0)}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this._removeActor(n)})}addActors(e,n=!1){const r=this.getRenderingEngine();if(!r||r.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(i=>this.addActor(i)),this.resetCamera(n,n)}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}const a=this.getRenderer();a==null||a.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],o=r[2],s=i*n[0]+a*n[1]+o*n[2],l=e.getBounds(),c=this._getEdges(l),d=[];for(const f of c){const[[h,p,C],[x,T,_]]=f;if(i*(x-h)+a*(T-p)+o*(_-C)===0)continue;const y=BB([h,p,C],[x,T,_],[i,a,o,s]);this._isInBounds(y,l)&&d.push(y)}return d}setInterpolationType(e,n){}setDisplayArea(e,n=!1){var o;if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((o=this.getProperties())==null?void 0:o.interpolationType)||wu.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const s={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};Kt(this.element,xt.DISPLAY_AREA_MODIFIED,s),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const l=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(wu.NEAREST),this.setCamera({parallelScale:i*l/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:c,position:d,viewUp:f,viewPlaneNormal:h}=this.getCamera(),p=zt();if(r.height%2&&Li(p,p,f,n*.5*l),r.width%2){const C=Xr(zt(),f,h);Li(p,p,C,n*.5*l)}!p[0]&&!p[1]&&!p[2]||this.setCamera({focalPoint:io(zt(),c,p),position:io(zt(),d,p)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=(window==null?void 0:window.devicePixelRatio)||1,a=this.getDefaultImageData();if(!a)return;const o=this.sWidth/i,s=this.sHeight/i,l=a.getDimensions(),c=this.worldToCanvas(a.indexToWorld([0,0,0])),d=this.worldToCanvas(a.indexToWorld([l[0]-1,l[1]-1,l[2]])),f=[Math.abs(d[0]-c[0]),Math.abs(d[1]-c[1])],[h,p]=f;if(n){const[C,x]=n,T=Math.abs(C*h/o),_=Math.abs(x*p/s),y=this.getZoom(),w=this.getZoom(this.fitToCanvasCamera),M=Math.min(1/T,1/_)*y/w;this.setZoom(M,!1)}if(r){const{imagePoint:C,canvasPoint:x=C||[.5,.5]}=r,[T,_]=x,y=o*(T-.5),w=s*(_-.5),[b,M]=C||x,I=1,A=I*h*(.5-b),k=I*p*(.5-M),U=A+y,B=k+w,z=[U,B];_y(z,z,this.getPan()),this.setPan(z,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e=!0,n=!0,r=!0,i=!0){var K,J;const a=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const o=Oo(this.getCamera()),s=a.computeVisiblePropBounds(),l=[0,0,0],c=this.getDefaultImageData();if(c){const X=c.getSpacing();s[0]=s[0]+X[0]/2,s[1]=s[1]-X[0]/2,s[2]=s[2]+X[1]/2,s[3]=s[3]-X[1]/2,s[4]=s[4]+X[2]/2,s[5]=s[5]-X[2]/2}const d=this.getVtkActiveCamera(),f=d.getViewPlaneNormal(),h=d.getViewUp();if(l[0]=(s[0]+s[1])/2,l[1]=(s[2]+s[3])/2,l[2]=(s[4]+s[5])/2,c){const re=c.getDimensions().map(pe=>Math.floor(pe/2)),fe=[re[0],re[1],re[2]];c.indexToWorld(fe,l)}const{widthWorld:p,heightWorld:C}=this._getWorldDistanceViewUpAndViewRight(s,h,f),x=[this.sWidth,this.sHeight],T=p/C,_=x[0]/x[1],y=T/_,w=y<1?this.insetImageMultiplier*C/2:this.insetImageMultiplier*C*y/2,b=sg.boundsRadius(s)*(this.type===dr.VOLUME_3D?10:1),M=this.insetImageMultiplier*b,I=Math.abs(to.dot(h,f))>.999?[-h[2],h[0],h[1]]:h,A=this._getFocalPointForResetCamera(l,o,{resetPan:e,resetToCenter:r}),k=[A[0]+M*f[0],A[1]+M*f[1],A[2]+M*f[2]];a.resetCameraClippingRange(s);const U=[-Ra.MAXIMUM_RAY_DISTANCE,Ra.MAXIMUM_RAY_DISTANCE];d.setPhysicalScale(b),d.setPhysicalTranslation(-A[0],-A[1],-A[2]),this.setCamera({parallelScale:n?w:o.parallelScale,focalPoint:A,position:k,viewAngle:90,viewUp:I,clippingRange:U});const B=Oo(this.getCamera());this.setFitToCanvasCamera(Oo(this.getCamera())),i&&this.setInitialCamera(B),n&&this.setZoom(1,i);const z={type:"ResetCameraEvent",renderer:a};return a.invokeEvent(z),this.triggerCameraModifiedEventIfNecessary(o,B),c&&((K=this.options)!=null&&K.displayArea)&&n&&e&&r&&this.setDisplayArea((J=this.options)==null?void 0:J.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(Er([0,0,0],e.focalPoint,i)),o=this.worldToCanvas(Er([0,0,0],r,i));return kg([0,0],a,o)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,o=this.canvasToWorld([0,0]),s=kg([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const l=Er(zt(),this.canvasToWorld(s),o),c=Er(zt(),i,l),d=Er(zt(),a,l);this.setCamera({...r,focalPoint:c,position:d},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,o=0,s=0;return i.forEach(([c,d,f])=>{a+=c,o+=d,s+=f}),[a/i.length,o/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){return this.getRenderer().getActiveCamera()}getCamera(){const e=this.getVtkActiveCamera();return{viewUp:e.getViewUp(),viewPlaneNormal:e.getViewPlaneNormal(),position:e.getPosition(),focalPoint:e.getFocalPoint(),parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=Oo(this.getCamera()),a=Object.assign({},i,e),{viewUp:o,viewPlaneNormal:s,position:l,focalPoint:c,parallelScale:d,viewAngle:f,flipHorizontal:h,flipVertical:p,clippingRange:C}=e;if(h!==void 0){const _=h&&!this.flipHorizontal||!h&&this.flipHorizontal;_&&this.flip({flipHorizontal:_})}if(p!==void 0){const _=p&&!this.flipVertical||!p&&this.flipVertical;_&&this.flip({flipVertical:_})}o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),l!==void 0&&r.setPosition(...l),c!==void 0&&r.setFocalPoint(...c),d!==void 0&&r.setParallelScale(d),f!==void 0&&r.setViewAngle(f),C!==void 0&&r.setClippingRange(C);const x=i.focalPoint,T=i.viewUp;if(x&&c||T&&o){const _=r.getViewPlaneNormal(),y=r.getViewUp();let w=!1,b=!1;if(c){const M=[c[0]-x[0],c[1]-x[1],c[2]-x[2]];w=Math.abs(to.dot(M,_))>0}if(o&&(b=!Pi(y,T)),w||b){const M=this.getDefaultActor();if(!(M!=null&&M.actor))return;Ca(M,"vtkActor")||this.updateClippingPlanesForActors(a),(Ca(M,"vtkImageSlice")||this.type===dr.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.getRotation()};Kt(this.element,xt.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r!=null&&r.clippingFilter?r.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&(r!=null&&r.clippingFilter)&&(a=[Fi.newInstance(),Fi.newInstance()]);let o=Ra.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:l}=e;this.setOrientationOfClippingPlanes(a,o,s,l),Kt(this.element,xt.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:l,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];to.multiplyScalar(a,n),e[0].setNormal(r);const o=[0,0,0];to.subtract(i,a,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];to.add(i,a,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e!=null&&e.clippingFilter?e.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&(e!=null&&e.clippingFilter)&&(r=[Fi.newInstance(),Fi.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),o=Xr(zt(),n,r);let s=Ci.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(h=>s.apply(h));let l=1/0,c=-1/0;for(let h=0;h<8;h++){const p=i[h][0];p>c&&(c=p),p<l&&(l=p)}s=Ci.buildFromDegree().identity().rotateFromDirections([o[0],o[1],o[2]],[1,0,0]),a.forEach(h=>s.apply(h));let d=1/0,f=-1/0;for(let h=0;h<8;h++){const p=a[h][0];p>f&&(f=p),p<d&&(d=p)}return{widthWorld:f-d,heightWorld:c-l}}getViewReference(e={}){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:e.sliceIndex??this.getSliceIndex()}}isReferenceViewable(e,n){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Pi(r,i.viewPlaneNormal)&&!Pi(rc(i.viewPlaneNormal,i.viewPlaneNormal),r)?(n==null?void 0:n.withOrientation)===!0:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:o}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const s=this.getZoom();return a&&(n.zoom=s),o&&(n.pan=this.getPan(),xx(n.pan,n.pan,1/s)),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(xx([0,0],i,r)),a>=0&&this.setRotation(a)}_shouldUseNativeDataType(){const{useNorm16Texture:e,preferSizeOverAccuracy:n}=vs().rendering;return e||n}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return Lx(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,o=a.focalPoint,s=a.viewPlaneNormal,l=Er(zt(),e,o),c=er(l,s),d=Li(zt(),e,s,-1*c);return[d[0],d[1],d[2]]}if(!r&&!i)return Lx(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,o,s,l]=n,[c,d,f]=e;return!(c<r||c>i||d<a||d>o||f<s||f>l)}_getEdges(e){const[n,r,i,a,o,s,l,c]=this._getCorners(e);return[[n,r],[n,o],[n,i],[r,a],[r,s],[i,a],[i,l],[a,c],[o,l],[o,s],[s,c],[l,c]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};sg.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},sg.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let Fx=sg;const vp=Fx,n8=new Map;function D1e(t){n8.set(t.Name,t)}function Uy(t){return n8.get(t)}function FB(){return Array.from(n8.keys())}function r8(t,e){const n=S2.rgbPresetNames.map(s=>S2.getPresetByName(s)),r=FB().map(s=>Uy(s)),a=n.concat(r).find(s=>{const{RGBPoints:l}=s;if(l.length!==t.length)return!1;for(let c=0;c<l.length;c+=4)if(!Pi(l.slice(c+1,c+4),t.slice(c+1,c+4)))return!1;return!0});if(!a)return null;const o=[];if(Ca(e,"vtkVolume")){const s=e.getProperty().getScalarOpacity(0).getDataPointer();if(!s)return{name:a.Name};for(let l=0;l<s.length;l+=2)o.push({value:s[l],opacity:s[l+1]})}return{name:a.Name,opacity:o}}const b1e=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:r8,getColormap:Uy,getColormapNames:FB,registerColormap:D1e},Symbol.toStringTag,{value:"Module"}));function E2(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function i8(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const I1e=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:E2,setTransferFunctionNodes:i8},Symbol.toStringTag,{value:"Module"}));class O1e extends vp{constructor(e){if(super(e),this.useCPURendering=!1,this.useNativeDataType=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),o=this.getPan(),s=this.getCamera(),l=Pg([0,0],a,o);this.setPan(l,!1);const{flipVertical:c}=this.getCamera(),d=c?rc([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:d}),this.rotateCamera(i);const f=this.getPan(),h=this.getPan(this.fitToCanvasCamera),p=Pg([0,0],f,h),C=_y([0,0],a,p);if(this.setPan(C,!1),this._suppressCameraModifiedEvents)return;const x=this.getCamera(),T={previousCamera:s,camera:x,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:i};Kt(this.element,xt.CAMERA_MODIFIED,T),this.viewportProperties.rotation=i},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{var _,y;if(!this._getApplicableVolumeActor(i))return;const{colormap:o,VOILUTFunction:s,interpolationType:l,invert:c,slabThickness:d,rotation:f,preset:h}=this.viewportProperties,p=this.getActors().map(w=>{var B;const b=w.actor,M=w.uid;if(!bt.getVolume(M))return null;const A=b.getProperty().getRGBTransferFunction(0),[k,U]=((B=this.viewportProperties)==null?void 0:B.VOILUTFunction)==="SIGMOID"?ok(A):A.getRange();return{volumeId:M,voiRange:{lower:k,upper:U}}}).filter(Boolean),C=i?(_=p.find(w=>w.volumeId===i))==null?void 0:_.voiRange:(y=p[0])==null?void 0:y.voiRange,x=this.getColormap(i);return{colormap:i&&x?x:o,voiRange:C,VOILUTFunction:s,interpolationType:l,invert:c,slabThickness:d,rotation:f,preset:h}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:o}=a,s=o.getProperty().getRGBTransferFunction(0),{nodes:l}=s.getState(),c=l.reduce((f,h)=>(f.push(h.x,h.r,h.g,h.b),f),[]);return r8(c,o)},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:o}=this.getCamera(),s=o?rc([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const l=rT(s,i)*180/Math.PI,c=Xr([0,0,0],s,i);return er(c,a)>=0?l:(360-l)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{var C,x;const a=this.getVtkActiveCamera();(C=a.setIsPerformingCoordinateTransformation)==null||C.call(a,!0);const o=this.getRenderer(),l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),c=l.getSize(),d=window.devicePixelRatio||1,f=[i[0]*d,i[1]*d],h=[f[0]+this.sx,f[1]+this.sy];h[1]=c[1]-h[1];const p=l.displayToWorld(h[0],h[1],0,o);return(x=a.setIsPerformingCoordinateTransformation)==null||x.call(a,!1),[p[0],p[1],p[2]]},this.worldToCanvas=i=>{var C,x;const a=this.getVtkActiveCamera();(C=a.setIsPerformingCoordinateTransformation)==null||C.call(a,!0);const o=this.getRenderer(),l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),c=l.getSize(),d=l.worldToDisplay(...i,o);d[1]=c[1]-d[1];const f=[d[0]-this.sx,d[1]-this.sy],h=window.devicePixelRatio||1,p=[f[0]/h,f[1]/h];return(x=a.setIsPerformingCoordinateTransformation)==null||x.call(a,!1),p},this.hasImageURI=i=>this.getActors().filter(o=>Ca(o,"vtkVolume")).some(({uid:o})=>{const s=bt.getVolume(o);return!s||!s.imageIds?!1:s.imageIds.map(qs).includes(i)}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const o=a.volumeId,s=bt.getVolume(o);if(!s)throw new Error(`imageVolume with id: ${o} does not exist in cache`);return s.imageIds},this.useCPURendering=xf(),this.useNativeDataType=this._shouldUseNativeDataType(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=Vfe.newInstance();switch(n.setActiveCamera(r),this.type){case dr.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case dr.VOLUME_3D:r.setParallelProjection(!0);break;case dr.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}resetCamera(e=!0,n=!0,r=!0,i=!1,a=!1,o=!0){return super.resetCamera()}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e),a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera(!0,!0,!0,!1,!0,!1)}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:o}=a.detail;o!==this.id||this.isDisabled||!this.getImageData()||_1e(a)}function i(a){const{viewportId:o}=a.detail;o===this.id&&(this.element.removeEventListener(xt.CAMERA_MODIFIED,e),Hn.removeEventListener(xt.ELEMENT_DISABLED,n),T1e(o))}this.element.removeEventListener(xt.CAMERA_MODIFIED,e),this.element.addEventListener(xt.CAMERA_MODIFIED,e),Hn.addEventListener(xt.ELEMENT_DISABLED,n)}resetVolumeViewportClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-Ra.MAXIMUM_RAY_DISTANCE,Ra.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Ra.MINIMUM_SLAB_THICKNESS,Ra.MAXIMUM_RAY_DISTANCE)}setVOILUTFunction(e,n,r){Object.values(Du).indexOf(e)===-1&&(e=Du.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=uc.newInstance();let s=Uy(e.name);const{name:l}=e;if(s||(s=S2.getPresetByName(l)),!s)throw new Error(`Colormap ${e} not found`);const c=a.getProperty().getRGBTransferFunction(0).getRange();if(o.applyColorMap(s),o.setMappingRange(c[0],c[1]),a.getProperty().setRGBTransferFunction(0,o),this.viewportProperties.colormap=e,!r){const d={viewportId:this.id,colormap:e,volumeId:n};Kt(this.element,xt.COLORMAP_MODIFIED,d)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=Ff.newInstance();if(typeof e.opacity=="number"){const o=i.getProperty().getRGBTransferFunction(0).getRange();a.addPoint(o[0],e.opacity),a.addPoint(o[1],e.opacity)}else e.opacity.forEach(({opacity:o,value:s})=>{a.addPoint(s,o)});i.getProperty().setScalarOpacity(0,a),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,o=this._getOrCreateColorTransferFunction(a);if($h(o),this.viewportProperties.invert=e,!r){const s={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};Kt(this.element,xt.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),o=this.getColormap(e),{VOILUTFunction:s,invert:l}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:s,colormap:o,invert:l}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=uc.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=i.volumeId;let s=e;if(typeof s>"u"){const d=a.getMapper().getInputData().getPointData().getScalars().getRange();s={lower:d[0],upper:d[1]}}const{VOILUTFunction:l}=this.getProperties(o);if(l===Du.SAMPLED_SIGMOID){const c=WE(s);a.getProperty().setRGBTransferFunction(0,c)}else{const{lower:c,upper:d}=s;a.getProperty().getRGBTransferFunction(0).setRange(c,d)}if(!r){const c={...this.getVOIModifiedEventDetail(o)};Kt(this.element,xt.VOI_MODIFIED,c)}this.viewportProperties.voiRange=s}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(n.volumeId=r),typeof(e==null?void 0:e.sliceIndex)!="number")return n;const{viewPlaneNormal:i}=n,a=e.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:o}=ov(this,r,!0),{sliceRange:s,spacingInNormalDirection:l,camera:c}=o,{focalPoint:d,position:f}=c,{newFocalPoint:h}=og(d,f,s,i,l,a);return n.cameraFocalPoint=h,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n!=null&&n.withNavigation)return!0;const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=ov(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:o}=r,{focalPoint:s,viewPlaneNormal:l,position:c}=o,{newFocalPoint:d,newPosition:f}=og(s,c,i,l,a,e);this.setCamera({focalPoint:d,position:f})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{viewPlaneNormal:r,FrameOfReferenceUID:i,cameraFocalPoint:a,viewUp:o}=e;let{sliceIndex:s}=e;const{focalPoint:l,viewPlaneNormal:c,position:d}=this.getCamera(),f=uk(c,r),h=Pi(c,r);if(typeof s=="number"&&e.volumeId===n&&(f||h)){const{currentStepIndex:p,sliceRangeInfo:C,numScrollSteps:x}=ov(this,n,!0),{sliceRange:T,spacingInNormalDirection:_}=C;f&&(s=x-s-1);const y=s-p,{newFocalPoint:w,newPosition:b}=og(l,d,T,c,_,y);this.setCamera({focalPoint:w,position:b})}else if(i===this.getFrameOfReferenceUID()){if(r&&!f&&!h)return this.setOrientation({viewPlaneNormal:r,viewUp:o}),this.setViewReference(e);if(a){const p=Er([0,0,0],a,l),C=r??c,x=er(p,C);Pi(x,0)||Za(p,C,x);const T=io([0,0,0],l,p),_=io([0,0,0],d,p);this.setCamera({focalPoint:T,position:_})}}else throw new Error(`Incompatible view refs: ${i}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:o,slabThickness:s,rotation:l}={},c,d=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:s,rotation:l}),i!=null&&i.name&&this.setColormap(i,c,d),(i==null?void 0:i.opacity)!=null&&this.setOpacity(i,c),e!==void 0&&this.setVOI(e,c,d),typeof o<"u"&&this.setInterpolationType(o),n!==void 0&&this.setVOILUTFunction(n,c,d),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,d),a!==void 0&&this.setPreset(a,c,d),s!==void 0&&(this.setSlabThickness(s),this.viewportProperties.slabThickness=s),l!==void 0&&this.setRotation(l)}resetToDefaultProperties(e){var r,i;const n=this.globalDefaultProperties;(r=n.colormap)!=null&&r.name&&this.setColormap(n.colormap,e),((i=n.colormap)==null?void 0:i.opacity)!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.rotation!==void 0&&this.setRotation(n.rotation),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let o=e;typeof o=="string"&&(o=gA.find(s=>s.name===e)),o&&(EB(a,o),this.viewportProperties.preset=o,this.render(),r||Kt(this.element,xt.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:o.name}))}async setVolumes(e,n=!1,r=!1){const i=bt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=i.metadata.FrameOfReferenceUID;await this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a;const o=[];for(let s=0;s<e.length;s++){const{volumeId:l,actorUID:c,slabThickness:d}=e[s],f=await Px(e[s],this.element,this.id,r,this.useNativeDataType),h=c||l;o.push({uid:h,actor:f,slabThickness:d,referenceId:l})}this._setVolumeActors(o),this.viewportStatus=Ma.PRE_RENDER,this.initializeColorTransferFunction(e),Kt(this.element,xt.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:o}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=bt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];await this._isValidVolumeInputArray(e,this._FrameOfReferenceUID);for(let o=0;o<e.length;o++){const{volumeId:s,visibility:l,actorUID:c,slabThickness:d}=e[o],f=await Px(e[o],this.element,this.id,r,this.useNativeDataType);l===!1&&f.setVisibility(!1);const h=c||s;a.push({uid:h,actor:f,slabThickness:d,referenceId:s})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);this.initialTransferFunctionNodes||(this.initialTransferFunctionNodes=E2(r))}_getApplicableVolumeActor(e){var i;if(e!==void 0&&!this.getActor(e))return;const n=this.getActors();if(!n.length)return;let r;return e&&(r=(i=this.getActor(e))==null?void 0:i.actor),r||(r=n[0].actor,e=n[0].uid),{volumeActor:r,volumeId:e}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=e[i],o=await jT(a.volumeId);if(!o)throw new Error(`imageVolume with id: ${o.volumeId} does not exist`);if(n!==o.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.getActors().some(r=>r.uid===e)}getImageData(e){var l;const n=this.getDefaultActor();if(!n)return;const{uid:r}=n;e=e??r;const i=this.getActor(e);if(!Ca(i,"vtkVolume"))return;const a=i.actor,o=bt.getVolume(e),s=a.getMapper().getInputData();return{dimensions:s.getDimensions(),spacing:s.getSpacing(),origin:s.getOrigin(),direction:s.getDirection(),scalarData:s.getPointData().getScalars().isDeleted()?null:s.getPointData().getScalars().getData(),imageData:a.getMapper().getInputData(),metadata:{Modality:(l=o==null?void 0:o.metadata)==null?void 0:l.Modality},scaling:o==null?void 0:o.scaling,hasPixelSpacing:!0}}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&Hl[e])return this.viewportProperties.orientation=e,Hl[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(Hl).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let n=Ra.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Ca(n,"vtkVolume"))return;const{actor:r,uid:i}=n,a=r.getMapper().getInputData(),o=bt.getVolume(i),{dimensions:s}=o,l=$T(a,e),c=l[2]*s[0]*s[1]+l[1]*s[0]+l[0];return o.getScalarData()[c]}getVolumeId(e){var r,i;const n=this.getActors();if(n)return e!=null&&e.volumeId?(i=n.find(a=>a.actor.getClassName()==="vtkVolume"&&a.uid===e.volumeId))==null?void 0:i.uid:(r=n.find(a=>a.actor.getClassName()==="vtkVolume"))==null?void 0:r.uid}getReferenceId(e={}){var l;let{volumeId:n,sliceIndex:r}=e;if(!n){const c=this.getActors();if(!c)return;n=(l=c.find(d=>d.actor.getClassName()==="vtkVolume"))==null?void 0:l.uid}const i=this.getSliceIndex();r??(r=i);const{viewPlaneNormal:a,focalPoint:o}=this.getCamera(),s=n.indexOf("?")>-1?"&":"?";return`volumeId:${n}${s}sliceIndex=${r}&viewPlaneNormal=${a.join(",")}&focalPoint=${o.join(",")}`}}const Ku=O1e;async function a8(t,e,n,r=!1,i=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Ku))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async o=>{await t.getViewport(o).setVolumes(e,r,i)});await Promise.all(a)}async function M1e(t,e,n,r=!1,i=!1){for(const o of n){const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Ku)){console.warn(`Viewport with Id ${o} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const a=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,i)});await Promise.all(a)}async function N1e(t,e,n){for(const i of n){const a=t.getViewport(i);if(!a)throw new Error(`Viewport with Id ${i} does not exist`);if(!a.addImages){console.warn(`Viewport with Id ${i} does not have addImages. Cannot add image segmentation to this viewport.`);return}}const r=n.map(async i=>t.getViewport(i).addImages(e));await Promise.all(r)}async function R1e({viewport:t,options:e}){const n=t.getRenderingEngine();let{volumeId:r}=e;r.split(":").length===1&&(r=`${eB()}:${r}`);const{id:i,element:a}=t,o=e.viewportId||i,s=t.getImageIds(),l=t.getCamera();n.enableElement({viewportId:o,type:dr.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await ky(r,{imageIds:s})).load();const d=n.getViewport(o);a8(n,[{volumeId:r}],[o]);const f=()=>{e.orientation||d.setCamera({...l}),d.render(),a.removeEventListener(xt.VOLUME_VIEWPORT_NEW_VOLUME,f)};return(()=>{a.addEventListener(xt.VOLUME_VIEWPORT_NEW_VOLUME,f)})(),d.render(),d}async function A1e({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),o=t.getCurrentImageIdIndex(),{background:s}=e,l=e.viewportId||r,c=n.getDefaultActor(),{uid:d}=c,f=bt.getVolume(d);if(!(f instanceof pp))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const h={viewportId:l,type:dr.STACK,element:i,defaultOptions:{background:s}};a.enableElement(h);const p=a.getViewport(l),C=f.imageCacheOffsetMap.size>0;let x=!1;C&&(x=f.imageIds.every(b=>bt.getImage(b)));const T=a.getVolumeViewports().find(b=>b.hasVolumeId(d));f.decache(!T&&x);const _=[...f.imageIds].reverse();let y=Math.max(f.imageIds.length-o-1,0);if(!bt.getImage(_[y])){let b=1/0,M=null;_.forEach((I,A)=>{if(bt.getImage(I)){const U=Math.abs(y-A);U<b&&(b=U,M=A)}}),y=M}return await p.setStack(_,y??0),p.render(),p}class VB{constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.defaultValue=0,this.pixelDataConstructor=Uint8Array,this.get=i=>{const a=i%this.jMultiple,o=(i-a)/this.jMultiple,s=this.getRLE(a,o);return(s==null?void 0:s.value)||this.defaultValue},this.getRun=(i,a)=>{const o=i+a*this.height;return this.rows.get(o)},this.set=(i,a)=>{if(a===void 0)throw new Error(`Can't set undefined at ${i%this.width}`);const o=i%this.width,s=(i-o)/this.width,l=this.rows.get(s);if(!l){this.rows.set(s,[{start:o,end:o+1,value:a}]);return}const c=this.findIndex(l,o),d=l[c],f=l[c-1];if(!d){if(!f||f.value!==a||f.end!==o){l[c]={start:o,end:o+1,value:a};return}f.end++;return}const{start:h,end:p,value:C}=d;if(a===C&&o>=h)return;const x={start:o,end:o+1,value:a},T=o>h,_=T?c+1:c,y=T?d:f;let w=T?l[c+1]:d;if((y==null?void 0:y.value)===a&&(y==null?void 0:y.end)===o){y.end++,(w==null?void 0:w.value)===a&&w.start===o+1?(y.end=w.end,l.splice(c,1)):(w==null?void 0:w.start)===o&&(w.start++,w.start===w.end&&(l.splice(c,1),w=l[c],(w==null?void 0:w.start)===o+1&&w.value===a&&(y.end=w.end,l.splice(c,1))));return}if((w==null?void 0:w.value)===a&&w.start===o+1){w.start--,(y==null?void 0:y.end)>o&&(y.end=o,y.end===y.start&&l.splice(c,1));return}if((w==null?void 0:w.start)===o&&w.end===o+1){w.value=a;const b=l[c+1];(b==null?void 0:b.start)==o+1&&b.value===a&&(l.splice(c+1,1),w.end=b.end);return}o===(w==null?void 0:w.start)&&w.start++,T&&p>o+1?l.splice(_,0,x,{start:o+1,end:y.end,value:y.value}):l.splice(_,0,x),(y==null?void 0:y.end)>o&&(y.end=o)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),o=i[a];return e>=(o==null?void 0:o.start)?o:void 0}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:i,numComps:a}=this;for(let o=0;o<i;o++){const s=this.getRun(o,e);if(s)if(a===1)for(const l of s){const c=o*r,{start:d,end:f,value:h}=l;for(let p=d;p<f;p++)n[c+p]=h}else for(const l of s){const c=o*r*a,{start:d,end:f,value:h}=l;for(let p=d;p<f;p+=a)for(let C=0;C<a;C++)n[c+p+C]=h[C]}}return n}}const L1e=5*1024;class da{constructor(e,n,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.numComps=1,this.getAtIJK=(i,a,o)=>{const s=i+a*this.width+o*this.frameSize;return this._get(s)},this.setAtIJK=(i,a,o,s)=>{const l=i+a*this.width+o*this.frameSize;this._set(l,s)!==!1&&(this.modifiedSlices.add(o),da.addBounds(this.boundsIJK,[i,a,o]))},this.getAtIJKPoint=([i,a,o])=>this.getAtIJK(i,a,o),this.setAtIJKPoint=([i,a,o],s)=>this.setAtIJK(i,a,o,s),this.getAtIndex=i=>this._get(i),this.setAtIndex=(i,a)=>{if(this._set(i,a)!==!1){const o=this.toIJK(i);this.modifiedSlices.add(o[2]),da.addBounds(this.boundsIJK,o)}},this.forEach=(i,a)=>{const o=(a==null?void 0:a.boundsIJK)||this.getBoundsIJK(),{isWithinObject:s}=a||{};if(this.map)for(const l of this.map.keys()){const c=this.toIJK(l),f={value:this._get(l),index:l,pointIJK:c};(s==null?void 0:s(f))!==!1&&i(f)}else for(let l=o[2][0];l<=o[2][1];l++){const c=l*this.frameSize;for(let d=o[1][0];d<=o[1][1];d++){const f=c+d*this.width;for(let h=o[0][0],p=f+h;h<=o[0][1];h++,p++){const x={value:this.getAtIndex(p),index:p,pointIJK:[h,d,l]};(s==null?void 0:s(x))!==!1&&i(x)}}}},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n,this._set=r}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}getPointIndices(){return this.points?[...this.points]:[]}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.dimensions.map(e=>[0,e-1])}clear(){var e;this.map&&this.map.clear(),this.boundsIJK.map(n=>{n[0]=1/0,n[1]=-1/0}),this.modifiedSlices.clear(),(e=this.points)==null||e.clear()}getArrayOfSlices(){return Array.from(this.modifiedSlices)}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}static createRGBVolumeVoxelManager(e,n,r){const i=new da(e,a=>(a*=r,[n[a++],n[a++],n[a++]]),(a,o)=>{a*=3;const s=!Pi(n[a],o);return n[a++]=o[0],n[a++]=o[1],n[a++]=o[2],s});return i.numComps=r,i.scalarData=n,i}static createVolumeVoxelManager(e,n,r=0){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?da.createRGBVolumeVoxelManager(e,n,r):da.createNumberVolumeVoxelManager(e,n)}static createNumberVolumeVoxelManager(e,n){const r=new da(e,i=>n[i],(i,a)=>{const o=n[i]!==a;return n[i]=a,o});return r.scalarData=n,r}static createMapVoxelManager(e){const n=new Map,r=new da(e,n.get.bind(n),(i,a)=>n.set(i,a)&&!0);return r.map=n,r}static createHistoryVoxelManager(e){const n=new Map,{dimensions:r}=e,i=new da(r,a=>n.get(a),function(a,o){if(n.has(a))o===n.get(a)&&n.delete(a);else{const s=this.sourceVoxelManager.getAtIndex(a);if(s===o)return!1;n.set(a,s)}this.sourceVoxelManager.setAtIndex(a,o)});return i.map=n,i.scalarData=e.scalarData,i.sourceVoxelManager=e,i}static createLazyVoxelManager(e,n){const r=new Map,[i,a,o]=e,s=i*a,l=new da(e,c=>{var d;return(d=r.get(Math.floor(c/s)))==null?void 0:d[c%s]},(c,d)=>{const f=Math.floor(c/s);let h=r.get(f);h||(h=n(i,a),r.set(f,h)),h[c%s]=d});return l.map=r,l}static createRLEVoxelManager(e){const[n,r,i]=e,a=new VB(n,r,i),o=new da(e,s=>a.get(s),(s,l)=>a.set(s,l));return o.map=a,o.getPixelData=a.getPixelData.bind(a),o}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.getPixelData();if((i==null?void 0:i.length)>=n*r){e.voxelManager=da.createVolumeVoxelManager([n,r,1],i);return}e.voxelManager=da.createRLEVoxelManager([n,r,1]),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=L1e}}function UB(t,e=2){if(Array.isArray(t))return t.map(i=>UB(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function k1e(t){return Math.round(t/sc)*sc}function P1e(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let o=0,s=0;const l=r?4:3;for(let c=0;c<e;c++)for(let d=0;d<n;d++){const f=t[o],h=t[o+1],p=t[o+2];a[s]=(f+h+p)/3,o+=l,s++}return a}else return t}function F1e(t){if(t instanceof Wg){const n=t.getDefaultActor().uid;return bt.getVolume(n).imageIds}else if(t.getImageIds)return t.getImageIds()}function V1e(t,e){const n=[...t];return e>=n.length?(JO(n),n):(JO(n),n.slice(0,e))}function JO(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function BB(t,e,n){const[r,i,a]=t,[o,s,l]=e,[c,d,f,h]=n,p=o-r,C=s-i,x=l-a,T=-1*(c*r+d*i+f*a-h)/(c*p+d*C+f*x),_=p*T+r,y=C*T+i,w=x*T+a;return[_,y,w]}function GB(t,e,n=!1){const[r,i,a]=t,o=r*e[0]+i*e[1]+a*e[2];if(n){const s=Math.sqrt(r*r+i*i+a*a);return[r/s,i/s,a/s,o/s]}return[r,i,a,o]}function U1e(t,e,n){const[r,i,a,o]=t,[s,l,c,d]=e,[f,h,p,C]=n,x=sf(r,s,f,i,l,h,a,c,p),T=sf(o,d,C,i,l,h,a,c,p),_=sf(r,s,f,o,d,C,a,c,p),y=sf(r,s,f,i,l,h,o,d,C),w=uu(T)/uu(x),b=uu(_)/uu(x),M=uu(y)/uu(x);return[w,b,M]}function zB(t,e,n=!1){const[r,i,a,o]=t,[s,l,c]=e,d=r*s+i*l+a*c-o,f=Math.abs(d)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(d):1)*f}const B1e=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:BB,planeDistanceToPoint:zB,planeEquation:GB,threePlaneIntersection:U1e},Symbol.toStringTag,{value:"Module"}));function L4(t){const e=t.toString(16);return e.length==1?"0"+e:e}function G1e(t,e,n){return"#"+L4(t)+L4(e)+L4(n)}function z1e(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const W1e=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:z1e,rgbToHex:G1e},Symbol.toStringTag,{value:"Module"})),o8=Object.freeze(Object.defineProperty({__proto__:null,PointsManager:cf,ProgressiveIterator:zg,RLEVoxelMap:VB,VoxelManager:da,actorIsA:Ca,applyPreset:EB,cacheUtils:Dge,calculateViewportsSpatialRegistration:zpe,calibratedPixelSpacingMetadataProvider:Cte,clamp:fx,color:W1e,colormap:b1e,convertStackToVolumeViewport:R1e,convertToGrayscale:P1e,convertVolumeToStackViewport:A1e,createFloat32SharedArray:eg,createInt16SharedArray:Mk,createLinearRGBTransferFunction:sk,createSigmoidRGBTransferFunction:WE,createUint16SharedArray:t2,createUint8SharedArray:e2,decimate:OB,deepMerge:TB,eventListener:KZ,generateVolumePropsFromImageIds:RB,genericMetadataProvider:x2,getBufferConfiguration:Vy,getClosestImageId:Ix,getClosestStackImageIndexForPoint:Ppe,getCurrentVolumeViewportSlice:Bpe,getImageLegacy:Zpe,getImageSliceDataForVolumeViewport:w2,getMinMax:jE,getRandomSampleFromArray:V1e,getRuntimeId:vte,getScalarDataType:Ype,getScalingParameters:_B,getSliceRange:Py,getSpacingInNormalDirection:Vg,getTargetVolumeAndSpacingInNormalDir:HT,getViewportImageCornersInWorld:Wpe,getViewportImageIds:F1e,getViewportModality:Wfe,getViewportsWithImageURI:kpe,getViewportsWithVolumeId:Vge,getVoiFromSigmoidRGBTransferFunction:ok,getVolumeActorCorners:rB,getVolumeId:nB,getVolumeSliceRangeInfo:xB,getVolumeViewportScrollInfo:ov,getVolumeViewportsContainingSameVolumes:Fge,hasFloatScalingParameters:NB,hasNaNValues:Lx,imageIdToURI:qs,imageRetrieveMetadataProvider:MB,imageToWorldCoords:Rpe,indexWithinDimensions:Pge,invertRgbTransferFunction:$h,isEqual:Pi,isEqualAbs:Ste,isEqualNegative:uk,isImageActor:Bl,isOpposite:Ete,isPTPrescaledWithSUV:dB,isValidVolume:Qpe,isVideoTransferSyntax:t1e,loadImageToCanvas:Mpe,makeVolumeMetadata:bB,planar:B1e,renderToCanvasCPU:CB,renderToCanvasGPU:hB,roundNumber:UB,roundToPrecision:k1e,scaleRgbTransferFunction:dte,snapFocalPointToSlice:og,sortImageIdsAndGetSpacing:DB,spatialRegistrationMetadataProvider:SB,transferFunctionUtils:I1e,transformIndexToWorld:iB,transformWorldToIndex:$T,triggerEvent:Kt,updateVTKImageDataWithCornerstoneImage:IB,uuidv4:pc,windowLevel:fte,worldToImageCoords:Npe},Symbol.toStringTag,{value:"Module"}));class j1e extends Ku{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=w2(this)||{};return r},this.getCurrentImageIdIndex=r=>{const{viewPlaneNormal:i,focalPoint:a}=this.getCamera(),o=this.getImageData(r);if(!o)return;const{origin:s,direction:l,spacing:c}=o,d=Vg({direction:l,spacing:c},i),f=zt();ka(f,a,s);const h=er(f,i);return Math.round(Math.abs(h)/d)},this.getSliceIndex=()=>{const{imageIndex:r}=w2(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Ca(r,"vtkVolume"))return;const{uid:i}=r,a=bt.getVolume(i);if(!a)return;const{viewPlaneNormal:o,focalPoint:s}=this.getCamera();return Ix(a,s,o)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!(r!=null&&r.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const i=r.uid,a=bt.getVolume(i),o=this.getCamera(),{focalPoint:s,position:l,viewPlaneNormal:c}=o,d=Vg(a,c),f=Py(r.actor,c,s),h=Math.round((f.current-f.min)/d),p=Math.round((f.max-f.current)/d),C=this.getSliceIndex(),x=[];for(let T=-h;T<=p;T++){const{newFocalPoint:_}=og(s,l,f,c,d,T);x.push({sliceIndex:C+T,point:_})}return x};const{orientation:n}=this.options;if(n&&n!==jl.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=bt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=bt.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,n,r)}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(Hl[e])({viewPlaneNormal:r,viewUp:i}=Hl[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}_getAcquisitionPlaneOrientation(){const e=this.getDefaultActor();if(!e)return;const n=e.uid,r=bt.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(s=>-s),o=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:a,viewUp:o}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}setBlendMode(e,n=[],r=!1){let i=this.getActors();n&&n.length>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{var l;const{actor:o}=a,s=o.getMapper();(l=s.setBlendMode)==null||l.call(s,e)}),r&&this.render()}resetCamera(e=!0,n=!0,r=!0,i=!1,a=!1,o=!0){const{orientation:s}=this.viewportProperties;s&&o&&this.applyViewOrientation(s,!1),super.resetCamera(e,n,r),this.resetVolumeViewportClippingRange();const l=this.getVtkActiveCamera(),c=l.getViewPlaneNormal(),d=l.getFocalPoint();if(this.getActors().forEach(h=>{if(!h.actor)return;const p=h.actor.getMapper();if(p.getClippingPlanes().length===0&&!(h!=null&&h.clippingFilter)){const x=Fi.newInstance(),T=Fi.newInstance(),_=[x,T];let y=Ra.MINIMUM_SLAB_THICKNESS;h.slabThickness&&(y=h.slabThickness),this.setOrientationOfClippingPlanes(_,y,c,d),p.addClippingPlane(x),p.addClippingPlane(T)}}),i&&Hl[this.viewportProperties.orientation]!==void 0){const h=Hl[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:h.viewUp,viewPlaneNormal:h.viewPlaneNormal})}if(!a){const h={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Kt(this.element,xt.CAMERA_RESET,h)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();n&&n.length>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Ca(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Ca(r,"vtkVolume")&&(r.slabThickness=Ra.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}getViewReference(e={}){const n=super.getViewReference(e);if(!(n!=null&&n.volumeId))return;const r=bt.getVolume(n.volumeId);return n.referencedImageId=Ix(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=Ra.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera()));const r=bt.getVolume(n.uid);if(!r)throw new Error(`imageVolume with id: ${n.uid} does not exist in cache`);if(PB(n.actor,r,!1),Bl(n)){const c=n.actor.getProperty().getRGBTransferFunction(0);i8(c,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera(!0,!0,!0,!0),Kt(this.element,xt.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=Ra.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const o=[Fi.newInstance(),Fi.newInstance()];return this.setOrientationOfClippingPlanes(o,r,n,i),{sliceIndex:a,planes:o.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}const Wg=j1e;function H1e(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(de.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),tl())}const $1e={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function K1e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$1e,n),bT.extend(t,e,n),de.setGet(t,e,["slice","useCustomExtents"]),de.setGetArray(t,e,["customDisplayExtent"],6),de.setGetArray(t,e,["backgroundColor"],4),H1e(t,e)}var q1e={extend:K1e};function WB(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:o}=n.getClosestIJKAxis();let s=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();o!==n.getSlicingMode()&&(s=n.getSliceAtPosition(s)),a[o]+=s;const l=[0,0,0];r.indexToWorld(a,l),a[o]+=1;const c=[0,0,0];r.indexToWorld(a,c),c[0]-=l[0],c[1]-=l[1],c[2]-=l[2],Ui(c,c);const d=Fi.intersectWithLine(t,e,l,c);if(d.intersection){const f=d.x,h=[0,0,0];return r.worldToIndex(f,h),{t:d.t,absoluteIJK:h}}return null}function X1e(t,e,n){const r=WB(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||o[2]<a[4]||o[2]>a[5]?null:{t:r.t,ijk:o}}return null}function Y1e(t,e,n){const r=WB(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=r.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<a[0]||s[0]>a[1]-1||s[1]<a[2]||s[1]>a[3]-1||s[2]<a[4]||s[2]>(a[5]?a[5]-1:a[5]))return null;const l=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:r.t,ijk:s,pCoords:l}}return null}const{staticOffsetAPI:J1e,otherStaticMethods:Z1e}=Ny,{SlicingMode:Rn}=Ay;function Q1e(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const d=i.getBounds();switch(e.slicingMode){case Rn.X:a=[r,(d[3]+d[2])/2,(d[5]+d[4])/2];break;case Rn.Y:a=[(d[1]+d[0])/2,r,(d[5]+d[4])/2];break;case Rn.Z:a=[(d[1]+d[0])/2,(d[3]+d[2])/2,r];break}}const o=[0,0,0];i.worldToIndex(a,o);const s=i.getExtent(),{ijkMode:l}=t.getClosestIJKAxis();let c=0;switch(l){case Rn.I:c=ro(o[0],s[0],s[1]);break;case Rn.J:c=ro(o[1],s[2],s[3]);break;case Rn.K:c=ro(o[2],s[4],s[5]);break;default:return 0}return c},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case Rn.I:case Rn.J:case Rn.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case Rn.X:t.setSlice(i[0]);break;case Rn.Y:t.setSlice(i[1]);break;case Rn.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(Rn.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(Rn.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(Rn.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(Rn.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(Rn.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(Rn.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Rn.X:r[0]=1;break;case Rn.Y:r[1]=1;break;case Rn.Z:r[2]=1;break;case Rn.I:qh(i,[1,0,0],r);break;case Rn.J:qh(i,[0,1,0],r);break;case Rn.K:qh(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case Rn.X:r=0;break;case Rn.Y:r=1;break;case Rn.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=kE(i);let o=0;for(;o<3&&a[r+3*o]===0;++o);const s=a[r+3*o]<0;e.closestIJKAxis={ijkMode:o,flip:s}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Rn.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return tl();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let o=e.slice;switch(a!==e.slicingMode&&(o=t.getSliceAtPosition(e.slice)),a){case Rn.I:i[0]=o,i[1]=o;break;case Rn.J:i[2]=o,i[3]=o;break;case Rn.K:i[4]=o,i[5]=o;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return tl();const o=a.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let l=r;switch(s!==e.slicingMode&&(l=t.getSliceAtPosition(r)),s){case Rn.I:o[0]=l-i,o[1]=l+i;break;case Rn.J:o[2]=l-i,o[3]=l+i;break;case Rn.K:o[4]=l-i,o[5]=l+i;break}return a.extentToBounds(o)},t.intersectWithLineForPointPicking=(r,i)=>X1e(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>Y1e(r,i,t),t.getCurrentImage=()=>t.getInputData()}const eme={slicingMode:Rn.NONE,closestIJKAxis:{ijkMode:Rn.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function jB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eme,n),q1e.extend(t,e,n),de.get(t,e,["slicingMode"]),de.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),Ny.implementCoincidentTopologyMethods(t,e),Q1e(t,e)}const tme=de.newInstance(jB,"vtkImageMapper");var nme={newInstance:tme,extend:jB,...J1e,...Z1e,...Ay};const{InterpolationType:cv}=Jce,{vtkErrorMacro:ZO}=de,uv=4;function rme(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<uv;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=uv)return ZO("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=uv?(ZO("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(cv.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(cv.LINEAR),t.getInterpolationTypeAsString=()=>de.enumToString(cv,e.interpolationType)}const ime={independentComponents:!1,interpolationType:cv.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function HB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,ime,n),de.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<uv;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}de.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),de.setGetArray(t,e,["labelOutlineThickness"]),rme(t,e)}const ame=de.newInstance(HB,"vtkImageProperty");var ome={newInstance:ame,extend:HB};const{vtkDebugMacro:sme}=de;function lme(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=ome.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){sme("Recomputing bounds..."),e.mapperBounds=n.map(a=>a),t.computeMatrix();const i=new Float64Array(16);yn(i,e.matrix),Gn.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!Gn.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return yn(a,e.matrix),Gn.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const cme={mapper:null,property:null,bounds:[...Gn.INIT_BOUNDS]};function $B(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cme,n),VT.extend(t,e,n),e.boundsMTime={},de.obj(e.boundsMTime),de.set(t,e,["property"]),de.setGet(t,e,["mapper"]),de.getArray(t,e,["bounds"],6),lme(t,e)}const ume=de.newInstance($B,"vtkImageSlice");var fme={newInstance:ume,extend:$B};function KB(t){return Bg(t)}function Em(t,e){const n=KB(t);return n.invert(),n.transformPoint(e)}function QO(t,e){return KB(t).transformPoint(e)}function dme(t){const{image:e}=t;t.viewport.scale=qT(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function hme(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function gme(t,e,n){const r=t.viewport.scale,i=gB(t.image,t.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r),s=t.viewport.translation.x,l=t.viewport.translation.y;return a===e&&o<=n||a<=e&&o===n&&s===0&&l===0}function pme(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,o=i/e,s=a/n,l=Math.sqrt(o*s);t.viewport.scale=l*r}function mme(t,e=!1){const n=t.canvas.width,r=t.canvas.height;hme(t),t.image!==void 0&&(e||gme(t,n,r)?dme(t):pme(t,n,r))}const eM=[{id:"initialImages",retrieveType:"single"},{id:"errorRetrieve"}],vme=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],k4=[{offset:-1,imageQualityStatus:Hh.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:Hh.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:Hh.FAR_REPLICATE}],yme=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Tr.Thumbnail,priority:5,nearbyFrames:k4},{id:"quarterThumb",decimate:4,offset:3,requestType:Tr.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:k4},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Tr.Thumbnail,retrieveType:"multipleFast",nearbyFrames:k4},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Tr.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Tr.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Tr.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Tr.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function wme(t,e,n,r,i){var p;if(!((p=n==null?void 0:n.nearbyRequests)!=null&&p.length))return;const{arrayBuffer:a,offset:o,type:s,length:l}=i.targetBuffer;if(!a||o===void 0||!s)return;const c=new Float32Array(a),d=c.byteLength/c.length,f=i.targetBuffer.offset/d,h=c.slice(f,f+l);for(const C of n.nearbyRequests)try{const{itemId:x,imageQualityStatus:T}=C,_=e.get(x);if(_!==void 0&&_>=T)continue;const y=t.getLoaderImageOptions(x),{offset:w}=y.targetBuffer;c.set(h,w/d);const b={...r,imageQualityStatus:T};t.successCallback(x,b),e.set(x,T)}catch(x){console.log("Couldn't fill nearby item ",C.itemId,x)}}const hf=class hf{constructor(e){this.stages=e.stages||eM,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new Cme(this,e,n).loadImages()}};hf.createProgressive=qB,hf.interleavedRetrieveStages={stages:yme},hf.singleRetrieveStages={stages:eM},hf.sequentialRetrieveStages={stages:vme};let T2=hf;class Cme{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.imageQualityStatusMap=new Map,this.displayedIterator=new zg("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(d,f)=>{this.listener.errorCallback(r,l||!i,d),f&&this.updateStageStatus(e.stage,d)},o=(n.loader||Vu)(r,n),s=zg.as(o);let l=!1;return s.forEach(async(d,f)=>{const h=this.imageQualityStatusMap.get(r);if(!d){console.warn("No image retrieved",r);return}const{imageQualityStatus:p}=d;if(l||(l=p===Hh.FULL_RESOLUTION),h!==void 0&&h>p){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,d),this.imageQualityStatusMap.set(r,p),this.displayedIterator.add(d),f&&this.updateStageStatus(e.stage),wme(this.listener,this.imageQualityStatusMap,e,d,n)},a).finally(()=>{if(!l&&i)bt.getImageLoadObject(r)&&bt.removeImageLoadObject(r),this.addRequest(i,n.streamingData);else{l||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let d=i;d;d=d.next)this.updateStageStatus(d.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(d=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:o="default"}=i,{retrieveOptions:s}=this,l=s[o]||s.default,c={...a,retrieveType:o,retrieveOptions:l,streamingData:n},d=i.priority??-5,f=i.requestType||Tr.Interaction,h={imageId:r};ho.addRequest(this.sendRequest.bind(this,e,c),f,h,d)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:o,totalImageCount:s,stageStartTime:l=Date.now(),startTime:c}=a,d={stageId:i,numberOfFailures:o,numberOfImages:s,stageDurationInMS:l?Date.now()-l:null,startDurationInMS:Date.now()-c};Kt(Hn,xt.IMAGE_RETRIEVAL_STAGE,d),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const o=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,s=this.imageIds[o];if(!s)throw new Error(`No value found to add to requests at ${a}`);const l={imageId:s,stage:i,nearbyRequests:this.findNearbyRequests(o,i)};this.addStageStatus(i);const c=n.get(s);c?c.next=l:e.push(l),n.set(s,l)};for(const i of this.stages)(i.positions||OB(this.imageIds,i.decimate||1,i.offset??0)).forEach(o=>r(i,o));return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function qB(t){return new T2(t)}const xme=T2;function Sme(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,o=Math.cos(a),s=Math.sin(a),l=t.x*o-t.y*s,c=t.x*s+t.y*o;t.x=l,t.y=c}return t}function Eme(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,o=qT(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=o)}const Tme=1;class _me extends vp{constructor(e){super(e),this.imagesLoader=this,this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.useNativeDataType=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&mme(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>{var r;return(r=this.getImagePlaneReferenceData(n))==null?void 0:r.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=nme.newInstance();r.setInputData(n);const i=fme.newInstance();i.setMapper(r);const{preferSizeOverAccuracy:a}=vs().rendering;return a&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties,rotation:this.getRotation()}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,voiUpdatedWithSetProperties:s}=this,l=this.getRotation();return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,rotation:l,isComputedVOI:!s}},this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i}=this.getCamera(),a=i?rc(zt(),this.initialViewUp):this.initialViewUp,o=rT(a,n)*180/Math.PI,s=Xr(zt(),a,n);return er(s,r)>=0?o:(360-o)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:n};Kt(this.element,xt.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{var r;n.isPreScaled=(r=n.preScale)==null?void 0:r.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=Em(this._cpuFallbackEnabledElement,n),{origin:o,spacing:s,direction:l}=this.getImageData(),c=l.slice(0,3),d=l.slice(3,6);return Li(r,o,c,i*s[0]),Li(r,r,d,a*s[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),o=i.slice(0,3),s=i.slice(3,6),l=Er(zt(),n,a),c=[er(l,o)/r[0],er(l,s)/r[1]];return QO(this._cpuFallbackEnabledElement,c)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),c=l.getSize(),d=window.devicePixelRatio||1,f=[n[0]*d,n[1]*d],h=[f[0]+this.sx,f[1]+this.sy];h[1]=c[1]-h[1];const p=l.displayToWorld(h[0],h[1],0,r);return i.setClippingRange(a[0],a[1]),[p[0],p[1],p[2]]},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),c=l.getSize(),d=l.worldToDisplay(...n,r);d[1]=c[1]-d[1];const f=[d[0]-this.sx,d[1]-this.sy];i.setClippingRange(a[0],a[1]);const h=window.devicePixelRatio||1;return[f[0]/h,f[1]/h]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=n=>this.imageIds.includes(n),this.hasImageURI=n=>{const r=this.imageIds;for(let i=0;i<r.length;i++)if(qs(r[i])===n)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(wB(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n=!0,r=!0)=>(this.resetCameraCPU(n,r),!0),gpu:(n=!0,r=!0)=>(this.resetCameraGPU(n,r),!0)},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=xf(),this.useNativeDataType=this._shouldUseNativeDataType(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.cameraFocalPointOnRender=[0,0,0],this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return xf()}_configureRenderingPipeline(e){this.useNativeDataType=this._shouldUseNativeDataType(),this.useCPURendering=e??xf();for(const[n,r]of Object.entries(this.renderingPipelineFunctions))this[n]=this.useCPURendering?r.cpu:r.gpu;this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new rd,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=RT.newInstance();e.setActiveCamera(n);const r=[0,0,-1];this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-r[0],-r[1],-r[2]),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){Hn.addEventListener(xt.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Hn.removeEventListener(xt.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!Bl(e))return;const{actor:n}=e,r=n.getMapper().getInputData();return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),scalarData:r.getPointData().getScalars().getData(),imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...this.csImage.calibration,...this.calibration},preScale:{...this.csImage.preScale}}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement,n=e.spacing;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:r=>{const i=this.worldToCanvasCPU(r),a=Em(this._cpuFallbackEnabledElement,i);return[a[0],a[1],0]},indexToWorld:(r,i)=>{const a=QO(this._cpuFallbackEnabledElement,[r[0],r[1]]);return this.canvasToWorldCPU(a,i)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...this.csImage.calibration,...this.calibration},preScale:{...this.csImage.preScale}}}buildMetadata(e){const n=e.imageId,{pixelRepresentation:r,bitsAllocated:i,bitsStored:a,highBit:o,photometricInterpretation:s,samplesPerPixel:l}=tn("imagePixelModule",n),{windowWidth:c,windowCenter:d,voiLUTFunction:f}=e,{modality:h}=tn("generalSeriesModule",n),p=tn("scalingModule",n),C=tn(ls.CALIBRATION,n);h==="PT"&&p&&this._addScalingToViewport(p),this.modality=h;const x=this._getValidVOILUTFunction(f);this.VOILUTFunction=x,this.calibration=C;let T=this._getImagePlaneModule(n);return this.useCPURendering||(T=this.calibrateIfNecessary(n,T)),{imagePlaneModule:T,imagePixelModule:{bitsAllocated:i,bitsStored:a,samplesPerPixel:l,highBit:o,photometricInterpretation:s,pixelRepresentation:r,windowWidth:c,windowCenter:d,modality:h,voiLUTFunction:x}}}calibrateIfNecessary(e,n){const r=tn("calibratedPixelSpacing",e),i=this.calibration!==r,{scale:a}=r||{};return this.hasPixelSpacing=a>0||n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a,rotation:o}={},s=!1){this.viewportStatus=this.csImage?Ma.PRE_RENDER:Ma.LOADING,this.globalDefaultProperties==null&&this.setDefaultProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a,rotation:o}),typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:s,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,s),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a),typeof o<"u"&&this.getRotation()!==o&&this.setRotation(o)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Ma.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(wu.LINEAR),this.getRotation()!==0&&this.setRotation(0);const n=this.getTransferFunction();i8(n,this.initialTransferFunctionNodes);const i=E2(n).reduce((s,l)=>(s.push(l[0],l[1],l[2],l[3]),s),[]),a=this.getDefaultActor(),o=r8(i,a.actor);this.setColormap(o)}resetToDefaultProperties(){var i;this.cpuRenderingInvalidated=!0,this.viewportStatus=Ma.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(i=n.colormap)!=null&&i.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.getRotation()!==0&&this.setRotation(0),this.setInterpolationType(wu.LINEAR),this.setInvertColor(!1),this.render()}_setPropertiesFromCache(){const{interpolationType:e,invert:n}=this;let r;this.voiUpdatedWithSetProperties?r=this.voiRange:this._isCurrentImagePTPrescaled()?r=this._getDefaultPTPrescaledVOIRange():r=this._getVOIRangeForCurrentImage()??this.voiRange,this.setVOI(r),this.setInterpolationType(e),this.setInvertColor(n)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement,{direction:r}=e,i=r.slice(6,9).map(f=>-f);let a=r.slice(3,6).map(f=>-f);if(n.rotation){const f=ZE(vc(),n.rotation*Math.PI/180,i);a=vn(zt(),a,f)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),l=this.canvasToWorld([0,0]),c=this.canvasToWorld([0,this.element.clientHeight]),d=Sy(l,c)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:d,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:o,scale:s,flipHorizontal:l,flipVertical:c}=e,{clientHeight:d}=this.element;if(a){const h=this.worldToCanvasCPU(a),p=Em(this._cpuFallbackEnabledElement,h),C=this.worldToCanvasCPU(i.focalPoint),x=Em(this._cpuFallbackEnabledElement,C),T=dT();kg(T,Cx(p[0],p[1]),Cx(x[0],x[1]));const _=Sme({x:T[0],y:T[1]},n);n.translation.x-=_.x,n.translation.y-=_.y}if(o){const{rowPixelSpacing:h}=r,p=d*h*.5/o;n.scale=p,n.parallelScale=o}if(s){const{rowPixelSpacing:h}=r;n.scale=s,n.parallelScale=d*h*.5/s}(l!==void 0||c!==void 0)&&this.setFlipCPU({flipHorizontal:l,flipVertical:c}),this._cpuFallbackEnabledElement.transform=Bg(this._cpuFallbackEnabledElement);const f={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.getRotation()};Kt(this.element,xt.CAMERA_MODIFIED,f)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=Pg([0,0],n,r);this.setPan(i,!1);const{flipVertical:a}=this.getCamera(),o=a?rc(zt(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:o}),this.getVtkActiveCamera().roll(-e);const s=this.getPan(),l=this.getPan(this.fitToCanvasCamera),c=Pg([0,0],s,l),d=_y([0,0],n,c);this.setPan(d,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!Bl(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==wu.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&Bl(n)){if(Ca(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&$h(i),this.invert=e}else if(Ca(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&$h(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:l}=a,c=Array.isArray(s)?s[0]:s,d=Array.isArray(l)?l[0]:l;i.voi={windowWidth:c,windowCenter:d};const{lower:f,upper:h}=Jh(c,d);e={lower:f,upper:h}}else{const{lower:s,upper:l}=e,{windowCenter:c,windowWidth:d}=zE(s,l);i.voi||(i.voi={windowWidth:0,windowCenter:0}),i.voi.windowWidth=d,i.voi.windowCenter=c}this.voiRange=e;const o={viewportId:this.id,range:e};r||Kt(this.element,xt.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();return!e||!Bl(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o||!Bl(o))return;const s=o.actor;let l=e;if(typeof l>"u"){const p=s.getMapper().getInputData().getPointData().getScalars().getRange();l={lower:p[0],upper:p[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let c=s.getProperty().getRGBTransferFunction(0);const d=this.VOILUTFunction===Du.SAMPLED_SIGMOID;if((d||!c||i)&&(c=(d?WE:sk)(l),this.invert&&$h(c),s.getProperty().setRGBTransferFunction(0,c),this.initialTransferFunctionNodes=E2(c)),d||c.setRange(l.lower,l.upper),this.voiRange=l,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const f={viewportId:this.id,range:l,VOILUTFunction:this.VOILUTFunction};Kt(this.element,xt.VOI_MODIFIED,f)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.indexOf("YBR")!==-1||e==="PALETTE COLOR")&&(n=3),n}getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e);let i,a;i=n.rowCosines,a=n.columnCosines,(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=wa(i[0],i[1],i[2]),s=wa(a[0],a[1],a[2]),l=zt();Xr(l,o,s);let c=n.imagePositionPatient;c==null&&(c=[0,0,0]);const d=n.columnPixelSpacing||e.columnPixelSpacing,f=n.rowPixelSpacing||e.rowPixelSpacing,h=e.columns,p=e.rows,C=Tme,x=1,T=e.numComps||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numComps:T,origin:c,direction:[...o,...s,...l],dimensions:[h,p,x],spacing:[d,f,C],numVoxels:h*p*x,imagePlaneModule:n,imagePixelModule:r}}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=tn(ls.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:o,columnCosines:s}=r;o||(o=[1,0,0]),s||(s=[0,1,0]);const l=Xr([0,0,0],s,o);return{FrameOfReferenceUID:a,viewPlaneNormal:l,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numComps:a,pixelArray:o}){const s=new o.constructor(o.length),l=Bt.newInstance({name:"Pixels",numberOfComponents:a,values:s}),c=yc.newInstance();return c.setDimensions(r),c.setSpacing(i),c.setDirection(n),c.setOrigin(e),c.getPointData().setScalars(l),c}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numComps:a,pixelArray:o}){this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numComps:a,pixelArray:o})}async setStack(e,n=0){this._throwIfDestroyed(),this.imageIds=e,this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=tn(MB.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||qB)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=wu.LINEAR,this.invert=!1,this.viewportStatus=Ma.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return Kt(Hn,xt.STACK_VIEWPORT_NEW_STACK,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),l=n.getDirection(),c=l.slice(0,3),d=l.slice(3,6),f=n.getPointData().getScalars().getDataType(),h=Pi(r,e.columnPixelSpacing),p=Pi(i,e.rowPixelSpacing);return(h||e.columnPixelSpacing===null&&r===1)&&(p||e.rowPixelSpacing===null&&i===1)&&a===e.columns&&o===e.rows&&Pi(s.rowCosines,c)&&Pi(s.columnCosines,d)&&(!this.useNativeDataType||f===e.getPixelData().constructor.name)}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r),IB(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(p,C,x){if(this.currentImageIdIndex!==C)return;const T=p.getPixelData(),_=p.preScale,y=_==null?void 0:_.scalingParameters,w=(_==null?void 0:_.scaled)&&(y==null?void 0:y.rescaleIntercept)%1!==0||(y==null?void 0:y.rescaleSlope)%1!==0;if(T instanceof Float32Array&&w){const M={min:p.maxPixelValue,max:p.minPixelValue},k=Math.abs(M.max-M.min)/65535,U=M.min,B=T.length,z=new Uint16Array(B);let K=65535,J=0;for(let X=0;X<B;X++){const re=Math.floor((T[X]-U)/k);z[X]=re,K=Math.min(K,re),J=Math.max(J,re)}p.minPixelValue=K,p.maxPixelValue=J,p.slope=k,p.intercept=U,p.getPixelData=()=>z,p.preScale={...p.preScale,scaled:!1}}this._setCSImage(p),this.viewportStatus=Ma.PRE_RENDER;const b={image:p,imageId:x,imageIdIndex:C,viewportId:this.id,renderingEngineId:this.renderingEngineId};Kt(this.element,xt.STACK_NEW_IMAGE,b),this._updateToDisplayImageCPU(p),this.render(),this.currentImageIdIndex=C,r(x)}function o(p,C,x){const T={error:p,imageIdIndex:C,imageId:x};this.suppressEvents||Kt(Hn,xt.IMAGE_LOAD_ERROR,T),i(p)}function s(p,C,x){return Vu(p,x).then(T=>{a.call(this,T,C,p)},T=>{o.call(this,T,C,p)})}const l=-5,c=Tr.Interaction,d={imageId:e,imageIdIndex:n},f={preScale:{enabled:!0},useRGBA:!0,requestType:c},h={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};Kt(this.element,xt.PRE_STACK_NEW_IMAGE,h),ho.addRequest(s.bind(this,e,n,f),c,d,l)})}successCallback(e,n){var c,d;const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=(c=this.csImage)==null?void 0:c.imageFrame,a=n==null?void 0:n.imageFrame,o=(i==null?void 0:i.photometricInterpretation)||((d=this.csImage)==null?void 0:d.photometricInterpretation),s=(a==null?void 0:a.photometricInterpretation)||(n==null?void 0:n.photometricInterpretation);o!==s&&(this.stackInvalidated=!0),this._setCSImage(n);const l={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),Kt(this.element,xt.STACK_NEW_IMAGE,l),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};Kt(Hn,xt.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=tn("transferSyntax",e)||{},i={imageId:e,imageIdIndex:n};return{targetBuffer:{type:this.useNativeDataType?void 0:"Float32Array"},preScale:{enabled:!0},useRGBA:!1,transferSyntaxUID:r,useNativeDataType:this.useNativeDataType,priority:5,requestType:Tr.Interaction,additionalDetails:i}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const o=this.getLoaderImageOptions(a);return Vu(a,o).then(s=>(n.successCallback(a,s),a),s=>(n.errorCallback(a,!0,s),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(xt.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Hn.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Kt(this.element,xt.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=pB(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a}=r.voi;this.voiRange=Jh(a,i),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.getPixelData();const o=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:o,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=Bg(this._cpuFallbackEnabledElement)}addImages(e){const n=this.getActors();e.forEach(r=>{const i=bt.getImage(r.imageId),{origin:a,dimensions:o,direction:s,spacing:l,numComps:c}=this.getImageDataMetadata(i),d=this.createVTKImageData({origin:a,dimensions:o,direction:s,spacing:l,numComps:c,pixelArray:i.getPixelData()}),f=this.createActorMapper(d);f&&(n.push({uid:r.actorUID,actor:f}),r.callback&&r.callback({imageActor:f,imageId:r.imageId}))}),this.setActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getRenderer().getActiveCamera(),i=Oo(this.getCamera());if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e);const _=this.getCamera(),y=Er(zt(),this.cameraFocalPointOnRender,_.focalPoint);this.resetCameraNoEvent(),this.setCameraNoEvent({flipHorizontal:i.flipHorizontal,flipVertical:i.flipVertical,viewUp:i.viewUp});const{focalPoint:w}=this.getCamera();this.cameraFocalPointOnRender=w,r.setFreezeFocalPoint(!0),this._restoreCameraProps(_,i,y),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:a,direction:o,dimensions:s,spacing:l,numComps:c,imagePixelModule:d}=this.getImageDataMetadata(e),f=e.getPixelData();this._createVTKImageData({origin:a,direction:o,dimensions:s,spacing:l,numComps:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const h=this.createActorMapper(this._imageData),p=this.getActors();p.length&&p[0].uid===this.id?p[0].actor=h:p.unshift({uid:this.id,actor:h}),this.setActors(p);const{viewPlaneNormal:C,viewUp:x}=this._getCameraOrientation(o);this.setCameraNoEvent({viewUp:x,viewPlaneNormal:C}),this.initialViewUp=x,this.resetCameraNoEvent(),this.triggerCameraEvent(this.getCamera(),i),r.setFreezeFocalPoint(!0);const T=d.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0,this.setVOI(this._getInitialVOIRange(e),{forceRecreateLUTFunction:!!T}),this.initialInvert=!!T,this.setInvertColor(this.invert||this.initialInvert),this.cameraFocalPointOnRender=this.getCamera().focalPoint,this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.globalDefaultProperties.voiRange;const{windowCenter:n,windowWidth:r}=e;let i=this._getVOIRangeFromWindowLevel(r,n);return i=this._getPTPreScaledRange()||i,i}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e,n;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((n=(e=this.csImage.preScale)==null?void 0:e.scalingParameters)!=null&&n.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n){let r,i;if(typeof n=="number"&&typeof e=="number"?(r=n,i=e):Array.isArray(n)&&Array.isArray(e)&&(r=n[0],i=e[0]),r!==void 0&&i!==void 0)return Jh(i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Ma.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU(e,n){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;Eme(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:o}=this.element,s=[a/2,o/2],l=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:l,scale:i})}resetCameraGPU(e,n){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera(e,n,!0)}scroll(e,n=!0,r=!1){const i=this.imageIds,a=this.targetImageIdIndex,o=i.length;let s=a+e;s=Math.max(0,s),r?s=s%o:s=Math.min(o-1,s),this.targetImageIdIndex=s;const l=i[s];bt.isLoaded(l)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const d={newImageIdIndex:s,imageId:l,direction:e};s!==a&&Kt(this.element,xt.STACK_VIEWPORT_SCROLL,d)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}_restoreCameraProps({parallelScale:e},n,r){const i=this.getRenderer(),{position:a,focalPoint:o}=this.getCamera(),s=Er(zt(),a,r),l=Er(zt(),o,r);this.setCameraNoEvent({parallelScale:e,position:s,focalPoint:l});const c=this.getCamera();this.triggerCameraEvent(c,n);const d={type:"ResetCameraEvent",renderer:i};i.invokeEvent(d)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Kt(this.element,xt.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Kt(this.element,xt.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e)}_getValidVOILUTFunction(e){return Object.values(Du).indexOf(e)===-1&&(e=Du.LINEAR),e}isReferenceViewable(e,n={}){if(!super.isReferenceViewable(e,n))return!1;let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a}=e;if(e.volumeId&&!i)return n.asVolume===!0;let o=this.getCurrentImageIdIndex();n.withNavigation&&typeof a=="number"&&(o=a);const s=this.imageIds[o];if(!s)return!1;if(!r){const l=s.indexOf(":");r=s.substring(l+1)}return i==null?void 0:i.endsWith(r)}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.imageIds[n];if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!e)return;const{referencedImageId:n,sliceIndex:r}=e;if(typeof r=="number"&&n&&n===this.imageIds[r])this.scroll(r-this.targetImageIdIndex);else{const i=this.imageIds.indexOf(n);if(i!==-1)this.scroll(i-this.targetImageIdIndex);else throw new Error("Unsupported - referenced image id not found")}}getReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;if(Array.isArray(n))throw new Error("Use of slice ranges for stacks not supported");return`imageId:${this.imageIds[n]}`}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=yB(e.name,e);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};Kt(this.element,xt.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),o=Uy(e.name)||S2.getPresetByName(e.name);if(a)a.applyColorMap(o),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const l=uc.newInstance();l.applyColorMap(o),l.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,l)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Kt(this.element,xt.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var i,a;const n=tn(ls.IMAGE_PLANE,e);this.calibration||(this.calibration=n.calibration);const r={...n};return r.columnPixelSpacing||(r.columnPixelSpacing=1,this.hasPixelSpacing=((i=this.calibration)==null?void 0:i.scale)>0),r.rowPixelSpacing||(r.rowPixelSpacing=1,this.hasPixelSpacing=((a=this.calibration)==null?void 0:a.scale)>0),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}const jg=_me;class Dme extends Ku{constructor(e){super(e),this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>{},this.getCurrentImageId=()=>null;const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==jl.ACQUISITION&&this.applyViewOrientation(r)}resetCamera(e=!0,n=!0,r=!0){super.resetCamera(e,n,r),this.resetVolumeViewportClippingRange()}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){return null}resetSlabThickness(){return null}}const s8=Dme;class bme{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class Ime{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class Ome{constructor(e,n){this.canvasProperties=new bme(this),this.visibility=!1,this.mapper=new Ime(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:o}=this;(!o||o.width!==i||o.height!==a)&&(this.canvas=o=new window.OffscreenCanvas(i,a));const s=o.getContext("2d"),l=s.createImageData(i,a),{data:c}=l;c.fill(0);const{map:d}=r;let f=1/0,h=1/0,p=-1/0,C=-1/0;for(let _=0;_<a;_++){const y=d.getRun(_,0);if(!y)continue;h=Math.min(h,_),C=Math.max(C,_);const w=_*i<<2;let b;for(const M of y){const{start:I,end:A,value:k}=M;if(k===0){b||(b=[]),b.push(y.indexOf(M));continue}f=Math.min(f,I),p=Math.max(p,A);const U=this.canvasProperties.getColor(k).map(z=>z*255);let B=w+(I<<2);for(let z=I;z<A;z++)c[B++]=U[0],c[B++]=U[1],c[B++]=U[2],c[B++]=U[3]}}if(f>i)return;const x=p-f,T=C-h;s.putImageData(l,0,0,f-1,h-1,x+2,T+2),n.drawImage(o,f,h,x,T,f,h,x,T)}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,o=r.getScalarData();if(!o)return;const{voxelManager:s}=r;if(s&&s.map.getRun)return this.renderRLE(e,n,s);let{canvas:l}=this;(!l||l.width!==i||l.height!==a)&&(this.canvas=l=new window.OffscreenCanvas(i,a));const c=l.getContext("2d"),d=c.createImageData(i,a),{data:f}=d;let h=0,p=0,C=1/0,x=1/0,T=-1/0,_=-1/0;for(let b=0;b<a;b++)for(let M=0;M<i;M++){const I=o[h++];if(I){C=Math.min(M,C),x=Math.min(b,x),T=Math.max(M,T),_=Math.max(b,_);const A=this.canvasProperties.getColor(I);f[p]=A[0]*255,f[p+1]=A[1]*255,f[p+2]=A[2]*255,f[p+3]=127}p+=4}if(C>i)return;const y=T-C+1,w=_-x+1;c.putImageData(d,0,0,C,x,y,w),n.drawImage(l,C,x,y,w,C,x,y,w)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>{var n;return(n=this.derivedImage)==null?void 0:n.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}const lg=class lg extends vp{constructor(e){super({...e,canvas:e.canvas||os(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying===!1&&this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying===!1&&this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),o=[i[0]*a,i[1]*a],s=[n[0]-o[0],n[1]-o[1]];return r.splice(0,2,s[0]/a,s[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var o;const r=this.getTransform().getMatrix(),i=this.canvasContext;i.resetTransform(),i.transform(r[0],r[1],r[2],r[3],r[4],r[5]),i.drawImage(this.videoElement,0,0,this.videoWidth||1024,this.videoHeight||1024);for(const s of this.getActors())s.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Kt(this.element,xt.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Kt(this.element,xt.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(o=this.initialRender)==null||o.call(this);const a=this.getFrameNumber();this.isPlaying&&(a<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):a>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(xt.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(xt.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=tn(ls.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=wa(i[0],i[1],i[2]),s=wa(a[0],a[1],a[2]),{rows:l,columns:c}=r,d=zt();Xr(d,o,s);let f=r.imagePositionPatient;f==null&&(f=[0,0,0]);const h=r.columnPixelSpacing||1,p=r.rowPixelSpacing||1,C=r.columns,x=r.rows,T=1,_=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numComps:3,origin:f,rows:l,columns:c,direction:[...o,...s,...d],dimensions:[C,x,_],spacing:[h,p,T],hasPixelSpacing:this.hasPixelSpacing,numVoxels:C*x*_,imagePlaneModule:r}}setDataIds(e,n){var r;this.setVideo(e[0],(((r=n==null?void 0:n.viewReference)==null?void 0:r.sliceIndex)||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=tn(ls.IMAGE_URL,e);if(!(r!=null&&r.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=tn(ls.GENERAL_SERIES,e);this.modality=a==null?void 0:a.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:o,numberOfFrames:s}=tn(ls.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(o||30))),o||(o=Math.round(s/this.videoElement.duration)),this.fps=o,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(l=>{window.setTimeout(()=>{this.setFrameNumber(n||1),l(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const o=s=>{r(),n.removeEventListener("seeked",o)};n.addEventListener("seeked",o)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=Og.FRAME){this.scrollSpeed=n===Og.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var a;if(((a=this.scalarData)==null?void 0:a.frameNumber)===this.getFrameNumber())return this.scalarData;const e=document.createElement("canvas");e.width=this.videoWidth,e.height=this.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,this.videoWidth,this.videoHeight).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:i=>{const a=this.worldToCanvas(i),o=this.canvasToIndex(a);return[o[0],o[1],0]},indexToWorld:(i,a)=>{const o=this.indexToCanvas([i[0],i[1]]);return this.canvasToWorld(o,a)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),r}hasImageURI(e){const n=e.match(lg.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.indexOf(r)!==-1}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],n=Math.max(...e),r=e.map(l=>n/l),{lower:i=0,upper:a=255}=this.voiRange||{},o=(a-i+1)/255,s=i/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${r[0]*o} 0 0 0 ${s}           0 ${r[1]*o} 0 0 ${s}           0 0 ${r[2]*o} 0 ${s}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying===!1&&this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a}=e;if(!super.isReferenceViewable(e))return!1;const o=this.getCurrentImageId();if(!r){const f=o.indexOf(":");r=o.substring(f+1,o.length-1)}if(n.withNavigation)return!0;const s=this.getSliceIndex();if(Array.isArray(a))return s>=a[0]&&s<=a[1];if(a!==void 0)return s===a;if(!i)return!1;const l=i.match(lg.frameRangeExtractor);if(!l||!l[2])return!0;const c=l[2].split("-").map(f=>Number(f)),d=s+1;return c[0]<=d&&d<=(c[1]??c[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let n=e==null?void 0:e.sliceIndex;return n||(n=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getReferenceId(e),sliceIndex:n}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,o=i/e,s=a/e;this.videoCamera.panWorld=[o,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],o=[a[0]*i,a[1]*i],s=new rd;return s.scale(n,n),s.translate(a[0],a[1]),s.scale(r,r),s.translate(e[0],e[1]),s.translate(-o[0],-o[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const i=bt.getImage(r.imageId),a=this.createActorMapper(i);a&&(n.push({uid:r.actorUID,actor:a}),r.callback&&r.callback({imageActor:a,imageId:r.imageId}))}),this.setActors(n)}createActorMapper(e){return new Ome(this,e)}};lg.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Vx=lg;const XB=Vx,tM=Symbol.for("map"),Mme="postrender",H2=class H2 extends vp{constructor(e){super({...e,canvas:e.canvas||os(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const[i,a]=this.canvasToIndex(r),{origin:o,spacing:s,direction:l}=this.getImageData(),c=wa(0,0,0),d=l.slice(0,3),f=l.slice(3,6);return Li(c,o,d,i*s[0]),Li(c,c,f,a*s[1]),[c[0],c[1],c[2]]},this.worldToCanvas=r=>{if(!this.metadata)return;const{spacing:i,direction:a,origin:o}=this.metadata,s=a.slice(0,3),l=a.slice(3,6),c=Er([0,0,0],r,o),d=[er(c,s)/i[0],er(c,l)/i[1]];return this.indexToCanvas(d)},this.postrender=()=>{this.refreshRenderValues(),Kt(this.element,xt.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();return i.invert(),i.transformPoint(r)},this.indexToCanvas=r=>this.getTransform().transformPoint(r),this.customRenderViewportToCanvas=()=>{},this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.id=pc(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(xt.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(xt.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners()}getImageDataMetadata(e=0){var U;const n=this.metadataDicomweb.reduce((B,z)=>(B==null?void 0:B.NumberOfFrames)<z.NumberOfFrames?z:B),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:o,ImagedVolumeHeight:s,ImagedVolumeDepth:l}=n,c=tn(ls.IMAGE_PLANE,this.imageIds[e]);let d=a.slice(0,3),f=a.slice(3,6);(d==null||f==null)&&(d=[1,0,0],f=[0,1,0]);const h=wa(d[0],d[1],d[2]),p=wa(f[0],f[1],f[2]),C=zt();Xr(C,h,p);const{XOffsetInSlideCoordinateSystem:x=0,YOffsetInSlideCoordinateSystem:T=0,ZOffsetInSlideCoordinateSystem:_=0}=((U=n.TotalPixelMatrixOriginSequence)==null?void 0:U[0])||{},y=[x,T,_],w=o/r,b=s/i,M=r,I=i,A=l,k=1;return this.hasPixelSpacing=!!(o&&s),{bitsAllocated:8,numComps:3,origin:y,direction:[...h,...p,...C],dimensions:[M,I,k],spacing:[w,b,A],hasPixelSpacing:this.hasPixelSpacing,numVoxels:M*I*k,imagePlaneModule:c}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return;const{spacing:n}=e;return{dimensions:e.dimensions,spacing:n,numComps:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:r=>{const i=this.worldToCanvas(r),a=this.canvasToIndex(i);return[a[0],a[1],0]},indexToWorld:r=>{const i=this.indexToCanvas([r[0],r[1]]);return this.canvasToWorld(i)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:o}=this.internalCamera;if(r){const l=this.element.clientHeight/r,c=1/o/l;a.setResolution(c)}if(i){const l=this.worldToCanvas(i),c=this.canvasToIndex(l);a.setCenter(c)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n}=this.internalCamera,r=e*n,i=[this.element.clientWidth/2,this.element.clientHeight/2],a=this.canvasToWorld(i);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*r,viewPlaneNormal:[0,0,1]}}setDataIds(e){const n=tn(ls.WADO_WEB_CLIENT,e[0]);if(!n)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,n)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await H2.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{var f,h,p;const l=n.getDICOMwebMetadata(s);Object.defineProperty(l,"isMultiframe",{value:l.isMultiframe,enumerable:!1}),Object.defineProperty(l,"frameNumber",{value:void 0,enumerable:!1});const c=(f=l["00080008"])==null?void 0:f.Value;(c==null?void 0:c.length)===1&&(l["00080008"].Value=c[0].split("\\"));const d=(p=(h=l["00200052"])==null?void 0:h.Value)==null?void 0:p[0];return this.frameOfReferenceUID?d!==this.frameOfReferenceUID&&(l["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=d,l}),a=[];i.forEach(s=>{const l=new r.metadata.VLWholeSlideMicroscopyImage({metadata:s}),c=l.ImageType[2];c==="VOLUME"||c==="THUMBNAIL"?a.push(l):console.log("Unknown image type",l.ImageType)}),this.metadataDicomweb=a;const o=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:[],bindings:{}});o.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),o.deactivateDragPanInteraction(),this.viewer=o,this.map=o[tM],this.map.on(Mme,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[tM],n=window;return n.map=e,n.viewer=this.viewer,n.view=e==null?void 0:e.getView(),n.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<sc)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[s,l]}}=this,c=1/n/s;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:c,xSpacing:s,ySpacing:l,resolution:n,rotation:a,zoom:o})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var n;(n=this.getView())==null||n.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new rd;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}};H2.getDicomMicroscopyViewer=async()=>Ik("dicom-microscopy-viewer");let Ux=H2;const YB=Ux,JB={[dr.ORTHOGRAPHIC]:Wg,[dr.PERSPECTIVE]:Wg,[dr.STACK]:jg,[dr.VOLUME_3D]:s8,[dr.VIDEO]:XB,[dr.WholeSlide]:YB};function U0(t){return JB[t].useCustomRenderingPipeline}const nM=2;class _2{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const i=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});return this.renderViewports(i)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(o),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i!=null&&i.element&&Kt(i.element,xt.IMAGE_RENDERED,i)})},this.id=e||pc(),this.useCPURendering=xf(),Mg.set(this),!bk())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=mfe.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:o}=n,s=U0(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const l=os(r),{background:c}=n.defaultOptions;this.fillCanvasWithBackgroundColor(l,c)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!U0(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!U0(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const o=os(a.element),{background:s}=a.defaultOptions;this.fillCanvasWithBackgroundColor(o,s)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(o=>{U0(o.type)?a.push(o):i.push(o)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof jg;return e.filter(n)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Ku;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Mg.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(o=>Math.floor(255*o));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===dr.ORTHOGRAPHIC&&(i={...i,orientation:jl.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r===!0&&this.render()}_resizeVTKViewports(e,n=!0,r=!0){e.forEach(a=>{os(a.element)});const i=e.map(a=>a.canvas);if(i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i);this._resize(e,a,o)}e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:l}=o;a.resetCamera(!0,!0,!0,!1,!0);const C=a.getDisplayArea();n&&(C?(l&&a.setCamera({flipHorizontal:l}),s&&a.setProperties({rotation:s})):a.setCamera(o))}),r===!0&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(d=>U0(d.type)===!1),i=r.map(d=>d.canvas),a=os(e.element);i.push(a);const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),l=this._resize(r,o,s),c={...e,canvas:a};this.addVtkjsDrivenViewport(c,{offScreenCanvasWidth:o,offScreenCanvasHeight:s,xOffset:l})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:l,offScreenCanvasHeight:c,xOffset:d}=n,{sxStartDisplayCoords:f,syStartDisplayCoords:h,sxEndDisplayCoords:p,syEndDisplayCoords:C,sx:x,sy:T,sWidth:_,sHeight:y}=this._getViewportCoordsOnOffScreenCanvas(e,l,c,d);this.offscreenMultiRenderWindow.addRenderer({viewport:[f,h,p,C],id:a,background:s.background?s.background:[0,0,0]});const w={id:a,element:r,renderingEngineId:this.id,type:o,canvas:i,sx:x,sy:T,sWidth:_,sHeight:y,defaultOptions:s||{}};let b;if(o===dr.STACK)b=new jg(w);else if(o===dr.ORTHOGRAPHIC||o===dr.PERSPECTIVE)b=new Wg(w);else if(o===dr.VOLUME_3D)b=new s8(w);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(a,b);const M={element:r,viewportId:a,renderingEngineId:this.id};b.suppressEvents||Kt(Hn,xt.ELEMENT_ENABLED,M)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const o=os(n),{clientWidth:s,clientHeight:l}=o;(o.width!==s||o.height!==l)&&(o.width=s,o.height=l);const c={id:r,renderingEngineId:this.id,element:n,type:i,canvas:o,sx:0,sy:0,sWidth:s,sHeight:l,defaultOptions:a||{}},d=JB[i],f=new d(c);this._viewports.set(r,f);const h={element:n,viewportId:r,renderingEngineId:this.id};Kt(Hn,xt.ELEMENT_ENABLED,h)}setCustomViewports(e){e.forEach(n=>this.addCustomViewport(n))}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>os(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,l=o.getBoundingClientRect();o.width=l.width*s,o.height=l.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let o=0;o<e.length;o++){const s=e[o],l=n[o],c={...s,canvas:l};this.addVtkjsDrivenViewport(c,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=l.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(o=>o.height));let a=0;return e.forEach(o=>{a+=o.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const o=e[a],{sxStartDisplayCoords:s,syStartDisplayCoords:l,sxEndDisplayCoords:c,syEndDisplayCoords:d,sx:f,sy:h,sWidth:p,sHeight:C}=this._getViewportCoordsOnOffScreenCanvas(o,n,r,i);i+=o.canvas.width,o.sx=f,o.sy=h,o.sWidth=p,o.sHeight=C,this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport([s,l,c,d])}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:o,height:s}=a,l=i,c=0,d=l/n,f=c+(r-s)/r,h=o/n,p=s/r;return{sxStartDisplayCoords:d,syStartDisplayCoords:f,sxEndDisplayCoords:d+h,syEndDisplayCoords:f+p,sx:l,sy:c,sWidth:o,sHeight:s}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:o}=r[i];this._needsRender.has(o)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<nM||e.sHeight<nM){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(U0(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:o,sWidth:s,sHeight:l,id:c,renderingEngineId:d,suppressEvents:f}=e,{width:h,height:p}=i;return i.getContext("2d").drawImage(n,a,o,s,l,0,0,h,p),{element:r,suppressEvents:f,viewportId:c,renderingEngineId:d,viewportStatus:e.viewportStatus}}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,o={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),Kt(Hn,xt.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();Nme(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let l=0;l<r.length;l++)r[l].renderer.setDraw(!0);n.render();const o=e.getOpenGLRenderWindow().get3DContext().canvas,s=o.toDataURL();return this._getViewportsAsArray().forEach(l=>{const{sx:c,sy:d,sWidth:f,sHeight:h}=l,p=l.canvas,{width:C,height:x}=p;p.getContext("2d").drawImage(o,c,d,f,h,0,0,C,x)}),s}}function Nme(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}const yp=new HE("imageRetrievalPool");yp.setMaxSimultaneousRequests(Tr.Interaction,200);yp.setMaxSimultaneousRequests(Tr.Thumbnail,200);yp.setMaxSimultaneousRequests(Tr.Prefetch,200);yp.grabDelay=0;const Rme=yp,rM=Symbol("DefaultSettings"),iM=Symbol("RuntimeSettings"),aM=Symbol("ObjectSettingsMap"),Fs=Symbol("Dictionary");class wr{constructor(e){const n=Object.create(e instanceof wr&&Fs in e?e[Fs]:null);Object.seal(Object.defineProperty(this,Fs,{value:n}))}set(e,n){return D2(this[Fs],e,n,null)}get(e){return kme(this[Fs],e)}unset(e){return Ame(this[Fs],e+"")}forEach(e){oM(this[Fs],e)}extend(){return new wr(this)}import(e){ZB(e)&&Object.keys(e).forEach(n=>{D2(this[Fs],n,e[n],null)})}dump(){const e={};return oM(this[Fs],(n,r)=>{typeof r<"u"&&QB(e,n,r)}),e}static assert(e){return e instanceof wr?e:wr.getRuntimeSettings()}static getDefaultSettings(e=null){let n=wr[rM];if(n instanceof wr||(n=new wr,wr[rM]=n),e){const r={};return n.forEach(i=>{if(i.startsWith(e)){const a=i.split(`${e}.`)[1];r[a]=n.get(i)}}),r}return n}static getRuntimeSettings(){let e=wr[iM];return e instanceof wr||(e=new wr(wr.getDefaultSettings()),wr[iM]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof wr)r=e;else if(typeof e=="object"&&e!==null){let i=wr[aM];i instanceof WeakMap||(i=new WeakMap,wr[aM]=i),r=i.get(e),r instanceof wr||(r=new wr(wr.assert(wr.getObjectSettings(n))),i.set(e,r))}return r}static extendRuntimeSettings(){return wr.getRuntimeSettings().extend()}}function Ame(t,e){if(e.endsWith(".")){let n=0;const r=e,i=r.slice(0,-1),a=i.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a||o.startsWith(r)||o===i)&&(delete t[o],++n);return n>0}return delete t[e]}function oM(t,e){for(const n in t)e(n,t[n])}function Lme(t,e,n,r){let i;if(r.has(n))return D2(t,e,null,r);r.add(n),i=0;for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=a.length===0?e:`${e}.${a}`;D2(t,o,n[a],r)||++i}return r.delete(n),i===0}function D2(t,e,n,r){return Pme(e)?ZB(n)?Lme(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function kme(t,e){return t[e]}function Pme(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function ZB(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function QB(t,e,n){const r=e.indexOf(".");if(r>=0){const i=e.slice(0,r);let a=t[i];if(typeof a!="object"||a===null){const o=a;a={},typeof o<"u"&&(a[""]=o),t[i]=a}QB(a,e.slice(r+1,e.length),n)}else t[e]=n}wr.getDefaultSettings().set("useCursors",!0);function fv(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Fme(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function eG(t){let e,n,r;t.length!==2?(e=fv,n=(s,l)=>fv(t(s),l),r=(s,l)=>t(s)-l):(e=t===fv||t===Fme?t:Vme,n=t,r=t);function i(s,l,c=0,d=s.length){if(c<d){if(e(l,l)!==0)return d;do{const f=c+d>>>1;n(s[f],l)<0?c=f+1:d=f}while(c<d)}return c}function a(s,l,c=0,d=s.length){if(c<d){if(e(l,l)!==0)return d;do{const f=c+d>>>1;n(s[f],l)<=0?c=f+1:d=f}while(c<d)}return c}function o(s,l,c=0,d=s.length){const f=i(s,l,c,d-1);return f>c&&r(s[f-1],l)>-r(s[f],l)?f-1:f}return{left:i,center:o,right:a}}function Vme(){return 0}function Ume(t){return t===null?NaN:+t}const Bme=eG(fv),Gme=Bme.right;eG(Ume).center;const zme=Math.sqrt(50),Wme=Math.sqrt(10),jme=Math.sqrt(2);function b2(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=zme?10:a>=Wme?5:a>=jme?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/o,s=Math.round(t*c),l=Math.round(e*c),s/c<t&&++s,l/c>e&&--l,c=-c):(c=Math.pow(10,i)*o,s=Math.round(t/c),l=Math.round(e/c),s*c<t&&++s,l*c>e&&--l),l<s&&.5<=n&&n<2?b2(t,e,n*2):[s,l,c]}function Hme(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?b2(e,t,n):b2(t,e,n);if(!(a>=i))return[];const s=a-i+1,l=new Array(s);if(r)if(o<0)for(let c=0;c<s;++c)l[c]=(a-c)/-o;else for(let c=0;c<s;++c)l[c]=(a-c)*o;else if(o<0)for(let c=0;c<s;++c)l[c]=(i+c)/-o;else for(let c=0;c<s;++c)l[c]=(i+c)*o;return l}function Bx(t,e,n){return e=+e,t=+t,n=+n,b2(t,e,n)[2]}function $me(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Bx(e,t,n):Bx(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function Kme(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function l8(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function tG(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function wp(){}var Hg=.7,I2=1/Hg,Tf="\\s*([+-]?\\d+)\\s*",$g="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",gs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",qme=/^#([0-9a-f]{3,8})$/,Xme=new RegExp(`^rgb\\(${Tf},${Tf},${Tf}\\)$`),Yme=new RegExp(`^rgb\\(${gs},${gs},${gs}\\)$`),Jme=new RegExp(`^rgba\\(${Tf},${Tf},${Tf},${$g}\\)$`),Zme=new RegExp(`^rgba\\(${gs},${gs},${gs},${$g}\\)$`),Qme=new RegExp(`^hsl\\(${$g},${gs},${gs}\\)$`),eve=new RegExp(`^hsla\\(${$g},${gs},${gs},${$g}\\)$`),sM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};l8(wp,Kg,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:lM,formatHex:lM,formatHex8:tve,formatHsl:nve,formatRgb:cM,toString:cM});function lM(){return this.rgb().formatHex()}function tve(){return this.rgb().formatHex8()}function nve(){return nG(this).formatHsl()}function cM(){return this.rgb().formatRgb()}function Kg(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=qme.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?uM(e):n===3?new pa(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Tm(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Tm(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Xme.exec(t))?new pa(e[1],e[2],e[3],1):(e=Yme.exec(t))?new pa(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Jme.exec(t))?Tm(e[1],e[2],e[3],e[4]):(e=Zme.exec(t))?Tm(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Qme.exec(t))?hM(e[1],e[2]/100,e[3]/100,1):(e=eve.exec(t))?hM(e[1],e[2]/100,e[3]/100,e[4]):sM.hasOwnProperty(t)?uM(sM[t]):t==="transparent"?new pa(NaN,NaN,NaN,0):null}function uM(t){return new pa(t>>16&255,t>>8&255,t&255,1)}function Tm(t,e,n,r){return r<=0&&(t=e=n=NaN),new pa(t,e,n,r)}function rve(t){return t instanceof wp||(t=Kg(t)),t?(t=t.rgb(),new pa(t.r,t.g,t.b,t.opacity)):new pa}function Gx(t,e,n,r){return arguments.length===1?rve(t):new pa(t,e,n,r??1)}function pa(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}l8(pa,Gx,tG(wp,{brighter(t){return t=t==null?I2:Math.pow(I2,t),new pa(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Hg:Math.pow(Hg,t),new pa(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new pa(Nu(this.r),Nu(this.g),Nu(this.b),O2(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fM,formatHex:fM,formatHex8:ive,formatRgb:dM,toString:dM}));function fM(){return`#${xu(this.r)}${xu(this.g)}${xu(this.b)}`}function ive(){return`#${xu(this.r)}${xu(this.g)}${xu(this.b)}${xu((isNaN(this.opacity)?1:this.opacity)*255)}`}function dM(){const t=O2(this.opacity);return`${t===1?"rgb(":"rgba("}${Nu(this.r)}, ${Nu(this.g)}, ${Nu(this.b)}${t===1?")":`, ${t})`}`}function O2(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Nu(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xu(t){return t=Nu(t),(t<16?"0":"")+t.toString(16)}function hM(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ko(t,e,n,r)}function nG(t){if(t instanceof ko)return new ko(t.h,t.s,t.l,t.opacity);if(t instanceof wp||(t=Kg(t)),!t)return new ko;if(t instanceof ko)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new ko(o,s,l,t.opacity)}function ave(t,e,n,r){return arguments.length===1?nG(t):new ko(t,e,n,r??1)}function ko(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}l8(ko,ave,tG(wp,{brighter(t){return t=t==null?I2:Math.pow(I2,t),new ko(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Hg:Math.pow(Hg,t),new ko(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new pa(P4(t>=240?t-240:t+120,i,r),P4(t,i,r),P4(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ko(gM(this.h),_m(this.s),_m(this.l),O2(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=O2(this.opacity);return`${t===1?"hsl(":"hsla("}${gM(this.h)}, ${_m(this.s)*100}%, ${_m(this.l)*100}%${t===1?")":`, ${t})`}`}}));function gM(t){return t=(t||0)%360,t<0?t+360:t}function _m(t){return Math.max(0,Math.min(1,t||0))}function P4(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const c8=t=>()=>t;function ove(t,e){return function(n){return t+n*e}}function sve(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function lve(t){return(t=+t)==1?rG:function(e,n){return n-e?sve(e,n,t):c8(isNaN(e)?n:e)}}function rG(t,e){var n=e-t;return n?ove(t,n):c8(isNaN(t)?e:t)}const pM=function t(e){var n=lve(e);function r(i,a){var o=n((i=Gx(i)).r,(a=Gx(a)).r),s=n(i.g,a.g),l=n(i.b,a.b),c=rG(i.opacity,a.opacity);return function(d){return i.r=o(d),i.g=s(d),i.b=l(d),i.opacity=c(d),i+""}}return r.gamma=t,r}(1);function cve(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function uve(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function fve(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=u8(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function dve(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function M2(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function hve(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=u8(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var zx=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,F4=new RegExp(zx.source,"g");function gve(t){return function(){return t}}function pve(t){return function(e){return t(e)+""}}function mve(t,e){var n=zx.lastIndex=F4.lastIndex=0,r,i,a,o=-1,s=[],l=[];for(t=t+"",e=e+"";(r=zx.exec(t))&&(i=F4.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:M2(r,i)})),n=F4.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?pve(l[0].x):gve(e):(e=l.length,function(c){for(var d=0,f;d<e;++d)s[(f=l[d]).i]=f.x(c);return s.join("")})}function u8(t,e){var n=typeof e,r;return e==null||n==="boolean"?c8(e):(n==="number"?M2:n==="string"?(r=Kg(e))?(e=r,pM):mve:e instanceof Kg?pM:e instanceof Date?dve:uve(e)?cve:Array.isArray(e)?fve:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?hve:M2)(t,e)}function vve(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function yve(t){return function(){return t}}function wve(t){return+t}var mM=[0,1];function ff(t){return t}function Wx(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:yve(isNaN(e)?NaN:.5)}function Cve(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function xve(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=Wx(i,r),a=n(o,a)):(r=Wx(r,i),a=n(a,o)),function(s){return a(r(s))}}function Sve(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=Wx(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(s){var l=Gme(t,s,1,r)-1;return a[l](i[l](s))}}function Eve(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Tve(){var t=mM,e=mM,n=u8,r,i,a,o=ff,s,l,c;function d(){var h=Math.min(t.length,e.length);return o!==ff&&(o=Cve(t[0],t[h-1])),s=h>2?Sve:xve,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?a:(l||(l=s(t.map(r),e,n)))(r(o(h)))}return f.invert=function(h){return o(i((c||(c=s(e,t.map(r),M2)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,wve),d()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),d()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=vve,d()},f.clamp=function(h){return arguments.length?(o=h?!0:ff,d()):o!==ff},f.interpolate=function(h){return arguments.length?(n=h,d()):n},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,p){return r=h,i=p,d()}}function _ve(){return Tve()(ff,ff)}function Dve(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function N2(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Bf(t){return t=N2(Math.abs(t)),t?t[1]:NaN}function bve(t,e){return function(n,r){for(var i=n.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(n.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(e)}}function Ive(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Ove=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function R2(t){if(!(e=Ove.exec(t)))throw new Error("invalid format: "+t);var e;return new f8({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}R2.prototype=f8.prototype;function f8(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}f8.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Mve(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var iG;function Nve(t,e){var n=N2(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(iG=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+N2(t,Math.max(0,e+a-1))[0]}function vM(t,e){var n=N2(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const yM={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Dve,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>vM(t*100,e),r:vM,s:Nve,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function wM(t){return t}var CM=Array.prototype.map,xM=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Rve(t){var e=t.grouping===void 0||t.thousands===void 0?wM:bve(CM.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?wM:Ive(CM.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(f){f=R2(f);var h=f.fill,p=f.align,C=f.sign,x=f.symbol,T=f.zero,_=f.width,y=f.comma,w=f.precision,b=f.trim,M=f.type;M==="n"?(y=!0,M="g"):yM[M]||(w===void 0&&(w=12),b=!0,M="g"),(T||h==="0"&&p==="=")&&(T=!0,h="0",p="=");var I=x==="$"?n:x==="#"&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",A=x==="$"?r:/[%p]/.test(M)?o:"",k=yM[M],U=/[defgprs%]/.test(M);w=w===void 0?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function B(z){var K=I,J=A,X,re,fe;if(M==="c")J=k(z)+J,z="";else{z=+z;var pe=z<0||1/z<0;if(z=isNaN(z)?l:k(Math.abs(z),w),b&&(z=Mve(z)),pe&&+z==0&&C!=="+"&&(pe=!1),K=(pe?C==="("?C:s:C==="-"||C==="("?"":C)+K,J=(M==="s"?xM[8+iG/3]:"")+J+(pe&&C==="("?")":""),U){for(X=-1,re=z.length;++X<re;)if(fe=z.charCodeAt(X),48>fe||fe>57){J=(fe===46?i+z.slice(X+1):z.slice(X))+J,z=z.slice(0,X);break}}}y&&!T&&(z=e(z,1/0));var ie=K.length+z.length+J.length,te=ie<_?new Array(_-ie+1).join(h):"";switch(y&&T&&(z=e(te+z,te.length?_-J.length:1/0),te=""),p){case"<":z=K+z+J+te;break;case"=":z=K+te+z+J;break;case"^":z=te.slice(0,ie=te.length>>1)+K+z+J+te.slice(ie);break;default:z=te+K+z+J;break}return a(z)}return B.toString=function(){return f+""},B}function d(f,h){var p=c((f=R2(f),f.type="f",f)),C=Math.max(-8,Math.min(8,Math.floor(Bf(h)/3)))*3,x=Math.pow(10,-C),T=xM[8+C/3];return function(_){return p(x*_)+T}}return{format:c,formatPrefix:d}}var Dm,aG,oG;Ave({thousands:",",grouping:[3],currency:["$",""]});function Ave(t){return Dm=Rve(t),aG=Dm.format,oG=Dm.formatPrefix,Dm}function Lve(t){return Math.max(0,-Bf(Math.abs(t)))}function kve(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Bf(e)/3)))*3-Bf(Math.abs(t)))}function Pve(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Bf(e)-Bf(t))+1}function Fve(t,e,n,r){var i=$me(t,e,n),a;switch(r=R2(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=kve(i,o))&&(r.precision=a),oG(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=Pve(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=Lve(i))&&(r.precision=a-(r.type==="%")*2);break}}return aG(r)}function Vve(t){var e=t.domain;return t.ticks=function(n){var r=e();return Hme(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return Fve(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],s=r[a],l,c,d=10;for(s<o&&(c=o,o=s,s=c,c=i,i=a,a=c);d-- >0;){if(c=Bx(o,s,n),c===l)return r[i]=o,r[a]=s,e(r);if(c>0)o=Math.floor(o/c)*c,s=Math.ceil(s/c)*c;else if(c<0)o=Math.ceil(o*c)/c,s=Math.floor(s*c)/c;else break;l=c}return t},t}function d8(){var t=_ve();return t.copy=function(){return Eve(t,d8())},Kme.apply(t,arguments),Vve(t)}function Uve(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,i=1;if(t.getInputData()){const o=t.getInputData();n=o.getDimensions()[0],r=o.getDimensions()[1],i=o.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),(n>1)+(r>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=document.createElement("canvas");n.width=e.image.width,n.height=e.image.height;const r=n.getContext("2d");return r.translate(0,n.height),r.scale(1,-1),r.drawImage(e.image,0,0,e.image.width,e.image.height),r.getImageData(0,0,n.width,n.height)}return null}}const Bve=(t,e,n,r)=>{const i=[1,2,1],a=4,o=i,s=a,l=t.length/(e*n);let c=e,d=n,f=t;const h=[f];for(let p=0;p<r;p++){const C=[...f];c/=2,d/=2,f=new Uint8ClampedArray(c*d*l);const x=l*c;let T=0;for(let y=0;y<f.length;y+=l){y%x===0&&(T+=2*l*c);for(let w=0;w<l;w++){let b=C[T+w];b+=C[T+l+w],b+=C[T-2*x+w],b+=C[T-2*x+l+w],b/=4,f[y+w]=b}T+=2*l}let _=[...f];for(let y=0;y<f.length;y+=l)for(let w=0;w<l;w++){let b=-(o.length-1)/2,M=s,I=0;for(let A=0;A<o.length;A++){let k=y+w+b*l;const U=k%x-(y+w)%x;U>l&&(k+=x),U<-l&&(k-=x),_[k]?I+=_[k]*o[A]:M-=o[A],b+=1}f[y+w]=I/M}_=[...f];for(let y=0;y<f.length;y+=l)for(let w=0;w<l;w++){let b=-(o.length-1)/2,M=s,I=0;for(let A=0;A<o.length;A++){const k=y+w+b*x;_[k]?I+=_[k]*o[A]:M-=o[A],b+=1}f[y+w]=I/M}h.push(f)}return h},Gve={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function sG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gve,n),de.obj(t,e),de.algo(t,e,6,0),de.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),de.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),Uve(t,e)}const zve=de.newInstance(sG,"vtkTexture"),Wve={generateMipmaps:Bve};var Cp={newInstance:zve,extend:sG,...Wve};const jve=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],SM=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],bm=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],EM=[0,1,0,1,0,1,0,1,2,2,2,2],yr=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],ln=new Float64Array(3),Im=new Float64Array(3),zn=new Float64Array(3),pu=new Float64Array(3),ou=new Float64Array(3),Om=new Float64Array(3),V4=new Float64Array(16);function U4(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function lG(t){const e=[],n=[];for(let r=0;r<3;r++){const i=d8().domain([t[r*2],t[r*2+1]]);e[r]=i.ticks(5);const a=i.tickFormat(5);n[r]=e[r].map(a)}return{ticks:e,tickStrings:n}}function Hve(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,i,a,o,s,l)=>{const c=e.renderable.get_tmAtlas().get(n);if(!c)return;const d=e.renderable.getTextPolyData().getPoints().getData(),f=e.lastSize;ln[0]=d[r*3],ln[1]=d[r*3+1],ln[2]=d[r*3+2],vn(zn,ln,i),zn[0]+=.1,vn(Im,zn,a),Er(ou,Im,ln),zn[0]-=.1,zn[1]+=.1,vn(Im,zn,a),Er(Om,Im,ln);for(let C=0;C<3;C++)ou[C]/=.5*.1*f[0],Om[C]/=.5*.1*f[1];let h=l.ptIdx,p=l.cellIdx;ln[0]=d[r*3],ln[1]=d[r*3+1],ln[2]=d[r*3+2],o[0]<-.5?Za(zn,ou,o[0]*s-c.width):o[0]>.5?Za(zn,ou,o[0]*s):Za(zn,ou,o[0]*s-c.width/2),io(ln,ln,zn),Za(zn,Om,o[1]*s-c.height/2),io(ln,ln,zn),l.points[h*3]=ln[0],l.points[h*3+1]=ln[1],l.points[h*3+2]=ln[2],l.tcoords[h*2]=c.tcoords[0],l.tcoords[h*2+1]=c.tcoords[1],h++,Za(zn,ou,c.width),io(ln,ln,zn),l.points[h*3]=ln[0],l.points[h*3+1]=ln[1],l.points[h*3+2]=ln[2],l.tcoords[h*2]=c.tcoords[2],l.tcoords[h*2+1]=c.tcoords[3],h++,Za(zn,Om,c.height),io(ln,ln,zn),l.points[h*3]=ln[0],l.points[h*3+1]=ln[1],l.points[h*3+2]=ln[2],l.tcoords[h*2]=c.tcoords[4],l.tcoords[h*2+1]=c.tcoords[5],h++,Za(zn,ou,c.width),Er(ln,ln,zn),l.points[h*3]=ln[0],l.points[h*3+1]=ln[1],l.points[h*3+2]=ln[2],l.tcoords[h*2]=c.tcoords[6],l.tcoords[h*2+1]=c.tcoords[7],h++,l.polys[p*4]=3,l.polys[p*4+1]=h-4,l.polys[p*4+2]=h-3,l.polys[p*4+3]=h-2,p++,l.polys[p*4]=3,l.polys[p*4+1]=h-4,l.polys[p*4+2]=h-2,l.polys[p*4+3]=h-1,l.ptIdx+=4,l.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);yn(n,n);const r=e.renderable.getTextValues().length,i=r*4,a=r*2,o=new Float64Array(i*3),s=new Uint16Array(a*4),l=new Float32Array(i*2);Vr(V4,n);const c={ptIdx:0,cellIdx:0,polys:s,points:o,tcoords:l};let d=0,f=0,h=0;const p=e.renderable.getTextPolyData().getPoints().getData(),C=e.renderable.getTextValues();for(;d<p.length/3;){ln[0]=p[d*3],ln[1]=p[d*3+1],ln[2]=p[d*3+2],vn(zn,ln,n),ln[0]=p[d*3+3],ln[1]=p[d*3+4],ln[2]=p[d*3+5],vn(pu,ln,n),Er(zn,zn,pu);const T=[zn[0],zn[1]];CE(T),t.createPolyDataForOneLabel(C[f],d,n,V4,T,e.renderable.getAxisTitlePixelOffset(),c),d+=2,f++;for(let _=0;_<e.renderable.getTickCounts()[h];_++)t.createPolyDataForOneLabel(C[f],d,n,V4,T,e.renderable.getTickLabelPixelOffset(),c),d++,f++;h++}const x=Bt.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(x),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(s,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,i)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const $ve=de.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),de.obj(t,e),e.tmPolyData=gi.newInstance(),e.tmMapper=al.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=ol.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),de.setGet(t,e,["renderable"]),de.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},de.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},de.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],Hve(t,e)},"vtkCubeAxesActorHelper");function Kve(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();yn(r,r);let i=!1;const a=Gn.getDiagonalLength(e.dataBounds),o=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let s=0;s<6;s++){let l=!1;const c=Math.floor(s/2),d=(c+1)%3,f=(c+2)%3;e.dataBounds[d*2]!==e.dataBounds[d*2+1]&&e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&(ln[c]=e.dataBounds[s]-.1*a*jve[s][c],ln[d]=.5*(e.dataBounds[d*2]+e.dataBounds[d*2+1]),ln[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),vn(zn,ln,r),ln[c]=e.dataBounds[s],vn(pu,ln,r),Er(zn,pu,zn),Ui(zn,zn),l=zn[2]>o,e.camera.getParallelProjection()||(Ui(pu,pu),l=er(pu,zn)>o)),l!==e.lastFacesToDraw[s]&&(e.lastFacesToDraw[s]=l,i=!0)}return i},t.updatePolyData=(r,i,a)=>{let o=0,s=0;o+=8;let l=0;for(let p=0;p<12;p++)i[p]>0&&l++;if(s+=l,e.gridLines)for(let p=0;p<6;p++)r[p]&&(o+=a[yr[p][0]].length*2+a[yr[p][1]].length*2,s+=a[yr[p][0]].length+a[yr[p][1]].length);const c=new Float64Array(o*3),d=new Uint32Array(s*3);let f=0,h=0;for(let p=0;p<2;p++)for(let C=0;C<2;C++)for(let x=0;x<2;x++)c[f*3]=e.dataBounds[x],c[f*3+1]=e.dataBounds[2+C],c[f*3+2]=e.dataBounds[4+p],f++;for(let p=0;p<12;p++)i[p]>0&&(d[h*3]=2,d[h*3+1]=bm[p][0],d[h*3+2]=bm[p][1],h++);if(e.gridLines){for(let p=0;p<6;p++)if(r[p]){const C=Math.floor(p/2);let x=a[yr[p][0]];for(let T=0;T<x.length;T++)c[f*3+C]=e.dataBounds[p],c[f*3+yr[p][0]]=x[T],c[f*3+yr[p][1]]=e.dataBounds[yr[p][1]*2],f++,c[f*3+C]=e.dataBounds[p],c[f*3+yr[p][0]]=x[T],c[f*3+yr[p][1]]=e.dataBounds[yr[p][1]*2+1],f++,d[h*3]=2,d[h*3+1]=f-2,d[h*3+2]=f-1,h++;x=a[yr[p][1]];for(let T=0;T<x.length;T++)c[f*3+C]=e.dataBounds[p],c[f*3+yr[p][1]]=x[T],c[f*3+yr[p][0]]=e.dataBounds[yr[p][0]*2],f++,c[f*3+C]=e.dataBounds[p],c[f*3+yr[p][1]]=x[T],c[f*3+yr[p][0]]=e.dataBounds[yr[p][0]*2+1],f++,d[h*3]=2,d[h*3+1]=f-2,d[h*3+2]=f-1,h++}}e.polyData.getPoints().setData(c,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(d,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,i,a,o)=>{let s=0;for(let p=0;p<12;p++)i[p]===1&&(s+=2,s+=a[EM[p]].length);const l=e.polyData.getPoints().getData(),c=new Float64Array(s*3);let d=0,f=0,h=0;for(let p=0;p<6;p++)if(r[p])for(let C=0;C<4;C++){const x=SM[p][C];if(i[x]===1){const T=EM[x],_=bm[x][0]*3,y=bm[x][1]*3;c[d*3]=.5*(l[_]+l[y]),c[d*3+1]=.5*(l[_+1]+l[y+1]),c[d*3+2]=.5*(l[_+2]+l[y+2]),d++;const w=Math.floor(p/2);c[d*3+w]=e.dataBounds[p],c[d*3+yr[p][0]]=.5*(e.dataBounds[yr[p][0]*2]+e.dataBounds[yr[p][0]*2+1]),c[d*3+yr[p][1]]=.5*(e.dataBounds[yr[p][1]*2]+e.dataBounds[yr[p][1]*2+1]),d++,e.textValues[f]=e.axisLabels[T],f++;const b=(T+1)%3,M=(T+2)%3,I=a[T],A=o[T];e.tickCounts[h]=I.length;for(let k=0;k<I.length;k++)c[d*3+T]=I[k],c[d*3+b]=l[_+b],c[d*3+M]=l[_+M],d++,e.textValues[f]=A[k],f++;h++}}e.textPolyData.getPoints().setData(c,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),i=e.lastFacesToDraw;let a=!1;for(let o=0;o<6;o++)e.dataBounds[o]!==e.lastTickBounds[o]&&(a=!0,e.lastTickBounds[o]=e.dataBounds[o]);if(r||a||e.forceUpdate){const o=new Array(12).fill(0);for(let l=0;l<6;l++)if(i[l])for(let c=0;c<4;c++)o[SM[l][c]]++;const s=e.generateTicks(e.dataBounds);t.updatePolyData(i,o,s.ticks),t.updateTextData(i,o,s.ticks,s.tickStrings),(a||e.forceUpdate)&&t.updateTextureAtlas(s.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let i=0,a=1;for(let o=0;o<3;o++){if(!e._tmAtlas.has(e.axisLabels[o])){U4(e.tmContext,e.axisTextStyle);const s=e.tmContext.measureText(e.axisLabels[o]),l={height:s.actualBoundingBoxAscent+2,startingHeight:a,width:s.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[o],l),a+=l.height,i<l.width&&(i=l.width)}U4(e.tmContext,e.tickTextStyle);for(let s=0;s<r[o].length;s++)if(!e._tmAtlas.has(r[o][s])){const l=e.tmContext.measureText(r[o][s]),c={height:l.actualBoundingBoxAscent+2,startingHeight:a,width:l.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[o][s],c),a+=c.height,i<c.width&&(i=c.width)}}i=Na(i),a=Na(a),e._tmAtlas.forEach(o=>{o.tcoords=[0,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight)/a,0,(a-o.startingHeight)/a]}),e.tmCanvas.width=i,e.tmCanvas.height=a,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,a),e._tmAtlas.forEach((o,s)=>{U4(e.tmContext,o.textStyle),e.tmContext.fillText(s,1,o.startingHeight+o.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),Gn.setBounds(e.bounds,e.gridActor.getBounds()),Gn.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=de.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function qve(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...Gn.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:lG,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function cG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ol.extend(t,e,qve(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=Cp.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=al.newInstance(),e.polyData=gi.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=ol.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=gi.newInstance(),de.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),de.setGetArray(t,e,["dataBounds"],6),de.setGetArray(t,e,["axisLabels"],3),de.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Kve(t,e)}const Xve=de.newInstance(cG,"vtkCubeAxesActor");var uG={newInstance:Xve,extend:cG,newCubeAxesActorHelper:$ve,defaultGenerateTicks:lG};function Yve(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const Jve={};function Zve(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jve,n),$n.extend(t,e,n),e.CubeAxesActorHelper=uG.newCubeAxesActorHelper(),Yve(t,e)}const Qve=Ln(Zve,"vtkOpenGLCubeAxesActor");jr("vtkCubeAxesActor",Qve);const{ColorMode:e2e,ScalarMode:su,GetArray:B4}=vy;function t2e(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=Ah.newInstance()},t.getColorModeAsString=()=>de.enumToString(e2e,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>de.enumToString(su,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let s=null,l=!1;if(r===su.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),l=!0);else if(r===su.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===su.USE_CELL_DATA)s=n.getCellData().getScalars(),l=!0;else if(r===su.USE_POINT_FIELD_DATA){const c=n.getPointData();i===B4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}else if(r===su.USE_CELL_FIELD_DATA){const c=n.getCellData();l=!0,i===B4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}else if(r===su.USE_FIELD_DATA){const c=n.getFieldData();i===B4.BY_ID?s=c.getArrayByIndex(a):s=c.getArrayByName(o)}return{scalars:s,cellFlag:l}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.mapScalars=(n,r)=>{const i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!i){e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString===a)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(i,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}}}const n2e={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function fG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,n2e,n),sV.extend(t,e,n),de.get(t,e,["colorMapColors"]),de.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),de.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),t2e(t,e)}const r2e=de.newInstance(fG,"vtkMapper2D");var i2e={newInstance:r2e,extend:fG},a2e=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,o2e=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const dG={BACKGROUND:0,FOREGROUND:1};var hG={DisplayLocation:dG};const{primTypes:Mo}=ys,{ScalarMode:Mm}=i2e,{vtkErrorMacro:Nm}=_i,s2e={type:"StartEvent"},l2e={type:"EndEvent"};function c2e(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,i,a)=>{r.Vertex=o2e,r.Fragment=a2e,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=Mo.Start;o<Mo.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor2D.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(r,i)=>{if(t.invokeEvent(s2e),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(l2e),!e.currentInput){Nm("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,i,a)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return!!(a<t.getMTime()||a<e._openGLRenderWindow.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&a<r.getMTime())},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,i.getProperty().getOpacity());const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Mm.USE_CELL_DATA||s===Mm.USE_CELL_FIELD_DATA||s===Mm.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==Mm.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);const l=i.getProperty().getRepresentation();let c=a.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(c=null);const d=e.renderable.getTransformCoordinate(),h=r.getRenderWindow().getViews()[0].getViewportSize(r),p=`${a.getMTime()}A${l}B${a.getMTime()}C${o?o.getMTime():1}D${c?c.getMTime():1}E${d?r.getMTime():1}F${h}`;if(e.VBOBuildString!==p){let C=a.getPoints();if(d){const T=kf.newInstance(),_=C.getNumberOfPoints();T.setNumberOfPoints(_);const y=[];for(let w=0;w<_;++w){C.getPoint(w,y),d.setValue(y);const b=d.getComputedDoubleViewportValue(r);T.setPoint(w,b[0],b[1],0)}C=T}const x={points:C,tcoords:c,colors:o,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(T=>a.getPointData().getArrayByName(T))};x.cellOffset+=e.primitives[Mo.Points].getCABO().createVBO(a.getVerts(),"verts",l,x),x.cellOffset+=e.primitives[Mo.Lines].getCABO().createVBO(a.getLines(),"lines",l,x),x.cellOffset+=e.primitives[Mo.Tris].getCABO().createVBO(a.getPolys(),"polys",l,x),x.cellOffset+=e.primitives[Mo.TriStrips].getCABO().createVBO(a.getStrips(),"strips",l,x),e.VBOBuildTime.modified(),e.VBOBuildString=p}},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation();e.context.depthMask(!0);for(let s=Mo.Start;s<Mo.End;s++)e.primitives[s].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(r,i,a,t))},t.renderPieceFinish=(r,i)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(r,i,a)=>{t.replaceShaderColor(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderPositionVC(r,i,a)},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,l=r.Fragment;e.haveCellScalars&&(l=Le.substitute(l,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,l=Le.substitute(l,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(o=Le.substitute(o,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,o=Le.substitute(o,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,s=Le.substitute(s,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,s=Le.substitute(s,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,l=Le.substitute(l,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,l=Le.substitute(l,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(l=Le.substitute(l,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,l=Le.substitute(l,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=l},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,l=r.Fragment;const c=e.lastBoundBO.getCABO().getTCoordComponents();c===1?(o=Le.substitute(o,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,o=Le.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Le.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=Le.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,l=Le.substitute(l,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l=Le.substitute(l,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):c===2&&(o=Le.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,o=Le.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Le.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=Le.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,l=Le.substitute(l,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l=Le.substitute(l,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(s=Le.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=l}},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment;o=Le.substitute(o,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,o=Le.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=o},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a)},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Nm("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((l,c)=>{r.getProgram().isAttributeUsed(`${l}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${l}MC`,r.getCABO().getCustomData()[c].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[c].components,!1)||Nm(`Error setting ${l}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||Nm("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor2D.getActiveTextures();if(o)for(let l=0;l<o.length;++l){const d=o[l].getTextureUnit(),f=`texture${d+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,d)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,i,a)=>{const o=e.renderable.getColorMapColors();if(!o||o.getNumberOfComponents()===0){const s=r.getProgram(),l=a.getProperty(),c=l.getOpacity(),d=l.getColor(),f=[d[0],d[1],d[2],c];s.setUniform4f("diffuseColor",f)}},t.setLightingShaderParameters=(r,i,a)=>{};function n(r,i,a){return i.identity(a),r.reduce((o,s,l)=>l===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),l=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,d=i.getRenderWindow().getViews()[0].getViewportSize(i),f=i.getViewport(),h=a.getActualPositionCoordinate().getComputedDoubleViewportValue(i),p=[0,0,1,1],C=[0,0,1,1];if(C[0]=f[0]>=p[0]?f[0]:p[0],C[1]=f[1]>=p[1]?f[1]:p[1],C[2]=f[2]<=p[2]?f[2]:p[2],C[3]=f[3]<=p[3]?f[3]:p[3],C[0]>=C[2]||C[1]>=C[3])return;d[0]=rf(d[0]*(C[2]-C[0])/(f[2]-f[0])),d[1]=rf(d[1]*(C[3]-C[1])/(f[3]-f[1]));const x=e._openGLRenderer.getParent().getSize(),T=rf(h[0]-(C[0]-f[0])*x[0]),_=rf(h[1]-(C[1]-f[1])*x[1]),y=-T;let w=-T+d[0];const b=-_;let M=-_+d[1];y===w&&(w=y+1),b===M&&(M=b+1);const I=kt(new Float64Array(16));I[0]=2/(w-y),I[1*4+1]=2/(M-b),I[0*4+3]=-1*(w+y)/(w-y),I[1*4+3]=-1*(M+b)/(M-b),I[2*4+2]=0,I[2*4+3]=a.getProperty().getDisplayLocation()===dG.FOREGROUND?-1:1,I[3*4+3]=1,yn(I,I),o.setUniformMatrix("WCVCMatrix",n([I,l],Lf,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const u2e={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function f2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u2e,n),$n.extend(t,e,n),ps.implementReplaceShaderCoincidentOffset(t,e,n),ps.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Mo,e.tmpMat4=kt(new Float64Array(16));for(let r=Mo.Start;r<Mo.End;r++)e.primitives[r]=ys.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ur(t,e,["context"]),e.VBOBuildTime={},ir(e.VBOBuildTime,{mtime:0}),c2e(t,e)}const d2e=Ln(f2e,"vtkOpenGLPolyDataMapper2D");jr("vtkMapper2D",d2e);const{VectorMode:h2e}=yy;function G4(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function gG(t,e){return n=>{const r=n.getLastSize(),i=(r[0]/700)**.8,a=(r[1]/700)**.8,o=Math.min(i,a),s=n.getAxisTextStyle(),l=n.getTickTextStyle();Object.assign(s,e.axisTextStyle),Object.assign(l,e.tickTextStyle),s.fontSize=Math.max(24*o,12),n.getLastAspectRatio()>1?l.fontSize=Math.max(20*o,10):l.fontSize=Math.max(16*o,10);const c=n.updateTextureAtlas();n.setTopTitle(!1);const d=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*l.fontSize),c.titleWidth<=c.tickWidth+n.getTickLabelPixelOffset()+.8*l.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*l.fontSize),d[0]=2*(c.tickWidth+n.getTickLabelPixelOffset()+.8*l.fontSize)/r[0],n.setBoxPosition([.98-d[0],-.92])):(n.setAxisTitlePixelOffset(.2*l.fontSize),d[0]=2*(c.titleHeight+n.getAxisTitlePixelOffset()+c.tickWidth+n.getTickLabelPixelOffset()+.8*l.fontSize)/r[0],n.setBoxPosition([.99-d[0],-.92])),d[1]=Math.max(1.2,Math.min(1.84/a,1.84));else{n.setAxisTitlePixelOffset(1.2*l.fontSize),n.setTickLabelPixelOffset(.1*l.fontSize);const f=2*(.8*l.fontSize+c.titleHeight+n.getAxisTitlePixelOffset())/r[1],h=2*c.tickWidth/r[0];d[0]=Math.min(1.9,Math.max(1.4,1.4*h*(n.getTicks().length+3))),d[1]=f,n.setBoxPosition([-.5*d[0],-.97])}n.recomputeBarSegments(c)}}function pG(t,e){return n=>{const r=n.getLastTickBounds(),i=d8().domain([r[0],r[1]]),a=i.ticks(5),o=i.tickFormat(5);n.setTicks(a),n.setTickStrings(a.map(o))}}function g2e(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=i=>{e.renderable!==i&&(e.renderable=i,e.barActor.setProperty(i.getProperty()),e.barActor.setParentProp(i),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(i.getProperty()),e.tmActor.setParentProp(i),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=i.generateTicks,e.axisTextStyle={...i.getAxisTextStyle()},e.tickTextStyle={...i.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(i,a,o)=>{(e.lastSize[0]!==i[0]||e.lastSize[1]!==i[1])&&(e.lastSize[0]=i[0],e.lastSize[1]=i[1],e.lastAspectRatio=i[0]/i[1],e.forceUpdate=!0);const s=e.renderable.getScalarsToColors();if(!(!s||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(s),e.camera=a,e.renderWindow=o,e.forceUpdate||Math.max(s.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const l=s.getMappingRange();if(e.lastTickBounds=[...l],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const c=t.updateTextureAtlas();t.recomputeBarSegments(c)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const i={},a=new Map;let o=0,s=1;G4(e.tmContext,e.axisTextStyle);let l=e.tmContext.measureText(e.renderable.getAxisLabel()),c={height:l.actualBoundingBoxAscent+2,startingHeight:s,width:l.width+2,textStyle:e.axisTextStyle};a.set(e.renderable.getAxisLabel(),c),s+=c.height,o=c.width,i.titleWidth=c.width,i.titleHeight=c.height,i.tickWidth=0,i.tickHeight=0,G4(e.tmContext,e.tickTextStyle);const d=[...t.getTickStrings(),"NaN","Below","Above"];for(let f=0;f<d.length;f++)a.has(d[f])||(l=e.tmContext.measureText(d[f]),c={height:l.actualBoundingBoxAscent+2,startingHeight:s,width:l.width+2,textStyle:e.tickTextStyle},a.set(d[f],c),s+=c.height,o<c.width&&(o=c.width),i.tickWidth<c.width&&(i.tickWidth=c.width),i.tickHeight<c.height&&(i.tickHeight=c.height));return o=Na(o),s=Na(s),a.forEach(f=>{f.tcoords=[0,(s-f.startingHeight-f.height)/s,f.width/o,(s-f.startingHeight-f.height)/s,f.width/o,(s-f.startingHeight)/s,0,(s-f.startingHeight)/s]}),e.tmCanvas.width=o,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,o,s),a.forEach((f,h)=>{G4(e.tmContext,f.textStyle),e.tmContext.fillText(h,1,f.startingHeight+f.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=a,i},t.computeBarSize=i=>{e.vertical=e.boxSize[1]>e.boxSize[0];const a=2*i.tickHeight/e.lastSize[1],o=[1,1];if(e.vertical){const s=2*(i.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const l=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-s,e.barSize[1]=e.boxSize[1]-l}else{const l=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-l-s,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+s,e.barPosition[1]=e.boxPosition[1],o[1]=a}else{const s=(2*i.tickWidth-8)/e.lastSize[0],l=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-l,e.barPosition[1]=e.boxPosition[1],o[0]=s}return o},t.recomputeBarSegments=i=>{var h,p,C,x;const a=t.computeBarSize(i);e.barSegments=[];const o=[0,0],s=e.vertical?1:0,l=e.vertical?.01:.02;function c(T,_){e.barSegments.push({corners:[[...o],[o[0]+a[0],o[1]],[o[0]+a[0],o[1]+a[1]],[o[0],o[1]+a[1]]],scalars:_,title:T}),o[s]+=a[s]+l}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&c("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((p=(h=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&p.call(h))&&c("Below",[-.1,-.1,-.1,-.1]);const d=(x=(C=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:x.call(C);o[s]+=l;const f=a[s];a[s]=d?1-2*l-a[s]-o[s]:1-l-o[s],c("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&d&&(a[s]=f,o[s]+=l,c("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(i,a,o,s,l,c)=>{const d=e._tmAtlas.get(i);if(!d)return;let f=c.ptIdx,h=c.cellIdx;n[0]=(.5*a[0]+.5)*e.lastSize[0],n[1]=(.5*a[1]+.5)*e.lastSize[1],n[2]=a[2],n[0]+=l[0],n[1]+=l[1];const p=[],C=s==="vertical"?[1,0]:[0,1];s==="vertical"?(p[0]=d.width,p[1]=-d.height,o[0]==="middle"?n[1]-=d.width/2:o[0]==="right"&&(n[1]-=d.width),o[1]==="middle"?n[0]+=d.height/2:o[1]==="top"&&(n[0]+=d.height)):(p[0]=d.width,p[1]=d.height,o[0]==="middle"?n[0]-=d.width/2:o[0]==="right"&&(n[0]-=d.width),o[1]==="middle"?n[1]-=d.height/2:o[1]==="top"&&(n[1]-=d.height)),c.points[f*3]=n[0],c.points[f*3+1]=n[1],c.points[f*3+2]=n[2],c.tcoords[f*2]=d.tcoords[0],c.tcoords[f*2+1]=d.tcoords[1],f++,n[C[0]]+=p[0],c.points[f*3]=n[0],c.points[f*3+1]=n[1],c.points[f*3+2]=n[2],c.tcoords[f*2]=d.tcoords[2],c.tcoords[f*2+1]=d.tcoords[3],f++,n[C[1]]+=p[1],c.points[f*3]=n[0],c.points[f*3+1]=n[1],c.points[f*3+2]=n[2],c.tcoords[f*2]=d.tcoords[4],c.tcoords[f*2+1]=d.tcoords[5],f++,n[C[0]]-=p[0],c.points[f*3]=n[0],c.points[f*3+1]=n[1],c.points[f*3+2]=n[2],c.tcoords[f*2]=d.tcoords[6],c.tcoords[f*2+1]=d.tcoords[7],f++,c.polys[h*4]=3,c.polys[h*4+1]=f-4,c.polys[h*4+2]=f-3,c.polys[h*4+3]=f-2,h++,c.polys[h*4]=3,c.polys[h*4+1]=f-4,c.polys[h*4+2]=f-2,c.polys[h*4+3]=f-1,c.ptIdx+=4,c.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const i=t.getTickStrings().length+e.barSegments.length,a=i*4,o=i*2,s=new Float64Array(a*3),l=new Uint16Array(o*4),c=new Float32Array(a*2),d={ptIdx:0,cellIdx:0,polys:l,points:s,tcoords:c},f=e.vertical?0:1,h=e.vertical?1:0;r[2]=-.99;const p=e.vertical?["right","middle"]:["middle","bottom"];let C=[0,1];const x=[0,0];e.vertical?(x[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],d)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],d)),C=[-1,0]):(x[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],d)),r[f]=e.barPosition[f]+(.5*C[f]+.5)*e.barSize[f],r[h]=e.barPosition[h]+e.barSize[h]*.5;let T=null;for(let I=0;I<e.barSegments.length;I++){const A=e.barSegments[I];A.title==="ticks"?T=A:(r[h]=e.barPosition[h]+.5*e.barSize[h]*(A.corners[2][h]+A.corners[0][h]),t.createPolyDataForOneLabel(A.title,r,p,"horizontal",x,d))}const _=e.barPosition[h]+e.barSize[h]*T.corners[0][h],y=e.barSize[h]*(T.corners[2][h]-T.corners[0][h]),w=t.getTicks(),b=t.getTickStrings();for(let I=0;I<w.length;I++){const A=(w[I]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[h]=_+y*A,t.createPolyDataForOneLabel(b[I],r,p,"horizontal",x,d)}const M=Bt.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(M),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(l,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var x,T;const i=e.renderable.getScalarsToColors();let a=0;e.renderable.getDrawNanAnnotation()&&i.getNanColor()&&(a+=1),e.renderable.getDrawBelowRangeSwatch()&&((x=i.getUseBelowRangeColor)!=null&&x.call(i))&&(a+=1),e.renderable.getDrawAboveRangeSwatch()&&((T=i.getUseAboveRangeColor)!=null&&T.call(i))&&(a+=1);const o=4*(1+a),s=o;let l=1;i.getVectorMode()===h2e.COMPONENT&&(l=i.getVectorComponent()+1);const c=new Float64Array(o*3),d=new Uint16Array(s*5),f=new Float32Array(o*l);let h=0,p=0;for(let _=0;_<e.barSegments.length;_++){const y=e.barSegments[_];for(let w=0;w<4;w++){r[0]=e.barPosition[0]+y.corners[w][0]*e.barSize[0],r[1]=e.barPosition[1]+y.corners[w][1]*e.barSize[1],c[h*3]=(.5*r[0]+.5)*e.lastSize[0],c[h*3+1]=(.5*r[1]+.5)*e.lastSize[1],c[h*3+2]=r[2];for(let b=0;b<l;b++)f[h*l+b]=e.lastTickBounds[0]+y.scalars[w]*(e.lastTickBounds[1]-e.lastTickBounds[0]);h++}d[p*5]=4,d[p*5+1]=h-4,d[p*5+2]=h-3,d[p*5+3]=h-2,d[p*5+4]=h-1,p++}const C=Bt.newInstance({numberOfComponents:l,values:f,name:"Scalars"});e.polyData.getPointData().setScalars(C),e.polyData.getPoints().setData(c,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(d,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const p2e=de.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),de.obj(t,e),de.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),de.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),de.getArray(t,e,["boxPosition","boxSize"]),de.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},de.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=al.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=gi.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=ol.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=gi.newInstance(),e.tmMapper=al.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=Cp.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=ol.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],g2e(t,e)},"vtkScalarBarActorHelper");function m2e(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(gG(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(pG())}}function v2e(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function mG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,v2e(n)),e.autoLayout||(e.autoLayout=gG(t,e)),e.generateTicks||(e.generateTicks=pG()),ol.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),de.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),de.get(t,e,["axisTextStyle","tickTextStyle"]),de.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),de.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),m2e(t,e)}const y2e=de.newInstance(mG,"vtkScalarBarActor");var vG={newInstance:y2e,extend:mG,newScalarBarActorHelper:p2e};function w2e(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const C2e={};function x2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,C2e,n),$n.extend(t,e,n),e.scalarBarActorHelper=vG.newScalarBarActorHelper(),w2e(t,e)}const S2e=Ln(x2e,"vtkOpenGLScalarBarActor");jr("vtkScalarBarActor",S2e);const{CoordinateSystem:TM}=dp;function E2e(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const i=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===TM.WORLD&&(e.bufferShift[0]-=i[0],e.bufferShift[1]-=i[1],e.bufferShift[2]-=i[2]),yn(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?kt(e.keyMatrices.normalMatrix):(hr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Vr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),yn(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),xr(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===TM.WORLD?xr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]):hr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const T2e={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function _2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,T2e,n),$n.extend(t,e,n),e.keyMatricesTime={},de.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},de.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],E2e(t,e)}const D2e=de.newInstance(_2e);po("vtkActor",D2e);const{CoordinateSystem:_M}=dp;function b2e(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===_M.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),kt(e.keyMatrices.bcwc),kt(e.keyMatrices.normalMatrix),xr(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===_M.WORLD?xr(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):hr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const I2e={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function O2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,I2e,n),$n.extend(t,e,n),e.keyMatricesTime={},de.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},de.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],b2e(t,e)}const M2e=de.newInstance(O2e);po("vtkActor2D",M2e);function N2e(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const R2e={};function A2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R2e,n),$n.extend(t,e,n),e.CubeAxesActorHelper=uG.newCubeAxesActorHelper(),N2e(t,e)}const L2e=Ln(A2e,"vtkWebGPUCubeAxesActor");po("vtkCubeAxesActor",L2e);const{DisplayLocation:jx}=hG;function k2e(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(jx.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(jx.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Si.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Si.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Si.POINTS),t.getRepresentationAsString=()=>de.enumToString(Si,e.representation)}const P2e={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Si.SURFACE,displayLocation:jx.FOREGROUND};function yG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P2e,n),de.obj(t,e),de.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),de.setGetArray(t,e,["color"],3),k2e(t,e)}const F2e=de.newInstance(yG,"vtkProperty2D");var V2e={newInstance:F2e,extend:yG,...hG};const{BufferUsage:ui,PrimitiveTypes:Zi}=nd,{Representation:Rm}=td,{ScalarMode:Am}=al,{CoordinateSystem:U2e}=dp,{DisplayLocation:B2e}=V2e,G2e=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,z2e=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function DM(t){return t.indexOf("edge")>=0}function W2e(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==U2e.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var a;const r=e.WebGPUActor.getRenderable().getProperty(),i=e.UBO.getSendTime();if(t.getMTime()>i||r.getMTime()>i||e.renderable.getMTime()>i){const o=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",o.bcwc),e.UBO.setArray("BCSCMatrix",o.bcsc),e.UBO.setArray("MCWCNormals",o.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===B2e.FOREGROUND?1:0);const c=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[c[0],c[1],c[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let c=r.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[c[0],c[1],c[2],1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),c=r.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[c[0],c[1],c[2],1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),c=r.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[c[0],c[1],c[2],1])}const s=(a=r.getEdgeColorByReference)==null?void 0:a.call(r);s&&e.UBO.setArray("EdgeColor",[s[0],s[1],s[2],1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const l=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(l)}},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===Zi.Verts?!1:e.primitiveType===Zi.Triangles||e.primitiveType===Zi.TriangleStrips?r===Rm.WIREFRAME:!0},t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();e.useRendererMatrix?(o=Wn.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(o=Wn.substitute(o,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(o=Wn.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(o=Wn.substitute(o,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(a.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),o=Wn.substitute(o,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),o=Wn.substitute(o,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,i)=>{const a=i.getBuffer("normalMC"),o=e.WebGPUActor.getRenderable();if(a){const s=r.getShaderDescription("vertex");s.hasOutput("normalVC")||s.addOutput("vec3<f32>","normalVC",a.getArrayInformation()[0].interpolation),s.hasOutput("tangentVC")||s.addOutput("vec3<f32>","tangentVC",a.getArrayInformation()[0].interpolation),s.hasOutput("bitangentVC")||s.addOutput("vec3<f32>","bitangentVC",a.getArrayInformation()[0].interpolation);let l=s.getCode();l=Wn.substitute(l,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,s.setCode(l);const c=r.getShaderDescription("fragment");l=c.getCode(),o.getProperty().getNormalTexture()?l=Wn.substitute(l,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:l=Wn.substitute(l,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,c.setCode(l)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,i)=>{var c;if(n.includes("sel"))return;const a=r.getShaderDescription("vertex");a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");const o=e.WebGPURenderer.getRenderable(),s=r.getShaderDescription("fragment");let l=s.getCode();if(l.includes("var normal:")&&e.useRendererMatrix&&!DM(n)&&!e.is2D&&!n.includes("sel")){const d=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(c=o.getEnvironmentTexture())!=null&&c.getImageLoaded()&&d.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),l=Wn.substitute(l,"//VTK::Light::Impl",d).result,s.setCode(l)}else l=Wn.substitute(l,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,s.setCode(l)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,i)=>{if(DM(n)){const c=r.getShaderDescription("fragment");let d=c.getCode();d=Wn.substitute(d,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,c.setCode(d);return}const a=i.getBuffer("colorVI");if(!a)return;const o=r.getShaderDescription("vertex");o.addOutput("vec4<f32>","color",a.getArrayInformation()[0].interpolation);let s=o.getCode();s=Wn.substitute(s,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,o.setCode(s);const l=r.getShaderDescription("fragment");s=l.getCode(),s=Wn.substitute(s,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,l.setCode(s)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,i)=>{var p,C,x,T,_,y,w,b,M,I,A,k,U,B,z,K,J,X,re,fe;if(!i.hasAttribute("tcoord"))return;const a=r.getShaderDescription("vertex"),o=i.getBuffer("tcoord"),s=xi.getNumberOfComponentsFromBufferFormat(o.getArrayInformation()[0].format);let l=a.getCode();a.addOutput(`vec${s}<f32>`,"tcoordVS"),l=Wn.substitute(l,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,a.setCode(l);const c=r.getShaderDescription("fragment");l=c.getCode();const d=e.WebGPUActor.getRenderable(),f=pe=>pe?pe.getDimensionality()===s:!1,h=[];((x=(C=(p=d.getProperty()).getDiffuseTexture)==null?void 0:C.call(p))!=null&&x.getImageLoaded()||d.getTextures()[0]||e.colorTexture)&&(f((_=(T=d.getProperty()).getDiffuseTexture)==null?void 0:_.call(T))||f(d.getTextures()[0])||f(e.colorTexture))&&h.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(b=(w=(y=d.getProperty()).getRoughnessTexture)==null?void 0:w.call(y))!=null&&b.getImageLoaded()&&f(d.getProperty().getRoughnessTexture())&&h.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(A=(I=(M=d.getProperty()).getMetallicTexture)==null?void 0:I.call(M))!=null&&A.getImageLoaded()&&f(d.getProperty().getMetallicTexture())&&h.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(B=(U=(k=d.getProperty()).getNormalTexture)==null?void 0:U.call(k))!=null&&B.getImageLoaded()&&f(d.getProperty().getNormalTexture())&&h.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(J=(K=(z=d.getProperty()).getAmbientOcclusionTexture)==null?void 0:K.call(z))!=null&&J.getImageLoaded()&&f(d.getProperty().getAmbientOcclusionTexture())&&h.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(fe=(re=(X=d.getProperty()).getEmissionTexture)==null?void 0:re.call(X))!=null&&fe.getImageLoaded()&&f(d.getProperty().getEmissionTexture())&&h.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),l=Wn.substitute(l,"//VTK::TCoord::Impl",h).result,c.setCode(l)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,i)=>{if(n.includes("sel")){const a=r.getShaderDescription("fragment");let o=a.getCode();o=Wn.substitute(o,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,a.setCode(o)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===Rm.POINTS||r===Zi.Points?ui.Verts:r===Zi.Lines?ui.Lines:n===Rm.WIREFRAME?r===Zi.Triangles?ui.LinesFromTriangles:ui.LinesFromStrips:r===Zi.Triangles?ui.Triangles:r===Zi.TriangleStrips?ui.Strips:r===Zi.TriangleEdges?ui.LinesFromTriangles:ui.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case ui.Triangles:return"triangle-list";case ui.Verts:return"point-list";case ui.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var x,T;const n=e.currentInput,r=e.cellArray,i=e.primitiveType;let o=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const s=e.WebGPURenderWindow.getDevice();let l=!1;i===Zi.TriangleEdges&&(l=!0,o=Rm.WIREFRAME);const c=e.vertexInput,d=n.getPoints();let f;if(r){const _={hash:`R${o}P${i}${r.getMTime()}`,usage:ui.Index,cells:r,numberOfPoints:d.getNumberOfPoints(),primitiveType:i,representation:o};f=s.getBufferManager().getBuffer(_),c.setIndexBuffer(f)}else c.setIndexBuffer(null);if(d){const _=e.WebGPUActor.getBufferShift(e.WebGPURenderer),y={hash:`${d.getMTime()}I${f.getMTime()}${_.join()}float32x4`,usage:ui.PointArray,format:"float32x4",dataArray:d,indexBuffer:f,shift:_,packExtra:!0},w=s.getBufferManager().getBuffer(y);c.addBuffer(w,["vertexBC"])}else c.removeBufferIfPresent("vertexBC");const h=t.getUsage(o,i);if(e._usesCellNormals=!1,!e.is2D&&(h===ui.Triangles||h===ui.Strips)){const _=n.getPointData().getNormals(),y={format:"snorm8x4",indexBuffer:f,packExtra:!0,shift:0,scale:127};if(_){y.hash=`${_.getMTime()}I${f.getMTime()}snorm8x4`,y.dataArray=_,y.usage=ui.PointArray;const w=s.getBufferManager().getBuffer(y);c.addBuffer(w,["normalMC"])}else if(i===Zi.Triangles){e._usesCellNormals=!0,y.hash=`PFN${d.getMTime()}I${f.getMTime()}snorm8x4`,y.dataArray=d,y.cells=r,y.usage=ui.NormalsFromPoints;const w=s.getBufferManager().getBuffer(y);c.addBuffer(w,["normalMC"])}else c.removeBufferIfPresent("normalMC")}else c.removeBufferIfPresent("normalMC");let p=!1;if(e.renderable.getScalarVisibility()){const _=e.renderable.getColorMapColors();if(_&&!l){const y=e.renderable.getScalarMode();let w=!1;(y===Am.USE_CELL_DATA||y===Am.USE_CELL_FIELD_DATA||y===Am.USE_FIELD_DATA||!n.getPointData().getScalars())&&y!==Am.USE_POINT_FIELD_DATA&&_&&(w=!0);const b={usage:ui.PointArray,format:"unorm8x4",hash:`${w}${_.getMTime()}I${f.getMTime()}unorm8x4`,dataArray:_,indexBuffer:f,cellData:w,cellOffset:0},M=s.getBufferManager().getBuffer(b);c.addBuffer(M,["colorVI"]),p=!0}}p||c.removeBufferIfPresent("colorVI");let C=null;if((T=(x=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&T.call(x)&&e.renderable.getColorCoordinates()?C=e.renderable.getColorCoordinates():C=n.getPointData().getTCoords(),C&&!l){const _=s.getBufferManager().getBufferForPointArray(C,c.getIndexBuffer());c.addBuffer(_,["tcoord"])}else c.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var l,c,d,f,h,p,C,x,T,_,y,w,b,M,I;const n=[],r=[],i=(c=(l=e.renderable).getColorTextureMap)==null?void 0:c.call(l);i&&(e.colorTexture||(e.colorTexture=Cp.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(i),r.push(["Diffuse",e.colorTexture]));const a=e.WebGPUActor.getRenderable(),o=e.WebGPURenderer.getRenderable(),s=[];if((f=(d=a.getProperty()).getDiffuseTexture)!=null&&f.call(d)){const A=["Diffuse",a.getProperty().getDiffuseTexture()];s.push(A)}if(a.getTextures()[0]){const A=["Diffuse",a.getTextures()[0]];s.push(A)}if(e.colorTexture){const A=["Diffuse",e.colorTexture];s.push(A)}if((p=(h=a.getProperty()).getRoughnessTexture)!=null&&p.call(h)){const A=["Roughness",a.getProperty().getRoughnessTexture()];s.push(A)}if((x=(C=a.getProperty()).getMetallicTexture)!=null&&x.call(C)){const A=["Metallic",a.getProperty().getMetallicTexture()];s.push(A)}if((_=(T=a.getProperty()).getNormalTexture)!=null&&_.call(T)){const A=["Normal",a.getProperty().getNormalTexture()];s.push(A)}if((w=(y=a.getProperty()).getAmbientOcclusionTexture)!=null&&w.call(y)){const A=["AmbientOcclusion",a.getProperty().getAmbientOcclusionTexture()];s.push(A)}if((M=(b=a.getProperty()).getEmissionTexture)!=null&&M.call(b)){const A=["Emission",a.getProperty().getEmissionTexture()];s.push(A)}if((I=o.getEnvironmentTexture)!=null&&I.call(o)){const A=["Environment",o.getEnvironmentTexture()];s.push(A)}for(let A=0;A<s.length;A++)(s[A][1].getInputData()||s[A][1].getJsImageData()||s[A][1].getCanvas())&&r.push(s[A]),s[A][1].getImage()&&s[A][1].getImageLoaded()&&r.push(s[A]);for(let A=0;A<r.length;A++){const k=r[A][1],U=r[A][0],B=e.device.getTextureManager().getTextureForVTKTexture(k);if(B.getReady()){let z=!1;for(let K=0;K<e.textures.length;K++)e.textures[K]===B&&(z=!0,n[K]=!0);if(!z){n[e.textures.length]=!0;const K=B.createView(`${U}Texture`);e.textures.push(B),e.textureViews.push(K);const J=k.getInterpolate()?"linear":"nearest";let X=null;!X&&k.getEdgeClamp()&&k.getRepeat()&&(X="mirror-repeat"),!X&&k.getEdgeClamp()&&(X="clamp-to-edge"),!X&&k.getRepeat()&&(X="repeat"),U!=="Environment"?K.addSampler(e.device,{addressModeU:X,addressModeV:X,addressModeW:X,minFilter:J,magFilter:J}):K.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:J,magFilter:J,mipmapFilter:"linear"})}}}for(let A=e.textures.length-1;A>=0;A--)n[A]||(e.textures.splice(A,1),e.textureViews.splice(A,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===Zi.TriangleEdges||e.primitiveType===Zi.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const i=e.vertexInput.getBuffer("tcoord"),a=xi.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);n+=`t${a}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==Zi.TriangleEdges&&e.primitiveType!==Zi.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const i=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const a=n.getProperty();t.setNumberOfInstances(Math.ceil(a.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const j2e={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function wG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j2e,n),FU.extend(t,e,n),e.fragmentShaderTemplate=z2e,e.vertexShaderTemplate=G2e,e._tmpMat3=fo(new Float64Array(9)),e._tmpMat4=kt(new Float64Array(16)),e.UBO=Sf.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Ur(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],W2e(t,e)}const H2e=Ln(wG,"vtkWebGPUCellArrayMapper");var CG={newInstance:H2e,extend:wG};const{PrimitiveTypes:Lm}=nd;function $2e(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>CG.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=Lm.Points;o<=Lm.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let o=Lm.TriangleEdges;o<=Lm.TriangleStripEdges;o++)if(r[o-2].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o-2]),s.setCurrentInput(n),s.setCellOffset(e.primitives[o-2].getCellOffset()),s.setPrimitiveType(o),s.setRenderable(e.renderable),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}const K2e={primitives:null};function q2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K2e,n),$n.extend(t,e,n),e.primitives=[],$2e(t,e)}const X2e=Ln(q2e,"vtkWebGPUPolyDataMapper");po("vtkMapper",X2e);const{PrimitiveTypes:bM}=nd;function Y2e(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>CG.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=bM.Points;o<=bM.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),s.setIs2D(!0),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}function J2e(t){return{primitives:[],...t}}function Z2e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,J2e(n)),$n.extend(t,e,n),e.primitives=[],Y2e(t,e)}const Q2e=Ln(Z2e,"vtkWebGPUPolyDataMapper2D");po("vtkMapper2D",Q2e);function eye(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const tye={};function nye(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tye,n),$n.extend(t,e,n),e.scalarBarActorHelper=vG.newScalarBarActorHelper(),eye(t,e)}const rye=Ln(nye,"vtkWebGPUScalarBarActor");po("vtkScalarBarActor",rye);function iye(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=xi.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=i.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=xi.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=i.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let i="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?i="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(i="u32");let a=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${i}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(a=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),a},t.addSampler=(n,r)=>{const i=HU.newInstance({label:`${e.label}Sampler`});i.create(n,r),t.setSampler(i)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const aye={texture:null,handle:null,sampler:null,label:null};function xG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aye,n),de.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},de.obj(e.bindGroupTime,{mtime:0}),de.get(t,e,["bindGroupTime","texture"]),de.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),iye(t,e)}const oye=de.newInstance(xG);var sye={newInstance:oye,extend:xG};const{BufferUsage:IM}=nd;function lye(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const i=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:i,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,i)=>{e.device=n,e.handle=r,e.width=i.width,e.height=i.height,e.depth=i.depth?i.depth:1,e.format=i.format?i.format:"rgba8unorm",e.usage=i.usage?i.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];if(n.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const i=xi.getDetailsFromTextureFormat(e.format);let a=e.width*i.stride;const o=(l,c,d)=>{const f=l.length/(c*d)*l.BYTES_PER_ELEMENT,h=i.elementSize===2&&i.sampleType==="float";if(h||f%256){const p=l,C=f/p.BYTES_PER_ELEMENT,x=i.elementSize,T=256*Math.floor((C*x+255)/256),_=T/x,y=de.newTypedArray(h?"Uint16Array":p.constructor.name,_*c*d);for(let w=0;w<c*d;w++)if(h)for(let b=0;b<C;b++)y[w*_+b]=Vl.toHalf(p[w*C+b]);else y.set(p.subarray(w*C,(w+1)*C),w*_);return[y,T]}return[l,f]};if(n.nativeArray&&(r=n.nativeArray),n.image){const l=document.createElement("canvas");l.width=n.image.width,l.height=n.image.height;const c=l.getContext("2d");c.translate(0,l.height),c.scale(1,-1),c.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,l.width,l.height),r=c.getImageData(0,0,n.image.width,n.image.height).data}const s=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const l=Cp.generateMipmaps(r,e.width,e.height,e.mipLevel);let c=e.width,d=e.height;for(let f=0;f<=e.mipLevel;f++){const h=o(l[f],d,1);a=h[1];const p={dataArray:n.dataArray?n.dataArray:null,nativeArray:h[0],usage:IM.Texture},C=e.device.getBufferManager().getBuffer(p);s.copyBufferToTexture({buffer:C.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:d},{texture:e.handle,mipLevel:f},[c,d,1]),c/=2,d/=2}e.device.submitCommandEncoder(s),e.ready=!0}else{const l=o(r,e.height,e.depth);a=l[1];const c={dataArray:n.dataArray?n.dataArray:null,usage:IM.Texture};c.nativeArray=l[0];const d=e.device.getBufferManager().getBuffer(c);s.copyBufferToTexture({buffer:d.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(s),e.ready=!0}},t.getScale=()=>{const n=xi.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>xi.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||i!==e.depth)&&(e.width=n,e.height=r,e.depth=i,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const i=sye.newInstance({label:n});return i.create(t,r),i}}const cye={device:null,handle:null,buffer:null,ready:!1,label:null};function uye(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cye,n),de.obj(t,e),de.get(t,e,["handle","ready","width","height","depth","format","usage"]),de.setGet(t,e,["device","label"]),lye(t,e)}de.newInstance(uye);function fye(t){if(!t||t.data.length===0)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!t.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!t.data||!Array.isArray(t.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");t.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(n=>{if(!n||!Array.isArray(n)||n.length!==3)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}class dye{constructor(e){const{points:n,type:r}=e.data;this.id=e.id,this.points=n,this.type=r,this.color=e.color,this.segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){let e=0;return e+=this.points.length*3,e}getPoints(){return this.points}getFlatPointsArray(){return this.points.map(e=>[...e]).flat()}getColor(){return this.color}getType(){return this.type}}class hye{constructor(e){this.color=[200,0,0],this.id=e.id,this.contours=[],this.color=e.color??this.color,this.frameOfReferenceUID=e.frameOfReferenceUID,this.segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(n=>{const{points:r,type:i,color:a}=n,o=new dye({id:`${this.id}-segment-${this.segmentIndex}`,data:{points:r,type:i,segmentIndex:this.segmentIndex,color:a??this.color},segmentIndex:this.segmentIndex,color:a??this.color});this.contours.push(o)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.getTotalNumberOfPoints(),n=this.getFlatPointsArray(),r=n.reduce((o,s)=>[o[0]+s[0],o[1]+s[1],o[2]+s[2]],[0,0,0]),i=[r[0]/e,r[1]/e,r[2]/e],a=n.reduce((o,s)=>{const l=this._getDistance(i,s),c=this._getDistance(i,o);return l<c?s:o},n[0]);this.centroid=a}_getSizeInBytes(){return this.contours.reduce((e,n)=>e+n.sizeInBytes,0)}getCentroid(){return this.centroid}getSegmentIndex(){return this.segmentIndex}getColor(){return this.color}getContours(){return this.contours}getSizeInBytes(){return this.sizeInBytes}getFlatPointsArray(){return this.contours.map(e=>e.getPoints()).flat()}getNumberOfContours(){return this.contours.length}getTotalNumberOfPoints(){return this.contours.reduce((e,n)=>e+n.getPoints().length,0)}getNumberOfPointsArray(){return this.contours.reduce((e,n,r)=>(e[r]=this.getNumberOfPointsInAContour(r),e),[])}getPointsInContour(e){return this.contours[e].getPoints()}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}_getDistance(e,n){return Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2+(e[2]-n[2])**2)}}function gye(t,e){fye(e);const n=new hye({id:e.id,data:e.data,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:Ig.CONTOUR,data:n,sizeInBytes:n.getSizeInBytes()}}function pye(t){const{data:e}=t;if(!e.points||!e.polys)throw new Error("Invalid surface data")}function mye(t,e){pye(e);const n=new CU({id:e.id,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,data:{points:e.data.points,polys:e.data.polys}});return{id:t,type:Ig.SURFACE,data:n,sizeInBytes:n.getSizeInBytes()}}async function vye(t,e){let n=bt.getGeometry(t);if(n)return n;if(e.type===Ig.CONTOUR)n=gye(t,e.geometryData);else if(e.type===Ig.SURFACE)n=mye(t,e.geometryData);else throw new Error("Unknown geometry type, Only CONTOUR is supported");const r={promise:Promise.resolve(n)};return await bt.putGeometryLoadObject(t,r),n}const yye=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheGeometry:vye},Symbol.toStringTag,{value:"Module"})),wye=Object.freeze(Object.defineProperty({__proto__:null,BaseVolumeViewport:Ku,CONSTANTS:WZ,EVENTS:xt,Enums:kZ,ImageVolume:pp,ProgressiveRetrieveImages:xme,RenderingEngine:_2,Settings:wr,StackViewport:jg,Surface:CU,VideoViewport:XB,Viewport:vp,VolumeViewport:Wg,VolumeViewport3D:s8,WSIViewport:YB,addImageSlicesToViewports:N1e,addVolumesToViewports:M1e,cache:bt,canRenderFloatTextures:Dk,createVolumeActor:Px,createVolumeMapper:kB,eventTarget:Hn,geometryLoader:yye,getConfiguration:vs,getEnabledElement:QT,getEnabledElementByIds:e8,getEnabledElementByViewportId:Jpe,getEnabledElements:sv,getOrCreateCanvas:os,getRenderingEngine:mc,getRenderingEngines:Hu,getShouldUseCPURendering:xf,getShouldUseSharedArrayBuffer:$u,getWebWorkerManager:$te,imageLoadPoolManager:ho,imageLoader:Kge,imageRetrievalPoolManager:Rme,init:_k,isCornerstoneInitialized:bk,metaData:Gfe,peerImport:Ik,registerImageLoader:cB,requestPoolManager:ho,resetUseCPURendering:Wte,resetUseSharedArrayBuffer:jte,setConfiguration:Hte,setPreferSizeOverAccuracy:zte,setUseCPURendering:Gte,setUseSharedArrayBuffer:$E,setVolumesForViewports:a8,triggerEvent:Kt,utilities:o8,volumeLoader:Age},Symbol.toStringTag,{value:"Module"}));var SG={exports:{}};const Cye=Yr(loe),xye=Yr(wye),Sye=Yr(Lfe);class Eye{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,n){return this.oriented||e<n?.5*(e*n)*(e*n+1)+n:.5*(n*e)*(n*e+1)+e}insertUniqueEdge(e,n,r){const i=this.computeEdgeKey(e,n);let a=this.edgeMap.get(i);return a||(a={key:i,edgeId:this.edgeMap.size,value:r},this.edgeMap.set(i,a)),a}insertEdge(e,n,r){const i=this.computeEdgeKey(e,n),a={key:i,edgeId:this.edgeMap.size,value:r};return this.edgeMap.set(i,a),a}isInsertedEdge(e,n){const r=this.computeEdgeKey(e,n);return this.edgeMap.get(r)}static getEdgePointIds(e){const n=.5*(-1+Math.sqrt(8*e.key+1)),r=e.key-.5*(n+1)*n,i=n-r;return[r,i]}}function Tye(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Eye(t.oriented)}var _ye={newInstance:Tye};const Dye=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],bye=[[0,1],[1,3],[2,3],[0,2]];function Iye(t){return Dye[t]}function Oye(t){return bye[t]}var OM={getCase:Iye,getEdge:Oye};const{vtkErrorMacro:MM,vtkDebugMacro:Mye}=de;function Nye(t,e){function n(){let s=0,l=1;return e.slicingMode===1?(s=0,l=2):e.slicingMode===0&&(s=1,l=2),[s,l]}e.classHierarchy.push("vtkImageMarchingSquares"),t.getContourValues=()=>e.contourValues,t.setContourValues=s=>{e.contourValues=s,t.modified()};const r=[],i=[],a=[],o=_ye.newInstance();t.getPixelScalars=(s,l,c,d,f,h)=>{const[p,C,x]=s;r[0]=x*l[1]*l[0]+C*l[0]+p,r[1]=r[0]+d[f],r[2]=r[0]+d[h],r[3]=r[2]+d[f];for(let T=0;T<4;++T)i[T]=c[r[T]]},t.getPixelPoints=(s,l,c,d,f)=>{const h=s[d],p=s[f];a[0]=l[d]+h*c[d],a[1]=l[f]+p*c[f],a[2]=a[0]+c[d],a[3]=a[1],a[4]=a[0],a[5]=a[1]+c[f],a[6]=a[2],a[7]=a[5]},t.produceLines=(s,l,c,d,f,h,p,C,x,T,_)=>{var U;const y=l[e.slicingMode],w=[1,2,8,4],b=[];let M;t.getPixelScalars(l,c,h,x,T,_);let I=0;for(let B=0;B<4;B++)i[B]>=s&&(I|=w[B]);const A=OM.getCase(I);if(A[0]<0)return;t.getPixelPoints(l,d,f,T,_);const k=d[e.slicingMode]+y*f[e.slicingMode];for(let B=0;A[B]>=0;B+=2){C.push(2);for(let z=0;z<2;z++){const K=OM.getEdge(A[B+z]);if(M=void 0,e.mergePoints&&(M=(U=o.isInsertedEdge(r[K[0]],r[K[1]]))==null?void 0:U.value),M===void 0){const J=(s-i[K[0]])/(i[K[1]]-i[K[0]]),X=a.slice(K[0]*2,(K[0]+1)*2),re=a.slice(K[1]*2,(K[1]+1)*2);b[T]=X[0]+J*(re[0]-X[0]),b[_]=X[1]+J*(re[1]-X[1]),b[e.slicingMode]=k,M=p.length/3,p.push(b[0],b[1],b[2]),e.mergePoints&&o.insertEdge(r[K[0]],r[K[1]],M)}C.push(M)}}},t.requestData=(s,l)=>{const c=s[0];if(!c){MM("Invalid or missing input");return}if(e.slicingMode==null||e.slicingMode<0||e.slicingMode>2){MM("Invalid or missing slicing mode");return}console.time("msquares");const d=c.getOrigin(),f=c.getSpacing(),h=c.getDimensions(),p=c.getExtent(),C=c.computeIncrements(p),x=c.getPointData().getScalars().getData(),[T,_]=n(),y=[],w=[];let b=Math.round(e.slice);b>=h[e.slicingMode]&&(b=0);const M=[0,0,0];M[e.slicingMode]=b;for(let A=0;A<e.contourValues.length;++A){for(let k=0;k<h[_]-1;++k){M[_]=k;for(let U=0;U<h[T]-1;++U)M[T]=U,t.produceLines(e.contourValues[A],M,h,d,f,x,y,w,C,T,_)}o.initialize()}const I=gi.newInstance();I.getPoints().setData(new Float32Array(y),3),I.getLines().setData(new Uint32Array(w)),l[0]=I,Mye("Produced output"),console.timeEnd("msquares")}}const Rye={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function h8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rye,n),de.obj(t,e),de.algo(t,e,1,1),de.setGet(t,e,["slicingMode","slice","mergePoints"]),de.algo(t,e,1,1),Nye(t,e)}const EG=de.newInstance(h8,"vtkImageMarchingSquares");var Aye={newInstance:EG,extend:h8};const Lye=Object.freeze(Object.defineProperty({__proto__:null,default:Aye,extend:h8,newInstance:EG},Symbol.toStringTag,{value:"Module"})),kye=Yr(Lye),Pye=Yr(Kee),Fye=Yr(Woe),Vye=Yr(wfe),Uye=Yr(ute),Bye=Yr(E0e),Gye=Yr(C0e),zye=Yr(ife),Wye=Yr(Mce),jye=Yr(dfe),Hye=Yr(ide),$ye={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};var g8={Corners:$ye};const{vtkErrorMacro:z4}=de,{Corners:km}=g8;function Kye(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const n={...t},r=[],i=qV.newInstance(),a=new ResizeObserver(h=>{t.updateViewport()});let o=null,s=null,l=null,c=null,d=null;function f(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const h=e.parentRenderer||e._interactor.getCurrentRenderer(),[p,C,x,T]=h.getViewport(),_=e._interactor.getView(),y=_.getSize(),[w,b]=_.getViewportSize(h),M=Math.min(w,b);let I=e.viewportSize*M;I=Math.max(Math.min(e.minPixelSize,M),Math.min(e.maxPixelSize,I));const A=I/y[0],k=I/y[1];switch(e.viewportCorner){case km.TOP_LEFT:return[p,T-k,p+A,T];case km.TOP_RIGHT:return[x-A,T-k,x,T];case km.BOTTOM_LEFT:return[p,C,p+A,C+k];case km.BOTTOM_RIGHT:return[x-A,C,x,C+k];default:return z4("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(i.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const p=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!p)return;const C=p.getReferenceByName("position"),x=p.getReferenceByName("focalPoint"),T=p.getReferenceByName("viewUp");if(r[0]!==C[0]||r[1]!==C[1]||r[2]!==C[2]||r[3]!==x[0]||r[4]!==x[1]||r[5]!==x[2]||r[6]!==T[0]||r[7]!==T[1]||r[8]!==T[2]){r[0]=C[0],r[1]=C[1],r[2]=C[2],r[3]=x[0],r[4]=x[1],r[5]=x[2],r[6]=T[0],r[7]=T[1],r[8]=T[2];const _=i.getActiveCamera();_.setPosition(C[0],C[1],C[2]),_.setFocalPoint(x[0],x[1],x[2]),_.setViewUp(T[0],T[1],T[2]),i.resetCamera()}},t.setEnabled=h=>{var p,C;if(h){if(e.enabled)return;if(!e.actor){z4("Must set actor before enabling orientation marker.");return}if(!e._interactor){z4("Must set interactor before enabling orientation marker.");return}const x=e.parentRenderer||e._interactor.getCurrentRenderer(),T=x.getRenderWindow();T.addRenderer(i),T.getNumberOfLayers()<2&&T.setNumberOfLayers(2),i.setLayer(T.getNumberOfLayers()-1),i.setInteractive(!1),i.addViewProp(e.actor),e.actor.setVisibility(!0),o=x.onEvent(_=>{_.type==="ActiveCameraEvent"&&(s&&s.unsubscribe(),s=_.camera.onModified(f))}),s=x.getActiveCamera().onModified(f),l=e._interactor.onAnimation(t.updateMarkerOrientation),c=e._interactor.onEndAnimation(t.updateMarkerOrientation),a.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,a.disconnect(),o.unsubscribe(),o=null,s.unsubscribe(),s=null,l.unsubscribe(),l=null,c.unsubscribe(),c=null,e.actor.setVisibility(!1),i.removeViewProp(e.actor);const x=(C=(p=e._interactor)==null?void 0:p.findPokedRenderer())==null?void 0:C.getRenderWindow();x&&x.removeRenderer(i)}t.modified()},t.setViewportCorner=h=>{h!==e.viewportCorner&&(e.viewportCorner=h,t.updateViewport())},t.setViewportSize=h=>{const p=Math.min(1,Math.max(0,h));p!==e.viewportSize&&(e.viewportSize=p,t.updateViewport())},t.setActor=h=>{const p=e.enabled;t.setEnabled(!1),e.actor=h,t.setEnabled(p)},t.getRenderer=()=>i,t.delete=()=>{n.delete(),d&&(d.unsubscribe(),d=null),o&&(o.unsubscribe(),o=null),s&&(s.unsubscribe(),s=null),l&&(l.unsubscribe(),l=null),c&&(c.unsubscribe(),c=null),a.disconnect()},d=t.onModified(t.updateViewport)}const TG={viewportCorner:g8.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null};function p8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TG,n),de.obj(t,e),de.get(t,e,["enabled","viewportCorner","viewportSize"]),de.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),de.get(t,e,["actor"]),de.moveToProtected(t,e,["interactor"]),Kye(t,e)}const _G=de.newInstance(p8,"vtkOrientationMarkerWidget");var qye={newInstance:_G,extend:p8,...g8};const Xye=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_VALUES:TG,default:qye,extend:p8,newInstance:_G},Symbol.toStringTag,{value:"Module"})),Yye=Yr(Xye);function DG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];const[n,r,i,a]=e,s=t.getContext("2d").getImageData(n,r,i||t.width,a||t.height),l=yc.newInstance({type:"vtkImageData"});l.setOrigin(0,0,0),l.setSpacing(1,1,1),l.setExtent(0,(i||t.width)-1,0,(a||t.height)-1,0,0);const c=Bt.newInstance({numberOfComponents:4,values:new Uint8Array(s.data.buffer)});return c.setName("scalars"),l.getPointData().setScalars(c),l}function Jye(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d"),{flipX:i,flipY:a,rotate:o}=e;return r.translate(n.width/2,n.height/2),r.scale(i?-1:1,a?-1:1),r.rotate(o*Math.PI/180),r.drawImage(t,-t.width/2,-t.height/2),DG(n)}var Zye={canvasToImageData:DG,imageToImageData:Jye};const bG={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:t=>t/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function IG(t,e){e.set(t)}function Qye(t,e){return IG(bG[t],e)}function e5e(t,e){bG[t]=e}var t5e={applyDefinitions:IG,applyPreset:Qye,registerStylePreset:e5e};const n5e={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};function r5e(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty={...e.xPlusFaceProperty},e.xMinusFaceProperty={...e.xMinusFaceProperty},e.yPlusFaceProperty={...e.yPlusFaceProperty},e.yMinusFaceProperty={...e.yMinusFaceProperty},e.zPlusFaceProperty={...e.zPlusFaceProperty},e.zMinusFaceProperty={...e.zMinusFaceProperty};let n=null;const r=document.createElement("canvas"),i=al.newInstance(),a=Cp.newInstance();a.setInterpolate(!0);function o(l){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;c&&Object.assign(e[`${l}FaceProperty`],c);const d={...e.defaultStyle,...e[`${l}FaceProperty`]};r.width=d.resolution,r.height=d.resolution;const f=r.getContext("2d");f.fillStyle=d.faceColor,f.fillRect(0,0,r.width,r.height),d.edgeThickness>0&&(f.strokeStyle=d.edgeColor,f.lineWidth=d.edgeThickness*r.width,f.strokeRect(0,0,r.width,r.height)),f.save(),f.translate(0,r.height),f.scale(1,-1),f.translate(r.width/2,r.height/2),f.rotate(-Math.PI*(d.faceRotation/180));const h=d.fontSizeScale(d.resolution);f.fillStyle=d.fontColor,f.textAlign="center",f.textBaseline="middle",f.font=`${d.fontStyle} ${h}px "${d.fontFamily}"`,f.fillText(d.text,0,0),f.restore();const p=Zye.canvasToImageData(r);a.setInputData(p,n5e[l]),t.modified()}function s(){n=_U.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(n.getOutputPort()),o("xPlus"),o("xMinus"),o("yPlus"),o("yMinus"),o("zPlus"),o("zMinus")}t.setDefaultStyle=l=>{e.defaultStyle={...e.defaultStyle,...l},s()},t.setXPlusFaceProperty=l=>o("xPlus",l),t.setXMinusFaceProperty=l=>o("xMinus",l),t.setYPlusFaceProperty=l=>o("yPlus",l),t.setYMinusFaceProperty=l=>o("yMinus",l),t.setZPlusFaceProperty=l=>o("zPlus",l),t.setZMinusFaceProperty=l=>o("zMinus",l),s(),i.setInputConnection(n.getOutputPort()),t.setMapper(i),t.addTexture(a)}const OG={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:t=>t/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function m8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OG,n),ol.extend(t,e,n),de.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),r5e(t,e)}const MG=de.newInstance(m8,"vtkAnnotatedCubeActor");var i5e={newInstance:MG,extend:m8,Presets:t5e};const a5e=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_VALUES:OG,default:i5e,extend:m8,newInstance:MG},Symbol.toStringTag,{value:"Module"})),o5e=Yr(a5e),{vtkErrorMacro:s5e}=de;function l5e(t,e){let n=0;return t.map((r,i)=>i===n?(n+=r+1,r):r+e)}function Pm(t,e,n,r){t.set(l5e(e,n),r)}function c5e(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(n,r)=>{const i=t.getNumberOfInputPorts();if(!i){s5e("No input specified.");return}if(i===1){r[0]=n[0];return}const a=gi.newInstance();let o=0,s=0,l=1,c=1,d=0,f=0,h=0,p=0,C=!0,x=!0,T=!0;for(let z=0;z<i;z++){const K=n[z];if(!K)continue;const J=K.getPoints().getNumberOfPoints();o+=J,d+=K.getVerts().getNumberOfValues(),f+=K.getLines().getNumberOfValues(),h+=K.getStrips().getNumberOfValues(),p+=K.getPolys().getNumberOfValues(),J&&(c&&(c=0,s=K.getPoints().getDataType()),l=K.getPoints().getDataType(),s=s>l?s:l);const X=K.getPointData();X?(C=C&&X.getNormals()!==null,x=x&&X.getTCoords()!==null,T=T&&X.getScalars()!==null):(C=!1,x=!1,T=!1)}e.outputPointsPrecision===u2.SINGLE?s=un.FLOAT:e.outputPointsPrecision===u2.DOUBLE&&(s=un.DOUBLE);const _=kf.newInstance({dataType:s});_.setNumberOfPoints(o);const y=_.getData(),w=new Uint32Array(d),b=new Uint32Array(f),M=new Uint32Array(h),I=new Uint32Array(p);let A=null,k=null,U=null;const B=n[i-1];if(C){const z=B.getPointData().getNormals();A=Bt.newInstance({numberOfComponents:3,numberOfTuples:o,size:3*o,dataType:z.getDataType(),name:z.getName()})}if(x){const z=B.getPointData().getTCoords();k=Bt.newInstance({numberOfComponents:2,numberOfTuples:o,size:2*o,dataType:z.getDataType(),name:z.getName()})}if(T){const z=B.getPointData().getScalars();U=Bt.newInstance({numberOfComponents:z.getNumberOfComponents(),numberOfTuples:o,size:o*z.getNumberOfComponents(),dataType:z.getDataType(),name:z.getName()})}o=0,d=0,f=0,h=0,p=0;for(let z=0;z<i;z++){const K=n[z];y.set(K.getPoints().getData(),o*3),Pm(w,K.getVerts().getData(),o,d),d+=K.getVerts().getNumberOfValues(),Pm(b,K.getLines().getData(),o,f),f+=K.getLines().getNumberOfValues(),Pm(M,K.getStrips().getData(),o,h),h+=K.getStrips().getNumberOfValues(),Pm(I,K.getPolys().getData(),o,p),p+=K.getPolys().getNumberOfValues();const J=K.getPointData();if(C){const X=J.getNormals();A.getData().set(X.getData(),o*3)}if(x){const X=J.getTCoords();k.getData().set(X.getData(),o*2)}if(T){const X=J.getScalars();U.getData().set(X.getData(),o*U.getNumberOfComponents())}o+=K.getPoints().getNumberOfPoints()}a.setPoints(_),a.getVerts().setData(w),a.getLines().setData(b),a.getStrips().setData(M),a.getPolys().setData(I),A&&a.getPointData().setNormals(A),k&&a.getPointData().setTCoords(k),U&&a.getPointData().setScalars(U),r[0]=a}}const u5e={outputPointsPrecision:u2.DEFAULT};function NG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u5e,n),de.setGet(t,e,["outputPointsPrecision"]),de.obj(t,e),de.algo(t,e,1,1),c5e(t,e)}const f5e=de.newInstance(NG,"vtkAppendPolyData");var RG={newInstance:f5e,extend:NG};function d5e(t,e){e.classHierarchy.push("vtkConeSource");function n(r,i){if(e.deleted)return;let a=i[0];const o=2*Math.PI/e.resolution,s=-e.height/2,l=e.resolution+1,c=4*e.resolution+1+e.resolution;let d=0;const f=de.newTypedArray(e.pointType,l*3);let h=0;const p=new Uint32Array(c);f[0]=e.height/2,f[1]=0,f[2]=0,e.capping&&(p[h++]=e.resolution);for(let C=0;C<e.resolution;C++)d++,f[d*3+0]=s,f[d*3+1]=e.radius*Math.cos(C*o),f[d*3+2]=e.radius*Math.sin(C*o),e.capping&&(p[e.resolution-h+++1]=d);for(let C=0;C<e.resolution;C++)p[h++]=3,p[h++]=0,p[h++]=C+1,p[h++]=C+2>e.resolution?1:C+2;Ci.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(f),a=gi.newInstance(),a.getPoints().setData(f,3),a.getPolys().setData(p,1),i[0]=a}t.requestData=n}const h5e={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function AG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h5e,n),de.obj(t,e),de.setGet(t,e,["height","radius","resolution","capping"]),de.setGetArray(t,e,["center","direction"],3),de.algo(t,e,0,1),d5e(t,e)}const g5e=de.newInstance(AG,"vtkConeSource");var p5e={newInstance:g5e,extend:AG};function m5e(t,e){e.classHierarchy.push("vtkCylinderSource");function n(r,i){if(e.deleted)return;let a=i[0];const o=2*Math.PI/e.resolution;let s=2*e.resolution,l=5*e.resolution;e.capping&&(s=4*e.resolution,l=7*e.resolution+2);const c=de.newTypedArray(e.pointType,s*3);let d=0;const f=new Uint32Array(l),h=new Float32Array(s*3),p=Bt.newInstance({numberOfComponents:3,values:h,name:"Normals"}),C=new Float32Array(s*2),x=Bt.newInstance({numberOfComponents:2,values:C,name:"TCoords"}),T=[0,0,0],_=[0,0,0],y=[0,0,0],w=[0,0,0],b=[0,0],M=[0,0],I=e.otherRadius==null?e.radius:e.otherRadius;for(let A=0;A<e.resolution;A++){T[0]=Math.cos(A*o+e.initAngle),_[0]=T[0],y[0]=e.radius*T[0]+e.center[0],w[0]=y[0],b[0]=Math.abs(2*A/e.resolution-1),M[0]=b[0],y[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],b[1]=0,M[1]=1,T[2]=-Math.sin(A*o+e.initAngle),_[2]=T[2],y[2]=I*T[2]+e.center[2],w[2]=y[2];const k=2*A;for(let U=0;U<3;U++)h[k*3+U]=T[U],h[(k+1)*3+U]=_[U],c[k*3+U]=y[U],c[(k+1)*3+U]=w[U],U<2&&(C[k*2+U]=b[U],C[(k+1)*2+U]=M[U])}for(let A=0;A<e.resolution;A++){f[d++]=4,f[d++]=2*A,f[d++]=2*A+1;const k=(2*A+3)%(2*e.resolution);f[d++]=k,f[d++]=k-1}if(e.capping){for(let A=0;A<e.resolution;A++){y[0]=e.radius*Math.cos(A*o+e.initAngle),w[0]=y[0],b[0]=y[0],M[0]=y[0],y[0]+=e.center[0],w[0]+=e.center[0],T[1]=1,_[1]=-1,y[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],y[2]=-I*Math.sin(A*o+e.initAngle),w[2]=y[2],b[1]=y[2],M[1]=y[2],y[2]+=e.center[2],w[2]+=e.center[2];const k=2*e.resolution+A,U=3*e.resolution+e.resolution-A-1;for(let B=0;B<3;B++)h[3*k+B]=T[B],h[3*U+B]=_[B],c[3*k+B]=y[B],c[3*U+B]=w[B],B<2&&(C[2*k+B]=b[B],C[2*U+B]=M[B])}f[d++]=e.resolution;for(let A=0;A<e.resolution;A++)f[d++]=2*e.resolution+A;f[d++]=e.resolution;for(let A=0;A<e.resolution;A++)f[d++]=3*e.resolution+A}Ci.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(A=>A*-1)).apply(c),a=gi.newInstance(),a.getPoints().setData(c,3),a.getPolys().setData(f,1),a.getPointData().setNormals(p),a.getPointData().setTCoords(x),i[0]=a}t.requestData=n}const v5e={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function LG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,v5e,n),de.obj(t,e),de.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),de.setGetArray(t,e,["center","direction"],3),de.algo(t,e,0,1),m5e(t,e)}const y5e=de.newInstance(LG,"vtkCylinderSource");var w5e={newInstance:y5e,extend:LG};function C5e(t,e){e.classHierarchy.push("vtkArrowSource");function n(r,i){if(e.deleted)return;const a=w5e.newInstance({capping:!0});a.setResolution(e.shaftResolution),a.setRadius(e.shaftRadius),a.setHeight(1-e.tipLength),a.setCenter(0,(1-e.tipLength)*.5,0);const o=a.getOutputData(),s=o.getPoints().getData(),l=o.getPointData().getNormals().getData();Ci.buildFromDegree().rotateZ(-90).apply(s).apply(l);const c=p5e.newInstance();c.setResolution(e.tipResolution),c.setHeight(e.tipLength),c.setRadius(e.tipRadius);const d=c.getOutputData(),f=d.getPoints().getData();Ci.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(f);const h=RG.newInstance();h.setInputData(o),h.addInputData(d);const p=h.getOutputData(),C=p.getPoints().getData();Ci.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(C),e.invert?(Ci.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(C),i[0]=p):(Ci.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(C),i[0]=h.getOutputData())}t.requestData=n}const x5e={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function kG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,x5e,n),de.obj(t,e),de.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),de.setGetArray(t,e,["direction"],3),de.algo(t,e,0,1),C5e(t,e)}const S5e=de.newInstance(kG,"vtkArrowSource");var W4={newInstance:S5e,extend:kG};function j4(t){const e=t.getPoints().getBounds(),n=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];Ci.buildFromDegree().translate(...n).apply(t.getPoints().getData())}function H4(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=t.getPoints().getBounds(),i=[0,0,0];n?i[e]=-r[e*2+1]:i[e]=-r[e*2],Ci.buildFromDegree().translate(...i).apply(t.getPoints().getData())}function $4(t,e,n,r){const i=t.getPoints().getData().length,a=new Uint8ClampedArray(i);let o=0;for(;o<i;)a[o++]=e,a[o++]=n,a[o++]=r;t.getPointData().setScalars(Bt.newInstance({name:"color",numberOfComponents:3,values:a}))}function E5e(t,e){e.classHierarchy.push("vtkAxesActor");const n=al.newInstance();t.setMapper(n),t.update=()=>{let i={...e.config,...e.xConfig};const a=W4.newInstance({direction:[1,0,0],...i}).getOutputData();e.config.recenter?j4(a):H4(a,0,i.invert),$4(a,...i.color),i={...e.config,...e.yConfig};const o=W4.newInstance({direction:[0,1,0],...i}).getOutputData();e.config.recenter?j4(o):H4(o,1,i.invert),$4(o,...i.color),i={...e.config,...e.zConfig};const s=W4.newInstance({direction:[0,0,1],...i}).getOutputData();e.config.recenter?j4(s):H4(s,2,i.invert),$4(s,...i.color);const l=RG.newInstance();l.setInputData(a),l.addInputData(o),l.addInputData(s),n.setInputConnection(l.getOutputPort())},t.update();const r=de.debounce(t.update,0);t.setXAxisColor=i=>t.setXConfig({...t.getXConfig(),color:i}),t.setYAxisColor=i=>t.setYConfig({...t.getYConfig(),color:i}),t.setZAxisColor=i=>t.setZConfig({...t.getZConfig(),color:i}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=r,e._onXConfigChanged=r,e._onYConfigChanged=r,e._onZConfigChanged=r}function T5e(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t==null?void 0:t.config},xConfig:{color:[255,0,0],invert:!1,...t==null?void 0:t.xConfig},yConfig:{color:[255,255,0],invert:!1,...t==null?void 0:t.yConfig},zConfig:{color:[0,128,0],invert:!1,...t==null?void 0:t.zConfig}}}function v8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ol.extend(t,e,T5e(n)),de.setGet(t,e,["config","xConfig","yConfig","zConfig"]),E5e(t,e)}const PG=de.newInstance(v8,"vtkAxesActor");var _5e={newInstance:PG,extend:v8};const D5e=Object.freeze(Object.defineProperty({__proto__:null,default:_5e,extend:v8,newInstance:PG},Symbol.toStringTag,{value:"Module"})),b5e=Yr(D5e);var FG={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Or,function(){return function(n){var r={};function i(a){if(r[a])return r[a].exports;var o=r[a]={i:a,l:!1,exports:{}};return n[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=r,i.d=function(a,o,s){i.o(a,o)||Object.defineProperty(a,o,{enumerable:!0,get:s})},i.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.t=function(a,o){if(1&o&&(a=i(a)),8&o||4&o&&typeof a=="object"&&a&&a.__esModule)return a;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:a}),2&o&&typeof a!="string")for(var l in a)i.d(s,l,(function(c){return a[c]}).bind(null,l));return s},i.n=function(a){var o=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(o,"a",o),o},i.o=function(a,o){return Object.prototype.hasOwnProperty.call(a,o)},i.p="",i(i.s=184)}([function(n,r,i){function a(o){for(var s in o)r.hasOwnProperty(s)||(r[s]=o[s])}Object.defineProperty(r,"__esModule",{value:!0}),a(i(240)),a(i(251)),a(i(175)),a(i(107)),a(i(29)),a(i(73)),a(i(106)),a(i(30)),a(i(252)),a(i(52)),a(i(97)),a(i(253)),a(i(37)),a(i(51)),a(i(173)),a(i(176)),a(i(172)),a(i(108)),a(i(254)),a(i(255)),a(i(256)),a(i(72)),a(i(177)),a(i(105)),a(i(17)),a(i(257)),a(i(12)),a(i(174))},function(n,r,i){var a=this&&this.__values||function(w){var b=typeof Symbol=="function"&&Symbol.iterator,M=b&&w[b],I=0;if(M)return M.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&I>=w.length&&(w=void 0),{value:w&&w[I++],done:!w}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(212);r.FixedSizeSet=o.FixedSizeSet;var s=i(213);r.ObjectCache=s.ObjectCache;var l=i(214);r.CompareCache=l.CompareCache;var c=i(215);r.Lazy=c.Lazy;var d=i(216);function f(w,b,M){if(_(w))w.forEach(function(A,k){return b.call(M,k,A)});else for(var I in w)w.hasOwnProperty(I)&&b.call(M,I,w[I])}function h(w){var b,M;if(p(w))return w;if(x(w)){var I=[];try{for(var A=a(w),k=A.next();!k.done;k=A.next()){var U=k.value;I.push(h(U))}}catch(K){b={error:K}}finally{try{k&&!k.done&&(M=A.return)&&M.call(A)}finally{if(b)throw b.error}}return I}if(C(w)){I={};for(var B in w)if(w.hasOwnProperty(B)){var z=w[B];I[B]=h(z)}return I}return w}function p(w){return!!w&&Object.prototype.toString.call(w)==="[object Function]"}function C(w){var b=typeof w;return!!w&&(b==="function"||b==="object")}function x(w){return Array.isArray(w)}function T(w){return w instanceof Set}function _(w){return w instanceof Map}function y(w){if(C(w)){var b=Object.getPrototypeOf(w),M=b.constructor;return b&&M&&typeof M=="function"&&M instanceof M&&Function.prototype.toString.call(M)===Function.prototype.toString.call(Object)}return!1}r.StringWalker=d.StringWalker,r.applyMixin=function(w,b){for(var M=[],I=2;I<arguments.length;I++)M[I-2]=arguments[I];Object.getOwnPropertyNames(b.prototype).forEach(function(A){if(A!=="constructor"){if(M.indexOf(A)!==-1){var k=Object.getOwnPropertyDescriptor(w.prototype,A);k&&Object.defineProperty(w.prototype,"_"+A,k)}var U=Object.getOwnPropertyDescriptor(b.prototype,A);U&&Object.defineProperty(w.prototype,A,U)}})},r.applyDefaults=function w(b,M,I){I===void 0&&(I=!1);var A=h(b||{});return f(M,function(k,U){y(U)?A[k]=w(A[k],U,I):(I||A[k]===void 0)&&(A[k]=U)}),A},r.forEachArray=function(w,b,M){w.forEach(b,M)},r.forEachObject=f,r.arrayLength=function(w){return T(w)?w.size:w.length},r.objectLength=function(w){return _(w)?w.size:Object.keys(w).length},r.getObjectValue=function(w,b){return _(w)?w.get(b):w[b]},r.removeObjectValue=function(w,b){_(w)?w.delete(b):delete w[b]},r.clone=h,r.isBoolean=function(w){return typeof w=="boolean"},r.isNumber=function(w){return typeof w=="number"},r.isString=function(w){return typeof w=="string"},r.isFunction=p,r.isObject=C,r.isArray=x,r.isSet=T,r.isMap=_,r.isEmpty=function(w){if(x(w))return!w.length;if(T(w)||_(w))return!w.size;if(C(w)){for(var b in w)if(w.hasOwnProperty(b))return!1;return!0}return!1},r.isPlainObject=y,r.isIterable=function(w){return w&&typeof w[Symbol.iterator]=="function"},r.getValue=function(w){return p(w.valueOf)?w.valueOf():w},r.utf8Encode=function(w){for(var b=new Uint8Array(4*w.length),M=0,I=0;I<w.length;I++){var A=w.charCodeAt(I);if(A<128)b[M++]=A;else{if(A<2048)b[M++]=A>>6|192;else{if(A>55295&&A<56320){if(++I>=w.length)throw new Error("Incomplete surrogate pair.");var k=w.charCodeAt(I);if(k<56320||k>57343)throw new Error("Invalid surrogate character.");A=65536+((1023&A)<<10)+(1023&k),b[M++]=A>>18|240,b[M++]=A>>12&63|128}else b[M++]=A>>12|224;b[M++]=A>>6&63|128}b[M++]=63&A|128}}return b.subarray(0,M)},r.utf8Decode=function(w){for(var b="",M=0;M<w.length;){var I=w[M++];if(I>127)if(I>191&&I<224){if(M>=w.length)throw new Error("Incomplete 2-byte sequence.");I=(31&I)<<6|63&w[M++]}else if(I>223&&I<240){if(M+1>=w.length)throw new Error("Incomplete 3-byte sequence.");I=(15&I)<<12|(63&w[M++])<<6|63&w[M++]}else{if(!(I>239&&I<248))throw new Error("Unknown multi-byte start.");if(M+2>=w.length)throw new Error("Incomplete 4-byte sequence.");I=(7&I)<<18|(63&w[M++])<<12|(63&w[M++])<<6|63&w[M++]}if(I<=65535)b+=String.fromCharCode(I);else{if(!(I<=1114111))throw new Error("Code point exceeds UTF-16 limit.");I-=65536,b+=String.fromCharCode(I>>10|55296),b+=String.fromCharCode(1023&I|56320)}}return b}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),function(a){a[a.Before=0]="Before",a[a.Equal=1]="Equal",a[a.After=2]="After"}(r.BoundaryPosition||(r.BoundaryPosition={})),function(a){a[a.None=0]="None",a[a.Capturing=1]="Capturing",a[a.AtTarget=2]="AtTarget",a[a.Bubbling=3]="Bubbling"}(r.EventPhase||(r.EventPhase={})),function(a){a[a.Element=1]="Element",a[a.Attribute=2]="Attribute",a[a.Text=3]="Text",a[a.CData=4]="CData",a[a.EntityReference=5]="EntityReference",a[a.Entity=6]="Entity",a[a.ProcessingInstruction=7]="ProcessingInstruction",a[a.Comment=8]="Comment",a[a.Document=9]="Document",a[a.DocumentType=10]="DocumentType",a[a.DocumentFragment=11]="DocumentFragment",a[a.Notation=12]="Notation"}(r.NodeType||(r.NodeType={})),function(a){a[a.Disconnected=1]="Disconnected",a[a.Preceding=2]="Preceding",a[a.Following=4]="Following",a[a.Contains=8]="Contains",a[a.ContainedBy=16]="ContainedBy",a[a.ImplementationSpecific=32]="ImplementationSpecific"}(r.Position||(r.Position={})),function(a){a[a.Accept=1]="Accept",a[a.Reject=2]="Reject",a[a.Skip=3]="Skip"}(r.FilterResult||(r.FilterResult={})),function(a){a[a.All=4294967295]="All",a[a.Element=1]="Element",a[a.Attribute=2]="Attribute",a[a.Text=4]="Text",a[a.CDataSection=8]="CDataSection",a[a.EntityReference=16]="EntityReference",a[a.Entity=32]="Entity",a[a.ProcessingInstruction=64]="ProcessingInstruction",a[a.Comment=128]="Comment",a[a.Document=256]="Document",a[a.DocumentType=512]="DocumentType",a[a.DocumentFragment=1024]="DocumentFragment",a[a.Notation=2048]="Notation"}(r.WhatToShow||(r.WhatToShow={})),function(a){a[a.StartToStart=0]="StartToStart",a[a.StartToEnd=1]="StartToEnd",a[a.EndToEnd=2]="EndToEnd",a[a.EndToStart=3]="EndToStart"}(r.HowToCompare||(r.HowToCompare={}))},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(241);r.Cast=a.Cast;var o=i(150);r.Guard=o.Guard;var s=i(242);r.EmptySet=s.EmptySet},function(n,r,i){var a=i(11),o=i(55).f,s=i(21),l=i(25),c=i(80),d=i(119),f=i(123);n.exports=function(h,p){var C,x,T,_,y,w=h.target,b=h.global,M=h.stat;if(C=b?a:M?a[w]||c(w,{}):(a[w]||{}).prototype)for(x in p){if(_=p[x],T=h.noTargetGet?(y=o(C,x))&&y.value:C[x],!f(b?x:w+(M?".":"#")+x,h.forced)&&T!==void 0){if(typeof _==typeof T)continue;d(_,T)}(h.sham||T&&T.sham)&&s(_,"sham",!0),l(C,x,_,h)}}},function(n,r,i){var a=i(11),o=i(81),s=i(14),l=i(58),c=i(86),d=i(124),f=o("wks"),h=a.Symbol,p=d?h:h&&h.withoutSetter||l;n.exports=function(C){return s(f,C)||(c&&s(h,C)?f[C]=h[C]:f[C]=p("Symbol."+C)),f[C]}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(1),o=i(29),s=function(){function l(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new a.CompareCache,this._rangeList=new a.FixedSizeSet}return l.prototype.setFeatures=function(c){if(c===void 0&&(c=!0),a.isObject(c))for(var d in c)this._features[d]=c[d]||!1;else for(var d in this._features)this._features[d]=c},Object.defineProperty(l.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"window",{get:function(){return this._window===null&&(this._window=o.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(l,"instance",{get:function(){return l._instance||(l._instance=new l),l._instance},enumerable:!0,configurable:!0}),l}();r.dom=s.instance},function(n,r,i){var a=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var w={};if(y!=null)for(var b in y)Object.hasOwnProperty.call(y,b)&&(w[b]=y[b]);return w.default=y,w};Object.defineProperty(r,"__esModule",{value:!0});var o=a(i(228));r.base64=o;var s=a(i(146));r.byte=s;var l=a(i(147));r.byteSequence=l;var c=a(i(96));r.codePoint=c;var d=a(i(232));r.json=d;var f=a(i(233));r.list=f;var h=a(i(234));r.map=h;var p=a(i(235));r.namespace=p;var C=a(i(236));r.queue=C;var x=a(i(237));r.set=x;var T=a(i(238));r.stack=T;var _=a(i(239));r.string=_},function(n,r){n.exports=function(i){try{return!!i()}catch{return!0}}},function(n,r,i){var a,o=this&&this.__extends||(a=function(ie,te){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ee,we){ee.__proto__=we}||function(ee,we){for(var Ce in we)we.hasOwnProperty(Ce)&&(ee[Ce]=we[Ce])})(ie,te)},function(ie,te){function ee(){this.constructor=ie}a(ie,te),ie.prototype=te===null?Object.create(te):(ee.prototype=te.prototype,new ee)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(ie){function te(ee,we){we===void 0&&(we="");var Ce=ie.call(this,we)||this;return Ce.name=ee,Ce}return o(te,ie),te}(Error);r.DOMException=s;var l=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"DOMStringSizeError",ee)||this}return o(te,ie),te}(s);r.DOMStringSizeError=l;var c=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"WrongDocumentError","The object is in the wrong document. "+ee)||this}return o(te,ie),te}(s);r.WrongDocumentError=c;var d=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NoDataAllowedError",ee)||this}return o(te,ie),te}(s);r.NoDataAllowedError=d;var f=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NoModificationAllowedError","The object can not be modified. "+ee)||this}return o(te,ie),te}(s);r.NoModificationAllowedError=f;var h=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NotSupportedError","The operation is not supported. "+ee)||this}return o(te,ie),te}(s);r.NotSupportedError=h;var p=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InUseAttributeError",ee)||this}return o(te,ie),te}(s);r.InUseAttributeError=p;var C=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InvalidStateError","The object is in an invalid state. "+ee)||this}return o(te,ie),te}(s);r.InvalidStateError=C;var x=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InvalidModificationError","The object can not be modified in this way. "+ee)||this}return o(te,ie),te}(s);r.InvalidModificationError=x;var T=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+ee)||this}return o(te,ie),te}(s);r.NamespaceError=T;var _=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InvalidAccessError","The object does not support the operation or argument. "+ee)||this}return o(te,ie),te}(s);r.InvalidAccessError=_;var y=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"ValidationError",ee)||this}return o(te,ie),te}(s);r.ValidationError=y;var w=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"TypeMismatchError",ee)||this}return o(te,ie),te}(s);r.TypeMismatchError=w;var b=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"SecurityError","The operation is insecure. "+ee)||this}return o(te,ie),te}(s);r.SecurityError=b;var M=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NetworkError","A network error occurred. "+ee)||this}return o(te,ie),te}(s);r.NetworkError=M;var I=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"AbortError","The operation was aborted. "+ee)||this}return o(te,ie),te}(s);r.AbortError=I;var A=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"URLMismatchError","The given URL does not match another URL. "+ee)||this}return o(te,ie),te}(s);r.URLMismatchError=A;var k=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"QuotaExceededError","The quota has been exceeded. "+ee)||this}return o(te,ie),te}(s);r.QuotaExceededError=k;var U=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"TimeoutError","The operation timed out. "+ee)||this}return o(te,ie),te}(s);r.TimeoutError=U;var B=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+ee)||this}return o(te,ie),te}(s);r.InvalidNodeTypeError=B;var z=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"DataCloneError","The object can not be cloned. "+ee)||this}return o(te,ie),te}(s);r.DataCloneError=z;var K=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+ee)||this}return o(te,ie),te}(s);r.NotImplementedError=K;var J=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+ee)||this}return o(te,ie),te}(s);r.HierarchyRequestError=J;var X=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"NotFoundError","The object can not be found here. "+ee)||this}return o(te,ie),te}(s);r.NotFoundError=X;var re=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"IndexSizeError","The index is not in the allowed range. "+ee)||this}return o(te,ie),te}(s);r.IndexSizeError=re;var fe=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"SyntaxError","The string did not match the expected pattern. "+ee)||this}return o(te,ie),te}(s);r.SyntaxError=fe;var pe=function(ie){function te(ee){return ee===void 0&&(ee=""),ie.call(this,"InvalidCharacterError","The string contains invalid characters. "+ee)||this}return o(te,ie),te}(s);r.InvalidCharacterError=pe},function(n,r,i){var a=i(53),o=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];n.exports=function(l,c){var d,f;if(c=c||{},Object.keys(c).forEach(function(h){if(o.indexOf(h)===-1)throw new a('Unknown option "'+h+'" is met in definition of "'+l+'" YAML type.')}),this.tag=l,this.kind=c.kind||null,this.resolve=c.resolve||function(){return!0},this.construct=c.construct||function(h){return h},this.instanceOf=c.instanceOf||null,this.predicate=c.predicate||null,this.represent=c.represent||null,this.defaultStyle=c.defaultStyle||null,this.styleAliases=(d=c.styleAliases||null,f={},d!==null&&Object.keys(d).forEach(function(h){d[h].forEach(function(p){f[String(p)]=h})}),f),s.indexOf(this.kind)===-1)throw new a('Unknown kind "'+this.kind+'" is specified for "'+l+'" YAML type.')}},function(n,r,i){(function(a){var o=function(s){return s&&s.Math==Math&&s};n.exports=o(typeof globalThis=="object"&&globalThis)||o(typeof window=="object"&&window)||o(typeof self=="object"&&self)||o(typeof a=="object"&&a)||Function("return this")()}).call(this,i(78))},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.idl_defineConst=function(a,o,s){Object.defineProperty(a,o,{writable:!1,enumerable:!0,configurable:!1,value:s})}},function(n,r){n.exports=function(i){return typeof i=="object"?i!==null:typeof i=="function"}},function(n,r){var i={}.hasOwnProperty;n.exports=function(a,o){return i.call(a,o)}},function(n,r,i){var a=i(16),o=i(115),s=i(18),l=i(56),c=Object.defineProperty;r.f=a?c:function(d,f,h){if(s(d),f=l(f,!0),s(h),o)try{return c(d,f,h)}catch{}if("get"in h||"set"in h)throw TypeError("Accessors not supported");return"value"in h&&(d[f]=h.value),d}},function(n,r,i){var a=i(8);n.exports=!a(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},function(n,r,i){var a=this&&this.__values||function(w){var b=typeof Symbol=="function"&&Symbol.iterator,M=b&&w[b],I=0;if(M)return M.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&I>=w.length&&(w=void 0),{value:w&&w[I++],done:!w}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(3),s=i(2);function l(w,b,M){if(M===void 0&&(M=!1),M&&o.Guard.isElementNode(b)&&o.Guard.isShadowRoot(b.shadowRoot)&&b.shadowRoot._firstChild)return b.shadowRoot._firstChild;if(b._firstChild)return b._firstChild;if(b===w)return null;if(b._nextSibling)return b._nextSibling;for(var I=b._parent;I&&I!==w;){if(I._nextSibling)return I._nextSibling;I=I._parent}return null}function c(){var w;return(w={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},w}function d(w,b,M,I){b===void 0&&(b=!1),M===void 0&&(M=!1);for(var A=b?w:l(w,w,M);A&&I&&!I(A);)A=l(w,A,M);return A}function f(w,b,M,I,A){I===void 0&&(I=!1);for(var k=l(w,b,I);k&&A&&!A(k);)k=l(w,k,I);return k}function h(w,b,M,I){var A;return b===void 0&&(b=!1),M===void 0&&(M=!1),b||w._children.size!==0?((A={})[Symbol.iterator]=function(){var k=b?w:l(w,w,M);return{next:function(){for(;k&&I&&!I(k);)k=l(w,k,M);if(k===null)return{done:!0,value:null};var U={done:!1,value:k};return k=l(w,k,M),U}}},A):c()}function p(w,b,M){b===void 0&&(b=!1);for(var I=b?w:w._parent;I&&M&&!M(I);)I=I._parent;return I}function C(w,b,M,I){for(var A=b._parent;A&&I&&!I(A);)A=A._parent;return A}function x(w){return o.Guard.isDocumentTypeNode(w)?0:o.Guard.isCharacterDataNode(w)?w._data.length:w._children.size}function T(w,b){if(b===void 0&&(b=!1),b){var M=T(w,!1);return o.Guard.isShadowRoot(M)?T(M._host,!0):M}return w._parent?T(w._parent):w}function _(w,b,M,I){M===void 0&&(M=!1),I===void 0&&(I=!1);for(var A=M?w:I&&o.Guard.isShadowRoot(w)?w._host:w._parent;A!==null;){if(A===b)return!0;A=I&&o.Guard.isShadowRoot(A)?A._host:A._parent}return!1}function y(w){for(var b=T(w),M=0,I=d(b);I!==null;){if(M++,I===w)return M;I=f(b,I)}return-1}r.tree_getFirstDescendantNode=d,r.tree_getNextDescendantNode=f,r.tree_getDescendantNodes=h,r.tree_getDescendantElements=function(w,b,M,I){var A;return b===void 0&&(b=!1),M===void 0&&(M=!1),b||w._children.size!==0?((A={})[Symbol.iterator]=function(){var k=h(w,b,M,function(B){return o.Guard.isElementNode(B)})[Symbol.iterator](),U=k.next().value;return{next:function(){for(;U&&I&&!I(U);)U=k.next().value;if(U===null)return{done:!0,value:null};var B={done:!1,value:U};return U=k.next().value,B}}},A):c()},r.tree_getSiblingNodes=function(w,b,M){var I;return b===void 0&&(b=!1),w._parent&&w._parent._children.size!==0?((I={})[Symbol.iterator]=function(){var A=w._parent?w._parent._firstChild:null;return{next:function(){for(;A&&(M&&!M(A)||!b&&A===w);)A=A._nextSibling;if(A===null)return{done:!0,value:null};var k={done:!1,value:A};return A=A._nextSibling,k}}},I):c()},r.tree_getFirstAncestorNode=p,r.tree_getNextAncestorNode=C,r.tree_getAncestorNodes=function(w,b,M){var I;return b===void 0&&(b=!1),b||w._parent?((I={})[Symbol.iterator]=function(){var A=p(w,b,M);return{next:function(){if(A===null)return{done:!0,value:null};var k={done:!1,value:A};return A=C(0,A,b,M),k}}},I):c()},r.tree_getCommonAncestor=function(w,b){if(w===b)return w._parent;for(var M=[],I=[],A=p(w,!0);A!==null;)M.push(A),A=C(0,A);for(var k=p(b,!0);k!==null;)I.push(k),k=C(0,k);for(var U=M.length,B=I.length,z=null,K=Math.min(U,B);K>0;K--){var J=M[--U];if(J!==I[--B])break;z=J}return z},r.tree_getFollowingNode=function(w,b){if(b._firstChild)return b._firstChild;if(b._nextSibling)return b._nextSibling;for(;;){var M=b._parent;if(M===null||M===w)return null;if(M._nextSibling)return M._nextSibling;b=M}},r.tree_getPrecedingNode=function(w,b){return b===w?null:b._previousSibling?(b=b._previousSibling)._lastChild?b._lastChild:b:b._parent},r.tree_isConstrained=function w(b){var M,I,A,k,U,B;switch(b._nodeType){case s.NodeType.Document:var z=!1,K=!1;try{for(var J=a(b._children),X=J.next();!X.done;X=J.next())switch(X.value._nodeType){case s.NodeType.ProcessingInstruction:case s.NodeType.Comment:break;case s.NodeType.DocumentType:if(z||K)return!1;z=!0;break;case s.NodeType.Element:if(K)return!1;K=!0;break;default:return!1}}catch(te){M={error:te}}finally{try{X&&!X.done&&(I=J.return)&&I.call(J)}finally{if(M)throw M.error}}break;case s.NodeType.DocumentFragment:case s.NodeType.Element:try{for(var re=a(b._children),fe=re.next();!fe.done;fe=re.next())switch(fe.value._nodeType){case s.NodeType.Element:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:break;default:return!1}}catch(te){A={error:te}}finally{try{fe&&!fe.done&&(k=re.return)&&k.call(re)}finally{if(A)throw A.error}}break;case s.NodeType.DocumentType:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:return!b.hasChildNodes()}try{for(var pe=a(b._children),ie=pe.next();!ie.done;ie=pe.next())if(!w(ie.value))return!1}catch(te){U={error:te}}finally{try{ie&&!ie.done&&(B=pe.return)&&B.call(pe)}finally{if(U)throw U.error}}return!0},r.tree_nodeLength=x,r.tree_isEmpty=function(w){return x(w)===0},r.tree_rootNode=T,r.tree_isDescendantOf=function(w,b,M,I){M===void 0&&(M=!1),I===void 0&&(I=!1);for(var A=d(w,M,I);A!==null;){if(A===b)return!0;A=f(w,A,M,I)}return!1},r.tree_isAncestorOf=_,r.tree_isHostIncludingAncestorOf=function w(b,M,I){if(I===void 0&&(I=!1),_(b,M,I))return!0;var A=T(b);return!(!o.Guard.isDocumentFragmentNode(A)||A._host===null||!w(A._host,M,I))},r.tree_isSiblingOf=function(w,b,M){return M===void 0&&(M=!1),w!==b?w._parent!==null&&w._parent===b._parent:!!M},r.tree_isPreceding=function(w,b){var M=y(w),I=y(b);return M!==-1&&I!==-1&&T(w)===T(b)&&I<M},r.tree_isFollowing=function(w,b){var M=y(w),I=y(b);return M!==-1&&I!==-1&&T(w)===T(b)&&I>M},r.tree_isParentOf=function(w,b){return w._parent===b},r.tree_isChildOf=function(w,b){return b._parent===w},r.tree_previousSibling=function(w){return w._previousSibling},r.tree_nextSibling=function(w){return w._nextSibling},r.tree_firstChild=function(w){return w._firstChild},r.tree_lastChild=function(w){return w._lastChild},r.tree_treePosition=y,r.tree_index=function(w){for(var b=0;w._previousSibling!==null;)b++,w=w._previousSibling;return b},r.tree_retarget=function(w,b){for(;;){if(!w||!o.Guard.isNode(w))return w;var M=T(w);if(!o.Guard.isShadowRoot(M)||b&&o.Guard.isNode(b)&&_(M,b,!0,!0))return w;w=M.host}}},function(n,r,i){var a=i(13);n.exports=function(o){if(!a(o))throw TypeError(String(o)+" is not an object");return o}},function(n,r,i){var a=i(24),o=i(130),s=i(49),l=i(43),c=i(88),d=l.set,f=l.getterFor("Array Iterator");n.exports=c(Array,"Array",function(h,p){d(this,{type:"Array Iterator",target:a(h),index:0,kind:p})},function(){var h=f(this),p=h.target,C=h.kind,x=h.index++;return!p||x>=p.length?(h.target=void 0,{value:void 0,done:!0}):C=="keys"?{value:x,done:!1}:C=="values"?{value:p[x],done:!1}:{value:[x,p[x]],done:!1}},"values"),s.Arguments=s.Array,o("keys"),o("values"),o("entries")},function(n,r,i){var a=i(90),o=i(25),s=i(202);a||o(Object.prototype,"toString",s,{unsafe:!0})},function(n,r,i){var a=i(16),o=i(15),s=i(40);n.exports=a?function(l,c,d){return o.f(l,c,s(1,d))}:function(l,c,d){return l[c]=d,l}},function(n,r,i){var a=i(137).charAt,o=i(43),s=i(88),l=o.set,c=o.getterFor("String Iterator");s(String,"String",function(d){l(this,{type:"String Iterator",string:String(d),index:0})},function(){var d,f=c(this),h=f.string,p=f.index;return p>=h.length?{value:void 0,done:!0}:(d=a(h,p),f.index+=d.length,{value:d,done:!1})})},function(n,r,i){var a=i(11),o=i(203),s=i(19),l=i(21),c=i(5),d=c("iterator"),f=c("toStringTag"),h=s.values;for(var p in o){var C=a[p],x=C&&C.prototype;if(x){if(x[d]!==h)try{l(x,d,h)}catch{x[d]=h}if(x[f]||l(x,f,p),o[p]){for(var T in s)if(x[T]!==s[T])try{l(x,T,s[T])}catch{x[T]=s[T]}}}}},function(n,r,i){var a=i(41),o=i(35);n.exports=function(s){return a(o(s))}},function(n,r,i){var a=i(11),o=i(21),s=i(14),l=i(80),c=i(117),d=i(43),f=d.get,h=d.enforce,p=String(String).split("String");(n.exports=function(C,x,T,_){var y=!!_&&!!_.unsafe,w=!!_&&!!_.enumerable,b=!!_&&!!_.noTargetGet;typeof T=="function"&&(typeof x!="string"||s(T,"name")||o(T,"name",x),h(T).source=p.join(typeof x=="string"?x:"")),C!==a?(y?!b&&C[x]&&(w=!0):delete C[x],w?C[x]=T:o(C,x,T)):w?C[x]=T:l(x,T)})(Function.prototype,"toString",function(){return typeof this=="function"&&f(this).source||c(this)})},function(n,r,i){var a=i(47),o=Math.min;n.exports=function(s){return s>0?o(a(s),9007199254740991):0}},function(n,r,i){var a=i(35);n.exports=function(o){return Object(a(o))}},function(n,r,i){var a=i(16),o=i(8),s=i(14),l=Object.defineProperty,c={},d=function(f){throw f};n.exports=function(f,h){if(s(c,f))return c[f];h||(h={});var p=[][f],C=!!s(h,"ACCESSORS")&&h.ACCESSORS,x=s(h,0)?h[0]:d,T=s(h,1)?h[1]:void 0;return c[f]=!!p&&!o(function(){if(C&&!a)return!0;var _={length:-1};C?l(_,1,{enumerable:!0,get:d}):_[1]=1,p.call(_,x,T)})}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(148),o=i(149),s=i(151),l=i(98),c=i(153),d=i(154),f=i(155),h=i(99),p=i(100),C=i(156),x=i(157),T=i(101),_=i(158),y=i(159),w=i(160),b=i(161),M=i(162),I=i(163),A=i(164),k=i(165),U=i(166),B=i(167),z=i(168),K=i(169),J=i(170);r.create_domImplementation=function(X){return a.DOMImplementationImpl._create(X)},r.create_window=function(){return o.WindowImpl._create()},r.create_xmlDocument=function(){return new s.XMLDocumentImpl},r.create_document=function(){return new l.DocumentImpl},r.create_abortController=function(){return new c.AbortControllerImpl},r.create_abortSignal=function(){return d.AbortSignalImpl._create()},r.create_documentType=function(X,re,fe,pe){return f.DocumentTypeImpl._create(X,re,fe,pe)},r.create_element=function(X,re,fe,pe){return h.ElementImpl._create(X,re,fe,pe)},r.create_htmlElement=function(X,re,fe,pe){return h.ElementImpl._create(X,re,fe,pe)},r.create_htmlUnknownElement=function(X,re,fe,pe){return h.ElementImpl._create(X,re,fe,pe)},r.create_documentFragment=function(X){return p.DocumentFragmentImpl._create(X)},r.create_shadowRoot=function(X,re){return C.ShadowRootImpl._create(X,re)},r.create_attr=function(X,re){return x.AttrImpl._create(X,re)},r.create_text=function(X,re){return T.TextImpl._create(X,re)},r.create_cdataSection=function(X,re){return _.CDATASectionImpl._create(X,re)},r.create_comment=function(X,re){return y.CommentImpl._create(X,re)},r.create_processingInstruction=function(X,re,fe){return w.ProcessingInstructionImpl._create(X,re,fe)},r.create_htmlCollection=function(X,re){return re===void 0&&(re=function(){return!0}),b.HTMLCollectionImpl._create(X,re)},r.create_nodeList=function(X){return M.NodeListImpl._create(X)},r.create_nodeListStatic=function(X,re){return I.NodeListStaticImpl._create(X,re)},r.create_namedNodeMap=function(X){return A.NamedNodeMapImpl._create(X)},r.create_range=function(X,re){return k.RangeImpl._create(X,re)},r.create_nodeIterator=function(X,re,fe){return U.NodeIteratorImpl._create(X,re,fe)},r.create_treeWalker=function(X,re){return B.TreeWalkerImpl._create(X,re)},r.create_nodeFilter=function(){return z.NodeFilterImpl._create()},r.create_mutationRecord=function(X,re,fe,pe,ie,te,ee,we,Ce){return K.MutationRecordImpl._create(X,re,fe,pe,ie,te,ee,we,Ce)},r.create_domTokenList=function(X,re){return J.DOMTokenListImpl._create(X,re)}},function(n,r,i){var a=this&&this.__values||function(x){var T=typeof Symbol=="function"&&Symbol.iterator,_=T&&x[T],y=0;if(_)return _.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&y>=x.length&&(x=void 0),{value:x&&x[y++],done:!x}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(17),l=i(3),c=i(72),d=new Map;function f(x,T){if(T!==x._root&&s.tree_isAncestorOf(x._reference,T,!0)){if(x._pointerBeforeReference)for(;;){var _=s.tree_getFollowingNode(x._root,T);if(_!==null&&s.tree_isDescendantOf(x._root,_,!0)&&!s.tree_isDescendantOf(T,_,!0))return void(x._reference=_);if(_===null)return void(x._pointerBeforeReference=!1)}if(T._previousSibling===null)T._parent!==null&&(x._reference=T._parent);else{for(var y=T._previousSibling,w=s.tree_getFirstDescendantNode(T._previousSibling,!0,!1);w!==null;)w!==null&&(y=w),w=s.tree_getNextDescendantNode(T._previousSibling,w,!0,!1);x._reference=y}}}function h(x,T,_,y,w){if(l.Guard.isSlot(x)&&T==="name"&&w===null){if(y===_||y===null&&_===""||y===""&&_===null)return;x._name=y===null||y===""?"":y,c.shadowTree_assignSlotablesForATree(s.tree_rootNode(x))}}function p(x,T,_,y,w){if(l.Guard.isSlotable(x)&&T==="slot"&&w===null){if(y===_||y===null&&_===""||y===""&&_===null)return;x._name=y===null||y===""?"":y,c.shadowTree_isAssigned(x)&&c.shadowTree_assignSlotables(x._assignedSlot),c.shadowTree_assignASlot(x)}}function C(x,T,_,y){T==="id"&&y===null&&(x._uniqueIdentifier=_||void 0)}r.dom_runRemovingSteps=function(x,T){},r.dom_runCloningSteps=function(x,T,_,y){},r.dom_runAdoptingSteps=function(x,T){},r.dom_runAttributeChangeSteps=function(x,T,_,y,w){var b,M;o.dom.features.slots&&(p.call(x,x,T,_,y,w),h.call(x,x,T,_,y,w)),C.call(x,x,T,y,w);try{for(var I=a(x._attributeChangeSteps),A=I.next();!A.done;A=I.next())A.value.call(x,x,T,_,y,w)}catch(k){b={error:k}}finally{try{A&&!A.done&&(M=I.return)&&M.call(I)}finally{if(b)throw b.error}}},r.dom_runInsertionSteps=function(x){},r.dom_runNodeIteratorPreRemovingSteps=function(x,T){f.call(x,x,T)},r.dom_hasSupportedTokens=function(x){return d.has(x)},r.dom_getSupportedTokens=function(x){return d.get(x)||new Set},r.dom_runEventConstructingSteps=function(x){},r.dom_runChildTextContentChangeSteps=function(x){}},function(n,r,i){var a=i(4),o=i(11),s=i(46),l=i(44),c=i(16),d=i(86),f=i(124),h=i(8),p=i(14),C=i(59),x=i(13),T=i(18),_=i(27),y=i(24),w=i(56),b=i(40),M=i(60),I=i(61),A=i(82),k=i(190),U=i(85),B=i(55),z=i(15),K=i(79),J=i(21),X=i(25),re=i(81),fe=i(57),pe=i(45),ie=i(58),te=i(5),ee=i(125),we=i(126),Ce=i(62),De=i(43),Re=i(36).forEach,Oe=fe("hidden"),Ve=te("toPrimitive"),Ge=De.set,qe=De.getterFor("Symbol"),Be=Object.prototype,ae=o.Symbol,H=s("JSON","stringify"),ce=B.f,se=z.f,he=k.f,ve=K.f,ye=re("symbols"),Ae=re("op-symbols"),Ue=re("string-to-symbol-registry"),Je=re("symbol-to-string-registry"),et=re("wks"),lt=o.QObject,_t=!lt||!lt.prototype||!lt.prototype.findChild,nn=c&&h(function(){return M(se({},"a",{get:function(){return se(this,"a",{value:7}).a}})).a!=7})?function(Qe,ze,je){var rt=ce(Be,ze);rt&&delete Be[ze],se(Qe,ze,je),rt&&Qe!==Be&&se(Be,ze,rt)}:se,Ot=function(Qe,ze){var je=ye[Qe]=M(ae.prototype);return Ge(je,{type:"Symbol",tag:Qe,description:ze}),c||(je.description=ze),je},ft=f?function(Qe){return typeof Qe=="symbol"}:function(Qe){return Object(Qe)instanceof ae},_n=function(Qe,ze,je){Qe===Be&&_n(Ae,ze,je),T(Qe);var rt=w(ze,!0);return T(je),p(ye,rt)?(je.enumerable?(p(Qe,Oe)&&Qe[Oe][rt]&&(Qe[Oe][rt]=!1),je=M(je,{enumerable:b(0,!1)})):(p(Qe,Oe)||se(Qe,Oe,b(1,{})),Qe[Oe][rt]=!0),nn(Qe,rt,je)):se(Qe,rt,je)},Se=function(Qe,ze){T(Qe);var je=y(ze),rt=I(je).concat(Fe(je));return Re(rt,function(dt){c&&!Gt.call(je,dt)||_n(Qe,dt,je[dt])}),Qe},Gt=function(Qe){var ze=w(Qe,!0),je=ve.call(this,ze);return!(this===Be&&p(ye,ze)&&!p(Ae,ze))&&(!(je||!p(this,ze)||!p(ye,ze)||p(this,Oe)&&this[Oe][ze])||je)},Vt=function(Qe,ze){var je=y(Qe),rt=w(ze,!0);if(je!==Be||!p(ye,rt)||p(Ae,rt)){var dt=ce(je,rt);return!dt||!p(ye,rt)||p(je,Oe)&&je[Oe][rt]||(dt.enumerable=!0),dt}},wt=function(Qe){var ze=he(y(Qe)),je=[];return Re(ze,function(rt){p(ye,rt)||p(pe,rt)||je.push(rt)}),je},Fe=function(Qe){var ze=Qe===Be,je=he(ze?Ae:y(Qe)),rt=[];return Re(je,function(dt){!p(ye,dt)||ze&&!p(Be,dt)||rt.push(ye[dt])}),rt};d||(X((ae=function(){if(this instanceof ae)throw TypeError("Symbol is not a constructor");var Qe=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,ze=ie(Qe),je=function(rt){this===Be&&je.call(Ae,rt),p(this,Oe)&&p(this[Oe],ze)&&(this[Oe][ze]=!1),nn(this,ze,b(1,rt))};return c&&_t&&nn(Be,ze,{configurable:!0,set:je}),Ot(ze,Qe)}).prototype,"toString",function(){return qe(this).tag}),X(ae,"withoutSetter",function(Qe){return Ot(ie(Qe),Qe)}),K.f=Gt,z.f=_n,B.f=Vt,A.f=k.f=wt,U.f=Fe,ee.f=function(Qe){return Ot(te(Qe),Qe)},c&&(se(ae.prototype,"description",{configurable:!0,get:function(){return qe(this).description}}),l||X(Be,"propertyIsEnumerable",Gt,{unsafe:!0}))),a({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:ae}),Re(I(et),function(Qe){we(Qe)}),a({target:"Symbol",stat:!0,forced:!d},{for:function(Qe){var ze=String(Qe);if(p(Ue,ze))return Ue[ze];var je=ae(ze);return Ue[ze]=je,Je[je]=ze,je},keyFor:function(Qe){if(!ft(Qe))throw TypeError(Qe+" is not a symbol");if(p(Je,Qe))return Je[Qe]},useSetter:function(){_t=!0},useSimple:function(){_t=!1}}),a({target:"Object",stat:!0,forced:!d,sham:!c},{create:function(Qe,ze){return ze===void 0?M(Qe):Se(M(Qe),ze)},defineProperty:_n,defineProperties:Se,getOwnPropertyDescriptor:Vt}),a({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:wt,getOwnPropertySymbols:Fe}),a({target:"Object",stat:!0,forced:h(function(){U.f(1)})},{getOwnPropertySymbols:function(Qe){return U.f(_(Qe))}}),H&&a({target:"JSON",stat:!0,forced:!d||h(function(){var Qe=ae();return H([Qe])!="[null]"||H({a:Qe})!="{}"||H(Object(Qe))!="{}"})},{stringify:function(Qe,ze,je){for(var rt,dt=[Qe],ht=1;arguments.length>ht;)dt.push(arguments[ht++]);if(rt=ze,(x(ze)||Qe!==void 0)&&!ft(Qe))return C(ze)||(ze=function(mt,At){if(typeof rt=="function"&&(At=rt.call(this,mt,At)),!ft(At))return At}),dt[1]=ze,H.apply(null,dt)}}),ae.prototype[Ve]||J(ae.prototype,Ve,ae.prototype.valueOf),Ce(ae,"Symbol"),pe[Oe]=!0},function(n,r,i){var a=i(4),o=i(16),s=i(11),l=i(14),c=i(13),d=i(15).f,f=i(119),h=s.Symbol;if(o&&typeof h=="function"&&(!("description"in h.prototype)||h().description!==void 0)){var p={},C=function(){var w=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),b=this instanceof C?new h(w):w===void 0?h():h(w);return w===""&&(p[b]=!0),b};f(C,h);var x=C.prototype=h.prototype;x.constructor=C;var T=x.toString,_=String(h("test"))=="Symbol(test)",y=/^Symbol\((.*)\)[^)]+$/;d(x,"description",{configurable:!0,get:function(){var w=c(this)?this.valueOf():this,b=T.call(w);if(l(p,w))return"";var M=_?b.slice(7,-1):b.replace(y,"$1");return M===""?void 0:M}}),a({global:!0,forced:!0},{Symbol:C})}},function(n,r,i){i(126)("iterator")},function(n,r,i){var a,o=this&&this.__extends||(a=function(_,y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,b){w.__proto__=b}||function(w,b){for(var M in b)b.hasOwnProperty(M)&&(w[M]=b[M])})(_,y)},function(_,y){function w(){this.constructor=_}a(_,y),_.prototype=y===null?Object.create(y):(w.prototype=y.prototype,new w)}),s=this&&this.__values||function(_){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&_[y],b=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&b>=_.length&&(_=void 0),{value:_&&_[b++],done:!_}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=i(2),d=i(70),f=i(3),h=i(9),p=i(0),C=i(152),x=i(12),T=function(_){function y(){var w=_.call(this)||this;return w._parent=null,w._firstChild=null,w._lastChild=null,w._previousSibling=null,w._nextSibling=null,w}return o(y,_),Object.defineProperty(y.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=p.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||l.dom.window._associatedDocument},set:function(w){this._nodeDocumentOverride=w},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"nodeName",{get:function(){return f.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:f.Guard.isAttrNode(this)?this._qualifiedName:f.Guard.isExclusiveTextNode(this)?"#text":f.Guard.isCDATASectionNode(this)?"#cdata-section":f.Guard.isProcessingInstructionNode(this)?this._target:f.Guard.isCommentNode(this)?"#comment":f.Guard.isDocumentNode(this)?"#document":f.Guard.isDocumentTypeNode(this)?this._name:f.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"baseURI",{get:function(){return C.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"isConnected",{get:function(){return f.Guard.isElementNode(this)&&p.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"ownerDocument",{get:function(){return this._nodeType===c.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),y.prototype.getRootNode=function(w){return p.tree_rootNode(this,!!w&&w.composed)},Object.defineProperty(y.prototype,"parentNode",{get:function(){return this._nodeType===c.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"parentElement",{get:function(){return this._parent&&f.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),y.prototype.hasChildNodes=function(){return this._firstChild!==null},Object.defineProperty(y.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"nodeValue",{get:function(){return f.Guard.isAttrNode(this)?this._value:f.Guard.isCharacterDataNode(this)?this._data:null},set:function(w){w===null&&(w=""),f.Guard.isAttrNode(this)?p.attr_setAnExistingAttributeValue(this,w):f.Guard.isCharacterDataNode(this)&&p.characterData_replaceData(this,0,this._data.length,w)},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"textContent",{get:function(){return f.Guard.isDocumentFragmentNode(this)||f.Guard.isElementNode(this)?p.text_descendantTextContent(this):f.Guard.isAttrNode(this)?this._value:f.Guard.isCharacterDataNode(this)?this._data:null},set:function(w){w===null&&(w=""),f.Guard.isDocumentFragmentNode(this)||f.Guard.isElementNode(this)?p.node_stringReplaceAll(w,this):f.Guard.isAttrNode(this)?p.attr_setAnExistingAttributeValue(this,w):f.Guard.isCharacterDataNode(this)&&p.characterData_replaceData(this,0,p.tree_nodeLength(this),w)},enumerable:!0,configurable:!0}),y.prototype.normalize=function(){for(var w,b,M,I,A=[],k=p.tree_getFirstDescendantNode(this,!1,!1,function(Re){return f.Guard.isExclusiveTextNode(Re)});k!==null;)A.push(k),k=p.tree_getNextDescendantNode(this,k,!1,!1,function(Re){return f.Guard.isExclusiveTextNode(Re)});for(var U=0;U<A.length;U++){var B=A[U];if(B._parent!==null){var z=p.tree_nodeLength(B);if(z!==0){var K=[],J="";try{for(var X=(w=void 0,s(p.text_contiguousExclusiveTextNodes(B))),re=X.next();!re.done;re=X.next()){var fe=re.value;K.push(fe),J+=fe._data}}catch(Re){w={error:Re}}finally{try{re&&!re.done&&(b=X.return)&&b.call(X)}finally{if(w)throw w.error}}if(p.characterData_replaceData(B,z,0,J),l.dom.rangeList.size!==0)for(var pe=B._nextSibling;pe!==null&&f.Guard.isExclusiveTextNode(pe);){var ie=pe,te=p.tree_index(ie);try{for(var ee=(M=void 0,s(l.dom.rangeList)),we=ee.next();!we.done;we=ee.next()){var Ce=we.value;Ce._start[0]===ie&&(Ce._start[0]=B,Ce._start[1]+=z),Ce._end[0]===ie&&(Ce._end[0]=B,Ce._end[1]+=z),Ce._start[0]===ie._parent&&Ce._start[1]===te&&(Ce._start[0]=B,Ce._start[1]=z),Ce._end[0]===ie._parent&&Ce._end[1]===te&&(Ce._end[0]=B,Ce._end[1]=z)}}catch(Re){M={error:Re}}finally{try{we&&!we.done&&(I=ee.return)&&I.call(ee)}finally{if(M)throw M.error}}z+=p.tree_nodeLength(pe),pe=pe._nextSibling}for(var De=0;De<K.length;De++)(fe=K[De])._parent!==null&&p.mutation_remove(fe,fe._parent)}else p.mutation_remove(B,B._parent)}}},y.prototype.cloneNode=function(w){if(w===void 0&&(w=!1),f.Guard.isShadowRoot(this))throw new h.NotSupportedError;return p.node_clone(this,null,w)},y.prototype.isEqualNode=function(w){return w===void 0&&(w=null),w!==null&&p.node_equals(this,w)},y.prototype.isSameNode=function(w){return w===void 0&&(w=null),this===w},y.prototype.compareDocumentPosition=function(w){if(w===this)return 0;var b=w,M=this,I=null,A=null;if(f.Guard.isAttrNode(b)&&(b=(I=b)._element),f.Guard.isAttrNode(M)&&(M=(A=M)._element,I&&b&&b===M))for(var k=0;k<M._attributeList.length;k++){var U=M._attributeList[k];if(p.node_equals(U,I))return c.Position.ImplementationSpecific|c.Position.Preceding;if(p.node_equals(U,A))return c.Position.ImplementationSpecific|c.Position.Following}return b===null||M===null||p.tree_rootNode(b)!==p.tree_rootNode(M)?c.Position.Disconnected|c.Position.ImplementationSpecific|(l.dom.compareCache.check(this,w)?c.Position.Preceding:c.Position.Following):!I&&p.tree_isAncestorOf(M,b)||A&&b===M?c.Position.Contains|c.Position.Preceding:!A&&p.tree_isDescendantOf(M,b)||I&&b===M?c.Position.ContainedBy|c.Position.Following:p.tree_isPreceding(M,b)?c.Position.Preceding:c.Position.Following},y.prototype.contains=function(w){return w!==null&&p.tree_isDescendantOf(this,w,!0)},y.prototype.lookupPrefix=function(w){return w?f.Guard.isElementNode(this)?p.node_locateANamespacePrefix(this,w):f.Guard.isDocumentNode(this)?this.documentElement===null?null:p.node_locateANamespacePrefix(this.documentElement,w):f.Guard.isDocumentTypeNode(this)||f.Guard.isDocumentFragmentNode(this)?null:f.Guard.isAttrNode(this)?this._element===null?null:p.node_locateANamespacePrefix(this._element,w):this._parent!==null&&f.Guard.isElementNode(this._parent)?p.node_locateANamespacePrefix(this._parent,w):null:null},y.prototype.lookupNamespaceURI=function(w){return p.node_locateANamespace(this,w||null)},y.prototype.isDefaultNamespace=function(w){return w||(w=null),p.node_locateANamespace(this,null)===w},y.prototype.insertBefore=function(w,b){return p.mutation_preInsert(w,this,b)},y.prototype.appendChild=function(w){return p.mutation_append(w,this)},y.prototype.replaceChild=function(w,b){return p.mutation_replace(b,w,this)},y.prototype.removeChild=function(w){return p.mutation_preRemove(w,this)},y.prototype._getTheParent=function(w){return f.Guard.isSlotable(this)&&p.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},y.ELEMENT_NODE=1,y.ATTRIBUTE_NODE=2,y.TEXT_NODE=3,y.CDATA_SECTION_NODE=4,y.ENTITY_REFERENCE_NODE=5,y.ENTITY_NODE=6,y.PROCESSING_INSTRUCTION_NODE=7,y.COMMENT_NODE=8,y.DOCUMENT_NODE=9,y.DOCUMENT_TYPE_NODE=10,y.DOCUMENT_FRAGMENT_NODE=11,y.NOTATION_NODE=12,y.DOCUMENT_POSITION_DISCONNECTED=1,y.DOCUMENT_POSITION_PRECEDING=2,y.DOCUMENT_POSITION_FOLLOWING=4,y.DOCUMENT_POSITION_CONTAINS=8,y.DOCUMENT_POSITION_CONTAINED_BY=16,y.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,y}(d.EventTargetImpl);r.NodeImpl=T,T.prototype._children=new f.EmptySet,x.idl_defineConst(T.prototype,"ELEMENT_NODE",1),x.idl_defineConst(T.prototype,"ATTRIBUTE_NODE",2),x.idl_defineConst(T.prototype,"TEXT_NODE",3),x.idl_defineConst(T.prototype,"CDATA_SECTION_NODE",4),x.idl_defineConst(T.prototype,"ENTITY_REFERENCE_NODE",5),x.idl_defineConst(T.prototype,"ENTITY_NODE",6),x.idl_defineConst(T.prototype,"PROCESSING_INSTRUCTION_NODE",7),x.idl_defineConst(T.prototype,"COMMENT_NODE",8),x.idl_defineConst(T.prototype,"DOCUMENT_NODE",9),x.idl_defineConst(T.prototype,"DOCUMENT_TYPE_NODE",10),x.idl_defineConst(T.prototype,"DOCUMENT_FRAGMENT_NODE",11),x.idl_defineConst(T.prototype,"NOTATION_NODE",12),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_PRECEDING",2),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_FOLLOWING",4),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_CONTAINS",8),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),x.idl_defineConst(T.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(n,r){n.exports=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i}},function(n,r,i){var a=i(87),o=i(41),s=i(27),l=i(26),c=i(128),d=[].push,f=function(h){var p=h==1,C=h==2,x=h==3,T=h==4,_=h==6,y=h==5||_;return function(w,b,M,I){for(var A,k,U=s(w),B=o(U),z=a(b,M,3),K=l(B.length),J=0,X=I||c,re=p?X(w,K):C?X(w,0):void 0;K>J;J++)if((y||J in B)&&(k=z(A=B[J],J,U),h)){if(p)re[J]=k;else if(k)switch(h){case 3:return!0;case 5:return A;case 6:return J;case 2:d.call(re,A)}else if(T)return!1}return _?-1:x||T?T:re}};n.exports={forEach:f(0),map:f(1),filter:f(2),some:f(3),every:f(4),find:f(5),findIndex:f(6)}},function(n,r,i){var a=this&&this.__values||function(U){var B=typeof Symbol=="function"&&Symbol.iterator,z=B&&U[B],K=0;if(z)return z.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&K>=U.length&&(U=void 0),{value:U&&U[K++],done:!U}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(U,B){var z=typeof Symbol=="function"&&U[Symbol.iterator];if(!z)return U;var K,J,X=z.call(U),re=[];try{for(;(B===void 0||B-- >0)&&!(K=X.next()).done;)re.push(K.value)}catch(fe){J={error:fe}}finally{try{K&&!K.done&&(z=X.return)&&z.call(X)}finally{if(J)throw J.error}}return re},s=this&&this.__spread||function(){for(var U=[],B=0;B<arguments.length;B++)U=U.concat(o(arguments[B]));return U};Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=i(9),d=i(2),f=i(3),h=i(1),p=i(7),C=i(73),x=i(17),T=i(172),_=i(72),y=i(51),w=i(30),b=i(106);function M(U,B,z){var K,J,X,re,fe,pe,ie,te,ee=B._nodeType,we=U._nodeType,Ce=z?z._nodeType:null;if(ee!==d.NodeType.Document&&ee!==d.NodeType.DocumentFragment&&ee!==d.NodeType.Element)throw new c.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+B.nodeName+".");if(x.tree_isHostIncludingAncestorOf(B,U,!0))throw new c.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+U.nodeName+", parent node is "+B.nodeName+".");if(z!==null&&z._parent!==B)throw new c.NotFoundError("The reference child node cannot be found under parent node. Child node is "+z.nodeName+", parent node is "+B.nodeName+".");if(we!==d.NodeType.DocumentFragment&&we!==d.NodeType.DocumentType&&we!==d.NodeType.Element&&we!==d.NodeType.Text&&we!==d.NodeType.ProcessingInstruction&&we!==d.NodeType.CData&&we!==d.NodeType.Comment)throw new c.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+U.nodeName+".");if(we===d.NodeType.Text&&ee===d.NodeType.Document)throw new c.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+U.nodeName+".");if(we===d.NodeType.DocumentType&&ee!==d.NodeType.Document)throw new c.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+B.nodeName+".");if(ee===d.NodeType.Document){if(we===d.NodeType.DocumentFragment){var De=0;try{for(var Re=a(U._children),Oe=Re.next();!Oe.done;Oe=Re.next()){var Ve=Oe.value;if(Ve._nodeType===d.NodeType.Element)De++;else if(Ve._nodeType===d.NodeType.Text)throw new c.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+Ve.nodeName+".")}}catch(ve){K={error:ve}}finally{try{Oe&&!Oe.done&&(J=Re.return)&&J.call(Re)}finally{if(K)throw K.error}}if(De>1)throw new c.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+De+" element nodes.");if(De===1){try{for(var Ge=a(B._children),qe=Ge.next();!qe.done;qe=Ge.next())if(qe.value._nodeType===d.NodeType.Element)throw new c.HierarchyRequestError("The document node already has a document element node.")}catch(ve){X={error:ve}}finally{try{qe&&!qe.done&&(re=Ge.return)&&re.call(Ge)}finally{if(X)throw X.error}}if(z){if(Ce===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var Be=z._nextSibling;Be;){if(Be._nodeType===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node.");Be=Be._nextSibling}}}}else if(we===d.NodeType.Element){try{for(var ae=a(B._children),H=ae.next();!H.done;H=ae.next())if(H.value._nodeType===d.NodeType.Element)throw new c.HierarchyRequestError("Document already has a document element node. Node is "+U.nodeName+".")}catch(ve){fe={error:ve}}finally{try{H&&!H.done&&(pe=ae.return)&&pe.call(ae)}finally{if(fe)throw fe.error}}if(z){if(Ce===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+U.nodeName+".");for(Be=z._nextSibling;Be;){if(Be._nodeType===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+U.nodeName+".");Be=Be._nextSibling}}}else if(we===d.NodeType.DocumentType){try{for(var ce=a(B._children),se=ce.next();!se.done;se=ce.next())if(se.value._nodeType===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Document already has a document type node. Node is "+U.nodeName+".")}catch(ve){ie={error:ve}}finally{try{se&&!se.done&&(te=ce.return)&&te.call(ce)}finally{if(ie)throw ie.error}}if(z)for(var he=z._previousSibling;he;){if(he._nodeType===d.NodeType.Element)throw new c.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+U.nodeName+".");he=he._previousSibling}else for(he=B._firstChild;he;){if(he._nodeType===d.NodeType.Element)throw new c.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+U.nodeName+".");he=he._nextSibling}}}}function I(U,B,z){M(U,B,z);var K=z;return K===U&&(K=U._nextSibling),b.document_adopt(U,B._nodeDocument),A(U,B,K),U}function A(U,B,z,K){var J,X;if(z!==null||U._nodeType===d.NodeType.DocumentFragment){var re=U._nodeType===d.NodeType.DocumentFragment?U._children.size:1;if(z!==null&&l.dom.rangeList.size!==0){var fe=x.tree_index(z);try{for(var pe=a(l.dom.rangeList),ie=pe.next();!ie.done;ie=pe.next()){var te=ie.value;te._start[0]===B&&te._start[1]>fe&&(te._start[1]+=re),te._end[0]===B&&te._end[1]>fe&&(te._end[1]+=re)}}catch(qe){J={error:qe}}finally{try{ie&&!ie.done&&(X=pe.return)&&X.call(pe)}finally{if(J)throw J.error}}}var ee=U._nodeType===d.NodeType.DocumentFragment?new(Array.bind.apply(Array,s([void 0],U._children))):[U];if(U._nodeType===d.NodeType.DocumentFragment)for(;U._firstChild;)k(U._firstChild,U,!0);l.dom.features.mutationObservers&&U._nodeType===d.NodeType.DocumentFragment&&y.observer_queueTreeMutationRecord(U,[],ee,null,null);for(var we=z?z._previousSibling:B._lastChild,Ce=z===null?-1:x.tree_index(z),De=0;De<ee.length;De++){var Re=ee[De];if(f.Guard.isElementNode(Re)&&(f.Guard.isDocumentNode(B)&&(B._documentElement=Re),Re._nodeDocument._hasNamespaces||Re._namespace===null&&Re._namespacePrefix===null||(Re._nodeDocument._hasNamespaces=!0)),Re._parent=B,z===null?p.set.append(B._children,Re):(p.set.insert(B._children,Re,Ce),Ce++),B._firstChild===null)Re._previousSibling=null,Re._nextSibling=null,B._firstChild=Re,B._lastChild=Re;else{var Oe=z?z._previousSibling:B._lastChild,Ve=z||null;Re._previousSibling=Oe,Re._nextSibling=Ve,Oe&&(Oe._nextSibling=Re),Ve&&(Ve._previousSibling=Re),Oe||(B._firstChild=Re),Ve||(B._lastChild=Re)}l.dom.features.slots&&B._shadowRoot!==null&&f.Guard.isSlotable(Re)&&_.shadowTree_assignASlot(Re),l.dom.features.steps&&f.Guard.isTextNode(Re)&&w.dom_runChildTextContentChangeSteps(B),l.dom.features.slots&&f.Guard.isShadowRoot(x.tree_rootNode(B))&&f.Guard.isSlot(B)&&h.isEmpty(B._assignedNodes)&&_.shadowTree_signalASlotChange(B),l.dom.features.slots&&_.shadowTree_assignSlotablesForATree(x.tree_rootNode(Re));for(var Ge=x.tree_getFirstDescendantNode(Re,!0,!0);Ge!==null;)l.dom.features.steps&&w.dom_runInsertionSteps(Ge),l.dom.features.customElements&&f.Guard.isElementNode(Ge)&&_.shadowTree_isConnected(Ge)&&(f.Guard.isCustomElementNode(Ge)?C.customElement_enqueueACustomElementCallbackReaction(Ge,"connectedCallback",[]):C.customElement_tryToUpgrade(Ge)),Ge=x.tree_getNextDescendantNode(Re,Ge,!0,!0)}l.dom.features.mutationObservers&&(K||y.observer_queueTreeMutationRecord(B,ee,[],we,z))}else(function(qe,Be,ae){var H=Be._lastChild;if(f.Guard.isElementNode(qe)&&(f.Guard.isDocumentNode(Be)&&(Be._documentElement=qe),qe._nodeDocument._hasNamespaces||qe._namespace===null&&qe._namespacePrefix===null||(qe._nodeDocument._hasNamespaces=!0)),qe._parent=Be,Be._children.add(qe),Be._firstChild===null)qe._previousSibling=null,qe._nextSibling=null,Be._firstChild=qe,Be._lastChild=qe;else{var ce=Be._lastChild;qe._previousSibling=ce,qe._nextSibling=null,ce&&(ce._nextSibling=qe),ce||(Be._firstChild=qe),Be._lastChild=qe}l.dom.features.slots&&Be._shadowRoot!==null&&f.Guard.isSlotable(qe)&&_.shadowTree_assignASlot(qe),l.dom.features.steps&&f.Guard.isTextNode(qe)&&w.dom_runChildTextContentChangeSteps(Be),l.dom.features.slots&&f.Guard.isShadowRoot(x.tree_rootNode(Be))&&f.Guard.isSlot(Be)&&h.isEmpty(Be._assignedNodes)&&_.shadowTree_signalASlotChange(Be),l.dom.features.slots&&_.shadowTree_assignSlotablesForATree(x.tree_rootNode(qe)),l.dom.features.steps&&w.dom_runInsertionSteps(qe),l.dom.features.customElements&&f.Guard.isElementNode(qe)&&_.shadowTree_isConnected(qe)&&(f.Guard.isCustomElementNode(qe)?C.customElement_enqueueACustomElementCallbackReaction(qe,"connectedCallback",[]):C.customElement_tryToUpgrade(qe)),l.dom.features.mutationObservers&&(ae||y.observer_queueTreeMutationRecord(Be,[qe],[],H,null))})(U,B,K)}function k(U,B,z){var K,J,X,re,fe,pe,ie,te;if(l.dom.rangeList.size!==0){var ee=x.tree_index(U);try{for(var we=a(l.dom.rangeList),Ce=we.next();!Ce.done;Ce=we.next()){var De=Ce.value;x.tree_isDescendantOf(U,De._start[0],!0)&&(De._start=[B,ee]),x.tree_isDescendantOf(U,De._end[0],!0)&&(De._end=[B,ee]),De._start[0]===B&&De._start[1]>ee&&De._start[1]--,De._end[0]===B&&De._end[1]>ee&&De._end[1]--}}catch(Ue){K={error:Ue}}finally{try{Ce&&!Ce.done&&(J=we.return)&&J.call(we)}finally{if(K)throw K.error}}try{for(var Re=a(l.dom.rangeList),Oe=Re.next();!Oe.done;Oe=Re.next())(De=Oe.value)._start[0]===B&&De._start[1]>ee&&(De._start[1]-=1),De._end[0]===B&&De._end[1]>ee&&(De._end[1]-=1)}catch(Ue){X={error:Ue}}finally{try{Oe&&!Oe.done&&(re=Re.return)&&re.call(Re)}finally{if(X)throw X.error}}}if(l.dom.features.steps)try{for(var Ve=a(T.nodeIterator_iteratorList()),Ge=Ve.next();!Ge.done;Ge=Ve.next()){var qe=Ge.value;qe._root._nodeDocument===U._nodeDocument&&w.dom_runNodeIteratorPreRemovingSteps(qe,U)}}catch(Ue){fe={error:Ue}}finally{try{Ge&&!Ge.done&&(pe=Ve.return)&&pe.call(Ve)}finally{if(fe)throw fe.error}}var Be=U._previousSibling,ae=U._nextSibling;f.Guard.isDocumentNode(B)&&f.Guard.isElementNode(U)&&(B._documentElement=null),U._parent=null,B._children.delete(U);var H=U._previousSibling,ce=U._nextSibling;U._previousSibling=null,U._nextSibling=null,H&&(H._nextSibling=ce),ce&&(ce._previousSibling=H),H||(B._firstChild=ce),ce||(B._lastChild=H),l.dom.features.slots&&f.Guard.isSlotable(U)&&U._assignedSlot!==null&&_.shadowTree_isAssigned(U)&&_.shadowTree_assignSlotables(U._assignedSlot),l.dom.features.slots&&f.Guard.isShadowRoot(x.tree_rootNode(B))&&f.Guard.isSlot(B)&&h.isEmpty(B._assignedNodes)&&_.shadowTree_signalASlotChange(B),l.dom.features.slots&&x.tree_getFirstDescendantNode(U,!0,!1,function(Ue){return f.Guard.isSlot(Ue)})!==null&&(_.shadowTree_assignSlotablesForATree(x.tree_rootNode(B)),_.shadowTree_assignSlotablesForATree(U)),l.dom.features.steps&&w.dom_runRemovingSteps(U,B),l.dom.features.customElements&&f.Guard.isCustomElementNode(U)&&C.customElement_enqueueACustomElementCallbackReaction(U,"disconnectedCallback",[]);for(var se=x.tree_getFirstDescendantNode(U,!1,!0);se!==null;)l.dom.features.steps&&w.dom_runRemovingSteps(se,U),l.dom.features.customElements&&f.Guard.isCustomElementNode(se)&&C.customElement_enqueueACustomElementCallbackReaction(se,"disconnectedCallback",[]),se=x.tree_getNextDescendantNode(U,se,!1,!0);if(l.dom.features.mutationObservers)for(var he=x.tree_getFirstAncestorNode(B,!0);he!==null;){try{for(var ve=(ie=void 0,a(he._registeredObserverList)),ye=ve.next();!ye.done;ye=ve.next()){var Ae=ye.value;Ae.options.subtree&&U._registeredObserverList.push({observer:Ae.observer,options:Ae.options,source:Ae})}}catch(Ue){ie={error:Ue}}finally{try{ye&&!ye.done&&(te=ve.return)&&te.call(ve)}finally{if(ie)throw ie.error}}he=x.tree_getNextAncestorNode(B,he,!0)}l.dom.features.mutationObservers&&(z||y.observer_queueTreeMutationRecord(B,[],[U],Be,ae)),l.dom.features.steps&&f.Guard.isTextNode(U)&&w.dom_runChildTextContentChangeSteps(B)}r.mutation_ensurePreInsertionValidity=M,r.mutation_preInsert=I,r.mutation_insert=A,r.mutation_append=function(U,B){return I(U,B,null)},r.mutation_replace=function(U,B,z){var K,J,X,re,fe,pe,ie,te;if(z._nodeType!==d.NodeType.Document&&z._nodeType!==d.NodeType.DocumentFragment&&z._nodeType!==d.NodeType.Element)throw new c.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+z.nodeName+".");if(x.tree_isHostIncludingAncestorOf(z,B,!0))throw new c.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+B.nodeName+", parent node is "+z.nodeName+".");if(U._parent!==z)throw new c.NotFoundError("The reference child node cannot be found under parent node. Child node is "+U.nodeName+", parent node is "+z.nodeName+".");if(B._nodeType!==d.NodeType.DocumentFragment&&B._nodeType!==d.NodeType.DocumentType&&B._nodeType!==d.NodeType.Element&&B._nodeType!==d.NodeType.Text&&B._nodeType!==d.NodeType.ProcessingInstruction&&B._nodeType!==d.NodeType.CData&&B._nodeType!==d.NodeType.Comment)throw new c.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+B.nodeName+".");if(B._nodeType===d.NodeType.Text&&z._nodeType===d.NodeType.Document)throw new c.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+B.nodeName+".");if(B._nodeType===d.NodeType.DocumentType&&z._nodeType!==d.NodeType.Document)throw new c.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+z.nodeName+".");if(z._nodeType===d.NodeType.Document){if(B._nodeType===d.NodeType.DocumentFragment){var ee=0;try{for(var we=a(B._children),Ce=we.next();!Ce.done;Ce=we.next()){var De=Ce.value;if(De._nodeType===d.NodeType.Element)ee++;else if(De._nodeType===d.NodeType.Text)throw new c.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+De.nodeName+".")}}catch(Ae){K={error:Ae}}finally{try{Ce&&!Ce.done&&(J=we.return)&&J.call(we)}finally{if(K)throw K.error}}if(ee>1)throw new c.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+ee+" element nodes.");if(ee===1){try{for(var Re=a(z._children),Oe=Re.next();!Oe.done;Oe=Re.next())if((H=Oe.value)._nodeType===d.NodeType.Element&&H!==U)throw new c.HierarchyRequestError("The document node already has a document element node.")}catch(Ae){X={error:Ae}}finally{try{Oe&&!Oe.done&&(re=Re.return)&&re.call(Re)}finally{if(X)throw X.error}}for(var Ve=U._nextSibling;Ve;){if(Ve._nodeType===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node.");Ve=Ve._nextSibling}}}else if(B._nodeType===d.NodeType.Element){try{for(var Ge=a(z._children),qe=Ge.next();!qe.done;qe=Ge.next())if((H=qe.value)._nodeType===d.NodeType.Element&&H!==U)throw new c.HierarchyRequestError("Document already has a document element node. Node is "+B.nodeName+".")}catch(Ae){fe={error:Ae}}finally{try{qe&&!qe.done&&(pe=Ge.return)&&pe.call(Ge)}finally{if(fe)throw fe.error}}for(Ve=U._nextSibling;Ve;){if(Ve._nodeType===d.NodeType.DocumentType)throw new c.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+B.nodeName+".");Ve=Ve._nextSibling}}else if(B._nodeType===d.NodeType.DocumentType){try{for(var Be=a(z._children),ae=Be.next();!ae.done;ae=Be.next()){var H;if((H=ae.value)._nodeType===d.NodeType.DocumentType&&H!==U)throw new c.HierarchyRequestError("Document already has a document type node. Node is "+B.nodeName+".")}}catch(Ae){ie={error:Ae}}finally{try{ae&&!ae.done&&(te=Be.return)&&te.call(Be)}finally{if(ie)throw ie.error}}for(var ce=U._previousSibling;ce;){if(ce._nodeType===d.NodeType.Element)throw new c.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+B.nodeName+".");ce=ce._previousSibling}}}var se=U._nextSibling;se===B&&(se=B._nextSibling);var he=U._previousSibling;b.document_adopt(B,z._nodeDocument);var ve=[];U._parent!==null&&(ve.push(U),k(U,U._parent,!0));var ye=[];return B._nodeType===d.NodeType.DocumentFragment?ye=Array.from(B._children):ye.push(B),A(B,z,se,!0),l.dom.features.mutationObservers&&y.observer_queueTreeMutationRecord(z,ye,ve,he,se),U},r.mutation_replaceAll=function(U,B){var z,K;U!==null&&b.document_adopt(U,B._nodeDocument);var J=Array.from(B._children),X=[];U&&U._nodeType===d.NodeType.DocumentFragment?X=Array.from(U._children):U!==null&&X.push(U);try{for(var re=a(J),fe=re.next();!fe.done;fe=re.next())k(fe.value,B,!0)}catch(pe){z={error:pe}}finally{try{fe&&!fe.done&&(K=re.return)&&K.call(re)}finally{if(z)throw z.error}}U!==null&&A(U,B,null,!0),l.dom.features.mutationObservers&&y.observer_queueTreeMutationRecord(B,X,J,null,null)},r.mutation_preRemove=function(U,B){if(U._parent!==B)throw new c.NotFoundError("The child node cannot be found under parent node. Child node is "+U.nodeName+", parent node is "+B.nodeName+".");return k(U,B),U},r.mutation_remove=k},function(n,r,i){function a(o){return o==null}n.exports.isNothing=a,n.exports.isObject=function(o){return typeof o=="object"&&o!==null},n.exports.toArray=function(o){return Array.isArray(o)?o:a(o)?[]:[o]},n.exports.repeat=function(o,s){var l,c="";for(l=0;l<s;l+=1)c+=o;return c},n.exports.isNegativeZero=function(o){return o===0&&Number.NEGATIVE_INFINITY===1/o},n.exports.extend=function(o,s){var l,c,d,f;if(s)for(l=0,c=(f=Object.keys(s)).length;l<c;l+=1)o[d=f[l]]=s[d];return o}},function(n,r,i){var a=i(38),o=i(53),s=i(10);function l(d,f,h){var p=[];return d.include.forEach(function(C){h=l(C,f,h)}),d[f].forEach(function(C){h.forEach(function(x,T){x.tag===C.tag&&x.kind===C.kind&&p.push(T)}),h.push(C)}),h.filter(function(C,x){return p.indexOf(x)===-1})}function c(d){this.include=d.include||[],this.implicit=d.implicit||[],this.explicit=d.explicit||[],this.implicit.forEach(function(f){if(f.loadKind&&f.loadKind!=="scalar")throw new o("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=l(this,"implicit",[]),this.compiledExplicit=l(this,"explicit",[]),this.compiledTypeMap=function(){var f,h,p={scalar:{},sequence:{},mapping:{},fallback:{}};function C(x){p[x.kind][x.tag]=p.fallback[x.tag]=x}for(f=0,h=arguments.length;f<h;f+=1)arguments[f].forEach(C);return p}(this.compiledImplicit,this.compiledExplicit)}c.DEFAULT=null,c.create=function(){var d,f;switch(arguments.length){case 1:d=c.DEFAULT,f=arguments[0];break;case 2:d=arguments[0],f=arguments[1];break;default:throw new o("Wrong number of arguments for Schema.create function")}if(d=a.toArray(d),f=a.toArray(f),!d.every(function(h){return h instanceof c}))throw new o("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!f.every(function(h){return h instanceof s}))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new c({include:d,explicit:f})},n.exports=c},function(n,r){n.exports=function(i,a){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:a}}},function(n,r,i){var a=i(8),o=i(42),s="".split;n.exports=a(function(){return!Object("z").propertyIsEnumerable(0)})?function(l){return o(l)=="String"?s.call(l,""):Object(l)}:Object},function(n,r){var i={}.toString;n.exports=function(a){return i.call(a).slice(8,-1)}},function(n,r,i){var a,o,s,l=i(186),c=i(11),d=i(13),f=i(21),h=i(14),p=i(57),C=i(45),x=c.WeakMap;if(l){var T=new x,_=T.get,y=T.has,w=T.set;a=function(M,I){return w.call(T,M,I),I},o=function(M){return _.call(T,M)||{}},s=function(M){return y.call(T,M)}}else{var b=p("state");C[b]=!0,a=function(M,I){return f(M,b,I),I},o=function(M){return h(M,b)?M[b]:{}},s=function(M){return h(M,b)}}n.exports={set:a,get:o,has:s,enforce:function(M){return s(M)?o(M):a(M,{})},getterFor:function(M){return function(I){var A;if(!d(I)||(A=o(I)).type!==M)throw TypeError("Incompatible receiver, "+M+" required");return A}}}},function(n,r){n.exports=!1},function(n,r){n.exports={}},function(n,r,i){var a=i(120),o=i(11),s=function(l){return typeof l=="function"?l:void 0};n.exports=function(l,c){return arguments.length<2?s(a[l])||s(o[l]):a[l]&&a[l][c]||o[l]&&o[l][c]}},function(n,r){var i=Math.ceil,a=Math.floor;n.exports=function(o){return isNaN(o=+o)?0:(o>0?a:i)(o)}},function(n,r,i){var a=i(8);n.exports=function(o,s){var l=[][o];return!!l&&a(function(){l.call(null,s||function(){throw 1},1)})}},function(n,r){n.exports={}},function(n,r,i){i(31),i(32),i(33),i(220),i(64),i(19),i(65),i(20),i(68),i(66),i(92),i(144),i(22),i(94),i(23);var a=this&&this.__values||function(C){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&C[x],_=0;if(T)return T.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&_>=C.length&&(C=void 0),{value:C&&C[_++],done:!C}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(C,x){var T=typeof Symbol=="function"&&C[Symbol.iterator];if(!T)return C;var _,y,w=T.call(C),b=[];try{for(;(x===void 0||x-- >0)&&!(_=w.next()).done;)b.push(_.value)}catch(M){y={error:M}}finally{try{_&&!_.done&&(T=w.return)&&T.call(w)}finally{if(y)throw y.error}}return b},s=this&&this.__spread||function(){for(var C=[],x=0;x<arguments.length;x++)C=C.concat(o(arguments[x]));return C};Object.defineProperty(r,"__esModule",{value:!0});var l=i(2),c=i(69),d=i(95),f=i(7),h=i(0),p=function(){function C(x){this.level=0,this._builderOptions=x}return C.prototype.declaration=function(x,T,_){},C.prototype.docType=function(x,T,_){},C.prototype.comment=function(x){},C.prototype.text=function(x){},C.prototype.instruction=function(x,T){},C.prototype.cdata=function(x){},C.prototype.openTagBegin=function(x){},C.prototype.openTagEnd=function(x,T,_){},C.prototype.closeTag=function(x){},C.prototype.attributes=function(x){var T,_;try{for(var y=a(x),w=y.next();!w.done;w=y.next()){var b=w.value;this.attribute(b[1]===null?b[2]:b[1]+":"+b[2],b[3])}}catch(M){T={error:M}}finally{try{w&&!w.done&&(_=y.return)&&_.call(y)}finally{if(T)throw T.error}}},C.prototype.attribute=function(x,T){},C.prototype.beginElement=function(x){},C.prototype.endElement=function(x){},C.prototype.serializeNode=function(x,T){var _=x._nodeDocument!==void 0&&x._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=x,_){var y=new d.NamespacePrefixMap;y.set("xml",f.namespace.XML),this._serializeNodeNS(x,null,y,{value:1},T)}else this._serializeNode(x,T)},C.prototype._serializeNodeNS=function(x,T,_,y,w){switch(this.currentNode=x,x.nodeType){case l.NodeType.Element:this._serializeElementNS(x,T,_,y,w);break;case l.NodeType.Document:this._serializeDocumentNS(x,T,_,y,w);break;case l.NodeType.Comment:this._serializeComment(x,w);break;case l.NodeType.Text:this._serializeText(x,w);break;case l.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(x,T,_,y,w);break;case l.NodeType.DocumentType:this._serializeDocumentType(x,w);break;case l.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(x,w);break;case l.NodeType.CData:this._serializeCData(x,w);break;default:throw new Error("Unknown node type: "+x.nodeType)}},C.prototype._serializeNode=function(x,T){switch(this.currentNode=x,x.nodeType){case l.NodeType.Element:this._serializeElement(x,T);break;case l.NodeType.Document:this._serializeDocument(x,T);break;case l.NodeType.Comment:this._serializeComment(x,T);break;case l.NodeType.Text:this._serializeText(x,T);break;case l.NodeType.DocumentFragment:this._serializeDocumentFragment(x,T);break;case l.NodeType.DocumentType:this._serializeDocumentType(x,T);break;case l.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(x,T);break;case l.NodeType.CData:this._serializeCData(x,T);break;default:throw new Error("Unknown node type: "+x.nodeType)}},C.prototype._serializeElementNS=function(x,T,_,y,w){var b,M,I=[];if(w&&(x.localName.indexOf(":")!==-1||!h.xml_isName(x.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var A="",k=!1,U=!1,B=_.copy(),z={},K=this._recordNamespaceInformation(x,B,z),J=T,X=x.namespaceURI;if(J===X)K!==null&&(U=!0),A=X===f.namespace.XML?"xml:"+x.localName:x.localName,this.beginElement(A),this.openTagBegin(A);else{var re=x.prefix,fe=null;if(re===null&&X===K||(fe=B.get(re,X)),re==="xmlns"){if(w)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");fe=re}fe!==null?(A=fe+":"+x.localName,K!==null&&K!==f.namespace.XML&&(J=K||null),this.beginElement(A),this.openTagBegin(A)):re!==null?(re in z&&(re=this._generatePrefix(X,B,y)),B.set(re,X),A+=re+":"+x.localName,this.beginElement(A),this.openTagBegin(A),I.push([null,"xmlns",re,this._serializeAttributeValue(X,w)]),K!==null&&(J=K||null)):K===null||K!==null&&K!==X?(U=!0,A+=x.localName,J=X,this.beginElement(A),this.openTagBegin(A),I.push([null,null,"xmlns",this._serializeAttributeValue(X,w)])):(A+=x.localName,J=X,this.beginElement(A),this.openTagBegin(A))}I.push.apply(I,s(this._serializeAttributesNS(x,B,y,z,U,w))),this.attributes(I);var pe=X===f.namespace.HTML;if(pe&&x.childNodes.length===0&&C._VoidElementNames.has(x.localName)?(this.openTagEnd(A,!0,!0),this.endElement(A),k=!0):pe||x.childNodes.length!==0?this.openTagEnd(A,!1,!1):(this.openTagEnd(A,!0,!1),this.endElement(A),k=!0),!k){if(!(pe&&x.localName==="template"))try{for(var ie=a(x.childNodes),te=ie.next();!te.done;te=ie.next()){var ee=te.value;this.level++,this._serializeNodeNS(ee,J,B,y,w),this.level--}}catch(we){b={error:we}}finally{try{te&&!te.done&&(M=ie.return)&&M.call(ie)}finally{if(b)throw b.error}}this.closeTag(A),this.endElement(A)}},C.prototype._serializeElement=function(x,T){var _,y;if(T&&(x.localName.indexOf(":")!==-1||!h.xml_isName(x.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var w=!1,b=x.localName;this.beginElement(b),this.openTagBegin(b);var M=this._serializeAttributes(x,T);if(this.attributes(M),x.hasChildNodes()?this.openTagEnd(b,!1,!1):(this.openTagEnd(b,!0,!1),this.endElement(b),w=!0),!w){try{for(var I=a(x._children),A=I.next();!A.done;A=I.next()){var k=A.value;this.level++,this._serializeNode(k,T),this.level--}}catch(U){_={error:U}}finally{try{A&&!A.done&&(y=I.return)&&y.call(I)}finally{if(_)throw _.error}}this.closeTag(b),this.endElement(b)}},C.prototype._serializeDocumentNS=function(x,T,_,y,w){var b,M;if(w&&x.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var I=a(x.childNodes),A=I.next();!A.done;A=I.next()){var k=A.value;this._serializeNodeNS(k,T,_,y,w)}}catch(U){b={error:U}}finally{try{A&&!A.done&&(M=I.return)&&M.call(I)}finally{if(b)throw b.error}}},C.prototype._serializeDocument=function(x,T){var _,y;if(T&&x.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var w=a(x._children),b=w.next();!b.done;b=w.next()){var M=b.value;this._serializeNode(M,T)}}catch(I){_={error:I}}finally{try{b&&!b.done&&(y=w.return)&&y.call(w)}finally{if(_)throw _.error}}},C.prototype._serializeComment=function(x,T){if(T&&(!h.xml_isLegalChar(x.data)||x.data.indexOf("--")!==-1||x.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(x.data)},C.prototype._serializeText=function(x,T){if(T&&!h.xml_isLegalChar(x.data))throw new Error("Text data contains invalid characters (well-formed required).");var _=x.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(_)},C.prototype._serializeDocumentFragmentNS=function(x,T,_,y,w){var b,M;try{for(var I=a(x.childNodes),A=I.next();!A.done;A=I.next()){var k=A.value;this._serializeNodeNS(k,T,_,y,w)}}catch(U){b={error:U}}finally{try{A&&!A.done&&(M=I.return)&&M.call(I)}finally{if(b)throw b.error}}},C.prototype._serializeDocumentFragment=function(x,T){var _,y;try{for(var w=a(x._children),b=w.next();!b.done;b=w.next()){var M=b.value;this._serializeNode(M,T)}}catch(I){_={error:I}}finally{try{b&&!b.done&&(y=w.return)&&y.call(w)}finally{if(_)throw _.error}}},C.prototype._serializeDocumentType=function(x,T){if(T&&!h.xml_isPubidChar(x.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(T&&(!h.xml_isLegalChar(x.systemId)||x.systemId.indexOf('"')!==-1&&x.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(x.name,x.publicId,x.systemId)},C.prototype._serializeProcessingInstruction=function(x,T){if(T&&(x.target.indexOf(":")!==-1||/^xml$/i.test(x.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(T&&(!h.xml_isLegalChar(x.data)||x.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(x.target,x.data)},C.prototype._serializeCData=function(x,T){if(T&&x.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(x.data)},C.prototype._serializeAttributesNS=function(x,T,_,y,w,b){var M,I,A=[],k=b?new c.LocalNameSet:void 0;try{for(var U=a(x.attributes),B=U.next();!B.done;B=U.next()){var z=B.value;if(b||w||z.namespaceURI!==null){if(b&&k&&k.has(z.namespaceURI,z.localName))throw new Error("Element contains duplicate attributes (well-formed required).");b&&k&&k.set(z.namespaceURI,z.localName);var K=z.namespaceURI,J=null;if(K!==null)if(J=T.get(z.prefix,K),K===f.namespace.XMLNS){if(z.value===f.namespace.XML||z.prefix===null&&w||z.prefix!==null&&(!(z.localName in y)||y[z.localName]!==z.value)&&T.has(z.localName,z.value))continue;if(b&&z.value===f.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(b&&z.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");z.prefix==="xmlns"&&(J="xmlns")}else J===null&&(J=z.prefix===null||T.hasPrefix(z.prefix)&&!T.has(z.prefix,K)?this._generatePrefix(K,T,_):z.prefix,A.push([null,"xmlns",J,this._serializeAttributeValue(K,b)]));if(b&&(z.localName.indexOf(":")!==-1||!h.xml_isName(z.localName)||z.localName==="xmlns"&&K===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");A.push([K,J,z.localName,this._serializeAttributeValue(z.value,b)])}else A.push([null,null,z.localName,this._serializeAttributeValue(z.value,b)])}}catch(X){M={error:X}}finally{try{B&&!B.done&&(I=U.return)&&I.call(U)}finally{if(M)throw M.error}}return A},C.prototype._serializeAttributes=function(x,T){var _,y,w=[],b=T?{}:void 0;try{for(var M=a(x.attributes),I=M.next();!I.done;I=M.next()){var A=I.value;if(T){if(T&&b&&A.localName in b)throw new Error("Element contains duplicate attributes (well-formed required).");if(T&&b&&(b[A.localName]=!0),T&&(A.localName.indexOf(":")!==-1||!h.xml_isName(A.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");w.push([null,null,A.localName,this._serializeAttributeValue(A.value,T)])}else w.push([null,null,A.localName,this._serializeAttributeValue(A.value,T)])}}catch(k){_={error:k}}finally{try{I&&!I.done&&(y=M.return)&&y.call(M)}finally{if(_)throw _.error}}return w},C.prototype._recordNamespaceInformation=function(x,T,_){var y,w,b=null;try{for(var M=a(x.attributes),I=M.next();!I.done;I=M.next()){var A=I.value,k=A.namespaceURI,U=A.prefix;if(k===f.namespace.XMLNS){if(U===null){b=A.value;continue}var B=A.localName,z=A.value;if(z===f.namespace.XML||(z===""&&(z=null),T.has(B,z)))continue;T.set(B,z),_[B]=z||""}}}catch(K){y={error:K}}finally{try{I&&!I.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}return b},C.prototype._generatePrefix=function(x,T,_){var y="ns"+_.value.toString();return _.value++,T.set(y,x),y},C.prototype._serializeAttributeValue=function(x,T){if(T&&x!==null&&!h.xml_isLegalChar(x))throw new Error("Invalid characters in attribute value.");return x===null?"":x.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},C._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),C}();r.BaseWriter=p},function(n,r,i){var a=this&&this.__values||function(T){var _=typeof Symbol=="function"&&Symbol.iterator,y=_&&T[_],w=0;if(y)return y.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&w>=T.length&&(T=void 0),{value:T&&T[w++],done:!T}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(T,_){var y=typeof Symbol=="function"&&T[Symbol.iterator];if(!y)return T;var w,b,M=y.call(T),I=[];try{for(;(_===void 0||_-- >0)&&!(w=M.next()).done;)I.push(w.value)}catch(A){b={error:A}}finally{try{w&&!w.done&&(y=M.return)&&y.call(M)}finally{if(b)throw b.error}}return I};Object.defineProperty(r,"__esModule",{value:!0});var s=i(6),l=i(3),c=i(7),d=i(29),f=i(17),h=i(97);function p(){var T=s.dom.window;T._mutationObserverMicrotaskQueued||(T._mutationObserverMicrotaskQueued=!0,Promise.resolve().then(function(){C()}))}function C(){var T,_,y,w,b=s.dom.window;b._mutationObserverMicrotaskQueued=!1;var M=c.set.clone(b._mutationObservers),I=c.set.clone(b._signalSlots);c.set.empty(b._signalSlots);var A=function(J){var X=c.list.clone(J._recordQueue);c.list.empty(J._recordQueue);for(var re=0;re<J._nodeList.length;re++){var fe=J._nodeList[re];c.list.remove(fe._registeredObserverList,function(pe){return l.Guard.isTransientRegisteredObserver(pe)&&pe.observer===J})}if(!c.list.isEmpty(X))try{J._callback.call(J,X,J)}catch{}};try{for(var k=a(M),U=k.next();!U.done;U=k.next())A(U.value)}catch(J){T={error:J}}finally{try{U&&!U.done&&(_=k.return)&&_.call(k)}finally{if(T)throw T.error}}if(s.dom.features.slots)try{for(var B=a(I),z=B.next();!z.done;z=B.next()){var K=z.value;h.event_fireAnEvent("slotchange",K,void 0,{bubbles:!0})}}catch(J){y={error:J}}finally{try{z&&!z.done&&(w=B.return)&&w.call(B)}finally{if(y)throw y.error}}}function x(T,_,y,w,b,M,I,A,k){for(var U,B,z=new Map,K=f.tree_getFirstAncestorNode(_,!0);K!==null;){for(var J=0;J<K._registeredObserverList.length;J++){var X=K._registeredObserverList[J],re=X.options;if((K===_||re.subtree)&&(T!=="attributes"||re.attributes)&&(T!=="attributes"||!re.attributeFilter||re.attributeFilter.indexOf(y||"")&&w===null)&&(T!=="characterData"||re.characterData)&&(T!=="childList"||re.childList)){var fe=X.observer;z.has(fe)||z.set(fe,null),(T==="attributes"&&re.attributeOldValue||T==="characterData"&&re.characterDataOldValue)&&z.set(fe,b)}}K=f.tree_getNextAncestorNode(_,K,!0)}try{for(var pe=a(z),ie=pe.next();!ie.done;ie=pe.next()){var te=o(ie.value,2),ee=te[0],we=te[1],Ce=d.create_mutationRecord(T,_,d.create_nodeListStatic(_,M),d.create_nodeListStatic(_,I),A,k,y,w,we);ee._recordQueue.push(Ce)}}catch(De){U={error:De}}finally{try{ie&&!ie.done&&(B=pe.return)&&B.call(pe)}finally{if(U)throw U.error}}p()}r.observer_queueAMutationObserverMicrotask=p,r.observer_notifyMutationObservers=C,r.observer_queueMutationRecord=x,r.observer_queueTreeMutationRecord=function(T,_,y,w,b){x("childList",T,null,null,null,_,y,w,b)},r.observer_queueAttributeMutationRecord=function(T,_,y,w){x("attributes",T,_,y,w,[],[],null,null)}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(6),o=i(7),s=i(3),l=i(9),c=i(29),d=i(73),f=i(51),h=i(30),p=i(37),C=i(106);function x(M,I,A){a.dom.features.mutationObservers&&f.observer_queueAttributeMutationRecord(I,M._localName,M._namespace,M._value),a.dom.features.customElements&&s.Guard.isCustomElementNode(I)&&d.customElement_enqueueACustomElementCallbackReaction(I,"attributeChangedCallback",[M._localName,M._value,A,M._namespace]),a.dom.features.steps&&h.dom_runAttributeChangeSteps(I,M._localName,M._value,A,M._namespace),M._value=A}function T(M,I){a.dom.features.mutationObservers&&f.observer_queueAttributeMutationRecord(I,M._localName,M._namespace,null),a.dom.features.customElements&&s.Guard.isCustomElementNode(I)&&d.customElement_enqueueACustomElementCallbackReaction(I,"attributeChangedCallback",[M._localName,null,M._value,M._namespace]),a.dom.features.steps&&h.dom_runAttributeChangeSteps(I,M._localName,null,M._value,M._namespace),I._attributeList._asArray().push(M),M._element=I,I._nodeDocument._hasNamespaces||M._namespace===null&&M._namespacePrefix===null&&M._localName!=="xmlns"||(I._nodeDocument._hasNamespaces=!0)}function _(M,I){a.dom.features.mutationObservers&&f.observer_queueAttributeMutationRecord(I,M._localName,M._namespace,M._value),a.dom.features.customElements&&s.Guard.isCustomElementNode(I)&&d.customElement_enqueueACustomElementCallbackReaction(I,"attributeChangedCallback",[M._localName,M._value,null,M._namespace]),a.dom.features.steps&&h.dom_runAttributeChangeSteps(I,M._localName,M._value,null,M._namespace);var A=I._attributeList._asArray().indexOf(M);I._attributeList._asArray().splice(A,1),M._element=null}function y(M,I,A){a.dom.features.mutationObservers&&f.observer_queueAttributeMutationRecord(A,M._localName,M._namespace,M._value),a.dom.features.customElements&&s.Guard.isCustomElementNode(A)&&d.customElement_enqueueACustomElementCallbackReaction(A,"attributeChangedCallback",[M._localName,M._value,I._value,M._namespace]),a.dom.features.steps&&h.dom_runAttributeChangeSteps(A,M._localName,M._value,I._value,M._namespace);var k=A._attributeList._asArray().indexOf(M);k!==-1&&(A._attributeList._asArray()[k]=I),M._element=null,I._element=A,A._nodeDocument._hasNamespaces||I._namespace===null&&I._namespacePrefix===null&&I._localName!=="xmlns"||(A._nodeDocument._hasNamespaces=!0)}function w(M,I){return I._namespace===o.namespace.HTML&&I._nodeDocument._type==="html"&&(M=M.toLowerCase()),I._attributeList._asArray().find(function(A){return A._qualifiedName===M})||null}function b(M,I,A){var k=M||null;return A._attributeList._asArray().find(function(U){return U._namespace===k&&U._localName===I})||null}r.element_has=function(M,I){return I._attributeList._asArray().indexOf(M)!==-1},r.element_change=x,r.element_append=T,r.element_remove=_,r.element_replace=y,r.element_getAnAttributeByName=w,r.element_getAnAttributeByNamespaceAndLocalName=b,r.element_getAnAttributeValue=function(M,I,A){A===void 0&&(A="");var k=b(A,I,M);return k===null?"":k._value},r.element_setAnAttribute=function(M,I){if(M._element!==null&&M._element!==I)throw new l.InUseAttributeError("This attribute already exists in the document: "+M._qualifiedName+" as a child of "+M._element._qualifiedName+".");var A=b(M._namespace||"",M._localName,I);return A===M?M:(A!==null?y(A,M,I):T(M,I),A)},r.element_setAnAttributeValue=function(M,I,A,k,U){k===void 0&&(k=null),U===void 0&&(U=null);var B=b(U||"",I,M);if(B===null){var z=c.create_attr(M._nodeDocument,I);return z._namespace=U,z._namespacePrefix=k,z._value=A,void T(z,M)}x(B,M,A)},r.element_removeAnAttributeByName=function(M,I){var A=w(M,I);return A!==null&&_(A,I),A},r.element_removeAnAttributeByNamespaceAndLocalName=function(M,I,A){var k=b(M,I,A);return k!==null&&_(k,A),k},r.element_createAnElement=function(M,I,A,k,U,B){k===void 0&&(k=null),U===void 0&&(U=null),B===void 0&&(B=!1);var z=null;if(!a.dom.features.customElements)return(z=c.create_element(M,I,A,k))._customElementState="uncustomized",z._customElementDefinition=null,z._is=U,z;var K=d.customElement_lookUpACustomElementDefinition(M,A,I,U);if(K!==null&&K.name!==K.localName)(z=new(C.document_elementInterface(I,o.namespace.HTML)))._localName=I,z._namespace=o.namespace.HTML,z._namespacePrefix=k,z._customElementState="undefined",z._customElementDefinition=null,z._is=U,z._nodeDocument=M,B?d.customElement_upgrade(K,z):d.customElement_enqueueACustomElementUpgradeReaction(z,K);else if(K!==null)if(B)try{var J=new K.constructor;if(console.assert(J._customElementState!==void 0),console.assert(J._customElementDefinition!==void 0),console.assert(J._namespace===o.namespace.HTML),J._attributeList.length!==0)throw new l.NotSupportedError("Custom element already has attributes.");if(J._children.size!==0)throw new l.NotSupportedError("Custom element already has child nodes.");if(J._parent!==null)throw new l.NotSupportedError("Custom element already has a parent node.");if(J._nodeDocument!==M)throw new l.NotSupportedError("Custom element is already in a document.");if(J._localName!==I)throw new l.NotSupportedError("Custom element has a different local name.");J._namespacePrefix=k,J._is=null}catch{(z=c.create_htmlUnknownElement(M,I,o.namespace.HTML,k))._customElementState="failed",z._customElementDefinition=null,z._is=null}else(z=c.create_htmlElement(M,I,o.namespace.HTML,k))._customElementState="undefined",z._customElementDefinition=null,z._is=null,d.customElement_enqueueACustomElementUpgradeReaction(z,K);else(z=new(C.document_elementInterface(I,A)))._localName=I,z._namespace=A,z._namespacePrefix=k,z._customElementState="uncustomized",z._customElementDefinition=null,z._is=U,z._nodeDocument=M,A!==o.namespace.HTML||U===null&&!d.customElement_isValidCustomElementName(I)||(z._customElementState="undefined");if(z===null)throw new Error("Unable to create element.");return z},r.element_insertAdjacent=function(M,I,A){switch(I.toLowerCase()){case"beforebegin":return M._parent===null?null:p.mutation_preInsert(A,M._parent,M);case"afterbegin":return p.mutation_preInsert(A,M,M._firstChild);case"beforeend":return p.mutation_preInsert(A,M,null);case"afterend":return M._parent===null?null:p.mutation_preInsert(A,M._parent,M._nextSibling);default:throw new l.SyntaxError(`Invalid 'where' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected`)}}},function(n,r,i){function a(o,s){Error.call(this),this.name="YAMLException",this.reason=o,this.mark=s,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a.prototype.toString=function(o){var s=this.name+": ";return s+=this.reason||"(unknown reason)",!o&&this.mark&&(s+=" "+this.mark.toString()),s},n.exports=a},function(n,r,i){var a=i(39);n.exports=new a({include:[i(181)],implicit:[i(293),i(294)],explicit:[i(295),i(296),i(297),i(298)]})},function(n,r,i){var a=i(16),o=i(79),s=i(40),l=i(24),c=i(56),d=i(14),f=i(115),h=Object.getOwnPropertyDescriptor;r.f=a?h:function(p,C){if(p=l(p),C=c(C,!0),f)try{return h(p,C)}catch{}if(d(p,C))return s(!o.f.call(p,C),p[C])}},function(n,r,i){var a=i(13);n.exports=function(o,s){if(!a(o))return o;var l,c;if(s&&typeof(l=o.toString)=="function"&&!a(c=l.call(o))||typeof(l=o.valueOf)=="function"&&!a(c=l.call(o))||!s&&typeof(l=o.toString)=="function"&&!a(c=l.call(o)))return c;throw TypeError("Can't convert object to primitive value")}},function(n,r,i){var a=i(81),o=i(58),s=a("keys");n.exports=function(l){return s[l]||(s[l]=o(l))}},function(n,r){var i=0,a=Math.random();n.exports=function(o){return"Symbol("+String(o===void 0?"":o)+")_"+(++i+a).toString(36)}},function(n,r,i){var a=i(42);n.exports=Array.isArray||function(o){return a(o)=="Array"}},function(n,r,i){var a,o=i(18),s=i(188),l=i(84),c=i(45),d=i(189),f=i(116),h=i(57),p=h("IE_PROTO"),C=function(){},x=function(_){return"<script>"+_+"<\/script>"},T=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch{}var _,y;T=a?function(b){b.write(x("")),b.close();var M=b.parentWindow.Object;return b=null,M}(a):((y=f("iframe")).style.display="none",d.appendChild(y),y.src="javascript:",(_=y.contentWindow.document).open(),_.write(x("document.F=Object")),_.close(),_.F);for(var w=l.length;w--;)delete T.prototype[l[w]];return T()};c[p]=!0,n.exports=Object.create||function(_,y){var w;return _!==null?(C.prototype=o(_),w=new C,C.prototype=null,w[p]=_):w=T(),y===void 0?w:s(w,y)}},function(n,r,i){var a=i(121),o=i(84);n.exports=Object.keys||function(s){return a(s,o)}},function(n,r,i){var a=i(15).f,o=i(14),s=i(5)("toStringTag");n.exports=function(l,c,d){l&&!o(l=d?l:l.prototype,s)&&a(l,s,{configurable:!0,value:c})}},function(n,r,i){var a=i(8),o=i(5),s=i(129),l=o("species");n.exports=function(c){return s>=51||!a(function(){var d=[];return(d.constructor={})[l]=function(){return{foo:1}},d[c](Boolean).foo!==1})}},function(n,r,i){var a=i(4),o=i(122).indexOf,s=i(48),l=i(28),c=[].indexOf,d=!!c&&1/[1].indexOf(1,-0)<0,f=s("indexOf"),h=l("indexOf",{ACCESSORS:!0,1:0});a({target:"Array",proto:!0,forced:d||!f||!h},{indexOf:function(p){return d?c.apply(this,arguments)||0:o(this,p,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(16),o=i(15).f,s=Function.prototype,l=s.toString,c=/^\s*function ([^ (]*)/;a&&!("name"in s)&&o(s,"name",{configurable:!0,get:function(){try{return l.call(this).match(c)[1]}catch{return""}}})},function(n,r,i){var a=i(25),o=i(18),s=i(8),l=i(136),c=RegExp.prototype,d=c.toString,f=s(function(){return d.call({source:"a",flags:"b"})!="/a/b"}),h=d.name!="toString";(f||h)&&a(RegExp.prototype,"toString",function(){var p=o(this),C=String(p.source),x=p.flags;return"/"+C+"/"+String(x===void 0&&p instanceof RegExp&&!("flags"in c)?l.call(p):x)},{unsafe:!0})},function(n,r,i){i(31),i(32),i(33),i(19),i(138),i(20),i(66),i(22),i(23);var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),s=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(1),c=i(2),d=function(f){function h(p,C){var x=f.call(this,p)||this;return x._writerOptions=l.applyDefaults(C,{format:"object",wellFormed:!1,group:!1,verbose:!1}),x}return o(h,f),h.prototype.serialize=function(p){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(p,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},h.prototype._process=function(p,C){var x,T,_,y,w,b,M;if(p.length===0)return{};for(var I={},A=!1,k=0,U=0,B=0,z=0,K=0;K<p.length;K++){var J=p[K];switch(Be=Object.keys(J)[0]){case"@":continue;case"#":k++;break;case"!":U++;break;case"?":B++;break;case"$":z++;break;default:I[Be]?A=!0:I[Be]=!0}}var X=this._getAttrKey(),re=this._getNodeKey(c.NodeType.Text),fe=this._getNodeKey(c.NodeType.Comment),pe=this._getNodeKey(c.NodeType.ProcessingInstruction),ie=this._getNodeKey(c.NodeType.CData);if(k===1&&p.length===1&&l.isString(p[0]["#"]))return p[0]["#"];if(A){var te={};for(K=0;K<p.length;K++)if(J=p[K],(Be=Object.keys(J)[0])==="@"){var ee=J["@"];(ae=Object.keys(ee)).length===1?te[X+ae[0]]=ee[ae[0]]:te[X]=J["@"]}var we=[];for(K=0;K<p.length;K++)switch(J=p[K],Be=Object.keys(J)[0]){case"@":break;case"#":we.push(((x={})[re]=J["#"],x));break;case"!":we.push(((T={})[fe]=J["!"],T));break;case"?":we.push(((_={})[pe]=J["?"],_));break;case"$":we.push(((y={})[ie]=J.$,y));break;default:if((ce=J)[Be].length!==0&&l.isArray(ce[Be][0])){for(var Ce=[],De=ce[Be],Re=0;Re<De.length;Re++)Ce.push(this._process(De[Re],C));we.push(((w={})[Be]=Ce,w))}else C.verbose?we.push(((b={})[Be]=[this._process(ce[Be],C)],b)):we.push(((M={})[Be]=this._process(ce[Be],C),M))}return te[re]=we,te}var Oe=1,Ve=1,Ge=1,qe=1;for(te={},K=0;K<p.length;K++){var Be;switch(J=p[K],Be=Object.keys(J)[0]){case"@":ee=J["@"];var ae=Object.keys(ee);if(C.group&&ae.length!==1)te[X]=ee;else for(var H in ee)te[X+H]=ee[H];break;case"#":Oe=this._processSpecItem(J["#"],te,C.group,re,k,Oe);break;case"!":Ve=this._processSpecItem(J["!"],te,C.group,fe,U,Ve);break;case"?":Ge=this._processSpecItem(J["?"],te,C.group,pe,B,Ge);break;case"$":qe=this._processSpecItem(J.$,te,C.group,ie,z,qe);break;default:var ce;if((ce=J)[Be].length!==0&&l.isArray(ce[Be][0])){Ce=[],De=ce[Be];for(var se=0;se<De.length;se++)Ce.push(this._process(De[se],C));te[Be]=Ce}else C.verbose?te[Be]=[this._process(ce[Be],C)]:te[Be]=this._process(ce[Be],C)}}return te},h.prototype._processSpecItem=function(p,C,x,T,_,y){var w,b;if(!x&&l.isArray(p)&&_+p.length>2)try{for(var M=s(p),I=M.next();!I.done;I=M.next()){var A=I.value;C[T+(y++).toString()]=A}}catch(k){w={error:k}}finally{try{I&&!I.done&&(b=M.return)&&b.call(M)}finally{if(w)throw w.error}}else C[_>1?T+(y++).toString():T]=p;return y},h.prototype.beginElement=function(p){var C,x,T=[];if(this._currentList.length===0)this._currentList.push(((C={})[p]=T,C));else{var _=this._currentList[this._currentList.length-1];this._isElementNode(_,p)?_[p].length!==0&&l.isArray(_[p][0])?_[p].push(T):_[p]=[_[p],T]:this._currentList.push(((x={})[p]=T,x))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=T:this._listRegister.push(T),this._currentList=T},h.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},h.prototype.attribute=function(p,C){var x,T;if(this._currentList.length===0)this._currentList.push({"@":(x={},x[p]=C,x)});else{var _=this._currentList[this._currentList.length-1];this._isAttrNode(_)?_["@"][p]=C:this._currentList.push({"@":(T={},T[p]=C,T)})}},h.prototype.comment=function(p){if(this._currentList.length===0)this._currentList.push({"!":p});else{var C=this._currentList[this._currentList.length-1];this._isCommentNode(C)?l.isArray(C["!"])?C["!"].push(p):C["!"]=[C["!"],p]:this._currentList.push({"!":p})}},h.prototype.text=function(p){if(this._currentList.length===0)this._currentList.push({"#":p});else{var C=this._currentList[this._currentList.length-1];this._isTextNode(C)?l.isArray(C["#"])?C["#"].push(p):C["#"]=[C["#"],p]:this._currentList.push({"#":p})}},h.prototype.instruction=function(p,C){var x=C===""?p:p+" "+C;if(this._currentList.length===0)this._currentList.push({"?":x});else{var T=this._currentList[this._currentList.length-1];this._isInstructionNode(T)?l.isArray(T["?"])?T["?"].push(x):T["?"]=[T["?"],x]:this._currentList.push({"?":x})}},h.prototype.cdata=function(p){if(this._currentList.length===0)this._currentList.push({$:p});else{var C=this._currentList[this._currentList.length-1];this._isCDATANode(C)?l.isArray(C.$)?C.$.push(p):C.$=[C.$,p]:this._currentList.push({$:p})}},h.prototype._isAttrNode=function(p){return"@"in p},h.prototype._isTextNode=function(p){return"#"in p},h.prototype._isCommentNode=function(p){return"!"in p},h.prototype._isInstructionNode=function(p){return"?"in p},h.prototype._isCDATANode=function(p){return"$"in p},h.prototype._isElementNode=function(p,C){return C in p},h.prototype._getAttrKey=function(){return this._builderOptions.convert.att},h.prototype._getNodeKey=function(p){switch(p){case c.NodeType.Comment:return this._builderOptions.convert.comment;case c.NodeType.Text:return this._builderOptions.convert.text;case c.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case c.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},h}(i(50).BaseWriter);r.ObjectWriter=d},function(n,r,i){var a=i(4),o=i(93);a({target:"RegExp",proto:!0,forced:/./.exec!==o},{exec:o})},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(){this._items={},this._nullItems={}}return o.prototype.set=function(s,l){s===null?this._nullItems[l]=!0:(this._items[s]||(this._items[s]={}),this._items[s][l]=!0)},o.prototype.has=function(s,l){return s===null?this._nullItems[l]===!0:!!this._items[s]&&this._items[s][l]===!0},o}();r.LocalNameSet=a},function(n,r,i){var a=this&&this.__read||function(d,f){var h=typeof Symbol=="function"&&d[Symbol.iterator];if(!h)return d;var p,C,x=h.call(d),T=[];try{for(;(f===void 0||f-- >0)&&!(p=x.next()).done;)T.push(p.value)}catch(_){C={error:_}}finally{try{p&&!p.done&&(h=x.return)&&h.call(x)}finally{if(C)throw C.error}}return T};Object.defineProperty(r,"__esModule",{value:!0});var o=i(9),s=i(3),l=i(0),c=function(){function d(){}return Object.defineProperty(d.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),d.prototype.addEventListener=function(f,h,p){p===void 0&&(p={passive:!1,once:!1,capture:!1});var C,x=a(l.eventTarget_flattenMore(p),3),T=x[0],_=x[1],y=x[2];h&&(C=s.Guard.isEventListener(h)?h:{handleEvent:h},l.eventTarget_addEventListener(this,{type:f,callback:C,capture:T,passive:_,once:y,removed:!1}))},d.prototype.removeEventListener=function(f,h,p){p===void 0&&(p={capture:!1});var C=l.eventTarget_flatten(p);if(h)for(var x=0;x<this._eventListenerList.length;x++){var T=this._eventListenerList[x];if(T.type===f&&T.capture===C){if(s.Guard.isEventListener(h)&&T.callback===h){l.eventTarget_removeEventListener(this,T,x);break}if(h&&T.callback.handleEvent===h){l.eventTarget_removeEventListener(this,T,x);break}}}},d.prototype.dispatchEvent=function(f){if(f._dispatchFlag||!f._initializedFlag)throw new o.InvalidStateError;return f._isTrusted=!1,l.event_dispatch(f,this)},d.prototype._getTheParent=function(f){return null},d}();r.EventTargetImpl=c},function(n,r,i){var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(34),l=i(0),c=function(d){function f(h){var p=d.call(this)||this;return p._data=h,p}return o(f,d),Object.defineProperty(f.prototype,"data",{get:function(){return this._data},set:function(h){l.characterData_replaceData(this,0,this._data.length,h)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),f.prototype.substringData=function(h,p){return l.characterData_substringData(this,h,p)},f.prototype.appendData=function(h){return l.characterData_replaceData(this,this._data.length,0,h)},f.prototype.insertData=function(h,p){l.characterData_replaceData(this,h,0,p)},f.prototype.deleteData=function(h,p){l.characterData_replaceData(this,h,p,"")},f.prototype.replaceData=function(h,p,C){l.characterData_replaceData(this,h,p,C)},Object.defineProperty(f.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),f.prototype.before=function(){for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.after=function(){for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.replaceWith=function(){for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},f}(s.NodeImpl);r.CharacterDataImpl=c},function(n,r,i){var a=this&&this.__values||function(_){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&_[y],b=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&b>=_.length&&(_=void 0),{value:_&&_[b++],done:!_}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(_,y){var w=typeof Symbol=="function"&&_[Symbol.iterator];if(!w)return _;var b,M,I=w.call(_),A=[];try{for(;(y===void 0||y-- >0)&&!(b=I.next()).done;)A.push(b.value)}catch(k){M={error:k}}finally{try{b&&!b.done&&(w=I.return)&&w.call(I)}finally{if(M)throw M.error}}return A},s=this&&this.__spread||function(){for(var _=[],y=0;y<arguments.length;y++)_=_.concat(o(arguments[y]));return _};Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=i(3),d=i(1),f=i(17),h=i(51);function p(_){l.dom.window._signalSlots.add(_),h.observer_queueAMutationObserverMicrotask()}function C(_,y){y===void 0&&(y=!1);var w=c.Cast.asNode(_)._parent;if(w===null)return null;var b=w._shadowRoot||null;if(b===null||y&&b._mode!=="open")return null;for(var M=f.tree_getFirstDescendantNode(b,!1,!0,function(I){return c.Guard.isSlot(I)});M!==null;){if(M._name===_._name)return M;M=f.tree_getNextDescendantNode(b,M,!1,!0,function(I){return c.Guard.isSlot(I)})}return null}function x(_){var y,w,b=[],M=f.tree_rootNode(_);if(!c.Guard.isShadowRoot(M))return b;var I=M._host;try{for(var A=a(I._children),k=A.next();!k.done;k=A.next()){var U=k.value;c.Guard.isSlotable(U)&&C(U)===_&&b.push(U)}}catch(B){y={error:B}}finally{try{k&&!k.done&&(w=A.return)&&w.call(A)}finally{if(y)throw y.error}}return b}function T(_){var y,w,b=x(_);if(b.length===_._assignedNodes.length){for(var M=!0,I=0;I<b.length;I++)if(b[I]!==_._assignedNodes[I]){M=!1;break}M||p(_)}_._assignedNodes=b;try{for(var A=a(b),k=A.next();!k.done;k=A.next())k.value._assignedSlot=_}catch(U){y={error:U}}finally{try{k&&!k.done&&(w=A.return)&&w.call(A)}finally{if(y)throw y.error}}}r.shadowTree_signalASlotChange=p,r.shadowTree_isConnected=function(_){return c.Guard.isDocumentNode(f.tree_rootNode(_,!0))},r.shadowTree_isAssigned=function(_){return _._assignedSlot!==null},r.shadowTree_findASlot=C,r.shadowTree_findSlotables=x,r.shadowTree_findFlattenedSlotables=function _(y){var w,b,M,I,A=[],k=f.tree_rootNode(y);if(!c.Guard.isShadowRoot(k))return A;var U=x(y);if(d.isEmpty(U))try{for(var B=a(y._children),z=B.next();!z.done;z=B.next()){var K=z.value;c.Guard.isSlotable(K)&&U.push(K)}}catch(pe){w={error:pe}}finally{try{z&&!z.done&&(b=B.return)&&b.call(B)}finally{if(w)throw w.error}}try{for(var J=a(U),X=J.next();!X.done;X=J.next()){var re=X.value;if(c.Guard.isSlot(re)&&c.Guard.isShadowRoot(f.tree_rootNode(re))){var fe=_(re);A.push.apply(A,s(fe))}else A.push(re)}}catch(pe){M={error:pe}}finally{try{X&&!X.done&&(I=J.return)&&I.call(J)}finally{if(M)throw M.error}}return A},r.shadowTree_assignSlotables=T,r.shadowTree_assignSlotablesForATree=function(_){for(var y=f.tree_getFirstDescendantNode(_,!0,!1,function(w){return c.Guard.isSlot(w)});y!==null;)T(y),y=f.tree_getNextDescendantNode(_,y,!0,!1,function(w){return c.Guard.isSlot(w)})},r.shadowTree_assignASlot=function(_){var y=C(_);y!==null&&T(y)}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,o=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),l=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),c=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);r.customElement_isValidCustomElementName=function(d){return!!a.test(d)&&!o.has(d)},r.customElement_isValidElementName=function(d){return s.has(d)},r.customElement_isVoidElementName=function(d){return l.has(d)},r.customElement_isValidShadowHostName=function(d){return c.has(d)},r.customElement_enqueueACustomElementUpgradeReaction=function(d,f){},r.customElement_enqueueACustomElementCallbackReaction=function(d,f,h){},r.customElement_upgrade=function(d,f){},r.customElement_tryToUpgrade=function(d){},r.customElement_lookUpACustomElementDefinition=function(d,f,h,p){return null}},function(n,r,i){i(4)({target:"String",proto:!0},{repeat:i(259)})},function(n,r,i){i(278),i(68),i(179),i(94),Object.defineProperty(r,"__esModule",{value:!0});var a=i(109),o=function(){function s(l){this._builderOptions=l,l.parser&&Object.assign(this,l.parser)}return s.prototype._docType=function(l,c,d,f){return l.dtd({name:c,pubID:d,sysID:f})},s.prototype._comment=function(l,c){return l.com(c)},s.prototype._text=function(l,c){return l.txt(c)},s.prototype._instruction=function(l,c,d){return l.ins(c,d)},s.prototype._cdata=function(l,c){return l.dat(c)},s.prototype._element=function(l,c,d){return c===void 0?l.ele(d):l.ele(c,d)},s.prototype._attribute=function(l,c,d,f){return c===void 0?l.att(d,f):l.att(c,d,f)},s.prototype._sanitize=function(l){return a.sanitizeInput(l,this._builderOptions.invalidCharReplacement)},s.prototype._decodeText=function(l){return l==null?l:l.replace(/&(quot|amp|apos|lt|gt);/g,function(c,d){return s._entityTable[d]}).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,function(c,d,f){return String.fromCodePoint(parseInt(d||f,d?16:10))})},s.prototype._decodeAttributeValue=function(l){return this._decodeText(l)},s.prototype.parse=function(l,c){return this._parse(l,c)},s.prototype.docType=function(l,c,d,f){return this._docType(l,c,d,f)},s.prototype.comment=function(l,c){return this._comment(l,c)},s.prototype.text=function(l,c){return this._text(l,c)},s.prototype.instruction=function(l,c,d){return this._instruction(l,c,d)},s.prototype.cdata=function(l,c){return this._cdata(l,c)},s.prototype.element=function(l,c,d){return this._element(l,c,d)},s.prototype.attribute=function(l,c,d,f){return this._attribute(l,c,d,f)},s.prototype.sanitize=function(l){return this._sanitize(l)},s._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},s}();r.BaseReader=o},function(n,r,i){var a=i(39);n.exports=a.DEFAULT=new a({include:[i(54)],explicit:[i(299),i(300),i(301)]})},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(185);r.XMLBuilderImpl=a.XMLBuilderImpl;var o=i(304);r.XMLBuilderCBImpl=o.XMLBuilderCBImpl;var s=i(183);r.builder=s.builder,r.create=s.create,r.fragment=s.fragment,r.convert=s.convert;var l=i(309);r.createCB=l.createCB,r.fragmentCB=l.fragmentCB},function(n,r){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}n.exports=i},function(n,r,i){var a={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,s=o&&!a.call({1:2},1);r.f=s?function(l){var c=o(this,l);return!!c&&c.enumerable}:a},function(n,r,i){var a=i(11),o=i(21);n.exports=function(s,l){try{o(a,s,l)}catch{a[s]=l}return l}},function(n,r,i){var a=i(44),o=i(118);(n.exports=function(s,l){return o[s]||(o[s]=l!==void 0?l:{})})("versions",[]).push({version:"3.6.5",mode:a?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(n,r,i){var a=i(121),o=i(84).concat("length","prototype");r.f=Object.getOwnPropertyNames||function(s){return a(s,o)}},function(n,r,i){var a=i(47),o=Math.max,s=Math.min;n.exports=function(l,c){var d=a(l);return d<0?o(d+c,0):s(d,c)}},function(n,r){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,r){r.f=Object.getOwnPropertySymbols},function(n,r,i){var a=i(8);n.exports=!!Object.getOwnPropertySymbols&&!a(function(){return!String(Symbol())})},function(n,r,i){var a=i(127);n.exports=function(o,s,l){if(a(o),s===void 0)return o;switch(l){case 0:return function(){return o.call(s)};case 1:return function(c){return o.call(s,c)};case 2:return function(c,d){return o.call(s,c,d)};case 3:return function(c,d,f){return o.call(s,c,d,f)}}return function(){return o.apply(s,arguments)}}},function(n,r,i){var a=i(4),o=i(195),s=i(132),l=i(133),c=i(62),d=i(21),f=i(25),h=i(5),p=i(44),C=i(49),x=i(131),T=x.IteratorPrototype,_=x.BUGGY_SAFARI_ITERATORS,y=h("iterator"),w=function(){return this};n.exports=function(b,M,I,A,k,U,B){o(I,M,A);var z,K,J,X=function(we){if(we===k&&te)return te;if(!_&&we in pe)return pe[we];switch(we){case"keys":case"values":case"entries":return function(){return new I(this,we)}}return function(){return new I(this)}},re=M+" Iterator",fe=!1,pe=b.prototype,ie=pe[y]||pe["@@iterator"]||k&&pe[k],te=!_&&ie||X(k),ee=M=="Array"&&pe.entries||ie;if(ee&&(z=s(ee.call(new b)),T!==Object.prototype&&z.next&&(p||s(z)===T||(l?l(z,T):typeof z[y]!="function"&&d(z,y,w)),c(z,re,!0,!0),p&&(C[re]=w))),k=="values"&&ie&&ie.name!=="values"&&(fe=!0,te=function(){return ie.call(this)}),p&&!B||pe[y]===te||d(pe,y,te),C[M]=te,k)if(K={values:X("values"),keys:U?te:X("keys"),entries:X("entries")},B)for(J in K)(_||fe||!(J in pe))&&f(pe,J,K[J]);else a({target:M,proto:!0,forced:_||fe},K);return K}},function(n,r,i){var a=i(4),o=i(13),s=i(59),l=i(83),c=i(26),d=i(24),f=i(134),h=i(5),p=i(63),C=i(28),x=p("slice"),T=C("slice",{ACCESSORS:!0,0:0,1:2}),_=h("species"),y=[].slice,w=Math.max;a({target:"Array",proto:!0,forced:!x||!T},{slice:function(b,M){var I,A,k,U=d(this),B=c(U.length),z=l(b,B),K=l(M===void 0?B:M,B);if(s(U)&&(typeof(I=U.constructor)!="function"||I!==Array&&!s(I.prototype)?o(I)&&(I=I[_])===null&&(I=void 0):I=void 0,I===Array||I===void 0))return y.call(U,z,K);for(A=new(I===void 0?Array:I)(w(K-z,0)),k=0;z<K;z++,k++)z in U&&f(A,k,U[z]);return A.length=k,A}})},function(n,r,i){var a={};a[i(5)("toStringTag")]="z",n.exports=String(a)==="[object z]"},function(n,r,i){i(19),i(138),i(20),i(92),i(22),i(23),Object.defineProperty(r,"__esModule",{value:!0}),r.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},r.XMLBuilderOptionKeys=new Set(Object.keys(r.DefaultBuilderOptions)),r.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(n,r,i){var a=i(139),o=i(143);n.exports=a("Set",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},o)},function(n,r,i){var a,o,s=i(136),l=i(221),c=RegExp.prototype.exec,d=String.prototype.replace,f=c,h=(a=/a/,o=/b*/g,c.call(a,"a"),c.call(o,"a"),a.lastIndex!==0||o.lastIndex!==0),p=l.UNSUPPORTED_Y||l.BROKEN_CARET,C=/()??/.exec("")[1]!==void 0;(h||C||p)&&(f=function(x){var T,_,y,w,b=this,M=p&&b.sticky,I=s.call(b),A=b.source,k=0,U=x;return M&&((I=I.replace("y","")).indexOf("g")===-1&&(I+="g"),U=String(x).slice(b.lastIndex),b.lastIndex>0&&(!b.multiline||b.multiline&&x[b.lastIndex-1]!==`
`)&&(A="(?: "+A+")",U=" "+U,k++),_=new RegExp("^(?:"+A+")",I)),C&&(_=new RegExp("^"+A+"$(?!\\s)",I)),h&&(T=b.lastIndex),y=c.call(M?_:b,U),M?y?(y.input=y.input.slice(k),y[0]=y[0].slice(k),y.index=b.lastIndex,b.lastIndex+=y[0].length):b.lastIndex=0:h&&y&&(b.lastIndex=b.global?y.index+y[0].length:T),C&&y&&y.length>1&&d.call(y[0],_,function(){for(w=1;w<arguments.length-2;w++)arguments[w]===void 0&&(y[w]=void 0)}),y}),n.exports=f},function(n,r,i){var a=i(225),o=i(18),s=i(27),l=i(26),c=i(47),d=i(35),f=i(226),h=i(227),p=Math.max,C=Math.min,x=Math.floor,T=/\$([$&'`]|\d\d?|<[^>]*>)/g,_=/\$([$&'`]|\d\d?)/g;a("replace",2,function(y,w,b,M){var I=M.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,A=M.REPLACE_KEEPS_$0,k=I?"$":"$0";return[function(B,z){var K=d(this),J=B==null?void 0:B[y];return J!==void 0?J.call(B,K,z):w.call(String(K),B,z)},function(B,z){if(!I&&A||typeof z=="string"&&z.indexOf(k)===-1){var K=b(w,B,this,z);if(K.done)return K.value}var J=o(B),X=String(this),re=typeof z=="function";re||(z=String(z));var fe=J.global;if(fe){var pe=J.unicode;J.lastIndex=0}for(var ie=[];;){var te=h(J,X);if(te===null||(ie.push(te),!fe))break;String(te[0])===""&&(J.lastIndex=f(X,l(J.lastIndex),pe))}for(var ee,we="",Ce=0,De=0;De<ie.length;De++){te=ie[De];for(var Re=String(te[0]),Oe=p(C(c(te.index),X.length),0),Ve=[],Ge=1;Ge<te.length;Ge++)Ve.push((ee=te[Ge])===void 0?ee:String(ee));var qe=te.groups;if(re){var Be=[Re].concat(Ve,Oe,X);qe!==void 0&&Be.push(qe);var ae=String(z.apply(void 0,Be))}else ae=U(Re,X,Oe,Ve,qe,z);Oe>=Ce&&(we+=X.slice(Ce,Oe)+ae,Ce=Oe+Re.length)}return we+X.slice(Ce)}];function U(B,z,K,J,X,re){var fe=K+B.length,pe=J.length,ie=_;return X!==void 0&&(X=s(X),ie=T),w.call(re,ie,function(te,ee){var we;switch(ee.charAt(0)){case"$":return"$";case"&":return B;case"`":return z.slice(0,K);case"'":return z.slice(fe);case"<":we=X[ee.slice(1,-1)];break;default:var Ce=+ee;if(Ce===0)return te;if(Ce>pe){var De=x(Ce/10);return De===0?te:De<=pe?J[De-1]===void 0?ee.charAt(1):J[De-1]+ee.charAt(1):te}we=J[Ce-1]}return we===void 0?"":we})}})},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(){this._items={},this._nullItems=[]}return o.prototype.copy=function(){var s=new o;for(var l in this._items)s._items[l]=this._items[l].slice(0);return s._nullItems=this._nullItems.slice(0),s},o.prototype.get=function(s,l){var c=l===null?this._nullItems:this._items[l]||null;if(c===null)return null;for(var d=null,f=0;f<c.length;f++)if((d=c[f])===s)return d;return d},o.prototype.has=function(s,l){var c=l===null?this._nullItems:this._items[l]||null;return c!==null&&c.indexOf(s)!==-1},o.prototype.hasPrefix=function(s){if(this._nullItems.indexOf(s)!==-1)return!0;for(var l in this._items)if(this._items[l].indexOf(s)!==-1)return!0;return!1},o.prototype.set=function(s,l){var c=l===null?this._nullItems:this._items[l]||null;l!==null&&c===null?this._items[l]=[s]:c.push(s)},o}();r.NamespacePrefixMap=a},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.Surrogate=/[\uD800-\uDFFF]/,r.ScalarValue=/[\uD800-\uDFFF]/,r.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,r.ASCIICodePoint=/[\u0000-\u007F]/,r.ASCIITabOrNewLine=/[\t\n\r]/,r.ASCIIWhiteSpace=/[\t\n\f\r ]/,r.C0Control=/[\u0000-\u001F]/,r.C0ControlOrSpace=/[\u0000-\u001F ]/,r.Control=/[\u0000-\u001F\u007F-\u009F]/,r.ASCIIDigit=/[0-9]/,r.ASCIIUpperHexDigit=/[0-9A-F]/,r.ASCIILowerHexDigit=/[0-9a-f]/,r.ASCIIHexDigit=/[0-9A-Fa-f]/,r.ASCIIUpperAlpha=/[A-Z]/,r.ASCIILowerAlpha=/[a-z]/,r.ASCIIAlpha=/[A-Za-z]/,r.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(n,r,i){var a=this&&this.__values||function(z){var K=typeof Symbol=="function"&&Symbol.iterator,J=K&&z[K],X=0;if(J)return J.call(z);if(z&&typeof z.length=="number")return{next:function(){return z&&X>=z.length&&(z=void 0),{value:z&&z[X++],done:!z}}};throw new TypeError(K?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(z,K){var J=typeof Symbol=="function"&&z[Symbol.iterator];if(!J)return z;var X,re,fe=J.call(z),pe=[];try{for(;(K===void 0||K-- >0)&&!(X=fe.next()).done;)pe.push(X.value)}catch(ie){re={error:ie}}finally{try{X&&!X.done&&(J=fe.return)&&J.call(fe)}finally{if(re)throw re.error}}return pe},s=this&&this.__spread||function(){for(var z=[],K=0;K<arguments.length;K++)z=z.concat(o(arguments[K]));return z};Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=i(2),d=i(3),f=i(171),h=i(104),p=i(9),C=i(17),x=i(72),T=i(30);function _(z,K){K===void 0&&(K=void 0),K===void 0&&(K=null);var J=y(z,K,new Date,{});return J._isTrusted=!0,J}function y(z,K,J,X){var re=new z("");return re._initializedFlag=!0,re._timeStamp=J.getTime(),Object.assign(re,X),l.dom.features.steps&&T.dom_runEventConstructingSteps(re),re}function w(z,K,J,X){var re,fe,pe,ie;J===void 0&&(J=!1),X===void 0&&(X={value:!1});var te=!1;z._dispatchFlag=!0;var ee=K;if(J){var we=K._associatedDocument;d.Guard.isDocumentNode(we)&&(ee=we)}var Ce=null,De=C.tree_retarget(z._relatedTarget,K);if(K!==De||K===z._relatedTarget){var Re=[];try{for(var Oe=a(z._touchTargetList),Ve=Oe.next();!Ve.done;Ve=Oe.next()){var Ge=Ve.value;Re.push(C.tree_retarget(Ge,K))}}catch(et){re={error:et}}finally{try{Ve&&!Ve.done&&(fe=Oe.return)&&fe.call(Oe)}finally{if(re)throw re.error}}b(z,K,ee,De,Re,!1);var qe=d.Guard.isMouseEvent(z)&&z._type==="click";qe&&K._activationBehavior!==void 0&&(Ce=K);for(var Be=d.Guard.isSlotable(K)&&x.shadowTree_isAssigned(K)?K:null,ae=!1,H=K._getTheParent(z);H!==null&&d.Guard.isNode(H);){if(Be!==null){if(!d.Guard.isSlot(H))throw new Error("Parent node of a slotable should be a slot.");Be=null;var ce=C.tree_rootNode(H,!0);d.Guard.isShadowRoot(ce)&&ce._mode==="closed"&&(ae=!0)}d.Guard.isSlotable(H)&&x.shadowTree_isAssigned(H)&&(Be=H),De=C.tree_retarget(z._relatedTarget,H),Re=[];try{for(var se=(pe=void 0,a(z._touchTargetList)),he=se.next();!he.done;he=se.next())Ge=he.value,Re.push(C.tree_retarget(Ge,H))}catch(et){pe={error:et}}finally{try{he&&!he.done&&(ie=se.return)&&ie.call(se)}finally{if(pe)throw pe.error}}d.Guard.isWindow(H)||d.Guard.isNode(H)&&d.Guard.isNode(K)&&C.tree_isAncestorOf(C.tree_rootNode(K,!0),H,!0,!0)?(qe&&z._bubbles&&Ce===null&&H._activationBehavior&&(Ce=H),b(z,H,null,De,Re,ae)):H===De?H=null:(K=H,qe&&Ce===null&&K._activationBehavior&&(Ce=K),b(z,H,K,De,Re,ae)),H!==null&&(H=H._getTheParent(z)),ae=!1}for(var ve=null,ye=z._path,Ae=ye.length-1;Ae>=0;Ae--)if((Je=ye[Ae]).shadowAdjustedTarget!==null){ve=Je;break}if(ve!==null)if(d.Guard.isNode(ve.shadowAdjustedTarget)&&d.Guard.isShadowRoot(C.tree_rootNode(ve.shadowAdjustedTarget,!0)))te=!0;else if(d.Guard.isNode(ve.relatedTarget)&&d.Guard.isShadowRoot(C.tree_rootNode(ve.relatedTarget,!0)))te=!0;else for(var Ue=0;Ue<ve.touchTargetList.length;Ue++){var Je=ve.touchTargetList[Ue];if(d.Guard.isNode(Je)&&d.Guard.isShadowRoot(C.tree_rootNode(Je,!0))){te=!0;break}}for(Ce!==null&&Ce._legacyPreActivationBehavior!==void 0&&Ce._legacyPreActivationBehavior(z),Ae=ye.length-1;Ae>=0;Ae--)(Je=ye[Ae]).shadowAdjustedTarget!==null?z._eventPhase=c.EventPhase.AtTarget:z._eventPhase=c.EventPhase.Capturing,M(Je,z,"capturing",X);for(Ae=0;Ae<ye.length;Ae++){if((Je=ye[Ae]).shadowAdjustedTarget!==null)z._eventPhase=c.EventPhase.AtTarget;else{if(!z._bubbles)continue;z._eventPhase=c.EventPhase.Bubbling}M(Je,z,"bubbling",X)}}return z._eventPhase=c.EventPhase.None,z._currentTarget=null,z._path=[],z._dispatchFlag=!1,z._stopPropagationFlag=!1,z._stopImmediatePropagationFlag=!1,te&&(z._target=null,z._relatedTarget=null,z._touchTargetList=[]),Ce!==null&&(z._canceledFlag||Ce._activationBehavior===void 0?Ce._legacyCanceledActivationBehavior!==void 0&&Ce._legacyCanceledActivationBehavior(z):Ce._activationBehavior(z)),!z._canceledFlag}function b(z,K,J,X,re,fe){var pe=!1;d.Guard.isNode(K)&&d.Guard.isShadowRoot(C.tree_rootNode(K))&&(pe=!0);var ie=!1;d.Guard.isShadowRoot(K)&&K._mode==="closed"&&(ie=!0),z._path.push({invocationTarget:K,invocationTargetInShadowTree:pe,shadowAdjustedTarget:J,relatedTarget:X,touchTargetList:re,rootOfClosedTree:ie,slotInClosedTree:fe})}function M(z,K,J,X){X===void 0&&(X={value:!1});for(var re=K._path,fe=-1,pe=0;pe<re.length;pe++)if(re[pe]===z){fe=pe;break}if(fe!==-1){var ie=re[fe];(ie.shadowAdjustedTarget!==null||fe>0&&(ie=re[fe-1]).shadowAdjustedTarget!==null)&&(K._target=ie.shadowAdjustedTarget)}if(K._relatedTarget=z.relatedTarget,K._touchTargetList=z.touchTargetList,!K._stopPropagationFlag){K._currentTarget=z.invocationTarget;var te=K._currentTarget._eventListenerList,ee=new(Array.bind.apply(Array,s([void 0],te)));if(!I(K,ee,J,z,X)&&K._isTrusted){var we=K._type;we==="animationend"?K._type="webkitAnimationEnd":we==="animationiteration"?K._type="webkitAnimationIteration":we==="animationstart"?K._type="webkitAnimationStart":we==="transitionend"&&(K._type="webkitTransitionEnd"),I(K,ee,J,z,X),K._type=we}}}function I(z,K,J,X,re){re===void 0&&(re={value:!1});for(var fe=!1,pe=0;pe<K.length;pe++){var ie=K[pe];if(!ie.removed){if(z._type!==ie.type||(fe=!0,J==="capturing"&&!ie.capture)||J==="bubbling"&&ie.capture)continue;if(ie.once&&z._currentTarget!==null){for(var te=z._currentTarget,ee=-1,we=0;we<te._eventListenerList.length;we++)if(te._eventListenerList[we]===ie){ee=we;break}ee!==-1&&te._eventListenerList.splice(ee,1)}var Ce=void 0,De=void 0;d.Guard.isWindow(Ce)&&(De=Ce._currentEvent,X.invocationTargetInShadowTree===!1&&(Ce._currentEvent=z)),ie.passive&&(z._inPassiveListenerFlag=!0);try{ie.callback.handleEvent.call(z._currentTarget,z)}catch{re.value=!0}if(ie.passive&&(z._inPassiveListenerFlag=!1),d.Guard.isWindow(Ce)&&(Ce._currentEvent=De),z._stopImmediatePropagationFlag)return fe}}return fe}function A(z,K){return null}function k(z,K){return null}function U(z,K){}function B(z,K){}r.event_setTheCanceledFlag=function(z){z._cancelable&&!z._inPassiveListenerFlag&&(z._canceledFlag=!0)},r.event_initialize=function(z,K,J,X){z._initializedFlag=!0,z._stopPropagationFlag=!1,z._stopImmediatePropagationFlag=!1,z._canceledFlag=!1,z._isTrusted=!1,z._target=null,z._type=K,z._bubbles=J,z._cancelable=X},r.event_createAnEvent=_,r.event_innerEventCreationSteps=y,r.event_dispatch=w,r.event_appendToAnEventPath=b,r.event_invoke=M,r.event_innerInvoke=I,r.event_fireAnEvent=function(z,K,J,X,re){J===void 0&&(J=h.EventImpl);var fe=_(J);if(fe._type=z,X)for(var pe in X)fe[pe]=X[pe];return w(fe,K,re)},r.event_createLegacyEvent=function(z){var K=null;switch(z.toLowerCase()){case"beforeunloadevent":case"compositionevent":break;case"customevent":K=f.CustomEventImpl;break;case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"event":case"events":K=h.EventImpl}if(K===null)throw new p.NotSupportedError("Event constructor not found for interface "+z+".");var J=new K("");return J._type="",J._timeStamp=new Date().getTime(),J._isTrusted=!1,J._initializedFlag=!1,J},r.event_getterEventHandlerIDLAttribute=function(z,K){return null},r.event_setterEventHandlerIDLAttribute=function(z,K,J){},r.event_determineTheTargetOfAnEventHandler=A,r.event_getTheCurrentValueOfAnEventHandler=k,r.event_activateAnEventHandler=U,r.event_deactivateAnEventHandler=B},function(n,r,i){var a,o=this&&this.__extends||(a=function(b,M){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,A){I.__proto__=A}||function(I,A){for(var k in A)A.hasOwnProperty(k)&&(I[k]=A[k])})(b,M)},function(b,M){function I(){this.constructor=b}a(b,M),b.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}),s=this&&this.__values||function(b){var M=typeof Symbol=="function"&&Symbol.iterator,I=M&&b[M],A=0;if(I)return I.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&A>=b.length&&(b=void 0),{value:b&&b[A++],done:!b}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__read||function(b,M){var I=typeof Symbol=="function"&&b[Symbol.iterator];if(!I)return b;var A,k,U=I.call(b),B=[];try{for(;(M===void 0||M-- >0)&&!(A=U.next()).done;)B.push(A.value)}catch(z){k={error:z}}finally{try{A&&!A.done&&(I=U.return)&&I.call(U)}finally{if(k)throw k.error}}return B};Object.defineProperty(r,"__esModule",{value:!0});var c=i(6),d=i(2),f=i(9),h=i(34),p=i(3),C=i(1),x=i(7),T=i(152),_=i(0),y=i(12),w=function(b){function M(){var I=b.call(this)||this;return I._children=new Set,I._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},I._contentType="application/xml",I._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},I._origin=null,I._type="xml",I._mode="no-quirks",I._documentElement=null,I._hasNamespaces=!1,I._nodeDocumentOverwrite=null,I}return o(M,b),Object.defineProperty(M.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(I){this._nodeDocumentOverwrite=I},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=_.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"URL",{get:function(){return T.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"compatMode",{get:function(){return this._mode==="quirks"?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"doctype",{get:function(){var I,A;try{for(var k=s(this._children),U=k.next();!U.done;U=k.next()){var B=U.value;if(p.Guard.isDocumentTypeNode(B))return B}}catch(z){I={error:z}}finally{try{U&&!U.done&&(A=k.return)&&A.call(k)}finally{if(I)throw I.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),M.prototype.getElementsByTagName=function(I){return _.node_listOfElementsWithQualifiedName(I,this)},M.prototype.getElementsByTagNameNS=function(I,A){return _.node_listOfElementsWithNamespace(I,A,this)},M.prototype.getElementsByClassName=function(I){return _.node_listOfElementsWithClassNames(I,this)},M.prototype.createElement=function(I,A){if(!_.xml_isName(I))throw new f.InvalidCharacterError;this._type==="html"&&(I=I.toLowerCase());var k=null;A!==void 0&&(k=C.isString(A)?A:A.is);var U=this._type==="html"||this._contentType==="application/xhtml+xml"?x.namespace.HTML:null;return _.element_createAnElement(this,I,U,null,k,!0)},M.prototype.createElementNS=function(I,A,k){return _.document_internalCreateElementNS(this,I,A,k)},M.prototype.createDocumentFragment=function(){return _.create_documentFragment(this)},M.prototype.createTextNode=function(I){return _.create_text(this,I)},M.prototype.createCDATASection=function(I){if(this._type==="html")throw new f.NotSupportedError;if(I.indexOf("]]>")!==-1)throw new f.InvalidCharacterError;return _.create_cdataSection(this,I)},M.prototype.createComment=function(I){return _.create_comment(this,I)},M.prototype.createProcessingInstruction=function(I,A){if(!_.xml_isName(I))throw new f.InvalidCharacterError;if(A.indexOf("?>")!==-1)throw new f.InvalidCharacterError;return _.create_processingInstruction(this,I,A)},M.prototype.importNode=function(I,A){if(A===void 0&&(A=!1),p.Guard.isDocumentNode(I)||p.Guard.isShadowRoot(I))throw new f.NotSupportedError;return _.node_clone(I,this,A)},M.prototype.adoptNode=function(I){if(p.Guard.isDocumentNode(I))throw new f.NotSupportedError;if(p.Guard.isShadowRoot(I))throw new f.HierarchyRequestError;return _.document_adopt(I,this),I},M.prototype.createAttribute=function(I){if(!_.xml_isName(I))throw new f.InvalidCharacterError;return this._type==="html"&&(I=I.toLowerCase()),_.create_attr(this,I)},M.prototype.createAttributeNS=function(I,A){var k=l(_.namespace_validateAndExtract(I,A),3),U=k[0],B=k[1],z=k[2],K=_.create_attr(this,z);return K._namespace=U,K._namespacePrefix=B,K},M.prototype.createEvent=function(I){return _.event_createLegacyEvent(I)},M.prototype.createRange=function(){var I=_.create_range();return I._start=[this,0],I._end=[this,0],I},M.prototype.createNodeIterator=function(I,A,k){A===void 0&&(A=d.WhatToShow.All),k===void 0&&(k=null);var U=_.create_nodeIterator(I,I,!0);return U._whatToShow=A,U._iteratorCollection=_.create_nodeList(I),C.isFunction(k)?(U._filter=_.create_nodeFilter(),U._filter.acceptNode=k):U._filter=k,U},M.prototype.createTreeWalker=function(I,A,k){A===void 0&&(A=d.WhatToShow.All),k===void 0&&(k=null);var U=_.create_treeWalker(I,I);return U._whatToShow=A,C.isFunction(k)?(U._filter=_.create_nodeFilter(),U._filter.acceptNode=k):U._filter=k,U},M.prototype._getTheParent=function(I){return I._type==="load"?null:c.dom.window},M.prototype.getElementById=function(I){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(M.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),M.prototype.prepend=function(){for(var I=[],A=0;A<arguments.length;A++)I[A]=arguments[A];throw new Error("Mixin: ParentNode not implemented.")},M.prototype.append=function(){for(var I=[],A=0;A<arguments.length;A++)I[A]=arguments[A];throw new Error("Mixin: ParentNode not implemented.")},M.prototype.querySelector=function(I){throw new Error("Mixin: ParentNode not implemented.")},M.prototype.querySelectorAll=function(I){throw new Error("Mixin: ParentNode not implemented.")},M}(h.NodeImpl);r.DocumentImpl=w,y.idl_defineConst(w.prototype,"_nodeType",d.NodeType.Document)},function(n,r,i){var a,o=this&&this.__extends||(a=function(T,_){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,w){y.__proto__=w}||function(y,w){for(var b in w)w.hasOwnProperty(b)&&(y[b]=w[b])})(T,_)},function(T,_){function y(){this.constructor=T}a(T,_),T.prototype=_===null?Object.create(_):(y.prototype=_.prototype,new y)}),s=this&&this.__values||function(T){var _=typeof Symbol=="function"&&Symbol.iterator,y=_&&T[_],w=0;if(y)return y.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&w>=T.length&&(T=void 0),{value:T&&T[w++],done:!T}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__read||function(T,_){var y=typeof Symbol=="function"&&T[Symbol.iterator];if(!y)return T;var w,b,M=y.call(T),I=[];try{for(;(_===void 0||_-- >0)&&!(w=M.next()).done;)I.push(w.value)}catch(A){b={error:A}}finally{try{w&&!w.done&&(y=M.return)&&y.call(M)}finally{if(b)throw b.error}}return I};Object.defineProperty(r,"__esModule",{value:!0});var c=i(2),d=i(34),f=i(9),h=i(7),p=i(0),C=i(12),x=function(T){function _(){var y=T.call(this)||this;return y._children=new Set,y._namespace=null,y._namespacePrefix=null,y._localName="",y._customElementState="undefined",y._customElementDefinition=null,y._is=null,y._shadowRoot=null,y._attributeList=p.create_namedNodeMap(y),y._attributeChangeSteps=[],y._name="",y._assignedSlot=null,y}return o(_,T),Object.defineProperty(_.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"id",{get:function(){return p.element_getAnAttributeValue(this,"id")},set:function(y){p.element_setAnAttributeValue(this,"id",y)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"className",{get:function(){return p.element_getAnAttributeValue(this,"class")},set:function(y){p.element_setAnAttributeValue(this,"class",y)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"classList",{get:function(){var y=p.element_getAnAttributeByName("class",this);return y===null&&(y=p.create_attr(this._nodeDocument,"class")),p.create_domTokenList(this,y)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"slot",{get:function(){return p.element_getAnAttributeValue(this,"slot")},set:function(y){p.element_setAnAttributeValue(this,"slot",y)},enumerable:!0,configurable:!0}),_.prototype.hasAttributes=function(){return this._attributeList.length!==0},Object.defineProperty(_.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),_.prototype.getAttributeNames=function(){var y,w,b=[];try{for(var M=s(this._attributeList),I=M.next();!I.done;I=M.next()){var A=I.value;b.push(A._qualifiedName)}}catch(k){y={error:k}}finally{try{I&&!I.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}return b},_.prototype.getAttribute=function(y){var w=p.element_getAnAttributeByName(y,this);return w?w._value:null},_.prototype.getAttributeNS=function(y,w){var b=p.element_getAnAttributeByNamespaceAndLocalName(y,w,this);return b?b._value:null},_.prototype.setAttribute=function(y,w){if(!p.xml_isName(y))throw new f.InvalidCharacterError;this._namespace===h.namespace.HTML&&this._nodeDocument._type==="html"&&(y=y.toLowerCase());for(var b=null,M=0;M<this._attributeList.length;M++){var I=this._attributeList[M];if(I._qualifiedName===y){b=I;break}}if(b===null)return(b=p.create_attr(this._nodeDocument,y))._value=w,void p.element_append(b,this);p.element_change(b,this,w)},_.prototype.setAttributeNS=function(y,w,b){var M=l(p.namespace_validateAndExtract(y,w),3),I=M[0],A=M[1],k=M[2];p.element_setAnAttributeValue(this,k,b,A,I)},_.prototype.removeAttribute=function(y){p.element_removeAnAttributeByName(y,this)},_.prototype.removeAttributeNS=function(y,w){p.element_removeAnAttributeByNamespaceAndLocalName(y,w,this)},_.prototype.hasAttribute=function(y){this._namespace===h.namespace.HTML&&this._nodeDocument._type==="html"&&(y=y.toLowerCase());for(var w=0;w<this._attributeList.length;w++)if(this._attributeList[w]._qualifiedName===y)return!0;return!1},_.prototype.toggleAttribute=function(y,w){if(!p.xml_isName(y))throw new f.InvalidCharacterError;this._namespace===h.namespace.HTML&&this._nodeDocument._type==="html"&&(y=y.toLowerCase());for(var b=null,M=0;M<this._attributeList.length;M++){var I=this._attributeList[M];if(I._qualifiedName===y){b=I;break}}return b===null?(w===void 0||w===!0)&&((b=p.create_attr(this._nodeDocument,y))._value="",p.element_append(b,this),!0):w!==void 0&&w!==!1||(p.element_removeAnAttributeByName(y,this),!1)},_.prototype.hasAttributeNS=function(y,w){for(var b=y||null,M=0;M<this._attributeList.length;M++){var I=this._attributeList[M];if(I._namespace===b&&I._localName===w)return!0}return!1},_.prototype.getAttributeNode=function(y){return p.element_getAnAttributeByName(y,this)},_.prototype.getAttributeNodeNS=function(y,w){return p.element_getAnAttributeByNamespaceAndLocalName(y,w,this)},_.prototype.setAttributeNode=function(y){return p.element_setAnAttribute(y,this)},_.prototype.setAttributeNodeNS=function(y){return p.element_setAnAttribute(y,this)},_.prototype.removeAttributeNode=function(y){for(var w=!1,b=0;b<this._attributeList.length;b++)if(this._attributeList[b]===y){w=!0;break}if(!w)throw new f.NotFoundError;return p.element_remove(y,this),y},_.prototype.attachShadow=function(y){if(this._namespace!==h.namespace.HTML)throw new f.NotSupportedError;if(!p.customElement_isValidCustomElementName(this._localName)&&!p.customElement_isValidShadowHostName(this._localName))throw new f.NotSupportedError;if(p.customElement_isValidCustomElementName(this._localName)||this._is!==null){var w=p.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(w!==null&&w.disableShadow===!0)throw new f.NotSupportedError}if(this._shadowRoot!==null)throw new f.NotSupportedError;var b=p.create_shadowRoot(this._nodeDocument,this);return b._mode=y.mode,this._shadowRoot=b,b},Object.defineProperty(_.prototype,"shadowRoot",{get:function(){var y=this._shadowRoot;return y===null||y.mode==="closed"?null:y},enumerable:!0,configurable:!0}),_.prototype.closest=function(y){throw new f.NotImplementedError},_.prototype.matches=function(y){throw new f.NotImplementedError},_.prototype.webkitMatchesSelector=function(y){return this.matches(y)},_.prototype.getElementsByTagName=function(y){return p.node_listOfElementsWithQualifiedName(y,this)},_.prototype.getElementsByTagNameNS=function(y,w){return p.node_listOfElementsWithNamespace(y,w,this)},_.prototype.getElementsByClassName=function(y){return p.node_listOfElementsWithClassNames(y,this)},_.prototype.insertAdjacentElement=function(y,w){return p.element_insertAdjacent(this,y,w)},_.prototype.insertAdjacentText=function(y,w){var b=p.create_text(this._nodeDocument,w);p.element_insertAdjacent(this,y,b)},Object.defineProperty(_.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"_htmlUppercasedQualifiedName",{get:function(){var y=this._qualifiedName;return this._namespace===h.namespace.HTML&&this._nodeDocument._type==="html"&&(y=y.toUpperCase()),y},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),_.prototype.prepend=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];throw new Error("Mixin: ParentNode not implemented.")},_.prototype.append=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];throw new Error("Mixin: ParentNode not implemented.")},_.prototype.querySelector=function(y){throw new Error("Mixin: ParentNode not implemented.")},_.prototype.querySelectorAll=function(y){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(_.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),_.prototype.before=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];throw new Error("Mixin: ChildNode not implemented.")},_.prototype.after=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];throw new Error("Mixin: ChildNode not implemented.")},_.prototype.replaceWith=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];throw new Error("Mixin: ChildNode not implemented.")},_.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(_.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),_._create=function(y,w,b,M){b===void 0&&(b=null),M===void 0&&(M=null);var I=new _;return I._localName=w,I._namespace=b,I._namespacePrefix=M,I._nodeDocument=y,I},_}(d.NodeImpl);r.ElementImpl=x,C.idl_defineConst(x.prototype,"_nodeType",c.NodeType.Element)},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(34),c=i(12),d=function(f){function h(p){p===void 0&&(p=null);var C=f.call(this)||this;return C._children=new Set,C._host=p,C}return o(h,f),h.prototype.getElementById=function(p){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(h.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),h.prototype.prepend=function(){for(var p=[],C=0;C<arguments.length;C++)p[C]=arguments[C];throw new Error("Mixin: ParentNode not implemented.")},h.prototype.append=function(){for(var p=[],C=0;C<arguments.length;C++)p[C]=arguments[C];throw new Error("Mixin: ParentNode not implemented.")},h.prototype.querySelector=function(p){throw new Error("Mixin: ParentNode not implemented.")},h.prototype.querySelectorAll=function(p){throw new Error("Mixin: ParentNode not implemented.")},h._create=function(p,C){C===void 0&&(C=null);var x=new h(C);return x._nodeDocument=p,x},h}(l.NodeImpl);r.DocumentFragmentImpl=d,c.idl_defineConst(d.prototype,"_nodeType",s.NodeType.DocumentFragment)},function(n,r,i){var a,o=this&&this.__extends||(a=function(p,C){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,T){x.__proto__=T}||function(x,T){for(var _ in T)T.hasOwnProperty(_)&&(x[_]=T[_])})(p,C)},function(p,C){function x(){this.constructor=p}a(p,C),p.prototype=C===null?Object.create(C):(x.prototype=C.prototype,new x)}),s=this&&this.__values||function(p){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&p[C],T=0;if(x)return x.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&T>=p.length&&(p=void 0),{value:p&&p[T++],done:!p}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(2),c=i(71),d=i(0),f=i(12),h=function(p){function C(x){x===void 0&&(x="");var T=p.call(this,x)||this;return T._name="",T._assignedSlot=null,T}return o(C,p),Object.defineProperty(C.prototype,"wholeText",{get:function(){var x,T,_="";try{for(var y=s(d.text_contiguousTextNodes(this,!0)),w=y.next();!w.done;w=y.next())_+=w.value._data}catch(b){x={error:b}}finally{try{w&&!w.done&&(T=y.return)&&T.call(y)}finally{if(x)throw x.error}}return _},enumerable:!0,configurable:!0}),C.prototype.splitText=function(x){return d.text_split(this,x)},Object.defineProperty(C.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),C._create=function(x,T){T===void 0&&(T="");var _=new C(T);return _._nodeDocument=x,_},C}(c.CharacterDataImpl);r.TextImpl=h,f.idl_defineConst(h.prototype,"_nodeType",l.NodeType.Text)},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(){}return Object.defineProperty(o.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),o}();r.AbstractRangeImpl=a},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=function(){function s(l){this._activeFlag=!1,this._root=l,this._whatToShow=a.WhatToShow.All,this._filter=null}return Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),s}();r.TraverserImpl=o},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=i(0),s=i(12),l=function(){function c(d,f){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=a.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=d,f&&(this._bubbles=f.bubbles||!1,this._cancelable=f.cancelable||!1,this._composedFlag=f.composed||!1),this._initializedFlag=!0,this._timeStamp=new Date().getTime()}return Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),c.prototype.composedPath=function(){var d=[],f=this._path;if(f.length===0)return d;var h=this._currentTarget;if(h===null)throw new Error("Event currentTarget is null.");d.push(h);for(var p=0,C=0,x=f.length-1;x>=0;){if(f[x].rootOfClosedTree&&C++,f[x].invocationTarget===h){p=x;break}f[x].slotInClosedTree&&C--,x--}var T=C,_=C;for(x=p-1;x>=0;)f[x].rootOfClosedTree&&T++,T<=_&&d.unshift(f[x].invocationTarget),f[x].slotInClosedTree&&--T<_&&(_=T),x--;for(T=C,_=C,x=p+1;x<f.length;)f[x].slotInClosedTree&&T++,T<=_&&d.push(f[x].invocationTarget),f[x].rootOfClosedTree&&--T<_&&(_=T),x++;return d},Object.defineProperty(c.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),c.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(c.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(d){d&&this.stopPropagation()},enumerable:!0,configurable:!0}),c.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(c.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(d){d||o.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),c.prototype.preventDefault=function(){o.event_setTheCanceledFlag(this)},Object.defineProperty(c.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),c.prototype.initEvent=function(d,f,h){f===void 0&&(f=!1),h===void 0&&(h=!1),this._dispatchFlag||o.event_initialize(this,d,f,h)},c.NONE=0,c.CAPTURING_PHASE=1,c.AT_TARGET=2,c.BUBBLING_PHASE=3,c}();r.EventImpl=l,s.idl_defineConst(l.prototype,"NONE",0),s.idl_defineConst(l.prototype,"CAPTURING_PHASE",1),s.idl_defineConst(l.prototype,"AT_TARGET",2),s.idl_defineConst(l.prototype,"BUBBLING_PHASE",3)},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=i(9);r.traversal_filter=function(s,l){if(s._activeFlag)throw new o.InvalidStateError;var c=1<<l._nodeType-1;if(!(s.whatToShow&c))return a.FilterResult.Skip;if(!s.filter)return a.FilterResult.Accept;s._activeFlag=!0;var d=a.FilterResult.Reject;try{d=s.filter.acceptNode(l)}catch(f){throw s._activeFlag=!1,f}return s._activeFlag=!1,d}},function(n,r,i){var a=this&&this.__read||function(_,y){var w=typeof Symbol=="function"&&_[Symbol.iterator];if(!w)return _;var b,M,I=w.call(_),A=[];try{for(;(y===void 0||y-- >0)&&!(b=I.next()).done;)A.push(b.value)}catch(k){M={error:k}}finally{try{b&&!b.done&&(w=I.return)&&w.call(I)}finally{if(M)throw M.error}}return A},o=this&&this.__values||function(_){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&_[y],b=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&b>=_.length&&(_=void 0),{value:_&&_[b++],done:!_}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=i(6),l=i(3),c=i(1),d=i(99),f=i(73),h=i(17),p=i(173),C=i(30),x=i(52),T=i(37);r.document_elementInterface=function(_,y){return d.ElementImpl},r.document_internalCreateElementNS=function(_,y,w,b){var M=a(p.namespace_validateAndExtract(y,w),3),I=M[0],A=M[1],k=M[2],U=null;return b!==void 0&&(U=c.isString(b)?b:b.is),x.element_createAnElement(_,k,I,A,U,!0)},r.document_adopt=function(_,y){var w,b;if(_._nodeDocument!==y||_._parent!==null){var M=_._nodeDocument;if(_._parent&&T.mutation_remove(_,_._parent),y!==M)for(var I=h.tree_getFirstDescendantNode(_,!0,!0);I!==null;){if(I._nodeDocument=y,l.Guard.isElementNode(I))try{for(var A=(w=void 0,o(I._attributeList._asArray())),k=A.next();!k.done;k=A.next())k.value._nodeDocument=y}catch(U){w={error:U}}finally{try{k&&!k.done&&(b=A.return)&&b.call(A)}finally{if(w)throw w.error}}s.dom.features.customElements&&l.Guard.isElementNode(I)&&I._customElementState==="custom"&&f.customElement_enqueueACustomElementCallbackReaction(I,"adoptedCallback",[M,y]),s.dom.features.steps&&C.dom_runAdoptingSteps(I,M),I=h.tree_getNextDescendantNode(_,I,!0,!0)}}}},function(n,r,i){var a=this&&this.__values||function(h){var p=typeof Symbol=="function"&&Symbol.iterator,C=p&&h[p],x=0;if(C)return C.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&x>=h.length&&(h=void 0),{value:h&&h[x++],done:!h}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(3),l=i(9),c=i(17),d=i(51),f=i(30);r.characterData_replaceData=function(h,p,C,x){var T,_,y=c.tree_nodeLength(h);if(p>y)throw new l.IndexSizeError("Offset exceeds character data length. Offset: "+p+", Length: "+y+", Node is "+h.nodeName+".");p+C>y&&(C=y-p),o.dom.features.mutationObservers&&d.observer_queueMutationRecord("characterData",h,null,null,h._data,[],[],null,null);var w=h._data.substring(0,p)+x+h._data.substring(p+C);h._data=w;try{for(var b=a(o.dom.rangeList),M=b.next();!M.done;M=b.next()){var I=M.value;I._start[0]===h&&I._start[1]>p&&I._start[1]<=p+C&&(I._start[1]=p),I._end[0]===h&&I._end[1]>p&&I._end[1]<=p+C&&(I._end[1]=p),I._start[0]===h&&I._start[1]>p+C&&(I._start[1]+=x.length-C),I._end[0]===h&&I._end[1]>p+C&&(I._end[1]+=x.length-C)}}catch(A){T={error:A}}finally{try{M&&!M.done&&(_=b.return)&&_.call(b)}finally{if(T)throw T.error}}o.dom.features.steps&&s.Guard.isTextNode(h)&&h._parent!==null&&f.dom_runChildTextContentChangeSteps(h._parent)},r.characterData_substringData=function(h,p,C){var x=c.tree_nodeLength(h);if(p>x)throw new l.IndexSizeError("Offset exceeds character data length. Offset: "+p+", Length: "+x+", Node is "+h.nodeName+".");return p+C>x?h._data.substr(p):h._data.substr(p,C)}},function(n,r,i){var a=this&&this.__read||function(f,h){var p=typeof Symbol=="function"&&f[Symbol.iterator];if(!p)return f;var C,x,T=p.call(f),_=[];try{for(;(h===void 0||h-- >0)&&!(C=T.next()).done;)_.push(C.value)}catch(y){x={error:y}}finally{try{C&&!C.done&&(p=T.return)&&p.call(T)}finally{if(x)throw x.error}}return _},o=this&&this.__spread||function(){for(var f=[],h=0;h<arguments.length;h++)f=f.concat(a(arguments[h]));return f},s=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(7);function c(f){var h=l.string.splitAStringOnASCIIWhitespace(f);return new Set(h)}function d(f){return o(f).join(" ")}r.orderedSet_parse=c,r.orderedSet_serialize=d,r.orderedSet_sanitize=function(f){return d(c(f))},r.orderedSet_contains=function(f,h,p){var C,x,T,_;try{for(var y=s(h),w=y.next();!w.done;w=y.next()){var b=w.value,M=!1;try{for(var I=(T=void 0,s(f)),A=I.next();!A.done;A=I.next()){var k=A.value;if(p){if(k===b){M=!0;break}}else if(k.toUpperCase()===b.toUpperCase()){M=!0;break}}}catch(U){T={error:U}}finally{try{A&&!A.done&&(_=I.return)&&_.call(I)}finally{if(T)throw T.error}}if(!M)return!1}}catch(U){C={error:U}}finally{try{w&&!w.done&&(x=y.return)&&x.call(y)}finally{if(C)throw C.error}}return!0}},function(n,r,i){i(179),Object.defineProperty(r,"__esModule",{value:!0});var a=i(262),o=i(110),s=i(1);o.dom.setFeatures(!1),r.createDocument=function(){var l=new a.DOMImplementation().createDocument(null,"root",null);return l.documentElement&&l.removeChild(l.documentElement),l},r.sanitizeInput=function(l,c){if(l==null)return l;if(c===void 0)return l+"";var d="";l+="";for(var f=0;f<l.length;f++){var h=l.charCodeAt(f);if(h===9||h===10||h===13||h>=32&&h<=55295||h>=57344&&h<=65533)d+=l.charAt(f);else if(h>=55296&&h<=56319&&f<l.length-1){var p=l.charCodeAt(f+1);p>=56320&&p<=57343?(h=1024*(h-55296)+p-56320+65536,d+=String.fromCodePoint(h),f++):d+=s.isString(c)?c:c(l.charAt(f),f,l)}else d+=s.isString(c)?c:c(l.charAt(f),f,l)}return d}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(1),o=i(153);r.AbortController=o.AbortControllerImpl;var s=i(154);r.AbortSignal=s.AbortSignalImpl;var l=i(102);r.AbstractRange=l.AbstractRangeImpl;var c=i(157);r.Attr=c.AttrImpl;var d=i(158);r.CDATASection=d.CDATASectionImpl;var f=i(71);r.CharacterData=f.CharacterDataImpl;var h=i(263),p=i(159);r.Comment=p.CommentImpl;var C=i(171);r.CustomEvent=C.CustomEventImpl;var x=i(100);r.DocumentFragment=x.DocumentFragmentImpl;var T=i(98);r.Document=T.DocumentImpl;var _=i(264),y=i(155);r.DocumentType=y.DocumentTypeImpl;var w=i(6);r.dom=w.dom;var b=i(148);r.DOMImplementation=b.DOMImplementationImpl;var M=i(170);r.DOMTokenList=M.DOMTokenListImpl;var I=i(99);r.Element=I.ElementImpl;var A=i(104);r.Event=A.EventImpl;var k=i(70);r.EventTarget=k.EventTargetImpl;var U=i(161);r.HTMLCollection=U.HTMLCollectionImpl;var B=i(265);r.MutationObserver=B.MutationObserverImpl;var z=i(169);r.MutationRecord=z.MutationRecordImpl;var K=i(164);r.NamedNodeMap=K.NamedNodeMapImpl;var J=i(168);r.NodeFilter=J.NodeFilterImpl;var X=i(34);r.Node=X.NodeImpl;var re=i(166);r.NodeIterator=re.NodeIteratorImpl;var fe=i(162);r.NodeList=fe.NodeListImpl;var pe=i(163);r.NodeListStatic=pe.NodeListStaticImpl;var ie=i(266),te=i(267),ee=i(268),we=i(160);r.ProcessingInstruction=we.ProcessingInstructionImpl;var Ce=i(165);r.Range=Ce.RangeImpl;var De=i(156);r.ShadowRoot=De.ShadowRootImpl;var Re=i(269),Oe=i(270);r.StaticRange=Oe.StaticRangeImpl;var Ve=i(101);r.Text=Ve.TextImpl;var Ge=i(103);r.Traverser=Ge.TraverserImpl;var qe=i(167);r.TreeWalker=qe.TreeWalkerImpl;var Be=i(149);r.Window=Be.WindowImpl;var ae=i(151);r.XMLDocument=ae.XMLDocumentImpl,a.applyMixin(I.ElementImpl,h.ChildNodeImpl),a.applyMixin(f.CharacterDataImpl,h.ChildNodeImpl),a.applyMixin(y.DocumentTypeImpl,h.ChildNodeImpl),a.applyMixin(T.DocumentImpl,_.DocumentOrShadowRootImpl),a.applyMixin(De.ShadowRootImpl,_.DocumentOrShadowRootImpl),a.applyMixin(I.ElementImpl,ie.NonDocumentTypeChildNodeImpl),a.applyMixin(f.CharacterDataImpl,ie.NonDocumentTypeChildNodeImpl),a.applyMixin(T.DocumentImpl,te.NonElementParentNodeImpl),a.applyMixin(x.DocumentFragmentImpl,te.NonElementParentNodeImpl),a.applyMixin(T.DocumentImpl,ee.ParentNodeImpl),a.applyMixin(x.DocumentFragmentImpl,ee.ParentNodeImpl),a.applyMixin(I.ElementImpl,ee.ParentNodeImpl),a.applyMixin(Ve.TextImpl,Re.SlotableImpl),a.applyMixin(I.ElementImpl,Re.SlotableImpl)},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),function(a){a[a.EOF=0]="EOF",a[a.Declaration=1]="Declaration",a[a.DocType=2]="DocType",a[a.Element=3]="Element",a[a.Text=4]="Text",a[a.CDATA=5]="CDATA",a[a.PI=6]="PI",a[a.Comment=7]="Comment",a[a.ClosingTag=8]="ClosingTag"}(r.TokenType||(r.TokenType={}))},function(n,r,i){i(64),i(20),i(66);var a,o=this&&this.__extends||(a=function(c,d){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var p in h)h.hasOwnProperty(p)&&(f[p]=h[p])})(c,d)},function(c,d){function f(){this.constructor=c}a(c,d),c.prototype=d===null?Object.create(d):(f.prototype=d.prototype,new f)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(1),l=function(c){function d(){return c!==null&&c.apply(this,arguments)||this}return o(d,c),d.prototype._parse=function(f,h){var p=this,C=this._builderOptions,x=null;return s.isFunction(h)?x=this.parse(f,h.apply(this)):s.isArray(h)||s.isSet(h)?s.forEachArray(h,function(T){return x=p.parse(f,T)},this):s.isMap(h)||s.isObject(h)?s.forEachObject(h,function(T,_){if(s.isFunction(_)&&(_=_.apply(p)),C.ignoreConverters||T.indexOf(C.convert.att)!==0)if(C.ignoreConverters||T.indexOf(C.convert.text)!==0)if(C.ignoreConverters||T.indexOf(C.convert.cdata)!==0)if(C.ignoreConverters||T.indexOf(C.convert.comment)!==0)if(C.ignoreConverters||T.indexOf(C.convert.ins)!==0){if(!((s.isArray(_)||s.isSet(_))&&s.isEmpty(_))){if((s.isMap(_)||s.isObject(_))&&s.isEmpty(_))x=p.element(f,void 0,p.sanitize(T))||x;else if(C.keepNullNodes||_!=null)if(s.isArray(_)||s.isSet(_))s.forEachArray(_,function(I){var A={};A[T]=I,x=p.parse(f,A)},p);else if(s.isMap(_)||s.isObject(_))(y=p.element(f,void 0,p.sanitize(T)))&&(x=y,p.parse(y,_));else if(_!=null&&_!==""){var y;(y=p.element(f,void 0,p.sanitize(T)))&&(x=y,p.text(y,p._decodeText(p.sanitize(_))))}else x=p.element(f,void 0,p.sanitize(T))||x}}else if(s.isString(_)){var w=_.indexOf(" "),b=w===-1?_:_.substr(0,w),M=w===-1?"":_.substr(w+1);x=p.instruction(f,p.sanitize(b),p.sanitize(M))||x}else s.isArray(_)||s.isSet(_)?s.forEachArray(_,function(I){var A=I.indexOf(" "),k=A===-1?I:I.substr(0,A),U=A===-1?"":I.substr(A+1);x=p.instruction(f,p.sanitize(k),p.sanitize(U))||x},p):s.forEachObject(_,function(I,A){return x=p.instruction(f,p.sanitize(I),p.sanitize(A))||x},p);else s.isArray(_)||s.isSet(_)?s.forEachArray(_,function(I){return x=p.comment(f,p.sanitize(I))||x},p):x=p.comment(f,p.sanitize(_))||x;else s.isArray(_)||s.isSet(_)?s.forEachArray(_,function(I){return x=p.cdata(f,p.sanitize(I))||x},p):x=p.cdata(f,p.sanitize(_))||x;else x=s.isMap(_)||s.isObject(_)?p.parse(f,_):p.text(f,p._decodeText(p.sanitize(_)))||x;else if(T===C.convert.att){if(s.isArray(_)||s.isSet(_))throw new Error("Invalid attribute: "+_.toString()+". "+f._debugInfo());s.forEachObject(_,function(I,A){x=p.attribute(f,void 0,p.sanitize(I),p._decodeAttributeValue(p.sanitize(A)))||x})}else x=p.attribute(f,void 0,p.sanitize(T.substr(C.convert.att.length)),p._decodeAttributeValue(p.sanitize(_)))||x},this):(C.keepNullNodes||h!=null)&&(x=this.text(f,this._decodeText(this.sanitize(h)))||x),x||f},d}(i(75).BaseReader);r.ObjectReader=l},function(n,r,i){var a=i(39);n.exports=new a({explicit:[i(286),i(287),i(288)]})},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(o){this.level=0,this._builderOptions=o,this._writerOptions=o};r.BaseCBWriter=a},function(n,r,i){var a=i(16),o=i(8),s=i(116);n.exports=!a&&!o(function(){return Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a!=7})},function(n,r,i){var a=i(11),o=i(13),s=a.document,l=o(s)&&o(s.createElement);n.exports=function(c){return l?s.createElement(c):{}}},function(n,r,i){var a=i(118),o=Function.toString;typeof a.inspectSource!="function"&&(a.inspectSource=function(s){return o.call(s)}),n.exports=a.inspectSource},function(n,r,i){var a=i(11),o=i(80),s=a["__core-js_shared__"]||o("__core-js_shared__",{});n.exports=s},function(n,r,i){var a=i(14),o=i(187),s=i(55),l=i(15);n.exports=function(c,d){for(var f=o(d),h=l.f,p=s.f,C=0;C<f.length;C++){var x=f[C];a(c,x)||h(c,x,p(d,x))}}},function(n,r,i){var a=i(11);n.exports=a},function(n,r,i){var a=i(14),o=i(24),s=i(122).indexOf,l=i(45);n.exports=function(c,d){var f,h=o(c),p=0,C=[];for(f in h)!a(l,f)&&a(h,f)&&C.push(f);for(;d.length>p;)a(h,f=d[p++])&&(~s(C,f)||C.push(f));return C}},function(n,r,i){var a=i(24),o=i(26),s=i(83),l=function(c){return function(d,f,h){var p,C=a(d),x=o(C.length),T=s(h,x);if(c&&f!=f){for(;x>T;)if((p=C[T++])!=p)return!0}else for(;x>T;T++)if((c||T in C)&&C[T]===f)return c||T||0;return!c&&-1}};n.exports={includes:l(!0),indexOf:l(!1)}},function(n,r,i){var a=i(8),o=/#|\.prototype\./,s=function(h,p){var C=c[l(h)];return C==f||C!=d&&(typeof p=="function"?a(p):!!p)},l=s.normalize=function(h){return String(h).replace(o,".").toLowerCase()},c=s.data={},d=s.NATIVE="N",f=s.POLYFILL="P";n.exports=s},function(n,r,i){var a=i(86);n.exports=a&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},function(n,r,i){var a=i(5);r.f=a},function(n,r,i){var a=i(120),o=i(14),s=i(125),l=i(15).f;n.exports=function(c){var d=a.Symbol||(a.Symbol={});o(d,c)||l(d,c,{value:s.f(c)})}},function(n,r){n.exports=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i}},function(n,r,i){var a=i(13),o=i(59),s=i(5)("species");n.exports=function(l,c){var d;return o(l)&&(typeof(d=l.constructor)!="function"||d!==Array&&!o(d.prototype)?a(d)&&(d=d[s])===null&&(d=void 0):d=void 0),new(d===void 0?Array:d)(c===0?0:c)}},function(n,r,i){var a,o,s=i(11),l=i(193),c=s.process,d=c&&c.versions,f=d&&d.v8;f?o=(a=f.split("."))[0]+a[1]:l&&(!(a=l.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=l.match(/Chrome\/(\d+)/))&&(o=a[1]),n.exports=o&&+o},function(n,r,i){var a=i(5),o=i(60),s=i(15),l=a("unscopables"),c=Array.prototype;c[l]==null&&s.f(c,l,{configurable:!0,value:o(null)}),n.exports=function(d){c[l][d]=!0}},function(n,r,i){var a,o,s,l=i(132),c=i(21),d=i(14),f=i(5),h=i(44),p=f("iterator"),C=!1;[].keys&&("next"in(s=[].keys())?(o=l(l(s)))!==Object.prototype&&(a=o):C=!0),a==null&&(a={}),h||d(a,p)||c(a,p,function(){return this}),n.exports={IteratorPrototype:a,BUGGY_SAFARI_ITERATORS:C}},function(n,r,i){var a=i(14),o=i(27),s=i(57),l=i(196),c=s("IE_PROTO"),d=Object.prototype;n.exports=l?Object.getPrototypeOf:function(f){return f=o(f),a(f,c)?f[c]:typeof f.constructor=="function"&&f instanceof f.constructor?f.constructor.prototype:f instanceof Object?d:null}},function(n,r,i){var a=i(18),o=i(197);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var s,l=!1,c={};try{(s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(c,[]),l=c instanceof Array}catch{}return function(d,f){return a(d),o(f),l?s.call(d,f):d.__proto__=f,d}}():void 0)},function(n,r,i){var a=i(56),o=i(15),s=i(40);n.exports=function(l,c,d){var f=a(c);f in l?o.f(l,f,s(0,d)):l[f]=d}},function(n,r,i){var a=i(90),o=i(42),s=i(5)("toStringTag"),l=o(function(){return arguments}())=="Arguments";n.exports=a?o:function(c){var d,f,h;return c===void 0?"Undefined":c===null?"Null":typeof(f=function(p,C){try{return p[C]}catch{}}(d=Object(c),s))=="string"?f:l?o(d):(h=o(d))=="Object"&&typeof d.callee=="function"?"Arguments":h}},function(n,r,i){var a=i(18);n.exports=function(){var o=a(this),s="";return o.global&&(s+="g"),o.ignoreCase&&(s+="i"),o.multiline&&(s+="m"),o.dotAll&&(s+="s"),o.unicode&&(s+="u"),o.sticky&&(s+="y"),s}},function(n,r,i){var a=i(47),o=i(35),s=function(l){return function(c,d){var f,h,p=String(o(c)),C=a(d),x=p.length;return C<0||C>=x?l?"":void 0:(f=p.charCodeAt(C))<55296||f>56319||C+1===x||(h=p.charCodeAt(C+1))<56320||h>57343?l?p.charAt(C):f:l?p.slice(C,C+2):h-56320+(f-55296<<10)+65536}};n.exports={codeAt:s(!1),charAt:s(!0)}},function(n,r,i){var a=i(4),o=i(27),s=i(61);a({target:"Object",stat:!0,forced:i(8)(function(){s(1)})},{keys:function(l){return s(o(l))}})},function(n,r,i){var a=i(4),o=i(11),s=i(123),l=i(25),c=i(140),d=i(141),f=i(142),h=i(13),p=i(8),C=i(208),x=i(62),T=i(209);n.exports=function(_,y,w){var b=_.indexOf("Map")!==-1,M=_.indexOf("Weak")!==-1,I=b?"set":"add",A=o[_],k=A&&A.prototype,U=A,B={},z=function(pe){var ie=k[pe];l(k,pe,pe=="add"?function(te){return ie.call(this,te===0?0:te),this}:pe=="delete"?function(te){return!(M&&!h(te))&&ie.call(this,te===0?0:te)}:pe=="get"?function(te){return M&&!h(te)?void 0:ie.call(this,te===0?0:te)}:pe=="has"?function(te){return!(M&&!h(te))&&ie.call(this,te===0?0:te)}:function(te,ee){return ie.call(this,te===0?0:te,ee),this})};if(s(_,typeof A!="function"||!(M||k.forEach&&!p(function(){new A().entries().next()}))))U=w.getConstructor(y,_,b,I),c.REQUIRED=!0;else if(s(_,!0)){var K=new U,J=K[I](M?{}:-0,1)!=K,X=p(function(){K.has(1)}),re=C(function(pe){new A(pe)}),fe=!M&&p(function(){for(var pe=new A,ie=5;ie--;)pe[I](ie,ie);return!pe.has(-0)});re||((U=y(function(pe,ie){f(pe,U,_);var te=T(new A,pe,U);return ie!=null&&d(ie,te[I],te,b),te})).prototype=k,k.constructor=U),(X||fe)&&(z("delete"),z("has"),b&&z("get")),(fe||J)&&z(I),M&&k.clear&&delete k.clear}return B[_]=U,a({global:!0,forced:U!=A},B),x(U,_),M||w.setStrong(U,_,b),U}},function(n,r,i){var a=i(45),o=i(13),s=i(14),l=i(15).f,c=i(58),d=i(204),f=c("meta"),h=0,p=Object.isExtensible||function(){return!0},C=function(T){l(T,f,{value:{objectID:"O"+ ++h,weakData:{}}})},x=n.exports={REQUIRED:!1,fastKey:function(T,_){if(!o(T))return typeof T=="symbol"?T:(typeof T=="string"?"S":"P")+T;if(!s(T,f)){if(!p(T))return"F";if(!_)return"E";C(T)}return T[f].objectID},getWeakData:function(T,_){if(!s(T,f)){if(!p(T))return!0;if(!_)return!1;C(T)}return T[f].weakData},onFreeze:function(T){return d&&x.REQUIRED&&p(T)&&!s(T,f)&&C(T),T}};a[f]=!0},function(n,r,i){var a=i(18),o=i(205),s=i(26),l=i(87),c=i(206),d=i(207),f=function(h,p){this.stopped=h,this.result=p};(n.exports=function(h,p,C,x,T){var _,y,w,b,M,I,A,k=l(p,C,x?2:1);if(T)_=h;else{if(typeof(y=c(h))!="function")throw TypeError("Target is not iterable");if(o(y)){for(w=0,b=s(h.length);b>w;w++)if((M=x?k(a(A=h[w])[0],A[1]):k(h[w]))&&M instanceof f)return M;return new f(!1)}_=y.call(h)}for(I=_.next;!(A=I.call(_)).done;)if(typeof(M=d(_,k,A.value,x))=="object"&&M&&M instanceof f)return M;return new f(!1)}).stop=function(h){return new f(!0,h)}},function(n,r){n.exports=function(i,a,o){if(!(i instanceof a))throw TypeError("Incorrect "+(o?o+" ":"")+"invocation");return i}},function(n,r,i){var a=i(15).f,o=i(60),s=i(210),l=i(87),c=i(142),d=i(141),f=i(88),h=i(211),p=i(16),C=i(140).fastKey,x=i(43),T=x.set,_=x.getterFor;n.exports={getConstructor:function(y,w,b,M){var I=y(function(B,z){c(B,I,w),T(B,{type:w,index:o(null),first:void 0,last:void 0,size:0}),p||(B.size=0),z!=null&&d(z,B[M],B,b)}),A=_(w),k=function(B,z,K){var J,X,re=A(B),fe=U(B,z);return fe?fe.value=K:(re.last=fe={index:X=C(z,!0),key:z,value:K,previous:J=re.last,next:void 0,removed:!1},re.first||(re.first=fe),J&&(J.next=fe),p?re.size++:B.size++,X!=="F"&&(re.index[X]=fe)),B},U=function(B,z){var K,J=A(B),X=C(z);if(X!=="F")return J.index[X];for(K=J.first;K;K=K.next)if(K.key==z)return K};return s(I.prototype,{clear:function(){for(var B=A(this),z=B.index,K=B.first;K;)K.removed=!0,K.previous&&(K.previous=K.previous.next=void 0),delete z[K.index],K=K.next;B.first=B.last=void 0,p?B.size=0:this.size=0},delete:function(B){var z=A(this),K=U(this,B);if(K){var J=K.next,X=K.previous;delete z.index[K.index],K.removed=!0,X&&(X.next=J),J&&(J.previous=X),z.first==K&&(z.first=J),z.last==K&&(z.last=X),p?z.size--:this.size--}return!!K},forEach:function(B){for(var z,K=A(this),J=l(B,arguments.length>1?arguments[1]:void 0,3);z=z?z.next:K.first;)for(J(z.value,z.key,this);z&&z.removed;)z=z.previous},has:function(B){return!!U(this,B)}}),s(I.prototype,b?{get:function(B){var z=U(this,B);return z&&z.value},set:function(B,z){return k(this,B===0?0:B,z)}}:{add:function(B){return k(this,B=B===0?0:B,B)}}),p&&a(I.prototype,"size",{get:function(){return A(this).size}}),I},setStrong:function(y,w,b){var M=w+" Iterator",I=_(w),A=_(M);f(y,w,function(k,U){T(this,{type:M,target:k,state:I(k),kind:U,last:void 0})},function(){for(var k=A(this),U=k.kind,B=k.last;B&&B.removed;)B=B.previous;return k.target&&(k.last=B=B?B.next:k.state.first)?U=="keys"?{value:B.key,done:!1}:U=="values"?{value:B.value,done:!1}:{value:[B.key,B.value],done:!1}:(k.target=void 0,{value:void 0,done:!0})},b?"entries":"values",!b,!0),h(w)}}},function(n,r,i){var a,o=i(4),s=i(55).f,l=i(26),c=i(222),d=i(35),f=i(224),h=i(44),p="".endsWith,C=Math.min,x=f("endsWith");o({target:"String",proto:!0,forced:!!(h||x||(a=s(String.prototype,"endsWith"),!a||a.writable))&&!x},{endsWith:function(T){var _=String(d(this));c(T);var y=arguments.length>1?arguments[1]:void 0,w=l(_.length),b=y===void 0?w:C(l(y),w),M=String(T);return p?p.call(_,M,b):_.slice(b-M.length,b)===M}})},function(n,r,i){(function(a){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var o=i(229),s=i(230),l=i(231);function c(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(ae,H){if(c()<H)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(ae=new Uint8Array(H)).__proto__=f.prototype:(ae===null&&(ae=new f(H)),ae.length=H),ae}function f(ae,H,ce){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(ae,H,ce);if(typeof ae=="number"){if(typeof H=="string")throw new Error("If encoding is specified then the first argument must be a string");return C(this,ae)}return h(this,ae,H,ce)}function h(ae,H,ce,se){if(typeof H=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&H instanceof ArrayBuffer?function(he,ve,ye,Ae){if(ve.byteLength,ye<0||ve.byteLength<ye)throw new RangeError("'offset' is out of bounds");if(ve.byteLength<ye+(Ae||0))throw new RangeError("'length' is out of bounds");return ve=ye===void 0&&Ae===void 0?new Uint8Array(ve):Ae===void 0?new Uint8Array(ve,ye):new Uint8Array(ve,ye,Ae),f.TYPED_ARRAY_SUPPORT?(he=ve).__proto__=f.prototype:he=x(he,ve),he}(ae,H,ce,se):typeof H=="string"?function(he,ve,ye){if(typeof ye=="string"&&ye!==""||(ye="utf8"),!f.isEncoding(ye))throw new TypeError('"encoding" must be a valid string encoding');var Ae=0|_(ve,ye),Ue=(he=d(he,Ae)).write(ve,ye);return Ue!==Ae&&(he=he.slice(0,Ue)),he}(ae,H,ce):function(he,ve){if(f.isBuffer(ve)){var ye=0|T(ve.length);return(he=d(he,ye)).length===0||ve.copy(he,0,0,ye),he}if(ve){if(typeof ArrayBuffer<"u"&&ve.buffer instanceof ArrayBuffer||"length"in ve)return typeof ve.length!="number"||(Ae=ve.length)!=Ae?d(he,0):x(he,ve);if(ve.type==="Buffer"&&l(ve.data))return x(he,ve.data)}var Ae;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(ae,H)}function p(ae){if(typeof ae!="number")throw new TypeError('"size" argument must be a number');if(ae<0)throw new RangeError('"size" argument must not be negative')}function C(ae,H){if(p(H),ae=d(ae,H<0?0:0|T(H)),!f.TYPED_ARRAY_SUPPORT)for(var ce=0;ce<H;++ce)ae[ce]=0;return ae}function x(ae,H){var ce=H.length<0?0:0|T(H.length);ae=d(ae,ce);for(var se=0;se<ce;se+=1)ae[se]=255&H[se];return ae}function T(ae){if(ae>=c())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c().toString(16)+" bytes");return 0|ae}function _(ae,H){if(f.isBuffer(ae))return ae.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(ae)||ae instanceof ArrayBuffer))return ae.byteLength;typeof ae!="string"&&(ae=""+ae);var ce=ae.length;if(ce===0)return 0;for(var se=!1;;)switch(H){case"ascii":case"latin1":case"binary":return ce;case"utf8":case"utf-8":case void 0:return Ge(ae).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ce;case"hex":return ce>>>1;case"base64":return qe(ae).length;default:if(se)return Ge(ae).length;H=(""+H).toLowerCase(),se=!0}}function y(ae,H,ce){var se=!1;if((H===void 0||H<0)&&(H=0),H>this.length||((ce===void 0||ce>this.length)&&(ce=this.length),ce<=0)||(ce>>>=0)<=(H>>>=0))return"";for(ae||(ae="utf8");;)switch(ae){case"hex":return fe(this,H,ce);case"utf8":case"utf-8":return J(this,H,ce);case"ascii":return X(this,H,ce);case"latin1":case"binary":return re(this,H,ce);case"base64":return K(this,H,ce);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,H,ce);default:if(se)throw new TypeError("Unknown encoding: "+ae);ae=(ae+"").toLowerCase(),se=!0}}function w(ae,H,ce){var se=ae[H];ae[H]=ae[ce],ae[ce]=se}function b(ae,H,ce,se,he){if(ae.length===0)return-1;if(typeof ce=="string"?(se=ce,ce=0):ce>2147483647?ce=2147483647:ce<-2147483648&&(ce=-2147483648),ce=+ce,isNaN(ce)&&(ce=he?0:ae.length-1),ce<0&&(ce=ae.length+ce),ce>=ae.length){if(he)return-1;ce=ae.length-1}else if(ce<0){if(!he)return-1;ce=0}if(typeof H=="string"&&(H=f.from(H,se)),f.isBuffer(H))return H.length===0?-1:M(ae,H,ce,se,he);if(typeof H=="number")return H&=255,f.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?he?Uint8Array.prototype.indexOf.call(ae,H,ce):Uint8Array.prototype.lastIndexOf.call(ae,H,ce):M(ae,[H],ce,se,he);throw new TypeError("val must be string, number or Buffer")}function M(ae,H,ce,se,he){var ve,ye=1,Ae=ae.length,Ue=H.length;if(se!==void 0&&((se=String(se).toLowerCase())==="ucs2"||se==="ucs-2"||se==="utf16le"||se==="utf-16le")){if(ae.length<2||H.length<2)return-1;ye=2,Ae/=2,Ue/=2,ce/=2}function Je(nn,Ot){return ye===1?nn[Ot]:nn.readUInt16BE(Ot*ye)}if(he){var et=-1;for(ve=ce;ve<Ae;ve++)if(Je(ae,ve)===Je(H,et===-1?0:ve-et)){if(et===-1&&(et=ve),ve-et+1===Ue)return et*ye}else et!==-1&&(ve-=ve-et),et=-1}else for(ce+Ue>Ae&&(ce=Ae-Ue),ve=ce;ve>=0;ve--){for(var lt=!0,_t=0;_t<Ue;_t++)if(Je(ae,ve+_t)!==Je(H,_t)){lt=!1;break}if(lt)return ve}return-1}function I(ae,H,ce,se){ce=Number(ce)||0;var he=ae.length-ce;se?(se=Number(se))>he&&(se=he):se=he;var ve=H.length;if(ve%2!=0)throw new TypeError("Invalid hex string");se>ve/2&&(se=ve/2);for(var ye=0;ye<se;++ye){var Ae=parseInt(H.substr(2*ye,2),16);if(isNaN(Ae))return ye;ae[ce+ye]=Ae}return ye}function A(ae,H,ce,se){return Be(Ge(H,ae.length-ce),ae,ce,se)}function k(ae,H,ce,se){return Be(function(he){for(var ve=[],ye=0;ye<he.length;++ye)ve.push(255&he.charCodeAt(ye));return ve}(H),ae,ce,se)}function U(ae,H,ce,se){return k(ae,H,ce,se)}function B(ae,H,ce,se){return Be(qe(H),ae,ce,se)}function z(ae,H,ce,se){return Be(function(he,ve){for(var ye,Ae,Ue,Je=[],et=0;et<he.length&&!((ve-=2)<0);++et)ye=he.charCodeAt(et),Ae=ye>>8,Ue=ye%256,Je.push(Ue),Je.push(Ae);return Je}(H,ae.length-ce),ae,ce,se)}function K(ae,H,ce){return H===0&&ce===ae.length?o.fromByteArray(ae):o.fromByteArray(ae.slice(H,ce))}function J(ae,H,ce){ce=Math.min(ae.length,ce);for(var se=[],he=H;he<ce;){var ve,ye,Ae,Ue,Je=ae[he],et=null,lt=Je>239?4:Je>223?3:Je>191?2:1;if(he+lt<=ce)switch(lt){case 1:Je<128&&(et=Je);break;case 2:(192&(ve=ae[he+1]))==128&&(Ue=(31&Je)<<6|63&ve)>127&&(et=Ue);break;case 3:ve=ae[he+1],ye=ae[he+2],(192&ve)==128&&(192&ye)==128&&(Ue=(15&Je)<<12|(63&ve)<<6|63&ye)>2047&&(Ue<55296||Ue>57343)&&(et=Ue);break;case 4:ve=ae[he+1],ye=ae[he+2],Ae=ae[he+3],(192&ve)==128&&(192&ye)==128&&(192&Ae)==128&&(Ue=(15&Je)<<18|(63&ve)<<12|(63&ye)<<6|63&Ae)>65535&&Ue<1114112&&(et=Ue)}et===null?(et=65533,lt=1):et>65535&&(et-=65536,se.push(et>>>10&1023|55296),et=56320|1023&et),se.push(et),he+=lt}return function(_t){var nn=_t.length;if(nn<=4096)return String.fromCharCode.apply(String,_t);for(var Ot="",ft=0;ft<nn;)Ot+=String.fromCharCode.apply(String,_t.slice(ft,ft+=4096));return Ot}(se)}r.Buffer=f,r.SlowBuffer=function(ae){return+ae!=ae&&(ae=0),f.alloc(+ae)},r.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=a.TYPED_ARRAY_SUPPORT!==void 0?a.TYPED_ARRAY_SUPPORT:function(){try{var ae=new Uint8Array(1);return ae.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ae.foo()===42&&typeof ae.subarray=="function"&&ae.subarray(1,1).byteLength===0}catch{return!1}}(),r.kMaxLength=c(),f.poolSize=8192,f._augment=function(ae){return ae.__proto__=f.prototype,ae},f.from=function(ae,H,ce){return h(null,ae,H,ce)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(ae,H,ce){return function(se,he,ve,ye){return p(he),he<=0?d(se,he):ve!==void 0?typeof ye=="string"?d(se,he).fill(ve,ye):d(se,he).fill(ve):d(se,he)}(null,ae,H,ce)},f.allocUnsafe=function(ae){return C(null,ae)},f.allocUnsafeSlow=function(ae){return C(null,ae)},f.isBuffer=function(ae){return!(ae==null||!ae._isBuffer)},f.compare=function(ae,H){if(!f.isBuffer(ae)||!f.isBuffer(H))throw new TypeError("Arguments must be Buffers");if(ae===H)return 0;for(var ce=ae.length,se=H.length,he=0,ve=Math.min(ce,se);he<ve;++he)if(ae[he]!==H[he]){ce=ae[he],se=H[he];break}return ce<se?-1:se<ce?1:0},f.isEncoding=function(ae){switch(String(ae).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(ae,H){if(!l(ae))throw new TypeError('"list" argument must be an Array of Buffers');if(ae.length===0)return f.alloc(0);var ce;if(H===void 0)for(H=0,ce=0;ce<ae.length;++ce)H+=ae[ce].length;var se=f.allocUnsafe(H),he=0;for(ce=0;ce<ae.length;++ce){var ve=ae[ce];if(!f.isBuffer(ve))throw new TypeError('"list" argument must be an Array of Buffers');ve.copy(se,he),he+=ve.length}return se},f.byteLength=_,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var ae=this.length;if(ae%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var H=0;H<ae;H+=2)w(this,H,H+1);return this},f.prototype.swap32=function(){var ae=this.length;if(ae%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var H=0;H<ae;H+=4)w(this,H,H+3),w(this,H+1,H+2);return this},f.prototype.swap64=function(){var ae=this.length;if(ae%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var H=0;H<ae;H+=8)w(this,H,H+7),w(this,H+1,H+6),w(this,H+2,H+5),w(this,H+3,H+4);return this},f.prototype.toString=function(){var ae=0|this.length;return ae===0?"":arguments.length===0?J(this,0,ae):y.apply(this,arguments)},f.prototype.equals=function(ae){if(!f.isBuffer(ae))throw new TypeError("Argument must be a Buffer");return this===ae||f.compare(this,ae)===0},f.prototype.inspect=function(){var ae="",H=r.INSPECT_MAX_BYTES;return this.length>0&&(ae=this.toString("hex",0,H).match(/.{2}/g).join(" "),this.length>H&&(ae+=" ... ")),"<Buffer "+ae+">"},f.prototype.compare=function(ae,H,ce,se,he){if(!f.isBuffer(ae))throw new TypeError("Argument must be a Buffer");if(H===void 0&&(H=0),ce===void 0&&(ce=ae?ae.length:0),se===void 0&&(se=0),he===void 0&&(he=this.length),H<0||ce>ae.length||se<0||he>this.length)throw new RangeError("out of range index");if(se>=he&&H>=ce)return 0;if(se>=he)return-1;if(H>=ce)return 1;if(this===ae)return 0;for(var ve=(he>>>=0)-(se>>>=0),ye=(ce>>>=0)-(H>>>=0),Ae=Math.min(ve,ye),Ue=this.slice(se,he),Je=ae.slice(H,ce),et=0;et<Ae;++et)if(Ue[et]!==Je[et]){ve=Ue[et],ye=Je[et];break}return ve<ye?-1:ye<ve?1:0},f.prototype.includes=function(ae,H,ce){return this.indexOf(ae,H,ce)!==-1},f.prototype.indexOf=function(ae,H,ce){return b(this,ae,H,ce,!0)},f.prototype.lastIndexOf=function(ae,H,ce){return b(this,ae,H,ce,!1)},f.prototype.write=function(ae,H,ce,se){if(H===void 0)se="utf8",ce=this.length,H=0;else if(ce===void 0&&typeof H=="string")se=H,ce=this.length,H=0;else{if(!isFinite(H))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");H|=0,isFinite(ce)?(ce|=0,se===void 0&&(se="utf8")):(se=ce,ce=void 0)}var he=this.length-H;if((ce===void 0||ce>he)&&(ce=he),ae.length>0&&(ce<0||H<0)||H>this.length)throw new RangeError("Attempt to write outside buffer bounds");se||(se="utf8");for(var ve=!1;;)switch(se){case"hex":return I(this,ae,H,ce);case"utf8":case"utf-8":return A(this,ae,H,ce);case"ascii":return k(this,ae,H,ce);case"latin1":case"binary":return U(this,ae,H,ce);case"base64":return B(this,ae,H,ce);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,ae,H,ce);default:if(ve)throw new TypeError("Unknown encoding: "+se);se=(""+se).toLowerCase(),ve=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(ae,H,ce){var se="";ce=Math.min(ae.length,ce);for(var he=H;he<ce;++he)se+=String.fromCharCode(127&ae[he]);return se}function re(ae,H,ce){var se="";ce=Math.min(ae.length,ce);for(var he=H;he<ce;++he)se+=String.fromCharCode(ae[he]);return se}function fe(ae,H,ce){var se=ae.length;(!H||H<0)&&(H=0),(!ce||ce<0||ce>se)&&(ce=se);for(var he="",ve=H;ve<ce;++ve)he+=Ve(ae[ve]);return he}function pe(ae,H,ce){for(var se=ae.slice(H,ce),he="",ve=0;ve<se.length;ve+=2)he+=String.fromCharCode(se[ve]+256*se[ve+1]);return he}function ie(ae,H,ce){if(ae%1!=0||ae<0)throw new RangeError("offset is not uint");if(ae+H>ce)throw new RangeError("Trying to access beyond buffer length")}function te(ae,H,ce,se,he,ve){if(!f.isBuffer(ae))throw new TypeError('"buffer" argument must be a Buffer instance');if(H>he||H<ve)throw new RangeError('"value" argument is out of bounds');if(ce+se>ae.length)throw new RangeError("Index out of range")}function ee(ae,H,ce,se){H<0&&(H=65535+H+1);for(var he=0,ve=Math.min(ae.length-ce,2);he<ve;++he)ae[ce+he]=(H&255<<8*(se?he:1-he))>>>8*(se?he:1-he)}function we(ae,H,ce,se){H<0&&(H=4294967295+H+1);for(var he=0,ve=Math.min(ae.length-ce,4);he<ve;++he)ae[ce+he]=H>>>8*(se?he:3-he)&255}function Ce(ae,H,ce,se,he,ve){if(ce+se>ae.length)throw new RangeError("Index out of range");if(ce<0)throw new RangeError("Index out of range")}function De(ae,H,ce,se,he){return he||Ce(ae,0,ce,4),s.write(ae,H,ce,se,23,4),ce+4}function Re(ae,H,ce,se,he){return he||Ce(ae,0,ce,8),s.write(ae,H,ce,se,52,8),ce+8}f.prototype.slice=function(ae,H){var ce,se=this.length;if((ae=~~ae)<0?(ae+=se)<0&&(ae=0):ae>se&&(ae=se),(H=H===void 0?se:~~H)<0?(H+=se)<0&&(H=0):H>se&&(H=se),H<ae&&(H=ae),f.TYPED_ARRAY_SUPPORT)(ce=this.subarray(ae,H)).__proto__=f.prototype;else{var he=H-ae;ce=new f(he,void 0);for(var ve=0;ve<he;++ve)ce[ve]=this[ve+ae]}return ce},f.prototype.readUIntLE=function(ae,H,ce){ae|=0,H|=0,ce||ie(ae,H,this.length);for(var se=this[ae],he=1,ve=0;++ve<H&&(he*=256);)se+=this[ae+ve]*he;return se},f.prototype.readUIntBE=function(ae,H,ce){ae|=0,H|=0,ce||ie(ae,H,this.length);for(var se=this[ae+--H],he=1;H>0&&(he*=256);)se+=this[ae+--H]*he;return se},f.prototype.readUInt8=function(ae,H){return H||ie(ae,1,this.length),this[ae]},f.prototype.readUInt16LE=function(ae,H){return H||ie(ae,2,this.length),this[ae]|this[ae+1]<<8},f.prototype.readUInt16BE=function(ae,H){return H||ie(ae,2,this.length),this[ae]<<8|this[ae+1]},f.prototype.readUInt32LE=function(ae,H){return H||ie(ae,4,this.length),(this[ae]|this[ae+1]<<8|this[ae+2]<<16)+16777216*this[ae+3]},f.prototype.readUInt32BE=function(ae,H){return H||ie(ae,4,this.length),16777216*this[ae]+(this[ae+1]<<16|this[ae+2]<<8|this[ae+3])},f.prototype.readIntLE=function(ae,H,ce){ae|=0,H|=0,ce||ie(ae,H,this.length);for(var se=this[ae],he=1,ve=0;++ve<H&&(he*=256);)se+=this[ae+ve]*he;return se>=(he*=128)&&(se-=Math.pow(2,8*H)),se},f.prototype.readIntBE=function(ae,H,ce){ae|=0,H|=0,ce||ie(ae,H,this.length);for(var se=H,he=1,ve=this[ae+--se];se>0&&(he*=256);)ve+=this[ae+--se]*he;return ve>=(he*=128)&&(ve-=Math.pow(2,8*H)),ve},f.prototype.readInt8=function(ae,H){return H||ie(ae,1,this.length),128&this[ae]?-1*(255-this[ae]+1):this[ae]},f.prototype.readInt16LE=function(ae,H){H||ie(ae,2,this.length);var ce=this[ae]|this[ae+1]<<8;return 32768&ce?4294901760|ce:ce},f.prototype.readInt16BE=function(ae,H){H||ie(ae,2,this.length);var ce=this[ae+1]|this[ae]<<8;return 32768&ce?4294901760|ce:ce},f.prototype.readInt32LE=function(ae,H){return H||ie(ae,4,this.length),this[ae]|this[ae+1]<<8|this[ae+2]<<16|this[ae+3]<<24},f.prototype.readInt32BE=function(ae,H){return H||ie(ae,4,this.length),this[ae]<<24|this[ae+1]<<16|this[ae+2]<<8|this[ae+3]},f.prototype.readFloatLE=function(ae,H){return H||ie(ae,4,this.length),s.read(this,ae,!0,23,4)},f.prototype.readFloatBE=function(ae,H){return H||ie(ae,4,this.length),s.read(this,ae,!1,23,4)},f.prototype.readDoubleLE=function(ae,H){return H||ie(ae,8,this.length),s.read(this,ae,!0,52,8)},f.prototype.readDoubleBE=function(ae,H){return H||ie(ae,8,this.length),s.read(this,ae,!1,52,8)},f.prototype.writeUIntLE=function(ae,H,ce,se){ae=+ae,H|=0,ce|=0,se||te(this,ae,H,ce,Math.pow(2,8*ce)-1,0);var he=1,ve=0;for(this[H]=255&ae;++ve<ce&&(he*=256);)this[H+ve]=ae/he&255;return H+ce},f.prototype.writeUIntBE=function(ae,H,ce,se){ae=+ae,H|=0,ce|=0,se||te(this,ae,H,ce,Math.pow(2,8*ce)-1,0);var he=ce-1,ve=1;for(this[H+he]=255&ae;--he>=0&&(ve*=256);)this[H+he]=ae/ve&255;return H+ce},f.prototype.writeUInt8=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,1,255,0),f.TYPED_ARRAY_SUPPORT||(ae=Math.floor(ae)),this[H]=255&ae,H+1},f.prototype.writeUInt16LE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[H]=255&ae,this[H+1]=ae>>>8):ee(this,ae,H,!0),H+2},f.prototype.writeUInt16BE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[H]=ae>>>8,this[H+1]=255&ae):ee(this,ae,H,!1),H+2},f.prototype.writeUInt32LE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[H+3]=ae>>>24,this[H+2]=ae>>>16,this[H+1]=ae>>>8,this[H]=255&ae):we(this,ae,H,!0),H+4},f.prototype.writeUInt32BE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[H]=ae>>>24,this[H+1]=ae>>>16,this[H+2]=ae>>>8,this[H+3]=255&ae):we(this,ae,H,!1),H+4},f.prototype.writeIntLE=function(ae,H,ce,se){if(ae=+ae,H|=0,!se){var he=Math.pow(2,8*ce-1);te(this,ae,H,ce,he-1,-he)}var ve=0,ye=1,Ae=0;for(this[H]=255&ae;++ve<ce&&(ye*=256);)ae<0&&Ae===0&&this[H+ve-1]!==0&&(Ae=1),this[H+ve]=(ae/ye>>0)-Ae&255;return H+ce},f.prototype.writeIntBE=function(ae,H,ce,se){if(ae=+ae,H|=0,!se){var he=Math.pow(2,8*ce-1);te(this,ae,H,ce,he-1,-he)}var ve=ce-1,ye=1,Ae=0;for(this[H+ve]=255&ae;--ve>=0&&(ye*=256);)ae<0&&Ae===0&&this[H+ve+1]!==0&&(Ae=1),this[H+ve]=(ae/ye>>0)-Ae&255;return H+ce},f.prototype.writeInt8=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,1,127,-128),f.TYPED_ARRAY_SUPPORT||(ae=Math.floor(ae)),ae<0&&(ae=255+ae+1),this[H]=255&ae,H+1},f.prototype.writeInt16LE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[H]=255&ae,this[H+1]=ae>>>8):ee(this,ae,H,!0),H+2},f.prototype.writeInt16BE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[H]=ae>>>8,this[H+1]=255&ae):ee(this,ae,H,!1),H+2},f.prototype.writeInt32LE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[H]=255&ae,this[H+1]=ae>>>8,this[H+2]=ae>>>16,this[H+3]=ae>>>24):we(this,ae,H,!0),H+4},f.prototype.writeInt32BE=function(ae,H,ce){return ae=+ae,H|=0,ce||te(this,ae,H,4,2147483647,-2147483648),ae<0&&(ae=4294967295+ae+1),f.TYPED_ARRAY_SUPPORT?(this[H]=ae>>>24,this[H+1]=ae>>>16,this[H+2]=ae>>>8,this[H+3]=255&ae):we(this,ae,H,!1),H+4},f.prototype.writeFloatLE=function(ae,H,ce){return De(this,ae,H,!0,ce)},f.prototype.writeFloatBE=function(ae,H,ce){return De(this,ae,H,!1,ce)},f.prototype.writeDoubleLE=function(ae,H,ce){return Re(this,ae,H,!0,ce)},f.prototype.writeDoubleBE=function(ae,H,ce){return Re(this,ae,H,!1,ce)},f.prototype.copy=function(ae,H,ce,se){if(ce||(ce=0),se||se===0||(se=this.length),H>=ae.length&&(H=ae.length),H||(H=0),se>0&&se<ce&&(se=ce),se===ce||ae.length===0||this.length===0)return 0;if(H<0)throw new RangeError("targetStart out of bounds");if(ce<0||ce>=this.length)throw new RangeError("sourceStart out of bounds");if(se<0)throw new RangeError("sourceEnd out of bounds");se>this.length&&(se=this.length),ae.length-H<se-ce&&(se=ae.length-H+ce);var he,ve=se-ce;if(this===ae&&ce<H&&H<se)for(he=ve-1;he>=0;--he)ae[he+H]=this[he+ce];else if(ve<1e3||!f.TYPED_ARRAY_SUPPORT)for(he=0;he<ve;++he)ae[he+H]=this[he+ce];else Uint8Array.prototype.set.call(ae,this.subarray(ce,ce+ve),H);return ve},f.prototype.fill=function(ae,H,ce,se){if(typeof ae=="string"){if(typeof H=="string"?(se=H,H=0,ce=this.length):typeof ce=="string"&&(se=ce,ce=this.length),ae.length===1){var he=ae.charCodeAt(0);he<256&&(ae=he)}if(se!==void 0&&typeof se!="string")throw new TypeError("encoding must be a string");if(typeof se=="string"&&!f.isEncoding(se))throw new TypeError("Unknown encoding: "+se)}else typeof ae=="number"&&(ae&=255);if(H<0||this.length<H||this.length<ce)throw new RangeError("Out of range index");if(ce<=H)return this;var ve;if(H>>>=0,ce=ce===void 0?this.length:ce>>>0,ae||(ae=0),typeof ae=="number")for(ve=H;ve<ce;++ve)this[ve]=ae;else{var ye=f.isBuffer(ae)?ae:Ge(new f(ae,se).toString()),Ae=ye.length;for(ve=0;ve<ce-H;++ve)this[ve+H]=ye[ve%Ae]}return this};var Oe=/[^+\/0-9A-Za-z-_]/g;function Ve(ae){return ae<16?"0"+ae.toString(16):ae.toString(16)}function Ge(ae,H){var ce;H=H||1/0;for(var se=ae.length,he=null,ve=[],ye=0;ye<se;++ye){if((ce=ae.charCodeAt(ye))>55295&&ce<57344){if(!he){if(ce>56319){(H-=3)>-1&&ve.push(239,191,189);continue}if(ye+1===se){(H-=3)>-1&&ve.push(239,191,189);continue}he=ce;continue}if(ce<56320){(H-=3)>-1&&ve.push(239,191,189),he=ce;continue}ce=65536+(he-55296<<10|ce-56320)}else he&&(H-=3)>-1&&ve.push(239,191,189);if(he=null,ce<128){if((H-=1)<0)break;ve.push(ce)}else if(ce<2048){if((H-=2)<0)break;ve.push(ce>>6|192,63&ce|128)}else if(ce<65536){if((H-=3)<0)break;ve.push(ce>>12|224,ce>>6&63|128,63&ce|128)}else{if(!(ce<1114112))throw new Error("Invalid code point");if((H-=4)<0)break;ve.push(ce>>18|240,ce>>12&63|128,ce>>6&63|128,63&ce|128)}}return ve}function qe(ae){return o.toByteArray(function(H){if((H=function(ce){return ce.trim?ce.trim():ce.replace(/^\s+|\s+$/g,"")}(H).replace(Oe,"")).length<2)return"";for(;H.length%4!=0;)H+="=";return H}(ae))}function Be(ae,H,ce,se){for(var he=0;he<se&&!(he+ce>=H.length||he>=ae.length);++he)H[he+ce]=ae[he];return he}}).call(this,i(78))},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.isASCIIByte=function(a){return a>=0&&a<=127}},function(n,r,i){var a=this&&this.__read||function(s,l){var c=typeof Symbol=="function"&&s[Symbol.iterator];if(!c)return s;var d,f,h=c.call(s),p=[];try{for(;(l===void 0||l-- >0)&&!(d=h.next()).done;)p.push(d.value)}catch(C){f={error:C}}finally{try{d&&!d.done&&(c=h.return)&&c.call(h)}finally{if(f)throw f.error}}return p},o=this&&this.__spread||function(){for(var s=[],l=0;l<arguments.length;l++)s=s.concat(a(arguments[l]));return s};Object.defineProperty(r,"__esModule",{value:!0}),r.length=function(s){return s.length},r.byteLowercase=function(s){for(var l=0;l<s.length;l++){var c=s[l];c>=65&&c<=90&&(s[l]=c+32)}},r.byteUppercase=function(s){for(var l=0;l<s.length;l++){var c=s[l];c>=97&&c<=122&&(s[l]=c-32)}},r.byteCaseInsensitiveMatch=function(s,l){if(s.length!==l.length)return!1;for(var c=0;c<s.length;c++){var d=s[c],f=l[c];if(d>=65&&d<=90&&(d+=32),f>=65&&f<=90&&(f+=32),d!==f)return!1}return!0},r.startsWith=function(s,l){for(var c=0;;){if(c>=s.length)return!1;if(c>=l.length)return!0;if(s[c]!==l[c])return!1;c++}},r.byteLessThan=function(s,l){for(var c=0;;){if(c>=s.length)return!1;if(c>=l.length)return!0;var d=s[c],f=l[c];if(d<f)return!0;if(d>f)return!1;c++}},r.isomorphicDecode=function(s){return String.fromCodePoint.apply(String,o(s))}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(6),o=i(7),s=i(0),l=i(12),c=function(){function d(f){this._associatedDocument=f||a.dom.window.document}return d.prototype.createDocumentType=function(f,h,p){return s.namespace_validate(f),s.create_documentType(this._associatedDocument,f,h,p)},d.prototype.createDocument=function(f,h,p){p===void 0&&(p=null);var C=s.create_xmlDocument(),x=null;return h&&(x=s.document_internalCreateElementNS(C,f,h)),p&&C.appendChild(p),x&&C.appendChild(x),C._origin=this._associatedDocument._origin,f===o.namespace.HTML?C._contentType="application/xhtml+xml":f===o.namespace.SVG?C._contentType="image/svg+xml":C._contentType="application/xml",C},d.prototype.createHTMLDocument=function(f){var h=s.create_document();h._type="html",h._contentType="text/html",h.appendChild(s.create_documentType(h,"html","",""));var p=s.element_createAnElement(h,"html",o.namespace.HTML);h.appendChild(p);var C=s.element_createAnElement(h,"head",o.namespace.HTML);if(p.appendChild(C),f!==void 0){var x=s.element_createAnElement(h,"title",o.namespace.HTML);C.appendChild(x);var T=s.create_text(h,f);x.appendChild(T)}var _=s.element_createAnElement(h,"body",o.namespace.HTML);return p.appendChild(_),h._origin=this._associatedDocument._origin,h},d.prototype.hasFeature=function(){return!0},d._create=function(f){return new d(f)},d}();r.DOMImplementationImpl=c,l.idl_defineConst(c.prototype,"_ID","@oozcitak/dom")},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(70),l=i(1),c=i(0),d=function(f){function h(){var p=f.call(this)||this;return p._signalSlots=new Set,p._mutationObserverMicrotaskQueued=!1,p._mutationObservers=new Set,p._iteratorList=new l.FixedSizeSet,p._associatedDocument=c.create_document(),p}return o(h,f),Object.defineProperty(h.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),h._create=function(){return new h},h}(s.EventTargetImpl);r.WindowImpl=d},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=function(){function s(){}return s.isNode=function(l){return!!l&&l._nodeType!==void 0},s.isDocumentNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.Document},s.isDocumentTypeNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.DocumentType},s.isDocumentFragmentNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.DocumentFragment},s.isAttrNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.Attribute},s.isCharacterDataNode=function(l){if(!s.isNode(l))return!1;var c=l._nodeType;return c===a.NodeType.Text||c===a.NodeType.ProcessingInstruction||c===a.NodeType.Comment||c===a.NodeType.CData},s.isTextNode=function(l){return s.isNode(l)&&(l._nodeType===a.NodeType.Text||l._nodeType===a.NodeType.CData)},s.isExclusiveTextNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.Text},s.isCDATASectionNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.CData},s.isCommentNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.Comment},s.isProcessingInstructionNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.ProcessingInstruction},s.isElementNode=function(l){return s.isNode(l)&&l._nodeType===a.NodeType.Element},s.isCustomElementNode=function(l){return s.isElementNode(l)&&l._customElementState==="custom"},s.isShadowRoot=function(l){return!!l&&l.host!==void 0},s.isMouseEvent=function(l){return!!l&&l.screenX!==void 0&&l.screenY!=null},s.isSlotable=function(l){return!!l&&l._name!==void 0&&l._assignedSlot!==void 0&&(s.isTextNode(l)||s.isElementNode(l))},s.isSlot=function(l){return!!l&&l._name!==void 0&&l._assignedNodes!==void 0&&s.isElementNode(l)},s.isWindow=function(l){return!!l&&l.navigator!==void 0},s.isEventListener=function(l){return!!l&&l.handleEvent!==void 0},s.isRegisteredObserver=function(l){return!!l&&l.observer!==void 0&&l.options!==void 0},s.isTransientRegisteredObserver=function(l){return!!l&&l.source!==void 0&&s.isRegisteredObserver(l)},s}();r.Guard=o},function(n,r,i){var a,o=this&&this.__extends||(a=function(l,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,f){d.__proto__=f}||function(d,f){for(var h in f)f.hasOwnProperty(h)&&(d[h]=f[h])})(l,c)},function(l,c){function d(){this.constructor=l}a(l,c),l.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(l){function c(){return l.call(this)||this}return o(c,l),c}(i(98).DocumentImpl);r.XMLDocumentImpl=s},function(n,r,i){var a=this&&this.__values||function(se){var he=typeof Symbol=="function"&&Symbol.iterator,ve=he&&se[he],ye=0;if(ve)return ve.call(se);if(se&&typeof se.length=="number")return{next:function(){return se&&ye>=se.length&&(se=void 0),{value:se&&se[ye++],done:!se}}};throw new TypeError(he?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(se,he){var ve=typeof Symbol=="function"&&se[Symbol.iterator];if(!ve)return se;var ye,Ae,Ue=ve.call(se),Je=[];try{for(;(he===void 0||he-- >0)&&!(ye=Ue.next()).done;)Je.push(ye.value)}catch(et){Ae={error:et}}finally{try{ye&&!ye.done&&(ve=Ue.return)&&ve.call(Ue)}finally{if(Ae)throw Ae.error}}return Je};Object.defineProperty(r,"__esModule",{value:!0});var s,l=i(1),c=i(243),d=i(7),f=i(244),h={ftp:21,file:null,http:80,https:443,ws:80,wss:443},p=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,C=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,x=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,T=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,_=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,y=/[\0\t\f\r #%/:?@\[\\\]]/;function w(se){s!==void 0&&s.call(null,"Validation Error: "+se)}function b(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function M(se){return se in h}function I(se){return M(se.scheme)}function A(se){return h[se]||null}function k(se){return se.username!==""||se.password!==""}function U(se,he){var ve,ye;he===void 0&&(he=!1);var Ae=se.scheme+":";if(se.host!==null?(Ae+="//",k(se)&&(Ae+=se.username,se.password!==""&&(Ae+=":"+se.password),Ae+="@"),Ae+=B(se.host),se.port!==null&&(Ae+=":"+se.port)):se.host===null&&se.scheme==="file"&&(Ae+="//"),se._cannotBeABaseURLFlag)Ae+=se.path[0];else try{for(var Ue=a(se.path),Je=Ue.next();!Je.done;Je=Ue.next())Ae+="/"+Je.value}catch(et){ve={error:et}}finally{try{Je&&!Je.done&&(ye=Ue.return)&&ye.call(Ue)}finally{if(ve)throw ve.error}}return se.query!==null&&(Ae+="?"+se.query),he||se.fragment===null||(Ae+="#"+se.fragment),Ae}function B(se){return l.isNumber(se)?z(se):l.isArray(se)?"["+K(se)+"]":se}function z(se){for(var he="",ve=se,ye=1;ye<=4;ye++)he=(ve%256).toString()+he,ye!==4&&(he="."+he),ve=Math.floor(ve/256);return he}function K(se){for(var he="",ve=null,ye=-1,Ae=0,Ue=0,Je=0;Je<8;Je++)if(se[Je]===0){Ae=1;for(var et=Je+1;et<8&&se[et]===0;et++)Ae++;Ae>Ue&&(Ue=Ae,ye=Je)}Ue>1&&(ve=ye);for(var lt=!1,_t=0;_t<8;_t++)lt&&se[_t]===0||(lt&&(lt=!1),ve!==_t?(he+=se[_t].toString(16),_t!==7&&(he+=":")):(he+=_t===0?"::":":",lt=!0));return he}function J(se,he,ve,ye,Ae){var Ue,Je,et,lt;if(ye===void 0){ye={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var _t=/^[\u0000-\u001F\u0020]+/,nn=/[\u0000-\u001F\u0020]+$/;(_t.test(se)||nn.test(se))&&w("Input string contains leading or trailing control characters or space."),se=(se=se.replace(_t,"")).replace(nn,"")}var Ot=/[\u0009\u000A\u000D]/g;Ot.test(se)&&w("Input string contains tab or newline characters."),se=se.replace(Ot,"");var ft=Ae===void 0?c.ParserState.SchemeStart:Ae;he===void 0&&(he=null);for(var _n=ve===void 0||ve==="replacement"||ve==="UTF-16BE"||ve==="UTF-16LE"?"UTF-8":ve,Se="",Gt=!1,Vt=!1,wt=!1,Fe=new l.StringWalker(se);;){switch(ft){case c.ParserState.SchemeStart:if(d.codePoint.ASCIIAlpha.test(Fe.c()))Se+=Fe.c().toLowerCase(),ft=c.ParserState.Scheme;else{if(Ae!==void 0)return w("Invalid scheme start character."),null;ft=c.ParserState.NoScheme,Fe.pointer--}break;case c.ParserState.Scheme:if(d.codePoint.ASCIIAlphanumeric.test(Fe.c())||Fe.c()==="+"||Fe.c()==="-"||Fe.c()===".")Se+=Fe.c().toLowerCase();else{if(Fe.c()!==":"){if(Ae===void 0){Se="",ft=c.ParserState.NoScheme,Fe.pointer=0;continue}return w("Invalid input string."),null}if(Ae!==void 0&&(M(ye.scheme)&&!M(Se)||!M(ye.scheme)&&M(Se)||(k(ye)||ye.port!==null)&&Se==="file"||ye.scheme==="file"&&(ye.host===""||ye.host===null)))return ye;if(ye.scheme=Se,Ae!==void 0)return ye.port===A(ye.scheme)&&(ye.port=null),ye;Se="",ye.scheme==="file"?(Fe.remaining().startsWith("//")||w("Invalid file URL scheme, '//' expected."),ft=c.ParserState.File):I(ye)&&he!==null&&he.scheme===ye.scheme?ft=c.ParserState.SpecialRelativeOrAuthority:I(ye)?ft=c.ParserState.SpecialAuthoritySlashes:Fe.remaining().startsWith("/")?(ft=c.ParserState.PathOrAuthority,Fe.pointer++):(ye._cannotBeABaseURLFlag=!0,ye.path.push(""),ft=c.ParserState.CannotBeABaseURLPath)}break;case c.ParserState.NoScheme:if(he===null||he._cannotBeABaseURLFlag&&Fe.c()!=="#")return w("Invalid input string."),null;he._cannotBeABaseURLFlag&&Fe.c()==="#"?(ye.scheme=he.scheme,ye.path=d.list.clone(he.path),ye.query=he.query,ye.fragment="",ye._cannotBeABaseURLFlag=!0,ft=c.ParserState.Fragment):he.scheme!=="file"?(ft=c.ParserState.Relative,Fe.pointer--):(ft=c.ParserState.File,Fe.pointer--);break;case c.ParserState.SpecialRelativeOrAuthority:Fe.c()==="/"&&Fe.remaining().startsWith("/")?(ft=c.ParserState.SpecialAuthorityIgnoreSlashes,Fe.pointer++):(w("Invalid input string."),ft=c.ParserState.Relative,Fe.pointer--);break;case c.ParserState.PathOrAuthority:Fe.c()==="/"?ft=c.ParserState.Authority:(ft=c.ParserState.Path,Fe.pointer--);break;case c.ParserState.Relative:if(he===null)throw new Error("Invalid parser state. Base URL is null.");switch(ye.scheme=he.scheme,Fe.c()){case"":ye.username=he.username,ye.password=he.password,ye.host=he.host,ye.port=he.port,ye.path=d.list.clone(he.path),ye.query=he.query;break;case"/":ft=c.ParserState.RelativeSlash;break;case"?":ye.username=he.username,ye.password=he.password,ye.host=he.host,ye.port=he.port,ye.path=d.list.clone(he.path),ye.query="",ft=c.ParserState.Query;break;case"#":ye.username=he.username,ye.password=he.password,ye.host=he.host,ye.port=he.port,ye.path=d.list.clone(he.path),ye.query=he.query,ye.fragment="",ft=c.ParserState.Fragment;break;default:I(ye)&&Fe.c()==="\\"?(w("Invalid input string."),ft=c.ParserState.RelativeSlash):(ye.username=he.username,ye.password=he.password,ye.host=he.host,ye.port=he.port,ye.path=d.list.clone(he.path),ye.path.length!==0&&ye.path.splice(ye.path.length-1,1),ft=c.ParserState.Path,Fe.pointer--)}break;case c.ParserState.RelativeSlash:if(!I(ye)||Fe.c()!=="/"&&Fe.c()!=="\\")if(Fe.c()==="/")ft=c.ParserState.Authority;else{if(he===null)throw new Error("Invalid parser state. Base URL is null.");ye.username=he.username,ye.password=he.password,ye.host=he.host,ye.port=he.port,ft=c.ParserState.Path,Fe.pointer--}else Fe.c()==="\\"&&w("Invalid input string."),ft=c.ParserState.SpecialAuthorityIgnoreSlashes;break;case c.ParserState.SpecialAuthoritySlashes:Fe.c()==="/"&&Fe.remaining().startsWith("/")?(ft=c.ParserState.SpecialAuthorityIgnoreSlashes,Fe.pointer++):(w("Expected '//'."),ft=c.ParserState.SpecialAuthorityIgnoreSlashes,Fe.pointer--);break;case c.ParserState.SpecialAuthorityIgnoreSlashes:Fe.c()!=="/"&&Fe.c()!=="\\"?(ft=c.ParserState.Authority,Fe.pointer--):w("Unexpected '/' or '\\'.");break;case c.ParserState.Authority:if(Fe.c()==="@"){w("Unexpected '@'."),Gt&&(Se="%40"+Se),Gt=!0;try{for(var Qe=(Ue=void 0,a(Se)),ze=Qe.next();!ze.done;ze=Qe.next()){var je=ze.value;if(je!==":"||wt){var rt=Be(je,T);wt?ye.password+=rt:ye.username+=rt}else wt=!0}}catch(j){Ue={error:j}}finally{try{ze&&!ze.done&&(Je=Qe.return)&&Je.call(Qe)}finally{if(Ue)throw Ue.error}}Se=""}else if(Fe.c()===""||Fe.c()==="/"||Fe.c()==="?"||Fe.c()==="#"||I(ye)&&Fe.c()==="\\"){if(Gt&&Se==="")return w("Invalid input string."),null;Fe.pointer-=Se.length+1,Se="",ft=c.ParserState.Host}else Se+=Fe.c();break;case c.ParserState.Host:case c.ParserState.Hostname:if(Ae!==void 0&&ye.scheme==="file")Fe.pointer--,ft=c.ParserState.FileHost;else if(Fe.c()!==":"||Vt)if(Fe.c()===""||Fe.c()==="/"||Fe.c()==="?"||Fe.c()==="#"||I(ye)&&Fe.c()==="\\"){if(Fe.pointer--,I(ye)&&Se==="")return w("Invalid input string."),null;if(Ae!==void 0&&Se===""&&(k(ye)||ye.port!==null))return w("Invalid input string."),ye;if((ht=ee(Se,!I(ye)))===null)return null;if(ye.host=ht,Se="",ft=c.ParserState.PathStart,Ae!==void 0)return ye}else Fe.c()==="["&&(Vt=!0),Fe.c()==="]"&&(Vt=!1),Se+=Fe.c();else{if(Se==="")return w("Invalid input string."),null;if((ht=ee(Se,!I(ye)))===null)return null;if(ye.host=ht,Se="",ft=c.ParserState.Port,Ae===c.ParserState.Hostname)return ye}break;case c.ParserState.Port:if(d.codePoint.ASCIIDigit.test(Fe.c()))Se+=Fe.c();else{if(!(Fe.c()===""||Fe.c()==="/"||Fe.c()==="?"||Fe.c()==="#"||I(ye)&&Fe.c()==="\\"||Ae))return w("Invalid input string."),null;if(Se!==""&&Se!==""){var dt=parseInt(Se,10);if(dt>Math.pow(2,16)-1)return w("Invalid port number."),null;ye.port=dt===A(ye.scheme)?null:dt,Se=""}if(Ae!==void 0)return ye;ft=c.ParserState.PathStart,Fe.pointer--}break;case c.ParserState.File:if(ye.scheme="file",Fe.c()==="/"||Fe.c()==="\\")Fe.c()==="\\"&&w("Invalid input string."),ft=c.ParserState.FileSlash;else if(he!==null&&he.scheme==="file")switch(Fe.c()){case"":ye.host=he.host,ye.path=d.list.clone(he.path),ye.query=he.query;break;case"?":ye.host=he.host,ye.path=d.list.clone(he.path),ye.query="",ft=c.ParserState.Query;break;case"#":ye.host=he.host,ye.path=d.list.clone(he.path),ye.query=he.query,ye.fragment="",ft=c.ParserState.Fragment;break;default:te(Fe.substring())?w("Unexpected windows drive letter in input string."):(ye.host=he.host,ye.path=d.list.clone(he.path),fe(ye)),ft=c.ParserState.Path,Fe.pointer--}else ft=c.ParserState.Path,Fe.pointer--;break;case c.ParserState.FileSlash:Fe.c()==="/"||Fe.c()==="\\"?(Fe.c()==="\\"&&w("Invalid input string."),ft=c.ParserState.FileHost):(he===null||he.scheme!=="file"||te(Fe.substring())||(pe(he.path[0])?ye.path.push(he.path[0]):ye.host=he.host),ft=c.ParserState.Path,Fe.pointer--);break;case c.ParserState.FileHost:if(Fe.c()===""||Fe.c()==="/"||Fe.c()==="\\"||Fe.c()==="?"||Fe.c()==="#")if(Fe.pointer--,Ae===void 0&&ie(Se))w("Unexpected windows drive letter in input string."),ft=c.ParserState.Path;else if(Se===""){if(ye.host="",Ae!==void 0)return ye;ft=c.ParserState.PathStart}else{var ht;if((ht=ee(Se,!I(ye)))===null)return null;if(ht==="localhost"&&(ht=""),ye.host=ht,Ae!==void 0)return ye;Se="",ft=c.ParserState.PathStart}else Se+=Fe.c();break;case c.ParserState.PathStart:I(ye)?(Fe.c()==="\\"&&w("Invalid input string."),ft=c.ParserState.Path,Fe.c()!=="/"&&Fe.c()!=="\\"&&Fe.pointer--):Ae===void 0&&Fe.c()==="?"?(ye.query="",ft=c.ParserState.Query):Ae===void 0&&Fe.c()==="#"?(ye.fragment="",ft=c.ParserState.Fragment):Fe.c()!==""&&(ft=c.ParserState.Path,Fe.c()!=="/"&&Fe.pointer--);break;case c.ParserState.Path:if(Fe.c()===""||Fe.c()==="/"||I(ye)&&Fe.c()==="\\"||Ae===void 0&&(Fe.c()==="?"||Fe.c()==="#")){if(I(ye)&&Fe.c()==="\\"&&w("Invalid input string."),re(Se))fe(ye),Fe.c()==="/"||I(ye)&&Fe.c()==="\\"||ye.path.push("");else if(!X(Se)||Fe.c()==="/"||I(ye)&&Fe.c()==="\\"){if(!X(Se)){if(ye.scheme==="file"&&ye.path.length===0&&ie(Se)){ye.host!==null&&ye.host!==""&&(w("Invalid input string."),ye.host="");var mt=Array.from(Se);Se=mt.slice(0,1)+":"+mt.slice(2)}ye.path.push(Se)}}else ye.path.push("");if(Se="",ye.scheme==="file"&&(Fe.c()===""||Fe.c()==="?"||Fe.c()==="#"))for(;ye.path.length>1&&ye.path[0]==="";)w("Invalid input string."),ye.path.splice(0,1);Fe.c()==="?"&&(ye.query="",ft=c.ParserState.Query),Fe.c()==="#"&&(ye.fragment="",ft=c.ParserState.Fragment)}else _.test(Fe.c())||Fe.c()==="%"||w("Character is not a URL code point or a percent encoded character."),Fe.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Fe.remaining())||w("Percent encoded character must be followed by two hex digits."),Se+=Be(Fe.c(),x);break;case c.ParserState.CannotBeABaseURLPath:Fe.c()==="?"?(ye.query="",ft=c.ParserState.Query):Fe.c()==="#"?(ye.fragment="",ft=c.ParserState.Fragment):(Fe.c()===""||_.test(Fe.c())||Fe.c()==="%"||w("Character is not a URL code point or a percent encoded character."),Fe.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Fe.remaining())||w("Percent encoded character must be followed by two hex digits."),Fe.c()!==""&&(ye.path[0]+=Be(Fe.c(),p)));break;case c.ParserState.Query:if(_n==="UTF-8"||I(ye)&&ye.scheme!=="ws"&&ye.scheme!=="wss"||(_n="UTF-8"),Ae===void 0&&Fe.c()==="#")ye.fragment="",ft=c.ParserState.Fragment;else if(Fe.c()!==""){if(_.test(Fe.c())||Fe.c()==="%"||w("Character is not a URL code point or a percent encoded character."),Fe.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Fe.remaining())||w("Percent encoded character must be followed by two hex digits."),_n.toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var At=l.utf8Encode(Fe.c());if(At.length>=3&&At[0]===38&&At[1]===35&&At[At.length-1]===59)At=At.subarray(2,At.length-1),ye.query+="%26%23"+d.byteSequence.isomorphicDecode(At)+"%3B";else try{for(var kn=(et=void 0,a(At)),Kn=kn.next();!Kn.done;Kn=kn.next()){var Xt=Kn.value;Xt<33||Xt>126||Xt===34||Xt===35||Xt===60||Xt===62||Xt===39&&I(ye)?ye.query+=Ve(Xt):ye.query+=String.fromCharCode(Xt)}}catch(j){et={error:j}}finally{try{Kn&&!Kn.done&&(lt=kn.return)&&lt.call(kn)}finally{if(et)throw et.error}}}break;case c.ParserState.Fragment:Fe.c()===""||(Fe.c()==="\0"?w("NULL character in input string."):(_.test(Fe.c())||Fe.c()==="%"||w("Unexpected character in fragment string."),Fe.c()!=="%"||/^[A-Za-z0-9][A-Za-z0-9]/.test(Fe.remaining())||w("Unexpected character in fragment string."),ye.fragment+=Be(Fe.c(),C)))}if(Fe.eof)break;Fe.pointer++}return ye}function X(se){return se==="."||se.toLowerCase()==="%2e"}function re(se){var he=se.toLowerCase();return he===".."||he===".%2e"||he==="%2e."||he==="%2e%2e"}function fe(se){var he=se.path;he.length!==0&&(se.scheme==="file"&&he.length===1&&pe(he[0])||se.path.splice(se.path.length-1,1))}function pe(se){return se.length>=2&&d.codePoint.ASCIIAlpha.test(se[0])&&se[1]===":"}function ie(se){return se.length>=2&&d.codePoint.ASCIIAlpha.test(se[0])&&(se[1]===":"||se[1]==="|")}function te(se){return se.length>=2&&ie(se)&&(se.length===2||se[2]==="/"||se[2]==="\\"||se[2]==="?"||se[2]==="#")}function ee(se,he){if(he===void 0&&(he=!1),se.startsWith("["))return se.endsWith("]")?De(se.substring(1,se.length-1)):(w("Expected ']' after '['."),null);if(he)return Re(se);var ve=ce(l.utf8Decode(qe(se)));if(ve===null||y.test(ve))return w("Invalid domain."),null;var ye=Ce(ve);return ye===null||l.isNumber(ye)?ye:ve}function we(se,he){he===void 0&&(he={value:!1});var ve=10;return se.startsWith("0x")||se.startsWith("0X")?(he.value=!0,se=se.substr(2),ve=16):se.length>=2&&se[0]==="0"&&(he.value=!0,se=se.substr(1),ve=8),se===""?0:(ve===10?/^[0-9]+$/:ve===16?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(se)?parseInt(se,ve):null}function Ce(se){var he,ve,ye,Ae,Ue={value:!1},Je=se.split(".");if(Je[Je.length-1]===""&&(Ue.value=!0,Je.length>1&&Je.pop()),Je.length>4)return se;var et=[];try{for(var lt=a(Je),_t=lt.next();!_t.done;_t=lt.next()){var nn=_t.value;if(nn===""||(Vt=we(nn,Ue))===null)return se;et.push(Vt)}}catch(wt){he={error:wt}}finally{try{_t&&!_t.done&&(ve=lt.return)&&ve.call(lt)}finally{if(he)throw he.error}}Ue.value&&w("Invalid IP v4 address.");for(var Ot=0;Ot<et.length;Ot++)if(et[Ot]>255&&(w("Invalid IP v4 address."),Ot<et.length-1))return null;if(et[et.length-1]>=Math.pow(256,5-et.length))return w("Invalid IP v4 address."),null;var ft=et[et.length-1];et.pop();var _n=0;try{for(var Se=a(et),Gt=Se.next();!Gt.done;Gt=Se.next()){var Vt;ft+=(Vt=Gt.value)*Math.pow(256,3-_n),_n++}}catch(wt){ye={error:wt}}finally{try{Gt&&!Gt.done&&(Ae=Se.return)&&Ae.call(Se)}finally{if(ye)throw ye.error}}return ft}function De(se){var he,ve=[0,0,0,0,0,0,0,0],ye=0,Ae=null,Ue=new l.StringWalker(se);if(Ue.c()===":"){if(!Ue.remaining().startsWith(":"))return w("Invalid IP v6 address."),null;Ue.pointer+=2,Ae=ye+=1}for(;Ue.c()!=="";){if(ye===8)return w("Invalid IP v6 address."),null;if(Ue.c()!==":"){for(var Je=0,et=0;et<4&&d.codePoint.ASCIIHexDigit.test(Ue.c());)Je=16*Je+parseInt(Ue.c(),16),Ue.pointer++,et++;if(Ue.c()==="."){if(et===0||(Ue.pointer-=et,ye>6))return w("Invalid IP v6 address."),null;for(var lt=0;Ue.c()!=="";){var _t=null;if(lt>0){if(!(Ue.c()==="."&&lt<4))return w("Invalid IP v6 address."),null;Ue.pointer++}if(!d.codePoint.ASCIIDigit.test(Ue.c()))return w("Invalid IP v6 address."),null;for(;d.codePoint.ASCIIDigit.test(Ue.c());){var nn=parseInt(Ue.c(),10);if(_t===null)_t=nn;else{if(_t===0)return w("Invalid IP v6 address."),null;_t=10*_t+nn}if(_t>255)return w("Invalid IP v6 address."),null;Ue.pointer++}if(_t===null)return w("Invalid IP v6 address."),null;ve[ye]=256*ve[ye]+_t,++lt!==2&&lt!==4||ye++}if(lt!==4)return w("Invalid IP v6 address."),null;break}if(Ue.c()===":"){if(Ue.pointer++,Ue.c()==="")return w("Invalid IP v6 address."),null}else if(Ue.c()!=="")return w("Invalid IP v6 address."),null;ve[ye]=Je,ye++}else{if(Ae!==null)return w("Invalid IP v6 address."),null;Ue.pointer++,Ae=++ye}}if(Ae!==null){var Ot=ye-Ae;for(ye=7;ye!==0&&Ot>0;)he=o([ve[Ae+Ot-1],ve[ye]],2),ve[ye]=he[0],ve[Ae+Ot-1]=he[1],ye--,Ot--}else if(Ae===null&&ye!==8)return w("Invalid IP v6 address."),null;return ve}function Re(se){var he,ve;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(se))return w("Invalid host string."),null;var ye="";try{for(var Ae=a(se),Ue=Ae.next();!Ue.done;Ue=Ae.next())ye+=Be(Ue.value,p)}catch(Je){he={error:Je}}finally{try{Ue&&!Ue.done&&(ve=Ae.return)&&ve.call(Ae)}finally{if(he)throw he.error}}return ye}function Oe(se){return null}function Ve(se){return"%"+("00"+se.toString(16).toUpperCase()).slice(-2)}function Ge(se){for(var he=function(et){return et>=48&&et<=57||et>=65&&et<=70||et>=97&&et<=102},ve=new Uint8Array(se.length),ye=0,Ae=0;Ae<se.length;Ae++){var Ue=se[Ae];if(Ue!==37)ve[ye]=Ue,ye++;else if(Ue===37&&Ae>=se.length-2)ve[ye]=Ue,ye++;else if(Ue!==37||he(se[Ae+1])&&he(se[Ae+2])){var Je=parseInt(l.utf8Decode(Uint8Array.of(se[Ae+1],se[Ae+2])),16);ve[ye]=Je,ye++,Ae+=2}else ve[ye]=Ue,ye++}return ve.subarray(0,ye)}function qe(se){return Ge(l.utf8Encode(se))}function Be(se,he){var ve,ye;if(!he.test(se))return se;var Ae=l.utf8Encode(se),Ue="";try{for(var Je=a(Ae),et=Je.next();!et.done;et=Je.next())Ue+=Ve(et.value)}catch(lt){ve={error:lt}}finally{try{et&&!et.done&&(ye=Je.return)&&ye.call(Je)}finally{if(ve)throw ve.error}}return Ue}function ae(se){var he,ve,ye,Ae,Ue=[],Je=[];try{for(var et=a(se),lt=et.next();!lt.done;lt=et.next()){var _t=lt.value;_t===38?(Ue.push(Uint8Array.from(Je)),Je=[]):Je.push(_t)}}catch(ze){he={error:ze}}finally{try{lt&&!lt.done&&(ve=et.return)&&ve.call(et)}finally{if(he)throw he.error}}Je.length!==0&&Ue.push(Uint8Array.from(Je));var nn=[];try{for(var Ot=a(Ue),ft=Ot.next();!ft.done;ft=Ot.next()){var _n=ft.value;if(_n.length!==0){for(var Se=_n.indexOf(61),Gt=Se!==-1?_n.slice(0,Se):_n,Vt=Se!==-1?_n.slice(Se+1):new Uint8Array,wt=0;wt<Gt.length;wt++)Gt[wt]===43&&(Gt[wt]=32);for(wt=0;wt<Vt.length;wt++)Vt[wt]===43&&(Vt[wt]=32);var Fe=l.utf8Decode(Gt),Qe=l.utf8Decode(Vt);nn.push([Fe,Qe])}}}catch(ze){ye={error:ze}}finally{try{ft&&!ft.done&&(Ae=Ot.return)&&Ae.call(Ot)}finally{if(ye)throw ye.error}}return nn}function H(se){var he,ve,ye="";try{for(var Ae=a(se),Ue=Ae.next();!Ue.done;Ue=Ae.next()){var Je=Ue.value;ye+=Je===32?"+":Je===42||Je===45||Je===46||Je>=48&&Je<=57||Je>=65&&Je<=90||Je===95||Je>=97&&Je<=122?String.fromCodePoint(Je):Ve(Je)}}catch(et){he={error:et}}finally{try{Ue&&!Ue.done&&(ve=Ae.return)&&ve.call(Ae)}finally{if(he)throw he.error}}return ye}function ce(se,he){var ve=f.domainToASCII(se);return ve===""?(w("Invalid domain name."),null):ve}r.setValidationErrorCallback=function(se){s=se},r.newURL=b,r.isSpecialScheme=M,r.isSpecial=I,r.defaultPort=A,r.includesCredentials=k,r.cannotHaveAUsernamePasswordPort=function(se){return se.host===null||se.host===""||se._cannotBeABaseURLFlag||se.scheme==="file"},r.urlSerializer=U,r.hostSerializer=B,r.iPv4Serializer=z,r.iPv6Serializer=K,r.urlParser=function(se,he,ve){var ye=J(se,he,ve);return ye===null?null:(ye.scheme!=="blob"||(ye._blobURLEntry=null),ye)},r.basicURLParser=J,r.setTheUsername=function(se,he){var ve,ye,Ae="";try{for(var Ue=a(he),Je=Ue.next();!Je.done;Je=Ue.next())Ae+=Be(Je.value,T)}catch(et){ve={error:et}}finally{try{Je&&!Je.done&&(ye=Ue.return)&&ye.call(Ue)}finally{if(ve)throw ve.error}}se.username=Ae},r.setThePassword=function(se,he){var ve,ye,Ae="";try{for(var Ue=a(he),Je=Ue.next();!Je.done;Je=Ue.next())Ae+=Be(Je.value,T)}catch(et){ve={error:et}}finally{try{Je&&!Je.done&&(ye=Ue.return)&&ye.call(Ue)}finally{if(ve)throw ve.error}}se.password=Ae},r.isSingleDotPathSegment=X,r.isDoubleDotPathSegment=re,r.shorten=fe,r.isNormalizedWindowsDriveLetter=pe,r.isWindowsDriveLetter=ie,r.startsWithAWindowsDriveLetter=te,r.hostParser=ee,r.iPv4NumberParser=we,r.iPv4Parser=Ce,r.iPv6Parser=De,r.opaqueHostParser=Re,r.resolveABlobURL=Oe,r.percentEncode=Ve,r.percentDecode=Ge,r.stringPercentDecode=qe,r.utf8PercentEncode=Be,r.hostEquals=function(se,he){return se===he},r.urlEquals=function(se,he,ve){return ve===void 0&&(ve=!1),U(se,ve)===U(he,ve)},r.urlEncodedStringParser=function(se){return ae(l.utf8Encode(se))},r.urlEncodedParser=ae,r.urlEncodedByteSerializer=H,r.urlEncodedSerializer=function(se,he){var ve,ye;if((he===void 0||he==="replacement"||he==="UTF-16BE"||he==="UTF-16LE"?"UTF-8":he).toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var Ae="";try{for(var Ue=a(se),Je=Ue.next();!Je.done;Je=Ue.next()){var et=Je.value,lt=H(l.utf8Encode(et[0])),_t=et[1];_t=H(l.utf8Encode(_t)),Ae!==""&&(Ae+="&"),Ae+=lt+"="+_t}}catch(nn){ve={error:nn}}finally{try{Je&&!Je.done&&(ye=Ue.return)&&ye.call(Ue)}finally{if(ve)throw ve.error}}return Ae},r.origin=function se(he){switch(he.scheme){case"blob":he._blobURLEntry;var ve=J(he.path[0]);return ve===null?c.OpaqueOrigin:se(ve);case"ftp":case"http":case"https":case"ws":case"wss":return[he.scheme,he.host===null?"":he.host,he.port,null];case"file":default:return c.OpaqueOrigin}},r.domainToASCII=ce,r.domainToUnicode=function(se,he){var ve=f.domainToUnicode(se);return ve===""&&w("Invalid domain name."),ve},r.asciiSerializationOfAnOrigin=function(se){if(se[0]===""&&se[1]===""&&se[2]===null&&se[3]===null)return"null";var he=se[0]+"://"+B(se[1]);return se[2]!==null&&(he+=":"+se[2].toString()),he}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(0),o=function(){function s(){this._signal=a.create_abortSignal()}return Object.defineProperty(s.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),s.prototype.abort=function(){a.abort_signalAbort(this._signal)},s}();r.AbortControllerImpl=o},function(n,r,i){var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(70),l=i(0),c=function(d){function f(){var h=d.call(this)||this;return h._abortedFlag=!1,h._abortAlgorithms=new Set,h}return o(f,d),Object.defineProperty(f.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onabort",{get:function(){return l.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(h){l.event_setterEventHandlerIDLAttribute(this,"onabort",h)},enumerable:!0,configurable:!0}),f._create=function(){return new f},f}(s.EventTargetImpl);r.AbortSignalImpl=c},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(34),c=i(12),d=function(f){function h(p,C,x){var T=f.call(this)||this;return T._name="",T._publicId="",T._systemId="",T._name=p,T._publicId=C,T._systemId=x,T}return o(h,f),Object.defineProperty(h.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),h.prototype.before=function(){for(var p=[],C=0;C<arguments.length;C++)p[C]=arguments[C];throw new Error("Mixin: ChildNode not implemented.")},h.prototype.after=function(){for(var p=[],C=0;C<arguments.length;C++)p[C]=arguments[C];throw new Error("Mixin: ChildNode not implemented.")},h.prototype.replaceWith=function(){for(var p=[],C=0;C<arguments.length;C++)p[C]=arguments[C];throw new Error("Mixin: ChildNode not implemented.")},h.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},h._create=function(p,C,x,T){x===void 0&&(x=""),T===void 0&&(T="");var _=new h(C,x,T);return _._nodeDocument=p,_},h}(l.NodeImpl);r.DocumentTypeImpl=d,c.idl_defineConst(d.prototype,"_nodeType",s.NodeType.DocumentType)},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(100),l=i(1),c=i(0),d=function(f){function h(p,C){var x=f.call(this)||this;return x._host=p,x._mode=C,x}return o(h,f),Object.defineProperty(h.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),h.prototype._getTheParent=function(p){return p._composedFlag||l.isEmpty(p._path)||c.tree_rootNode(p._path[0].invocationTarget)!==this?this._host:null},h._create=function(p,C){return new h(C,"closed")},h}(s.DocumentFragmentImpl);r.ShadowRootImpl=d},function(n,r,i){var a,o=this&&this.__extends||(a=function(h,p){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,x){C.__proto__=x}||function(C,x){for(var T in x)x.hasOwnProperty(T)&&(C[T]=x[T])})(h,p)},function(h,p){function C(){this.constructor=h}a(h,p),h.prototype=p===null?Object.create(p):(C.prototype=p.prototype,new C)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(34),c=i(0),d=i(12),f=function(h){function p(C){var x=h.call(this)||this;return x._namespace=null,x._namespacePrefix=null,x._element=null,x._value="",x._localName=C,x}return o(p,h),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this._value},set:function(C){c.attr_setAnExistingAttributeValue(this,C)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix!==null?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),p._create=function(C,x){var T=new p(x);return T._nodeDocument=C,T},p}(l.NodeImpl);r.AttrImpl=f,d.idl_defineConst(f.prototype,"_nodeType",s.NodeType.Attribute),d.idl_defineConst(f.prototype,"specified",!0)},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(101),l=i(2),c=i(12),d=function(f){function h(p){return f.call(this,p)||this}return o(h,f),h._create=function(p,C){C===void 0&&(C="");var x=new h(C);return x._nodeDocument=p,x},h}(s.TextImpl);r.CDATASectionImpl=d,c.idl_defineConst(d.prototype,"_nodeType",l.NodeType.CData)},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(71),c=i(12),d=function(f){function h(p){return p===void 0&&(p=""),f.call(this,p)||this}return o(h,f),h._create=function(p,C){C===void 0&&(C="");var x=new h(C);return x._nodeDocument=p,x},h}(l.CharacterDataImpl);r.CommentImpl=d,c.idl_defineConst(d.prototype,"_nodeType",s.NodeType.Comment)},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(71),c=i(12),d=function(f){function h(p,C){var x=f.call(this,C)||this;return x._target=p,x}return o(h,f),Object.defineProperty(h.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),h._create=function(p,C,x){var T=new h(C,x);return T._nodeDocument=p,T},h}(l.CharacterDataImpl);r.ProcessingInstructionImpl=d,c.idl_defineConst(d.prototype,"_nodeType",s.NodeType.ProcessingInstruction)},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(7),o=i(0),s=i(3),l=i(1),c=function(){function d(f,h){return this._live=!0,this._root=f,this._filter=h,new Proxy(this,this)}return Object.defineProperty(d.prototype,"length",{get:function(){for(var f=this,h=0,p=o.tree_getFirstDescendantNode(this._root,!1,!1,function(C){return s.Guard.isElementNode(C)&&f._filter(C)});p!==null;)h++,p=o.tree_getNextDescendantNode(this._root,p,!1,!1,function(C){return s.Guard.isElementNode(C)&&f._filter(C)});return h},enumerable:!0,configurable:!0}),d.prototype.item=function(f){for(var h=this,p=0,C=o.tree_getFirstDescendantNode(this._root,!1,!1,function(x){return s.Guard.isElementNode(x)&&h._filter(x)});C!==null;){if(p===f)return C;p++,C=o.tree_getNextDescendantNode(this._root,C,!1,!1,function(x){return s.Guard.isElementNode(x)&&h._filter(x)})}return null},d.prototype.namedItem=function(f){var h=this;if(f==="")return null;for(var p=o.tree_getFirstDescendantNode(this._root,!1,!1,function(T){return s.Guard.isElementNode(T)&&h._filter(T)});p!=null;){if(p._uniqueIdentifier===f)return p;if(p._namespace===a.namespace.HTML)for(var C=0;C<p._attributeList.length;C++){var x=p._attributeList[C];if(x._localName==="name"&&x._namespace===null&&x._namespacePrefix===null&&x._value===f)return p}p=o.tree_getNextDescendantNode(this._root,p,!1,!1,function(T){return s.Guard.isElementNode(T)&&h._filter(T)})}return null},d.prototype[Symbol.iterator]=function(){var f=this._root,h=this._filter,p=o.tree_getFirstDescendantNode(f,!1,!1,function(C){return s.Guard.isElementNode(C)&&h(C)});return{next:function(){if(p===null)return{done:!0,value:null};var C={done:!1,value:p};return p=o.tree_getNextDescendantNode(f,p,!1,!1,function(x){return s.Guard.isElementNode(x)&&h(x)}),C}}},d.prototype.get=function(f,h,p){if(!l.isString(h)||d.reservedNames.indexOf(h)!==-1)return Reflect.get(f,h,p);var C=Number(h);return isNaN(C)?f.namedItem(h)||void 0:f.item(C)||void 0},d.prototype.set=function(f,h,p,C){if(!l.isString(h)||d.reservedNames.indexOf(h)!==-1)return Reflect.set(f,h,p,C);var x=Number(h),T=isNaN(x)?f.namedItem(h)||void 0:f.item(x)||void 0;return!(!T||!T._parent)&&(o.mutation_replace(T,p,T._parent),!0)},d._create=function(f,h){return h===void 0&&(h=function(){return!0}),new d(f,h)},d.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],d}();r.HTMLCollectionImpl=c},function(n,r,i){var a=this&&this.__values||function(d){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&d[f],p=0;if(h)return h.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(1),l=i(0),c=function(){function d(f){return this._live=!0,this._filter=null,this._length=0,this._root=f,new Proxy(this,this)}return Object.defineProperty(d.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),d.prototype.item=function(f){if(f<0||f>this.length-1)return null;if(f<this.length/2){for(var h=0,p=this._root._firstChild;p!==null&&h!==f;)p=p._nextSibling,h++;return p}for(h=this.length-1,p=this._root._lastChild;p!==null&&h!==f;)p=p._previousSibling,h--;return p},d.prototype.keys=function(){var f;return(f={})[Symbol.iterator]=(function(){var h=0;return{next:(function(){return h===this.length?{done:!0,value:null}:{done:!1,value:h++}}).bind(this)}}).bind(this),f},d.prototype.values=function(){var f;return(f={})[Symbol.iterator]=(function(){var h=this[Symbol.iterator]();return{next:function(){return h.next()}}}).bind(this),f},d.prototype.entries=function(){var f;return(f={})[Symbol.iterator]=(function(){var h=this[Symbol.iterator](),p=0;return{next:function(){var C=h.next();return C.done?{done:!0,value:null}:{done:!1,value:[p++,C.value]}}}}).bind(this),f},d.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},d.prototype.forEach=function(f,h){var p,C;h===void 0&&(h=o.dom.window);var x=0;try{for(var T=a(this._root._children),_=T.next();!_.done;_=T.next()){var y=_.value;f.call(h,y,x++,this)}}catch(w){p={error:w}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(p)throw p.error}}},d.prototype.get=function(f,h,p){if(!s.isString(h))return Reflect.get(f,h,p);var C=Number(h);return isNaN(C)?Reflect.get(f,h,p):f.item(C)||void 0},d.prototype.set=function(f,h,p,C){if(!s.isString(h))return Reflect.set(f,h,p,C);var x=Number(h);if(isNaN(x))return Reflect.set(f,h,p,C);var T=f.item(x)||void 0;return!!T&&!!T._parent&&(l.mutation_replace(T,p,T._parent),!0)},d._create=function(f){return new d(f)},d}();r.NodeListImpl=c},function(n,r,i){var a=this&&this.__values||function(c){var d=typeof Symbol=="function"&&Symbol.iterator,f=d&&c[d],h=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&h>=c.length&&(c=void 0),{value:c&&c[h++],done:!c}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(1),l=function(){function c(d){return this._live=!1,this._items=[],this._length=0,this._root=d,this._items=[],this._filter=function(f){return!0},new Proxy(this,this)}return Object.defineProperty(c.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),c.prototype.item=function(d){return d<0||d>this.length-1?null:this._items[d]},c.prototype.keys=function(){var d;return(d={})[Symbol.iterator]=(function(){var f=0;return{next:(function(){return f===this.length?{done:!0,value:null}:{done:!1,value:f++}}).bind(this)}}).bind(this),d},c.prototype.values=function(){var d;return(d={})[Symbol.iterator]=(function(){var f=this[Symbol.iterator]();return{next:function(){return f.next()}}}).bind(this),d},c.prototype.entries=function(){var d;return(d={})[Symbol.iterator]=(function(){var f=this[Symbol.iterator](),h=0;return{next:function(){var p=f.next();return p.done?{done:!0,value:null}:{done:!1,value:[h++,p.value]}}}}).bind(this),d},c.prototype[Symbol.iterator]=function(){var d=this._items[Symbol.iterator]();return{next:function(){return d.next()}}},c.prototype.forEach=function(d,f){var h,p;f===void 0&&(f=o.dom.window);var C=0;try{for(var x=a(this._items),T=x.next();!T.done;T=x.next()){var _=T.value;d.call(f,_,C++,this)}}catch(y){h={error:y}}finally{try{T&&!T.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}},c.prototype.get=function(d,f,h){if(!s.isString(f))return Reflect.get(d,f,h);var p=Number(f);return isNaN(p)?Reflect.get(d,f,h):d._items[p]||void 0},c.prototype.set=function(d,f,h,p){if(!s.isString(f))return Reflect.set(d,f,h,p);var C=Number(f);return isNaN(C)?Reflect.set(d,f,h,p):C>=0&&C<d._items.length&&(d._items[C]=h,!0)},c._create=function(d,f){var h=new c(d);return h._items=f,h},c}();r.NodeListStaticImpl=l},function(n,r,i){var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(9),l=i(0),c=function(d){function f(h){var p=d.call(this)||this;return p._element=h,Object.setPrototypeOf(p,f.prototype),p}return o(f,d),f.prototype._asArray=function(){return this},f.prototype.item=function(h){return this[h]||null},f.prototype.getNamedItem=function(h){return l.element_getAnAttributeByName(h,this._element)},f.prototype.getNamedItemNS=function(h,p){return l.element_getAnAttributeByNamespaceAndLocalName(h||"",p,this._element)},f.prototype.setNamedItem=function(h){return l.element_setAnAttribute(h,this._element)},f.prototype.setNamedItemNS=function(h){return l.element_setAnAttribute(h,this._element)},f.prototype.removeNamedItem=function(h){var p=l.element_removeAnAttributeByName(h,this._element);if(p===null)throw new s.NotFoundError;return p},f.prototype.removeNamedItemNS=function(h,p){var C=l.element_removeAnAttributeByNamespaceAndLocalName(h||"",p,this._element);if(C===null)throw new s.NotFoundError;return C},f._create=function(h){return new f(h)},f}(Array);r.NamedNodeMapImpl=c},function(n,r,i){var a,o=this&&this.__extends||(a=function(T,_){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,w){y.__proto__=w}||function(y,w){for(var b in w)w.hasOwnProperty(b)&&(y[b]=w[b])})(T,_)},function(T,_){function y(){this.constructor=T}a(T,_),T.prototype=_===null?Object.create(_):(y.prototype=_.prototype,new y)}),s=this&&this.__values||function(T){var _=typeof Symbol=="function"&&Symbol.iterator,y=_&&T[_],w=0;if(y)return y.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&w>=T.length&&(T=void 0),{value:T&&T[w++],done:!T}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=i(2),d=i(102),f=i(9),h=i(0),p=i(12),C=i(3),x=function(T){function _(){var y=T.call(this)||this,w=l.dom.window._associatedDocument;return y._start=[w,0],y._end=[w,0],l.dom.rangeList.add(y),y}return o(_,T),Object.defineProperty(_.prototype,"commonAncestorContainer",{get:function(){for(var y=this._start[0];!h.tree_isAncestorOf(this._end[0],y,!0);){if(y._parent===null)throw new Error("Parent node  is null.");y=y._parent}return y},enumerable:!0,configurable:!0}),_.prototype.setStart=function(y,w){h.range_setTheStart(this,y,w)},_.prototype.setEnd=function(y,w){h.range_setTheEnd(this,y,w)},_.prototype.setStartBefore=function(y){var w=y._parent;if(w===null)throw new f.InvalidNodeTypeError;h.range_setTheStart(this,w,h.tree_index(y))},_.prototype.setStartAfter=function(y){var w=y._parent;if(w===null)throw new f.InvalidNodeTypeError;h.range_setTheStart(this,w,h.tree_index(y)+1)},_.prototype.setEndBefore=function(y){var w=y._parent;if(w===null)throw new f.InvalidNodeTypeError;h.range_setTheEnd(this,w,h.tree_index(y))},_.prototype.setEndAfter=function(y){var w=y._parent;if(w===null)throw new f.InvalidNodeTypeError;h.range_setTheEnd(this,w,h.tree_index(y)+1)},_.prototype.collapse=function(y){y?this._end=this._start:this._start=this._end},_.prototype.selectNode=function(y){h.range_select(y,this)},_.prototype.selectNodeContents=function(y){if(C.Guard.isDocumentTypeNode(y))throw new f.InvalidNodeTypeError;var w=h.tree_nodeLength(y);this._start=[y,0],this._end=[y,w]},_.prototype.compareBoundaryPoints=function(y,w){if(y!==c.HowToCompare.StartToStart&&y!==c.HowToCompare.StartToEnd&&y!==c.HowToCompare.EndToEnd&&y!==c.HowToCompare.EndToStart)throw new f.NotSupportedError;if(h.range_root(this)!==h.range_root(w))throw new f.WrongDocumentError;var b,M;switch(y){case c.HowToCompare.StartToStart:b=this._start,M=w._start;break;case c.HowToCompare.StartToEnd:b=this._end,M=w._start;break;case c.HowToCompare.EndToEnd:b=this._end,M=w._end;break;case c.HowToCompare.EndToStart:b=this._start,M=w._end;break;default:throw new f.NotSupportedError}var I=h.boundaryPoint_position(b,M);return I===c.BoundaryPosition.Before?-1:I===c.BoundaryPosition.After?1:0},_.prototype.deleteContents=function(){var y,w,b,M;if(!h.range_collapsed(this)){var I=this._startNode,A=this._startOffset,k=this._endNode,U=this._endOffset;if(I===k&&C.Guard.isCharacterDataNode(I))h.characterData_replaceData(I,A,U-A,"");else{var B,z,K=[];try{for(var J=s(h.range_getContainedNodes(this)),X=J.next();!X.done;X=J.next()){var re=(te=X.value)._parent;re!==null&&h.range_isContained(re,this)||K.push(te)}}catch(ee){y={error:ee}}finally{try{X&&!X.done&&(w=J.return)&&w.call(J)}finally{if(y)throw y.error}}if(h.tree_isAncestorOf(k,I,!0))B=I,z=A;else{for(var fe=I;fe._parent!==null&&!h.tree_isAncestorOf(k,fe._parent,!0);)fe=fe._parent;if(fe._parent===null)throw new Error("Parent node is null.");B=fe._parent,z=h.tree_index(fe)+1}C.Guard.isCharacterDataNode(I)&&h.characterData_replaceData(I,A,h.tree_nodeLength(I)-A,"");try{for(var pe=s(K),ie=pe.next();!ie.done;ie=pe.next()){var te;(te=ie.value)._parent&&h.mutation_remove(te,te._parent)}}catch(ee){b={error:ee}}finally{try{ie&&!ie.done&&(M=pe.return)&&M.call(pe)}finally{if(b)throw b.error}}C.Guard.isCharacterDataNode(k)&&h.characterData_replaceData(k,0,U,""),this._start=[B,z],this._end=[B,z]}}},_.prototype.extractContents=function(){return h.range_extract(this)},_.prototype.cloneContents=function(){return h.range_cloneTheContents(this)},_.prototype.insertNode=function(y){return h.range_insert(y,this)},_.prototype.surroundContents=function(y){var w,b;try{for(var M=s(h.range_getPartiallyContainedNodes(this)),I=M.next();!I.done;I=M.next()){var A=I.value;if(!C.Guard.isTextNode(A))throw new f.InvalidStateError}}catch(U){w={error:U}}finally{try{I&&!I.done&&(b=M.return)&&b.call(M)}finally{if(w)throw w.error}}if(C.Guard.isDocumentNode(y)||C.Guard.isDocumentTypeNode(y)||C.Guard.isDocumentFragmentNode(y))throw new f.InvalidNodeTypeError;var k=h.range_extract(this);y._children.size!==0&&h.mutation_replaceAll(null,y),h.range_insert(y,this),h.mutation_append(k,y),h.range_select(y,this)},_.prototype.cloneRange=function(){return h.create_range(this._start,this._end)},_.prototype.detach=function(){l.dom.rangeList.delete(this)},_.prototype.isPointInRange=function(y,w){if(h.tree_rootNode(y)!==h.range_root(this))return!1;if(C.Guard.isDocumentTypeNode(y))throw new f.InvalidNodeTypeError;if(w>h.tree_nodeLength(y))throw new f.IndexSizeError;var b=[y,w];return h.boundaryPoint_position(b,this._start)!==c.BoundaryPosition.Before&&h.boundaryPoint_position(b,this._end)!==c.BoundaryPosition.After},_.prototype.comparePoint=function(y,w){if(h.tree_rootNode(y)!==h.range_root(this))throw new f.WrongDocumentError;if(C.Guard.isDocumentTypeNode(y))throw new f.InvalidNodeTypeError;if(w>h.tree_nodeLength(y))throw new f.IndexSizeError;var b=[y,w];return h.boundaryPoint_position(b,this._start)===c.BoundaryPosition.Before?-1:h.boundaryPoint_position(b,this._end)===c.BoundaryPosition.After?1:0},_.prototype.intersectsNode=function(y){if(h.tree_rootNode(y)!==h.range_root(this))return!1;var w=y._parent;if(w===null)return!0;var b=h.tree_index(y);return h.boundaryPoint_position([w,b],this._end)===c.BoundaryPosition.Before&&h.boundaryPoint_position([w,b+1],this._start)===c.BoundaryPosition.After},_.prototype.toString=function(){var y,w,b="";if(this._startNode===this._endNode&&C.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);C.Guard.isTextNode(this._startNode)&&(b+=this._startNode._data.substring(this._startOffset));try{for(var M=s(h.range_getContainedNodes(this)),I=M.next();!I.done;I=M.next()){var A=I.value;C.Guard.isTextNode(A)&&(b+=A._data)}}catch(k){y={error:k}}finally{try{I&&!I.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}return C.Guard.isTextNode(this._endNode)&&(b+=this._endNode._data.substring(0,this._endOffset)),b},_._create=function(y,w){var b=new _;return y&&(b._start=y),w&&(b._end=w),b},_.START_TO_START=0,_.START_TO_END=1,_.END_TO_END=2,_.END_TO_START=3,_}(d.AbstractRangeImpl);r.RangeImpl=x,p.idl_defineConst(x.prototype,"START_TO_START",0),p.idl_defineConst(x.prototype,"START_TO_END",1),p.idl_defineConst(x.prototype,"END_TO_END",2),p.idl_defineConst(x.prototype,"END_TO_START",3)},function(n,r,i){var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(103),l=i(0),c=function(d){function f(h,p,C){var x=d.call(this,h)||this;return x._iteratorCollection=void 0,x._reference=p,x._pointerBeforeReference=C,l.nodeIterator_iteratorList().add(x),x}return o(f,d),Object.defineProperty(f.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),f.prototype.nextNode=function(){return l.nodeIterator_traverse(this,!0)},f.prototype.previousNode=function(){return l.nodeIterator_traverse(this,!1)},f.prototype.detach=function(){l.nodeIterator_iteratorList().delete(this)},f._create=function(h,p,C){return new f(h,p,C)},f}(s.TraverserImpl);r.NodeIteratorImpl=c},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(2),l=i(103),c=i(0),d=function(f){function h(p,C){var x=f.call(this,p)||this;return x._current=C,x}return o(h,f),Object.defineProperty(h.prototype,"currentNode",{get:function(){return this._current},set:function(p){this._current=p},enumerable:!0,configurable:!0}),h.prototype.parentNode=function(){for(var p=this._current;p!==null&&p!==this._root;)if((p=p._parent)!==null&&c.traversal_filter(this,p)===s.FilterResult.Accept)return this._current=p,p;return null},h.prototype.firstChild=function(){return c.treeWalker_traverseChildren(this,!0)},h.prototype.lastChild=function(){return c.treeWalker_traverseChildren(this,!1)},h.prototype.nextSibling=function(){return c.treeWalker_traverseSiblings(this,!0)},h.prototype.previousNode=function(){for(var p=this._current;p!==this._root;){for(var C=p._previousSibling;C;){p=C;for(var x=c.traversal_filter(this,p);x!==s.FilterResult.Reject&&p._lastChild;)p=p._lastChild,x=c.traversal_filter(this,p);if(x===s.FilterResult.Accept)return this._current=p,p;C=p._previousSibling}if(p===this._root||p._parent===null)return null;if(p=p._parent,c.traversal_filter(this,p)===s.FilterResult.Accept)return this._current=p,p}return null},h.prototype.previousSibling=function(){return c.treeWalker_traverseSiblings(this,!1)},h.prototype.nextNode=function(){for(var p=this._current,C=s.FilterResult.Accept;;){for(;C!==s.FilterResult.Reject&&p._firstChild;)if(p=p._firstChild,(C=c.traversal_filter(this,p))===s.FilterResult.Accept)return this._current=p,p;for(var x=null,T=p;T!==null;){if(T===this._root)return null;if((x=T._nextSibling)!==null){p=x;break}T=T._parent}if((C=c.traversal_filter(this,p))===s.FilterResult.Accept)return this._current=p,p}},h._create=function(p,C){return new h(p,C)},h}(l.TraverserImpl);r.TreeWalkerImpl=d},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=i(12),s=function(){function l(){}return l.prototype.acceptNode=function(c){return a.FilterResult.Accept},l._create=function(){return new l},l.FILTER_ACCEPT=1,l.FILTER_REJECT=2,l.FILTER_SKIP=3,l.SHOW_ALL=4294967295,l.SHOW_ELEMENT=1,l.SHOW_ATTRIBUTE=2,l.SHOW_TEXT=4,l.SHOW_CDATA_SECTION=8,l.SHOW_ENTITY_REFERENCE=16,l.SHOW_ENTITY=32,l.SHOW_PROCESSING_INSTRUCTION=64,l.SHOW_COMMENT=128,l.SHOW_DOCUMENT=256,l.SHOW_DOCUMENT_TYPE=512,l.SHOW_DOCUMENT_FRAGMENT=1024,l.SHOW_NOTATION=2048,l}();r.NodeFilterImpl=s,o.idl_defineConst(s.prototype,"FILTER_ACCEPT",1),o.idl_defineConst(s.prototype,"FILTER_REJECT",2),o.idl_defineConst(s.prototype,"FILTER_SKIP",3),o.idl_defineConst(s.prototype,"SHOW_ALL",4294967295),o.idl_defineConst(s.prototype,"SHOW_ELEMENT",1),o.idl_defineConst(s.prototype,"SHOW_ATTRIBUTE",2),o.idl_defineConst(s.prototype,"SHOW_TEXT",4),o.idl_defineConst(s.prototype,"SHOW_CDATA_SECTION",8),o.idl_defineConst(s.prototype,"SHOW_ENTITY_REFERENCE",16),o.idl_defineConst(s.prototype,"SHOW_ENTITY",32),o.idl_defineConst(s.prototype,"SHOW_PROCESSING_INSTRUCTION",64),o.idl_defineConst(s.prototype,"SHOW_COMMENT",128),o.idl_defineConst(s.prototype,"SHOW_DOCUMENT",256),o.idl_defineConst(s.prototype,"SHOW_DOCUMENT_TYPE",512),o.idl_defineConst(s.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),o.idl_defineConst(s.prototype,"SHOW_NOTATION",2048)},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(s,l,c,d,f,h,p,C,x){this._type=s,this._target=l,this._addedNodes=c,this._removedNodes=d,this._previousSibling=f,this._nextSibling=h,this._attributeName=p,this._attributeNamespace=C,this._oldValue=x}return Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),o._create=function(s,l,c,d,f,h,p,C,x){return new o(s,l,c,d,f,h,p,C,x)},o}();r.MutationRecordImpl=a},function(n,r,i){var a=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(9),l=i(7),c=i(0),d=function(){function f(h,p){this._element=h,this._attribute=p,this._tokenSet=new Set;var C=p._localName,x=c.element_getAnAttributeValue(h,C),T=this;this._element._attributeChangeSteps.push(function(_,y,w,b,M){y===T._attribute._localName&&M===null&&(b?T._tokenSet=c.orderedSet_parse(b):T._tokenSet.clear())}),o.dom.features.steps&&c.dom_runAttributeChangeSteps(h,C,x,x,null)}return Object.defineProperty(f.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),f.prototype.item=function(h){var p,C,x=0;try{for(var T=a(this._tokenSet),_=T.next();!_.done;_=T.next()){var y=_.value;if(x===h)return y;x++}}catch(w){p={error:w}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(p)throw p.error}}return null},f.prototype.contains=function(h){return this._tokenSet.has(h)},f.prototype.add=function(){for(var h,p,C=[],x=0;x<arguments.length;x++)C[x]=arguments[x];try{for(var T=a(C),_=T.next();!_.done;_=T.next()){var y=_.value;if(y==="")throw new s.SyntaxError("Cannot add an empty token.");if(l.codePoint.ASCIIWhiteSpace.test(y))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(y)}}catch(w){h={error:w}}finally{try{_&&!_.done&&(p=T.return)&&p.call(T)}finally{if(h)throw h.error}}c.tokenList_updateSteps(this)},f.prototype.remove=function(){for(var h,p,C=[],x=0;x<arguments.length;x++)C[x]=arguments[x];try{for(var T=a(C),_=T.next();!_.done;_=T.next()){var y=_.value;if(y==="")throw new s.SyntaxError("Cannot remove an empty token.");if(l.codePoint.ASCIIWhiteSpace.test(y))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(y)}}catch(w){h={error:w}}finally{try{_&&!_.done&&(p=T.return)&&p.call(T)}finally{if(h)throw h.error}}c.tokenList_updateSteps(this)},f.prototype.toggle=function(h,p){if(p===void 0&&(p=void 0),h==="")throw new s.SyntaxError("Cannot toggle an empty token.");if(l.codePoint.ASCIIWhiteSpace.test(h))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(h)?p!==void 0&&p!==!1||(this._tokenSet.delete(h),c.tokenList_updateSteps(this),!1):(p===void 0||p===!0)&&(this._tokenSet.add(h),c.tokenList_updateSteps(this),!0)},f.prototype.replace=function(h,p){if(h===""||p==="")throw new s.SyntaxError("Cannot replace an empty token.");if(l.codePoint.ASCIIWhiteSpace.test(h)||l.codePoint.ASCIIWhiteSpace.test(p))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(h)&&(l.set.replace(this._tokenSet,h,p),c.tokenList_updateSteps(this),!0)},f.prototype.supports=function(h){return c.tokenList_validationSteps(this,h)},Object.defineProperty(f.prototype,"value",{get:function(){return c.tokenList_serializeSteps(this)},set:function(h){c.element_setAnAttributeValue(this._element,this._attribute._localName,h)},enumerable:!0,configurable:!0}),f.prototype[Symbol.iterator]=function(){var h=this._tokenSet[Symbol.iterator]();return{next:function(){return h.next()}}},f._create=function(h,p){return new f(h,p)},f}();r.DOMTokenListImpl=d},function(n,r,i){var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(104),l=i(0),c=function(d){function f(h,p){var C=d.call(this,h,p)||this;return C._detail=null,C._detail=p&&p.detail||null,C}return o(f,d),Object.defineProperty(f.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),f.prototype.initCustomEvent=function(h,p,C,x){p===void 0&&(p=!1),C===void 0&&(C=!1),x===void 0&&(x=null),this._dispatchFlag||(l.event_initialize(this,h,p,C),this._detail=x)},f}(s.EventImpl);r.CustomEventImpl=c},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(6),o=i(2),s=i(105),l=i(17);r.nodeIterator_traverse=function(c,d){for(var f=c._reference,h=c._pointerBeforeReference;;){if(d)if(h)h=!1;else{var p=l.tree_getFollowingNode(c._root,f);if(!p)return null;f=p}else if(h){var C=l.tree_getPrecedingNode(c.root,f);if(!C)return null;f=C}else h=!0;if(s.traversal_filter(c,f)===o.FilterResult.Accept)break}return c._reference=f,c._pointerBeforeReference=h,f},r.nodeIterator_iteratorList=function(){return a.dom.window._iteratorList}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(9),o=i(7),s=i(174);function l(c){if(!s.xml_isName(c))throw new a.InvalidCharacterError("Invalid XML name: "+c);if(!s.xml_isQName(c))throw new a.InvalidCharacterError("Invalid XML qualified name: "+c+".")}r.namespace_validate=l,r.namespace_validateAndExtract=function(c,d){c||(c=null),l(d);var f=d.split(":"),h=f.length===2?f[0]:null,p=f.length===2?f[1]:d;if(h&&c===null)throw new a.NamespaceError("Qualified name includes a prefix but the namespace is null.");if(h==="xml"&&c!==o.namespace.XML)throw new a.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(c!==o.namespace.XMLNS&&(h==="xmlns"||d==="xmlns"))throw new a.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(c===o.namespace.XMLNS&&h!=="xmlns"&&d!=="xmlns")throw new a.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[c,h,p]},r.namespace_extractQName=function(c){l(c);var d=c.split(":");return[d.length===2?d[0]:null,d.length===2?d[1]:c]}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.xml_isName=function(a){for(var o=0;o<a.length;o++){var s=a.charCodeAt(o);if(!(s>=97&&s<=122||s>=65&&s<=90||s===58||s===95||s>=192&&s<=214||s>=216&&s<=246||s>=248&&s<=767||s>=880&&s<=893||s>=895&&s<=8191||s>=8204&&s<=8205||s>=8304&&s<=8591||s>=11264&&s<=12271||s>=12289&&s<=55295||s>=63744&&s<=64975||s>=65008&&s<=65533)&&(o===0||!(s===45||s===46||s>=48&&s<=57||s===183||s>=768&&s<=879||s>=8255&&s<=8256))){if(s>=55296&&s<=56319&&o<a.length-1){var l=a.charCodeAt(o+1);if(l>=56320&&l<=57343&&(o++,(s=1024*(s-55296)+l-56320+65536)>=65536&&s<=983039))continue}return!1}}return!0},r.xml_isQName=function(a){for(var o=!1,s=0;s<a.length;s++){var l=a.charCodeAt(s);if(!(l>=97&&l<=122||l>=65&&l<=90||l===95||l>=192&&l<=214||l>=216&&l<=246||l>=248&&l<=767||l>=880&&l<=893||l>=895&&l<=8191||l>=8204&&l<=8205||l>=8304&&l<=8591||l>=11264&&l<=12271||l>=12289&&l<=55295||l>=63744&&l<=64975||l>=65008&&l<=65533)&&(s===0||!(l===45||l===46||l>=48&&l<=57||l===183||l>=768&&l<=879||l>=8255&&l<=8256))){if(s===0||l!==58){if(l>=55296&&l<=56319&&s<a.length-1){var c=a.charCodeAt(s+1);if(c>=56320&&c<=57343&&(s++,(l=1024*(l-55296)+c-56320+65536)>=65536&&l<=983039))continue}return!1}if(o||s===a.length-1)return!1;o=!0}}return!0},r.xml_isLegalChar=function(a){for(var o=0;o<a.length;o++){var s=a.charCodeAt(o);if(!(s===9||s===10||s===13||s>=32&&s<=55295||s>=57344&&s<=65533)){if(s>=55296&&s<=56319&&o<a.length-1){var l=a.charCodeAt(o+1);if(l>=56320&&l<=57343&&(o++,(s=1024*(s-55296)+l-56320+65536)>=65536&&s<=1114111))continue}return!1}}return!0},r.xml_isPubidChar=function(a){for(var o=0;o<a.length;o++){var s=a.charCodeAt(o);if(!(s>=97&&s<=122||s>=65&&s<=90||s>=39&&s<=59||s===32||s===13||s===10||s>=35&&s<=37||s===33||s===61||s===63||s===64||s===95))return!1}return!0}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=i(17);r.boundaryPoint_position=function s(l,c){var d=l[0],f=l[1],h=c[0],p=c[1];if(console.assert(o.tree_rootNode(d)===o.tree_rootNode(h),"Boundary points must share the same root node."),d===h)return f===p?a.BoundaryPosition.Equal:f<p?a.BoundaryPosition.Before:a.BoundaryPosition.After;if(o.tree_isFollowing(h,d)){var C=s([h,p],[d,f]);if(C===a.BoundaryPosition.Before)return a.BoundaryPosition.After;if(C===a.BoundaryPosition.After)return a.BoundaryPosition.Before}if(o.tree_isAncestorOf(h,d)){for(var x=h;!o.tree_isChildOf(d,x);)x._parent!==null&&(x=x._parent);if(o.tree_index(x)<f)return a.BoundaryPosition.After}return a.BoundaryPosition.Before}},function(n,r,i){var a=this&&this.__values||function(C){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&C[x],_=0;if(T)return T.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&_>=C.length&&(C=void 0),{value:C&&C[_++],done:!C}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(3),l=i(7),c=i(29),d=i(108),f=i(30),h=i(37),p=i(52);r.node_stringReplaceAll=function(C,x){var T=null;C!==""&&(T=c.create_text(x._nodeDocument,C)),h.mutation_replaceAll(T,x)},r.node_clone=function C(x,T,_){var y,w,b,M,I;if(T===void 0&&(T=null),_===void 0&&(_=!1),T===null&&(T=x._nodeDocument),s.Guard.isElementNode(x)){I=p.element_createAnElement(T,x._localName,x._namespace,x._namespacePrefix,x._is,!1);try{for(var A=a(x._attributeList),k=A.next();!k.done;k=A.next()){var U=C(k.value,T);p.element_append(U,I)}}catch(re){y={error:re}}finally{try{k&&!k.done&&(w=A.return)&&w.call(A)}finally{if(y)throw y.error}}}else if(s.Guard.isDocumentNode(x)){var B=c.create_document();B._encoding=x._encoding,B._contentType=x._contentType,B._URL=x._URL,B._origin=x._origin,B._type=x._type,B._mode=x._mode,I=B}else if(s.Guard.isDocumentTypeNode(x))I=c.create_documentType(T,x._name,x._publicId,x._systemId);else if(s.Guard.isAttrNode(x)){var z=c.create_attr(T,x.localName);z._namespace=x._namespace,z._namespacePrefix=x._namespacePrefix,z._value=x._value,I=z}else I=s.Guard.isExclusiveTextNode(x)?c.create_text(T,x._data):s.Guard.isCDATASectionNode(x)?c.create_cdataSection(T,x._data):s.Guard.isCommentNode(x)?c.create_comment(T,x._data):s.Guard.isProcessingInstructionNode(x)?c.create_processingInstruction(T,x._target,x._data):s.Guard.isDocumentFragmentNode(x)?c.create_documentFragment(T):Object.create(x);if(s.Guard.isDocumentNode(I)?(I._nodeDocument=I,T=I):I._nodeDocument=T,o.dom.features.steps&&f.dom_runCloningSteps(I,x,T,_),_)try{for(var K=a(x._children),J=K.next();!J.done;J=K.next()){var X=C(J.value,T,!0);h.mutation_append(X,I)}}catch(re){b={error:re}}finally{try{J&&!J.done&&(M=K.return)&&M.call(K)}finally{if(b)throw b.error}}return I},r.node_equals=function C(x,T){var _,y,w,b;if(x._nodeType!==T._nodeType)return!1;if(s.Guard.isDocumentTypeNode(x)&&s.Guard.isDocumentTypeNode(T)){if(x._name!==T._name||x._publicId!==T._publicId||x._systemId!==T._systemId)return!1}else if(s.Guard.isElementNode(x)&&s.Guard.isElementNode(T)){if(x._namespace!==T._namespace||x._namespacePrefix!==T._namespacePrefix||x._localName!==T._localName||x._attributeList.length!==T._attributeList.length)return!1}else if(s.Guard.isAttrNode(x)&&s.Guard.isAttrNode(T)){if(x._namespace!==T._namespace||x._localName!==T._localName||x._value!==T._value)return!1}else if(s.Guard.isProcessingInstructionNode(x)&&s.Guard.isProcessingInstructionNode(T)){if(x._target!==T._target||x._data!==T._data)return!1}else if(s.Guard.isCharacterDataNode(x)&&s.Guard.isCharacterDataNode(T)&&x._data!==T._data)return!1;if(s.Guard.isElementNode(x)&&s.Guard.isElementNode(T)){var M={};try{for(var I=a(x._attributeList),A=I.next();!A.done;A=I.next())M[(B=A.value)._localName]=B}catch(fe){_={error:fe}}finally{try{A&&!A.done&&(y=I.return)&&y.call(I)}finally{if(_)throw _.error}}try{for(var k=a(T._attributeList),U=k.next();!U.done;U=k.next()){var B,z=U.value;if(!(B=M[z._localName])||!C(B,z))return!1}}catch(fe){w={error:fe}}finally{try{U&&!U.done&&(b=k.return)&&b.call(k)}finally{if(w)throw w.error}}}if(x._children.size!==T._children.size)return!1;for(var K=x._children[Symbol.iterator](),J=T._children[Symbol.iterator](),X=K.next(),re=J.next();!X.done&&!re.done;){if(!C(X.value,re.value))return!1;X=K.next(),re=J.next()}return!0},r.node_listOfElementsWithQualifiedName=function(C,x){return C==="*"?c.create_htmlCollection(x):x._nodeDocument._type==="html"?c.create_htmlCollection(x,function(T){return T._namespace===l.namespace.HTML&&T._qualifiedName===C.toLowerCase()||T._namespace!==l.namespace.HTML&&T._qualifiedName===C}):c.create_htmlCollection(x,function(T){return T._qualifiedName===C})},r.node_listOfElementsWithNamespace=function(C,x,T){return C===""&&(C=null),C==="*"&&x==="*"?c.create_htmlCollection(T):C==="*"?c.create_htmlCollection(T,function(_){return _._localName===x}):x==="*"?c.create_htmlCollection(T,function(_){return _._namespace===C}):c.create_htmlCollection(T,function(_){return _._localName===x&&_._namespace===C})},r.node_listOfElementsWithClassNames=function(C,x){var T=d.orderedSet_parse(C);if(T.size===0)return c.create_htmlCollection(x,function(){return!1});var _=x._nodeDocument._mode!=="quirks";return c.create_htmlCollection(x,function(y){var w=y.classList;return d.orderedSet_contains(w._tokenSet,T,_)})},r.node_locateANamespacePrefix=function C(x,T){if(x._namespace===T&&x._namespacePrefix!==null)return x._namespacePrefix;for(var _=0;_<x._attributeList.length;_++){var y=x._attributeList[_];if(y._namespacePrefix==="xmlns"&&y._value===T)return y._localName}return x._parent&&s.Guard.isElementNode(x._parent)?C(x._parent,T):null},r.node_locateANamespace=function C(x,T){if(s.Guard.isElementNode(x)){if(x._namespace!==null&&x._namespacePrefix===T)return x._namespace;for(var _=0;_<x._attributeList.length;_++){var y=x._attributeList[_];if(y._namespace===l.namespace.XMLNS&&y._namespacePrefix==="xmlns"&&y._localName===T||T===null&&y._namespace===l.namespace.XMLNS&&y._namespacePrefix===null&&y._localName==="xmlns")return y._value||null}return x.parentElement===null?null:C(x.parentElement,T)}return s.Guard.isDocumentNode(x)?x.documentElement===null?null:C(x.documentElement,T):s.Guard.isDocumentTypeNode(x)||s.Guard.isDocumentFragmentNode(x)?null:s.Guard.isAttrNode(x)?x._element===null?null:C(x._element,T):x._parent&&s.Guard.isElementNode(x._parent)?C(x._parent,T):null}},function(n,r,i){var a=this&&this.__values||function(p){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&p[C],T=0;if(x)return x.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&T>=p.length&&(p=void 0),{value:p&&p[T++],done:!p}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(3),l=i(9),c=i(29),d=i(17),f=i(107),h=i(37);r.text_contiguousTextNodes=function(p,C){var x;return C===void 0&&(C=!1),(x={})[Symbol.iterator]=function(){for(var T=p;T&&s.Guard.isTextNode(T._previousSibling);)T=T._previousSibling;return{next:function(){if(T&&!C&&T===p&&(T=s.Guard.isTextNode(T._nextSibling)?T._nextSibling:null),T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=s.Guard.isTextNode(T._nextSibling)?T._nextSibling:null,_}}},x},r.text_contiguousExclusiveTextNodes=function(p,C){var x;return C===void 0&&(C=!1),(x={})[Symbol.iterator]=function(){for(var T=p;T&&s.Guard.isExclusiveTextNode(T._previousSibling);)T=T._previousSibling;return{next:function(){if(T&&!C&&T===p&&(T=s.Guard.isExclusiveTextNode(T._nextSibling)?T._nextSibling:null),T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=s.Guard.isExclusiveTextNode(T._nextSibling)?T._nextSibling:null,_}}},x},r.text_descendantTextContent=function(p){for(var C="",x=d.tree_getFirstDescendantNode(p,!1,!1,function(T){return s.Guard.isTextNode(T)});x!==null;)C+=x._data,x=d.tree_getNextDescendantNode(p,x,!1,!1,function(T){return s.Guard.isTextNode(T)});return C},r.text_split=function(p,C){var x,T,_=p._data.length;if(C>_)throw new l.IndexSizeError;var y=_-C,w=f.characterData_substringData(p,C,y),b=c.create_text(p._nodeDocument,w),M=p._parent;if(M!==null){h.mutation_insert(b,M,p._nextSibling);try{for(var I=a(o.dom.rangeList),A=I.next();!A.done;A=I.next()){var k=A.value;k._start[0]===p&&k._start[1]>C&&(k._start[0]=b,k._start[1]-=C),k._end[0]===p&&k._end[1]>C&&(k._end[0]=b,k._end[1]-=C);var U=d.tree_index(p);k._start[0]===M&&k._start[1]===U+1&&k._start[1]++,k._end[0]===M&&k._end[1]===U+1&&k._end[1]++}}catch(B){x={error:B}}finally{try{A&&!A.done&&(T=I.return)&&T.call(I)}finally{if(x)throw x.error}}}return f.characterData_replaceData(p,C,y,""),b}},function(n,r,i){var a=i(4),o=i(41),s=i(24),l=i(48),c=[].join,d=o!=Object,f=l("join",",");a({target:"Array",proto:!0,forced:d||!f},{join:function(h){return c.call(s(this),h===void 0?",":h)}})},function(n,r,i){var a=i(4),o=i(83),s=String.fromCharCode,l=String.fromCodePoint;a({target:"String",stat:!0,forced:!!l&&l.length!=1},{fromCodePoint:function(c){for(var d,f=[],h=arguments.length,p=0;h>p;){if(d=+arguments[p++],o(d,1114111)!==d)throw RangeError(d+" is not a valid code point");f.push(d<65536?s(d):s(55296+((d-=65536)>>10),d%1024+56320))}return f.join("")}})},function(n,r,i){var a=this&&this.__read||function(l,c){var d=typeof Symbol=="function"&&l[Symbol.iterator];if(!d)return l;var f,h,p=d.call(l),C=[];try{for(;(c===void 0||c-- >0)&&!(f=p.next()).done;)C.push(f.value)}catch(x){h={error:x}}finally{try{f&&!f.done&&(d=p.return)&&d.call(p)}finally{if(h)throw h.error}}return C};Object.defineProperty(r,"__esModule",{value:!0});var o=i(111),s=function(){function l(c,d){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=c,this._index=0,this._length=c.length,d&&(this._options.skipWhitespaceOnlyText=d.skipWhitespaceOnlyText||!1)}return l.prototype.nextToken=function(){if(this.eof())return{type:o.TokenType.EOF};var c=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&c.type===o.TokenType.Text&&l.isWhiteSpaceToken(c)&&(c=this.nextToken()),c},l.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?l.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},l.prototype.declaration=function(){for(var c="",d="",f="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:o.TokenType.Declaration,version:c,encoding:d,standalone:f};var h=a(this.attribute(),2),p=h[0],C=h[1];p==="version"?c=C:p==="encoding"?d=C:p==="standalone"?f=C:this.throwError("Invalid attribute name: "+p)}this.throwError("Missing declaration end symbol `?>`")},l.prototype.doctype=function(){var c="",d="";this.skipSpace();var f=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(c=this.quotedString(),d=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(d=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:o.TokenType.DocType,name:f,pubId:c,sysId:d}},l.prototype.pi=function(){var c=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:o.TokenType.PI,target:c,data:""};var d=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:o.TokenType.PI,target:c,data:d}},l.prototype.text=function(){var c=this.takeUntil("<");return{type:o.TokenType.Text,data:c}},l.prototype.comment=function(){var c=this.takeUntilStartsWith("-->");return this.eof()&&this.throwError("Missing comment end symbol `-->`"),this.seek(3),{type:o.TokenType.Comment,data:c}},l.prototype.cdata=function(){var c=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:o.TokenType.CDATA,data:c}},l.prototype.openTag=function(){this.skipSpace();var c=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:o.TokenType.Element,name:c,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:o.TokenType.Element,name:c,attributes:[],selfClosing:!0};for(var d=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:o.TokenType.Element,name:c,attributes:d,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:o.TokenType.Element,name:c,attributes:d,selfClosing:!0};var f=this.attribute();d.push(f)}this.throwError("Missing opening element tag end symbol `>`")},l.prototype.closeTag=function(){this.skipSpace();var c=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:o.TokenType.ClosingTag,name:c}},l.prototype.attribute=function(){this.skipSpace();var c=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[c,this.quotedString()]},l.prototype.quotedString=function(){this.skipSpace();var c=this.take(1);l.isQuote(c)||this.throwError("Missing start quote character before quoted value");var d=this.takeUntil(c);return this.skipIfStartsWith(c)||this.throwError("Missing end quote character after quoted value"),d},l.prototype.eof=function(){return this._index>=this._length},l.prototype.skipIfStartsWith=function(c){var d=c.length;if(d===1)return this._str[this._index]===c&&(this._index++,!0);for(var f=0;f<d;f++)if(this._str[this._index+f]!==c[f])return!1;return this._index+=d,!0},l.prototype.seek=function(c){this._index+=c,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},l.prototype.skipSpace=function(){for(;!this.eof()&&l.isSpace(this._str[this._index]);)this._index++},l.prototype.take=function(c){if(c===1)return this._str[this._index++];var d=this._index;return this.seek(c),this._str.slice(d,this._index)},l.prototype.takeUntil=function(c,d){d===void 0&&(d=!1);for(var f=this._index;this._index<this._length;){var h=this._str[this._index];if(h===c||d&&l.isSpace(h))break;this._index++}return this._str.slice(f,this._index)},l.prototype.takeUntil2=function(c,d,f){f===void 0&&(f=!1);for(var h=this._index;this._index<this._length;){var p=this._str[this._index];if(p===c||p===d||f&&l.isSpace(p))break;this._index++}return this._str.slice(h,this._index)},l.prototype.takeUntilStartsWith=function(c,d){d===void 0&&(d=!1);for(var f=this._index,h=c.length;this._index<this._length;){for(var p=!0,C=0;C<h;C++){var x=this._str[this._index+C],T=c[C];if(d&&l.isSpace(x))return this._str.slice(f,this._index);if(x!==T){this._index++,p=!1;break}}if(p)return this._str.slice(f,this._index)}return this._index=this._length,this._str.slice(f)},l.prototype.skipUntil=function(c){for(;this._index<this._length&&this._str[this._index]!==c;)this._index++},l.isWhiteSpaceToken=function(c){for(var d=c.data,f=0;f<d.length;f++){var h=d[f];if(h!==" "&&h!==`
`&&h!=="\r"&&h!=="	"&&h!=="\f")return!1}return!0},l.isSpace=function(c){return c===" "||c===`
`||c==="\r"||c==="	"},l.isQuote=function(c){return c==='"'||c==="'"},l.prototype.throwError=function(c){for(var d=/\r\n|\r|\n/g,f=null,h=0,p=0,C=this._str.length;(f=d.exec(this._str))!==null&&f!==null;)if(h++,f.index<this._index&&(p=d.lastIndex),f.index>this._index){C=f.index;break}throw this.err={line:h,col:this._index-p,index:this._index,str:this._str.substring(p,C)},new Error(c+`
Index: `+this.err.index+`
Ln: `+this.err.line+", Col: "+this.err.col+`
Input: `+this.err.str)},l.prototype[Symbol.iterator]=function(){return this._index=0,{next:(function(){var c=this.nextToken();return c.type===o.TokenType.EOF?{done:!0,value:null}:{done:!1,value:c}}).bind(this)}},l}();r.XMLStringLexer=s},function(n,r,i){var a=i(39);n.exports=new a({include:[i(182)]})},function(n,r,i){var a=i(39);n.exports=new a({include:[i(113)],implicit:[i(289),i(290),i(291),i(292)]})},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(91),o=i(1),s=i(3),l=i(77),c=i(109);function d(C,x){var T=h(C===void 0||f(C)?C:a.DefaultBuilderOptions),_=f(C)?x:C,y=c.createDocument();p(y,T);var w=new l.XMLBuilderImpl(y);return _!==void 0&&w.ele(_),w}function f(C){if(!o.isPlainObject(C))return!1;for(var x in C)if(C.hasOwnProperty(x)&&!a.XMLBuilderOptionKeys.has(x))return!1;return!0}function h(C){C===void 0&&(C={});var x=o.applyDefaults(C,a.DefaultBuilderOptions);if(x.convert.att.length===0||x.convert.ins.length===0||x.convert.text.length===0||x.convert.cdata.length===0||x.convert.comment.length===0)throw new Error("JS object converter strings cannot be zero length.");return x}function p(C,x,T){var _=C;_._xmlBuilderOptions=x,_._isFragment=T}r.builder=function(C,x){var T=h(f(C)?C:a.DefaultBuilderOptions),_=s.Guard.isNode(C)||o.isArray(C)?C:x;if(_===void 0)throw new Error("Invalid arguments.");if(o.isArray(_)){for(var y=[],w=0;w<_.length;w++){var b=new l.XMLBuilderImpl(_[w]);b.set(T),y.push(b)}return y}var M=new l.XMLBuilderImpl(_);return M.set(T),M},r.create=d,r.fragment=function(C,x){var T=h(C===void 0||f(C)?C:a.DefaultBuilderOptions),_=f(C)?x:C,y=c.createDocument();p(y,T,!0);var w=new l.XMLBuilderImpl(y.createDocumentFragment());return _!==void 0&&w.ele(_),w},r.convert=function(C,x,T){var _,y,w;return f(C)&&x!==void 0?(_=C,y=x,w=T):(_=a.DefaultBuilderOptions,y=C,w=x||void 0),d(_,y).end(w)}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(77);r.builder=a.builder,r.create=a.create,r.fragment=a.fragment,r.convert=a.convert,r.createCB=a.createCB,r.fragmentCB=a.fragmentCB},function(n,r,i){i(31),i(32),i(33),i(191),i(192),i(194),i(64),i(19),i(198),i(199),i(89),i(201),i(65),i(20),i(66),i(22),i(23);var a=this&&this.__read||function(_,y){var w=typeof Symbol=="function"&&_[Symbol.iterator];if(!w)return _;var b,M,I=w.call(_),A=[];try{for(;(y===void 0||y-- >0)&&!(b=I.next()).done;)A.push(b.value)}catch(k){M={error:k}}finally{try{b&&!b.done&&(w=I.return)&&w.call(I)}finally{if(M)throw M.error}}return A},o=this&&this.__values||function(_){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&_[y],b=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&b>=_.length&&(_=void 0),{value:_&&_[b++],done:!_}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=i(91),l=i(1),c=i(217),d=i(2),f=i(3),h=i(0),p=i(109),C=i(7),x=i(276),T=function(){function _(y){this._domNode=y}return Object.defineProperty(_.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),_.prototype.set=function(y){return this._options=l.applyDefaults(l.applyDefaults(this._options,y,!0),s.DefaultBuilderOptions),this},_.prototype.ele=function(y,w,b){var M,I,A,k,U,B;if(l.isObject(y))return new x.ObjectReader(this._options).parse(this,y);if(y!==null&&/^\s*</.test(y))return new x.XMLReader(this._options).parse(this,y);if(y!==null&&/^\s*[\{\[]/.test(y))return new x.JSONReader(this._options).parse(this,y);if(y!==null&&/^(\s*|(#.*)|(%.*))*---/.test(y))return new x.YAMLReader(this._options).parse(this,y);if((y===null||l.isString(y))&&l.isString(w))k=(M=a([y,w,b],3))[0],U=M[1],B=M[2];else{if(y===null)throw new Error("Element name cannot be null. "+this._debugInfo());k=(I=a([void 0,y,l.isObject(w)?w:void 0],3))[0],U=I[1],B=I[2]}if(B&&(B=l.getValue(B)),k=(A=a(this._extractNamespace(p.sanitizeInput(k,this._options.invalidCharReplacement),p.sanitizeInput(U,this._options.invalidCharReplacement),!0),2))[0],U=A[1],k===void 0){var z=a(h.namespace_extractQName(U),1)[0];k=this.node.lookupNamespaceURI(z)}var K=k!=null?this._doc.createElementNS(k,U):this._doc.createElement(U);this.node.appendChild(K);var J=new _(K),X=this._doc.doctype;if(K===this._doc.documentElement&&X!==null){var re=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,X.publicId,X.systemId);this._doc.replaceChild(re,X)}return B&&!l.isEmpty(B)&&J.att(B),J},_.prototype.remove=function(){var y=this.up();return y.node.removeChild(this.node),y},_.prototype.att=function(y,w,b){var M,I,A,k,U,B,z=this;if(l.isMap(y)||l.isObject(y))return l.forEachObject(y,function(ie,te){return z.att(ie,te)},this),this;if(y!=null&&(y=l.getValue(y+"")),w!=null&&(w=l.getValue(w+"")),b!=null&&(b=l.getValue(b+"")),y!==null&&!l.isString(y)||!l.isString(w)||b!==null&&!l.isString(b)){if(!l.isString(y)||w!=null&&!l.isString(w))throw new Error("Attribute name and value not specified. "+this._debugInfo());k=(I=a([void 0,y,w],3))[0],U=I[1],B=I[2]}else k=(M=a([y,w,b],3))[0],U=M[1],B=M[2];if(this._options.keepNullAttributes&&B==null)B="";else if(B==null)return this;if(!f.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var K=this.node;k=(A=a(this._extractNamespace(k,U,!1),2))[0],U=A[1],U=p.sanitizeInput(U,this._options.invalidCharReplacement),k=p.sanitizeInput(k,this._options.invalidCharReplacement),B=p.sanitizeInput(B,this._options.invalidCharReplacement);var J=a(h.namespace_extractQName(U),2),X=J[0],re=J[1],fe=a(h.namespace_extractQName(K.prefix?K.prefix+":"+K.localName:K.localName),1)[0],pe=null;return X==="xmlns"?(k=C.namespace.XMLNS,K.namespaceURI===null&&fe===re&&(pe=B)):X===null&&re==="xmlns"&&fe===null&&(k=C.namespace.XMLNS,pe=B),pe!==null&&(this._updateNamespace(pe),K=this.node),k!==void 0?K.setAttributeNS(k,U,B):K.setAttribute(U,B),this},_.prototype.removeAtt=function(y,w){var b,M,I=this;if(!f.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(y=l.getValue(y),w!==void 0&&(w=l.getValue(w)),y!==null&&w===void 0)M=y;else{if(y!==null&&!l.isString(y)||w===void 0)throw new Error("Attribute namespace must be a string. "+this._debugInfo());b=y,M=w}return l.isArray(M)||l.isSet(M)?l.forEachArray(M,function(A){return b===void 0?I.removeAtt(A):I.removeAtt(b,A)},this):b!==void 0?(M=p.sanitizeInput(M,this._options.invalidCharReplacement),b=p.sanitizeInput(b,this._options.invalidCharReplacement),this.node.removeAttributeNS(b,M)):(M=p.sanitizeInput(M,this._options.invalidCharReplacement),this.node.removeAttribute(M)),this},_.prototype.txt=function(y){if(y==null){if(!this._options.keepNullNodes)return this;y=""}var w=this._doc.createTextNode(p.sanitizeInput(y,this._options.invalidCharReplacement));return this.node.appendChild(w),this},_.prototype.com=function(y){if(y==null){if(!this._options.keepNullNodes)return this;y=""}var w=this._doc.createComment(p.sanitizeInput(y,this._options.invalidCharReplacement));return this.node.appendChild(w),this},_.prototype.dat=function(y){if(y==null){if(!this._options.keepNullNodes)return this;y=""}var w=this._doc.createCDATASection(p.sanitizeInput(y,this._options.invalidCharReplacement));return this.node.appendChild(w),this},_.prototype.ins=function(y,w){var b=this;if(w===void 0&&(w=""),w==null){if(!this._options.keepNullNodes)return this;w=""}if(l.isArray(y)||l.isSet(y))l.forEachArray(y,function(I){var A=(I+="").indexOf(" "),k=A===-1?I:I.substr(0,A),U=A===-1?"":I.substr(A+1);b.ins(k,U)},this);else if(l.isMap(y)||l.isObject(y))l.forEachObject(y,function(I,A){return b.ins(I,A)},this);else{var M=this._doc.createProcessingInstruction(p.sanitizeInput(y,this._options.invalidCharReplacement),p.sanitizeInput(w,this._options.invalidCharReplacement));this.node.appendChild(M)}return this},_.prototype.dec=function(y){return this._options.version=y.version||"1.0",this._options.encoding=y.encoding,this._options.standalone=y.standalone,this},_.prototype.dtd=function(y){var w=p.sanitizeInput(y&&y.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),b=p.sanitizeInput(y&&y.pubID||"",this._options.invalidCharReplacement),M=p.sanitizeInput(y&&y.sysID||"",this._options.invalidCharReplacement);if(this._doc.documentElement!==null&&w!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var I=this._doc.implementation.createDocumentType(w,b,M);return this._doc.doctype!==null?this._doc.replaceChild(I,this._doc.doctype):this._doc.insertBefore(I,this._doc.documentElement),this},_.prototype.import=function(y){var w,b,M=this._domNode,I=this._doc,A=y.node;if(f.Guard.isDocumentNode(A)){var k=A.documentElement;if(k===null)throw new Error("Imported document has no document element node. "+this._debugInfo());var U=I.importNode(k,!0);M.appendChild(U);var B=a(h.namespace_extractQName(U.prefix?U.prefix+":"+U.localName:U.localName),1)[0],z=M.lookupNamespaceURI(B);new _(U)._updateNamespace(z)}else if(f.Guard.isDocumentFragmentNode(A))try{for(var K=o(A.childNodes),J=K.next();!J.done;J=K.next()){var X=J.value;U=I.importNode(X,!0),M.appendChild(U),f.Guard.isElementNode(U)&&(B=a(h.namespace_extractQName(U.prefix?U.prefix+":"+U.localName:U.localName),1)[0],z=M.lookupNamespaceURI(B),new _(U)._updateNamespace(z))}}catch(re){w={error:re}}finally{try{J&&!J.done&&(b=K.return)&&b.call(K)}finally{if(w)throw w.error}}else U=I.importNode(A,!0),M.appendChild(U),f.Guard.isElementNode(U)&&(B=a(h.namespace_extractQName(U.prefix?U.prefix+":"+U.localName:U.localName),1)[0],z=M.lookupNamespaceURI(B),new _(U)._updateNamespace(z));return this},_.prototype.doc=function(){if(this._doc._isFragment){for(var y=this.node;y&&y.nodeType!==d.NodeType.DocumentFragment;)y=y.parentNode;if(y===null)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new _(y)}return new _(this._doc)},_.prototype.root=function(){var y=this._doc.documentElement;if(!y)throw new Error("Document root element is null. "+this._debugInfo());return new _(y)},_.prototype.up=function(){var y=this._domNode.parentNode;if(!y)throw new Error("Parent node is null. "+this._debugInfo());return new _(y)},_.prototype.prev=function(){var y=this._domNode.previousSibling;if(!y)throw new Error("Previous sibling node is null. "+this._debugInfo());return new _(y)},_.prototype.next=function(){var y=this._domNode.nextSibling;if(!y)throw new Error("Next sibling node is null. "+this._debugInfo());return new _(y)},_.prototype.first=function(){var y=this._domNode.firstChild;if(!y)throw new Error("First child node is null. "+this._debugInfo());return new _(y)},_.prototype.last=function(){var y=this._domNode.lastChild;if(!y)throw new Error("Last child node is null. "+this._debugInfo());return new _(y)},_.prototype.each=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);for(var I=this._getFirstDescendantNode(this._domNode,w,b);I[0];){var A=this._getNextDescendantNode(this._domNode,I[0],b,I[1],I[2]);y.call(M,new _(I[0]),I[1],I[2]),I=A}return this},_.prototype.map=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);var I=[];return this.each(function(A,k,U){return I.push(y.call(M,A,k,U))},w,b),I},_.prototype.reduce=function(y,w,b,M,I){b===void 0&&(b=!1),M===void 0&&(M=!1);var A=w;return this.each(function(k,U,B){return A=y.call(I,A,k,U,B)},b,M),A},_.prototype.find=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);for(var I=this._getFirstDescendantNode(this._domNode,w,b);I[0];){var A=new _(I[0]);if(y.call(M,A,I[1],I[2]))return A;I=this._getNextDescendantNode(this._domNode,I[0],b,I[1],I[2])}},_.prototype.filter=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);var I=[];return this.each(function(A,k,U){y.call(M,A,k,U)&&I.push(A)},w,b),I},_.prototype.every=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);for(var I=this._getFirstDescendantNode(this._domNode,w,b);I[0];){var A=new _(I[0]);if(!y.call(M,A,I[1],I[2]))return!1;I=this._getNextDescendantNode(this._domNode,I[0],b,I[1],I[2])}return!0},_.prototype.some=function(y,w,b,M){w===void 0&&(w=!1),b===void 0&&(b=!1);for(var I=this._getFirstDescendantNode(this._domNode,w,b);I[0];){var A=new _(I[0]);if(y.call(M,A,I[1],I[2]))return!0;I=this._getNextDescendantNode(this._domNode,I[0],b,I[1],I[2])}return!1},_.prototype.toArray=function(y,w){y===void 0&&(y=!1),w===void 0&&(w=!1);var b=[];return this.each(function(M){return b.push(M)},y,w),b},_.prototype.toString=function(y){return(y=y||{}).format===void 0&&(y.format="xml"),this._serialize(y)},_.prototype.toObject=function(y){return(y=y||{}).format===void 0&&(y.format="object"),this._serialize(y)},_.prototype.end=function(y){return(y=y||{}).format===void 0&&(y.format="xml"),this.doc()._serialize(y)},_.prototype._getFirstDescendantNode=function(y,w,b){return w?[this._domNode,0,0]:b?this._getNextDescendantNode(y,y,b,0,0):[this._domNode.firstChild,0,1]},_.prototype._getNextDescendantNode=function(y,w,b,M,I){if(!b)return y===w?[w.firstChild,0,I+1]:[w.nextSibling,M+1,I];if(w.firstChild)return[w.firstChild,0,I+1];if(w===y)return[null,-1,-1];if(w.nextSibling)return[w.nextSibling,M+1,I];for(var A=w.parentNode;A&&A!==y;){if(A.nextSibling)return[A.nextSibling,h.tree_index(A.nextSibling),I-1];A=A.parentNode,I--}return[null,-1,-1]},_.prototype._serialize=function(y){if(y.format==="xml")return new c.XMLWriter(this._options,y).serialize(this.node);if(y.format==="map")return new c.MapWriter(this._options,y).serialize(this.node);if(y.format==="object")return new c.ObjectWriter(this._options,y).serialize(this.node);if(y.format==="json")return new c.JSONWriter(this._options,y).serialize(this.node);if(y.format==="yaml")return new c.YAMLWriter(this._options,y).serialize(this.node);throw new Error("Invalid writer format: "+y.format+". "+this._debugInfo())},_.prototype._extractNamespace=function(y,w,b){var M=w.indexOf("@");if(M>0&&(y===void 0&&(y=w.slice(M+1)),w=w.slice(0,M)),y===void 0)y=b?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(y!==null&&y[0]==="@"){var I=y.slice(1);if((y=this._options.namespaceAlias[I])===void 0)throw new Error("Namespace alias `"+I+"` is not defined. "+this._debugInfo())}return[y,w]},_.prototype._updateNamespace=function(y){var w,b,M,I,A=this._domNode;if(f.Guard.isElementNode(A)&&y!==null&&A.namespaceURI!==y){var k=a(h.namespace_extractQName(A.prefix?A.prefix+":"+A.localName:A.localName),2),U=k[0],B=k[1],z=h.create_element(this._doc,B,y,U);try{for(var K=o(A.attributes),J=K.next();!J.done;J=K.next()){var X=J.value,re=X.prefix?X.prefix+":"+X.localName:X.localName,fe=a(h.namespace_extractQName(re),1)[0],pe=X.namespaceURI;pe===null&&fe!==null&&(pe=A.lookupNamespaceURI(fe)),pe===null?z.setAttribute(re,X.value):z.setAttributeNS(pe,re,X.value)}}catch(Re){w={error:Re}}finally{try{J&&!J.done&&(b=K.return)&&b.call(K)}finally{if(w)throw w.error}}var ie=A.parentNode;if(ie===null)throw new Error("Parent node is null."+this._debugInfo());ie.replaceChild(z,A),this._domNode=z;try{for(var te=o(A.childNodes),ee=te.next();!ee.done;ee=te.next()){var we=ee.value.cloneNode(!0);if(z.appendChild(we),f.Guard.isElementNode(we)){var Ce=a(h.namespace_extractQName(we.prefix?we.prefix+":"+we.localName:we.localName),1)[0],De=z.lookupNamespaceURI(Ce);new _(we)._updateNamespace(De)}}}catch(Re){M={error:Re}}finally{try{ee&&!ee.done&&(I=te.return)&&I.call(te)}finally{if(M)throw M.error}}}},Object.defineProperty(_.prototype,"_doc",{get:function(){var y=this.node;if(f.Guard.isDocumentNode(y))return y;var w=y.ownerDocument;if(!w)throw new Error("Owner document is null. "+this._debugInfo());return w},enumerable:!0,configurable:!0}),_.prototype._debugInfo=function(y){var w=this.node,b=w.parentNode;y=y||w.nodeName;var M=b?b.nodeName:"";return M?"node: <"+y+">, parent: <"+M+">":"node: <"+y+">"},Object.defineProperty(_.prototype,"_options",{get:function(){var y=this._doc;if(y._xmlBuilderOptions===void 0)throw new Error("Builder options is not set.");return y._xmlBuilderOptions},set:function(y){this._doc._xmlBuilderOptions=y},enumerable:!0,configurable:!0}),_}();r.XMLBuilderImpl=T},function(n,r,i){var a=i(11),o=i(117),s=a.WeakMap;n.exports=typeof s=="function"&&/native code/.test(o(s))},function(n,r,i){var a=i(46),o=i(82),s=i(85),l=i(18);n.exports=a("Reflect","ownKeys")||function(c){var d=o.f(l(c)),f=s.f;return f?d.concat(f(c)):d}},function(n,r,i){var a=i(16),o=i(15),s=i(18),l=i(61);n.exports=a?Object.defineProperties:function(c,d){s(c);for(var f,h=l(d),p=h.length,C=0;p>C;)o.f(c,f=h[C++],d[f]);return c}},function(n,r,i){var a=i(46);n.exports=a("document","documentElement")},function(n,r,i){var a=i(24),o=i(82).f,s={}.toString,l=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(c){return l&&s.call(c)=="[object Window]"?function(d){try{return o(d)}catch{return l.slice()}}(c):o(a(c))}},function(n,r,i){var a=i(4),o=i(36).every,s=i(48),l=i(28),c=s("every"),d=l("every");a({target:"Array",proto:!0,forced:!c||!d},{every:function(f){return o(this,f,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(4),o=i(36).filter,s=i(63),l=i(28),c=s("filter"),d=l("filter");a({target:"Array",proto:!0,forced:!c||!d},{filter:function(f){return o(this,f,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(46);n.exports=a("navigator","userAgent")||""},function(n,r,i){var a=i(4),o=i(36).find,s=i(130),l=i(28),c=!0,d=l("find");"find"in[]&&Array(1).find(function(){c=!1}),a({target:"Array",proto:!0,forced:c||!d},{find:function(f){return o(this,f,arguments.length>1?arguments[1]:void 0)}}),s("find")},function(n,r,i){var a=i(131).IteratorPrototype,o=i(60),s=i(40),l=i(62),c=i(49),d=function(){return this};n.exports=function(f,h,p){var C=h+" Iterator";return f.prototype=o(a,{next:s(1,p)}),l(f,C,!1,!0),c[C]=d,f}},function(n,r,i){var a=i(8);n.exports=!a(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype})},function(n,r,i){var a=i(13);n.exports=function(o){if(!a(o)&&o!==null)throw TypeError("Can't set "+String(o)+" as a prototype");return o}},function(n,r,i){var a=i(4),o=i(36).map,s=i(63),l=i(28),c=s("map"),d=l("map");a({target:"Array",proto:!0,forced:!c||!d},{map:function(f){return o(this,f,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(4),o=i(200).left,s=i(48),l=i(28),c=s("reduce"),d=l("reduce",{1:0});a({target:"Array",proto:!0,forced:!c||!d},{reduce:function(f){return o(this,f,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(127),o=i(27),s=i(41),l=i(26),c=function(d){return function(f,h,p,C){a(h);var x=o(f),T=s(x),_=l(x.length),y=d?_-1:0,w=d?-1:1;if(p<2)for(;;){if(y in T){C=T[y],y+=w;break}if(y+=w,d?y<0:_<=y)throw TypeError("Reduce of empty array with no initial value")}for(;d?y>=0:_>y;y+=w)y in T&&(C=h(C,T[y],y,x));return C}};n.exports={left:c(!1),right:c(!0)}},function(n,r,i){var a=i(4),o=i(36).some,s=i(48),l=i(28),c=s("some"),d=l("some");a({target:"Array",proto:!0,forced:!c||!d},{some:function(f){return o(this,f,arguments.length>1?arguments[1]:void 0)}})},function(n,r,i){var a=i(90),o=i(135);n.exports=a?{}.toString:function(){return"[object "+o(this)+"]"}},function(n,r){n.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(n,r,i){var a=i(8);n.exports=!a(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(n,r,i){var a=i(5),o=i(49),s=a("iterator"),l=Array.prototype;n.exports=function(c){return c!==void 0&&(o.Array===c||l[s]===c)}},function(n,r,i){var a=i(135),o=i(49),s=i(5)("iterator");n.exports=function(l){if(l!=null)return l[s]||l["@@iterator"]||o[a(l)]}},function(n,r,i){var a=i(18);n.exports=function(o,s,l,c){try{return c?s(a(l)[0],l[1]):s(l)}catch(f){var d=o.return;throw d!==void 0&&a(d.call(o)),f}}},function(n,r,i){var a=i(5)("iterator"),o=!1;try{var s=0,l={next:function(){return{done:!!s++}},return:function(){o=!0}};l[a]=function(){return this},Array.from(l,function(){throw 2})}catch{}n.exports=function(c,d){if(!d&&!o)return!1;var f=!1;try{var h={};h[a]=function(){return{next:function(){return{done:f=!0}}}},c(h)}catch{}return f}},function(n,r,i){var a=i(13),o=i(133);n.exports=function(s,l,c){var d,f;return o&&typeof(d=l.constructor)=="function"&&d!==c&&a(f=d.prototype)&&f!==c.prototype&&o(s,f),s}},function(n,r,i){var a=i(25);n.exports=function(o,s,l){for(var c in s)a(o,c,s[c],l);return o}},function(n,r,i){var a=i(46),o=i(15),s=i(5),l=i(16),c=s("species");n.exports=function(d){var f=a(d),h=o.f;l&&f&&!f[c]&&h(f,c,{configurable:!0,get:function(){return this}})}},function(n,r,i){var a=this&&this.__generator||function(l,c){var d,f,h,p,C={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return p={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function x(T){return function(_){return function(y){if(d)throw new TypeError("Generator is already executing.");for(;C;)try{if(d=1,f&&(h=2&y[0]?f.return:y[0]?f.throw||((h=f.return)&&h.call(f),0):f.next)&&!(h=h.call(f,y[1])).done)return h;switch(f=0,h&&(y=[2&y[0],h.value]),y[0]){case 0:case 1:h=y;break;case 4:return C.label++,{value:y[1],done:!1};case 5:C.label++,f=y[1],y=[0];continue;case 7:y=C.ops.pop(),C.trys.pop();continue;default:if(h=C.trys,!((h=h.length>0&&h[h.length-1])||y[0]!==6&&y[0]!==2)){C=0;continue}if(y[0]===3&&(!h||y[1]>h[0]&&y[1]<h[3])){C.label=y[1];break}if(y[0]===6&&C.label<h[1]){C.label=h[1],h=y;break}if(h&&C.label<h[2]){C.label=h[2],C.ops.push(y);break}h[2]&&C.ops.pop(),C.trys.pop();continue}y=c.call(l,C)}catch(w){y=[6,w],f=0}finally{d=h=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([T,_])}}},o=this&&this.__values||function(l){var c=typeof Symbol=="function"&&Symbol.iterator,d=c&&l[c],f=0;if(d)return d.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function l(c){c===void 0&&(c=1e3),this._items=new Set,this._limit=c}return l.prototype.add=function(c){if(this._items.add(c),this._items.size>this._limit){var d=this._items.values().next();d.done||this._items.delete(d.value)}return this},l.prototype.delete=function(c){return this._items.delete(c)},l.prototype.has=function(c){return this._items.has(c)},l.prototype.clear=function(){this._items.clear()},Object.defineProperty(l.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),l.prototype.forEach=function(c,d){var f=this;this._items.forEach(function(h){return c.call(d,h,h,f)})},l.prototype.keys=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.keys())];case 1:return c.sent(),[2]}})},l.prototype.values=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.values())];case 1:return c.sent(),[2]}})},l.prototype.entries=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.entries())];case 1:return c.sent(),[2]}})},l.prototype[Symbol.iterator]=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items)];case 1:return c.sent(),[2]}})},Object.defineProperty(l.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),l}();r.FixedSizeSet=s},function(n,r,i){var a=this&&this.__generator||function(l,c){var d,f,h,p,C={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return p={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function x(T){return function(_){return function(y){if(d)throw new TypeError("Generator is already executing.");for(;C;)try{if(d=1,f&&(h=2&y[0]?f.return:y[0]?f.throw||((h=f.return)&&h.call(f),0):f.next)&&!(h=h.call(f,y[1])).done)return h;switch(f=0,h&&(y=[2&y[0],h.value]),y[0]){case 0:case 1:h=y;break;case 4:return C.label++,{value:y[1],done:!1};case 5:C.label++,f=y[1],y=[0];continue;case 7:y=C.ops.pop(),C.trys.pop();continue;default:if(h=C.trys,!((h=h.length>0&&h[h.length-1])||y[0]!==6&&y[0]!==2)){C=0;continue}if(y[0]===3&&(!h||y[1]>h[0]&&y[1]<h[3])){C.label=y[1];break}if(y[0]===6&&C.label<h[1]){C.label=h[1],h=y;break}if(h&&C.label<h[2]){C.label=h[2],C.ops.push(y);break}h[2]&&C.ops.pop(),C.trys.pop();continue}y=c.call(l,C)}catch(w){y=[6,w],f=0}finally{d=h=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([T,_])}}},o=this&&this.__values||function(l){var c=typeof Symbol=="function"&&Symbol.iterator,d=c&&l[c],f=0;if(d)return d.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function l(c){c===void 0&&(c=1e3),this._items=new Map,this._limit=c}return l.prototype.get=function(c){return this._items.get(c)},l.prototype.set=function(c,d){if(this._items.set(c,d),this._items.size>this._limit){var f=this._items.keys().next();f.done||this._items.delete(f.value)}},l.prototype.delete=function(c){return this._items.delete(c)},l.prototype.has=function(c){return this._items.has(c)},l.prototype.clear=function(){this._items.clear()},Object.defineProperty(l.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),l.prototype.forEach=function(c,d){this._items.forEach(function(f,h){return c.call(d,h,f)})},l.prototype.keys=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.keys())];case 1:return c.sent(),[2]}})},l.prototype.values=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.values())];case 1:return c.sent(),[2]}})},l.prototype.entries=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items.entries())];case 1:return c.sent(),[2]}})},l.prototype[Symbol.iterator]=function(){return a(this,function(c){switch(c.label){case 0:return[5,o(this._items)];case 1:return c.sent(),[2]}})},Object.defineProperty(l.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),l}();r.ObjectCache=s},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(s){s===void 0&&(s=1e3),this._items=new Map,this._limit=s}return o.prototype.check=function(s,l){if(this._items.get(s)===l)return!0;if(this._items.get(l)===s)return!1;var c=Math.random()<.5;if(c?this._items.set(s,l):this._items.set(l,s),this._items.size>this._limit){var d=this._items.keys().next();d.done||this._items.delete(d.value)}return c},o}();r.CompareCache=a},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(s){this._initialized=!1,this._value=void 0,this._initFunc=s}return Object.defineProperty(o.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),o}();r.Lazy=a},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function o(s){this._pointer=0,this._chars=Array.from(s),this._length=this._chars.length}return Object.defineProperty(o.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),o.prototype.codePoint=function(){if(this._codePoint===void 0)if(this.eof)this._codePoint=-1;else{var s=this._chars[this._pointer].codePointAt(0);this._codePoint=s!==void 0?s:-1}return this._codePoint},o.prototype.c=function(){return this._c===void 0&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},o.prototype.remaining=function(){return this._remaining===void 0&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},o.prototype.substring=function(){return this._substring===void 0&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(o.prototype,"pointer",{get:function(){return this._pointer},set:function(s){s!==this._pointer&&(this._pointer=s,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),o}();r.StringWalker=a},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(218);r.MapWriter=a.MapWriter;var o=i(258);r.XMLWriter=o.XMLWriter;var s=i(67);r.ObjectWriter=s.ObjectWriter;var l=i(260);r.JSONWriter=l.JSONWriter;var c=i(261);r.YAMLWriter=c.YAMLWriter},function(n,r,i){i(19),i(219),i(20),i(22),i(23);var a,o=this&&this.__extends||(a=function(d,f){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var C in p)p.hasOwnProperty(C)&&(h[C]=p[C])})(d,f)},function(d,f){function h(){this.constructor=d}a(d,f),d.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(1),l=i(67),c=function(d){function f(h,p){var C=d.call(this,h)||this;return C._writerOptions=s.applyDefaults(p,{format:"map",wellFormed:!1,group:!1,verbose:!1}),C}return o(f,d),f.prototype.serialize=function(h){var p=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),C=new l.ObjectWriter(this._builderOptions,p).serialize(h);return this._convertObject(C)},f.prototype._convertObject=function(h){if(s.isArray(h)){for(var p=0;p<h.length;p++)h[p]=this._convertObject(h[p]);return h}if(s.isObject(h)){var C=new Map;for(var x in h)C.set(x,this._convertObject(h[x]));return C}return h},f}(i(50).BaseWriter);r.MapWriter=c},function(n,r,i){var a=i(139),o=i(143);n.exports=a("Map",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},o)},function(n,r,i){var a=i(4),o=i(8),s=i(59),l=i(13),c=i(27),d=i(26),f=i(134),h=i(128),p=i(63),C=i(5),x=i(129),T=C("isConcatSpreadable"),_=x>=51||!o(function(){var b=[];return b[T]=!1,b.concat()[0]!==b}),y=p("concat"),w=function(b){if(!l(b))return!1;var M=b[T];return M!==void 0?!!M:s(b)};a({target:"Array",proto:!0,forced:!_||!y},{concat:function(b){var M,I,A,k,U,B=c(this),z=h(B,0),K=0;for(M=-1,A=arguments.length;M<A;M++)if(w(U=M===-1?B:arguments[M])){if(K+(k=d(U.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(I=0;I<k;I++,K++)I in U&&f(z,K,U[I])}else{if(K>=9007199254740991)throw TypeError("Maximum allowed index exceeded");f(z,K++,U)}return z.length=K,z}})},function(n,r,i){var a=i(8);function o(s,l){return RegExp(s,l)}r.UNSUPPORTED_Y=a(function(){var s=o("a","y");return s.lastIndex=2,s.exec("abcd")!=null}),r.BROKEN_CARET=a(function(){var s=o("^r","gy");return s.lastIndex=2,s.exec("str")!=null})},function(n,r,i){var a=i(223);n.exports=function(o){if(a(o))throw TypeError("The method doesn't accept regular expressions");return o}},function(n,r,i){var a=i(13),o=i(42),s=i(5)("match");n.exports=function(l){var c;return a(l)&&((c=l[s])!==void 0?!!c:o(l)=="RegExp")}},function(n,r,i){var a=i(5)("match");n.exports=function(o){var s=/./;try{"/./"[o](s)}catch{try{return s[a]=!1,"/./"[o](s)}catch{}}return!1}},function(n,r,i){i(68);var a=i(25),o=i(8),s=i(5),l=i(93),c=i(21),d=s("species"),f=!o(function(){var T=/./;return T.exec=function(){var _=[];return _.groups={a:"7"},_},"".replace(T,"$<a>")!=="7"}),h="a".replace(/./,"$0")==="$0",p=s("replace"),C=!!/./[p]&&/./[p]("a","$0")==="",x=!o(function(){var T=/(?:)/,_=T.exec;T.exec=function(){return _.apply(this,arguments)};var y="ab".split(T);return y.length!==2||y[0]!=="a"||y[1]!=="b"});n.exports=function(T,_,y,w){var b=s(T),M=!o(function(){var z={};return z[b]=function(){return 7},""[T](z)!=7}),I=M&&!o(function(){var z=!1,K=/a/;return T==="split"&&((K={}).constructor={},K.constructor[d]=function(){return K},K.flags="",K[b]=/./[b]),K.exec=function(){return z=!0,null},K[b](""),!z});if(!M||!I||T==="replace"&&(!f||!h||C)||T==="split"&&!x){var A=/./[b],k=y(b,""[T],function(z,K,J,X,re){return K.exec===l?M&&!re?{done:!0,value:A.call(K,J,X)}:{done:!0,value:z.call(J,K,X)}:{done:!1}},{REPLACE_KEEPS_$0:h,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:C}),U=k[0],B=k[1];a(String.prototype,T,U),a(RegExp.prototype,b,_==2?function(z,K){return B.call(z,this,K)}:function(z){return B.call(z,this)})}w&&c(RegExp.prototype[b],"sham",!0)}},function(n,r,i){var a=i(137).charAt;n.exports=function(o,s,l){return s+(l?a(o,s).length:1)}},function(n,r,i){var a=i(42),o=i(93);n.exports=function(s,l){var c=s.exec;if(typeof c=="function"){var d=c.call(s,l);if(typeof d!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return d}if(a(s)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return o.call(s,l)}},function(n,r,i){(function(a){Object.defineProperty(r,"__esModule",{value:!0});var o=i(96);r.forgivingBase64Encode=function(s){return a.from(s).toString("base64")},r.forgivingBase64Decode=function(s){return s===""?"":((s=s.replace(o.ASCIIWhiteSpace,"")).length%4==0&&(s.endsWith("==")?s=s.substr(0,s.length-2):s.endsWith("=")&&(s=s.substr(0,s.length-1))),s.length%4==1?null:/[0-9A-Za-z+/]/.test(s)?a.from(s,"base64").toString("utf8"):null)}}).call(this,i(145).Buffer)},function(n,r,i){r.byteLength=function(p){var C=f(p),x=C[0],T=C[1];return 3*(x+T)/4-T},r.toByteArray=function(p){var C,x,T=f(p),_=T[0],y=T[1],w=new s(function(I,A,k){return 3*(A+k)/4-k}(0,_,y)),b=0,M=y>0?_-4:_;for(x=0;x<M;x+=4)C=o[p.charCodeAt(x)]<<18|o[p.charCodeAt(x+1)]<<12|o[p.charCodeAt(x+2)]<<6|o[p.charCodeAt(x+3)],w[b++]=C>>16&255,w[b++]=C>>8&255,w[b++]=255&C;return y===2&&(C=o[p.charCodeAt(x)]<<2|o[p.charCodeAt(x+1)]>>4,w[b++]=255&C),y===1&&(C=o[p.charCodeAt(x)]<<10|o[p.charCodeAt(x+1)]<<4|o[p.charCodeAt(x+2)]>>2,w[b++]=C>>8&255,w[b++]=255&C),w},r.fromByteArray=function(p){for(var C,x=p.length,T=x%3,_=[],y=0,w=x-T;y<w;y+=16383)_.push(h(p,y,y+16383>w?w:y+16383));return T===1?(C=p[x-1],_.push(a[C>>2]+a[C<<4&63]+"==")):T===2&&(C=(p[x-2]<<8)+p[x-1],_.push(a[C>>10]+a[C>>4&63]+a[C<<2&63]+"=")),_.join("")};for(var a=[],o=[],s=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,d=l.length;c<d;++c)a[c]=l[c],o[l.charCodeAt(c)]=c;function f(p){var C=p.length;if(C%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var x=p.indexOf("=");return x===-1&&(x=C),[x,x===C?0:4-x%4]}function h(p,C,x){for(var T,_,y=[],w=C;w<x;w+=3)T=(p[w]<<16&16711680)+(p[w+1]<<8&65280)+(255&p[w+2]),y.push(a[(_=T)>>18&63]+a[_>>12&63]+a[_>>6&63]+a[63&_]);return y.join("")}o[45]=62,o[95]=63},function(n,r){r.read=function(i,a,o,s,l){var c,d,f=8*l-s-1,h=(1<<f)-1,p=h>>1,C=-7,x=o?l-1:0,T=o?-1:1,_=i[a+x];for(x+=T,c=_&(1<<-C)-1,_>>=-C,C+=f;C>0;c=256*c+i[a+x],x+=T,C-=8);for(d=c&(1<<-C)-1,c>>=-C,C+=s;C>0;d=256*d+i[a+x],x+=T,C-=8);if(c===0)c=1-p;else{if(c===h)return d?NaN:1/0*(_?-1:1);d+=Math.pow(2,s),c-=p}return(_?-1:1)*d*Math.pow(2,c-s)},r.write=function(i,a,o,s,l,c){var d,f,h,p=8*c-l-1,C=(1<<p)-1,x=C>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=s?0:c-1,y=s?1:-1,w=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(f=isNaN(a)?1:0,d=C):(d=Math.floor(Math.log(a)/Math.LN2),a*(h=Math.pow(2,-d))<1&&(d--,h*=2),(a+=d+x>=1?T/h:T*Math.pow(2,1-x))*h>=2&&(d++,h/=2),d+x>=C?(f=0,d=C):d+x>=1?(f=(a*h-1)*Math.pow(2,l),d+=x):(f=a*Math.pow(2,x-1)*Math.pow(2,l),d=0));l>=8;i[o+_]=255&f,_+=y,f/=256,l-=8);for(d=d<<l|f,p+=l;p>0;i[o+_]=255&d,_+=y,d/=256,p-=8);i[o+_-y]|=128*w}},function(n,r){var i={}.toString;n.exports=Array.isArray||function(a){return i.call(a)=="[object Array]"}},function(n,r,i){var a=this&&this.__values||function(l){var c=typeof Symbol=="function"&&Symbol.iterator,d=c&&l[c],f=0;if(d)return d.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(1);function s(l){var c,d;if(l===null||o.isString(l)||o.isNumber(l))return l;if(o.isArray(l)){var f=new Array;try{for(var h=a(l),p=h.next();!p.done;p=h.next()){var C=p.value;f.push(s(C))}}catch(_){c={error:_}}finally{try{p&&!p.done&&(d=h.return)&&d.call(h)}finally{if(c)throw c.error}}return f}if(o.isObject(l)){f=new Map;for(var x in l)if(l.hasOwnProperty(x)){var T=l[x];f.set(x,s(T))}return f}return l}r.parseJSONFromBytes=function(l){var c=o.utf8Decode(l);return JSON.parse.call(void 0,c)},r.serializeJSONToBytes=function(l){var c=JSON.stringify.call(void 0,l);return o.utf8Encode(c)},r.parseJSONIntoInfraValues=function(l){return s(JSON.parse.call(void 0,l))},r.convertAJSONDerivedJavaScriptValueToAnInfraValue=s},function(n,r,i){var a=this&&this.__generator||function(d,f){var h,p,C,x,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return x={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function _(y){return function(w){return function(b){if(h)throw new TypeError("Generator is already executing.");for(;T;)try{if(h=1,p&&(C=2&b[0]?p.return:b[0]?p.throw||((C=p.return)&&C.call(p),0):p.next)&&!(C=C.call(p,b[1])).done)return C;switch(p=0,C&&(b=[2&b[0],C.value]),b[0]){case 0:case 1:C=b;break;case 4:return T.label++,{value:b[1],done:!1};case 5:T.label++,p=b[1],b=[0];continue;case 7:b=T.ops.pop(),T.trys.pop();continue;default:if(C=T.trys,!((C=C.length>0&&C[C.length-1])||b[0]!==6&&b[0]!==2)){T=0;continue}if(b[0]===3&&(!C||b[1]>C[0]&&b[1]<C[3])){T.label=b[1];break}if(b[0]===6&&T.label<C[1]){T.label=C[1],C=b;break}if(C&&T.label<C[2]){T.label=C[2],T.ops.push(b);break}C[2]&&T.ops.pop(),T.trys.pop();continue}b=f.call(d,T)}catch(M){b=[6,M],p=0}finally{h=C=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([y,w])}}},o=this&&this.__read||function(d,f){var h=typeof Symbol=="function"&&d[Symbol.iterator];if(!h)return d;var p,C,x=h.call(d),T=[];try{for(;(f===void 0||f-- >0)&&!(p=x.next()).done;)T.push(p.value)}catch(_){C={error:_}}finally{try{p&&!p.done&&(h=x.return)&&h.call(x)}finally{if(C)throw C.error}}return T},s=this&&this.__spread||function(){for(var d=[],f=0;f<arguments.length;f++)d=d.concat(o(arguments[f]));return d},l=this&&this.__values||function(d){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&d[f],p=0;if(h)return h.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var c=i(1);r.append=function(d,f){d.push(f)},r.extend=function(d,f){d.push.apply(d,s(f))},r.prepend=function(d,f){d.unshift(f)},r.replace=function(d,f,h){var p,C,x=0;try{for(var T=l(d),_=T.next();!_.done;_=T.next()){var y=_.value;if(c.isFunction(f))f.call(null,y)&&(d[x]=h);else if(y===f)return void(d[x]=h);x++}}catch(w){p={error:w}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(p)throw p.error}}},r.insert=function(d,f,h){d.splice(h,0,f)},r.remove=function(d,f){for(var h=d.length;h--;){var p=d[h];if(c.isFunction(f))f.call(null,p)&&d.splice(h,1);else if(p===f)return void d.splice(h,1)}},r.empty=function(d){d.length=0},r.contains=function(d,f){var h,p;try{for(var C=l(d),x=C.next();!x.done;x=C.next()){var T=x.value;if(c.isFunction(f)){if(f.call(null,T))return!0}else if(T===f)return!0}}catch(_){h={error:_}}finally{try{x&&!x.done&&(p=C.return)&&p.call(C)}finally{if(h)throw h.error}}return!1},r.size=function(d,f){var h,p;if(f===void 0)return d.length;var C=0;try{for(var x=l(d),T=x.next();!T.done;T=x.next()){var _=T.value;f.call(null,_)&&C++}}catch(y){h={error:y}}finally{try{T&&!T.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}return C},r.isEmpty=function(d){return d.length===0},r.forEach=function(d,f){var h,p,C,x,T,_;return a(this,function(y){switch(y.label){case 0:return f!==void 0?[3,2]:[5,l(d)];case 1:return y.sent(),[3,9];case 2:y.trys.push([2,7,8,9]),h=l(d),p=h.next(),y.label=3;case 3:return p.done?[3,6]:(C=p.value,f.call(null,C)?[4,C]:[3,5]);case 4:y.sent(),y.label=5;case 5:return p=h.next(),[3,3];case 6:return[3,9];case 7:return x=y.sent(),T={error:x},[3,9];case 8:try{p&&!p.done&&(_=h.return)&&_.call(h)}finally{if(T)throw T.error}return[7];case 9:return[2]}})},r.clone=function(d){return new(Array.bind.apply(Array,s([void 0],d)))},r.sortInAscendingOrder=function(d,f){return d.sort(function(h,p){return f.call(null,h,p)?-1:1})},r.sortInDescendingOrder=function(d,f){return d.sort(function(h,p){return f.call(null,h,p)?1:-1})}},function(n,r,i){var a=this&&this.__generator||function(d,f){var h,p,C,x,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return x={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function _(y){return function(w){return function(b){if(h)throw new TypeError("Generator is already executing.");for(;T;)try{if(h=1,p&&(C=2&b[0]?p.return:b[0]?p.throw||((C=p.return)&&C.call(p),0):p.next)&&!(C=C.call(p,b[1])).done)return C;switch(p=0,C&&(b=[2&b[0],C.value]),b[0]){case 0:case 1:C=b;break;case 4:return T.label++,{value:b[1],done:!1};case 5:T.label++,p=b[1],b=[0];continue;case 7:b=T.ops.pop(),T.trys.pop();continue;default:if(C=T.trys,!((C=C.length>0&&C[C.length-1])||b[0]!==6&&b[0]!==2)){T=0;continue}if(b[0]===3&&(!C||b[1]>C[0]&&b[1]<C[3])){T.label=b[1];break}if(b[0]===6&&T.label<C[1]){T.label=C[1],C=b;break}if(C&&T.label<C[2]){T.label=C[2],T.ops.push(b);break}C[2]&&T.ops.pop(),T.trys.pop();continue}b=f.call(d,T)}catch(M){b=[6,M],p=0}finally{h=C=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([y,w])}}},o=this&&this.__values||function(d){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&d[f],p=0;if(h)return h.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(d,f){var h=typeof Symbol=="function"&&d[Symbol.iterator];if(!h)return d;var p,C,x=h.call(d),T=[];try{for(;(f===void 0||f-- >0)&&!(p=x.next()).done;)T.push(p.value)}catch(_){C={error:_}}finally{try{p&&!p.done&&(h=x.return)&&h.call(x)}finally{if(C)throw C.error}}return T},l=this&&this.__spread||function(){for(var d=[],f=0;f<arguments.length;f++)d=d.concat(s(arguments[f]));return d};Object.defineProperty(r,"__esModule",{value:!0});var c=i(1);r.get=function(d,f){return d.get(f)},r.set=function(d,f,h){d.set(f,h)},r.remove=function(d,f){var h,p,C,x;if(c.isFunction(f)){var T=[];try{for(var _=o(d),y=_.next();!y.done;y=_.next()){var w=y.value;f.call(null,w)&&T.push(w[0])}}catch(A){h={error:A}}finally{try{y&&!y.done&&(p=_.return)&&p.call(_)}finally{if(h)throw h.error}}try{for(var b=o(T),M=b.next();!M.done;M=b.next()){var I=M.value;d.delete(I)}}catch(A){C={error:A}}finally{try{M&&!M.done&&(x=b.return)&&x.call(b)}finally{if(C)throw C.error}}}else d.delete(f)},r.contains=function(d,f){var h,p;if(c.isFunction(f)){try{for(var C=o(d),x=C.next();!x.done;x=C.next()){var T=x.value;if(f.call(null,T))return!0}}catch(_){h={error:_}}finally{try{x&&!x.done&&(p=C.return)&&p.call(C)}finally{if(h)throw h.error}}return!1}return d.has(f)},r.keys=function(d){return new Set(d.keys())},r.values=function(d){return l(d.values())},r.size=function(d,f){var h,p;if(f===void 0)return d.size;var C=0;try{for(var x=o(d),T=x.next();!T.done;T=x.next()){var _=T.value;f.call(null,_)&&C++}}catch(y){h={error:y}}finally{try{T&&!T.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}return C},r.isEmpty=function(d){return d.size===0},r.forEach=function(d,f){var h,p,C,x,T,_;return a(this,function(y){switch(y.label){case 0:return f!==void 0?[3,2]:[5,o(d)];case 1:return y.sent(),[3,9];case 2:y.trys.push([2,7,8,9]),h=o(d),p=h.next(),y.label=3;case 3:return p.done?[3,6]:(C=p.value,f.call(null,C)?[4,C]:[3,5]);case 4:y.sent(),y.label=5;case 5:return p=h.next(),[3,3];case 6:return[3,9];case 7:return x=y.sent(),T={error:x},[3,9];case 8:try{p&&!p.done&&(_=h.return)&&_.call(h)}finally{if(T)throw T.error}return[7];case 9:return[2]}})},r.clone=function(d){return new Map(d)},r.sortInAscendingOrder=function(d,f){var h=new(Array.bind.apply(Array,l([void 0],d)));return h.sort(function(p,C){return f.call(null,p,C)?-1:1}),new Map(h)},r.sortInDescendingOrder=function(d,f){var h=new(Array.bind.apply(Array,l([void 0],d)));return h.sort(function(p,C){return f.call(null,p,C)?1:-1}),new Map(h)}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.HTML="http://www.w3.org/1999/xhtml",r.XML="http://www.w3.org/XML/1998/namespace",r.XMLNS="http://www.w3.org/2000/xmlns/",r.MathML="http://www.w3.org/1998/Math/MathML",r.SVG="http://www.w3.org/2000/svg",r.XLink="http://www.w3.org/1999/xlink"},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.enqueue=function(a,o){a.push(o)},r.dequeue=function(a){return a.shift()||null}},function(n,r,i){var a=this&&this.__generator||function(f,h){var p,C,x,T,_={label:0,sent:function(){if(1&x[0])throw x[1];return x[1]},trys:[],ops:[]};return T={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function y(w){return function(b){return function(M){if(p)throw new TypeError("Generator is already executing.");for(;_;)try{if(p=1,C&&(x=2&M[0]?C.return:M[0]?C.throw||((x=C.return)&&x.call(C),0):C.next)&&!(x=x.call(C,M[1])).done)return x;switch(C=0,x&&(M=[2&M[0],x.value]),M[0]){case 0:case 1:x=M;break;case 4:return _.label++,{value:M[1],done:!1};case 5:_.label++,C=M[1],M=[0];continue;case 7:M=_.ops.pop(),_.trys.pop();continue;default:if(x=_.trys,!((x=x.length>0&&x[x.length-1])||M[0]!==6&&M[0]!==2)){_=0;continue}if(M[0]===3&&(!x||M[1]>x[0]&&M[1]<x[3])){_.label=M[1];break}if(M[0]===6&&_.label<x[1]){_.label=x[1],x=M;break}if(x&&_.label<x[2]){_.label=x[2],_.ops.push(M);break}x[2]&&_.ops.pop(),_.trys.pop();continue}M=h.call(f,_)}catch(I){M=[6,I],C=0}finally{p=x=0}if(5&M[0])throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}([w,b])}}},o=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(f,h){var p=typeof Symbol=="function"&&f[Symbol.iterator];if(!p)return f;var C,x,T=p.call(f),_=[];try{for(;(h===void 0||h-- >0)&&!(C=T.next()).done;)_.push(C.value)}catch(y){x={error:y}}finally{try{C&&!C.done&&(p=T.return)&&p.call(T)}finally{if(x)throw x.error}}return _},l=this&&this.__spread||function(){for(var f=[],h=0;h<arguments.length;h++)f=f.concat(s(arguments[h]));return f};Object.defineProperty(r,"__esModule",{value:!0});var c=i(1);function d(f,h){var p,C;try{for(var x=o(f),T=x.next();!T.done;T=x.next()){var _=T.value;if(!h.has(_))return!1}}catch(y){p={error:y}}finally{try{T&&!T.done&&(C=x.return)&&C.call(x)}finally{if(p)throw p.error}}return!0}r.append=function(f,h){f.add(h)},r.extend=function(f,h){h.forEach(f.add,f)},r.prepend=function(f,h){var p=new Set(f);f.clear(),f.add(h),p.forEach(f.add,f)},r.replace=function(f,h,p){var C,x,T=new Set;try{for(var _=o(f),y=_.next();!y.done;y=_.next()){var w=y.value;c.isFunction(h)?h.call(null,w)?T.add(p):T.add(w):w===h?T.add(p):T.add(w)}}catch(b){C={error:b}}finally{try{y&&!y.done&&(x=_.return)&&x.call(_)}finally{if(C)throw C.error}}f.clear(),T.forEach(f.add,f)},r.insert=function(f,h,p){var C,x,T=new Set,_=0;try{for(var y=o(f),w=y.next();!w.done;w=y.next()){var b=w.value;_===p&&T.add(h),T.add(b),_++}}catch(M){C={error:M}}finally{try{w&&!w.done&&(x=y.return)&&x.call(y)}finally{if(C)throw C.error}}f.clear(),T.forEach(f.add,f)},r.remove=function(f,h){var p,C,x,T;if(c.isFunction(h)){var _=[];try{for(var y=o(f),w=y.next();!w.done;w=y.next()){var b=w.value;h.call(null,b)&&_.push(b)}}catch(k){p={error:k}}finally{try{w&&!w.done&&(C=y.return)&&C.call(y)}finally{if(p)throw p.error}}try{for(var M=o(_),I=M.next();!I.done;I=M.next()){var A=I.value;f.delete(A)}}catch(k){x={error:k}}finally{try{I&&!I.done&&(T=M.return)&&T.call(M)}finally{if(x)throw x.error}}}else f.delete(h)},r.empty=function(f){f.clear()},r.contains=function(f,h){var p,C;if(!c.isFunction(h))return f.has(h);try{for(var x=o(f),T=x.next();!T.done;T=x.next()){var _=T.value;if(h.call(null,_))return!0}}catch(y){p={error:y}}finally{try{T&&!T.done&&(C=x.return)&&C.call(x)}finally{if(p)throw p.error}}return!1},r.size=function(f,h){var p,C;if(h===void 0)return f.size;var x=0;try{for(var T=o(f),_=T.next();!_.done;_=T.next()){var y=_.value;h.call(null,y)&&x++}}catch(w){p={error:w}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(p)throw p.error}}return x},r.isEmpty=function(f){return f.size===0},r.forEach=function(f,h){var p,C,x,T,_,y;return a(this,function(w){switch(w.label){case 0:return h!==void 0?[3,2]:[5,o(f)];case 1:return w.sent(),[3,9];case 2:w.trys.push([2,7,8,9]),p=o(f),C=p.next(),w.label=3;case 3:return C.done?[3,6]:(x=C.value,h.call(null,x)?[4,x]:[3,5]);case 4:w.sent(),w.label=5;case 5:return C=p.next(),[3,3];case 6:return[3,9];case 7:return T=w.sent(),_={error:T},[3,9];case 8:try{C&&!C.done&&(y=p.return)&&y.call(p)}finally{if(_)throw _.error}return[7];case 9:return[2]}})},r.clone=function(f){return new Set(f)},r.sortInAscendingOrder=function(f,h){var p=new(Array.bind.apply(Array,l([void 0],f)));return p.sort(function(C,x){return h.call(null,C,x)?-1:1}),new Set(p)},r.sortInDescendingOrder=function(f,h){var p=new(Array.bind.apply(Array,l([void 0],f)));return p.sort(function(C,x){return h.call(null,C,x)?1:-1}),new Set(p)},r.isSubsetOf=d,r.isSupersetOf=function(f,h){return d(h,f)},r.intersection=function(f,h){var p,C,x=new Set;try{for(var T=o(f),_=T.next();!_.done;_=T.next()){var y=_.value;h.has(y)&&x.add(y)}}catch(w){p={error:w}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(p)throw p.error}}return x},r.union=function(f,h){var p=new Set(f);return h.forEach(p.add,p),p},r.range=function(f,h){for(var p=new Set,C=f;C<=h;C++)p.add(C);return p}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.push=function(a,o){a.push(o)},r.pop=function(a){return a.pop()||null}},function(n,r,i){var a=this&&this.__values||function(_){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&_[y],b=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&b>=_.length&&(_=void 0),{value:_&&_[b++],done:!_}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(96),s=i(147),l=i(146),c=i(1);function d(_,y){for(var w=0;;){var b=w<_.length?_.charCodeAt(w):null,M=w<y.length?y.charCodeAt(w):null;if(b===null)return!0;if(b!==M)return!1;w++}}function f(_){var y,w,b=Array.from(_),M=new Uint8Array(b.length),I=0;try{for(var A=a(_),k=A.next();!k.done;k=A.next()){var U=k.value.codePointAt(0);console.assert(U!==void 0&&U<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),U!==void 0&&U<=255&&(M[I++]=U)}}catch(B){y={error:B}}finally{try{k&&!k.done&&(w=A.return)&&w.call(A)}finally{if(y)throw y.error}}return M}function h(_){return/^[\u0000-\u007F]*$/.test(_)}function p(_){var y,w,b="";try{for(var M=a(_),I=M.next();!I.done;I=M.next()){var A=I.value,k=A.codePointAt(0);b+=k!==void 0&&k>=65&&k<=90?String.fromCodePoint(k+32):A}}catch(U){y={error:U}}finally{try{I&&!I.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}return b}function C(_){return _.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function x(_,y,w){if(!c.isArray(y))return x(_,Array.from(y),w);for(var b="";w.position<y.length&&_.call(null,y[w.position]);)b+=y[w.position],w.position++;return b}function T(_,y){x(function(w){return o.ASCIIWhiteSpace.test(w)},_,y)}r.isCodeUnitPrefix=d,r.isCodeUnitLessThan=function(_,y){if(d(y,_))return!1;if(d(_,y))return!0;for(var w=0;w<Math.min(_.length,y.length);w++){var b=_.charCodeAt(w),M=y.charCodeAt(w);if(b!==M)return b<M}return!1},r.isomorphicEncode=f,r.isASCIIString=h,r.asciiLowercase=p,r.asciiUppercase=function(_){var y,w,b="";try{for(var M=a(_),I=M.next();!I.done;I=M.next()){var A=I.value,k=A.codePointAt(0);b+=k!==void 0&&k>=97&&k<=122?String.fromCodePoint(k-32):A}}catch(U){y={error:U}}finally{try{I&&!I.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}return b},r.asciiCaseInsensitiveMatch=function(_,y){return p(_)===p(y)},r.asciiEncode=function(_){return console.assert(h(_),"asciiEncode requires an ASCII string."),f(_)},r.asciiDecode=function(_){var y,w;try{for(var b=a(_),M=b.next();!M.done;M=b.next()){var I=M.value;console.assert(l.isASCIIByte(I),"asciiDecode requires an ASCII byte sequence.")}}catch(A){y={error:A}}finally{try{M&&!M.done&&(w=b.return)&&w.call(b)}finally{if(y)throw y.error}}return s.isomorphicDecode(_)},r.stripNewlines=function(_){return _.replace(/[\n\r]/g,"")},r.normalizeNewlines=function(_){return _.replace(/\r\n/g,`
`).replace(/\r/g,`
`)},r.stripLeadingAndTrailingASCIIWhitespace=C,r.stripAndCollapseASCIIWhitespace=function(_){return C(_.replace(/[\t\n\f\r ]{2,}/g," "))},r.collectASequenceOfCodePoints=x,r.skipASCIIWhitespace=T,r.strictlySplit=function _(y,w){if(!c.isArray(y))return _(Array.from(y),w);var b={position:0},M=[],I=x(function(A){return w!==A},y,b);for(M.push(I);b.position<y.length;)console.assert(y[b.position]===w,"strictlySplit found no delimiter in input string."),b.position++,I=x(function(A){return w!==A},y,b),M.push(I);return M},r.splitAStringOnASCIIWhitespace=function _(y){if(!c.isArray(y))return _(Array.from(y));var w={position:0},b=[];for(T(y,w);w.position<y.length;){var M=x(function(I){return!o.ASCIIWhiteSpace.test(I)},y,w);b.push(M),T(y,w)}return b},r.splitAStringOnCommas=function _(y){if(!c.isArray(y))return _(Array.from(y));for(var w={position:0},b=[];w.position<y.length;){var M=x(function(I){return I!==","},y,w);b.push(C(M)),w.position<y.length&&(console.assert(y[w.position]===",","splitAStringOnCommas found no delimiter in input string."),w.position++)}return b},r.concatenate=function(_,y){return y===void 0&&(y=""),_.length===0?"":_.join(y)}},function(n,r,i){var a=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,c=l&&s[l],d=0;if(c)return c.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(97);r.abort_add=function(s,l){l._abortedFlag||l._abortAlgorithms.add(s)},r.abort_remove=function(s,l){l._abortAlgorithms.delete(s)},r.abort_signalAbort=function(s){var l,c;if(!s._abortedFlag){s._abortedFlag=!0;try{for(var d=a(s._abortAlgorithms),f=d.next();!f.done;f=d.next())f.value.call(s)}catch(h){l={error:h}}finally{try{f&&!f.done&&(c=d.return)&&c.call(d)}finally{if(l)throw l.error}}s._abortAlgorithms.clear(),o.event_fireAnEvent("abort",s)}}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(150),o=function(){function s(){}return s.asNode=function(l){if(a.Guard.isNode(l))return l;throw new Error("Invalid object. Node expected.")},s}();r.Cast=o},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function s(){}return Object.defineProperty(s.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),s.prototype.add=function(l){throw new Error("Cannot add to an empty set.")},s.prototype.clear=function(){},s.prototype.delete=function(l){return!1},s.prototype.forEach=function(l,c){},s.prototype.has=function(l){return!1},s.prototype[Symbol.iterator]=function(){return new o},s.prototype.entries=function(){return new o},s.prototype.keys=function(){return new o},s.prototype.values=function(){return new o},Object.defineProperty(s.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),s}();r.EmptySet=a;var o=function(){function s(){}return s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){return{done:!0,value:null}},s}()},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),function(a){a[a.SchemeStart=0]="SchemeStart",a[a.Scheme=1]="Scheme",a[a.NoScheme=2]="NoScheme",a[a.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",a[a.PathOrAuthority=4]="PathOrAuthority",a[a.Relative=5]="Relative",a[a.RelativeSlash=6]="RelativeSlash",a[a.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",a[a.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",a[a.Authority=9]="Authority",a[a.Host=10]="Host",a[a.Hostname=11]="Hostname",a[a.Port=12]="Port",a[a.File=13]="File",a[a.FileSlash=14]="FileSlash",a[a.FileHost=15]="FileHost",a[a.PathStart=16]="PathStart",a[a.Path=17]="Path",a[a.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",a[a.Query=19]="Query",a[a.Fragment=20]="Fragment"}(r.ParserState||(r.ParserState={})),r.OpaqueOrigin=["","",null,null]},function(n,r,i){var a=i(245),o=i(247);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=M,r.resolve=function(I,A){return M(I,!1,!0).resolve(A)},r.resolveObject=function(I,A){return I?M(I,!1,!0).resolveObject(A):A},r.format=function(I){return o.isString(I)&&(I=M(I)),I instanceof s?I.format():s.prototype.format.call(I)},r.Url=s;var l=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),h=["'"].concat(f),p=["%","/","?",";","#"].concat(h),C=["/","?","#"],x=/^[+a-z0-9A-Z_-]{0,63}$/,T=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=i(248);function M(I,A,k){if(I&&o.isObject(I)&&I instanceof s)return I;var U=new s;return U.parse(I,A,k),U}s.prototype.parse=function(I,A,k){if(!o.isString(I))throw new TypeError("Parameter 'url' must be a string, not "+typeof I);var U=I.indexOf("?"),B=U!==-1&&U<I.indexOf("#")?"?":"#",z=I.split(B);z[0]=z[0].replace(/\\/g,"/");var K=I=z.join(B);if(K=K.trim(),!k&&I.split("#").length===1){var J=d.exec(K);if(J)return this.path=K,this.href=K,this.pathname=J[1],J[2]?(this.search=J[2],this.query=A?b.parse(this.search.substr(1)):this.search.substr(1)):A&&(this.search="",this.query={}),this}var X=l.exec(K);if(X){var re=(X=X[0]).toLowerCase();this.protocol=re,K=K.substr(X.length)}if(k||X||K.match(/^\/\/[^@\/]+@[^@\/]+/)){var fe=K.substr(0,2)==="//";!fe||X&&y[X]||(K=K.substr(2),this.slashes=!0)}if(!y[X]&&(fe||X&&!w[X])){for(var pe,ie,te=-1,ee=0;ee<C.length;ee++)(we=K.indexOf(C[ee]))!==-1&&(te===-1||we<te)&&(te=we);for((ie=te===-1?K.lastIndexOf("@"):K.lastIndexOf("@",te))!==-1&&(pe=K.slice(0,ie),K=K.slice(ie+1),this.auth=decodeURIComponent(pe)),te=-1,ee=0;ee<p.length;ee++){var we;(we=K.indexOf(p[ee]))!==-1&&(te===-1||we<te)&&(te=we)}te===-1&&(te=K.length),this.host=K.slice(0,te),K=K.slice(te),this.parseHost(),this.hostname=this.hostname||"";var Ce=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!Ce)for(var De=this.hostname.split(/\./),Re=(ee=0,De.length);ee<Re;ee++){var Oe=De[ee];if(Oe&&!Oe.match(x)){for(var Ve="",Ge=0,qe=Oe.length;Ge<qe;Ge++)Oe.charCodeAt(Ge)>127?Ve+="x":Ve+=Oe[Ge];if(!Ve.match(x)){var Be=De.slice(0,ee),ae=De.slice(ee+1),H=Oe.match(T);H&&(Be.push(H[1]),ae.unshift(H[2])),ae.length&&(K="/"+ae.join(".")+K),this.hostname=Be.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),Ce||(this.hostname=a.toASCII(this.hostname));var ce=this.port?":"+this.port:"",se=this.hostname||"";this.host=se+ce,this.href+=this.host,Ce&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),K[0]!=="/"&&(K="/"+K))}if(!_[re])for(ee=0,Re=h.length;ee<Re;ee++){var he=h[ee];if(K.indexOf(he)!==-1){var ve=encodeURIComponent(he);ve===he&&(ve=escape(he)),K=K.split(he).join(ve)}}var ye=K.indexOf("#");ye!==-1&&(this.hash=K.substr(ye),K=K.slice(0,ye));var Ae=K.indexOf("?");if(Ae!==-1?(this.search=K.substr(Ae),this.query=K.substr(Ae+1),A&&(this.query=b.parse(this.query)),K=K.slice(0,Ae)):A&&(this.search="",this.query={}),K&&(this.pathname=K),w[re]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){ce=this.pathname||"";var Ue=this.search||"";this.path=ce+Ue}return this.href=this.format(),this},s.prototype.format=function(){var I=this.auth||"";I&&(I=(I=encodeURIComponent(I)).replace(/%3A/i,":"),I+="@");var A=this.protocol||"",k=this.pathname||"",U=this.hash||"",B=!1,z="";this.host?B=I+this.host:this.hostname&&(B=I+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(B+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(z=b.stringify(this.query));var K=this.search||z&&"?"+z||"";return A&&A.substr(-1)!==":"&&(A+=":"),this.slashes||(!A||w[A])&&B!==!1?(B="//"+(B||""),k&&k.charAt(0)!=="/"&&(k="/"+k)):B||(B=""),U&&U.charAt(0)!=="#"&&(U="#"+U),K&&K.charAt(0)!=="?"&&(K="?"+K),A+B+(k=k.replace(/[?#]/g,function(J){return encodeURIComponent(J)}))+(K=K.replace("#","%23"))+U},s.prototype.resolve=function(I){return this.resolveObject(M(I,!1,!0)).format()},s.prototype.resolveObject=function(I){if(o.isString(I)){var A=new s;A.parse(I,!1,!0),I=A}for(var k=new s,U=Object.keys(this),B=0;B<U.length;B++){var z=U[B];k[z]=this[z]}if(k.hash=I.hash,I.href==="")return k.href=k.format(),k;if(I.slashes&&!I.protocol){for(var K=Object.keys(I),J=0;J<K.length;J++){var X=K[J];X!=="protocol"&&(k[X]=I[X])}return w[k.protocol]&&k.hostname&&!k.pathname&&(k.path=k.pathname="/"),k.href=k.format(),k}if(I.protocol&&I.protocol!==k.protocol){if(!w[I.protocol]){for(var re=Object.keys(I),fe=0;fe<re.length;fe++){var pe=re[fe];k[pe]=I[pe]}return k.href=k.format(),k}if(k.protocol=I.protocol,I.host||y[I.protocol])k.pathname=I.pathname;else{for(var ie=(I.pathname||"").split("/");ie.length&&!(I.host=ie.shift()););I.host||(I.host=""),I.hostname||(I.hostname=""),ie[0]!==""&&ie.unshift(""),ie.length<2&&ie.unshift(""),k.pathname=ie.join("/")}if(k.search=I.search,k.query=I.query,k.host=I.host||"",k.auth=I.auth,k.hostname=I.hostname||I.host,k.port=I.port,k.pathname||k.search){var te=k.pathname||"",ee=k.search||"";k.path=te+ee}return k.slashes=k.slashes||I.slashes,k.href=k.format(),k}var we=k.pathname&&k.pathname.charAt(0)==="/",Ce=I.host||I.pathname&&I.pathname.charAt(0)==="/",De=Ce||we||k.host&&I.pathname,Re=De,Oe=k.pathname&&k.pathname.split("/")||[],Ve=(ie=I.pathname&&I.pathname.split("/")||[],k.protocol&&!w[k.protocol]);if(Ve&&(k.hostname="",k.port=null,k.host&&(Oe[0]===""?Oe[0]=k.host:Oe.unshift(k.host)),k.host="",I.protocol&&(I.hostname=null,I.port=null,I.host&&(ie[0]===""?ie[0]=I.host:ie.unshift(I.host)),I.host=null),De=De&&(ie[0]===""||Oe[0]==="")),Ce)k.host=I.host||I.host===""?I.host:k.host,k.hostname=I.hostname||I.hostname===""?I.hostname:k.hostname,k.search=I.search,k.query=I.query,Oe=ie;else if(ie.length)Oe||(Oe=[]),Oe.pop(),Oe=Oe.concat(ie),k.search=I.search,k.query=I.query;else if(!o.isNullOrUndefined(I.search))return Ve&&(k.hostname=k.host=Oe.shift(),(H=!!(k.host&&k.host.indexOf("@")>0)&&k.host.split("@"))&&(k.auth=H.shift(),k.host=k.hostname=H.shift())),k.search=I.search,k.query=I.query,o.isNull(k.pathname)&&o.isNull(k.search)||(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.href=k.format(),k;if(!Oe.length)return k.pathname=null,k.search?k.path="/"+k.search:k.path=null,k.href=k.format(),k;for(var Ge=Oe.slice(-1)[0],qe=(k.host||I.host||Oe.length>1)&&(Ge==="."||Ge==="..")||Ge==="",Be=0,ae=Oe.length;ae>=0;ae--)(Ge=Oe[ae])==="."?Oe.splice(ae,1):Ge===".."?(Oe.splice(ae,1),Be++):Be&&(Oe.splice(ae,1),Be--);if(!De&&!Re)for(;Be--;Be)Oe.unshift("..");!De||Oe[0]===""||Oe[0]&&Oe[0].charAt(0)==="/"||Oe.unshift(""),qe&&Oe.join("/").substr(-1)!=="/"&&Oe.push("");var H,ce=Oe[0]===""||Oe[0]&&Oe[0].charAt(0)==="/";return Ve&&(k.hostname=k.host=ce?"":Oe.length?Oe.shift():"",(H=!!(k.host&&k.host.indexOf("@")>0)&&k.host.split("@"))&&(k.auth=H.shift(),k.host=k.hostname=H.shift())),(De=De||k.host&&Oe.length)&&!ce&&Oe.unshift(""),Oe.length?k.pathname=Oe.join("/"):(k.pathname=null,k.path=null),o.isNull(k.pathname)&&o.isNull(k.search)||(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.auth=I.auth||k.auth,k.slashes=k.slashes||I.slashes,k.href=k.format(),k},s.prototype.parseHost=function(){var I=this.host,A=c.exec(I);A&&((A=A[0])!==":"&&(this.port=A.substr(1)),I=I.substr(0,I.length-A.length)),I&&(this.hostname=I)}},function(n,r,i){(function(a,o){var s;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(l){r&&r.nodeType,a&&a.nodeType;var c=typeof o=="object"&&o;c.global!==c&&c.window!==c&&c.self;var d,f=2147483647,h=/^xn--/,p=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=Math.floor,_=String.fromCharCode;function y(z){throw new RangeError(x[z])}function w(z,K){for(var J=z.length,X=[];J--;)X[J]=K(z[J]);return X}function b(z,K){var J=z.split("@"),X="";return J.length>1&&(X=J[0]+"@",z=J[1]),X+w((z=z.replace(C,".")).split("."),K).join(".")}function M(z){for(var K,J,X=[],re=0,fe=z.length;re<fe;)(K=z.charCodeAt(re++))>=55296&&K<=56319&&re<fe?(64512&(J=z.charCodeAt(re++)))==56320?X.push(((1023&K)<<10)+(1023&J)+65536):(X.push(K),re--):X.push(K);return X}function I(z){return w(z,function(K){var J="";return K>65535&&(J+=_((K-=65536)>>>10&1023|55296),K=56320|1023&K),J+=_(K)}).join("")}function A(z,K){return z+22+75*(z<26)-((K!=0)<<5)}function k(z,K,J){var X=0;for(z=J?T(z/700):z>>1,z+=T(z/K);z>455;X+=36)z=T(z/35);return T(X+36*z/(z+38))}function U(z){var K,J,X,re,fe,pe,ie,te,ee,we,Ce,De=[],Re=z.length,Oe=0,Ve=128,Ge=72;for((J=z.lastIndexOf("-"))<0&&(J=0),X=0;X<J;++X)z.charCodeAt(X)>=128&&y("not-basic"),De.push(z.charCodeAt(X));for(re=J>0?J+1:0;re<Re;){for(fe=Oe,pe=1,ie=36;re>=Re&&y("invalid-input"),((te=(Ce=z.charCodeAt(re++))-48<10?Ce-22:Ce-65<26?Ce-65:Ce-97<26?Ce-97:36)>=36||te>T((f-Oe)/pe))&&y("overflow"),Oe+=te*pe,!(te<(ee=ie<=Ge?1:ie>=Ge+26?26:ie-Ge));ie+=36)pe>T(f/(we=36-ee))&&y("overflow"),pe*=we;Ge=k(Oe-fe,K=De.length+1,fe==0),T(Oe/K)>f-Ve&&y("overflow"),Ve+=T(Oe/K),Oe%=K,De.splice(Oe++,0,Ve)}return I(De)}function B(z){var K,J,X,re,fe,pe,ie,te,ee,we,Ce,De,Re,Oe,Ve,Ge=[];for(De=(z=M(z)).length,K=128,J=0,fe=72,pe=0;pe<De;++pe)(Ce=z[pe])<128&&Ge.push(_(Ce));for(X=re=Ge.length,re&&Ge.push("-");X<De;){for(ie=f,pe=0;pe<De;++pe)(Ce=z[pe])>=K&&Ce<ie&&(ie=Ce);for(ie-K>T((f-J)/(Re=X+1))&&y("overflow"),J+=(ie-K)*Re,K=ie,pe=0;pe<De;++pe)if((Ce=z[pe])<K&&++J>f&&y("overflow"),Ce==K){for(te=J,ee=36;!(te<(we=ee<=fe?1:ee>=fe+26?26:ee-fe));ee+=36)Ve=te-we,Oe=36-we,Ge.push(_(A(we+Ve%Oe,0))),te=T(Ve/Oe);Ge.push(_(A(te,0))),fe=k(J,Re,X==re),J=0,++X}++J,++K}return Ge.join("")}d={version:"1.4.1",ucs2:{decode:M,encode:I},decode:U,encode:B,toASCII:function(z){return b(z,function(K){return p.test(K)?"xn--"+B(K):K})},toUnicode:function(z){return b(z,function(K){return h.test(K)?U(K.slice(4).toLowerCase()):K})}},(s=(function(){return d}).call(r,i,r,a))===void 0||(a.exports=s)})()}).call(this,i(246)(n),i(78))},function(n,r){n.exports=function(i){return i.webpackPolyfill||(i.deprecate=function(){},i.paths=[],i.children||(i.children=[]),Object.defineProperty(i,"loaded",{enumerable:!0,get:function(){return i.l}}),Object.defineProperty(i,"id",{enumerable:!0,get:function(){return i.i}}),i.webpackPolyfill=1),i}},function(n,r,i){n.exports={isString:function(a){return typeof a=="string"},isObject:function(a){return typeof a=="object"&&a!==null},isNull:function(a){return a===null},isNullOrUndefined:function(a){return a==null}}},function(n,r,i){r.decode=r.parse=i(249),r.encode=r.stringify=i(250)},function(n,r,i){function a(s,l){return Object.prototype.hasOwnProperty.call(s,l)}n.exports=function(s,l,c,d){l=l||"&",c=c||"=";var f={};if(typeof s!="string"||s.length===0)return f;var h=/\+/g;s=s.split(l);var p=1e3;d&&typeof d.maxKeys=="number"&&(p=d.maxKeys);var C=s.length;p>0&&C>p&&(C=p);for(var x=0;x<C;++x){var T,_,y,w,b=s[x].replace(h,"%20"),M=b.indexOf(c);M>=0?(T=b.substr(0,M),_=b.substr(M+1)):(T=b,_=""),y=decodeURIComponent(T),w=decodeURIComponent(_),a(f,y)?o(f[y])?f[y].push(w):f[y]=[f[y],w]:f[y]=w}return f};var o=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"}},function(n,r,i){var a=function(c){switch(typeof c){case"string":return c;case"boolean":return c?"true":"false";case"number":return isFinite(c)?c:"";default:return""}};n.exports=function(c,d,f,h){return d=d||"&",f=f||"=",c===null&&(c=void 0),typeof c=="object"?s(l(c),function(p){var C=encodeURIComponent(a(p))+f;return o(c[p])?s(c[p],function(x){return C+encodeURIComponent(a(x))}).join(d):C+encodeURIComponent(a(c[p]))}).join(d):h?encodeURIComponent(a(h))+f+encodeURIComponent(a(c)):""};var o=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function s(c,d){if(c.map)return c.map(d);for(var f=[],h=0;h<c.length;h++)f.push(d(c[h],h));return f}var l=Object.keys||function(c){var d=[];for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&d.push(f);return d}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(52);r.attr_setAnExistingAttributeValue=function(o,s){o._element===null?o._value=s:a.element_change(o,o._element,s)}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(108),o=i(30),s=i(52);r.tokenList_validationSteps=function(l,c){if(!o.dom_hasSupportedTokens(l._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+l._attribute._localName+"'.");return o.dom_getSupportedTokens(l._attribute._localName).has(c.toLowerCase())},r.tokenList_updateSteps=function(l){(l._element.hasAttribute(l._attribute._localName)||l._tokenSet.size!==0)&&s.element_setAnAttributeValue(l._element,l._attribute._localName,a.orderedSet_serialize(l._tokenSet))},r.tokenList_serializeSteps=function(l){return s.element_getAnAttributeValue(l._element,l._attribute._localName)}},function(n,r,i){var a=this&&this.__values||function(l){var c=typeof Symbol=="function"&&Symbol.iterator,d=c&&l[c],f=0;if(d)return d.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(1);function s(l){return o.isBoolean(l)?l:l.capture||!1}r.eventTarget_flatten=s,r.eventTarget_flattenMore=function(l){var c=s(l),d=!1,f=!1;return o.isBoolean(l)||(d=l.once||!1,f=l.passive||!1),[c,f,d]},r.eventTarget_addEventListener=function(l,c){if(c.callback!==null){for(var d=0;d<l._eventListenerList.length;d++){var f=l._eventListenerList[d];if(f.type===c.type&&f.callback.handleEvent===c.callback.handleEvent&&f.capture===c.capture)return}l._eventListenerList.push(c)}},r.eventTarget_removeEventListener=function(l,c,d){c.removed=!0,l._eventListenerList.splice(d,1)},r.eventTarget_removeAllEventListeners=function(l){var c,d;try{for(var f=a(l._eventListenerList),h=f.next();!h.done;h=f.next())h.value.removed=!0}catch(p){c={error:p}}finally{try{h&&!h.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}l._eventListenerList.length=0}},function(n,r,i){var a=this&&this.__values||function(l){var c=typeof Symbol=="function"&&Symbol.iterator,d=c&&l[c],f=0;if(d)return d.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(1),s=i(29);r.parentNode_convertNodesIntoANode=function(l,c){for(var d,f,h=null,p=0;p<l.length;p++){var C=l[p];if(o.isString(C)){var x=s.create_text(c,C);l[p]=x}}if(l.length===1)h=l[0];else{var T=h=s.create_documentFragment(c);try{for(var _=a(l),y=_.next();!y.done;y=_.next())C=y.value,T.appendChild(C)}catch(w){d={error:w}}finally{try{y&&!y.done&&(f=_.return)&&f.call(_)}finally{if(d)throw d.error}}}return h}},function(n,r,i){var a=this&&this.__values||function(A){var k=typeof Symbol=="function"&&Symbol.iterator,U=k&&A[k],B=0;if(U)return U.call(A);if(A&&typeof A.length=="number")return{next:function(){return A&&B>=A.length&&(A=void 0),{value:A&&A[B++],done:!A}}};throw new TypeError(k?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(A,k){var U=typeof Symbol=="function"&&A[Symbol.iterator];if(!U)return A;var B,z,K=U.call(A),J=[];try{for(;(k===void 0||k-- >0)&&!(B=K.next()).done;)J.push(B.value)}catch(X){z={error:X}}finally{try{B&&!B.done&&(U=K.return)&&U.call(K)}finally{if(z)throw z.error}}return J},s=this&&this.__spread||function(){for(var A=[],k=0;k<arguments.length;k++)A=A.concat(o(arguments[k]));return A};Object.defineProperty(r,"__esModule",{value:!0});var l=i(2),c=i(9),d=i(3),f=i(29),h=i(17),p=i(175),C=i(107),x=i(176),T=i(37),_=i(177);function y(A){return A._startNode===A._endNode&&A._startOffset===A._endOffset}function w(A){return h.tree_rootNode(A._startNode)}function b(A,k){return h.tree_rootNode(A)===w(k)&&p.boundaryPoint_position([A,0],k._start)===l.BoundaryPosition.After&&p.boundaryPoint_position([A,h.tree_nodeLength(A)],k._end)===l.BoundaryPosition.Before}function M(A,k){var U=h.tree_isAncestorOf(k._startNode,A,!0),B=h.tree_isAncestorOf(k._endNode,A,!0);return U&&!B||!U&&B}function I(A){var k,U,B,z,K,J,X=f.create_documentFragment(A._startNode._nodeDocument);if(y(A))return X;var re=A._startNode,fe=A._startOffset,pe=A._endNode,ie=A._endOffset;if(re===pe&&d.Guard.isCharacterDataNode(re))return(se=x.node_clone(re))._data=C.characterData_substringData(re,fe,ie-fe),T.mutation_append(se,X),C.characterData_replaceData(re,fe,ie-fe,""),X;for(var te=re;!h.tree_isAncestorOf(pe,te,!0);){if(te._parent===null)throw new Error("Parent node  is null.");te=te._parent}var ee=null;if(!h.tree_isAncestorOf(pe,re,!0))try{for(var we=a(te._children),Ce=we.next();!Ce.done;Ce=we.next())if(M(Ve=Ce.value,A)){ee=Ve;break}}catch(Ue){k={error:Ue}}finally{try{Ce&&!Ce.done&&(U=we.return)&&U.call(we)}finally{if(k)throw k.error}}var De=null;if(!h.tree_isAncestorOf(re,pe,!0))for(var Re=s(te._children),Oe=Re.length-1;Oe>0;Oe--){var Ve;if(M(Ve=Re[Oe],A)){De=Ve;break}}var Ge,qe,Be=[];try{for(var ae=a(te._children),H=ae.next();!H.done;H=ae.next())if(b(Ae=H.value,A)){if(d.Guard.isDocumentTypeNode(Ae))throw new c.HierarchyRequestError;Be.push(Ae)}}catch(Ue){B={error:Ue}}finally{try{H&&!H.done&&(z=ae.return)&&z.call(ae)}finally{if(B)throw B.error}}if(h.tree_isAncestorOf(pe,re,!0))Ge=re,qe=fe;else{for(var ce=re;ce._parent!==null&&!h.tree_isAncestorOf(pe,ce._parent);)ce=ce._parent;if(ce._parent===null)throw new Error("Parent node is null.");Ge=ce._parent,qe=1+h.tree_index(ce)}if(d.Guard.isCharacterDataNode(ee))(se=x.node_clone(re))._data=C.characterData_substringData(re,fe,h.tree_nodeLength(re)-fe),T.mutation_append(se,X),C.characterData_replaceData(re,fe,h.tree_nodeLength(re)-fe,"");else if(ee!==null){var se=x.node_clone(ee);T.mutation_append(se,X);var he=I(f.create_range([re,fe],[ee,h.tree_nodeLength(ee)]));T.mutation_append(he,se)}try{for(var ve=a(Be),ye=ve.next();!ye.done;ye=ve.next()){var Ae=ye.value;T.mutation_append(Ae,X)}}catch(Ue){K={error:Ue}}finally{try{ye&&!ye.done&&(J=ve.return)&&J.call(ve)}finally{if(K)throw K.error}}return d.Guard.isCharacterDataNode(De)?((se=x.node_clone(pe))._data=C.characterData_substringData(pe,0,ie),T.mutation_append(se,X),C.characterData_replaceData(pe,0,ie,"")):De!==null&&(se=x.node_clone(De),T.mutation_append(se,X),he=I(f.create_range([De,0],[pe,ie])),T.mutation_append(he,se)),A._start=[Ge,qe],A._end=[Ge,qe],X}r.range_collapsed=y,r.range_root=w,r.range_isContained=b,r.range_isPartiallyContained=M,r.range_setTheStart=function(A,k,U){if(d.Guard.isDocumentTypeNode(k))throw new c.InvalidNodeTypeError;if(U>h.tree_nodeLength(k))throw new c.IndexSizeError;var B=[k,U];w(A)===h.tree_rootNode(k)&&p.boundaryPoint_position(B,A._end)!==l.BoundaryPosition.After||(A._end=B),A._start=B},r.range_setTheEnd=function(A,k,U){if(d.Guard.isDocumentTypeNode(k))throw new c.InvalidNodeTypeError;if(U>h.tree_nodeLength(k))throw new c.IndexSizeError;var B=[k,U];w(A)===h.tree_rootNode(k)&&p.boundaryPoint_position(B,A._start)!==l.BoundaryPosition.Before||(A._start=B),A._end=B},r.range_select=function(A,k){var U=A._parent;if(U===null)throw new c.InvalidNodeTypeError;var B=h.tree_index(A);k._start=[U,B],k._end=[U,B+1]},r.range_extract=I,r.range_cloneTheContents=function A(k){var U,B,z,K,J,X,re=f.create_documentFragment(k._startNode._nodeDocument);if(y(k))return re;var fe=k._startNode,pe=k._startOffset,ie=k._endNode,te=k._endOffset;fe===ie&&d.Guard.isCharacterDataNode(fe)&&((H=x.node_clone(fe))._data=C.characterData_substringData(fe,pe,te-pe),T.mutation_append(H,re));for(var ee=fe;!h.tree_isAncestorOf(ie,ee,!0);){if(ee._parent===null)throw new Error("Parent node  is null.");ee=ee._parent}var we=null;if(!h.tree_isAncestorOf(ie,fe,!0))try{for(var Ce=a(ee._children),De=Ce.next();!De.done;De=Ce.next())if(M(Ge=De.value,k)){we=Ge;break}}catch(ye){U={error:ye}}finally{try{De&&!De.done&&(B=Ce.return)&&B.call(Ce)}finally{if(U)throw U.error}}var Re=null;if(!h.tree_isAncestorOf(fe,ie,!0))for(var Oe=s(ee._children),Ve=Oe.length-1;Ve>0;Ve--){var Ge;if(M(Ge=Oe[Ve],k)){Re=Ge;break}}var qe=[];try{for(var Be=a(ee._children),ae=Be.next();!ae.done;ae=Be.next())if(b(ve=ae.value,k)){if(d.Guard.isDocumentTypeNode(ve))throw new c.HierarchyRequestError;qe.push(ve)}}catch(ye){z={error:ye}}finally{try{ae&&!ae.done&&(K=Be.return)&&K.call(Be)}finally{if(z)throw z.error}}if(d.Guard.isCharacterDataNode(we))(H=x.node_clone(fe))._data=C.characterData_substringData(fe,pe,h.tree_nodeLength(fe)-pe),T.mutation_append(H,re);else if(we!==null){var H=x.node_clone(we);T.mutation_append(H,re);var ce=A(f.create_range([fe,pe],[we,h.tree_nodeLength(we)]));T.mutation_append(ce,H)}try{for(var se=a(qe),he=se.next();!he.done;he=se.next()){var ve=he.value,H=x.node_clone(ve);T.mutation_append(H,re)}}catch(ye){J={error:ye}}finally{try{he&&!he.done&&(X=se.return)&&X.call(se)}finally{if(J)throw J.error}}return d.Guard.isCharacterDataNode(Re)?((H=x.node_clone(ie))._data=C.characterData_substringData(ie,0,te),T.mutation_append(H,re)):Re!==null&&(H=x.node_clone(Re),re.append(H),ce=I(f.create_range([Re,0],[ie,te])),T.mutation_append(ce,H)),re},r.range_insert=function(A,k){var U,B;if(d.Guard.isProcessingInstructionNode(k._startNode)||d.Guard.isCommentNode(k._startNode)||d.Guard.isTextNode(k._startNode)&&k._startNode._parent===null||k._startNode===A)throw new c.HierarchyRequestError;var z,K=null;if(d.Guard.isTextNode(k._startNode))K=k._startNode;else{var J=0;try{for(var X=a(k._startNode._children),re=X.next();!re.done;re=X.next()){var fe=re.value;if(J===k._startOffset){K=fe;break}J++}}catch(ie){U={error:ie}}finally{try{re&&!re.done&&(B=X.return)&&B.call(X)}finally{if(U)throw U.error}}}if(K===null)z=k._startNode;else{if(K._parent===null)throw new Error("Parent node is null.");z=K._parent}T.mutation_ensurePreInsertionValidity(A,z,K),d.Guard.isTextNode(k._startNode)&&(K=_.text_split(k._startNode,k._startOffset)),A===K&&(K=A._nextSibling),A._parent!==null&&T.mutation_remove(A,A._parent);var pe=K===null?h.tree_nodeLength(z):h.tree_index(K);d.Guard.isDocumentFragmentNode(A)?pe+=h.tree_nodeLength(A):pe++,T.mutation_preInsert(A,z,K),y(k)&&(k._end=[z,pe])},r.range_getContainedNodes=function(A){var k;return(k={})[Symbol.iterator]=function(){var U=A.commonAncestorContainer,B=h.tree_getFirstDescendantNode(U);return{next:function(){for(;B&&!b(B,A);)B=h.tree_getNextDescendantNode(U,B);if(B===null)return{done:!0,value:null};var z={done:!1,value:B};return B=h.tree_getNextDescendantNode(U,B),z}}},k},r.range_getPartiallyContainedNodes=function(A){var k;return(k={})[Symbol.iterator]=function(){var U=A.commonAncestorContainer,B=h.tree_getFirstDescendantNode(U);return{next:function(){for(;B&&!M(B,A);)B=h.tree_getNextDescendantNode(U,B);if(B===null)return{done:!0,value:null};var z={done:!1,value:B};return B=h.tree_getNextDescendantNode(U,B),z}}},k}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(9);r.selectors_scopeMatchASelectorsString=function(o,s){throw new a.NotSupportedError}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(2),o=i(105);r.treeWalker_traverseChildren=function(s,l){for(var c=l?s._current._firstChild:s._current._lastChild;c!==null;){var d=o.traversal_filter(s,c);if(d===a.FilterResult.Accept)return s._current=c,c;if(d===a.FilterResult.Skip){var f=l?c._firstChild:c._lastChild;if(f!==null){c=f;continue}}for(;c!==null;){var h=l?c._nextSibling:c._previousSibling;if(h!==null){c=h;break}var p=c._parent;if(p===null||p===s._root||p===s._current)return null;c=p}}return null},r.treeWalker_traverseSiblings=function(s,l){var c=s._current;if(c===s._root)return null;for(;;){for(var d=l?c._nextSibling:c._previousSibling;d!==null;){c=d;var f=o.traversal_filter(s,c);if(f===a.FilterResult.Accept)return s._current=c,c;d=l?c._firstChild:c._lastChild,f!==a.FilterResult.Reject&&d!==null||(d=l?c._nextSibling:c._previousSibling)}if((c=c._parent)===null||c===s._root||o.traversal_filter(s,c)===a.FilterResult.Accept)return null}}},function(n,r,i){i(89),i(74);var a,o=this&&this.__extends||(a=function(h,p){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,x){C.__proto__=x}||function(C,x){for(var T in x)x.hasOwnProperty(T)&&(C[T]=x[T])})(h,p)},function(h,p){function C(){this.constructor=h}a(h,p),h.prototype=p===null?Object.create(p):(C.prototype=p.prototype,new C)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(1),l=i(2),c=i(50),d=i(3),f=function(h){function p(C,x){var T=h.call(this,C)||this;return T._indentation={},T._lengthToLastNewline=0,T._writerOptions=s.applyDefaults(x,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),T}return o(p,h),p.prototype.serialize=function(C){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},C.nodeType!==l.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(C,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},p.prototype.declaration=function(C,x,T){this._beginLine(),this._refs.markup+='<?xml version="'+C+'"',x!==void 0&&(this._refs.markup+=' encoding="'+x+'"'),T!==void 0&&(this._refs.markup+=' standalone="'+(T?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},p.prototype.docType=function(C,x,T){this._beginLine(),this._refs.markup+=x&&T?"<!DOCTYPE "+C+' PUBLIC "'+x+'" "'+T+'">':x?"<!DOCTYPE "+C+' PUBLIC "'+x+'">':T?"<!DOCTYPE "+C+' SYSTEM "'+T+'">':"<!DOCTYPE "+C+">",this._endLine()},p.prototype.openTagBegin=function(C){this._beginLine(),this._refs.markup+="<"+C},p.prototype.openTagEnd=function(C,x,T){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!x&&!T){for(var _=!0,y=!0,w=this.currentNode.firstChild,b=0,M=0;w;){if(d.Guard.isExclusiveTextNode(w))M++;else{if(!d.Guard.isCDATASectionNode(w)){_=!1,y=!1;break}b++}w.data!==""&&(y=!1),w=w.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&_&&(b<=1&&M===0||b===0),this._refs.emptyNode=y}(T||x||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+C+">":this._refs.markup+=T?" />":x||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},p.prototype.closeTag=function(C){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+C+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},p.prototype.attribute=function(C,x){var T=C+'="'+x+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+T.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+T):this._refs.markup+=" "+T},p.prototype.text=function(C){C!==""&&(this._beginLine(),this._refs.markup+=C,this._endLine())},p.prototype.cdata=function(C){C!==""&&(this._beginLine(),this._refs.markup+="<![CDATA["+C+"]]>",this._endLine())},p.prototype.comment=function(C){this._beginLine(),this._refs.markup+="<!--"+C+"-->",this._endLine()},p.prototype.instruction=function(C,x){this._beginLine(),this._refs.markup+="<?"+(x===""?C:C+" "+x)+"?>",this._endLine()},p.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},p.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},p.prototype._indent=function(C){if(C<=0)return"";if(this._indentation[C]!==void 0)return this._indentation[C];var x=this._writerOptions.indent.repeat(C);return this._indentation[C]=x,x},p}(c.BaseWriter);r.XMLWriter=f},function(n,r,i){var a=i(47),o=i(35);n.exports="".repeat||function(s){var l=String(o(this)),c="",d=a(s);if(d<0||d==1/0)throw RangeError("Wrong number of repetitions");for(;d>0;(d>>>=1)&&(l+=l))1&d&&(c+=l);return c}},function(n,r,i){i(31),i(32),i(33),i(19),i(178),i(20),i(22),i(23);var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),s=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(67),c=i(1),d=function(f){function h(p,C){var x=f.call(this,p)||this;return x._writerOptions=c.applyDefaults(C,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),x}return o(h,f),h.prototype.serialize=function(p){var C=c.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),x=new l.ObjectWriter(this._builderOptions,C).serialize(p);return this._beginLine(this._writerOptions,0)+this._convertObject(x,this._writerOptions)},h.prototype._convertObject=function(p,C,x){var T,_,y=this;x===void 0&&(x=0);var w="",b=this._isLeafNode(p);if(c.isArray(p)){w+="[";var M=p.length,I=0;try{for(var A=s(p),k=A.next();!k.done;k=A.next()){var U=k.value;w+=this._endLine(C,x+1)+this._beginLine(C,x+1)+this._convertObject(U,C,x+1),I<M-1&&(w+=","),I++}}catch(K){T={error:K}}finally{try{k&&!k.done&&(_=A.return)&&_.call(A)}finally{if(T)throw T.error}}w+=this._endLine(C,x)+this._beginLine(C,x),w+="]"}else if(c.isObject(p)){w+="{";var B=c.objectLength(p),z=0;c.forEachObject(p,function(K,J){b&&C.prettyPrint?w+=" ":w+=y._endLine(C,x+1)+y._beginLine(C,x+1),w+=y._key(K),C.prettyPrint&&(w+=" "),w+=y._convertObject(J,C,x+1),z<B-1&&(w+=","),z++},this),b&&C.prettyPrint?w+=" ":w+=this._endLine(C,x)+this._beginLine(C,x),w+="}"}else w+=this._val(p);return w},h.prototype._beginLine=function(p,C){if(!p.prettyPrint)return"";var x=p.offset+C+1;return x>0?new Array(x).join(p.indent):""},h.prototype._endLine=function(p,C){return p.prettyPrint?p.newline:""},h.prototype._key=function(p){return'"'+p+'":'},h.prototype._val=function(p){return JSON.stringify(p)},h.prototype._isLeafNode=function(p){return this._descendantCount(p)<=1},h.prototype._descendantCount=function(p,C){var x=this;return C===void 0&&(C=0),c.isArray(p)?c.forEachArray(p,function(T){return C+=x._descendantCount(T,C)},this):c.isObject(p)?c.forEachObject(p,function(T,_){return C+=x._descendantCount(_,C)},this):C++,C},h}(i(50).BaseWriter);r.JSONWriter=d},function(n,r,i){i(31),i(32),i(33),i(19),i(178),i(89),i(20),i(22),i(23);var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),s=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&f[h],C=0;if(p)return p.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i(67),c=i(1),d=function(f){function h(p,C){var x=f.call(this,p)||this;if(x._writerOptions=c.applyDefaults(C,{wellFormed:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),x._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(x._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return x}return o(h,f),h.prototype.serialize=function(p){var C=c.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),x=new l.ObjectWriter(this._builderOptions,C).serialize(p),T=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(x,this._writerOptions,0);return T.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(T=T.slice(0,-this._writerOptions.newline.length)),T},h.prototype._convertObject=function(p,C,x,T){var _,y,w=this;T===void 0&&(T=!1);var b="";if(c.isArray(p))try{for(var M=s(p),I=M.next();!I.done;I=M.next()){var A=I.value;b+=this._beginLine(C,x,!0),c.isObject(A)?c.isEmpty(A)?b+='""'+this._endLine(C):b+=this._convertObject(A,C,x,!0):b+=this._val(A)+this._endLine(C)}}catch(k){_={error:k}}finally{try{I&&!I.done&&(y=M.return)&&y.call(M)}finally{if(_)throw _.error}}else c.forEachObject(p,function(k,U){T?(b+=w._key(k),T=!1):b+=w._beginLine(C,x)+w._key(k),c.isObject(U)?c.isEmpty(U)?b+=' ""'+w._endLine(C):b+=w._endLine(C)+w._convertObject(U,C,x+1):b+=" "+w._val(U)+w._endLine(C)},this);return b},h.prototype._beginLine=function(p,C,x){x===void 0&&(x=!1);var T=p.offset+C+1,_=new Array(T).join(p.indent);return x?_.substr(0,_.length-2)+"-"+_.substr(-1,1):_},h.prototype._endLine=function(p){return p.newline},h.prototype._key=function(p){return'"'+p+'":'},h.prototype._val=function(p){return JSON.stringify(p)},h}(i(50).BaseWriter);r.YAMLWriter=d},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0}),i(110).dom.setFeatures(!0);var a=i(110);r.DOMImplementation=a.DOMImplementation;var o=i(271);r.DOMParser=o.DOMParser;var s=i(274);r.XMLSerializer=s.XMLSerializer},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(3),o=i(0),s=function(){function l(){}return l.prototype.before=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var f=a.Cast.asNode(this),h=f._parent;if(h!==null){for(var p=f._previousSibling,C=!0;C&&p;){C=!1;for(var x=0;x<c.length;x++){var T=c[x];if(T===p){p=p._previousSibling,C=!0;break}}}var _=o.parentNode_convertNodesIntoANode(c,f._nodeDocument);p=p===null?h._firstChild:p._nextSibling,o.mutation_preInsert(_,h,p)}},l.prototype.after=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var f=a.Cast.asNode(this),h=f._parent;if(h){for(var p=f._nextSibling,C=!0;C&&p;){C=!1;for(var x=0;x<c.length;x++){var T=c[x];if(T===p){p=p._nextSibling,C=!0;break}}}var _=o.parentNode_convertNodesIntoANode(c,f._nodeDocument);o.mutation_preInsert(_,h,p)}},l.prototype.replaceWith=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var f=a.Cast.asNode(this),h=f._parent;if(h){for(var p=f._nextSibling,C=!0;C&&p;){C=!1;for(var x=0;x<c.length;x++){var T=c[x];if(T===p){p=p._nextSibling,C=!0;break}}}var _=o.parentNode_convertNodesIntoANode(c,f._nodeDocument);f._parent===h?o.mutation_replace(f,_,h):o.mutation_preInsert(_,h,p)}},l.prototype.remove=function(){var c=a.Cast.asNode(this),d=c._parent;d&&o.mutation_remove(c,d)},l}();r.ChildNodeImpl=s},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=function(){};r.DocumentOrShadowRootImpl=a},function(n,r,i){var a=this&&this.__values||function(d){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&d[f],p=0;if(h)return h.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(6),s=i(3),l=i(7),c=function(){function d(f){this._nodeList=[],this._recordQueue=[],this._callback=f;var h=o.dom.window;l.set.append(h._mutationObservers,this)}return d.prototype.observe=function(f,h){var p,C;if((h=h||{childList:!1,subtree:!1}).attributeOldValue===void 0&&h.attributeFilter===void 0||h.attributes!==void 0||(h.attributes=!0),h.characterDataOldValue!==void 0&&h.characterData===void 0&&(h.characterData=!0),!h.childList&&!h.attributes&&!h.characterData)throw new TypeError;if(h.attributeOldValue&&!h.attributes)throw new TypeError;if(h.attributeFilter!==void 0&&!h.attributes)throw new TypeError;if(h.characterDataOldValue&&!h.characterData)throw new TypeError;var x=!1,T=h,_=function(M){var I,A;if(M.observer===y){x=!0;try{for(var k=(I=void 0,a(y._nodeList)),U=k.next();!U.done;U=k.next()){var B=U.value;l.list.remove(B._registeredObserverList,function(z){return s.Guard.isTransientRegisteredObserver(z)&&z.source===M})}}catch(z){I={error:z}}finally{try{U&&!U.done&&(A=k.return)&&A.call(k)}finally{if(I)throw I.error}}M.options=T}},y=this;try{for(var w=a(f._registeredObserverList),b=w.next();!b.done;b=w.next())_(b.value)}catch(M){p={error:M}}finally{try{b&&!b.done&&(C=w.return)&&C.call(w)}finally{if(p)throw p.error}}x||(f._registeredObserverList.push({observer:this,options:h}),this._nodeList.push(f))},d.prototype.disconnect=function(){var f,h,p=this;try{for(var C=a(this._nodeList),x=C.next();!x.done;x=C.next()){var T=x.value;l.list.remove(T._registeredObserverList,function(_){return _.observer===p})}}catch(_){f={error:_}}finally{try{x&&!x.done&&(h=C.return)&&h.call(C)}finally{if(f)throw f.error}}this._recordQueue=[]},d.prototype.takeRecords=function(){var f=this._recordQueue;return this._recordQueue=[],f},d}();r.MutationObserverImpl=c},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(3),o=function(){function s(){}return Object.defineProperty(s.prototype,"previousElementSibling",{get:function(){for(var l=a.Cast.asNode(this)._previousSibling;l;){if(a.Guard.isElementNode(l))return l;l=l._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"nextElementSibling",{get:function(){for(var l=a.Cast.asNode(this)._nextSibling;l;){if(a.Guard.isElementNode(l))return l;l=l._nextSibling}return null},enumerable:!0,configurable:!0}),s}();r.NonDocumentTypeChildNodeImpl=o},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(3),o=i(0),s=function(){function l(){}return l.prototype.getElementById=function(c){for(var d=o.tree_getFirstDescendantNode(a.Cast.asNode(this),!1,!1,function(f){return a.Guard.isElementNode(f)});d!==null;){if(d._uniqueIdentifier===c)return d;d=o.tree_getNextDescendantNode(a.Cast.asNode(this),d,!1,!1,function(f){return a.Guard.isElementNode(f)})}return null},l}();r.NonElementParentNodeImpl=s},function(n,r,i){var a=this&&this.__values||function(c){var d=typeof Symbol=="function"&&Symbol.iterator,f=d&&c[d],h=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&h>=c.length&&(c=void 0),{value:c&&c[h++],done:!c}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(3),s=i(0),l=function(){function c(){}return Object.defineProperty(c.prototype,"children",{get:function(){return s.create_htmlCollection(o.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"firstElementChild",{get:function(){for(var d=o.Cast.asNode(this)._firstChild;d;){if(o.Guard.isElementNode(d))return d;d=d._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lastElementChild",{get:function(){for(var d=o.Cast.asNode(this)._lastChild;d;){if(o.Guard.isElementNode(d))return d;d=d._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"childElementCount",{get:function(){var d,f,h=0;try{for(var p=a(o.Cast.asNode(this)._children),C=p.next();!C.done;C=p.next()){var x=C.value;o.Guard.isElementNode(x)&&h++}}catch(T){d={error:T}}finally{try{C&&!C.done&&(f=p.return)&&f.call(p)}finally{if(d)throw d.error}}return h},enumerable:!0,configurable:!0}),c.prototype.prepend=function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];var h=o.Cast.asNode(this),p=s.parentNode_convertNodesIntoANode(d,h._nodeDocument);s.mutation_preInsert(p,h,h._firstChild)},c.prototype.append=function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];var h=o.Cast.asNode(this),p=s.parentNode_convertNodesIntoANode(d,h._nodeDocument);s.mutation_append(p,h)},c.prototype.querySelector=function(d){var f=o.Cast.asNode(this),h=s.selectors_scopeMatchASelectorsString(d,f);return h.length===0?null:h[0]},c.prototype.querySelectorAll=function(d){var f=o.Cast.asNode(this),h=s.selectors_scopeMatchASelectorsString(d,f);return s.create_nodeListStatic(f,h)},c}();r.ParentNodeImpl=l},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(0),o=function(){function s(){}return Object.defineProperty(s.prototype,"_name",{get:function(){return this.__name||""},set:function(l){this.__name=l},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(l){this.__assignedSlot=l},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"assignedSlot",{get:function(){return a.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),s}();r.SlotableImpl=o},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(102),l=i(9),c=i(3),d=function(f){function h(p){var C=f.call(this)||this;if(c.Guard.isDocumentTypeNode(p.startContainer)||c.Guard.isAttrNode(p.startContainer)||c.Guard.isDocumentTypeNode(p.endContainer)||c.Guard.isAttrNode(p.endContainer))throw new l.InvalidNodeTypeError;return C._start=[p.startContainer,p.startOffset],C._end=[p.endContainer,p.endOffset],C}return o(h,f),h}(s.AbstractRangeImpl);r.StaticRangeImpl=d},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(272);r.DOMParser=a.DOMParserImpl},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(0),o=i(273),s=function(){function l(){}return l.prototype.parseFromString=function(c,d){if(d==="text/html")throw new Error("HTML parser not implemented.");try{return(f=new o.XMLParserImpl().parse(c))._contentType=d,f}catch(x){var f,h="http://www.mozilla.org/newlayout/xml/parsererror.xml",p=(f=a.create_xmlDocument()).createElementNS(h,"parsererror"),C=f.createElementNS(h,"error");return C.setAttribute("message",x.message),p.appendChild(C),f.appendChild(p),f}},l}();r.DOMParserImpl=s},function(n,r,i){var a=this&&this.__read||function(p,C){var x=typeof Symbol=="function"&&p[Symbol.iterator];if(!x)return p;var T,_,y=x.call(p),w=[];try{for(;(C===void 0||C-- >0)&&!(T=y.next()).done;)w.push(T.value)}catch(b){_={error:b}}finally{try{T&&!T.done&&(x=y.return)&&x.call(y)}finally{if(_)throw _.error}}return w},o=this&&this.__values||function(p){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&p[C],T=0;if(x)return x.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&T>=p.length&&(p=void 0),{value:p&&p[T++],done:!p}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=i(180),l=i(111),c=i(7),d=i(0),f=i(69),h=function(){function p(){}return p.prototype.parse=function(C){for(var x,T,_,y,w=new s.XMLStringLexer(C,{skipWhitespaceOnlyText:!0}),b=d.create_document(),M=b,I=w.nextToken();I.type!==l.TokenType.EOF;){switch(I.type){case l.TokenType.Declaration:var A=I;if(A.version!=="1.0")throw new Error("Invalid xml version: "+A.version);break;case l.TokenType.DocType:var k=I;if(!d.xml_isPubidChar(k.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!d.xml_isLegalChar(k.sysId)||k.sysId.indexOf('"')!==-1&&k.sysId.indexOf("'")!==-1)throw new Error("DocType system identifier contains invalid characters.");M.appendChild(b.implementation.createDocumentType(k.name,k.pubId,k.sysId));break;case l.TokenType.CDATA:var U=I;if(!d.xml_isLegalChar(U.data)||U.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters.");M.appendChild(b.createCDATASection(U.data));break;case l.TokenType.Comment:var B=I;if(!d.xml_isLegalChar(B.data)||B.data.indexOf("--")!==-1||B.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");M.appendChild(b.createComment(B.data));break;case l.TokenType.PI:var z=I;if(z.target.indexOf(":")!==-1||/^xml$/i.test(z.target))throw new Error("Processing instruction target contains invalid characters.");if(!d.xml_isLegalChar(z.data)||z.data.indexOf("?>")!==-1)throw new Error("Processing instruction data contains invalid characters.");M.appendChild(b.createProcessingInstruction(z.target,z.data));break;case l.TokenType.Text:var K=I;if(!d.xml_isLegalChar(K.data))throw new Error("Text data contains invalid characters.");M.appendChild(b.createTextNode(this._decodeText(K.data)));break;case l.TokenType.Element:var J=I,X=a(d.namespace_extractQName(J.name),2),re=X[0],fe=X[1];if(fe.indexOf(":")!==-1||!d.xml_isName(fe))throw new Error("Node local name contains invalid characters.");if(re==="xmlns")throw new Error("An element cannot have the 'xmlns' prefix.");var pe=M.lookupNamespaceURI(re),ie={};try{for(var te=(x=void 0,o(J.attributes)),ee=te.next();!ee.done;ee=te.next()){var we=a(ee.value,2),Ce=we[0],De=we[1];if(Ce==="xmlns")pe=De;else{var Re=a(d.namespace_extractQName(Ce),2),Oe=Re[0],Ve=Re[1];Oe==="xmlns"&&(Ve===re&&(pe=De),ie[Ve]=De)}}}catch(he){x={error:he}}finally{try{ee&&!ee.done&&(T=te.return)&&T.call(te)}finally{if(x)throw x.error}}var Ge=pe!==null?b.createElementNS(pe,J.name):b.createElement(J.name);M.appendChild(Ge);var qe=new f.LocalNameSet;try{for(var Be=(_=void 0,o(J.attributes)),ae=Be.next();!ae.done;ae=Be.next()){var H=a(ae.value,2),ce=(Ce=H[0],De=H[1],a(d.namespace_extractQName(Ce),2)),se=(Oe=ce[0],Ve=ce[1],null);if(Oe==="xmlns"||Oe===null&&Ve==="xmlns"?se=c.namespace.XMLNS:(se=Ge.lookupNamespaceURI(Oe))!==null&&Ge.isDefaultNamespace(se)?se=null:se===null&&Oe!==null&&(se=ie[Oe]||null),qe.has(se,Ve))throw new Error("Element contains duplicate attributes.");if(qe.set(se,Ve),se===c.namespace.XMLNS&&De===c.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(Ve.indexOf(":")!==-1||!d.xml_isName(Ve))throw new Error("Attribute local name contains invalid characters.");if(Oe==="xmlns"&&De==="")throw new Error("Empty XML namespace is not allowed.");se!==null?Ge.setAttributeNS(se,Ce,this._decodeAttributeValue(De)):Ge.setAttribute(Ce,this._decodeAttributeValue(De))}}catch(he){_={error:he}}finally{try{ae&&!ae.done&&(y=Be.return)&&y.call(Be)}finally{if(_)throw _.error}}J.selfClosing||(M=Ge);break;case l.TokenType.ClosingTag:if(I.name!==M.nodeName)throw new Error("Closing tag name does not match opening tag name.");M._parent&&(M=M._parent)}I=w.nextToken()}return b},p.prototype._decodeText=function(C){return C==null?C:C.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},p.prototype._decodeAttributeValue=function(C){return C==null?C:C.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},p}();r.XMLParserImpl=h},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(275);r.XMLSerializer=a.XMLSerializerImpl},function(n,r,i){var a=this&&this.__values||function(p){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&p[C],T=0;if(x)return x.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&T>=p.length&&(p=void 0),{value:p&&p[T++],done:!p}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var o=i(2),s=i(69),l=i(95),c=i(9),d=i(7),f=i(0),h=function(){function p(){}return p.prototype.serializeToString=function(C){return this._xmlSerialization(C,!1)},p.prototype._xmlSerialization=function(C,x){if(C._nodeDocument===void 0||C._nodeDocument._hasNamespaces){var T=new l.NamespacePrefixMap;T.set("xml",d.namespace.XML);try{return this._serializeNodeNS(C,null,T,{value:1},x)}catch{throw new c.InvalidStateError}}else try{return this._serializeNode(C,x)}catch{throw new c.InvalidStateError}},p.prototype._serializeNodeNS=function(C,x,T,_,y){switch(C.nodeType){case o.NodeType.Element:return this._serializeElementNS(C,x,T,_,y);case o.NodeType.Document:return this._serializeDocumentNS(C,x,T,_,y);case o.NodeType.Comment:return this._serializeComment(C,y);case o.NodeType.Text:return this._serializeText(C,y);case o.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(C,x,T,_,y);case o.NodeType.DocumentType:return this._serializeDocumentType(C,y);case o.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(C,y);case o.NodeType.CData:return this._serializeCData(C,y);default:throw new Error("Unknown node type: "+C.nodeType)}},p.prototype._serializeNode=function(C,x){switch(C.nodeType){case o.NodeType.Element:return this._serializeElement(C,x);case o.NodeType.Document:return this._serializeDocument(C,x);case o.NodeType.Comment:return this._serializeComment(C,x);case o.NodeType.Text:return this._serializeText(C,x);case o.NodeType.DocumentFragment:return this._serializeDocumentFragment(C,x);case o.NodeType.DocumentType:return this._serializeDocumentType(C,x);case o.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(C,x);case o.NodeType.CData:return this._serializeCData(C,x);default:throw new Error("Unknown node type: "+C.nodeType)}},p.prototype._serializeElementNS=function(C,x,T,_,y){var w,b;if(y&&(C.localName.indexOf(":")!==-1||!f.xml_isName(C.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var M="<",I="",A=!1,k=!1,U=T.copy(),B={},z=this._recordNamespaceInformation(C,U,B),K=x,J=C.namespaceURI;if(K===J)z!==null&&(k=!0),M+=I=J===d.namespace.XML?"xml:"+C.localName:C.localName;else{var X=C.prefix,re=null;if(X===null&&J===z||(re=U.get(X,J)),X==="xmlns"){if(y)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");re=X}re!==null?(I=re+":"+C.localName,z!==null&&z!==d.namespace.XML&&(K=z||null),M+=I):X!==null?(X in B&&(X=this._generatePrefix(J,U,_)),U.set(X,J),M+=I+=X+":"+C.localName,M+=" xmlns:"+X+'="'+this._serializeAttributeValue(J,y)+'"',z!==null&&(K=z||null)):z===null||z!==null&&z!==J?(k=!0,K=J,M+=I+=C.localName,M+=' xmlns="'+this._serializeAttributeValue(J,y)+'"'):(K=J,M+=I+=C.localName)}M+=this._serializeAttributesNS(C,U,_,B,k,y);var fe=J===d.namespace.HTML;if(fe&&C.childNodes.length===0&&p._VoidElementNames.has(C.localName)?(M+=" /",A=!0):fe||C.childNodes.length!==0||(M+="/",A=!0),M+=">",A)return M;if(!(fe&&C.localName==="template"))try{for(var pe=a(C._children||C.childNodes),ie=pe.next();!ie.done;ie=pe.next()){var te=ie.value;M+=this._serializeNodeNS(te,K,U,_,y)}}catch(ee){w={error:ee}}finally{try{ie&&!ie.done&&(b=pe.return)&&b.call(pe)}finally{if(w)throw w.error}}return M+="</"+I+">"},p.prototype._serializeDocumentNS=function(C,x,T,_,y){var w,b;if(y&&C.documentElement===null)throw new Error("Missing document element (well-formed required).");var M="";try{for(var I=a(C._children||C.childNodes),A=I.next();!A.done;A=I.next()){var k=A.value;M+=this._serializeNodeNS(k,x,T,_,y)}}catch(U){w={error:U}}finally{try{A&&!A.done&&(b=I.return)&&b.call(I)}finally{if(w)throw w.error}}return M},p.prototype._serializeComment=function(C,x){if(x&&(!f.xml_isLegalChar(C.data)||C.data.indexOf("--")!==-1||C.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"<!--"+C.data+"-->"},p.prototype._serializeText=function(C,x){if(x&&!f.xml_isLegalChar(C.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var T="",_=0;_<C.data.length;_++){var y=C.data[_];T+=y==="&"?"&amp;":y==="<"?"&lt;":y===">"?"&gt;":y}return T},p.prototype._serializeDocumentFragmentNS=function(C,x,T,_,y){var w,b,M="";try{for(var I=a(C._children||C.childNodes),A=I.next();!A.done;A=I.next()){var k=A.value;M+=this._serializeNodeNS(k,x,T,_,y)}}catch(U){w={error:U}}finally{try{A&&!A.done&&(b=I.return)&&b.call(I)}finally{if(w)throw w.error}}return M},p.prototype._serializeDocumentType=function(C,x){if(x&&!f.xml_isPubidChar(C.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(x&&(!f.xml_isLegalChar(C.systemId)||C.systemId.indexOf('"')!==-1&&C.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return C.publicId&&C.systemId?"<!DOCTYPE "+C.name+' PUBLIC "'+C.publicId+'" "'+C.systemId+'">':C.publicId?"<!DOCTYPE "+C.name+' PUBLIC "'+C.publicId+'">':C.systemId?"<!DOCTYPE "+C.name+' SYSTEM "'+C.systemId+'">':"<!DOCTYPE "+C.name+">"},p.prototype._serializeProcessingInstruction=function(C,x){if(x&&(C.target.indexOf(":")!==-1||/^xml$/i.test(C.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(x&&(!f.xml_isLegalChar(C.data)||C.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(C.data===""?C.target:C.target+" "+C.data)+"?>"},p.prototype._serializeCData=function(C,x){if(x&&C.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+C.data+"]]>"},p.prototype._serializeAttributesNS=function(C,x,T,_,y,w){var b,M,I="",A=w?new s.LocalNameSet:void 0;try{for(var k=a(C.attributes),U=k.next();!U.done;U=k.next()){var B=U.value;if(y||w||B.namespaceURI!==null){if(w&&A&&A.has(B.namespaceURI,B.localName))throw new Error("Element contains duplicate attributes (well-formed required).");w&&A&&A.set(B.namespaceURI,B.localName);var z=B.namespaceURI,K=null;if(z!==null)if(K=x.get(B.prefix,z),z===d.namespace.XMLNS){if(B.value===d.namespace.XML||B.prefix===null&&y||B.prefix!==null&&(!(B.localName in _)||_[B.localName]!==B.value)&&x.has(B.localName,B.value))continue;if(w&&B.value===d.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(w&&B.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");B.prefix==="xmlns"&&(K="xmlns")}else K===null&&(I+=" xmlns:"+(K=B.prefix===null||x.hasPrefix(B.prefix)&&!x.has(B.prefix,z)?this._generatePrefix(z,x,T):B.prefix)+'="'+this._serializeAttributeValue(z,w)+'"');if(I+=" ",K!==null&&(I+=K+":"),w&&(B.localName.indexOf(":")!==-1||!f.xml_isName(B.localName)||B.localName==="xmlns"&&z===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");I+=B.localName+'="'+this._serializeAttributeValue(B.value,w)+'"'}else I+=" "+B.localName+'="'+this._serializeAttributeValue(B.value,w)+'"'}}catch(J){b={error:J}}finally{try{U&&!U.done&&(M=k.return)&&M.call(k)}finally{if(b)throw b.error}}return I},p.prototype._recordNamespaceInformation=function(C,x,T){var _,y,w=null;try{for(var b=a(C.attributes),M=b.next();!M.done;M=b.next()){var I=M.value,A=I.namespaceURI,k=I.prefix;if(A===d.namespace.XMLNS){if(k===null){w=I.value;continue}var U=I.localName,B=I.value;if(B===d.namespace.XML||(B===""&&(B=null),x.has(U,B)))continue;x.set(U,B),T[U]=B||""}}}catch(z){_={error:z}}finally{try{M&&!M.done&&(y=b.return)&&y.call(b)}finally{if(_)throw _.error}}return w},p.prototype._generatePrefix=function(C,x,T){var _="ns"+T.value;return T.value++,x.set(_,C),_},p.prototype._serializeAttributeValue=function(C,x){if(x&&C!==null&&!f.xml_isLegalChar(C))throw new Error("Invalid characters in attribute value.");if(C===null)return"";for(var T="",_=0;_<C.length;_++){var y=C[_];T+=y==='"'?"&quot;":y==="&"?"&amp;":y==="<"?"&lt;":y===">"?"&gt;":y}return T},p.prototype._serializeElement=function(C,x){var T,_;if(x&&(C.localName.indexOf(":")!==-1||!f.xml_isName(C.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var y=!1,w=C.localName,b="<"+w;if(b+=this._serializeAttributes(C,x),C._children.size===0&&(b+="/",y=!0),b+=">",y)return b;try{for(var M=a(C._children),I=M.next();!I.done;I=M.next()){var A=I.value;b+=this._serializeNode(A,x)}}catch(k){T={error:k}}finally{try{I&&!I.done&&(_=M.return)&&_.call(M)}finally{if(T)throw T.error}}return b+="</"+w+">"},p.prototype._serializeDocument=function(C,x){var T,_;if(x&&C.documentElement===null)throw new Error("Missing document element (well-formed required).");var y="";try{for(var w=a(C._children),b=w.next();!b.done;b=w.next()){var M=b.value;y+=this._serializeNode(M,x)}}catch(I){T={error:I}}finally{try{b&&!b.done&&(_=w.return)&&_.call(w)}finally{if(T)throw T.error}}return y},p.prototype._serializeDocumentFragment=function(C,x){var T,_,y="";try{for(var w=a(C._children),b=w.next();!b.done;b=w.next()){var M=b.value;y+=this._serializeNode(M,x)}}catch(I){T={error:I}}finally{try{b&&!b.done&&(_=w.return)&&_.call(w)}finally{if(T)throw T.error}}return y},p.prototype._serializeAttributes=function(C,x){var T,_,y="",w=x?{}:void 0;try{for(var b=a(C.attributes),M=b.next();!M.done;M=b.next()){var I=M.value;if(x&&w&&I.localName in w)throw new Error("Element contains duplicate attributes (well-formed required).");if(x&&w&&(w[I.localName]=!0),x&&(I.localName.indexOf(":")!==-1||!f.xml_isName(I.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");y+=" "+I.localName+'="'+this._serializeAttributeValue(I.value,x)+'"'}}catch(A){T={error:A}}finally{try{M&&!M.done&&(_=b.return)&&_.call(b)}finally{if(T)throw T.error}}return y},p._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),p}();r.XMLSerializerImpl=h},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(277);r.XMLReader=a.XMLReader;var o=i(112);r.ObjectReader=o.ObjectReader;var s=i(280);r.JSONReader=s.JSONReader;var l=i(281);r.YAMLReader=l.YAMLReader},function(n,r,i){i(31),i(32),i(33),i(19),i(65),i(20),i(22),i(23);var a,o=this&&this.__extends||(a=function(C,x){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,_){T.__proto__=_}||function(T,_){for(var y in _)_.hasOwnProperty(y)&&(T[y]=_[y])})(C,x)},function(C,x){function T(){this.constructor=C}a(C,x),C.prototype=x===null?Object.create(x):(T.prototype=x.prototype,new T)}),s=this&&this.__read||function(C,x){var T=typeof Symbol=="function"&&C[Symbol.iterator];if(!T)return C;var _,y,w=T.call(C),b=[];try{for(;(x===void 0||x-- >0)&&!(_=w.next()).done;)b.push(_.value)}catch(M){y={error:M}}finally{try{_&&!_.done&&(T=w.return)&&T.call(w)}finally{if(y)throw y.error}}return b},l=this&&this.__values||function(C){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&C[x],_=0;if(T)return T.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&_>=C.length&&(C=void 0),{value:C&&C[_++],done:!C}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var c=i(180),d=i(111),f=i(7),h=i(0),p=function(C){function x(){return C!==null&&C.apply(this,arguments)||this}return o(x,C),x.prototype._parse=function(T,_){for(var y,w,b,M,I=new c.XMLStringLexer(_,{skipWhitespaceOnlyText:!0}),A=T,k=T,U=I.nextToken();U.type!==d.TokenType.EOF;){switch(U.type){case d.TokenType.Declaration:var B=U,z=this.sanitize(B.version);if(z!=="1.0")throw new Error("Invalid xml version: "+z);var K={version:z};B.encoding&&(K.encoding=this.sanitize(B.encoding)),B.standalone&&(K.standalone=this.sanitize(B.standalone)==="yes"),k.set(K);break;case d.TokenType.DocType:var J=U;k=this.docType(k,this.sanitize(J.name),this.sanitize(J.pubId),this.sanitize(J.sysId))||k;break;case d.TokenType.CDATA:var X=U;k=this.cdata(k,this.sanitize(X.data))||k;break;case d.TokenType.Comment:var re=U;k=this.comment(k,this.sanitize(re.data))||k;break;case d.TokenType.PI:var fe=U;k=this.instruction(k,this.sanitize(fe.target),this.sanitize(fe.data))||k;break;case d.TokenType.Text:var pe=U;k=this.text(k,this._decodeText(this.sanitize(pe.data)))||k;break;case d.TokenType.Element:var ie=U,te=this.sanitize(ie.name),ee=s(h.namespace_extractQName(te),1)[0],we=k.node.lookupNamespaceURI(ee),Ce={};try{for(var De=(y=void 0,l(ie.attributes)),Re=De.next();!Re.done;Re=De.next()){var Oe=s(Re.value,2),Ve=Oe[0],Ge=Oe[1];if(Ve=this.sanitize(Ve),Ge=this.sanitize(Ge),Ve==="xmlns")we=Ge;else{var qe=s(h.namespace_extractQName(Ve),2),Be=qe[0],ae=qe[1];Be==="xmlns"&&(ae===ee&&(we=Ge),Ce[ae]=Ge)}}}catch(Ae){y={error:Ae}}finally{try{Re&&!Re.done&&(w=De.return)&&w.call(De)}finally{if(y)throw y.error}}var H=we!==null?this.element(k,we,te):this.element(k,void 0,te);if(H===void 0)break;k.node===T.node&&(A=H);try{for(var ce=(b=void 0,l(ie.attributes)),se=ce.next();!se.done;se=ce.next()){var he=s(se.value,2);Ve=he[0],Ge=he[1],Ve=this.sanitize(Ve),Ge=this.sanitize(Ge);var ve=s(h.namespace_extractQName(Ve),2),ye=(Be=ve[0],ae=ve[1],null);Be==="xmlns"||Be===null&&ae==="xmlns"?ye=f.namespace.XMLNS:(ye=H.node.lookupNamespaceURI(Be))!==null&&H.node.isDefaultNamespace(ye)?ye=null:ye===null&&Be!==null&&(ye=Ce[Be]||null),ye!==null?this.attribute(H,ye,Ve,this._decodeAttributeValue(Ge)):this.attribute(H,void 0,Ve,this._decodeAttributeValue(Ge))}}catch(Ae){b={error:Ae}}finally{try{se&&!se.done&&(M=ce.return)&&M.call(ce)}finally{if(b)throw b.error}}ie.selfClosing||(k=H);break;case d.TokenType.ClosingTag:k.node.parentNode&&(k=k.up())}U=I.nextToken()}return A},x}(i(75).BaseReader);r.XMLReader=p},function(n,r,i){var a=i(4),o=i(279);a({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},function(n,r,i){var a=i(16),o=i(8),s=i(61),l=i(85),c=i(79),d=i(27),f=i(41),h=Object.assign,p=Object.defineProperty;n.exports=!h||o(function(){if(a&&h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var C={},x={},T=Symbol();return C[T]=7,"abcdefghijklmnopqrst".split("").forEach(function(_){x[_]=_}),h({},C)[T]!=7||s(h({},x)).join("")!="abcdefghijklmnopqrst"})?function(C,x){for(var T=d(C),_=arguments.length,y=1,w=l.f,b=c.f;_>y;)for(var M,I=f(arguments[y++]),A=w?s(I).concat(w(I)):s(I),k=A.length,U=0;k>U;)M=A[U++],a&&!b.call(I,M)||(T[M]=I[M]);return T}:h},function(n,r,i){var a,o=this&&this.__extends||(a=function(c,d){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var p in h)h.hasOwnProperty(p)&&(f[p]=h[p])})(c,d)},function(c,d){function f(){this.constructor=c}a(c,d),c.prototype=d===null?Object.create(d):(f.prototype=d.prototype,new f)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(112),l=function(c){function d(){return c!==null&&c.apply(this,arguments)||this}return o(d,c),d.prototype._parse=function(f,h){return new s.ObjectReader(this._builderOptions).parse(f,JSON.parse(h))},d}(i(75).BaseReader);r.JSONReader=l},function(n,r,i){var a,o=this&&this.__extends||(a=function(f,h){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,C){p.__proto__=C}||function(p,C){for(var x in C)C.hasOwnProperty(x)&&(p[x]=C[x])})(f,h)},function(f,h){function p(){this.constructor=f}a(f,h),f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)});Object.defineProperty(r,"__esModule",{value:!0});var s=i(112),l=i(75),c=i(282),d=function(f){function h(){return f!==null&&f.apply(this,arguments)||this}return o(h,f),h.prototype._parse=function(p,C){var x=c.safeLoad(C);if(x===void 0)throw new Error("Unable to parse YAML document.");return new s.ObjectReader(this._builderOptions).parse(p,x)},h}(l.BaseReader);r.YAMLReader=d},function(n,r,i){var a=i(283);n.exports=a},function(n,r,i){var a=i(284),o=i(303);function s(l){return function(){throw new Error("Function "+l+" is deprecated and cannot be used.")}}n.exports.Type=i(10),n.exports.Schema=i(39),n.exports.FAILSAFE_SCHEMA=i(113),n.exports.JSON_SCHEMA=i(182),n.exports.CORE_SCHEMA=i(181),n.exports.DEFAULT_SAFE_SCHEMA=i(54),n.exports.DEFAULT_FULL_SCHEMA=i(76),n.exports.load=a.load,n.exports.loadAll=a.loadAll,n.exports.safeLoad=a.safeLoad,n.exports.safeLoadAll=a.safeLoadAll,n.exports.dump=o.dump,n.exports.safeDump=o.safeDump,n.exports.YAMLException=i(53),n.exports.MINIMAL_SCHEMA=i(113),n.exports.SAFE_SCHEMA=i(54),n.exports.DEFAULT_SCHEMA=i(76),n.exports.scan=s("scan"),n.exports.parse=s("parse"),n.exports.compose=s("compose"),n.exports.addConstructor=s("addConstructor")},function(n,r,i){var a=i(38),o=i(53),s=i(285),l=i(54),c=i(76),d=Object.prototype.hasOwnProperty,f=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,h=/[\x85\u2028\u2029]/,p=/[,\[\]\{\}]/,C=/^(?:!|!!|![a-z\-]+!)$/i,x=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function T(H){return Object.prototype.toString.call(H)}function _(H){return H===10||H===13}function y(H){return H===9||H===32}function w(H){return H===9||H===32||H===10||H===13}function b(H){return H===44||H===91||H===93||H===123||H===125}function M(H){var ce;return 48<=H&&H<=57?H-48:97<=(ce=32|H)&&ce<=102?ce-97+10:-1}function I(H){return H===48?"\0":H===97?"\x07":H===98?"\b":H===116||H===9?"	":H===110?`
`:H===118?"\v":H===102?"\f":H===114?"\r":H===101?"\x1B":H===32?" ":H===34?'"':H===47?"/":H===92?"\\":H===78?"":H===95?"":H===76?"\u2028":H===80?"\u2029":""}function A(H){return H<=65535?String.fromCharCode(H):String.fromCharCode(55296+(H-65536>>10),56320+(H-65536&1023))}for(var k=new Array(256),U=new Array(256),B=0;B<256;B++)k[B]=I(B)?1:0,U[B]=I(B);function z(H,ce){this.input=H,this.filename=ce.filename||null,this.schema=ce.schema||c,this.onWarning=ce.onWarning||null,this.legacy=ce.legacy||!1,this.json=ce.json||!1,this.listener=ce.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=H.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function K(H,ce){return new o(ce,new s(H.filename,H.input,H.position,H.line,H.position-H.lineStart))}function J(H,ce){throw K(H,ce)}function X(H,ce){H.onWarning&&H.onWarning.call(null,K(H,ce))}var re={YAML:function(H,ce,se){var he,ve,ye;H.version!==null&&J(H,"duplication of %YAML directive"),se.length!==1&&J(H,"YAML directive accepts exactly one argument"),(he=/^([0-9]+)\.([0-9]+)$/.exec(se[0]))===null&&J(H,"ill-formed argument of the YAML directive"),ve=parseInt(he[1],10),ye=parseInt(he[2],10),ve!==1&&J(H,"unacceptable YAML version of the document"),H.version=se[0],H.checkLineBreaks=ye<2,ye!==1&&ye!==2&&X(H,"unsupported YAML version of the document")},TAG:function(H,ce,se){var he,ve;se.length!==2&&J(H,"TAG directive accepts exactly two arguments"),he=se[0],ve=se[1],C.test(he)||J(H,"ill-formed tag handle (first argument) of the TAG directive"),d.call(H.tagMap,he)&&J(H,'there is a previously declared suffix for "'+he+'" tag handle'),x.test(ve)||J(H,"ill-formed tag prefix (second argument) of the TAG directive"),H.tagMap[he]=ve}};function fe(H,ce,se,he){var ve,ye,Ae,Ue;if(ce<se){if(Ue=H.input.slice(ce,se),he)for(ve=0,ye=Ue.length;ve<ye;ve+=1)(Ae=Ue.charCodeAt(ve))===9||32<=Ae&&Ae<=1114111||J(H,"expected valid JSON character");else f.test(Ue)&&J(H,"the stream contains non-printable characters");H.result+=Ue}}function pe(H,ce,se,he){var ve,ye,Ae,Ue;for(a.isObject(se)||J(H,"cannot merge mappings; the provided source object is unacceptable"),Ae=0,Ue=(ve=Object.keys(se)).length;Ae<Ue;Ae+=1)ye=ve[Ae],d.call(ce,ye)||(ce[ye]=se[ye],he[ye]=!0)}function ie(H,ce,se,he,ve,ye,Ae,Ue){var Je,et;if(Array.isArray(ve))for(Je=0,et=(ve=Array.prototype.slice.call(ve)).length;Je<et;Je+=1)Array.isArray(ve[Je])&&J(H,"nested arrays are not supported inside keys"),typeof ve=="object"&&T(ve[Je])==="[object Object]"&&(ve[Je]="[object Object]");if(typeof ve=="object"&&T(ve)==="[object Object]"&&(ve="[object Object]"),ve=String(ve),ce===null&&(ce={}),he==="tag:yaml.org,2002:merge")if(Array.isArray(ye))for(Je=0,et=ye.length;Je<et;Je+=1)pe(H,ce,ye[Je],se);else pe(H,ce,ye,se);else H.json||d.call(se,ve)||!d.call(ce,ve)||(H.line=Ae||H.line,H.position=Ue||H.position,J(H,"duplicated mapping key")),ce[ve]=ye,delete se[ve];return ce}function te(H){var ce;(ce=H.input.charCodeAt(H.position))===10?H.position++:ce===13?(H.position++,H.input.charCodeAt(H.position)===10&&H.position++):J(H,"a line break is expected"),H.line+=1,H.lineStart=H.position}function ee(H,ce,se){for(var he=0,ve=H.input.charCodeAt(H.position);ve!==0;){for(;y(ve);)ve=H.input.charCodeAt(++H.position);if(ce&&ve===35)do ve=H.input.charCodeAt(++H.position);while(ve!==10&&ve!==13&&ve!==0);if(!_(ve))break;for(te(H),ve=H.input.charCodeAt(H.position),he++,H.lineIndent=0;ve===32;)H.lineIndent++,ve=H.input.charCodeAt(++H.position)}return se!==-1&&he!==0&&H.lineIndent<se&&X(H,"deficient indentation"),he}function we(H){var ce,se=H.position;return!((ce=H.input.charCodeAt(se))!==45&&ce!==46||ce!==H.input.charCodeAt(se+1)||ce!==H.input.charCodeAt(se+2)||(se+=3,(ce=H.input.charCodeAt(se))!==0&&!w(ce)))}function Ce(H,ce){ce===1?H.result+=" ":ce>1&&(H.result+=a.repeat(`
`,ce-1))}function De(H,ce){var se,he,ve=H.tag,ye=H.anchor,Ae=[],Ue=!1;for(H.anchor!==null&&(H.anchorMap[H.anchor]=Ae),he=H.input.charCodeAt(H.position);he!==0&&he===45&&w(H.input.charCodeAt(H.position+1));)if(Ue=!0,H.position++,ee(H,!0,-1)&&H.lineIndent<=ce)Ae.push(null),he=H.input.charCodeAt(H.position);else if(se=H.line,Ve(H,ce,3,!1,!0),Ae.push(H.result),ee(H,!0,-1),he=H.input.charCodeAt(H.position),(H.line===se||H.lineIndent>ce)&&he!==0)J(H,"bad indentation of a sequence entry");else if(H.lineIndent<ce)break;return!!Ue&&(H.tag=ve,H.anchor=ye,H.kind="sequence",H.result=Ae,!0)}function Re(H){var ce,se,he,ve,ye=!1,Ae=!1;if((ve=H.input.charCodeAt(H.position))!==33)return!1;if(H.tag!==null&&J(H,"duplication of a tag property"),(ve=H.input.charCodeAt(++H.position))===60?(ye=!0,ve=H.input.charCodeAt(++H.position)):ve===33?(Ae=!0,se="!!",ve=H.input.charCodeAt(++H.position)):se="!",ce=H.position,ye){do ve=H.input.charCodeAt(++H.position);while(ve!==0&&ve!==62);H.position<H.length?(he=H.input.slice(ce,H.position),ve=H.input.charCodeAt(++H.position)):J(H,"unexpected end of the stream within a verbatim tag")}else{for(;ve!==0&&!w(ve);)ve===33&&(Ae?J(H,"tag suffix cannot contain exclamation marks"):(se=H.input.slice(ce-1,H.position+1),C.test(se)||J(H,"named tag handle cannot contain such characters"),Ae=!0,ce=H.position+1)),ve=H.input.charCodeAt(++H.position);he=H.input.slice(ce,H.position),p.test(he)&&J(H,"tag suffix cannot contain flow indicator characters")}return he&&!x.test(he)&&J(H,"tag name cannot contain such characters: "+he),ye?H.tag=he:d.call(H.tagMap,se)?H.tag=H.tagMap[se]+he:se==="!"?H.tag="!"+he:se==="!!"?H.tag="tag:yaml.org,2002:"+he:J(H,'undeclared tag handle "'+se+'"'),!0}function Oe(H){var ce,se;if((se=H.input.charCodeAt(H.position))!==38)return!1;for(H.anchor!==null&&J(H,"duplication of an anchor property"),se=H.input.charCodeAt(++H.position),ce=H.position;se!==0&&!w(se)&&!b(se);)se=H.input.charCodeAt(++H.position);return H.position===ce&&J(H,"name of an anchor node must contain at least one character"),H.anchor=H.input.slice(ce,H.position),!0}function Ve(H,ce,se,he,ve){var ye,Ae,Ue,Je,et,lt,_t,nn,Ot=1,ft=!1,_n=!1;if(H.listener!==null&&H.listener("open",H),H.tag=null,H.anchor=null,H.kind=null,H.result=null,ye=Ae=Ue=se===4||se===3,he&&ee(H,!0,-1)&&(ft=!0,H.lineIndent>ce?Ot=1:H.lineIndent===ce?Ot=0:H.lineIndent<ce&&(Ot=-1)),Ot===1)for(;Re(H)||Oe(H);)ee(H,!0,-1)?(ft=!0,Ue=ye,H.lineIndent>ce?Ot=1:H.lineIndent===ce?Ot=0:H.lineIndent<ce&&(Ot=-1)):Ue=!1;if(Ue&&(Ue=ft||ve),Ot!==1&&se!==4||(_t=se===1||se===2?ce:ce+1,nn=H.position-H.lineStart,Ot===1?Ue&&(De(H,nn)||function(Se,Gt,Vt){var wt,Fe,Qe,ze,je,rt=Se.tag,dt=Se.anchor,ht={},mt={},At=null,kn=null,Kn=null,Xt=!1,j=!1;for(Se.anchor!==null&&(Se.anchorMap[Se.anchor]=ht),je=Se.input.charCodeAt(Se.position);je!==0;){if(wt=Se.input.charCodeAt(Se.position+1),Qe=Se.line,ze=Se.position,je!==63&&je!==58||!w(wt)){if(!Ve(Se,Vt,2,!1,!0))break;if(Se.line===Qe){for(je=Se.input.charCodeAt(Se.position);y(je);)je=Se.input.charCodeAt(++Se.position);if(je===58)w(je=Se.input.charCodeAt(++Se.position))||J(Se,"a whitespace character is expected after the key-value separator within a block mapping"),Xt&&(ie(Se,ht,mt,At,kn,null),At=kn=Kn=null),j=!0,Xt=!1,Fe=!1,At=Se.tag,kn=Se.result;else{if(!j)return Se.tag=rt,Se.anchor=dt,!0;J(Se,"can not read an implicit mapping pair; a colon is missed")}}else{if(!j)return Se.tag=rt,Se.anchor=dt,!0;J(Se,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else je===63?(Xt&&(ie(Se,ht,mt,At,kn,null),At=kn=Kn=null),j=!0,Xt=!0,Fe=!0):Xt?(Xt=!1,Fe=!0):J(Se,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),Se.position+=1,je=wt;if((Se.line===Qe||Se.lineIndent>Gt)&&(Ve(Se,Gt,4,!0,Fe)&&(Xt?kn=Se.result:Kn=Se.result),Xt||(ie(Se,ht,mt,At,kn,Kn,Qe,ze),At=kn=Kn=null),ee(Se,!0,-1),je=Se.input.charCodeAt(Se.position)),Se.lineIndent>Gt&&je!==0)J(Se,"bad indentation of a mapping entry");else if(Se.lineIndent<Gt)break}return Xt&&ie(Se,ht,mt,At,kn,null),j&&(Se.tag=rt,Se.anchor=dt,Se.kind="mapping",Se.result=ht),j}(H,nn,_t))||function(Se,Gt){var Vt,wt,Fe,Qe,ze,je,rt,dt,ht,mt,At=!0,kn=Se.tag,Kn=Se.anchor,Xt={};if((mt=Se.input.charCodeAt(Se.position))===91)Fe=93,je=!1,wt=[];else{if(mt!==123)return!1;Fe=125,je=!0,wt={}}for(Se.anchor!==null&&(Se.anchorMap[Se.anchor]=wt),mt=Se.input.charCodeAt(++Se.position);mt!==0;){if(ee(Se,!0,Gt),(mt=Se.input.charCodeAt(Se.position))===Fe)return Se.position++,Se.tag=kn,Se.anchor=Kn,Se.kind=je?"mapping":"sequence",Se.result=wt,!0;At||J(Se,"missed comma between flow collection entries"),ht=null,Qe=ze=!1,mt===63&&w(Se.input.charCodeAt(Se.position+1))&&(Qe=ze=!0,Se.position++,ee(Se,!0,Gt)),Vt=Se.line,Ve(Se,Gt,1,!1,!0),dt=Se.tag,rt=Se.result,ee(Se,!0,Gt),mt=Se.input.charCodeAt(Se.position),!ze&&Se.line!==Vt||mt!==58||(Qe=!0,mt=Se.input.charCodeAt(++Se.position),ee(Se,!0,Gt),Ve(Se,Gt,1,!1,!0),ht=Se.result),je?ie(Se,wt,Xt,dt,rt,ht):Qe?wt.push(ie(Se,null,Xt,dt,rt,ht)):wt.push(rt),ee(Se,!0,Gt),(mt=Se.input.charCodeAt(Se.position))===44?(At=!0,mt=Se.input.charCodeAt(++Se.position)):At=!1}J(Se,"unexpected end of the stream within a flow collection")}(H,_t)?_n=!0:(Ae&&function(Se,Gt){var Vt,wt,Fe,Qe,ze,je=1,rt=!1,dt=!1,ht=Gt,mt=0,At=!1;if((Qe=Se.input.charCodeAt(Se.position))===124)wt=!1;else{if(Qe!==62)return!1;wt=!0}for(Se.kind="scalar",Se.result="";Qe!==0;)if((Qe=Se.input.charCodeAt(++Se.position))===43||Qe===45)je===1?je=Qe===43?3:2:J(Se,"repeat of a chomping mode identifier");else{if(!((Fe=48<=(ze=Qe)&&ze<=57?ze-48:-1)>=0))break;Fe===0?J(Se,"bad explicit indentation width of a block scalar; it cannot be less than one"):dt?J(Se,"repeat of an indentation width identifier"):(ht=Gt+Fe-1,dt=!0)}if(y(Qe)){do Qe=Se.input.charCodeAt(++Se.position);while(y(Qe));if(Qe===35)do Qe=Se.input.charCodeAt(++Se.position);while(!_(Qe)&&Qe!==0)}for(;Qe!==0;){for(te(Se),Se.lineIndent=0,Qe=Se.input.charCodeAt(Se.position);(!dt||Se.lineIndent<ht)&&Qe===32;)Se.lineIndent++,Qe=Se.input.charCodeAt(++Se.position);if(!dt&&Se.lineIndent>ht&&(ht=Se.lineIndent),_(Qe))mt++;else{if(Se.lineIndent<ht){je===3?Se.result+=a.repeat(`
`,rt?1+mt:mt):je===1&&rt&&(Se.result+=`
`);break}for(wt?y(Qe)?(At=!0,Se.result+=a.repeat(`
`,rt?1+mt:mt)):At?(At=!1,Se.result+=a.repeat(`
`,mt+1)):mt===0?rt&&(Se.result+=" "):Se.result+=a.repeat(`
`,mt):Se.result+=a.repeat(`
`,rt?1+mt:mt),rt=!0,dt=!0,mt=0,Vt=Se.position;!_(Qe)&&Qe!==0;)Qe=Se.input.charCodeAt(++Se.position);fe(Se,Vt,Se.position,!1)}}return!0}(H,_t)||function(Se,Gt){var Vt,wt,Fe;if((Vt=Se.input.charCodeAt(Se.position))!==39)return!1;for(Se.kind="scalar",Se.result="",Se.position++,wt=Fe=Se.position;(Vt=Se.input.charCodeAt(Se.position))!==0;)if(Vt===39){if(fe(Se,wt,Se.position,!0),(Vt=Se.input.charCodeAt(++Se.position))!==39)return!0;wt=Se.position,Se.position++,Fe=Se.position}else _(Vt)?(fe(Se,wt,Fe,!0),Ce(Se,ee(Se,!1,Gt)),wt=Fe=Se.position):Se.position===Se.lineStart&&we(Se)?J(Se,"unexpected end of the document within a single quoted scalar"):(Se.position++,Fe=Se.position);J(Se,"unexpected end of the stream within a single quoted scalar")}(H,_t)||function(Se,Gt){var Vt,wt,Fe,Qe,ze,je,rt;if((je=Se.input.charCodeAt(Se.position))!==34)return!1;for(Se.kind="scalar",Se.result="",Se.position++,Vt=wt=Se.position;(je=Se.input.charCodeAt(Se.position))!==0;){if(je===34)return fe(Se,Vt,Se.position,!0),Se.position++,!0;if(je===92){if(fe(Se,Vt,Se.position,!0),_(je=Se.input.charCodeAt(++Se.position)))ee(Se,!1,Gt);else if(je<256&&k[je])Se.result+=U[je],Se.position++;else if((ze=(rt=je)===120?2:rt===117?4:rt===85?8:0)>0){for(Fe=ze,Qe=0;Fe>0;Fe--)(ze=M(je=Se.input.charCodeAt(++Se.position)))>=0?Qe=(Qe<<4)+ze:J(Se,"expected hexadecimal character");Se.result+=A(Qe),Se.position++}else J(Se,"unknown escape sequence");Vt=wt=Se.position}else _(je)?(fe(Se,Vt,wt,!0),Ce(Se,ee(Se,!1,Gt)),Vt=wt=Se.position):Se.position===Se.lineStart&&we(Se)?J(Se,"unexpected end of the document within a double quoted scalar"):(Se.position++,wt=Se.position)}J(Se,"unexpected end of the stream within a double quoted scalar")}(H,_t)?_n=!0:function(Se){var Gt,Vt,wt;if((wt=Se.input.charCodeAt(Se.position))!==42)return!1;for(wt=Se.input.charCodeAt(++Se.position),Gt=Se.position;wt!==0&&!w(wt)&&!b(wt);)wt=Se.input.charCodeAt(++Se.position);return Se.position===Gt&&J(Se,"name of an alias node must contain at least one character"),Vt=Se.input.slice(Gt,Se.position),Se.anchorMap.hasOwnProperty(Vt)||J(Se,'unidentified alias "'+Vt+'"'),Se.result=Se.anchorMap[Vt],ee(Se,!0,-1),!0}(H)?(_n=!0,H.tag===null&&H.anchor===null||J(H,"alias node should not have any properties")):function(Se,Gt,Vt){var wt,Fe,Qe,ze,je,rt,dt,ht,mt=Se.kind,At=Se.result;if(w(ht=Se.input.charCodeAt(Se.position))||b(ht)||ht===35||ht===38||ht===42||ht===33||ht===124||ht===62||ht===39||ht===34||ht===37||ht===64||ht===96||(ht===63||ht===45)&&(w(wt=Se.input.charCodeAt(Se.position+1))||Vt&&b(wt)))return!1;for(Se.kind="scalar",Se.result="",Fe=Qe=Se.position,ze=!1;ht!==0;){if(ht===58){if(w(wt=Se.input.charCodeAt(Se.position+1))||Vt&&b(wt))break}else if(ht===35){if(w(Se.input.charCodeAt(Se.position-1)))break}else{if(Se.position===Se.lineStart&&we(Se)||Vt&&b(ht))break;if(_(ht)){if(je=Se.line,rt=Se.lineStart,dt=Se.lineIndent,ee(Se,!1,-1),Se.lineIndent>=Gt){ze=!0,ht=Se.input.charCodeAt(Se.position);continue}Se.position=Qe,Se.line=je,Se.lineStart=rt,Se.lineIndent=dt;break}}ze&&(fe(Se,Fe,Qe,!1),Ce(Se,Se.line-je),Fe=Qe=Se.position,ze=!1),y(ht)||(Qe=Se.position+1),ht=Se.input.charCodeAt(++Se.position)}return fe(Se,Fe,Qe,!1),!!Se.result||(Se.kind=mt,Se.result=At,!1)}(H,_t,se===1)&&(_n=!0,H.tag===null&&(H.tag="?")),H.anchor!==null&&(H.anchorMap[H.anchor]=H.result)):Ot===0&&(_n=Ue&&De(H,nn))),H.tag!==null&&H.tag!=="!")if(H.tag==="?"){for(H.result!==null&&H.kind!=="scalar"&&J(H,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+H.kind+'"'),Je=0,et=H.implicitTypes.length;Je<et;Je+=1)if((lt=H.implicitTypes[Je]).resolve(H.result)){H.result=lt.construct(H.result),H.tag=lt.tag,H.anchor!==null&&(H.anchorMap[H.anchor]=H.result);break}}else d.call(H.typeMap[H.kind||"fallback"],H.tag)?(lt=H.typeMap[H.kind||"fallback"][H.tag],H.result!==null&&lt.kind!==H.kind&&J(H,"unacceptable node kind for !<"+H.tag+'> tag; it should be "'+lt.kind+'", not "'+H.kind+'"'),lt.resolve(H.result)?(H.result=lt.construct(H.result),H.anchor!==null&&(H.anchorMap[H.anchor]=H.result)):J(H,"cannot resolve a node with !<"+H.tag+"> explicit tag")):J(H,"unknown tag !<"+H.tag+">");return H.listener!==null&&H.listener("close",H),H.tag!==null||H.anchor!==null||_n}function Ge(H){var ce,se,he,ve,ye=H.position,Ae=!1;for(H.version=null,H.checkLineBreaks=H.legacy,H.tagMap={},H.anchorMap={};(ve=H.input.charCodeAt(H.position))!==0&&(ee(H,!0,-1),ve=H.input.charCodeAt(H.position),!(H.lineIndent>0||ve!==37));){for(Ae=!0,ve=H.input.charCodeAt(++H.position),ce=H.position;ve!==0&&!w(ve);)ve=H.input.charCodeAt(++H.position);for(he=[],(se=H.input.slice(ce,H.position)).length<1&&J(H,"directive name must not be less than one character in length");ve!==0;){for(;y(ve);)ve=H.input.charCodeAt(++H.position);if(ve===35){do ve=H.input.charCodeAt(++H.position);while(ve!==0&&!_(ve));break}if(_(ve))break;for(ce=H.position;ve!==0&&!w(ve);)ve=H.input.charCodeAt(++H.position);he.push(H.input.slice(ce,H.position))}ve!==0&&te(H),d.call(re,se)?re[se](H,se,he):X(H,'unknown document directive "'+se+'"')}ee(H,!0,-1),H.lineIndent===0&&H.input.charCodeAt(H.position)===45&&H.input.charCodeAt(H.position+1)===45&&H.input.charCodeAt(H.position+2)===45?(H.position+=3,ee(H,!0,-1)):Ae&&J(H,"directives end mark is expected"),Ve(H,H.lineIndent-1,4,!1,!0),ee(H,!0,-1),H.checkLineBreaks&&h.test(H.input.slice(ye,H.position))&&X(H,"non-ASCII line breaks are interpreted as content"),H.documents.push(H.result),H.position===H.lineStart&&we(H)?H.input.charCodeAt(H.position)===46&&(H.position+=3,ee(H,!0,-1)):H.position<H.length-1&&J(H,"end of the stream or a document separator is expected")}function qe(H,ce){ce=ce||{},(H=String(H)).length!==0&&(H.charCodeAt(H.length-1)!==10&&H.charCodeAt(H.length-1)!==13&&(H+=`
`),H.charCodeAt(0)===65279&&(H=H.slice(1)));var se=new z(H,ce),he=H.indexOf("\0");for(he!==-1&&(se.position=he,J(se,"null byte is not allowed in input")),se.input+="\0";se.input.charCodeAt(se.position)===32;)se.lineIndent+=1,se.position+=1;for(;se.position<se.length-1;)Ge(se);return se.documents}function Be(H,ce,se){ce!==null&&typeof ce=="object"&&se===void 0&&(se=ce,ce=null);var he=qe(H,se);if(typeof ce!="function")return he;for(var ve=0,ye=he.length;ve<ye;ve+=1)ce(he[ve])}function ae(H,ce){var se=qe(H,ce);if(se.length!==0){if(se.length===1)return se[0];throw new o("expected a single document in the stream, but found more")}}n.exports.loadAll=Be,n.exports.load=ae,n.exports.safeLoadAll=function(H,ce,se){return typeof ce=="object"&&ce!==null&&se===void 0&&(se=ce,ce=null),Be(H,ce,a.extend({schema:l},se))},n.exports.safeLoad=function(H,ce){return ae(H,a.extend({schema:l},ce))}},function(n,r,i){var a=i(38);function o(s,l,c,d,f){this.name=s,this.buffer=l,this.position=c,this.line=d,this.column=f}o.prototype.getSnippet=function(s,l){var c,d,f,h,p;if(!this.buffer)return null;for(s=s||4,l=l||75,c="",d=this.position;d>0&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(d-1))===-1;)if(d-=1,this.position-d>l/2-1){c=" ... ",d+=5;break}for(f="",h=this.position;h<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(h))===-1;)if((h+=1)-this.position>l/2-1){f=" ... ",h-=5;break}return p=this.buffer.slice(d,h),a.repeat(" ",s)+c+p+f+`
`+a.repeat(" ",s+this.position-d+c.length)+"^"},o.prototype.toString=function(s){var l,c="";return this.name&&(c+='in "'+this.name+'" '),c+="at line "+(this.line+1)+", column "+(this.column+1),s||(l=this.getSnippet())&&(c+=`:
`+l),c},n.exports=o},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:str",{kind:"scalar",construct:function(o){return o!==null?o:""}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(o){return o!==null?o:[]}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:map",{kind:"mapping",construct:function(o){return o!==null?o:{}}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(o){if(o===null)return!0;var s=o.length;return s===1&&o==="~"||s===4&&(o==="null"||o==="Null"||o==="NULL")},construct:function(){return null},predicate:function(o){return o===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(o){if(o===null)return!1;var s=o.length;return s===4&&(o==="true"||o==="True"||o==="TRUE")||s===5&&(o==="false"||o==="False"||o==="FALSE")},construct:function(o){return o==="true"||o==="True"||o==="TRUE"},predicate:function(o){return Object.prototype.toString.call(o)==="[object Boolean]"},represent:{lowercase:function(o){return o?"true":"false"},uppercase:function(o){return o?"TRUE":"FALSE"},camelcase:function(o){return o?"True":"False"}},defaultStyle:"lowercase"})},function(n,r,i){var a=i(38),o=i(10);function s(c){return 48<=c&&c<=55}function l(c){return 48<=c&&c<=57}n.exports=new o("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(c){if(c===null)return!1;var d,f,h=c.length,p=0,C=!1;if(!h)return!1;if((d=c[p])!=="-"&&d!=="+"||(d=c[++p]),d==="0"){if(p+1===h)return!0;if((d=c[++p])==="b"){for(p++;p<h;p++)if((d=c[p])!=="_"){if(d!=="0"&&d!=="1")return!1;C=!0}return C&&d!=="_"}if(d==="x"){for(p++;p<h;p++)if((d=c[p])!=="_"){if(!(48<=(f=c.charCodeAt(p))&&f<=57||65<=f&&f<=70||97<=f&&f<=102))return!1;C=!0}return C&&d!=="_"}for(;p<h;p++)if((d=c[p])!=="_"){if(!s(c.charCodeAt(p)))return!1;C=!0}return C&&d!=="_"}if(d==="_")return!1;for(;p<h;p++)if((d=c[p])!=="_"){if(d===":")break;if(!l(c.charCodeAt(p)))return!1;C=!0}return!(!C||d==="_")&&(d!==":"||/^(:[0-5]?[0-9])+$/.test(c.slice(p)))},construct:function(c){var d,f,h=c,p=1,C=[];return h.indexOf("_")!==-1&&(h=h.replace(/_/g,"")),(d=h[0])!=="-"&&d!=="+"||(d==="-"&&(p=-1),d=(h=h.slice(1))[0]),h==="0"?0:d==="0"?h[1]==="b"?p*parseInt(h.slice(2),2):h[1]==="x"?p*parseInt(h,16):p*parseInt(h,8):h.indexOf(":")!==-1?(h.split(":").forEach(function(x){C.unshift(parseInt(x,10))}),h=0,f=1,C.forEach(function(x){h+=x*f,f*=60}),p*h):p*parseInt(h,10)},predicate:function(c){return Object.prototype.toString.call(c)==="[object Number]"&&c%1==0&&!a.isNegativeZero(c)},represent:{binary:function(c){return c>=0?"0b"+c.toString(2):"-0b"+c.toString(2).slice(1)},octal:function(c){return c>=0?"0"+c.toString(8):"-0"+c.toString(8).slice(1)},decimal:function(c){return c.toString(10)},hexadecimal:function(c){return c>=0?"0x"+c.toString(16).toUpperCase():"-0x"+c.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(n,r,i){var a=i(38),o=i(10),s=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),l=/^[-+]?[0-9]+e/;n.exports=new o("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(c){return c!==null&&!(!s.test(c)||c[c.length-1]==="_")},construct:function(c){var d,f,h,p;return f=(d=c.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,p=[],"+-".indexOf(d[0])>=0&&(d=d.slice(1)),d===".inf"?f===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:d===".nan"?NaN:d.indexOf(":")>=0?(d.split(":").forEach(function(C){p.unshift(parseFloat(C,10))}),d=0,h=1,p.forEach(function(C){d+=C*h,h*=60}),f*d):f*parseFloat(d,10)},predicate:function(c){return Object.prototype.toString.call(c)==="[object Number]"&&(c%1!=0||a.isNegativeZero(c))},represent:function(c,d){var f;if(isNaN(c))switch(d){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===c)switch(d){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===c)switch(d){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(a.isNegativeZero(c))return"-0.0";return f=c.toString(10),l.test(f)?f.replace("e",".e"):f},defaultStyle:"lowercase"})},function(n,r,i){var a=i(10),o=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),s=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");n.exports=new a("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(l){return l!==null&&(o.exec(l)!==null||s.exec(l)!==null)},construct:function(l){var c,d,f,h,p,C,x,T,_=0,y=null;if((c=o.exec(l))===null&&(c=s.exec(l)),c===null)throw new Error("Date resolve error");if(d=+c[1],f=+c[2]-1,h=+c[3],!c[4])return new Date(Date.UTC(d,f,h));if(p=+c[4],C=+c[5],x=+c[6],c[7]){for(_=c[7].slice(0,3);_.length<3;)_+="0";_=+_}return c[9]&&(y=6e4*(60*+c[10]+ +(c[11]||0)),c[9]==="-"&&(y=-y)),T=new Date(Date.UTC(d,f,h,p,C,x,_)),y&&T.setTime(T.getTime()-y),T},instanceOf:Date,represent:function(l){return l.toISOString()}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(o){return o==="<<"||o===null}})},function(n,r,i){var a;try{a=i(145).Buffer}catch{}var o=i(10),s=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;n.exports=new o("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(l){if(l===null)return!1;var c,d,f=0,h=l.length,p=s;for(d=0;d<h;d++)if(!((c=p.indexOf(l.charAt(d)))>64)){if(c<0)return!1;f+=6}return f%8==0},construct:function(l){var c,d,f=l.replace(/[\r\n=]/g,""),h=f.length,p=s,C=0,x=[];for(c=0;c<h;c++)c%4==0&&c&&(x.push(C>>16&255),x.push(C>>8&255),x.push(255&C)),C=C<<6|p.indexOf(f.charAt(c));return(d=h%4*6)===0?(x.push(C>>16&255),x.push(C>>8&255),x.push(255&C)):d===18?(x.push(C>>10&255),x.push(C>>2&255)):d===12&&x.push(C>>4&255),a?a.from?a.from(x):new a(x):x},predicate:function(l){return a&&a.isBuffer(l)},represent:function(l){var c,d,f="",h=0,p=l.length,C=s;for(c=0;c<p;c++)c%3==0&&c&&(f+=C[h>>18&63],f+=C[h>>12&63],f+=C[h>>6&63],f+=C[63&h]),h=(h<<8)+l[c];return(d=p%3)===0?(f+=C[h>>18&63],f+=C[h>>12&63],f+=C[h>>6&63],f+=C[63&h]):d===2?(f+=C[h>>10&63],f+=C[h>>4&63],f+=C[h<<2&63],f+=C[64]):d===1&&(f+=C[h>>2&63],f+=C[h<<4&63],f+=C[64],f+=C[64]),f}})},function(n,r,i){var a=i(10),o=Object.prototype.hasOwnProperty,s=Object.prototype.toString;n.exports=new a("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(l){if(l===null)return!0;var c,d,f,h,p,C=[],x=l;for(c=0,d=x.length;c<d;c+=1){if(f=x[c],p=!1,s.call(f)!=="[object Object]")return!1;for(h in f)if(o.call(f,h)){if(p)return!1;p=!0}if(!p||C.indexOf(h)!==-1)return!1;C.push(h)}return!0},construct:function(l){return l!==null?l:[]}})},function(n,r,i){var a=i(10),o=Object.prototype.toString;n.exports=new a("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(s){if(s===null)return!0;var l,c,d,f,h,p=s;for(h=new Array(p.length),l=0,c=p.length;l<c;l+=1){if(d=p[l],o.call(d)!=="[object Object]"||(f=Object.keys(d)).length!==1)return!1;h[l]=[f[0],d[f[0]]]}return!0},construct:function(s){if(s===null)return[];var l,c,d,f,h,p=s;for(h=new Array(p.length),l=0,c=p.length;l<c;l+=1)d=p[l],f=Object.keys(d),h[l]=[f[0],d[f[0]]];return h}})},function(n,r,i){var a=i(10),o=Object.prototype.hasOwnProperty;n.exports=new a("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(s){if(s===null)return!0;var l,c=s;for(l in c)if(o.call(c,l)&&c[l]!==null)return!1;return!0},construct:function(s){return s!==null?s:{}}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(o){return o===void 0},represent:function(){return""}})},function(n,r,i){var a=i(10);n.exports=new a("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(o){if(o===null||o.length===0)return!1;var s=o,l=/\/([gim]*)$/.exec(o),c="";return!(s[0]==="/"&&(l&&(c=l[1]),c.length>3||s[s.length-c.length-1]!=="/"))},construct:function(o){var s=o,l=/\/([gim]*)$/.exec(o),c="";return s[0]==="/"&&(l&&(c=l[1]),s=s.slice(1,s.length-c.length-1)),new RegExp(s,c)},predicate:function(o){return Object.prototype.toString.call(o)==="[object RegExp]"},represent:function(o){var s="/"+o.source+"/";return o.global&&(s+="g"),o.multiline&&(s+="m"),o.ignoreCase&&(s+="i"),s}})},function(n,r,i){var a;try{a=i(302)}catch{typeof window<"u"&&(a=window.esprima)}var o=i(10);n.exports=new o("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(s){if(s===null)return!1;try{var l="("+s+")",c=a.parse(l,{range:!0});return c.type==="Program"&&c.body.length===1&&c.body[0].type==="ExpressionStatement"&&(c.body[0].expression.type==="ArrowFunctionExpression"||c.body[0].expression.type==="FunctionExpression")}catch{return!1}},construct:function(s){var l,c="("+s+")",d=a.parse(c,{range:!0}),f=[];if(d.type!=="Program"||d.body.length!==1||d.body[0].type!=="ExpressionStatement"||d.body[0].expression.type!=="ArrowFunctionExpression"&&d.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return d.body[0].expression.params.forEach(function(h){f.push(h.name)}),l=d.body[0].expression.body.range,d.body[0].expression.body.type==="BlockStatement"?new Function(f,c.slice(l[0]+1,l[1]-1)):new Function(f,"return "+c.slice(l[0],l[1]))},predicate:function(s){return Object.prototype.toString.call(s)==="[object Function]"},represent:function(s){return s.toString()}})},function(n,r,i){var a;a=function(){return function(o){var s={};function l(c){if(s[c])return s[c].exports;var d=s[c]={exports:{},id:c,loaded:!1};return o[c].call(d.exports,d,d.exports,l),d.loaded=!0,d.exports}return l.m=o,l.c=s,l.p="",l(0)}([function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(1),d=l(3),f=l(8),h=l(15);function p(x,T,_){var y=null,w=function(B,z){_&&_(B,z),y&&y.visit(B,z)},b=typeof _=="function"?w:null,M=!1;if(T){M=typeof T.comment=="boolean"&&T.comment;var I=typeof T.attachComment=="boolean"&&T.attachComment;(M||I)&&((y=new c.CommentHandler).attach=I,T.comment=!0,b=w)}var A,k=!1;T&&typeof T.sourceType=="string"&&(k=T.sourceType==="module"),A=T&&typeof T.jsx=="boolean"&&T.jsx?new d.JSXParser(x,T,b):new f.Parser(x,T,b);var U=k?A.parseModule():A.parseScript();return M&&y&&(U.comments=y.comments),A.config.tokens&&(U.tokens=A.tokens),A.config.tolerant&&(U.errors=A.errorHandler.errors),U}s.parse=p,s.parseModule=function(x,T,_){var y=T||{};return y.sourceType="module",p(x,y,_)},s.parseScript=function(x,T,_){var y=T||{};return y.sourceType="script",p(x,y,_)},s.tokenize=function(x,T,_){var y,w=new h.Tokenizer(x,T);y=[];try{for(;;){var b=w.getNextToken();if(!b)break;_&&(b=_(b)),y.push(b)}}catch(M){w.errorHandler.tolerate(M)}return w.errorHandler.tolerant&&(y.errors=w.errors()),y};var C=l(2);s.Syntax=C.Syntax,s.version="4.0.1"},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(2),d=function(){function f(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return f.prototype.insertInnerComments=function(h,p){if(h.type===c.Syntax.BlockStatement&&h.body.length===0){for(var C=[],x=this.leading.length-1;x>=0;--x){var T=this.leading[x];p.end.offset>=T.start&&(C.unshift(T.comment),this.leading.splice(x,1),this.trailing.splice(x,1))}C.length&&(h.innerComments=C)}},f.prototype.findTrailingComments=function(h){var p=[];if(this.trailing.length>0){for(var C=this.trailing.length-1;C>=0;--C){var x=this.trailing[C];x.start>=h.end.offset&&p.unshift(x.comment)}return this.trailing.length=0,p}var T=this.stack[this.stack.length-1];if(T&&T.node.trailingComments){var _=T.node.trailingComments[0];_&&_.range[0]>=h.end.offset&&(p=T.node.trailingComments,delete T.node.trailingComments)}return p},f.prototype.findLeadingComments=function(h){for(var p,C=[];this.stack.length>0&&(_=this.stack[this.stack.length-1])&&_.start>=h.start.offset;)p=_.node,this.stack.pop();if(p){for(var x=(p.leadingComments?p.leadingComments.length:0)-1;x>=0;--x){var T=p.leadingComments[x];T.range[1]<=h.start.offset&&(C.unshift(T),p.leadingComments.splice(x,1))}return p.leadingComments&&p.leadingComments.length===0&&delete p.leadingComments,C}for(x=this.leading.length-1;x>=0;--x){var _;(_=this.leading[x]).start<=h.start.offset&&(C.unshift(_.comment),this.leading.splice(x,1))}return C},f.prototype.visitNode=function(h,p){if(!(h.type===c.Syntax.Program&&h.body.length>0)){this.insertInnerComments(h,p);var C=this.findTrailingComments(p),x=this.findLeadingComments(p);x.length>0&&(h.leadingComments=x),C.length>0&&(h.trailingComments=C),this.stack.push({node:h,start:p.start.offset})}},f.prototype.visitComment=function(h,p){var C=h.type[0]==="L"?"Line":"Block",x={type:C,value:h.value};if(h.range&&(x.range=h.range),h.loc&&(x.loc=h.loc),this.comments.push(x),this.attach){var T={comment:{type:C,value:h.value,range:[p.start.offset,p.end.offset]},start:p.start.offset};h.loc&&(T.comment.loc=h.loc),h.type=C,this.leading.push(T),this.trailing.push(T)}},f.prototype.visit=function(h,p){h.type==="LineComment"||h.type==="BlockComment"?this.visitComment(h,p):this.attach&&this.visitNode(h,p)},f}();s.CommentHandler=d},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(o,s,l){var c,d=this&&this.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,M){b.__proto__=M}||function(b,M){for(var I in M)M.hasOwnProperty(I)&&(b[I]=M[I])},function(b,M){function I(){this.constructor=b}c(b,M),b.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)});Object.defineProperty(s,"__esModule",{value:!0});var f=l(4),h=l(5),p=l(6),C=l(7),x=l(8),T=l(13),_=l(14);function y(b){var M;switch(b.type){case p.JSXSyntax.JSXIdentifier:M=b.name;break;case p.JSXSyntax.JSXNamespacedName:var I=b;M=y(I.namespace)+":"+y(I.name);break;case p.JSXSyntax.JSXMemberExpression:var A=b;M=y(A.object)+"."+y(A.property)}return M}T.TokenName[100]="JSXIdentifier",T.TokenName[101]="JSXText";var w=function(b){function M(I,A,k){return b.call(this,I,A,k)||this}return d(M,b),M.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():b.prototype.parsePrimaryExpression.call(this)},M.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},M.prototype.finishJSX=function(){this.nextToken()},M.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},M.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},M.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},M.prototype.scanXHTMLEntity=function(I){for(var A="&",k=!0,U=!1,B=!1,z=!1;!this.scanner.eof()&&k&&!U;){var K=this.scanner.source[this.scanner.index];if(K===I)break;if(U=K===";",A+=K,++this.scanner.index,!U)switch(A.length){case 2:B=K==="#";break;case 3:B&&(k=(z=K==="x")||f.Character.isDecimalDigit(K.charCodeAt(0)),B=B&&!z);break;default:k=(k=k&&!(B&&!f.Character.isDecimalDigit(K.charCodeAt(0))))&&!(z&&!f.Character.isHexDigit(K.charCodeAt(0)))}}if(k&&U&&A.length>2){var J=A.substr(1,A.length-2);B&&J.length>1?A=String.fromCharCode(parseInt(J.substr(1),10)):z&&J.length>2?A=String.fromCharCode(parseInt("0"+J.substr(1),16)):B||z||!_.XHTMLEntities[J]||(A=_.XHTMLEntities[J])}return A},M.prototype.lexJSX=function(){var I=this.scanner.source.charCodeAt(this.scanner.index);if(I===60||I===62||I===47||I===58||I===61||I===123||I===125)return{type:7,value:K=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(I===34||I===39){for(var A=this.scanner.index,k=this.scanner.source[this.scanner.index++],U="";!this.scanner.eof()&&(J=this.scanner.source[this.scanner.index++])!==k;)U+=J==="&"?this.scanXHTMLEntity(k):J;return{type:8,value:U,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:A,end:this.scanner.index}}if(I===46){var B=this.scanner.source.charCodeAt(this.scanner.index+1),z=this.scanner.source.charCodeAt(this.scanner.index+2),K=B===46&&z===46?"...":".";return A=this.scanner.index,this.scanner.index+=K.length,{type:7,value:K,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:A,end:this.scanner.index}}if(I===96)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(f.Character.isIdentifierStart(I)&&I!==92){for(A=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var J=this.scanner.source.charCodeAt(this.scanner.index);if(f.Character.isIdentifierPart(J)&&J!==92)++this.scanner.index;else{if(J!==45)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(A,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:A,end:this.scanner.index}}return this.scanner.lex()},M.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var I=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(I)),I},M.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var I=this.scanner.index,A="";!this.scanner.eof();){var k=this.scanner.source[this.scanner.index];if(k==="{"||k==="<")break;++this.scanner.index,A+=k,f.Character.isLineTerminator(k.charCodeAt(0))&&(++this.scanner.lineNumber,k==="\r"&&this.scanner.source[this.scanner.index]===`
`&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var U={type:101,value:A,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:I,end:this.scanner.index};return A.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(U)),U},M.prototype.peekJSXToken=function(){var I=this.scanner.saveState();this.scanner.scanComments();var A=this.lexJSX();return this.scanner.restoreState(I),A},M.prototype.expectJSX=function(I){var A=this.nextJSXToken();A.type===7&&A.value===I||this.throwUnexpectedToken(A)},M.prototype.matchJSX=function(I){var A=this.peekJSXToken();return A.type===7&&A.value===I},M.prototype.parseJSXIdentifier=function(){var I=this.createJSXNode(),A=this.nextJSXToken();return A.type!==100&&this.throwUnexpectedToken(A),this.finalize(I,new h.JSXIdentifier(A.value))},M.prototype.parseJSXElementName=function(){var I=this.createJSXNode(),A=this.parseJSXIdentifier();if(this.matchJSX(":")){var k=A;this.expectJSX(":");var U=this.parseJSXIdentifier();A=this.finalize(I,new h.JSXNamespacedName(k,U))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var B=A;this.expectJSX(".");var z=this.parseJSXIdentifier();A=this.finalize(I,new h.JSXMemberExpression(B,z))}return A},M.prototype.parseJSXAttributeName=function(){var I,A=this.createJSXNode(),k=this.parseJSXIdentifier();if(this.matchJSX(":")){var U=k;this.expectJSX(":");var B=this.parseJSXIdentifier();I=this.finalize(A,new h.JSXNamespacedName(U,B))}else I=k;return I},M.prototype.parseJSXStringLiteralAttribute=function(){var I=this.createJSXNode(),A=this.nextJSXToken();A.type!==8&&this.throwUnexpectedToken(A);var k=this.getTokenRaw(A);return this.finalize(I,new C.Literal(A.value,k))},M.prototype.parseJSXExpressionAttribute=function(){var I=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var A=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(I,new h.JSXExpressionContainer(A))},M.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},M.prototype.parseJSXNameValueAttribute=function(){var I=this.createJSXNode(),A=this.parseJSXAttributeName(),k=null;return this.matchJSX("=")&&(this.expectJSX("="),k=this.parseJSXAttributeValue()),this.finalize(I,new h.JSXAttribute(A,k))},M.prototype.parseJSXSpreadAttribute=function(){var I=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var A=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(I,new h.JSXSpreadAttribute(A))},M.prototype.parseJSXAttributes=function(){for(var I=[];!this.matchJSX("/")&&!this.matchJSX(">");){var A=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();I.push(A)}return I},M.prototype.parseJSXOpeningElement=function(){var I=this.createJSXNode();this.expectJSX("<");var A=this.parseJSXElementName(),k=this.parseJSXAttributes(),U=this.matchJSX("/");return U&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(I,new h.JSXOpeningElement(A,U,k))},M.prototype.parseJSXBoundaryElement=function(){var I=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var A=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(I,new h.JSXClosingElement(A))}var k=this.parseJSXElementName(),U=this.parseJSXAttributes(),B=this.matchJSX("/");return B&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(I,new h.JSXOpeningElement(k,B,U))},M.prototype.parseJSXEmptyExpression=function(){var I=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(I,new h.JSXEmptyExpression)},M.prototype.parseJSXExpressionContainer=function(){var I,A=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(I=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),I=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(A,new h.JSXExpressionContainer(I))},M.prototype.parseJSXChildren=function(){for(var I=[];!this.scanner.eof();){var A=this.createJSXChildNode(),k=this.nextJSXText();if(k.start<k.end){var U=this.getTokenRaw(k),B=this.finalize(A,new h.JSXText(k.value,U));I.push(B)}if(this.scanner.source[this.scanner.index]!=="{")break;var z=this.parseJSXExpressionContainer();I.push(z)}return I},M.prototype.parseComplexJSXElement=function(I){for(var A=[];!this.scanner.eof();){I.children=I.children.concat(this.parseJSXChildren());var k=this.createJSXChildNode(),U=this.parseJSXBoundaryElement();if(U.type===p.JSXSyntax.JSXOpeningElement){var B=U;if(B.selfClosing){var z=this.finalize(k,new h.JSXElement(B,[],null));I.children.push(z)}else A.push(I),I={node:k,opening:B,closing:null,children:[]}}if(U.type===p.JSXSyntax.JSXClosingElement){I.closing=U;var K=y(I.opening.name);if(K!==y(I.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",K),!(A.length>0))break;z=this.finalize(I.node,new h.JSXElement(I.opening,I.children,I.closing)),(I=A[A.length-1]).children.push(z),A.pop()}}return I},M.prototype.parseJSXElement=function(){var I=this.createJSXNode(),A=this.parseJSXOpeningElement(),k=[],U=null;if(!A.selfClosing){var B=this.parseComplexJSXElement({node:I,opening:A,closing:U,children:k});k=B.children,U=B.closing}return this.finalize(I,new h.JSXElement(A,k,U))},M.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var I=this.parseJSXElement();return this.finishJSX(),I},M.prototype.isStartOfExpression=function(){return b.prototype.isStartOfExpression.call(this)||this.match("<")},M}(x.Parser);s.JSXParser=w},function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var l={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};s.Character={fromCodePoint:function(c){return c<65536?String.fromCharCode(c):String.fromCharCode(55296+(c-65536>>10))+String.fromCharCode(56320+(c-65536&1023))},isWhiteSpace:function(c){return c===32||c===9||c===11||c===12||c===160||c>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(c)>=0},isLineTerminator:function(c){return c===10||c===13||c===8232||c===8233},isIdentifierStart:function(c){return c===36||c===95||c>=65&&c<=90||c>=97&&c<=122||c===92||c>=128&&l.NonAsciiIdentifierStart.test(s.Character.fromCodePoint(c))},isIdentifierPart:function(c){return c===36||c===95||c>=65&&c<=90||c>=97&&c<=122||c>=48&&c<=57||c===92||c>=128&&l.NonAsciiIdentifierPart.test(s.Character.fromCodePoint(c))},isDecimalDigit:function(c){return c>=48&&c<=57},isHexDigit:function(c){return c>=48&&c<=57||c>=65&&c<=70||c>=97&&c<=102},isOctalDigit:function(c){return c>=48&&c<=55}}},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(6),d=function(M){this.type=c.JSXSyntax.JSXClosingElement,this.name=M};s.JSXClosingElement=d;var f=function(M,I,A){this.type=c.JSXSyntax.JSXElement,this.openingElement=M,this.children=I,this.closingElement=A};s.JSXElement=f;var h=function(){this.type=c.JSXSyntax.JSXEmptyExpression};s.JSXEmptyExpression=h;var p=function(M){this.type=c.JSXSyntax.JSXExpressionContainer,this.expression=M};s.JSXExpressionContainer=p;var C=function(M){this.type=c.JSXSyntax.JSXIdentifier,this.name=M};s.JSXIdentifier=C;var x=function(M,I){this.type=c.JSXSyntax.JSXMemberExpression,this.object=M,this.property=I};s.JSXMemberExpression=x;var T=function(M,I){this.type=c.JSXSyntax.JSXAttribute,this.name=M,this.value=I};s.JSXAttribute=T;var _=function(M,I){this.type=c.JSXSyntax.JSXNamespacedName,this.namespace=M,this.name=I};s.JSXNamespacedName=_;var y=function(M,I,A){this.type=c.JSXSyntax.JSXOpeningElement,this.name=M,this.selfClosing=I,this.attributes=A};s.JSXOpeningElement=y;var w=function(M){this.type=c.JSXSyntax.JSXSpreadAttribute,this.argument=M};s.JSXSpreadAttribute=w;var b=function(M,I){this.type=c.JSXSyntax.JSXText,this.value=M,this.raw=I};s.JSXText=b},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(2),d=function(Xe){this.type=c.Syntax.ArrayExpression,this.elements=Xe};s.ArrayExpression=d;var f=function(Xe){this.type=c.Syntax.ArrayPattern,this.elements=Xe};s.ArrayPattern=f;var h=function(Xe,it,Qt){this.type=c.Syntax.ArrowFunctionExpression,this.id=null,this.params=Xe,this.body=it,this.generator=!1,this.expression=Qt,this.async=!1};s.ArrowFunctionExpression=h;var p=function(Xe,it,Qt){this.type=c.Syntax.AssignmentExpression,this.operator=Xe,this.left=it,this.right=Qt};s.AssignmentExpression=p;var C=function(Xe,it){this.type=c.Syntax.AssignmentPattern,this.left=Xe,this.right=it};s.AssignmentPattern=C;var x=function(Xe,it,Qt){this.type=c.Syntax.ArrowFunctionExpression,this.id=null,this.params=Xe,this.body=it,this.generator=!1,this.expression=Qt,this.async=!0};s.AsyncArrowFunctionExpression=x;var T=function(Xe,it,Qt){this.type=c.Syntax.FunctionDeclaration,this.id=Xe,this.params=it,this.body=Qt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionDeclaration=T;var _=function(Xe,it,Qt){this.type=c.Syntax.FunctionExpression,this.id=Xe,this.params=it,this.body=Qt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionExpression=_;var y=function(Xe){this.type=c.Syntax.AwaitExpression,this.argument=Xe};s.AwaitExpression=y;var w=function(Xe,it,Qt){var Q=Xe==="||"||Xe==="&&";this.type=Q?c.Syntax.LogicalExpression:c.Syntax.BinaryExpression,this.operator=Xe,this.left=it,this.right=Qt};s.BinaryExpression=w;var b=function(Xe){this.type=c.Syntax.BlockStatement,this.body=Xe};s.BlockStatement=b;var M=function(Xe){this.type=c.Syntax.BreakStatement,this.label=Xe};s.BreakStatement=M;var I=function(Xe,it){this.type=c.Syntax.CallExpression,this.callee=Xe,this.arguments=it};s.CallExpression=I;var A=function(Xe,it){this.type=c.Syntax.CatchClause,this.param=Xe,this.body=it};s.CatchClause=A;var k=function(Xe){this.type=c.Syntax.ClassBody,this.body=Xe};s.ClassBody=k;var U=function(Xe,it,Qt){this.type=c.Syntax.ClassDeclaration,this.id=Xe,this.superClass=it,this.body=Qt};s.ClassDeclaration=U;var B=function(Xe,it,Qt){this.type=c.Syntax.ClassExpression,this.id=Xe,this.superClass=it,this.body=Qt};s.ClassExpression=B;var z=function(Xe,it){this.type=c.Syntax.MemberExpression,this.computed=!0,this.object=Xe,this.property=it};s.ComputedMemberExpression=z;var K=function(Xe,it,Qt){this.type=c.Syntax.ConditionalExpression,this.test=Xe,this.consequent=it,this.alternate=Qt};s.ConditionalExpression=K;var J=function(Xe){this.type=c.Syntax.ContinueStatement,this.label=Xe};s.ContinueStatement=J;var X=function(){this.type=c.Syntax.DebuggerStatement};s.DebuggerStatement=X;var re=function(Xe,it){this.type=c.Syntax.ExpressionStatement,this.expression=Xe,this.directive=it};s.Directive=re;var fe=function(Xe,it){this.type=c.Syntax.DoWhileStatement,this.body=Xe,this.test=it};s.DoWhileStatement=fe;var pe=function(){this.type=c.Syntax.EmptyStatement};s.EmptyStatement=pe;var ie=function(Xe){this.type=c.Syntax.ExportAllDeclaration,this.source=Xe};s.ExportAllDeclaration=ie;var te=function(Xe){this.type=c.Syntax.ExportDefaultDeclaration,this.declaration=Xe};s.ExportDefaultDeclaration=te;var ee=function(Xe,it,Qt){this.type=c.Syntax.ExportNamedDeclaration,this.declaration=Xe,this.specifiers=it,this.source=Qt};s.ExportNamedDeclaration=ee;var we=function(Xe,it){this.type=c.Syntax.ExportSpecifier,this.exported=it,this.local=Xe};s.ExportSpecifier=we;var Ce=function(Xe){this.type=c.Syntax.ExpressionStatement,this.expression=Xe};s.ExpressionStatement=Ce;var De=function(Xe,it,Qt){this.type=c.Syntax.ForInStatement,this.left=Xe,this.right=it,this.body=Qt,this.each=!1};s.ForInStatement=De;var Re=function(Xe,it,Qt){this.type=c.Syntax.ForOfStatement,this.left=Xe,this.right=it,this.body=Qt};s.ForOfStatement=Re;var Oe=function(Xe,it,Qt,Q){this.type=c.Syntax.ForStatement,this.init=Xe,this.test=it,this.update=Qt,this.body=Q};s.ForStatement=Oe;var Ve=function(Xe,it,Qt,Q){this.type=c.Syntax.FunctionDeclaration,this.id=Xe,this.params=it,this.body=Qt,this.generator=Q,this.expression=!1,this.async=!1};s.FunctionDeclaration=Ve;var Ge=function(Xe,it,Qt,Q){this.type=c.Syntax.FunctionExpression,this.id=Xe,this.params=it,this.body=Qt,this.generator=Q,this.expression=!1,this.async=!1};s.FunctionExpression=Ge;var qe=function(Xe){this.type=c.Syntax.Identifier,this.name=Xe};s.Identifier=qe;var Be=function(Xe,it,Qt){this.type=c.Syntax.IfStatement,this.test=Xe,this.consequent=it,this.alternate=Qt};s.IfStatement=Be;var ae=function(Xe,it){this.type=c.Syntax.ImportDeclaration,this.specifiers=Xe,this.source=it};s.ImportDeclaration=ae;var H=function(Xe){this.type=c.Syntax.ImportDefaultSpecifier,this.local=Xe};s.ImportDefaultSpecifier=H;var ce=function(Xe){this.type=c.Syntax.ImportNamespaceSpecifier,this.local=Xe};s.ImportNamespaceSpecifier=ce;var se=function(Xe,it){this.type=c.Syntax.ImportSpecifier,this.local=Xe,this.imported=it};s.ImportSpecifier=se;var he=function(Xe,it){this.type=c.Syntax.LabeledStatement,this.label=Xe,this.body=it};s.LabeledStatement=he;var ve=function(Xe,it){this.type=c.Syntax.Literal,this.value=Xe,this.raw=it};s.Literal=ve;var ye=function(Xe,it){this.type=c.Syntax.MetaProperty,this.meta=Xe,this.property=it};s.MetaProperty=ye;var Ae=function(Xe,it,Qt,Q,Rr){this.type=c.Syntax.MethodDefinition,this.key=Xe,this.computed=it,this.value=Qt,this.kind=Q,this.static=Rr};s.MethodDefinition=Ae;var Ue=function(Xe){this.type=c.Syntax.Program,this.body=Xe,this.sourceType="module"};s.Module=Ue;var Je=function(Xe,it){this.type=c.Syntax.NewExpression,this.callee=Xe,this.arguments=it};s.NewExpression=Je;var et=function(Xe){this.type=c.Syntax.ObjectExpression,this.properties=Xe};s.ObjectExpression=et;var lt=function(Xe){this.type=c.Syntax.ObjectPattern,this.properties=Xe};s.ObjectPattern=lt;var _t=function(Xe,it,Qt,Q,Rr,ws){this.type=c.Syntax.Property,this.key=it,this.computed=Qt,this.value=Q,this.kind=Xe,this.method=Rr,this.shorthand=ws};s.Property=_t;var nn=function(Xe,it,Qt,Q){this.type=c.Syntax.Literal,this.value=Xe,this.raw=it,this.regex={pattern:Qt,flags:Q}};s.RegexLiteral=nn;var Ot=function(Xe){this.type=c.Syntax.RestElement,this.argument=Xe};s.RestElement=Ot;var ft=function(Xe){this.type=c.Syntax.ReturnStatement,this.argument=Xe};s.ReturnStatement=ft;var _n=function(Xe){this.type=c.Syntax.Program,this.body=Xe,this.sourceType="script"};s.Script=_n;var Se=function(Xe){this.type=c.Syntax.SequenceExpression,this.expressions=Xe};s.SequenceExpression=Se;var Gt=function(Xe){this.type=c.Syntax.SpreadElement,this.argument=Xe};s.SpreadElement=Gt;var Vt=function(Xe,it){this.type=c.Syntax.MemberExpression,this.computed=!1,this.object=Xe,this.property=it};s.StaticMemberExpression=Vt;var wt=function(){this.type=c.Syntax.Super};s.Super=wt;var Fe=function(Xe,it){this.type=c.Syntax.SwitchCase,this.test=Xe,this.consequent=it};s.SwitchCase=Fe;var Qe=function(Xe,it){this.type=c.Syntax.SwitchStatement,this.discriminant=Xe,this.cases=it};s.SwitchStatement=Qe;var ze=function(Xe,it){this.type=c.Syntax.TaggedTemplateExpression,this.tag=Xe,this.quasi=it};s.TaggedTemplateExpression=ze;var je=function(Xe,it){this.type=c.Syntax.TemplateElement,this.value=Xe,this.tail=it};s.TemplateElement=je;var rt=function(Xe,it){this.type=c.Syntax.TemplateLiteral,this.quasis=Xe,this.expressions=it};s.TemplateLiteral=rt;var dt=function(){this.type=c.Syntax.ThisExpression};s.ThisExpression=dt;var ht=function(Xe){this.type=c.Syntax.ThrowStatement,this.argument=Xe};s.ThrowStatement=ht;var mt=function(Xe,it,Qt){this.type=c.Syntax.TryStatement,this.block=Xe,this.handler=it,this.finalizer=Qt};s.TryStatement=mt;var At=function(Xe,it){this.type=c.Syntax.UnaryExpression,this.operator=Xe,this.argument=it,this.prefix=!0};s.UnaryExpression=At;var kn=function(Xe,it,Qt){this.type=c.Syntax.UpdateExpression,this.operator=Xe,this.argument=it,this.prefix=Qt};s.UpdateExpression=kn;var Kn=function(Xe,it){this.type=c.Syntax.VariableDeclaration,this.declarations=Xe,this.kind=it};s.VariableDeclaration=Kn;var Xt=function(Xe,it){this.type=c.Syntax.VariableDeclarator,this.id=Xe,this.init=it};s.VariableDeclarator=Xt;var j=function(Xe,it){this.type=c.Syntax.WhileStatement,this.test=Xe,this.body=it};s.WhileStatement=j;var zi=function(Xe,it){this.type=c.Syntax.WithStatement,this.object=Xe,this.body=it};s.WithStatement=zi;var $=function(Xe,it){this.type=c.Syntax.YieldExpression,this.argument=Xe,this.delegate=it};s.YieldExpression=$},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(9),d=l(10),f=l(11),h=l(7),p=l(12),C=l(2),x=l(13),T=function(){function _(y,w,b){w===void 0&&(w={}),this.config={range:typeof w.range=="boolean"&&w.range,loc:typeof w.loc=="boolean"&&w.loc,source:null,tokens:typeof w.tokens=="boolean"&&w.tokens,comment:typeof w.comment=="boolean"&&w.comment,tolerant:typeof w.tolerant=="boolean"&&w.tolerant},this.config.loc&&w.source&&w.source!==null&&(this.config.source=String(w.source)),this.delegate=b,this.errorHandler=new d.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new p.Scanner(y,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return _.prototype.throwError=function(y){for(var w=[],b=1;b<arguments.length;b++)w[b-1]=arguments[b];var M=Array.prototype.slice.call(arguments,1),I=y.replace(/%(\d)/g,function(B,z){return c.assert(z<M.length,"Message reference must be in range"),M[z]}),A=this.lastMarker.index,k=this.lastMarker.line,U=this.lastMarker.column+1;throw this.errorHandler.createError(A,k,U,I)},_.prototype.tolerateError=function(y){for(var w=[],b=1;b<arguments.length;b++)w[b-1]=arguments[b];var M=Array.prototype.slice.call(arguments,1),I=y.replace(/%(\d)/g,function(B,z){return c.assert(z<M.length,"Message reference must be in range"),M[z]}),A=this.lastMarker.index,k=this.scanner.lineNumber,U=this.lastMarker.column+1;this.errorHandler.tolerateError(A,k,U,I)},_.prototype.unexpectedTokenError=function(y,w){var b,M=w||f.Messages.UnexpectedToken;if(y?(w||(M=y.type===2?f.Messages.UnexpectedEOS:y.type===3?f.Messages.UnexpectedIdentifier:y.type===6?f.Messages.UnexpectedNumber:y.type===8?f.Messages.UnexpectedString:y.type===10?f.Messages.UnexpectedTemplate:f.Messages.UnexpectedToken,y.type===4&&(this.scanner.isFutureReservedWord(y.value)?M=f.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(y.value)&&(M=f.Messages.StrictReservedWord))),b=y.value):b="ILLEGAL",M=M.replace("%0",b),y&&typeof y.lineNumber=="number"){var I=y.start,A=y.lineNumber,k=this.lastMarker.index-this.lastMarker.column,U=y.start-k+1;return this.errorHandler.createError(I,A,U,M)}return I=this.lastMarker.index,A=this.lastMarker.line,U=this.lastMarker.column+1,this.errorHandler.createError(I,A,U,M)},_.prototype.throwUnexpectedToken=function(y,w){throw this.unexpectedTokenError(y,w)},_.prototype.tolerateUnexpectedToken=function(y,w){this.errorHandler.tolerate(this.unexpectedTokenError(y,w))},_.prototype.collectComments=function(){if(this.config.comment){var y=this.scanner.scanComments();if(y.length>0&&this.delegate)for(var w=0;w<y.length;++w){var b=y[w],M=void 0;M={type:b.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(b.slice[0],b.slice[1])},this.config.range&&(M.range=b.range),this.config.loc&&(M.loc=b.loc);var I={start:{line:b.loc.start.line,column:b.loc.start.column,offset:b.range[0]},end:{line:b.loc.end.line,column:b.loc.end.column,offset:b.range[1]}};this.delegate(M,I)}}else this.scanner.scanComments()},_.prototype.getTokenRaw=function(y){return this.scanner.source.slice(y.start,y.end)},_.prototype.convertToken=function(y){var w={type:x.TokenName[y.type],value:this.getTokenRaw(y)};if(this.config.range&&(w.range=[y.start,y.end]),this.config.loc&&(w.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),y.type===9){var b=y.pattern,M=y.flags;w.regex={pattern:b,flags:M}}return w},_.prototype.nextToken=function(){var y=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var w=this.scanner.lex();return this.hasLineTerminator=y.lineNumber!==w.lineNumber,w&&this.context.strict&&w.type===3&&this.scanner.isStrictModeReservedWord(w.value)&&(w.type=4),this.lookahead=w,this.config.tokens&&w.type!==2&&this.tokens.push(this.convertToken(w)),y},_.prototype.nextRegexToken=function(){this.collectComments();var y=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(y))),this.lookahead=y,this.nextToken(),y},_.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},_.prototype.startNode=function(y,w){w===void 0&&(w=0);var b=y.start-y.lineStart,M=y.lineNumber;return b<0&&(b+=w,M--),{index:y.start,line:M,column:b}},_.prototype.finalize=function(y,w){if(this.config.range&&(w.range=[y.index,this.lastMarker.index]),this.config.loc&&(w.loc={start:{line:y.line,column:y.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(w.loc.source=this.config.source)),this.delegate){var b={start:{line:y.line,column:y.column,offset:y.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(w,b)}return w},_.prototype.expect=function(y){var w=this.nextToken();w.type===7&&w.value===y||this.throwUnexpectedToken(w)},_.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var y=this.lookahead;y.type===7&&y.value===","?this.nextToken():y.type===7&&y.value===";"?(this.nextToken(),this.tolerateUnexpectedToken(y)):this.tolerateUnexpectedToken(y,f.Messages.UnexpectedToken)}else this.expect(",")},_.prototype.expectKeyword=function(y){var w=this.nextToken();w.type===4&&w.value===y||this.throwUnexpectedToken(w)},_.prototype.match=function(y){return this.lookahead.type===7&&this.lookahead.value===y},_.prototype.matchKeyword=function(y){return this.lookahead.type===4&&this.lookahead.value===y},_.prototype.matchContextualKeyword=function(y){return this.lookahead.type===3&&this.lookahead.value===y},_.prototype.matchAssign=function(){if(this.lookahead.type!==7)return!1;var y=this.lookahead.value;return y==="="||y==="*="||y==="**="||y==="/="||y==="%="||y==="+="||y==="-="||y==="<<="||y===">>="||y===">>>="||y==="&="||y==="^="||y==="|="},_.prototype.isolateCoverGrammar=function(y){var w=this.context.isBindingElement,b=this.context.isAssignmentTarget,M=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var I=y.call(this);return this.context.firstCoverInitializedNameError!==null&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=w,this.context.isAssignmentTarget=b,this.context.firstCoverInitializedNameError=M,I},_.prototype.inheritCoverGrammar=function(y){var w=this.context.isBindingElement,b=this.context.isAssignmentTarget,M=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var I=y.call(this);return this.context.isBindingElement=this.context.isBindingElement&&w,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&b,this.context.firstCoverInitializedNameError=M||this.context.firstCoverInitializedNameError,I},_.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===2||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},_.prototype.parsePrimaryExpression=function(){var y,w,b,M=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&this.lookahead.value==="await"&&this.tolerateUnexpectedToken(this.lookahead),y=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(M,new h.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,f.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,w=this.nextToken(),b=this.getTokenRaw(w),y=this.finalize(M,new h.Literal(w.value,b));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,w=this.nextToken(),b=this.getTokenRaw(w),y=this.finalize(M,new h.Literal(w.value==="true",b));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,w=this.nextToken(),b=this.getTokenRaw(w),y=this.finalize(M,new h.Literal(null,b));break;case 10:y=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,y=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":y=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":y=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,w=this.nextRegexToken(),b=this.getTokenRaw(w),y=this.finalize(M,new h.RegexLiteral(w.regex,b,w.pattern,w.flags));break;default:y=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?y=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?y=this.finalize(M,new h.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?y=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),y=this.finalize(M,new h.ThisExpression)):y=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:y=this.throwUnexpectedToken(this.nextToken())}return y},_.prototype.parseSpreadElement=function(){var y=this.createNode();this.expect("...");var w=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(y,new h.SpreadElement(w))},_.prototype.parseArrayInitializer=function(){var y=this.createNode(),w=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),w.push(null);else if(this.match("...")){var b=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),w.push(b)}else w.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(y,new h.ArrayExpression(w))},_.prototype.parsePropertyMethod=function(y){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var w=this.context.strict,b=this.context.allowStrictDirective;this.context.allowStrictDirective=y.simple;var M=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&y.firstRestricted&&this.tolerateUnexpectedToken(y.firstRestricted,y.message),this.context.strict&&y.stricted&&this.tolerateUnexpectedToken(y.stricted,y.message),this.context.strict=w,this.context.allowStrictDirective=b,M},_.prototype.parsePropertyMethodFunction=function(){var y=this.createNode(),w=this.context.allowYield;this.context.allowYield=!0;var b=this.parseFormalParameters(),M=this.parsePropertyMethod(b);return this.context.allowYield=w,this.finalize(y,new h.FunctionExpression(null,b.params,M,!1))},_.prototype.parsePropertyMethodAsyncFunction=function(){var y=this.createNode(),w=this.context.allowYield,b=this.context.await;this.context.allowYield=!1,this.context.await=!0;var M=this.parseFormalParameters(),I=this.parsePropertyMethod(M);return this.context.allowYield=w,this.context.await=b,this.finalize(y,new h.AsyncFunctionExpression(null,M.params,I))},_.prototype.parseObjectPropertyKey=function(){var y,w=this.createNode(),b=this.nextToken();switch(b.type){case 8:case 6:this.context.strict&&b.octal&&this.tolerateUnexpectedToken(b,f.Messages.StrictOctalLiteral);var M=this.getTokenRaw(b);y=this.finalize(w,new h.Literal(b.value,M));break;case 3:case 1:case 5:case 4:y=this.finalize(w,new h.Identifier(b.value));break;case 7:b.value==="["?(y=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):y=this.throwUnexpectedToken(b);break;default:y=this.throwUnexpectedToken(b)}return y},_.prototype.isPropertyKey=function(y,w){return y.type===C.Syntax.Identifier&&y.name===w||y.type===C.Syntax.Literal&&y.value===w},_.prototype.parseObjectProperty=function(y){var w,b=this.createNode(),M=this.lookahead,I=null,A=null,k=!1,U=!1,B=!1,z=!1;if(M.type===3){var K=M.value;this.nextToken(),k=this.match("["),I=(z=!(this.hasLineTerminator||K!=="async"||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(b,new h.Identifier(K))}else this.match("*")?this.nextToken():(k=this.match("["),I=this.parseObjectPropertyKey());var J=this.qualifiedPropertyName(this.lookahead);if(M.type===3&&!z&&M.value==="get"&&J)w="get",k=this.match("["),I=this.parseObjectPropertyKey(),this.context.allowYield=!1,A=this.parseGetterMethod();else if(M.type===3&&!z&&M.value==="set"&&J)w="set",k=this.match("["),I=this.parseObjectPropertyKey(),A=this.parseSetterMethod();else if(M.type===7&&M.value==="*"&&J)w="init",k=this.match("["),I=this.parseObjectPropertyKey(),A=this.parseGeneratorMethod(),U=!0;else if(I||this.throwUnexpectedToken(this.lookahead),w="init",this.match(":")&&!z)!k&&this.isPropertyKey(I,"__proto__")&&(y.value&&this.tolerateError(f.Messages.DuplicateProtoProperty),y.value=!0),this.nextToken(),A=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))A=z?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),U=!0;else if(M.type===3)if(K=this.finalize(b,new h.Identifier(M.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),B=!0;var X=this.isolateCoverGrammar(this.parseAssignmentExpression);A=this.finalize(b,new h.AssignmentPattern(K,X))}else B=!0,A=K;else this.throwUnexpectedToken(this.nextToken());return this.finalize(b,new h.Property(w,I,k,A,U,B))},_.prototype.parseObjectInitializer=function(){var y=this.createNode();this.expect("{");for(var w=[],b={value:!1};!this.match("}");)w.push(this.parseObjectProperty(b)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(y,new h.ObjectExpression(w))},_.prototype.parseTemplateHead=function(){c.assert(this.lookahead.head,"Template literal must start with a template head");var y=this.createNode(),w=this.nextToken(),b=w.value,M=w.cooked;return this.finalize(y,new h.TemplateElement({raw:b,cooked:M},w.tail))},_.prototype.parseTemplateElement=function(){this.lookahead.type!==10&&this.throwUnexpectedToken();var y=this.createNode(),w=this.nextToken(),b=w.value,M=w.cooked;return this.finalize(y,new h.TemplateElement({raw:b,cooked:M},w.tail))},_.prototype.parseTemplateLiteral=function(){var y=this.createNode(),w=[],b=[],M=this.parseTemplateHead();for(b.push(M);!M.tail;)w.push(this.parseExpression()),M=this.parseTemplateElement(),b.push(M);return this.finalize(y,new h.TemplateLiteral(b,w))},_.prototype.reinterpretExpressionAsPattern=function(y){switch(y.type){case C.Syntax.Identifier:case C.Syntax.MemberExpression:case C.Syntax.RestElement:case C.Syntax.AssignmentPattern:break;case C.Syntax.SpreadElement:y.type=C.Syntax.RestElement,this.reinterpretExpressionAsPattern(y.argument);break;case C.Syntax.ArrayExpression:y.type=C.Syntax.ArrayPattern;for(var w=0;w<y.elements.length;w++)y.elements[w]!==null&&this.reinterpretExpressionAsPattern(y.elements[w]);break;case C.Syntax.ObjectExpression:for(y.type=C.Syntax.ObjectPattern,w=0;w<y.properties.length;w++)this.reinterpretExpressionAsPattern(y.properties[w].value);break;case C.Syntax.AssignmentExpression:y.type=C.Syntax.AssignmentPattern,delete y.operator,this.reinterpretExpressionAsPattern(y.left)}},_.prototype.parseGroupExpression=function(){var y;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),y={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var w=this.lookahead,b=[];if(this.match("..."))y=this.parseRestElement(b),this.expect(")"),this.match("=>")||this.expect("=>"),y={type:"ArrowParameterPlaceHolder",params:[y],async:!1};else{var M=!1;if(this.context.isBindingElement=!0,y=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var I=[];for(this.context.isAssignmentTarget=!1,I.push(y);this.lookahead.type!==2&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var A=0;A<I.length;A++)this.reinterpretExpressionAsPattern(I[A]);M=!0,y={type:"ArrowParameterPlaceHolder",params:I,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),I.push(this.parseRestElement(b)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,A=0;A<I.length;A++)this.reinterpretExpressionAsPattern(I[A]);M=!0,y={type:"ArrowParameterPlaceHolder",params:I,async:!1}}else I.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(M)break}M||(y=this.finalize(this.startNode(w),new h.SequenceExpression(I)))}if(!M){if(this.expect(")"),this.match("=>")&&(y.type===C.Syntax.Identifier&&y.name==="yield"&&(M=!0,y={type:"ArrowParameterPlaceHolder",params:[y],async:!1}),!M)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),y.type===C.Syntax.SequenceExpression)for(A=0;A<y.expressions.length;A++)this.reinterpretExpressionAsPattern(y.expressions[A]);else this.reinterpretExpressionAsPattern(y);y={type:"ArrowParameterPlaceHolder",params:y.type===C.Syntax.SequenceExpression?y.expressions:[y],async:!1}}this.context.isBindingElement=!1}}}return y},_.prototype.parseArguments=function(){this.expect("(");var y=[];if(!this.match(")"))for(;;){var w=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(y.push(w),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),y},_.prototype.isIdentifierName=function(y){return y.type===3||y.type===4||y.type===1||y.type===5},_.prototype.parseIdentifierName=function(){var y=this.createNode(),w=this.nextToken();return this.isIdentifierName(w)||this.throwUnexpectedToken(w),this.finalize(y,new h.Identifier(w.value))},_.prototype.parseNewExpression=function(){var y,w=this.createNode(),b=this.parseIdentifierName();if(c.assert(b.name==="new","New expression must start with `new`"),this.match("."))if(this.nextToken(),this.lookahead.type===3&&this.context.inFunctionBody&&this.lookahead.value==="target"){var M=this.parseIdentifierName();y=new h.MetaProperty(b,M)}else this.throwUnexpectedToken(this.lookahead);else{var I=this.isolateCoverGrammar(this.parseLeftHandSideExpression),A=this.match("(")?this.parseArguments():[];y=new h.NewExpression(I,A),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(w,y)},_.prototype.parseAsyncArgument=function(){var y=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,y},_.prototype.parseAsyncArguments=function(){this.expect("(");var y=[];if(!this.match(")"))for(;;){var w=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(y.push(w),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),y},_.prototype.parseLeftHandSideExpressionAllowCall=function(){var y,w=this.lookahead,b=this.matchContextualKeyword("async"),M=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(y=this.createNode(),this.nextToken(),y=this.finalize(y,new h.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):y=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var I=this.parseIdentifierName();y=this.finalize(this.startNode(w),new h.StaticMemberExpression(y,I))}else if(this.match("(")){var A=b&&w.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var k=A?this.parseAsyncArguments():this.parseArguments();if(y=this.finalize(this.startNode(w),new h.CallExpression(y,k)),A&&this.match("=>")){for(var U=0;U<k.length;++U)this.reinterpretExpressionAsPattern(k[U]);y={type:"ArrowParameterPlaceHolder",params:k,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),I=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),y=this.finalize(this.startNode(w),new h.ComputedMemberExpression(y,I));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var B=this.parseTemplateLiteral();y=this.finalize(this.startNode(w),new h.TaggedTemplateExpression(y,B))}return this.context.allowIn=M,y},_.prototype.parseSuper=function(){var y=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(y,new h.Super)},_.prototype.parseLeftHandSideExpression=function(){c.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var y=this.startNode(this.lookahead),w=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var b=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),w=this.finalize(y,new h.ComputedMemberExpression(w,b))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),b=this.parseIdentifierName(),w=this.finalize(y,new h.StaticMemberExpression(w,b));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var M=this.parseTemplateLiteral();w=this.finalize(y,new h.TaggedTemplateExpression(w,M))}return w},_.prototype.parseUpdateExpression=function(){var y,w=this.lookahead;if(this.match("++")||this.match("--")){var b=this.startNode(w),M=this.nextToken();y=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&y.type===C.Syntax.Identifier&&this.scanner.isRestrictedWord(y.name)&&this.tolerateError(f.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(f.Messages.InvalidLHSInAssignment);var I=!0;y=this.finalize(b,new h.UpdateExpression(M.value,y,I)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(y=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===7&&(this.match("++")||this.match("--"))){this.context.strict&&y.type===C.Syntax.Identifier&&this.scanner.isRestrictedWord(y.name)&&this.tolerateError(f.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(f.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var A=this.nextToken().value;I=!1,y=this.finalize(this.startNode(w),new h.UpdateExpression(A,y,I))}return y},_.prototype.parseAwaitExpression=function(){var y=this.createNode();this.nextToken();var w=this.parseUnaryExpression();return this.finalize(y,new h.AwaitExpression(w))},_.prototype.parseUnaryExpression=function(){var y;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var w=this.startNode(this.lookahead),b=this.nextToken();y=this.inheritCoverGrammar(this.parseUnaryExpression),y=this.finalize(w,new h.UnaryExpression(b.value,y)),this.context.strict&&y.operator==="delete"&&y.argument.type===C.Syntax.Identifier&&this.tolerateError(f.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else y=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return y},_.prototype.parseExponentiationExpression=function(){var y=this.lookahead,w=this.inheritCoverGrammar(this.parseUnaryExpression);if(w.type!==C.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var b=w,M=this.isolateCoverGrammar(this.parseExponentiationExpression);w=this.finalize(this.startNode(y),new h.BinaryExpression("**",b,M))}return w},_.prototype.binaryPrecedence=function(y){var w=y.value;return y.type===7?this.operatorPrecedence[w]||0:y.type===4&&(w==="instanceof"||this.context.allowIn&&w==="in")?7:0},_.prototype.parseBinaryExpression=function(){var y=this.lookahead,w=this.inheritCoverGrammar(this.parseExponentiationExpression),b=this.lookahead,M=this.binaryPrecedence(b);if(M>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var I=[y,this.lookahead],A=w,k=this.isolateCoverGrammar(this.parseExponentiationExpression),U=[A,b.value,k],B=[M];!((M=this.binaryPrecedence(this.lookahead))<=0);){for(;U.length>2&&M<=B[B.length-1];){k=U.pop();var z=U.pop();B.pop(),A=U.pop(),I.pop();var K=this.startNode(I[I.length-1]);U.push(this.finalize(K,new h.BinaryExpression(z,A,k)))}U.push(this.nextToken().value),B.push(M),I.push(this.lookahead),U.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var J=U.length-1;w=U[J];for(var X=I.pop();J>1;){var re=I.pop(),fe=X&&X.lineStart;K=this.startNode(re,fe),z=U[J-1],w=this.finalize(K,new h.BinaryExpression(z,U[J-2],w)),J-=2,X=re}}return w},_.prototype.parseConditionalExpression=function(){var y=this.lookahead,w=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var b=this.context.allowIn;this.context.allowIn=!0;var M=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=b,this.expect(":");var I=this.isolateCoverGrammar(this.parseAssignmentExpression);w=this.finalize(this.startNode(y),new h.ConditionalExpression(w,M,I)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return w},_.prototype.checkPatternParam=function(y,w){switch(w.type){case C.Syntax.Identifier:this.validateParam(y,w,w.name);break;case C.Syntax.RestElement:this.checkPatternParam(y,w.argument);break;case C.Syntax.AssignmentPattern:this.checkPatternParam(y,w.left);break;case C.Syntax.ArrayPattern:for(var b=0;b<w.elements.length;b++)w.elements[b]!==null&&this.checkPatternParam(y,w.elements[b]);break;case C.Syntax.ObjectPattern:for(b=0;b<w.properties.length;b++)this.checkPatternParam(y,w.properties[b].value)}y.simple=y.simple&&w instanceof h.Identifier},_.prototype.reinterpretAsCoverFormalsList=function(y){var w,b=[y],M=!1;switch(y.type){case C.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":b=y.params,M=y.async;break;default:return null}w={simple:!0,paramSet:{}};for(var I=0;I<b.length;++I)(A=b[I]).type===C.Syntax.AssignmentPattern?A.right.type===C.Syntax.YieldExpression&&(A.right.argument&&this.throwUnexpectedToken(this.lookahead),A.right.type=C.Syntax.Identifier,A.right.name="yield",delete A.right.argument,delete A.right.delegate):M&&A.type===C.Syntax.Identifier&&A.name==="await"&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(w,A),b[I]=A;if(this.context.strict||!this.context.allowYield)for(I=0;I<b.length;++I){var A;(A=b[I]).type===C.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(w.message===f.Messages.StrictParamDupe){var k=this.context.strict?w.stricted:w.firstRestricted;this.throwUnexpectedToken(k,w.message)}return{simple:w.simple,params:b,stricted:w.stricted,firstRestricted:w.firstRestricted,message:w.message}},_.prototype.parseAssignmentExpression=function(){var y;if(!this.context.allowYield&&this.matchKeyword("yield"))y=this.parseYieldExpression();else{var w=this.lookahead,b=w;if(y=this.parseConditionalExpression(),b.type===3&&b.lineNumber===this.lookahead.lineNumber&&b.value==="async"&&(this.lookahead.type===3||this.matchKeyword("yield"))){var M=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(M),y={type:"ArrowParameterPlaceHolder",params:[M],async:!0}}if(y.type==="ArrowParameterPlaceHolder"||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var I=y.async,A=this.reinterpretAsCoverFormalsList(y);if(A){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var k=this.context.strict,U=this.context.allowStrictDirective;this.context.allowStrictDirective=A.simple;var B=this.context.allowYield,z=this.context.await;this.context.allowYield=!0,this.context.await=I;var K=this.startNode(w);this.expect("=>");var J=void 0;if(this.match("{")){var X=this.context.allowIn;this.context.allowIn=!0,J=this.parseFunctionSourceElements(),this.context.allowIn=X}else J=this.isolateCoverGrammar(this.parseAssignmentExpression);var re=J.type!==C.Syntax.BlockStatement;this.context.strict&&A.firstRestricted&&this.throwUnexpectedToken(A.firstRestricted,A.message),this.context.strict&&A.stricted&&this.tolerateUnexpectedToken(A.stricted,A.message),y=I?this.finalize(K,new h.AsyncArrowFunctionExpression(A.params,J,re)):this.finalize(K,new h.ArrowFunctionExpression(A.params,J,re)),this.context.strict=k,this.context.allowStrictDirective=U,this.context.allowYield=B,this.context.await=z}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(f.Messages.InvalidLHSInAssignment),this.context.strict&&y.type===C.Syntax.Identifier){var fe=y;this.scanner.isRestrictedWord(fe.name)&&this.tolerateUnexpectedToken(b,f.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(fe.name)&&this.tolerateUnexpectedToken(b,f.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(y):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var pe=(b=this.nextToken()).value,ie=this.isolateCoverGrammar(this.parseAssignmentExpression);y=this.finalize(this.startNode(w),new h.AssignmentExpression(pe,y,ie)),this.context.firstCoverInitializedNameError=null}}return y},_.prototype.parseExpression=function(){var y=this.lookahead,w=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var b=[];for(b.push(w);this.lookahead.type!==2&&this.match(",");)this.nextToken(),b.push(this.isolateCoverGrammar(this.parseAssignmentExpression));w=this.finalize(this.startNode(y),new h.SequenceExpression(b))}return w},_.prototype.parseStatementListItem=function(){var y;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,this.lookahead.type===4)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,f.Messages.IllegalExportDeclaration),y=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,f.Messages.IllegalImportDeclaration),y=this.parseImportDeclaration();break;case"const":y=this.parseLexicalDeclaration({inFor:!1});break;case"function":y=this.parseFunctionDeclaration();break;case"class":y=this.parseClassDeclaration();break;case"let":y=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:y=this.parseStatement()}else y=this.parseStatement();return y},_.prototype.parseBlock=function(){var y=this.createNode();this.expect("{");for(var w=[];!this.match("}");)w.push(this.parseStatementListItem());return this.expect("}"),this.finalize(y,new h.BlockStatement(w))},_.prototype.parseLexicalBinding=function(y,w){var b=this.createNode(),M=this.parsePattern([],y);this.context.strict&&M.type===C.Syntax.Identifier&&this.scanner.isRestrictedWord(M.name)&&this.tolerateError(f.Messages.StrictVarName);var I=null;return y==="const"?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),I=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(f.Messages.DeclarationMissingInitializer,"const")):(!w.inFor&&M.type!==C.Syntax.Identifier||this.match("="))&&(this.expect("="),I=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(b,new h.VariableDeclarator(M,I))},_.prototype.parseBindingList=function(y,w){for(var b=[this.parseLexicalBinding(y,w)];this.match(",");)this.nextToken(),b.push(this.parseLexicalBinding(y,w));return b},_.prototype.isLexicalDeclaration=function(){var y=this.scanner.saveState();this.scanner.scanComments();var w=this.scanner.lex();return this.scanner.restoreState(y),w.type===3||w.type===7&&w.value==="["||w.type===7&&w.value==="{"||w.type===4&&w.value==="let"||w.type===4&&w.value==="yield"},_.prototype.parseLexicalDeclaration=function(y){var w=this.createNode(),b=this.nextToken().value;c.assert(b==="let"||b==="const","Lexical declaration must be either let or const");var M=this.parseBindingList(b,y);return this.consumeSemicolon(),this.finalize(w,new h.VariableDeclaration(M,b))},_.prototype.parseBindingRestElement=function(y,w){var b=this.createNode();this.expect("...");var M=this.parsePattern(y,w);return this.finalize(b,new h.RestElement(M))},_.prototype.parseArrayPattern=function(y,w){var b=this.createNode();this.expect("[");for(var M=[];!this.match("]");)if(this.match(","))this.nextToken(),M.push(null);else{if(this.match("...")){M.push(this.parseBindingRestElement(y,w));break}M.push(this.parsePatternWithDefault(y,w)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(b,new h.ArrayPattern(M))},_.prototype.parsePropertyPattern=function(y,w){var b,M,I=this.createNode(),A=!1,k=!1;if(this.lookahead.type===3){var U=this.lookahead;b=this.parseVariableIdentifier();var B=this.finalize(I,new h.Identifier(U.value));if(this.match("=")){y.push(U),k=!0,this.nextToken();var z=this.parseAssignmentExpression();M=this.finalize(this.startNode(U),new h.AssignmentPattern(B,z))}else this.match(":")?(this.expect(":"),M=this.parsePatternWithDefault(y,w)):(y.push(U),k=!0,M=B)}else A=this.match("["),b=this.parseObjectPropertyKey(),this.expect(":"),M=this.parsePatternWithDefault(y,w);return this.finalize(I,new h.Property("init",b,A,M,!1,k))},_.prototype.parseObjectPattern=function(y,w){var b=this.createNode(),M=[];for(this.expect("{");!this.match("}");)M.push(this.parsePropertyPattern(y,w)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(b,new h.ObjectPattern(M))},_.prototype.parsePattern=function(y,w){var b;return this.match("[")?b=this.parseArrayPattern(y,w):this.match("{")?b=this.parseObjectPattern(y,w):(!this.matchKeyword("let")||w!=="const"&&w!=="let"||this.tolerateUnexpectedToken(this.lookahead,f.Messages.LetInLexicalBinding),y.push(this.lookahead),b=this.parseVariableIdentifier(w)),b},_.prototype.parsePatternWithDefault=function(y,w){var b=this.lookahead,M=this.parsePattern(y,w);if(this.match("=")){this.nextToken();var I=this.context.allowYield;this.context.allowYield=!0;var A=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=I,M=this.finalize(this.startNode(b),new h.AssignmentPattern(M,A))}return M},_.prototype.parseVariableIdentifier=function(y){var w=this.createNode(),b=this.nextToken();return b.type===4&&b.value==="yield"?this.context.strict?this.tolerateUnexpectedToken(b,f.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(b):b.type!==3?this.context.strict&&b.type===4&&this.scanner.isStrictModeReservedWord(b.value)?this.tolerateUnexpectedToken(b,f.Messages.StrictReservedWord):(this.context.strict||b.value!=="let"||y!=="var")&&this.throwUnexpectedToken(b):(this.context.isModule||this.context.await)&&b.type===3&&b.value==="await"&&this.tolerateUnexpectedToken(b),this.finalize(w,new h.Identifier(b.value))},_.prototype.parseVariableDeclaration=function(y){var w=this.createNode(),b=this.parsePattern([],"var");this.context.strict&&b.type===C.Syntax.Identifier&&this.scanner.isRestrictedWord(b.name)&&this.tolerateError(f.Messages.StrictVarName);var M=null;return this.match("=")?(this.nextToken(),M=this.isolateCoverGrammar(this.parseAssignmentExpression)):b.type===C.Syntax.Identifier||y.inFor||this.expect("="),this.finalize(w,new h.VariableDeclarator(b,M))},_.prototype.parseVariableDeclarationList=function(y){var w={inFor:y.inFor},b=[];for(b.push(this.parseVariableDeclaration(w));this.match(",");)this.nextToken(),b.push(this.parseVariableDeclaration(w));return b},_.prototype.parseVariableStatement=function(){var y=this.createNode();this.expectKeyword("var");var w=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(y,new h.VariableDeclaration(w,"var"))},_.prototype.parseEmptyStatement=function(){var y=this.createNode();return this.expect(";"),this.finalize(y,new h.EmptyStatement)},_.prototype.parseExpressionStatement=function(){var y=this.createNode(),w=this.parseExpression();return this.consumeSemicolon(),this.finalize(y,new h.ExpressionStatement(w))},_.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(f.Messages.StrictFunction),this.parseStatement()},_.prototype.parseIfStatement=function(){var y,w=this.createNode(),b=null;this.expectKeyword("if"),this.expect("(");var M=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),y=this.finalize(this.createNode(),new h.EmptyStatement)):(this.expect(")"),y=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),b=this.parseIfClause())),this.finalize(w,new h.IfStatement(M,y,b))},_.prototype.parseDoWhileStatement=function(){var y=this.createNode();this.expectKeyword("do");var w=this.context.inIteration;this.context.inIteration=!0;var b=this.parseStatement();this.context.inIteration=w,this.expectKeyword("while"),this.expect("(");var M=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(y,new h.DoWhileStatement(b,M))},_.prototype.parseWhileStatement=function(){var y,w=this.createNode();this.expectKeyword("while"),this.expect("(");var b=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),y=this.finalize(this.createNode(),new h.EmptyStatement);else{this.expect(")");var M=this.context.inIteration;this.context.inIteration=!0,y=this.parseStatement(),this.context.inIteration=M}return this.finalize(w,new h.WhileStatement(b,y))},_.prototype.parseForStatement=function(){var y,w,b,M=null,I=null,A=null,k=!0,U=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){M=this.createNode(),this.nextToken();var B=this.context.allowIn;this.context.allowIn=!1;var z=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=B,z.length===1&&this.matchKeyword("in")){var K=z[0];K.init&&(K.id.type===C.Syntax.ArrayPattern||K.id.type===C.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(f.Messages.ForInOfLoopInitializer,"for-in"),M=this.finalize(M,new h.VariableDeclaration(z,"var")),this.nextToken(),y=M,w=this.parseExpression(),M=null}else z.length===1&&z[0].init===null&&this.matchContextualKeyword("of")?(M=this.finalize(M,new h.VariableDeclaration(z,"var")),this.nextToken(),y=M,w=this.parseAssignmentExpression(),M=null,k=!1):(M=this.finalize(M,new h.VariableDeclaration(z,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){M=this.createNode();var J=this.nextToken().value;this.context.strict||this.lookahead.value!=="in"?(B=this.context.allowIn,this.context.allowIn=!1,z=this.parseBindingList(J,{inFor:!0}),this.context.allowIn=B,z.length===1&&z[0].init===null&&this.matchKeyword("in")?(M=this.finalize(M,new h.VariableDeclaration(z,J)),this.nextToken(),y=M,w=this.parseExpression(),M=null):z.length===1&&z[0].init===null&&this.matchContextualKeyword("of")?(M=this.finalize(M,new h.VariableDeclaration(z,J)),this.nextToken(),y=M,w=this.parseAssignmentExpression(),M=null,k=!1):(this.consumeSemicolon(),M=this.finalize(M,new h.VariableDeclaration(z,J)))):(M=this.finalize(M,new h.Identifier(J)),this.nextToken(),y=M,w=this.parseExpression(),M=null)}else{var X=this.lookahead;if(B=this.context.allowIn,this.context.allowIn=!1,M=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=B,this.matchKeyword("in"))this.context.isAssignmentTarget&&M.type!==C.Syntax.AssignmentExpression||this.tolerateError(f.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(M),y=M,w=this.parseExpression(),M=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&M.type!==C.Syntax.AssignmentExpression||this.tolerateError(f.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(M),y=M,w=this.parseAssignmentExpression(),M=null,k=!1;else{if(this.match(",")){for(var re=[M];this.match(",");)this.nextToken(),re.push(this.isolateCoverGrammar(this.parseAssignmentExpression));M=this.finalize(this.startNode(X),new h.SequenceExpression(re))}this.expect(";")}}if(y===void 0&&(this.match(";")||(I=this.parseExpression()),this.expect(";"),this.match(")")||(A=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),b=this.finalize(this.createNode(),new h.EmptyStatement);else{this.expect(")");var fe=this.context.inIteration;this.context.inIteration=!0,b=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=fe}return y===void 0?this.finalize(U,new h.ForStatement(M,I,A,b)):k?this.finalize(U,new h.ForInStatement(y,w,b)):this.finalize(U,new h.ForOfStatement(y,w,b))},_.prototype.parseContinueStatement=function(){var y=this.createNode();this.expectKeyword("continue");var w=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var b=this.parseVariableIdentifier();w=b;var M="$"+b.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,M)||this.throwError(f.Messages.UnknownLabel,b.name)}return this.consumeSemicolon(),w!==null||this.context.inIteration||this.throwError(f.Messages.IllegalContinue),this.finalize(y,new h.ContinueStatement(w))},_.prototype.parseBreakStatement=function(){var y=this.createNode();this.expectKeyword("break");var w=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var b=this.parseVariableIdentifier(),M="$"+b.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,M)||this.throwError(f.Messages.UnknownLabel,b.name),w=b}return this.consumeSemicolon(),w!==null||this.context.inIteration||this.context.inSwitch||this.throwError(f.Messages.IllegalBreak),this.finalize(y,new h.BreakStatement(w))},_.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(f.Messages.IllegalReturn);var y=this.createNode();this.expectKeyword("return");var w=(this.match(";")||this.match("}")||this.hasLineTerminator||this.lookahead.type===2)&&this.lookahead.type!==8&&this.lookahead.type!==10?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(y,new h.ReturnStatement(w))},_.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(f.Messages.StrictModeWith);var y,w=this.createNode();this.expectKeyword("with"),this.expect("(");var b=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),y=this.finalize(this.createNode(),new h.EmptyStatement)):(this.expect(")"),y=this.parseStatement()),this.finalize(w,new h.WithStatement(b,y))},_.prototype.parseSwitchCase=function(){var y,w=this.createNode();this.matchKeyword("default")?(this.nextToken(),y=null):(this.expectKeyword("case"),y=this.parseExpression()),this.expect(":");for(var b=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)b.push(this.parseStatementListItem());return this.finalize(w,new h.SwitchCase(y,b))},_.prototype.parseSwitchStatement=function(){var y=this.createNode();this.expectKeyword("switch"),this.expect("(");var w=this.parseExpression();this.expect(")");var b=this.context.inSwitch;this.context.inSwitch=!0;var M=[],I=!1;for(this.expect("{");!this.match("}");){var A=this.parseSwitchCase();A.test===null&&(I&&this.throwError(f.Messages.MultipleDefaultsInSwitch),I=!0),M.push(A)}return this.expect("}"),this.context.inSwitch=b,this.finalize(y,new h.SwitchStatement(w,M))},_.prototype.parseLabelledStatement=function(){var y,w=this.createNode(),b=this.parseExpression();if(b.type===C.Syntax.Identifier&&this.match(":")){this.nextToken();var M=b,I="$"+M.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,I)&&this.throwError(f.Messages.Redeclaration,"Label",M.name),this.context.labelSet[I]=!0;var A=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),A=this.parseClassDeclaration();else if(this.matchKeyword("function")){var k=this.lookahead,U=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(k,f.Messages.StrictFunction):U.generator&&this.tolerateUnexpectedToken(k,f.Messages.GeneratorInLegacyContext),A=U}else A=this.parseStatement();delete this.context.labelSet[I],y=new h.LabeledStatement(M,A)}else this.consumeSemicolon(),y=new h.ExpressionStatement(b);return this.finalize(w,y)},_.prototype.parseThrowStatement=function(){var y=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(f.Messages.NewlineAfterThrow);var w=this.parseExpression();return this.consumeSemicolon(),this.finalize(y,new h.ThrowStatement(w))},_.prototype.parseCatchClause=function(){var y=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var w=[],b=this.parsePattern(w),M={},I=0;I<w.length;I++){var A="$"+w[I].value;Object.prototype.hasOwnProperty.call(M,A)&&this.tolerateError(f.Messages.DuplicateBinding,w[I].value),M[A]=!0}this.context.strict&&b.type===C.Syntax.Identifier&&this.scanner.isRestrictedWord(b.name)&&this.tolerateError(f.Messages.StrictCatchVariable),this.expect(")");var k=this.parseBlock();return this.finalize(y,new h.CatchClause(b,k))},_.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},_.prototype.parseTryStatement=function(){var y=this.createNode();this.expectKeyword("try");var w=this.parseBlock(),b=this.matchKeyword("catch")?this.parseCatchClause():null,M=this.matchKeyword("finally")?this.parseFinallyClause():null;return b||M||this.throwError(f.Messages.NoCatchOrFinally),this.finalize(y,new h.TryStatement(w,b,M))},_.prototype.parseDebuggerStatement=function(){var y=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(y,new h.DebuggerStatement)},_.prototype.parseStatement=function(){var y;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:y=this.parseExpressionStatement();break;case 7:var w=this.lookahead.value;y=w==="{"?this.parseBlock():w==="("?this.parseExpressionStatement():w===";"?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:y=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":y=this.parseBreakStatement();break;case"continue":y=this.parseContinueStatement();break;case"debugger":y=this.parseDebuggerStatement();break;case"do":y=this.parseDoWhileStatement();break;case"for":y=this.parseForStatement();break;case"function":y=this.parseFunctionDeclaration();break;case"if":y=this.parseIfStatement();break;case"return":y=this.parseReturnStatement();break;case"switch":y=this.parseSwitchStatement();break;case"throw":y=this.parseThrowStatement();break;case"try":y=this.parseTryStatement();break;case"var":y=this.parseVariableStatement();break;case"while":y=this.parseWhileStatement();break;case"with":y=this.parseWithStatement();break;default:y=this.parseExpressionStatement()}break;default:y=this.throwUnexpectedToken(this.lookahead)}return y},_.prototype.parseFunctionSourceElements=function(){var y=this.createNode();this.expect("{");var w=this.parseDirectivePrologues(),b=this.context.labelSet,M=this.context.inIteration,I=this.context.inSwitch,A=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;this.lookahead.type!==2&&!this.match("}");)w.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=b,this.context.inIteration=M,this.context.inSwitch=I,this.context.inFunctionBody=A,this.finalize(y,new h.BlockStatement(w))},_.prototype.validateParam=function(y,w,b){var M="$"+b;this.context.strict?(this.scanner.isRestrictedWord(b)&&(y.stricted=w,y.message=f.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(y.paramSet,M)&&(y.stricted=w,y.message=f.Messages.StrictParamDupe)):y.firstRestricted||(this.scanner.isRestrictedWord(b)?(y.firstRestricted=w,y.message=f.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(b)?(y.firstRestricted=w,y.message=f.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(y.paramSet,M)&&(y.stricted=w,y.message=f.Messages.StrictParamDupe)),typeof Object.defineProperty=="function"?Object.defineProperty(y.paramSet,M,{value:!0,enumerable:!0,writable:!0,configurable:!0}):y.paramSet[M]=!0},_.prototype.parseRestElement=function(y){var w=this.createNode();this.expect("...");var b=this.parsePattern(y);return this.match("=")&&this.throwError(f.Messages.DefaultRestParameter),this.match(")")||this.throwError(f.Messages.ParameterAfterRestParameter),this.finalize(w,new h.RestElement(b))},_.prototype.parseFormalParameter=function(y){for(var w=[],b=this.match("...")?this.parseRestElement(w):this.parsePatternWithDefault(w),M=0;M<w.length;M++)this.validateParam(y,w[M],w[M].value);y.simple=y.simple&&b instanceof h.Identifier,y.params.push(b)},_.prototype.parseFormalParameters=function(y){var w;if(w={simple:!0,params:[],firstRestricted:y},this.expect("("),!this.match(")"))for(w.paramSet={};this.lookahead.type!==2&&(this.parseFormalParameter(w),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:w.simple,params:w.params,stricted:w.stricted,firstRestricted:w.firstRestricted,message:w.message}},_.prototype.matchAsyncFunction=function(){var y=this.matchContextualKeyword("async");if(y){var w=this.scanner.saveState();this.scanner.scanComments();var b=this.scanner.lex();this.scanner.restoreState(w),y=w.lineNumber===b.lineNumber&&b.type===4&&b.value==="function"}return y},_.prototype.parseFunctionDeclaration=function(y){var w=this.createNode(),b=this.matchContextualKeyword("async");b&&this.nextToken(),this.expectKeyword("function");var M,I=!b&&this.match("*");I&&this.nextToken();var A=null,k=null;if(!y||!this.match("(")){var U=this.lookahead;A=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(U.value)&&this.tolerateUnexpectedToken(U,f.Messages.StrictFunctionName):this.scanner.isRestrictedWord(U.value)?(k=U,M=f.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(U.value)&&(k=U,M=f.Messages.StrictReservedWord)}var B=this.context.await,z=this.context.allowYield;this.context.await=b,this.context.allowYield=!I;var K=this.parseFormalParameters(k),J=K.params,X=K.stricted;k=K.firstRestricted,K.message&&(M=K.message);var re=this.context.strict,fe=this.context.allowStrictDirective;this.context.allowStrictDirective=K.simple;var pe=this.parseFunctionSourceElements();return this.context.strict&&k&&this.throwUnexpectedToken(k,M),this.context.strict&&X&&this.tolerateUnexpectedToken(X,M),this.context.strict=re,this.context.allowStrictDirective=fe,this.context.await=B,this.context.allowYield=z,b?this.finalize(w,new h.AsyncFunctionDeclaration(A,J,pe)):this.finalize(w,new h.FunctionDeclaration(A,J,pe,I))},_.prototype.parseFunctionExpression=function(){var y=this.createNode(),w=this.matchContextualKeyword("async");w&&this.nextToken(),this.expectKeyword("function");var b,M=!w&&this.match("*");M&&this.nextToken();var I,A=null,k=this.context.await,U=this.context.allowYield;if(this.context.await=w,this.context.allowYield=!M,!this.match("(")){var B=this.lookahead;A=this.context.strict||M||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(B.value)&&this.tolerateUnexpectedToken(B,f.Messages.StrictFunctionName):this.scanner.isRestrictedWord(B.value)?(I=B,b=f.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(B.value)&&(I=B,b=f.Messages.StrictReservedWord)}var z=this.parseFormalParameters(I),K=z.params,J=z.stricted;I=z.firstRestricted,z.message&&(b=z.message);var X=this.context.strict,re=this.context.allowStrictDirective;this.context.allowStrictDirective=z.simple;var fe=this.parseFunctionSourceElements();return this.context.strict&&I&&this.throwUnexpectedToken(I,b),this.context.strict&&J&&this.tolerateUnexpectedToken(J,b),this.context.strict=X,this.context.allowStrictDirective=re,this.context.await=k,this.context.allowYield=U,w?this.finalize(y,new h.AsyncFunctionExpression(A,K,fe)):this.finalize(y,new h.FunctionExpression(A,K,fe,M))},_.prototype.parseDirective=function(){var y=this.lookahead,w=this.createNode(),b=this.parseExpression(),M=b.type===C.Syntax.Literal?this.getTokenRaw(y).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(w,M?new h.Directive(b,M):new h.ExpressionStatement(b))},_.prototype.parseDirectivePrologues=function(){for(var y=null,w=[];;){var b=this.lookahead;if(b.type!==8)break;var M=this.parseDirective();w.push(M);var I=M.directive;if(typeof I!="string")break;I==="use strict"?(this.context.strict=!0,y&&this.tolerateUnexpectedToken(y,f.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(b,f.Messages.IllegalLanguageModeDirective)):!y&&b.octal&&(y=b)}return w},_.prototype.qualifiedPropertyName=function(y){switch(y.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return y.value==="["}return!1},_.prototype.parseGetterMethod=function(){var y=this.createNode(),w=this.context.allowYield;this.context.allowYield=!0;var b=this.parseFormalParameters();b.params.length>0&&this.tolerateError(f.Messages.BadGetterArity);var M=this.parsePropertyMethod(b);return this.context.allowYield=w,this.finalize(y,new h.FunctionExpression(null,b.params,M,!1))},_.prototype.parseSetterMethod=function(){var y=this.createNode(),w=this.context.allowYield;this.context.allowYield=!0;var b=this.parseFormalParameters();b.params.length!==1?this.tolerateError(f.Messages.BadSetterArity):b.params[0]instanceof h.RestElement&&this.tolerateError(f.Messages.BadSetterRestParameter);var M=this.parsePropertyMethod(b);return this.context.allowYield=w,this.finalize(y,new h.FunctionExpression(null,b.params,M,!1))},_.prototype.parseGeneratorMethod=function(){var y=this.createNode(),w=this.context.allowYield;this.context.allowYield=!0;var b=this.parseFormalParameters();this.context.allowYield=!1;var M=this.parsePropertyMethod(b);return this.context.allowYield=w,this.finalize(y,new h.FunctionExpression(null,b.params,M,!0))},_.prototype.isStartOfExpression=function(){var y=!0,w=this.lookahead.value;switch(this.lookahead.type){case 7:y=w==="["||w==="("||w==="{"||w==="+"||w==="-"||w==="!"||w==="~"||w==="++"||w==="--"||w==="/"||w==="/=";break;case 4:y=w==="class"||w==="delete"||w==="function"||w==="let"||w==="new"||w==="super"||w==="this"||w==="typeof"||w==="void"||w==="yield"}return y},_.prototype.parseYieldExpression=function(){var y=this.createNode();this.expectKeyword("yield");var w=null,b=!1;if(!this.hasLineTerminator){var M=this.context.allowYield;this.context.allowYield=!1,(b=this.match("*"))?(this.nextToken(),w=this.parseAssignmentExpression()):this.isStartOfExpression()&&(w=this.parseAssignmentExpression()),this.context.allowYield=M}return this.finalize(y,new h.YieldExpression(w,b))},_.prototype.parseClassElement=function(y){var w=this.lookahead,b=this.createNode(),M="",I=null,A=null,k=!1,U=!1,B=!1,z=!1;if(this.match("*"))this.nextToken();else if(k=this.match("["),(I=this.parseObjectPropertyKey()).name==="static"&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(w=this.lookahead,B=!0,k=this.match("["),this.match("*")?this.nextToken():I=this.parseObjectPropertyKey()),w.type===3&&!this.hasLineTerminator&&w.value==="async"){var K=this.lookahead.value;K!==":"&&K!=="("&&K!=="*"&&(z=!0,w=this.lookahead,I=this.parseObjectPropertyKey(),w.type===3&&w.value==="constructor"&&this.tolerateUnexpectedToken(w,f.Messages.ConstructorIsAsync))}var J=this.qualifiedPropertyName(this.lookahead);return w.type===3?w.value==="get"&&J?(M="get",k=this.match("["),I=this.parseObjectPropertyKey(),this.context.allowYield=!1,A=this.parseGetterMethod()):w.value==="set"&&J&&(M="set",k=this.match("["),I=this.parseObjectPropertyKey(),A=this.parseSetterMethod()):w.type===7&&w.value==="*"&&J&&(M="init",k=this.match("["),I=this.parseObjectPropertyKey(),A=this.parseGeneratorMethod(),U=!0),!M&&I&&this.match("(")&&(M="init",A=z?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),U=!0),M||this.throwUnexpectedToken(this.lookahead),M==="init"&&(M="method"),k||(B&&this.isPropertyKey(I,"prototype")&&this.throwUnexpectedToken(w,f.Messages.StaticPrototype),!B&&this.isPropertyKey(I,"constructor")&&((M!=="method"||!U||A&&A.generator)&&this.throwUnexpectedToken(w,f.Messages.ConstructorSpecialMethod),y.value?this.throwUnexpectedToken(w,f.Messages.DuplicateConstructor):y.value=!0,M="constructor")),this.finalize(b,new h.MethodDefinition(I,k,A,M,B))},_.prototype.parseClassElementList=function(){var y=[],w={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():y.push(this.parseClassElement(w));return this.expect("}"),y},_.prototype.parseClassBody=function(){var y=this.createNode(),w=this.parseClassElementList();return this.finalize(y,new h.ClassBody(w))},_.prototype.parseClassDeclaration=function(y){var w=this.createNode(),b=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var M=y&&this.lookahead.type!==3?null:this.parseVariableIdentifier(),I=null;this.matchKeyword("extends")&&(this.nextToken(),I=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var A=this.parseClassBody();return this.context.strict=b,this.finalize(w,new h.ClassDeclaration(M,I,A))},_.prototype.parseClassExpression=function(){var y=this.createNode(),w=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var b=this.lookahead.type===3?this.parseVariableIdentifier():null,M=null;this.matchKeyword("extends")&&(this.nextToken(),M=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var I=this.parseClassBody();return this.context.strict=w,this.finalize(y,new h.ClassExpression(b,M,I))},_.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var y=this.createNode(),w=this.parseDirectivePrologues();this.lookahead.type!==2;)w.push(this.parseStatementListItem());return this.finalize(y,new h.Module(w))},_.prototype.parseScript=function(){for(var y=this.createNode(),w=this.parseDirectivePrologues();this.lookahead.type!==2;)w.push(this.parseStatementListItem());return this.finalize(y,new h.Script(w))},_.prototype.parseModuleSpecifier=function(){var y=this.createNode();this.lookahead.type!==8&&this.throwError(f.Messages.InvalidModuleSpecifier);var w=this.nextToken(),b=this.getTokenRaw(w);return this.finalize(y,new h.Literal(w.value,b))},_.prototype.parseImportSpecifier=function(){var y,w,b=this.createNode();return this.lookahead.type===3?(w=y=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),w=this.parseVariableIdentifier())):(w=y=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),w=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(b,new h.ImportSpecifier(w,y))},_.prototype.parseNamedImports=function(){this.expect("{");for(var y=[];!this.match("}");)y.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),y},_.prototype.parseImportDefaultSpecifier=function(){var y=this.createNode(),w=this.parseIdentifierName();return this.finalize(y,new h.ImportDefaultSpecifier(w))},_.prototype.parseImportNamespaceSpecifier=function(){var y=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(f.Messages.NoAsAfterImportNamespace),this.nextToken();var w=this.parseIdentifierName();return this.finalize(y,new h.ImportNamespaceSpecifier(w))},_.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(f.Messages.IllegalImportDeclaration);var y,w=this.createNode();this.expectKeyword("import");var b=[];if(this.lookahead.type===8)y=this.parseModuleSpecifier();else{if(this.match("{")?b=b.concat(this.parseNamedImports()):this.match("*")?b.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(b.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?b.push(this.parseImportNamespaceSpecifier()):this.match("{")?b=b.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var M=this.lookahead.value?f.Messages.UnexpectedToken:f.Messages.MissingFromClause;this.throwError(M,this.lookahead.value)}this.nextToken(),y=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(w,new h.ImportDeclaration(b,y))},_.prototype.parseExportSpecifier=function(){var y=this.createNode(),w=this.parseIdentifierName(),b=w;return this.matchContextualKeyword("as")&&(this.nextToken(),b=this.parseIdentifierName()),this.finalize(y,new h.ExportSpecifier(w,b))},_.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(f.Messages.IllegalExportDeclaration);var y,w=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var b=this.parseFunctionDeclaration(!0);y=this.finalize(w,new h.ExportDefaultDeclaration(b))}else this.matchKeyword("class")?(b=this.parseClassDeclaration(!0),y=this.finalize(w,new h.ExportDefaultDeclaration(b))):this.matchContextualKeyword("async")?(b=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),y=this.finalize(w,new h.ExportDefaultDeclaration(b))):(this.matchContextualKeyword("from")&&this.throwError(f.Messages.UnexpectedToken,this.lookahead.value),b=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),y=this.finalize(w,new h.ExportDefaultDeclaration(b)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var M=this.lookahead.value?f.Messages.UnexpectedToken:f.Messages.MissingFromClause;this.throwError(M,this.lookahead.value)}this.nextToken();var I=this.parseModuleSpecifier();this.consumeSemicolon(),y=this.finalize(w,new h.ExportAllDeclaration(I))}else if(this.lookahead.type===4){switch(b=void 0,this.lookahead.value){case"let":case"const":b=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":b=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}y=this.finalize(w,new h.ExportNamedDeclaration(b,[],null))}else if(this.matchAsyncFunction())b=this.parseFunctionDeclaration(),y=this.finalize(w,new h.ExportNamedDeclaration(b,[],null));else{var A=[],k=null,U=!1;for(this.expect("{");!this.match("}");)U=U||this.matchKeyword("default"),A.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),k=this.parseModuleSpecifier(),this.consumeSemicolon()):U?(M=this.lookahead.value?f.Messages.UnexpectedToken:f.Messages.MissingFromClause,this.throwError(M,this.lookahead.value)):this.consumeSemicolon(),y=this.finalize(w,new h.ExportNamedDeclaration(null,A,k))}return y},_}();s.Parser=T},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.assert=function(l,c){if(!l)throw new Error("ASSERT: "+c)}},function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var l=function(){function c(){this.errors=[],this.tolerant=!1}return c.prototype.recordError=function(d){this.errors.push(d)},c.prototype.tolerate=function(d){if(!this.tolerant)throw d;this.recordError(d)},c.prototype.constructError=function(d,f){var h=new Error(d);try{throw h}catch(p){Object.create&&Object.defineProperty&&(h=Object.create(p),Object.defineProperty(h,"column",{value:f}))}return h},c.prototype.createError=function(d,f,h,p){var C="Line "+f+": "+p,x=this.constructError(C,h);return x.index=d,x.lineNumber=f,x.description=p,x},c.prototype.throwError=function(d,f,h,p){throw this.createError(d,f,h,p)},c.prototype.tolerateError=function(d,f,h,p){var C=this.createError(d,f,h,p);if(!this.tolerant)throw C;this.recordError(C)},c}();s.ErrorHandler=l},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(9),d=l(4),f=l(11);function h(x){return"0123456789abcdef".indexOf(x.toLowerCase())}function p(x){return"01234567".indexOf(x)}var C=function(){function x(T,_){this.source=T,this.errorHandler=_,this.trackComment=!1,this.isModule=!1,this.length=T.length,this.index=0,this.lineNumber=T.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return x.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},x.prototype.restoreState=function(T){this.index=T.index,this.lineNumber=T.lineNumber,this.lineStart=T.lineStart},x.prototype.eof=function(){return this.index>=this.length},x.prototype.throwUnexpectedToken=function(T){return T===void 0&&(T=f.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,T)},x.prototype.tolerateUnexpectedToken=function(T){T===void 0&&(T=f.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,T)},x.prototype.skipSingleLineComment=function(T){var _,y,w=[];for(this.trackComment&&(w=[],_=this.index-T,y={start:{line:this.lineNumber,column:this.index-this.lineStart-T},end:{}});!this.eof();){var b=this.source.charCodeAt(this.index);if(++this.index,d.Character.isLineTerminator(b)){if(this.trackComment){y.end={line:this.lineNumber,column:this.index-this.lineStart-1};var M={multiLine:!1,slice:[_+T,this.index-1],range:[_,this.index-1],loc:y};w.push(M)}return b===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,w}}return this.trackComment&&(y.end={line:this.lineNumber,column:this.index-this.lineStart},M={multiLine:!1,slice:[_+T,this.index],range:[_,this.index],loc:y},w.push(M)),w},x.prototype.skipMultiLineComment=function(){var T,_,y=[];for(this.trackComment&&(y=[],T=this.index-2,_={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var w=this.source.charCodeAt(this.index);if(d.Character.isLineTerminator(w))w===13&&this.source.charCodeAt(this.index+1)===10&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(w===42){if(this.source.charCodeAt(this.index+1)===47){if(this.index+=2,this.trackComment){_.end={line:this.lineNumber,column:this.index-this.lineStart};var b={multiLine:!0,slice:[T+2,this.index-2],range:[T,this.index],loc:_};y.push(b)}return y}++this.index}else++this.index}return this.trackComment&&(_.end={line:this.lineNumber,column:this.index-this.lineStart},b={multiLine:!0,slice:[T+2,this.index],range:[T,this.index],loc:_},y.push(b)),this.tolerateUnexpectedToken(),y},x.prototype.scanComments=function(){var T;this.trackComment&&(T=[]);for(var _=this.index===0;!this.eof();){var y=this.source.charCodeAt(this.index);if(d.Character.isWhiteSpace(y))++this.index;else if(d.Character.isLineTerminator(y))++this.index,y===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,_=!0;else if(y===47)if((y=this.source.charCodeAt(this.index+1))===47){this.index+=2;var w=this.skipSingleLineComment(2);this.trackComment&&(T=T.concat(w)),_=!0}else{if(y!==42)break;this.index+=2,w=this.skipMultiLineComment(),this.trackComment&&(T=T.concat(w))}else if(_&&y===45){if(this.source.charCodeAt(this.index+1)!==45||this.source.charCodeAt(this.index+2)!==62)break;this.index+=3,w=this.skipSingleLineComment(3),this.trackComment&&(T=T.concat(w))}else{if(y!==60||this.isModule||this.source.slice(this.index+1,this.index+4)!=="!--")break;this.index+=4,w=this.skipSingleLineComment(4),this.trackComment&&(T=T.concat(w))}}return T},x.prototype.isFutureReservedWord=function(T){switch(T){case"enum":case"export":case"import":case"super":return!0;default:return!1}},x.prototype.isStrictModeReservedWord=function(T){switch(T){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},x.prototype.isRestrictedWord=function(T){return T==="eval"||T==="arguments"},x.prototype.isKeyword=function(T){switch(T.length){case 2:return T==="if"||T==="in"||T==="do";case 3:return T==="var"||T==="for"||T==="new"||T==="try"||T==="let";case 4:return T==="this"||T==="else"||T==="case"||T==="void"||T==="with"||T==="enum";case 5:return T==="while"||T==="break"||T==="catch"||T==="throw"||T==="const"||T==="yield"||T==="class"||T==="super";case 6:return T==="return"||T==="typeof"||T==="delete"||T==="switch"||T==="export"||T==="import";case 7:return T==="default"||T==="finally"||T==="extends";case 8:return T==="function"||T==="continue"||T==="debugger";case 10:return T==="instanceof";default:return!1}},x.prototype.codePointAt=function(T){var _=this.source.charCodeAt(T);if(_>=55296&&_<=56319){var y=this.source.charCodeAt(T+1);y>=56320&&y<=57343&&(_=1024*(_-55296)+y-56320+65536)}return _},x.prototype.scanHexEscape=function(T){for(var _=T==="u"?4:2,y=0,w=0;w<_;++w){if(this.eof()||!d.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;y=16*y+h(this.source[this.index++])}return String.fromCharCode(y)},x.prototype.scanUnicodeCodePointEscape=function(){var T=this.source[this.index],_=0;for(T==="}"&&this.throwUnexpectedToken();!this.eof()&&(T=this.source[this.index++],d.Character.isHexDigit(T.charCodeAt(0)));)_=16*_+h(T);return(_>1114111||T!=="}")&&this.throwUnexpectedToken(),d.Character.fromCodePoint(_)},x.prototype.getIdentifier=function(){for(var T=this.index++;!this.eof();){var _=this.source.charCodeAt(this.index);if(_===92)return this.index=T,this.getComplexIdentifier();if(_>=55296&&_<57343)return this.index=T,this.getComplexIdentifier();if(!d.Character.isIdentifierPart(_))break;++this.index}return this.source.slice(T,this.index)},x.prototype.getComplexIdentifier=function(){var T,_=this.codePointAt(this.index),y=d.Character.fromCodePoint(_);for(this.index+=y.length,_===92&&(this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,T=this.scanUnicodeCodePointEscape()):(T=this.scanHexEscape("u"))!==null&&T!=="\\"&&d.Character.isIdentifierStart(T.charCodeAt(0))||this.throwUnexpectedToken(),y=T);!this.eof()&&(_=this.codePointAt(this.index),d.Character.isIdentifierPart(_));)y+=T=d.Character.fromCodePoint(_),this.index+=T.length,_===92&&(y=y.substr(0,y.length-1),this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,T=this.scanUnicodeCodePointEscape()):(T=this.scanHexEscape("u"))!==null&&T!=="\\"&&d.Character.isIdentifierPart(T.charCodeAt(0))||this.throwUnexpectedToken(),y+=T);return y},x.prototype.octalToDecimal=function(T){var _=T!=="0",y=p(T);return!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(_=!0,y=8*y+p(this.source[this.index++]),"0123".indexOf(T)>=0&&!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(y=8*y+p(this.source[this.index++]))),{code:y,octal:_}},x.prototype.scanIdentifier=function(){var T,_=this.index,y=this.source.charCodeAt(_)===92?this.getComplexIdentifier():this.getIdentifier();if((T=y.length===1?3:this.isKeyword(y)?4:y==="null"?5:y==="true"||y==="false"?1:3)!=3&&_+y.length!==this.index){var w=this.index;this.index=_,this.tolerateUnexpectedToken(f.Messages.InvalidEscapedReservedWord),this.index=w}return{type:T,value:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:_,end:this.index}},x.prototype.scanPunctuator=function(){var T=this.index,_=this.source[this.index];switch(_){case"(":case"{":_==="{"&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,this.source[this.index]==="."&&this.source[this.index+1]==="."&&(this.index+=2,_="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:(_=this.source.substr(this.index,4))===">>>="?this.index+=4:(_=_.substr(0,3))==="==="||_==="!=="||_===">>>"||_==="<<="||_===">>="||_==="**="?this.index+=3:(_=_.substr(0,2))==="&&"||_==="||"||_==="=="||_==="!="||_==="+="||_==="-="||_==="*="||_==="/="||_==="++"||_==="--"||_==="<<"||_===">>"||_==="&="||_==="|="||_==="^="||_==="%="||_==="<="||_===">="||_==="=>"||_==="**"?this.index+=2:(_=this.source[this.index],"<>=!+-*%&|^/".indexOf(_)>=0&&++this.index)}return this.index===T&&this.throwUnexpectedToken(),{type:7,value:_,lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.scanHexLiteral=function(T){for(var _="";!this.eof()&&d.Character.isHexDigit(this.source.charCodeAt(this.index));)_+=this.source[this.index++];return _.length===0&&this.throwUnexpectedToken(),d.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+_,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.scanBinaryLiteral=function(T){for(var _,y="";!this.eof()&&((_=this.source[this.index])==="0"||_==="1");)y+=this.source[this.index++];return y.length===0&&this.throwUnexpectedToken(),this.eof()||(_=this.source.charCodeAt(this.index),(d.Character.isIdentifierStart(_)||d.Character.isDecimalDigit(_))&&this.throwUnexpectedToken()),{type:6,value:parseInt(y,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.scanOctalLiteral=function(T,_){var y="",w=!1;for(d.Character.isOctalDigit(T.charCodeAt(0))?(w=!0,y="0"+this.source[this.index++]):++this.index;!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];return w||y.length!==0||this.throwUnexpectedToken(),(d.Character.isIdentifierStart(this.source.charCodeAt(this.index))||d.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(y,8),octal:w,lineNumber:this.lineNumber,lineStart:this.lineStart,start:_,end:this.index}},x.prototype.isImplicitOctalLiteral=function(){for(var T=this.index+1;T<this.length;++T){var _=this.source[T];if(_==="8"||_==="9")return!1;if(!d.Character.isOctalDigit(_.charCodeAt(0)))return!0}return!0},x.prototype.scanNumericLiteral=function(){var T=this.index,_=this.source[T];c.assert(d.Character.isDecimalDigit(_.charCodeAt(0))||_===".","Numeric literal must start with a decimal digit or a decimal point");var y="";if(_!=="."){if(y=this.source[this.index++],_=this.source[this.index],y==="0"){if(_==="x"||_==="X")return++this.index,this.scanHexLiteral(T);if(_==="b"||_==="B")return++this.index,this.scanBinaryLiteral(T);if(_==="o"||_==="O")return this.scanOctalLiteral(_,T);if(_&&d.Character.isOctalDigit(_.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(_,T)}for(;d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];_=this.source[this.index]}if(_==="."){for(y+=this.source[this.index++];d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];_=this.source[this.index]}if(_==="e"||_==="E")if(y+=this.source[this.index++],(_=this.source[this.index])!=="+"&&_!=="-"||(y+=this.source[this.index++]),d.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];else this.throwUnexpectedToken();return d.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(y),lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.scanStringLiteral=function(){var T=this.index,_=this.source[T];c.assert(_==="'"||_==='"',"String literal must starts with a quote"),++this.index;for(var y=!1,w="";!this.eof();){var b=this.source[this.index++];if(b===_){_="";break}if(b==="\\")if((b=this.source[this.index++])&&d.Character.isLineTerminator(b.charCodeAt(0)))++this.lineNumber,b==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(b){case"u":if(this.source[this.index]==="{")++this.index,w+=this.scanUnicodeCodePointEscape();else{var M=this.scanHexEscape(b);M===null&&this.throwUnexpectedToken(),w+=M}break;case"x":var I=this.scanHexEscape(b);I===null&&this.throwUnexpectedToken(f.Messages.InvalidHexEscapeSequence),w+=I;break;case"n":w+=`
`;break;case"r":w+="\r";break;case"t":w+="	";break;case"b":w+="\b";break;case"f":w+="\f";break;case"v":w+="\v";break;case"8":case"9":w+=b,this.tolerateUnexpectedToken();break;default:if(b&&d.Character.isOctalDigit(b.charCodeAt(0))){var A=this.octalToDecimal(b);y=A.octal||y,w+=String.fromCharCode(A.code)}else w+=b}else{if(d.Character.isLineTerminator(b.charCodeAt(0)))break;w+=b}}return _!==""&&(this.index=T,this.throwUnexpectedToken()),{type:8,value:w,octal:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.scanTemplate=function(){var T="",_=!1,y=this.index,w=this.source[y]==="`",b=!1,M=2;for(++this.index;!this.eof();){var I=this.source[this.index++];if(I==="`"){M=1,b=!0,_=!0;break}if(I==="$"){if(this.source[this.index]==="{"){this.curlyStack.push("${"),++this.index,_=!0;break}T+=I}else if(I==="\\")if(I=this.source[this.index++],d.Character.isLineTerminator(I.charCodeAt(0)))++this.lineNumber,I==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(I){case"n":T+=`
`;break;case"r":T+="\r";break;case"t":T+="	";break;case"u":if(this.source[this.index]==="{")++this.index,T+=this.scanUnicodeCodePointEscape();else{var A=this.index,k=this.scanHexEscape(I);k!==null?T+=k:(this.index=A,T+=I)}break;case"x":var U=this.scanHexEscape(I);U===null&&this.throwUnexpectedToken(f.Messages.InvalidHexEscapeSequence),T+=U;break;case"b":T+="\b";break;case"f":T+="\f";break;case"v":T+="\v";break;default:I==="0"?(d.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(f.Messages.TemplateOctalLiteral),T+="\0"):d.Character.isOctalDigit(I.charCodeAt(0))?this.throwUnexpectedToken(f.Messages.TemplateOctalLiteral):T+=I}else d.Character.isLineTerminator(I.charCodeAt(0))?(++this.lineNumber,I==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index,T+=`
`):T+=I}return _||this.throwUnexpectedToken(),w||this.curlyStack.pop(),{type:10,value:this.source.slice(y+1,this.index-M),cooked:T,head:w,tail:b,lineNumber:this.lineNumber,lineStart:this.lineStart,start:y,end:this.index}},x.prototype.testRegExp=function(T,_){var y=T,w=this;_.indexOf("u")>=0&&(y=y.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(b,M,I){var A=parseInt(M||I,16);return A>1114111&&w.throwUnexpectedToken(f.Messages.InvalidRegExp),A<=65535?String.fromCharCode(A):""}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(y)}catch{this.throwUnexpectedToken(f.Messages.InvalidRegExp)}try{return new RegExp(T,_)}catch{return null}},x.prototype.scanRegExpBody=function(){var T=this.source[this.index];c.assert(T==="/","Regular expression literal must start with a slash");for(var _=this.source[this.index++],y=!1,w=!1;!this.eof();)if(_+=T=this.source[this.index++],T==="\\")T=this.source[this.index++],d.Character.isLineTerminator(T.charCodeAt(0))&&this.throwUnexpectedToken(f.Messages.UnterminatedRegExp),_+=T;else if(d.Character.isLineTerminator(T.charCodeAt(0)))this.throwUnexpectedToken(f.Messages.UnterminatedRegExp);else if(y)T==="]"&&(y=!1);else{if(T==="/"){w=!0;break}T==="["&&(y=!0)}return w||this.throwUnexpectedToken(f.Messages.UnterminatedRegExp),_.substr(1,_.length-2)},x.prototype.scanRegExpFlags=function(){for(var T="";!this.eof();){var _=this.source[this.index];if(!d.Character.isIdentifierPart(_.charCodeAt(0)))break;if(++this.index,_!=="\\"||this.eof())T+=_;else if((_=this.source[this.index])==="u"){++this.index;var y=this.index,w=this.scanHexEscape("u");if(w!==null)for(T+=w;y<this.index;++y)this.source[y];else this.index=y,T+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return T},x.prototype.scanRegExp=function(){var T=this.index,_=this.scanRegExpBody(),y=this.scanRegExpFlags();return{type:9,value:"",pattern:_,flags:y,regex:this.testRegExp(_,y),lineNumber:this.lineNumber,lineStart:this.lineStart,start:T,end:this.index}},x.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var T=this.source.charCodeAt(this.index);return d.Character.isIdentifierStart(T)?this.scanIdentifier():T===40||T===41||T===59?this.scanPunctuator():T===39||T===34?this.scanStringLiteral():T===46?d.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():d.Character.isDecimalDigit(T)?this.scanNumericLiteral():T===96||T===125&&this.curlyStack[this.curlyStack.length-1]==="${"?this.scanTemplate():T>=55296&&T<57343&&d.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},x}();s.Scanner=C},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenName={},s.TokenName[1]="Boolean",s.TokenName[2]="<end>",s.TokenName[3]="Identifier",s.TokenName[4]="Keyword",s.TokenName[5]="Null",s.TokenName[6]="Numeric",s.TokenName[7]="Punctuator",s.TokenName[8]="String",s.TokenName[9]="RegularExpression",s.TokenName[10]="Template"},function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(o,s,l){Object.defineProperty(s,"__esModule",{value:!0});var c=l(10),d=l(12),f=l(13),h=function(){function C(){this.values=[],this.curly=this.paren=-1}return C.prototype.beforeFunctionExpression=function(x){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(x)>=0},C.prototype.isRegexStart=function(){var x=this.values[this.values.length-1],T=x!==null;switch(x){case"this":case"]":T=!1;break;case")":var _=this.values[this.paren-1];T=_==="if"||_==="while"||_==="for"||_==="with";break;case"}":if(T=!1,this.values[this.curly-3]==="function")T=!!(y=this.values[this.curly-4])&&!this.beforeFunctionExpression(y);else if(this.values[this.curly-4]==="function"){var y;T=!(y=this.values[this.curly-5])||!this.beforeFunctionExpression(y)}}return T},C.prototype.push=function(x){x.type===7||x.type===4?(x.value==="{"?this.curly=this.values.length:x.value==="("&&(this.paren=this.values.length),this.values.push(x.value)):this.values.push(null)},C}(),p=function(){function C(x,T){this.errorHandler=new c.ErrorHandler,this.errorHandler.tolerant=!!T&&typeof T.tolerant=="boolean"&&T.tolerant,this.scanner=new d.Scanner(x,this.errorHandler),this.scanner.trackComment=!!T&&typeof T.comment=="boolean"&&T.comment,this.trackRange=!!T&&typeof T.range=="boolean"&&T.range,this.trackLoc=!!T&&typeof T.loc=="boolean"&&T.loc,this.buffer=[],this.reader=new h}return C.prototype.errors=function(){return this.errorHandler.errors},C.prototype.getNextToken=function(){if(this.buffer.length===0){var x=this.scanner.scanComments();if(this.scanner.trackComment)for(var T=0;T<x.length;++T){var _=x[T],y=this.scanner.source.slice(_.slice[0],_.slice[1]),w={type:_.multiLine?"BlockComment":"LineComment",value:y};this.trackRange&&(w.range=_.range),this.trackLoc&&(w.loc=_.loc),this.buffer.push(w)}if(!this.scanner.eof()){var b=void 0;this.trackLoc&&(b={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var M=this.scanner.source[this.scanner.index]==="/"&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(M);var I={type:f.TokenName[M.type],value:this.scanner.source.slice(M.start,M.end)};if(this.trackRange&&(I.range=[M.start,M.end]),this.trackLoc&&(b.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},I.loc=b),M.type===9){var A=M.pattern,k=M.flags;I.regex={pattern:A,flags:k}}this.buffer.push(I)}}return this.buffer.shift()},C}();s.Tokenizer=p}])},n.exports=a()},function(n,r,i){var a=i(38),o=i(53),s=i(76),l=i(54),c=Object.prototype.toString,d=Object.prototype.hasOwnProperty,f={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},h=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function p(X){var re,fe,pe;if(re=X.toString(16).toUpperCase(),X<=255)fe="x",pe=2;else if(X<=65535)fe="u",pe=4;else{if(!(X<=4294967295))throw new o("code point within a string may not be greater than 0xFFFFFFFF");fe="U",pe=8}return"\\"+fe+a.repeat("0",pe-re.length)+re}function C(X){this.schema=X.schema||s,this.indent=Math.max(1,X.indent||2),this.noArrayIndent=X.noArrayIndent||!1,this.skipInvalid=X.skipInvalid||!1,this.flowLevel=a.isNothing(X.flowLevel)?-1:X.flowLevel,this.styleMap=function(re,fe){var pe,ie,te,ee,we,Ce,De;if(fe===null)return{};for(pe={},te=0,ee=(ie=Object.keys(fe)).length;te<ee;te+=1)we=ie[te],Ce=String(fe[we]),we.slice(0,2)==="!!"&&(we="tag:yaml.org,2002:"+we.slice(2)),(De=re.compiledTypeMap.fallback[we])&&d.call(De.styleAliases,Ce)&&(Ce=De.styleAliases[Ce]),pe[we]=Ce;return pe}(this.schema,X.styles||null),this.sortKeys=X.sortKeys||!1,this.lineWidth=X.lineWidth||80,this.noRefs=X.noRefs||!1,this.noCompatMode=X.noCompatMode||!1,this.condenseFlow=X.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function x(X,re){for(var fe,pe=a.repeat(" ",re),ie=0,te=-1,ee="",we=X.length;ie<we;)(te=X.indexOf(`
`,ie))===-1?(fe=X.slice(ie),ie=we):(fe=X.slice(ie,te+1),ie=te+1),fe.length&&fe!==`
`&&(ee+=pe),ee+=fe;return ee}function T(X,re){return`
`+a.repeat(" ",X.indent*re)}function _(X){return X===32||X===9}function y(X){return 32<=X&&X<=126||161<=X&&X<=55295&&X!==8232&&X!==8233||57344<=X&&X<=65533&&X!==65279||65536<=X&&X<=1114111}function w(X,re){return y(X)&&X!==65279&&X!==44&&X!==91&&X!==93&&X!==123&&X!==125&&X!==58&&(X!==35||re&&function(fe){return y(fe)&&!_(fe)&&fe!==65279&&fe!==13&&fe!==10}(re))}function b(X){return/^\n* /.test(X)}function M(X,re,fe,pe,ie){var te,ee,we,Ce,De=!1,Re=!1,Oe=pe!==-1,Ve=-1,Ge=y(Ce=X.charCodeAt(0))&&Ce!==65279&&!_(Ce)&&Ce!==45&&Ce!==63&&Ce!==58&&Ce!==44&&Ce!==91&&Ce!==93&&Ce!==123&&Ce!==125&&Ce!==35&&Ce!==38&&Ce!==42&&Ce!==33&&Ce!==124&&Ce!==61&&Ce!==62&&Ce!==39&&Ce!==34&&Ce!==37&&Ce!==64&&Ce!==96&&!_(X.charCodeAt(X.length-1));if(re)for(te=0;te<X.length;te++){if(!y(ee=X.charCodeAt(te)))return 5;we=te>0?X.charCodeAt(te-1):null,Ge=Ge&&w(ee,we)}else{for(te=0;te<X.length;te++){if((ee=X.charCodeAt(te))===10)De=!0,Oe&&(Re=Re||te-Ve-1>pe&&X[Ve+1]!==" ",Ve=te);else if(!y(ee))return 5;we=te>0?X.charCodeAt(te-1):null,Ge=Ge&&w(ee,we)}Re=Re||Oe&&te-Ve-1>pe&&X[Ve+1]!==" "}return De||Re?fe>9&&b(X)?5:Re?4:3:Ge&&!ie(X)?1:2}function I(X,re,fe,pe){X.dump=function(){if(re.length===0)return"''";if(!X.noCompatMode&&h.indexOf(re)!==-1)return"'"+re+"'";var ie=X.indent*Math.max(1,fe),te=X.lineWidth===-1?-1:Math.max(Math.min(X.lineWidth,40),X.lineWidth-ie),ee=pe||X.flowLevel>-1&&fe>=X.flowLevel;switch(M(re,ee,X.indent,te,function(we){return function(Ce,De){var Re,Oe;for(Re=0,Oe=Ce.implicitTypes.length;Re<Oe;Re+=1)if(Ce.implicitTypes[Re].resolve(De))return!0;return!1}(X,we)})){case 1:return re;case 2:return"'"+re.replace(/'/g,"''")+"'";case 3:return"|"+A(re,X.indent)+k(x(re,ie));case 4:return">"+A(re,X.indent)+k(x(function(we,Ce){for(var De,Re,Oe=/(\n+)([^\n]*)/g,Ve=(qe=we.indexOf(`
`),qe=qe!==-1?qe:we.length,Oe.lastIndex=qe,U(we.slice(0,qe),Ce)),Ge=we[0]===`
`||we[0]===" ",qe;Re=Oe.exec(we);){var Be=Re[1],ae=Re[2];De=ae[0]===" ",Ve+=Be+(Ge||De||ae===""?"":`
`)+U(ae,Ce),Ge=De}return Ve}(re,te),ie));case 5:return'"'+function(we){for(var Ce,De,Re,Oe="",Ve=0;Ve<we.length;Ve++)(Ce=we.charCodeAt(Ve))>=55296&&Ce<=56319&&(De=we.charCodeAt(Ve+1))>=56320&&De<=57343?(Oe+=p(1024*(Ce-55296)+De-56320+65536),Ve++):(Re=f[Ce],Oe+=!Re&&y(Ce)?we[Ve]:Re||p(Ce));return Oe}(re)+'"';default:throw new o("impossible error: invalid scalar style")}}()}function A(X,re){var fe=b(X)?String(re):"",pe=X[X.length-1]===`
`;return fe+(pe&&(X[X.length-2]===`
`||X===`
`)?"+":pe?"":"-")+`
`}function k(X){return X[X.length-1]===`
`?X.slice(0,-1):X}function U(X,re){if(X===""||X[0]===" ")return X;for(var fe,pe,ie=/ [^ ]/g,te=0,ee=0,we=0,Ce="";fe=ie.exec(X);)(we=fe.index)-te>re&&(pe=ee>te?ee:we,Ce+=`
`+X.slice(te,pe),te=pe+1),ee=we;return Ce+=`
`,X.length-te>re&&ee>te?Ce+=X.slice(te,ee)+`
`+X.slice(ee+1):Ce+=X.slice(te),Ce.slice(1)}function B(X,re,fe){var pe,ie,te,ee,we,Ce;for(te=0,ee=(ie=fe?X.explicitTypes:X.implicitTypes).length;te<ee;te+=1)if(((we=ie[te]).instanceOf||we.predicate)&&(!we.instanceOf||typeof re=="object"&&re instanceof we.instanceOf)&&(!we.predicate||we.predicate(re))){if(X.tag=fe?we.tag:"?",we.represent){if(Ce=X.styleMap[we.tag]||we.defaultStyle,c.call(we.represent)==="[object Function]")pe=we.represent(re,Ce);else{if(!d.call(we.represent,Ce))throw new o("!<"+we.tag+'> tag resolver accepts not "'+Ce+'" style');pe=we.represent[Ce](re,Ce)}X.dump=pe}return!0}return!1}function z(X,re,fe,pe,ie,te){X.tag=null,X.dump=fe,B(X,fe,!1)||B(X,fe,!0);var ee=c.call(X.dump);pe&&(pe=X.flowLevel<0||X.flowLevel>re);var we,Ce,De=ee==="[object Object]"||ee==="[object Array]";if(De&&(Ce=(we=X.duplicates.indexOf(fe))!==-1),(X.tag!==null&&X.tag!=="?"||Ce||X.indent!==2&&re>0)&&(ie=!1),Ce&&X.usedDuplicates[we])X.dump="*ref_"+we;else{if(De&&Ce&&!X.usedDuplicates[we]&&(X.usedDuplicates[we]=!0),ee==="[object Object]")pe&&Object.keys(X.dump).length!==0?(function(Oe,Ve,Ge,qe){var Be,ae,H,ce,se,he,ve="",ye=Oe.tag,Ae=Object.keys(Ge);if(Oe.sortKeys===!0)Ae.sort();else if(typeof Oe.sortKeys=="function")Ae.sort(Oe.sortKeys);else if(Oe.sortKeys)throw new o("sortKeys must be a boolean or a function");for(Be=0,ae=Ae.length;Be<ae;Be+=1)he="",qe&&Be===0||(he+=T(Oe,Ve)),ce=Ge[H=Ae[Be]],z(Oe,Ve+1,H,!0,!0,!0)&&((se=Oe.tag!==null&&Oe.tag!=="?"||Oe.dump&&Oe.dump.length>1024)&&(Oe.dump&&Oe.dump.charCodeAt(0)===10?he+="?":he+="? "),he+=Oe.dump,se&&(he+=T(Oe,Ve)),z(Oe,Ve+1,ce,!0,se)&&(Oe.dump&&Oe.dump.charCodeAt(0)===10?he+=":":he+=": ",ve+=he+=Oe.dump));Oe.tag=ye,Oe.dump=ve||"{}"}(X,re,X.dump,ie),Ce&&(X.dump="&ref_"+we+X.dump)):(function(Oe,Ve,Ge){var qe,Be,ae,H,ce,se="",he=Oe.tag,ve=Object.keys(Ge);for(qe=0,Be=ve.length;qe<Be;qe+=1)ce="",qe!==0&&(ce+=", "),Oe.condenseFlow&&(ce+='"'),H=Ge[ae=ve[qe]],z(Oe,Ve,ae,!1,!1)&&(Oe.dump.length>1024&&(ce+="? "),ce+=Oe.dump+(Oe.condenseFlow?'"':"")+":"+(Oe.condenseFlow?"":" "),z(Oe,Ve,H,!1,!1)&&(se+=ce+=Oe.dump));Oe.tag=he,Oe.dump="{"+se+"}"}(X,re,X.dump),Ce&&(X.dump="&ref_"+we+" "+X.dump));else if(ee==="[object Array]"){var Re=X.noArrayIndent&&re>0?re-1:re;pe&&X.dump.length!==0?(function(Oe,Ve,Ge,qe){var Be,ae,H="",ce=Oe.tag;for(Be=0,ae=Ge.length;Be<ae;Be+=1)z(Oe,Ve+1,Ge[Be],!0,!0)&&(qe&&Be===0||(H+=T(Oe,Ve)),Oe.dump&&Oe.dump.charCodeAt(0)===10?H+="-":H+="- ",H+=Oe.dump);Oe.tag=ce,Oe.dump=H||"[]"}(X,Re,X.dump,ie),Ce&&(X.dump="&ref_"+we+X.dump)):(function(Oe,Ve,Ge){var qe,Be,ae="",H=Oe.tag;for(qe=0,Be=Ge.length;qe<Be;qe+=1)z(Oe,Ve,Ge[qe],!1,!1)&&(qe!==0&&(ae+=","+(Oe.condenseFlow?"":" ")),ae+=Oe.dump);Oe.tag=H,Oe.dump="["+ae+"]"}(X,Re,X.dump),Ce&&(X.dump="&ref_"+we+" "+X.dump))}else{if(ee!=="[object String]"){if(X.skipInvalid)return!1;throw new o("unacceptable kind of an object to dump "+ee)}X.tag!=="?"&&I(X,X.dump,re,te)}X.tag!==null&&X.tag!=="?"&&(X.dump="!<"+X.tag+"> "+X.dump)}return!0}function K(X,re){var fe,pe,ie=[],te=[];for(function ee(we,Ce,De){var Re,Oe,Ve;if(we!==null&&typeof we=="object")if((Oe=Ce.indexOf(we))!==-1)De.indexOf(Oe)===-1&&De.push(Oe);else if(Ce.push(we),Array.isArray(we))for(Oe=0,Ve=we.length;Oe<Ve;Oe+=1)ee(we[Oe],Ce,De);else for(Re=Object.keys(we),Oe=0,Ve=Re.length;Oe<Ve;Oe+=1)ee(we[Re[Oe]],Ce,De)}(X,ie,te),fe=0,pe=te.length;fe<pe;fe+=1)re.duplicates.push(ie[te[fe]]);re.usedDuplicates=new Array(pe)}function J(X,re){var fe=new C(re=re||{});return fe.noRefs||K(X,fe),z(fe,0,X,!0,!0)?fe.dump+`
`:""}n.exports.dump=J,n.exports.safeDump=function(X,re){return J(X,a.extend({schema:l},re))}},function(n,r,i){i(31),i(32),i(33),i(64),i(19),i(65),i(20),i(68),i(92),i(144),i(22),i(94),i(23);var a,o=this&&this.__extends||(a=function(M,I){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,k){A.__proto__=k}||function(A,k){for(var U in k)k.hasOwnProperty(U)&&(A[U]=k[U])})(M,I)},function(M,I){function A(){this.constructor=M}a(M,I),M.prototype=I===null?Object.create(I):(A.prototype=I.prototype,new A)}),s=this&&this.__values||function(M){var I=typeof Symbol=="function"&&Symbol.iterator,A=I&&M[I],k=0;if(A)return A.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&k>=M.length&&(M=void 0),{value:M&&M[k++],done:!M}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__read||function(M,I){var A=typeof Symbol=="function"&&M[Symbol.iterator];if(!A)return M;var k,U,B=A.call(M),z=[];try{for(;(I===void 0||I-- >0)&&!(k=B.next()).done;)z.push(k.value)}catch(K){U={error:K}}finally{try{k&&!k.done&&(A=B.return)&&A.call(B)}finally{if(U)throw U.error}}return z};Object.defineProperty(r,"__esModule",{value:!0});var c=i(91),d=i(1),f=i(183),h=i(0),p=i(7),C=i(95),x=i(69),T=i(3),_=i(305),y=i(306),w=i(307),b=function(M){function I(A,k){k===void 0&&(k=!1);var U=M.call(this)||this;return U._hasDeclaration=!1,U._docTypeName="",U._hasDocumentElement=!1,U._currentElementSerialized=!1,U._openTags=[],U._ended=!1,U._fragment=k,U._options=d.applyDefaults(A||{},c.DefaultXMLBuilderCBOptions),U._builderOptions={defaultNamespace:U._options.defaultNamespace,namespaceAlias:U._options.namespaceAlias},U._options.format==="json"?U._writer=new y.JSONCBWriter(U._options):U._options.format==="yaml"?U._writer=new w.YAMLCBWriter(U._options):U._writer=new _.XMLCBWriter(U._options),U._options.data!==void 0&&U.on("data",U._options.data),U._options.end!==void 0&&U.on("end",U._options.end),U._options.error!==void 0&&U.on("error",U._options.error),U._prefixMap=new C.NamespacePrefixMap,U._prefixMap.set("xml",p.namespace.XML),U._prefixIndex={value:1},U._push(U._writer.frontMatter()),U}return o(I,M),I.prototype.ele=function(A,k,U){var B,z;if(d.isObject(A)||d.isString(A)&&(/^\s*</.test(A)||/^\s*[\{\[]/.test(A)||/^(\s*|(#.*)|(%.*))*---/.test(A))){var K=f.fragment().set(this._options);try{K.ele(A)}catch(fe){return this.emit("error",fe),this}try{for(var J=s(K.node.childNodes),X=J.next();!X.done;X=J.next()){var re=X.value;this._fromNode(re)}}catch(fe){B={error:fe}}finally{try{X&&!X.done&&(z=J.return)&&z.call(J)}finally{if(B)throw B.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&this._writer.level===0)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=f.fragment(this._builderOptions).ele(A,k,U)}catch(fe){return this.emit("error",fe),this}return this._fragment||this._hasDocumentElement||this._docTypeName===""||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},I.prototype.att=function(A,k,U){if(this._currentElement===void 0)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(A,k,U)}catch(B){return this.emit("error",B),this}return this},I.prototype.com=function(A){var k;this._serializeOpenTag(!0);try{k=f.fragment(this._builderOptions).com(A).first().node}catch(U){return this.emit("error",U),this}return!this._options.wellFormed||h.xml_isLegalChar(k.data)&&k.data.indexOf("--")===-1&&!k.data.endsWith("-")?(this._push(this._writer.comment(k.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},I.prototype.txt=function(A){if(!this._fragment&&this._currentElement===void 0)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var k;this._serializeOpenTag(!0);try{k=f.fragment(this._builderOptions).txt(A).first().node}catch(B){return this.emit("error",B),this}if(this._options.wellFormed&&!h.xml_isLegalChar(k.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var U=k.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(U)),this},I.prototype.ins=function(A,k){var U;k===void 0&&(k=""),this._serializeOpenTag(!0);try{U=f.fragment(this._builderOptions).ins(A,k).first().node}catch(B){return this.emit("error",B),this}return this._options.wellFormed&&(U.target.indexOf(":")!==-1||/^xml$/i.test(U.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!h.xml_isLegalChar(U.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(U.target,U.data)),this)},I.prototype.dat=function(A){var k;this._serializeOpenTag(!0);try{k=f.fragment(this._builderOptions).dat(A).first().node}catch(U){return this.emit("error",U),this}return this._push(this._writer.cdata(k.data)),this},I.prototype.dec=function(A){return A===void 0&&(A={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(A.version||"1.0",A.encoding,A.standalone)),this._hasDeclaration=!0,this)},I.prototype.dtd=function(A){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(this._docTypeName!=="")return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var k;try{k=f.create().dtd(A).first().node}catch(U){return this.emit("error",U),this}return this._options.wellFormed&&!h.xml_isPubidChar(k.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!h.xml_isLegalChar(k.systemId)||k.systemId.indexOf('"')!==-1&&k.systemId.indexOf("'")!==-1)?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=A.name,this._push(this._writer.docType(A.name,k.publicId,k.systemId)),this)},I.prototype.import=function(A){var k,U,B=f.fragment().set(this._options);try{B.import(A)}catch(X){return this.emit("error",X),this}try{for(var z=s(B.node.childNodes),K=z.next();!K.done;K=z.next()){var J=K.value;this._fromNode(J)}}catch(X){k={error:X}}finally{try{K&&!K.done&&(U=z.return)&&U.call(z)}finally{if(k)throw k.error}}return this},I.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},I.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},I.prototype._serializeOpenTag=function(A){if(!this._currentElementSerialized&&this._currentElement!==void 0){var k=this._currentElement.node;if(!this._options.wellFormed||k.localName.indexOf(":")===-1&&h.xml_isName(k.localName)){var U="",B=!1,z=this._prefixMap.copy(),K={},J=this._recordNamespaceInformation(k,z,K),X=this._openTags.length===0?null:this._openTags[this._openTags.length-1][1],re=k.namespaceURI;if(re===null&&(re=X),X===re)J!==null&&(B=!0),U=re===p.namespace.XML?"xml:"+k.localName:k.localName,this._writer.beginElement(U),this._push(this._writer.openTagBegin(U));else{var fe=k.prefix,pe=null;if(fe===null&&re===J||(pe=z.get(fe,re)),fe==="xmlns"){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));pe=fe}pe!==null?(U=pe+":"+k.localName,J!==null&&J!==p.namespace.XML&&(X=J||null),this._writer.beginElement(U),this._push(this._writer.openTagBegin(U))):fe!==null?(fe in K&&(fe=this._generatePrefix(re,z,this._prefixIndex)),z.set(fe,re),U+=fe+":"+k.localName,this._writer.beginElement(U),this._push(this._writer.openTagBegin(U)),this._push(this._writer.attribute("xmlns:"+fe,this._serializeAttributeValue(re,this._options.wellFormed))),J!==null&&(X=J||null)):J===null||J!==null&&J!==re?(B=!0,U+=k.localName,X=re,this._writer.beginElement(U),this._push(this._writer.openTagBegin(U)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(re,this._options.wellFormed)))):(U+=k.localName,X=re,this._writer.beginElement(U),this._push(this._writer.openTagBegin(U)))}this._serializeAttributes(k,z,this._prefixIndex,K,B,this._options.wellFormed);var ie=re===p.namespace.HTML;ie&&!A&&I._VoidElementNames.has(k.localName)?(this._push(this._writer.openTagEnd(U,!0,!0)),this._writer.endElement(U)):ie||A?this._push(this._writer.openTagEnd(U,!1,!1)):(this._push(this._writer.openTagEnd(U,!0,!1)),this._writer.endElement(U)),this._currentElementSerialized=!0,this._openTags.push([U,X,this._prefixMap,A]),this._isPrefixMapModified(this._prefixMap,z)&&(this._prefixMap=z),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},I.prototype._serializeCloseTag=function(){this._writer.level--;var A=this._openTags.pop();if(A!==void 0){var k=l(A,4),U=k[0],B=(k[1],k[2]),z=k[3];this._prefixMap=B,z&&(this._push(this._writer.closeTag(U)),this._writer.endElement(U))}else this.emit("error",new Error("Last element is undefined."))},I.prototype._push=function(A){A===null?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):A.length!==0&&(this._writer.hasData=!0,this.emit("data",A,this._writer.level))},I.prototype._fromNode=function(A){var k,U,B,z;if(T.Guard.isElementNode(A)){var K=A.prefix?A.prefix+":"+A.localName:A.localName;A.namespaceURI!==null?this.ele(A.namespaceURI,K):this.ele(K);try{for(var J=s(A.attributes),X=J.next();!X.done;X=J.next()){var re=X.value,fe=re.prefix?re.prefix+":"+re.localName:re.localName;re.namespaceURI!==null?this.att(re.namespaceURI,fe,re.value):this.att(fe,re.value)}}catch(ee){k={error:ee}}finally{try{X&&!X.done&&(U=J.return)&&U.call(J)}finally{if(k)throw k.error}}try{for(var pe=s(A.childNodes),ie=pe.next();!ie.done;ie=pe.next()){var te=ie.value;this._fromNode(te)}}catch(ee){B={error:ee}}finally{try{ie&&!ie.done&&(z=pe.return)&&z.call(pe)}finally{if(B)throw B.error}}this.up()}else T.Guard.isExclusiveTextNode(A)&&A.data?this.txt(A.data):T.Guard.isCommentNode(A)?this.com(A.data):T.Guard.isCDATASectionNode(A)?this.dat(A.data):T.Guard.isProcessingInstructionNode(A)&&this.ins(A.target,A.data)},I.prototype._serializeAttributes=function(A,k,U,B,z,K){var J,X,re=K?new x.LocalNameSet:void 0;try{for(var fe=s(A.attributes),pe=fe.next();!pe.done;pe=fe.next()){var ie=pe.value;if(K||z||ie.namespaceURI!==null){if(K&&re&&re.has(ie.namespaceURI,ie.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));K&&re&&re.set(ie.namespaceURI,ie.localName);var te=ie.namespaceURI,ee=null;if(te!==null)if(ee=k.get(ie.prefix,te),te===p.namespace.XMLNS){if(ie.value===p.namespace.XML||ie.prefix===null&&z||ie.prefix!==null&&(!(ie.localName in B)||B[ie.localName]!==ie.value)&&k.has(ie.localName,ie.value))continue;if(K&&ie.value===p.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(K&&ie.value==="")return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));ie.prefix==="xmlns"&&(ee="xmlns")}else ee===null&&(ee=ie.prefix===null||k.hasPrefix(ie.prefix)&&!k.has(ie.prefix,te)?this._generatePrefix(te,k,U):ie.prefix,this._push(this._writer.attribute("xmlns:"+ee,this._serializeAttributeValue(te,this._options.wellFormed))));if(K&&(ie.localName.indexOf(":")!==-1||!h.xml_isName(ie.localName)||ie.localName==="xmlns"&&te===null))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((ee!==null?ee+":":"")+ie.localName,this._serializeAttributeValue(ie.value,this._options.wellFormed)))}else this._push(this._writer.attribute(ie.localName,this._serializeAttributeValue(ie.value,this._options.wellFormed)))}}catch(we){J={error:we}}finally{try{pe&&!pe.done&&(X=fe.return)&&X.call(fe)}finally{if(J)throw J.error}}},I.prototype._serializeAttributeValue=function(A,k){return k&&A!==null&&!h.xml_isLegalChar(A)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):A===null?"":A.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},I.prototype._recordNamespaceInformation=function(A,k,U){var B,z,K=null;try{for(var J=s(A.attributes),X=J.next();!X.done;X=J.next()){var re=X.value,fe=re.namespaceURI,pe=re.prefix;if(fe===p.namespace.XMLNS){if(pe===null){K=re.value;continue}var ie=re.localName,te=re.value;if(te===p.namespace.XML||(te===""&&(te=null),k.has(ie,te)))continue;k.set(ie,te),U[ie]=te||""}}}catch(ee){B={error:ee}}finally{try{X&&!X.done&&(z=J.return)&&z.call(J)}finally{if(B)throw B.error}}return K},I.prototype._generatePrefix=function(A,k,U){var B="ns"+U.value;return U.value++,k.set(B,A),B},I.prototype._isPrefixMapModified=function(A,k){var U=A._items,B=k._items,z=A._nullItems,K=k._nullItems;for(var J in B){var X=U[J];if(X===void 0)return!0;var re=B[J];if(X.length!==re.length)return!0;for(var fe=0;fe<X.length;fe++)if(X[fe]!==re[fe])return!0}if(z.length!==K.length)return!0;for(fe=0;fe<z.length;fe++)if(z[fe]!==K[fe])return!0;return!1},I._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),I}(i(308).EventEmitter);r.XMLBuilderCBImpl=b},function(n,r,i){i(74);var a,o=this&&this.__extends||(a=function(l,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,f){d.__proto__=f}||function(d,f){for(var h in f)f.hasOwnProperty(h)&&(d[h]=f[h])})(l,c)},function(l,c){function d(){this.constructor=l}a(l,c),l.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(l){function c(d){var f=l.call(this,d)||this;return f._lineLength=0,f}return o(c,l),c.prototype.frontMatter=function(){return""},c.prototype.declaration=function(d,f,h){var p=this._beginLine()+"<?xml";return p+=' version="'+d+'"',f!==void 0&&(p+=' encoding="'+f+'"'),h!==void 0&&(p+=' standalone="'+(h?"yes":"no")+'"'),p+="?>"},c.prototype.docType=function(d,f,h){var p=this._beginLine();return p+=f&&h?"<!DOCTYPE "+d+' PUBLIC "'+f+'" "'+h+'">':f?"<!DOCTYPE "+d+' PUBLIC "'+f+'">':h?"<!DOCTYPE "+d+' SYSTEM "'+h+'">':"<!DOCTYPE "+d+">"},c.prototype.comment=function(d){return this._beginLine()+"<!--"+d+"-->"},c.prototype.text=function(d){return this._beginLine()+d},c.prototype.instruction=function(d,f){return f?this._beginLine()+"<?"+d+" "+f+"?>":this._beginLine()+"<?"+d+"?>"},c.prototype.cdata=function(d){return this._beginLine()+"<![CDATA["+d+"]]>"},c.prototype.openTagBegin=function(d){return this._lineLength+=1+d.length,this._beginLine()+"<"+d},c.prototype.openTagEnd=function(d,f,h){return h?" />":f?this._writerOptions.allowEmptyTags?"></"+d+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},c.prototype.closeTag=function(d){return this._beginLine()+"</"+d+">"},c.prototype.attribute=function(d,f){var h=d+'="'+f+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+h.length>this._writerOptions.width?(h=this._beginLine()+this._indent(1)+h,this._lineLength=h.length,h):(this._lineLength+=1+h.length," "+h)},c.prototype.beginElement=function(d){},c.prototype.endElement=function(d){},c.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var d=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=d.length,d}return""},c.prototype._indent=function(d){return d<=0?"":this._writerOptions.indent.repeat(d)},c}(i(114).BaseCBWriter);r.XMLCBWriter=s},function(n,r,i){i(74);var a,o=this&&this.__extends||(a=function(l,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,f){d.__proto__=f}||function(d,f){for(var h in f)f.hasOwnProperty(h)&&(d[h]=f[h])})(l,c)},function(l,c){function d(){this.constructor=l}a(l,c),l.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(l){function c(d){var f=l.call(this,d)||this;return f._hasChildren=[],f._additionalLevel=0,f}return o(c,l),c.prototype.frontMatter=function(){return""},c.prototype.declaration=function(d,f,h){return""},c.prototype.docType=function(d,f,h){return""},c.prototype.comment=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(d)+this._sep()+"}"},c.prototype.text=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(d)+this._sep()+"}"},c.prototype.instruction=function(d,f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(f?d+" "+f:d)+this._sep()+"}"},c.prototype.cdata=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(d)+this._sep()+"}"},c.prototype.attribute=function(d,f){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+d)+this._sep()+this._val(f)+this._sep()+"}"},c.prototype.openTagBegin=function(d){var f=this._comma()+this._beginLine()+"{"+this._sep()+this._key(d)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,f+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),f},c.prototype.openTagEnd=function(d,f,h){if(f){var p=this._sep()+"]";return this._additionalLevel--,p+=this._beginLine()+"}"+this._sep()+"}"}return""},c.prototype.closeTag=function(d){var f=this._beginLine()+"]";return this._additionalLevel--,f+=this._beginLine()+"}"+this._sep()+"}"},c.prototype.beginElement=function(d){},c.prototype.endElement=function(d){this._hasChildren.pop()},c.prototype._beginLine=function(d){return d===void 0&&(d=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+d):""},c.prototype._indent=function(d){return d+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(d+this._additionalLevel)},c.prototype._comma=function(){var d=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),d},c.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},c.prototype._key=function(d){return'"'+d+'":'},c.prototype._val=function(d){return JSON.stringify(d)},c}(i(114).BaseCBWriter);r.JSONCBWriter=s},function(n,r,i){i(74);var a,o=this&&this.__extends||(a=function(l,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,f){d.__proto__=f}||function(d,f){for(var h in f)f.hasOwnProperty(h)&&(d[h]=f[h])})(l,c)},function(l,c){function d(){this.constructor=l}a(l,c),l.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(l){function c(d){var f=l.call(this,d)||this;if(f._rootWritten=!1,f._additionalLevel=0,d.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(d.offset<0)throw new Error("YAML offset should be zero or a positive number.");return f}return o(c,l),c.prototype.frontMatter=function(){return this._beginLine()+"---"},c.prototype.declaration=function(d,f,h){return""},c.prototype.docType=function(d,f,h){return""},c.prototype.comment=function(d){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(d)},c.prototype.text=function(d){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(d)},c.prototype.instruction=function(d,f){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(f?d+" "+f:d)},c.prototype.cdata=function(d){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(d)},c.prototype.attribute=function(d,f){this._additionalLevel++;var h=this._beginLine()+this._key(this._builderOptions.convert.att+d)+" "+this._val(f);return this._additionalLevel--,h},c.prototype.openTagBegin=function(d){var f=this._beginLine()+this._key(d);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,f+=this._beginLine(!0)+this._key(this._builderOptions.convert.text)},c.prototype.openTagEnd=function(d,f,h){return f?" "+this._val(""):""},c.prototype.closeTag=function(d){return this._additionalLevel--,""},c.prototype.beginElement=function(d){},c.prototype.endElement=function(d){},c.prototype._beginLine=function(d){return d===void 0&&(d=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,d)},c.prototype._indent=function(d,f){if(d+this._additionalLevel<=0)return"";var h=this._writerOptions.indent.repeat(d+this._additionalLevel);return!f&&this._rootWritten?h.substr(0,h.length-2)+"-"+h.substr(-1,1):h},c.prototype._key=function(d){return'"'+d+'":'},c.prototype._val=function(d){return JSON.stringify(d)},c}(i(114).BaseCBWriter);r.YAMLCBWriter=s},function(n,r,i){var a,o=typeof Reflect=="object"?Reflect:null,s=o&&typeof o.apply=="function"?o.apply:function(w,b,M){return Function.prototype.apply.call(w,b,M)};a=o&&typeof o.ownKeys=="function"?o.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var l=Number.isNaN||function(w){return w!=w};function c(){c.init.call(this)}n.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var d=10;function f(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function h(w){return w._maxListeners===void 0?c.defaultMaxListeners:w._maxListeners}function p(w,b,M,I){var A,k,U,B;if(f(M),(k=w._events)===void 0?(k=w._events=Object.create(null),w._eventsCount=0):(k.newListener!==void 0&&(w.emit("newListener",b,M.listener?M.listener:M),k=w._events),U=k[b]),U===void 0)U=k[b]=M,++w._eventsCount;else if(typeof U=="function"?U=k[b]=I?[M,U]:[U,M]:I?U.unshift(M):U.push(M),(A=h(w))>0&&U.length>A&&!U.warned){U.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=w,z.type=b,z.count=U.length,B=z,console&&console.warn&&console.warn(B)}return w}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(w,b,M){var I={fired:!1,wrapFn:void 0,target:w,type:b,listener:M},A=C.bind(I);return A.listener=M,I.wrapFn=A,A}function T(w,b,M){var I=w._events;if(I===void 0)return[];var A=I[b];return A===void 0?[]:typeof A=="function"?M?[A.listener||A]:[A]:M?function(k){for(var U=new Array(k.length),B=0;B<U.length;++B)U[B]=k[B].listener||k[B];return U}(A):y(A,A.length)}function _(w){var b=this._events;if(b!==void 0){var M=b[w];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}function y(w,b){for(var M=new Array(b),I=0;I<b;++I)M[I]=w[I];return M}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(w){if(typeof w!="number"||w<0||l(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");d=w}}),c.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||l(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(w){for(var b=[],M=1;M<arguments.length;M++)b.push(arguments[M]);var I=w==="error",A=this._events;if(A!==void 0)I=I&&A.error===void 0;else if(!I)return!1;if(I){var k;if(b.length>0&&(k=b[0]),k instanceof Error)throw k;var U=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw U.context=k,U}var B=A[w];if(B===void 0)return!1;if(typeof B=="function")s(B,this,b);else{var z=B.length,K=y(B,z);for(M=0;M<z;++M)s(K[M],this,b)}return!0},c.prototype.addListener=function(w,b){return p(this,w,b,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(w,b){return p(this,w,b,!0)},c.prototype.once=function(w,b){return f(b),this.on(w,x(this,w,b)),this},c.prototype.prependOnceListener=function(w,b){return f(b),this.prependListener(w,x(this,w,b)),this},c.prototype.removeListener=function(w,b){var M,I,A,k,U;if(f(b),(I=this._events)===void 0)return this;if((M=I[w])===void 0)return this;if(M===b||M.listener===b)--this._eventsCount==0?this._events=Object.create(null):(delete I[w],I.removeListener&&this.emit("removeListener",w,M.listener||b));else if(typeof M!="function"){for(A=-1,k=M.length-1;k>=0;k--)if(M[k]===b||M[k].listener===b){U=M[k].listener,A=k;break}if(A<0)return this;A===0?M.shift():function(B,z){for(;z+1<B.length;z++)B[z]=B[z+1];B.pop()}(M,A),M.length===1&&(I[w]=M[0]),I.removeListener!==void 0&&this.emit("removeListener",w,U||b)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(w){var b,M,I;if((M=this._events)===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[w]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete M[w]),this;if(arguments.length===0){var A,k=Object.keys(M);for(I=0;I<k.length;++I)(A=k[I])!=="removeListener"&&this.removeAllListeners(A);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(b=M[w])=="function")this.removeListener(w,b);else if(b!==void 0)for(I=b.length-1;I>=0;I--)this.removeListener(w,b[I]);return this},c.prototype.listeners=function(w){return T(this,w,!0)},c.prototype.rawListeners=function(w){return T(this,w,!1)},c.listenerCount=function(w,b){return typeof w.listenerCount=="function"?w.listenerCount(b):_.call(w,b)},c.prototype.listenerCount=_,c.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},function(n,r,i){Object.defineProperty(r,"__esModule",{value:!0});var a=i(77);r.createCB=function(o){return new a.XMLBuilderCBImpl(o)},r.fragmentCB=function(o){return new a.XMLBuilderCBImpl(o,!0)}}])})})(FG);var I5e=FG.exports,NM={},O5e=function(t,e,n,r,i){var a=new Worker(NM[e]||(NM[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return a.onmessage=function(o){var s=o.data,l=s.$e$;if(l){var c=new Error(l[0]);c.code=l[1],c.stack=l[2],i(c,null)}else i(null,s)},a.postMessage(n,r),a},An=Uint8Array,Vi=Uint16Array,id=Uint32Array,ad=new An([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),od=new An([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qg=new An([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),VG=function(t,e){for(var n=new Vi(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new id(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return[n,i]},UG=VG(ad,2),y8=UG[0],A2=UG[1];y8[28]=258,A2[258]=28;var BG=VG(od,0),GG=BG[0],Hx=BG[1],Xg=new Vi(32768);for(var gr=0;gr<32768;++gr){var bl=(gr&43690)>>>1|(gr&21845)<<1;bl=(bl&52428)>>>2|(bl&13107)<<2,bl=(bl&61680)>>>4|(bl&3855)<<4,Xg[gr]=((bl&65280)>>>8|(bl&255)<<8)>>>1}var oo=function(t,e,n){for(var r=t.length,i=0,a=new Vi(e);i<r;++i)t[i]&&++a[t[i]-1];var o=new Vi(e);for(i=0;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(n){s=new Vi(1<<e);var l=15-e;for(i=0;i<r;++i)if(t[i])for(var c=i<<4|t[i],d=e-t[i],f=o[t[i]-1]++<<d,h=f|(1<<d)-1;f<=h;++f)s[Xg[f]>>>l]=c}else for(s=new Vi(r),i=0;i<r;++i)t[i]&&(s[i]=Xg[o[t[i]-1]++]>>>15-t[i]);return s},sl=new An(288);for(var gr=0;gr<144;++gr)sl[gr]=8;for(var gr=144;gr<256;++gr)sl[gr]=9;for(var gr=256;gr<280;++gr)sl[gr]=7;for(var gr=280;gr<288;++gr)sl[gr]=8;var Gf=new An(32);for(var gr=0;gr<32;++gr)Gf[gr]=5;var zG=oo(sl,9,0),WG=oo(sl,9,1),jG=oo(Gf,5,0),HG=oo(Gf,5,1),dv=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Ya=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},hv=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},xp=function(t){return(t+7)/8|0},so=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t.BYTES_PER_ELEMENT==2?Vi:t.BYTES_PER_ELEMENT==4?id:An)(n-e);return r.set(t.subarray(e,n)),r},M5e={UnexpectedEOF:0,InvalidBlockType:1,InvalidLengthLiteral:2,InvalidDistance:3,StreamFinished:4,NoStreamHandler:5,InvalidHeader:6,NoCallback:7,InvalidUTF8:8,ExtraFieldTooLong:9,InvalidDate:10,FilenameTooLong:11,StreamFinishing:12,InvalidZipData:13,UnknownCompressionMethod:14},$G=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],jt=function(t,e,n){var r=new Error(e||$G[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,jt),!n)throw r;return r},Sp=function(t,e,n){var r=t.length;if(!r||n&&n.f&&!n.l)return e||new An(0);var i=!e||n,a=!n||n.i;n||(n={}),e||(e=new An(r*3));var o=function(Ve){var Ge=e.length;if(Ve>Ge){var qe=new An(Math.max(Ge*2,Ve));qe.set(e),e=qe}},s=n.f||0,l=n.p||0,c=n.b||0,d=n.l,f=n.d,h=n.m,p=n.n,C=r*8;do{if(!d){s=Ya(t,l,1);var x=Ya(t,l+1,3);if(l+=3,x)if(x==1)d=WG,f=HG,h=9,p=5;else if(x==2){var w=Ya(t,l,31)+257,b=Ya(t,l+10,15)+4,M=w+Ya(t,l+5,31)+1;l+=14;for(var I=new An(M),A=new An(19),k=0;k<b;++k)A[qg[k]]=Ya(t,l+k*3,7);l+=b*3;for(var U=dv(A),B=(1<<U)-1,z=oo(A,U,1),k=0;k<M;){var K=z[Ya(t,l,B)];l+=K&15;var T=K>>>4;if(T<16)I[k++]=T;else{var J=0,X=0;for(T==16?(X=3+Ya(t,l,3),l+=2,J=I[k-1]):T==17?(X=3+Ya(t,l,7),l+=3):T==18&&(X=11+Ya(t,l,127),l+=7);X--;)I[k++]=J}}var re=I.subarray(0,w),fe=I.subarray(w);h=dv(re),p=dv(fe),d=oo(re,h,1),f=oo(fe,p,1)}else jt(1);else{var T=xp(l)+4,_=t[T-4]|t[T-3]<<8,y=T+_;if(y>r){a&&jt(0);break}i&&o(c+_),e.set(t.subarray(T,y),c),n.b=c+=_,n.p=l=y*8,n.f=s;continue}if(l>C){a&&jt(0);break}}i&&o(c+131072);for(var pe=(1<<h)-1,ie=(1<<p)-1,te=l;;te=l){var J=d[hv(t,l)&pe],ee=J>>>4;if(l+=J&15,l>C){a&&jt(0);break}if(J||jt(2),ee<256)e[c++]=ee;else if(ee==256){te=l,d=null;break}else{var we=ee-254;if(ee>264){var k=ee-257,Ce=ad[k];we=Ya(t,l,(1<<Ce)-1)+y8[k],l+=Ce}var De=f[hv(t,l)&ie],Re=De>>>4;De||jt(3),l+=De&15;var fe=GG[Re];if(Re>3){var Ce=od[Re];fe+=hv(t,l)&(1<<Ce)-1,l+=Ce}if(l>C){a&&jt(0);break}i&&o(c+131072);for(var Oe=c+we;c<Oe;c+=4)e[c]=e[c-fe],e[c+1]=e[c+1-fe],e[c+2]=e[c+2-fe],e[c+3]=e[c+3-fe];c=Oe}}n.l=d,n.p=te,n.b=c,n.f=s,d&&(s=1,n.m=h,n.d=f,n.n=p)}while(!s);return c==e.length?e:so(e,0,c)},ts=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8},z0=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},gv=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,a=n.slice();if(!i)return[$s,0];if(i==1){var o=new An(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort(function(M,I){return M.f-I.f}),n.push({s:-1,f:25001});var s=n[0],l=n[1],c=0,d=1,f=2;for(n[0]={s:-1,f:s.f+l.f,l:s,r:l};d!=i-1;)s=n[n[c].f<n[f].f?c++:f++],l=n[c!=d&&n[c].f<n[f].f?c++:f++],n[d++]={s:-1,f:s.f+l.f,l:s,r:l};for(var h=a[0].s,r=1;r<i;++r)a[r].s>h&&(h=a[r].s);var p=new Vi(h+1),C=L2(n[d-1],p,0);if(C>e){var r=0,x=0,T=C-e,_=1<<T;for(a.sort(function(I,A){return p[A.s]-p[I.s]||I.f-A.f});r<i;++r){var y=a[r].s;if(p[y]>e)x+=_-(1<<C-p[y]),p[y]=e;else break}for(x>>>=T;x>0;){var w=a[r].s;p[w]<e?x-=1<<e-p[w]++-1:++r}for(;r>=0&&x;--r){var b=a[r].s;p[b]==e&&(--p[b],++x)}C=e}return[new An(p),C]},L2=function(t,e,n){return t.s==-1?Math.max(L2(t.l,e,n+1),L2(t.r,e,n+1)):e[t.s]=n},$x=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Vi(++e),r=0,i=t[0],a=1,o=function(l){n[r++]=l},s=1;s<=e;++s)if(t[s]==i&&s!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=t[s]}return[n.subarray(0,r),e]},W0=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},k2=function(t,e,n){var r=n.length,i=xp(e+2);t[i]=r&255,t[i+1]=r>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var a=0;a<r;++a)t[i+a+4]=n[a];return(i+4+r)*8},Kx=function(t,e,n,r,i,a,o,s,l,c,d){ts(e,d++,n),++i[256];for(var f=gv(i,15),h=f[0],p=f[1],C=gv(a,15),x=C[0],T=C[1],_=$x(h),y=_[0],w=_[1],b=$x(x),M=b[0],I=b[1],A=new Vi(19),k=0;k<y.length;++k)A[y[k]&31]++;for(var k=0;k<M.length;++k)A[M[k]&31]++;for(var U=gv(A,7),B=U[0],z=U[1],K=19;K>4&&!B[qg[K-1]];--K);var J=c+5<<3,X=W0(i,sl)+W0(a,Gf)+o,re=W0(i,h)+W0(a,x)+o+14+3*K+W0(A,B)+(2*A[16]+3*A[17]+7*A[18]);if(J<=X&&J<=re)return k2(e,d,t.subarray(l,l+c));var fe,pe,ie,te;if(ts(e,d,1+(re<X)),d+=2,re<X){fe=oo(h,p,0),pe=h,ie=oo(x,T,0),te=x;var ee=oo(B,z,0);ts(e,d,w-257),ts(e,d+5,I-1),ts(e,d+10,K-4),d+=14;for(var k=0;k<K;++k)ts(e,d+3*k,B[qg[k]]);d+=3*K;for(var we=[y,M],Ce=0;Ce<2;++Ce)for(var De=we[Ce],k=0;k<De.length;++k){var Re=De[k]&31;ts(e,d,ee[Re]),d+=B[Re],Re>15&&(ts(e,d,De[k]>>>5&127),d+=De[k]>>>12)}}else fe=zG,pe=sl,ie=jG,te=Gf;for(var k=0;k<s;++k)if(r[k]>255){var Re=r[k]>>>18&31;z0(e,d,fe[Re+257]),d+=pe[Re+257],Re>7&&(ts(e,d,r[k]>>>23&31),d+=ad[Re]);var Oe=r[k]&31;z0(e,d,ie[Oe]),d+=te[Oe],Oe>3&&(z0(e,d,r[k]>>>5&8191),d+=od[Oe])}else z0(e,d,fe[r[k]]),d+=pe[r[k]];return z0(e,d,fe[256]),d+pe[256]},KG=new id([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$s=new An(0),qG=function(t,e,n,r,i,a){var o=t.length,s=new An(r+o+5*(1+Math.ceil(o/7e3))+i),l=s.subarray(r,s.length-i),c=0;if(!e||o<8)for(var d=0;d<=o;d+=65535){var f=d+65535;f>=o&&(l[c>>3]=a),c=k2(l,c+1,t.subarray(d,f))}else{for(var h=KG[e-1],p=h>>>13,C=h&8191,x=(1<<n)-1,T=new Vi(32768),_=new Vi(x+1),y=Math.ceil(n/3),w=2*y,b=function(he){return(t[he]^t[he+1]<<y^t[he+2]<<w)&x},M=new id(25e3),I=new Vi(288),A=new Vi(32),k=0,U=0,d=0,B=0,z=0,K=0;d<o;++d){var J=b(d),X=d&32767,re=_[J];if(T[X]=re,_[J]=X,z<=d){var fe=o-d;if((k>7e3||B>24576)&&fe>423){c=Kx(t,l,0,M,I,A,U,B,K,d-K,c),B=k=U=0,K=d;for(var pe=0;pe<286;++pe)I[pe]=0;for(var pe=0;pe<30;++pe)A[pe]=0}var ie=2,te=0,ee=C,we=X-re&32767;if(fe>2&&J==b(d-we))for(var Ce=Math.min(p,fe)-1,De=Math.min(32767,d),Re=Math.min(258,fe);we<=De&&--ee&&X!=re;){if(t[d+ie]==t[d+ie-we]){for(var Oe=0;Oe<Re&&t[d+Oe]==t[d+Oe-we];++Oe);if(Oe>ie){if(ie=Oe,te=we,Oe>Ce)break;for(var Ve=Math.min(we,Oe-2),Ge=0,pe=0;pe<Ve;++pe){var qe=d-we+pe+32768&32767,Be=T[qe],ae=qe-Be+32768&32767;ae>Ge&&(Ge=ae,re=qe)}}}X=re,re=T[X],we+=X-re+32768&32767}if(te){M[B++]=268435456|A2[ie]<<18|Hx[te];var H=A2[ie]&31,ce=Hx[te]&31;U+=ad[H]+od[ce],++I[257+H],++A[ce],z=d+ie,++k}else M[B++]=t[d],++I[t[d]]}}c=Kx(t,l,a,M,I,A,U,B,K,d-K,c),!a&&c&7&&(c=k2(l,c+1,$s))}return so(s,0,r+xp(c)+i)},XG=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t}(),sd=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=XG[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}},w8=function(){var t=1,e=0;return{p:function(n){for(var r=t,i=e,a=n.length|0,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=r+=n[o];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}t=r,e=i},d:function(){return t%=65521,e%=65521,(t&255)<<24|t>>>8<<16|(e&255)<<8|e>>>8}}},qu=function(t,e,n,r,i){return qG(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,n,r,!i)},Ep=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},RM=function(t,e,n){for(var r=t(),i=t.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var s=r[o],l=a[o];if(typeof s=="function"){e+=";"+l+"=";var c=s.toString();if(s.prototype)if(c.indexOf("[native code]")!=-1){var d=c.indexOf(" ",8)+1;e+=c.slice(d,c.indexOf("(",d))}else{e+=c;for(var f in s.prototype)e+=";"+l+".prototype."+f+"="+s.prototype[f].toString()}else e+=c}else n[l]=s}return[e,n]},Fm=[],N5e=function(t){var e=[];for(var n in t)t[n].buffer&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e},YG=function(t,e,n,r){var i;if(!Fm[n]){for(var a="",o={},s=t.length-1,l=0;l<s;++l)i=RM(t[l],a,o),a=i[0],o=i[1];Fm[n]=RM(t[s],a,o)}var c=Ep({},Fm[n][1]);return O5e(Fm[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,c,N5e(c),r)},ld=function(){return[An,Vi,id,ad,od,qg,y8,GG,WG,HG,Xg,$G,oo,dv,Ya,hv,xp,so,jt,Sp,dd,wc,C8]},cd=function(){return[An,Vi,id,ad,od,qg,A2,Hx,zG,sl,jG,Gf,Xg,KG,$s,oo,ts,z0,gv,L2,$x,W0,k2,Kx,xp,so,qG,qu,Tp,wc]},JG=function(){return[x8,E8,jn,sd,XG]},ZG=function(){return[S8,tz]},QG=function(){return[T8,jn,w8]},ez=function(){return[nz]},wc=function(t){return postMessage(t,[t.buffer])},C8=function(t){return t&&t.size&&new An(t.size)},ud=function(t,e,n,r,i,a){var o=YG(n,r,i,function(s,l){o.terminate(),a(s,l)});return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}},go=function(t){return t.ondata=function(e,n){return postMessage([e,n],[e.buffer])},function(e){return t.push(e.data[0],e.data[1])}},fd=function(t,e,n,r,i){var a,o=YG(t,r,i,function(s,l){s?(o.terminate(),e.ondata.call(e,s)):(l[1]&&o.terminate(),e.ondata.call(e,s,l[0],l[1]))});o.postMessage(n),e.push=function(s,l){e.ondata||jt(5),a&&e.ondata(jt(4,0,1),null,!!l),o.postMessage([s,a=l],[s.buffer])},e.terminate=function(){o.terminate()}},ta=function(t,e){return t[e]|t[e+1]<<8},Wr=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},K4=function(t,e){return Wr(t,e)+Wr(t,e+4)*4294967296},jn=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},x8=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:e.level==9?2:0,t[9]=3,e.mtime!=0&&jn(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var r=0;r<=n.length;++r)t[r+10]=n.charCodeAt(r)}},S8=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&jt(6,"invalid gzip data");var e=t[3],n=10;e&4&&(n+=t[10]|(t[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(e&2)},tz=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},E8=function(t){return 10+(t.filename&&t.filename.length+1||0)},T8=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;t[0]=120,t[1]=r<<6|(r?32-2*r:1)},nz=function(t){((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&jt(6,"invalid zlib data"),t[1]&32&&jt(6,"invalid zlib data: preset dictionaries not supported")};function _8(t,e){return!e&&typeof t=="function"&&(e=t,t={}),this.ondata=e,t}var ms=function(){function t(e,n){!n&&typeof e=="function"&&(n=e,e={}),this.ondata=n,this.o=e||{}}return t.prototype.p=function(e,n){this.ondata(qu(e,this.o,0,0,!n),n)},t.prototype.push=function(e,n){this.ondata||jt(5),this.d&&jt(4),this.d=n,this.p(e,n||!1)},t}(),rz=function(){function t(e,n){fd([cd,function(){return[go,ms]}],this,_8.call(this,e,n),function(r){var i=new ms(r.data);onmessage=go(i)},6)}return t}();function iz(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[cd],function(r){return wc(Tp(r.data[0],r.data[1]))},0,n)}function Tp(t,e){return qu(t,e||{},0,0)}var xa=function(){function t(e){this.s={},this.p=new An(0),this.ondata=e}return t.prototype.e=function(e){this.ondata||jt(5),this.d&&jt(4);var n=this.p.length,r=new An(n+e.length);r.set(this.p),r.set(e,n),this.p=r},t.prototype.c=function(e){this.d=this.s.i=e||!1;var n=this.s.b,r=Sp(this.p,this.o,this.s);this.ondata(so(r,n,this.s.b),this.d),this.o=so(r,this.s.b-32768),this.s.b=this.o.length,this.p=so(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(e,n){this.e(e),this.c(n)},t}(),D8=function(){function t(e){this.ondata=e,fd([ld,function(){return[go,xa]}],this,0,function(){var n=new xa;onmessage=go(n)},7)}return t}();function b8(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[ld],function(r){return wc(dd(r.data[0],C8(r.data[1])))},1,n)}function dd(t,e){return Sp(t,e)}var P2=function(){function t(e,n){this.c=sd(),this.l=0,this.v=1,ms.call(this,e,n)}return t.prototype.push=function(e,n){ms.prototype.push.call(this,e,n)},t.prototype.p=function(e,n){this.c.p(e),this.l+=e.length;var r=qu(e,this.o,this.v&&E8(this.o),n&&8,!n);this.v&&(x8(r,this.o),this.v=0),n&&(jn(r,r.length-8,this.c.d()),jn(r,r.length-4,this.l)),this.ondata(r,n)},t}(),AM=function(){function t(e,n){fd([cd,JG,function(){return[go,ms,P2]}],this,_8.call(this,e,n),function(r){var i=new P2(r.data);onmessage=go(i)},8)}return t}();function LM(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[cd,JG,function(){return[F2]}],function(r){return wc(F2(r.data[0],r.data[1]))},2,n)}function F2(t,e){e||(e={});var n=sd(),r=t.length;n.p(t);var i=qu(t,e,E8(e),8),a=i.length;return x8(i,e),jn(i,a-8,n.d()),jn(i,a-4,r),i}var V2=function(){function t(e){this.v=1,xa.call(this,e)}return t.prototype.push=function(e,n){if(xa.prototype.e.call(this,e),this.v){var r=this.p.length>3?S8(this.p):4;if(r>=this.p.length&&!n)return;this.p=this.p.subarray(r),this.v=0}n&&(this.p.length<8&&jt(6,"invalid gzip data"),this.p=this.p.subarray(0,-8)),xa.prototype.c.call(this,n)},t}(),az=function(){function t(e){this.ondata=e,fd([ld,ZG,function(){return[go,xa,V2]}],this,0,function(){var n=new V2;onmessage=go(n)},9)}return t}();function oz(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[ld,ZG,function(){return[U2]}],function(r){return wc(U2(r.data[0]))},3,n)}function U2(t,e){return Sp(t.subarray(S8(t),-8),e||new An(tz(t)))}var qx=function(){function t(e,n){this.c=w8(),this.v=1,ms.call(this,e,n)}return t.prototype.push=function(e,n){ms.prototype.push.call(this,e,n)},t.prototype.p=function(e,n){this.c.p(e);var r=qu(e,this.o,this.v&&2,n&&4,!n);this.v&&(T8(r,this.o),this.v=0),n&&jn(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),R5e=function(){function t(e,n){fd([cd,QG,function(){return[go,ms,qx]}],this,_8.call(this,e,n),function(r){var i=new qx(r.data);onmessage=go(i)},10)}return t}();function A5e(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[cd,QG,function(){return[Xx]}],function(r){return wc(Xx(r.data[0],r.data[1]))},4,n)}function Xx(t,e){e||(e={});var n=w8();n.p(t);var r=qu(t,e,2,4);return T8(r,e),jn(r,r.length-4,n.d()),r}var B2=function(){function t(e){this.v=1,xa.call(this,e)}return t.prototype.push=function(e,n){if(xa.prototype.e.call(this,e),this.v){if(this.p.length<2&&!n)return;this.p=this.p.subarray(2),this.v=0}n&&(this.p.length<4&&jt(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),xa.prototype.c.call(this,n)},t}(),sz=function(){function t(e){this.ondata=e,fd([ld,ez,function(){return[go,xa,B2]}],this,0,function(){var n=new B2;onmessage=go(n)},11)}return t}();function lz(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),ud(t,e,[ld,ez,function(){return[G2]}],function(r){return wc(G2(r.data[0],C8(r.data[1])))},5,n)}function G2(t,e){return Sp((nz(t),t.subarray(2,-4)),e)}var cz=function(){function t(e){this.G=V2,this.I=xa,this.Z=B2,this.ondata=e}return t.prototype.push=function(e,n){if(this.ondata||jt(5),this.s)this.s.push(e,n);else{if(this.p&&this.p.length){var r=new An(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,a=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(a):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,n),this.p=null}}},t}(),L5e=function(){function t(e){this.G=az,this.I=D8,this.Z=sz,this.ondata=e}return t.prototype.push=function(e,n){cz.prototype.push.call(this,e,n)},t}();function k5e(t,e,n){return n||(n=e,e={}),typeof n!="function"&&jt(7),t[0]==31&&t[1]==139&&t[2]==8?oz(t,e,n):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?b8(t,e,n):lz(t,e,n)}function uz(t,e){return t[0]==31&&t[1]==139&&t[2]==8?U2(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?dd(t,e):G2(t,e)}var I8=function(t,e,n,r){for(var i in t){var a=t[i],o=e+i,s=r;Array.isArray(a)&&(s=Ep(r,a[1]),a=a[0]),a instanceof An?n[o]=[a,s]:(n[o+="/"]=[new An(0),s],I8(a,o,n,r))}},kM=typeof TextEncoder<"u"&&new TextEncoder,Yx=typeof TextDecoder<"u"&&new TextDecoder,fz=0;try{Yx.decode($s,{stream:!0}),fz=1}catch{}var dz=function(t){for(var e="",n=0;;){var r=t[n++],i=(r>127)+(r>223)+(r>239);if(n+i>t.length)return[e,so(t,n-1)];i?i==3?(r=((r&15)<<18|(t[n++]&63)<<12|(t[n++]&63)<<6|t[n++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|t[n++]&63):e+=String.fromCharCode((r&15)<<12|(t[n++]&63)<<6|t[n++]&63):e+=String.fromCharCode(r)}},P5e=function(){function t(e){this.ondata=e,fz?this.t=new TextDecoder:this.p=$s}return t.prototype.push=function(e,n){if(this.ondata||jt(5),n=!!n,this.t){this.ondata(this.t.decode(e,{stream:!0}),n),n&&(this.t.decode().length&&jt(8),this.t=null);return}this.p||jt(4);var r=new An(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var i=dz(r),a=i[0],o=i[1];n?(o.length&&jt(8),this.p=null):this.p=o,this.ondata(a,n)},t}(),F5e=function(){function t(e){this.ondata=e}return t.prototype.push=function(e,n){this.ondata||jt(5),this.d&&jt(4),this.ondata(fc(e),this.d=n||!1)},t}();function fc(t,e){if(e){for(var n=new An(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(kM)return kM.encode(t);for(var i=t.length,a=new An(t.length+(t.length>>1)),o=0,s=function(d){a[o++]=d},r=0;r<i;++r){if(o+5>a.length){var l=new An(o+8+(i-r<<1));l.set(a),a=l}var c=t.charCodeAt(r);c<128||e?s(c):c<2048?(s(192|c>>6),s(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|t.charCodeAt(++r)&1023,s(240|c>>18),s(128|c>>12&63),s(128|c>>6&63),s(128|c&63)):(s(224|c>>12),s(128|c>>6&63),s(128|c&63))}return so(a,0,o)}function O8(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}else{if(Yx)return Yx.decode(t);var i=dz(t),a=i[0],o=i[1];return o.length&&jt(8),a}}var hz=function(t){return t==1?3:t<6?2:t==9?1:0},gz=function(t,e){return e+30+ta(t,e+26)+ta(t,e+28)},pz=function(t,e,n){var r=ta(t,e+28),i=O8(t.subarray(e+46,e+46+r),!(ta(t,e+8)&2048)),a=e+46+r,o=Wr(t,e+20),s=n&&o==4294967295?mz(t,a):[o,Wr(t,e+24),Wr(t,e+42)],l=s[0],c=s[1],d=s[2];return[ta(t,e+10),l,c,i,a+ta(t,e+30)+ta(t,e+32),d]},mz=function(t,e){for(;ta(t,e)!=1;e+=4+ta(t,e+2));return[K4(t,e+12),K4(t,e+4),K4(t,e+20)]},ic=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&jt(9),e+=r+4}return e},zf=function(t,e,n,r,i,a,o,s){var l=r.length,c=n.extra,d=s&&s.length,f=ic(c);jn(t,e,o!=null?33639248:67324752),e+=4,o!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(a==null&&8),t[e++]=i&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var h=new Date(n.mtime==null?Date.now():n.mtime),p=h.getFullYear()-1980;if((p<0||p>119)&&jt(10),jn(t,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,a!=null&&(jn(t,e,n.crc),jn(t,e+4,a),jn(t,e+8,n.size)),jn(t,e+12,l),jn(t,e+14,f),e+=16,o!=null&&(jn(t,e,d),jn(t,e+6,n.attrs),jn(t,e+10,o),e+=14),t.set(r,e),e+=l,f)for(var C in c){var x=c[C],T=x.length;jn(t,e,+C),jn(t,e+2,T),t.set(x,e+4),e+=4+T}return d&&(t.set(s,e),e+=d),e},M8=function(t,e,n,r,i){jn(t,e,101010256),jn(t,e+8,n),jn(t,e+10,n),jn(t,e+12,r),jn(t,e+16,i)},Yg=function(){function t(e){this.filename=e,this.c=sd(),this.size=0,this.compression=0}return t.prototype.process=function(e,n){this.ondata(null,e,n)},t.prototype.push=function(e,n){this.ondata||jt(5),this.c.p(e),this.size+=e.length,n&&(this.crc=this.c.d()),this.process(e,n||!1)},t}(),V5e=function(){function t(e,n){var r=this;n||(n={}),Yg.call(this,e),this.d=new ms(n,function(i,a){r.ondata(null,i,a)}),this.compression=8,this.flag=hz(n.level)}return t.prototype.process=function(e,n){try{this.d.push(e,n)}catch(r){this.ondata(r,null,n)}},t.prototype.push=function(e,n){Yg.prototype.push.call(this,e,n)},t}(),U5e=function(){function t(e,n){var r=this;n||(n={}),Yg.call(this,e),this.d=new rz(n,function(i,a,o){r.ondata(i,a,o)}),this.compression=8,this.flag=hz(n.level),this.terminate=this.d.terminate}return t.prototype.process=function(e,n){this.d.push(e,n)},t.prototype.push=function(e,n){Yg.prototype.push.call(this,e,n)},t}(),B5e=function(){function t(e){this.ondata=e,this.u=[],this.d=1}return t.prototype.add=function(e){var n=this;if(this.ondata||jt(5),this.d&2)this.ondata(jt(4+(this.d&1)*8,0,1),null,!1);else{var r=fc(e.filename),i=r.length,a=e.comment,o=a&&fc(a),s=i!=e.filename.length||o&&a.length!=o.length,l=i+ic(e.extra)+30;i>65535&&this.ondata(jt(11,0,1),null,!1);var c=new An(l);zf(c,0,e,r,s);var d=[c],f=function(){for(var T=0,_=d;T<_.length;T++){var y=_[T];n.ondata(null,y,!1)}d=[]},h=this.d;this.d=0;var p=this.u.length,C=Ep(e,{f:r,u:s,o,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),h){var T=n.u[p+1];T?T.r():n.d=1}h=1}}),x=0;e.ondata=function(T,_,y){if(T)n.ondata(T,_,y),n.terminate();else if(x+=_.length,d.push(_),y){var w=new An(16);jn(w,0,134695760),jn(w,4,e.crc),jn(w,8,x),jn(w,12,e.size),d.push(w),C.c=x,C.b=l+x+16,C.crc=e.crc,C.size=e.size,h&&C.r(),h=1}else h&&f()},this.u.push(C)}},t.prototype.end=function(){var e=this;if(this.d&2){this.ondata(jt(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var e=0,n=0,r=0,i=0,a=this.u;i<a.length;i++){var o=a[i];r+=46+o.f.length+ic(o.extra)+(o.o?o.o.length:0)}for(var s=new An(r+22),l=0,c=this.u;l<c.length;l++){var o=c[l];zf(s,e,o,o.f,o.u,o.c,n,o.o),e+=46+o.f.length+ic(o.extra)+(o.o?o.o.length:0),n+=o.b}M8(s,e,this.u.length,r,n),this.ondata(null,s,!0),this.d=2},t.prototype.terminate=function(){for(var e=0,n=this.u;e<n.length;e++){var r=n[e];r.t()}this.d=2},t}();function G5e(t,e,n){n||(n=e,e={}),typeof n!="function"&&jt(7);var r={};I8(t,"",r,e);var i=Object.keys(r),a=i.length,o=0,s=0,l=a,c=new Array(a),d=[],f=function(){for(var T=0;T<d.length;++T)d[T]()},h=function(T,_){z2(function(){n(T,_)})};z2(function(){h=n});var p=function(){var T=new An(s+22),_=o,y=s-o;s=0;for(var w=0;w<l;++w){var b=c[w];try{var M=b.c.length;zf(T,s,b,b.f,b.u,M);var I=30+b.f.length+ic(b.extra),A=s+I;T.set(b.c,A),zf(T,o,b,b.f,b.u,M,s,b.m),o+=16+I+(b.m?b.m.length:0),s=A+M}catch(k){return h(k,null)}}M8(T,o,c.length,y,_),h(null,T)};a||p();for(var C=function(T){var _=i[T],y=r[_],w=y[0],b=y[1],M=sd(),I=w.length;M.p(w);var A=fc(_),k=A.length,U=b.comment,B=U&&fc(U),z=B&&B.length,K=ic(b.extra),J=b.level==0?0:8,X=function(re,fe){if(re)f(),h(re,null);else{var pe=fe.length;c[T]=Ep(b,{size:I,crc:M.d(),c:fe,f:A,m:B,u:k!=_.length||B&&U.length!=z,compression:J}),o+=30+k+K+pe,s+=76+2*(k+K)+(z||0)+pe,--a||p()}};if(k>65535&&X(jt(11,0,1),null),!J)X(null,w);else if(I<16e4)try{X(null,Tp(w,b))}catch(re){X(re,null)}else d.push(iz(w,b,X))},x=0;x<l;++x)C(x);return f}function z5e(t,e){e||(e={});var n={},r=[];I8(t,"",n,e);var i=0,a=0;for(var o in n){var s=n[o],l=s[0],c=s[1],d=c.level==0?0:8,f=fc(o),h=f.length,p=c.comment,C=p&&fc(p),x=C&&C.length,T=ic(c.extra);h>65535&&jt(11);var _=d?Tp(l,c):l,y=_.length,w=sd();w.p(l),r.push(Ep(c,{size:l.length,crc:w.d(),c:_,f,m:C,u:h!=o.length||C&&p.length!=x,o:i,compression:d})),i+=30+h+T+y,a+=76+2*(h+T)+(x||0)+y}for(var b=new An(a+22),M=i,I=a-i,A=0;A<r.length;++A){var f=r[A];zf(b,f.o,f,f.f,f.u,f.c.length);var k=30+f.f.length+ic(f.extra);b.set(f.c,f.o+k),zf(b,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+k+(f.m?f.m.length:0)}return M8(b,i,r.length,I,M),b}var vz=function(){function t(){}return t.prototype.push=function(e,n){this.ondata(null,e,n)},t.compression=0,t}(),W5e=function(){function t(){var e=this;this.i=new xa(function(n,r){e.ondata(null,n,r)})}return t.prototype.push=function(e,n){try{this.i.push(e,n)}catch(r){this.ondata(r,null,n)}},t.compression=8,t}(),j5e=function(){function t(e,n){var r=this;n<32e4?this.i=new xa(function(i,a){r.ondata(null,i,a)}):(this.i=new D8(function(i,a,o){r.ondata(i,a,o)}),this.terminate=this.i.terminate)}return t.prototype.push=function(e,n){this.i.terminate&&(e=so(e,0)),this.i.push(e,n)},t.compression=8,t}(),H5e=function(){function t(e){this.onfile=e,this.k=[],this.o={0:vz},this.p=$s}return t.prototype.push=function(e,n){var r=this;if(this.onfile||jt(5),this.p||jt(4),this.c>0){var i=Math.min(this.c,e.length),a=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(a,!this.c):this.k[0].push(a),e=e.subarray(i),e.length)return this.push(e,n)}else{var o=0,s=0,l=void 0,c=void 0;this.p.length?e.length?(c=new An(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var d=c.length,f=this.c,h=f&&this.d,p=function(){var _,y=Wr(c,s);if(y==67324752){o=1,l=s,C.d=null,C.c=0;var w=ta(c,s+6),b=ta(c,s+8),M=w&2048,I=w&8,A=ta(c,s+26),k=ta(c,s+28);if(d>s+30+A+k){var U=[];C.k.unshift(U),o=2;var B=Wr(c,s+18),z=Wr(c,s+22),K=O8(c.subarray(s+30,s+=30+A),!M);B==4294967295?(_=I?[-2]:mz(c,s),B=_[0],z=_[1]):I&&(B=-1),s+=k,C.c=B;var J,X={name:K,compression:b,start:function(){if(X.ondata||jt(5),!B)X.ondata(null,$s,!0);else{var re=r.o[b];re||X.ondata(jt(14,"unknown compression type "+b,1),null,!1),J=B<0?new re(K):new re(K,B,z),J.ondata=function(te,ee,we){X.ondata(te,ee,we)};for(var fe=0,pe=U;fe<pe.length;fe++){var ie=pe[fe];J.push(ie,!1)}r.k[0]==U&&r.c?r.d=J:J.push($s,!0)}},terminate:function(){J&&J.terminate&&J.terminate()}};B>=0&&(X.size=B,X.originalSize=z),C.onfile(X)}return"break"}else if(f){if(y==134695760)return l=s+=12+(f==-2&&8),o=3,C.c=0,"break";if(y==33639248)return l=s-=4,o=3,C.c=0,"break"}},C=this;s<d-4;++s){var x=p();if(x==="break")break}if(this.p=$s,f<0){var T=o?c.subarray(0,l-12-(f==-2&&8)-(Wr(c,l-16)==134695760&&4)):c.subarray(0,s);h?h.push(T,!!o):this.k[+(o==2)].push(T)}if(o&2)return this.push(c.subarray(s),n);this.p=c.subarray(s)}n&&(this.c&&jt(13),this.p=null)},t.prototype.register=function(e){this.o[e.compression]=e},t}(),z2=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(t){t()};function $5e(t,e,n){n||(n=e,e={}),typeof n!="function"&&jt(7);var r=[],i=function(){for(var x=0;x<r.length;++x)r[x]()},a={},o=function(x,T){z2(function(){n(x,T)})};z2(function(){o=n});for(var s=t.length-22;Wr(t,s)!=101010256;--s)if(!s||t.length-s>65558)return o(jt(13,0,1),null),i;var l=ta(t,s+8);if(l){var c=l,d=Wr(t,s+16),f=d==4294967295;if(f){if(s=Wr(t,s-12),Wr(t,s)!=101075792)return o(jt(13,0,1),null),i;c=l=Wr(t,s+32),d=Wr(t,s+48)}for(var h=e&&e.filter,p=function(x){var T=pz(t,d,f),_=T[0],y=T[1],w=T[2],b=T[3],M=T[4],I=T[5],A=gz(t,I);d=M;var k=function(B,z){B?(i(),o(B,null)):(z&&(a[b]=z),--l||o(null,a))};if(!h||h({name:b,size:y,originalSize:w,compression:_}))if(!_)k(null,so(t,A,A+y));else if(_==8){var U=t.subarray(A,A+y);if(y<32e4)try{k(null,dd(U,new An(w)))}catch(B){k(B,null)}else r.push(b8(U,{size:w},k))}else k(jt(14,"unknown compression type "+_,1),null);else k(null,null)},C=0;C<c;++C)p(C)}else o(null,{});return i}function K5e(t,e){for(var n={},r=t.length-22;Wr(t,r)!=101010256;--r)(!r||t.length-r>65558)&&jt(13);var i=ta(t,r+8);if(!i)return{};var a=Wr(t,r+16),o=a==4294967295;o&&(r=Wr(t,r-12),Wr(t,r)!=101075792&&jt(13),i=Wr(t,r+32),a=Wr(t,r+48));for(var s=e&&e.filter,l=0;l<i;++l){var c=pz(t,a,o),d=c[0],f=c[1],h=c[2],p=c[3],C=c[4],x=c[5],T=gz(t,x);a=C,(!s||s({name:p,size:f,originalSize:h,compression:d}))&&(d?d==8?n[p]=dd(t.subarray(T,T+f),new An(h)):jt(14,"unknown compression type "+d):n[p]=so(t,T,T+f))}return n}const q5e=Object.freeze(Object.defineProperty({__proto__:null,AsyncCompress:AM,AsyncDecompress:L5e,AsyncDeflate:rz,AsyncGunzip:az,AsyncGzip:AM,AsyncInflate:D8,AsyncUnzipInflate:j5e,AsyncUnzlib:sz,AsyncZipDeflate:U5e,AsyncZlib:R5e,Compress:P2,DecodeUTF8:P5e,Decompress:cz,Deflate:ms,EncodeUTF8:F5e,FlateErrorCode:M5e,Gunzip:V2,Gzip:P2,Inflate:xa,Unzip:H5e,UnzipInflate:W5e,UnzipPassThrough:vz,Unzlib:B2,Zip:B5e,ZipDeflate:V5e,ZipPassThrough:Yg,Zlib:qx,compress:LM,compressSync:F2,decompress:k5e,decompressSync:uz,deflate:iz,deflateSync:Tp,gunzip:oz,gunzipSync:U2,gzip:LM,gzipSync:F2,inflate:b8,inflateSync:dd,strFromU8:O8,strToU8:fc,unzip:$5e,unzipSync:K5e,unzlib:lz,unzlibSync:G2,zip:G5e,zipSync:z5e,zlib:A5e,zlibSync:Xx},Symbol.toStringTag,{value:"Module"})),N8={};function yz(t){return!!N8[t]}function X5e(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return N8[t](e)}function wz(t,e){N8[t]=e}var Y5e={get:X5e,has:yz,registerType:wz};const Ia=[];Ia[45]=62;Ia[95]=63;const df="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let t=0;t<df.length;t++)Ia[df.charCodeAt(t)]=t;function ns(t){return Ia[t.charCodeAt(0)]!==void 0}function J5e(t){const e=t.length,n=[];let r=null;for(let i=0;i<e;i++)ns(t[i])?(r||(r={start:i,count:0}),r.count++,r.end=i):t[i]==="="&&r&&(n.push(r),r=null);return r&&n.push(r),n}function Z5e(t,e,n,r){const{start:i,count:a}=e,o=a%4,s=Math.floor(a/4);let l=i,c=null,d=n;for(let f=0;f<s;f++){for(;!ns(t[l]);)l++;for(c=Ia[t.charCodeAt(l++)]<<18;!ns(t[l]);)l++;for(c|=Ia[t.charCodeAt(l++)]<<12;!ns(t[l]);)l++;for(c|=Ia[t.charCodeAt(l++)]<<6;!ns(t[l]);)l++;c|=Ia[t.charCodeAt(l++)],r[d++]=c>>16&255,r[d++]=c>>8&255,r[d++]=c&255}switch(o){case 3:for(;!ns(t[l]);)l++;for(c=Ia[t.charCodeAt(l++)]<<10;!ns(t[l]);)l++;for(c|=Ia[t.charCodeAt(l++)]<<4;!ns(t[l]);)l++;c|=Ia[t.charCodeAt(l++)]>>2,r[d++]=c>>8&255,r[d++]=c&255;break;case 2:for(;!ns(t[l]);)l++;for(c=Ia[t.charCodeAt(l++)]<<2;!ns(t[l]);)l++;c|=Ia[t.charCodeAt(l++)]>>4,r[d++]=c&255;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return d}function Q5e(t){const e=J5e(t),n=e[e.length-1].end+1,r=(4-n%4)%4,i=(n+r)*3/4-r,a=new ArrayBuffer(i),o=new Uint8Array(a);let s=0;for(let l=0;l<e.length;l++)s+=Z5e(t,e[l],s,o),s+=(4-e[l].count%4)%4;return a}function PM(t,e,n){const r=(t<<16)+(e<<8)+n;return df[r>>18]+df[r>>12&63]+df[r>>6&63]+df[r&63]}function e3e(t){const e=new Uint8Array(t),n=t.byteLength%3,r=t.byteLength-n,i=Array(r/3);for(let a=0;a<i.length;a++){const o=a*3;i[a]=PM(e[o],e[o+1],e[o+2])}if(n>0){const a=PM(e[r],e[r+1]||0,e[r+2]||0);n===1?i.push(`${a.substr(0,2)}==`):n===2&&i.push(`${a.substr(0,3)}=`)}return i.join("")}var R8={toArrayBuffer:Q5e,fromArrayBuffer:e3e};function t3e(t,e){e.classHierarchy.push("vtkStringArray"),t.getComponent=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+r]},t.setComponent=(n,r,i)=>{i!==e.values[n*e.numberOfComponents+r]&&(e.values[n*e.numberOfComponents+r]=i,t.modified())},t.getData=()=>e.values,t.getTuple=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1;r.length&&(r.length=i);const a=n*i;for(let o=0;o<i;o++)r[o]=e.values[a+o];return r},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.values.length,t.getNumberOfTuples=()=>e.values.length/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>xz({name:e.name,numberOfComponents:e.numberOfComponents,empty:!0}),t.getName=()=>(e.name||t.setName(`vtkStringArray${t.getMTime()}`),e.name),t.setData=(n,r)=>{e.values=n,e.size=n.length,r&&(e.numberOfComponents=r),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.modified()}}const n3e={name:"",numberOfComponents:1,size:0,dataType:"string"};function Cz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,n3e,n),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");e.values?Array.isArray(e.values)&&(e.values=[...e.values]):e.values=[],e.values&&(e.size=e.values.length),de.obj(t,e),de.set(t,e,["name"]),t3e(t,e)}const xz=de.newInstance(Cz,"vtkStringArray");var r3e={newInstance:xz,extend:Cz};function Sz(t){return new TextDecoder("latin1").decode(t)}function i3e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=Sz(t),i=e.exec(r);if(!i)return{text:r};const a=i.index+i[0].length,o=r.substring(0,a);let s=null;const l=n?n.exec(r):null;if(l){const c=r.substr(l.index);s={text:o+c,binaryBuffer:t.slice(a,l.index)}}else s={text:o,binaryBuffer:t.slice(a)};return s}var a3e={arrayBufferToString:Sz,extractBinary:i3e};function Ez(){const t=new ArrayBuffer(4),e=new Uint8Array(t),n=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,n[0]===3569595041?"LittleEndian":n[0]===2712847316?"BigEndian":null}const o3e=Ez();function s3e(t,e){if(e<2)return;const n=new Int8Array(t),r=n.length,i=[];for(let a=0;a<r;a+=e){for(let o=0;o<e;o++)i.push(n[a+o]);for(let o=0;o<e;o++)n[a+o]=i.pop()}}var q4={ENDIANNESS:o3e,getEndianness:Ez,swapBytes:s3e};const{vtkErrorMacro:Tz,vtkDebugMacro:l3e}=de,A8=()=>(Tz("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let Wf=0;function By(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new XMLHttpRequest;return r.open(t,e,!0),n.headers&&Object.entries(n.headers).forEach(i=>{let[a,o]=i;return r.setRequestHeader(a,o)}),n.progressCallback&&r.addEventListener("progress",n.progressCallback),r}function c3e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,r)=>{const i=By("GET",t,e);i.onreadystatechange=a=>{i.readyState===4&&(i.status===200||i.status===0?n(i.response):r({xhr:i,e:a}))},i.responseType="arraybuffer",i.send()})}function u3e(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return r&&r.compression?A8():n.ref&&!n.ref.pending?new Promise((i,a)=>{const o=[e,n.ref.basepath,n.ref.id].join("/"),s=By("GET",o,r);s.onreadystatechange=l=>{s.readyState===1&&(n.ref.pending=!0,++Wf===1&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!0)),s.readyState===4&&(n.ref.pending=!1,s.status===200||s.status===0?(n.buffer=s.response,n.ref.encode==="JSON"?n.values=JSON.parse(n.buffer):(q4.ENDIANNESS!==n.ref.encode&&q4.ENDIANNESS&&(l3e(`Swap bytes of ${n.name}`),q4.swapBytes(n.buffer,ZL[n.dataType])),n.values=de.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&Tz(`Error in FetchArray: ${n.name}, does not have the proper array size. Got ${n.values.length}, instead of ${n.size}`),delete n.ref,--Wf===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),t!=null&&t.modified&&t.modified(),i(n)):a({xhr:s,e:l}))},s.responseType=n.dataType!=="string"?"arraybuffer":"text",s.send()}):Promise.resolve(n)}function f3e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?A8():new Promise((r,i)=>{const a=By("GET",e,n);a.onreadystatechange=o=>{a.readyState===1&&++Wf===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),a.readyState===4&&(--Wf===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),a.status===200||a.status===0?r(JSON.parse(a.responseText)):i({xhr:a,e:o}))},a.responseType="text",a.send()})}function d3e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?A8():new Promise((r,i)=>{const a=By("GET",e,n);a.onreadystatechange=o=>{a.readyState===1&&++Wf===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),a.readyState===4&&(--Wf===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),a.status===200||a.status===0?r(a.responseText):i({xhr:a,e:o}))},a.responseType="text",a.send()})}function h3e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((r,i)=>{const a=new Image;n.crossOrigin&&(a.crossOrigin=n.crossOrigin),a.onload=()=>r(a),a.onerror=i,a.src=e})}const g3e={fetchArray:u3e,fetchJSON:f3e,fetchText:d3e,fetchBinary:c3e,fetchImage:h3e};yz("http")||wz("http",t=>g3e);function p3e(t,e){return[...t.getElementsByTagName(e)]}function FM(t,e){return p3e(t,e)[0]}function m3e(t){return I5e.create(t)}function v3e(t){const e=/^\s*<AppendedData\s+encoding="raw">\s*_/m,n=/\n\s*<\/AppendedData>/m;return a3e.extractBinary(t,e,n)}const ql={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},Jg={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function Jx(t){const e=t.length-1;return t.filter((n,r)=>r<e&&r%2===0)}function Zx(t,e,n){if(!["UInt64","UInt32"].includes(n))throw new Error(`Cannot handle a header type of ${n}`);let r=ql[n],i=ql[e],a=!1;n==="UInt64"&&(r=ql.UInt32),/^U?Int64$/.test(e)&&(a=!0,i=ql[e.replace("64","32")]);const{byteOffset:o}=t,s=Jg[e],l=Jg[n];let c;o%l===0?c=new r(t.buffer,o,1):c=new r(t.buffer.slice(o,o+l));const d=Number(c[0]);let f,h=d/s;a&&(h*=2);const p=o+l;return p%s===0?f=new i(t.buffer,p,h):f=new i(t.buffer.slice(p,p+d)),a&&(f=Jx(f)),f}function y3e(t,e){if(e==="UInt64"){let c=new Uint32Array(t.buffer,0,6);const d=c[0],f=c[2],h=c[4],p=[8,d,f,h];c=new Uint32Array(t.buffer,3*8,d*2);for(let C=0;C<d;C++)p.push(c[C*2]);return p}let n=new Uint32Array(t.buffer,0,3);const r=4,i=n[0],a=n[1],o=n[2],s=[r,i,a,o];n=new Uint32Array(t.buffer,3*4,i);for(let l=0;l<i;l++)s.push(n[l]);return s}function w3e(t,e){const[n]=t;return(t.length-1)*n}function C3e(t,e){const n=uz(t);e.uint8.set(n,e.offset),e.offset+=n.length}function L8(t,e){const n=y3e(t,e),r=n[1],i=n[2],a=n[3];let o=0;r>0&&(a===0?o=r*i:o=(r-1)*i+a);const s=new ArrayBuffer(o),l={offset:0,uint8:new Uint8Array(s)};let c=w3e(n);for(;c<t.length&&t[c]!==120;)c++;for(let d=0;d<r;d++){const f=n[4+d],h=new Uint8Array(t.buffer,c,f);C3e(h,l),c+=f}return l.uint8}function Zg(t,e,n,r,i,a){const o=e.getAttribute("type"),s=e.getAttribute("Name"),l=e.getAttribute("format"),c=Number(e.getAttribute("NumberOfComponents")||"1");let d=null;if(l==="ascii"){d=new ql[o](t*c);let f=0;e.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(h=>{h.trim().length&&(d[f++]=Number(h))})}else if(l==="binary"){const f=new Uint8Array(R8.toArrayBuffer(e.firstChild.nodeValue.trim()));if(n==="vtkZLibDataCompressor"){const h=L8(f,i);d=new ql[o](h.buffer),/^U?Int64$/.test(o)&&(d=Jx(d))}else d=new ql[o](f.buffer,Jg[i]),o.indexOf("Int64")!==-1&&(d=Jx(d))}else if(l==="appended"){const f=Number(e.getAttribute("offset"));d=Zx(new Uint8Array(a,f),o,i)}else console.error("Format not supported",l);return{name:s,values:d,numberOfComponents:c}}function X4(t){return new TextDecoder().decode(t).split("\0").slice(0,-1)}function x3e(t,e,n,r,i){const a=t.getAttribute("Name"),o=t.getAttribute("format"),s=Number(t.getAttribute("NumberOfComponents")||"1"),c=Number(t.getAttribute("NumberOfTuples")||"1")*s,d=[];if(o==="ascii"){const f=t.firstChild.nodeValue.trim().split(/\s+/);let h=0;const p=[];for(;d.length<c;){const C=Number(f[h++]);C===0?(d.push(p.join("")),p.length=0):p.push(String.fromCharCode(C))}}else if(o==="binary"){const f=new Uint8Array(R8.toArrayBuffer(t.firstChild.nodeValue.trim()));if(e==="vtkZLibDataCompressor"){const h=L8(f,r);d.push(...X4(h))}else{const h=Zx(f,"UInt8",r);d.push(...X4(h))}}else if(o==="appended"){const f=Number(t.getAttribute("offset")),h=Zx(new Uint8Array(i,f),"UInt8",r);d.push(...X4(h))}else de.vtkErrorMacro(`Format not supported: ${o}`);return{name:a,values:d,numberOfComponents:s}}function S3e(t,e,n,r,i,a){const o={},s=e.getElementsByTagName("DataArray");for(let C=0;C<s.length;C++){const x=s[C];o[x.getAttribute("Name")]=x}const l=Zg(t,o.offsets,n,r,i,a).values,c=l[l.length-1],d=Zg(c,o.connectivity,n,r,i,a).values,f=new Uint32Array(t+c);let h=0,p=0;return l.forEach(C=>{const x=C-p;f[h++]=x;for(let T=0;T<x;T++)f[h++]=d[p+T];p=C}),f}function E3e(t,e,n,r,i,a,o){if(e){const s=["Scalars","Vectors","Normals","Tensors","TCoords"],l={};s.forEach(f=>{const h=e.getAttribute(f);h&&(l[h]=n[`set${f}`])});const c=e.getElementsByTagName("DataArray"),d=c.length;for(let f=0;f<d;f++){const h=c[f],p=Bt.newInstance(Zg(t,h,r,i,a,o)),C=p.getName();(l[C]||n.addArray)(p)}}}function T3e(t,e,n,r,i){const a=[...t.getElementsByTagName("DataArray")].map(s=>Bt.newInstance(Zg(Number(s.getAttribute("NumberOfTuples")),s,e,n,r,i))),o=[...t.getElementsByTagName("Array")].filter(s=>s.getAttribute("type")==="String").map(s=>r3e.newInstance(x3e(s,e,n,r,i)));return[...a,...o]}function _3e(t,e){e.classHierarchy.push("vtkXMLReader"),e.dataAccessHelper||(e.dataAccessHelper=Y5e.get("http"));function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchBinary(r,i)}t.setUrl=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.url=r;const a=r.split("/");return a.pop(),e.baseURL=a.join("/"),t.loadData(i)},t.loadData=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return n(e.url,r).then(t.parseAsArrayBuffer)},t.parseAsArrayBuffer=r=>{if(!r)return!1;if(r!==e.rawDataBuffer)t.modified();else return!0;const{text:i,binaryBuffer:a}=v3e(r);e.rawDataBuffer=r,e.binaryBuffer=a;const s=m3e(i).root(),l=s.node,c=l.getAttribute("type"),d=l.getAttribute("compressor"),f=l.getAttribute("byte_order"),h=l.getAttribute("header_type")||"UInt32";if(d&&d!=="vtkZLibDataCompressor")return console.error("Invalid compressor",d),!1;if(f&&f!=="LittleEndian")return console.error("Only LittleEndian encoding is supported"),!1;if(c!==e.dataType)return console.error("Invalid data type",c,"expecting",e.dataType),!1;if(FM(l,"AppendedData")){const x=FM(l,"AppendedData"),T=x.getAttribute("encoding"),_=s.filter(A=>{const{node:k}=A;return k.nodeType===Node.ELEMENT_NODE&&k.getAttribute("format")==="appended"&&k.hasAttribute("offset")},!1,!0).map(A=>({node:A.node,offset:Number(A.node.getAttribute("offset"))}));_.sort((A,k)=>A.offset-k.offset);let y=e.binaryBuffer;T==="base64"&&(y=x.textContent.trim().substr(1));const w=[];for(let A=0;A<_.length;++A){const k=_[A].offset;let U=0;A===_.length-1?U=y.length||y.byteLength:U=_[A+1].offset,T==="base64"?w.push(new Uint8Array(R8.toArrayBuffer(y.substring(k,U)))):w.push(new Uint8Array(y.slice(k,U)))}if(d==="vtkZLibDataCompressor")for(let A=0;A<w.length;++A){const k=w[A],U=L8(k,h),B=new Uint8Array(U.length+Jg[h]);new ql[h](B.buffer,0,1)[0]=U.length,B.set(U,Jg[h]),w[A]=B}const b=w.reduce((A,k)=>A+k.length,0),M=new ArrayBuffer(b),I=new Uint8Array(M);for(let A=0,k=0;A<w.length;++A)_[A].node.setAttribute("offset",k),I.set(w[A],k),k+=w[A].length;if(e.binaryBuffer=M,!e.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}t.parseXML(l,c,d,f,h);const C=l.getElementsByTagName(c)[0].getElementsByTagName("FieldData")[0];if(C){const x=T3e(C,d,f,h,e.binaryBuffer);for(let T=0;T<e.output.length;T++){const _=e.output[T].getFieldData();for(let y=0;y<x.length;y++)_.addArray(x[y])}}return!0},t.requestData=(r,i)=>{t.parseAsArrayBuffer(e.rawDataBuffer)}}const D3e={};function b3e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,D3e,n),de.obj(t,e),de.get(t,e,["url","baseURL"]),de.setGet(t,e,["dataAccessHelper"]),de.algo(t,e,0,1),_3e(t,e)}var Qg={extend:b3e,processDataArray:Zg,processFieldData:E3e,processCells:S3e};function I3e(t,e,n,r,i,a,o){const s=Number(n.getAttribute(`NumberOf${e}`));if(s>0){const l=n.getElementsByTagName(e)[0].getElementsByTagName("DataArray")[0],{values:c,numberOfComponents:d}=Qg.processDataArray(s,l,r,i,a,o);t[`get${e}`]().setData(c,d)}return s}function O3e(t,e,n,r,i,a,o){const s=Number(n.getAttribute(`NumberOf${e}`));if(s>0){const l=Qg.processCells(s,n.getElementsByTagName(e)[0],r,i,a,o);t[`get${e}`]().setData(l)}return s}function M3e(t,e){e.classHierarchy.push("vtkXMLPolyDataReader"),t.parseXML=(n,r,i,a,o)=>{const l=n.getElementsByTagName(e.dataType)[0].getElementsByTagName("Piece"),c=l.length;for(let d=0;d<c;d++){const f=gi.newInstance(),h=l[d],p=I3e(f,"Points",h,i,a,o,e.binaryBuffer);let C=0;["Verts","Lines","Strips","Polys"].forEach(x=>{C+=O3e(f,x,h,i,a,o,e.binaryBuffer)}),Qg.processFieldData(p,h.getElementsByTagName("PointData")[0],f.getPointData(),i,a,o,e.binaryBuffer),Qg.processFieldData(C,h.getElementsByTagName("CellData")[0],f.getCellData(),i,a,o,e.binaryBuffer),e.output[d]=f}}}const N3e={dataType:"PolyData"};function k8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,N3e,n),Qg.extend(t,e,n),M3e(t,e)}const _z=de.newInstance(k8,"vtkXMLPolyDataReader");var R3e={newInstance:_z,extend:k8};const A3e=Object.freeze(Object.defineProperty({__proto__:null,default:R3e,extend:k8,newInstance:_z},Symbol.toStringTag,{value:"Module"})),L3e=Yr(A3e);(function(t,e){(function(n,r){t.exports=r(Cye,xye,Sye,kye,Pye,Fye,Vye,Uye,Bye,Gye,zye,Wye,jye,Hye,Yye,o5e,b5e,L3e)})(self,(n,r,i,a,o,s,l,c,d,f,h,p,C,x,T,_,y,w)=>(()=>{var b={907:(k,U,B)=>{k=B.nmd(k);var z="__lodash_hash_undefined__",K=9007199254740991,J="[object Arguments]",X="[object Boolean]",re="[object Date]",fe="[object Function]",pe="[object GeneratorFunction]",ie="[object Map]",te="[object Number]",ee="[object Object]",we="[object Promise]",Ce="[object RegExp]",De="[object Set]",Re="[object String]",Oe="[object Symbol]",Ve="[object WeakMap]",Ge="[object ArrayBuffer]",qe="[object DataView]",Be="[object Float32Array]",ae="[object Float64Array]",H="[object Int8Array]",ce="[object Int16Array]",se="[object Int32Array]",he="[object Uint8Array]",ve="[object Uint8ClampedArray]",ye="[object Uint16Array]",Ae="[object Uint32Array]",Ue=/\w*$/,Je=/^\[object .+?Constructor\]$/,et=/^(?:0|[1-9]\d*)$/,lt={};lt[J]=lt["[object Array]"]=lt[Ge]=lt[qe]=lt[X]=lt[re]=lt[Be]=lt[ae]=lt[H]=lt[ce]=lt[se]=lt[ie]=lt[te]=lt[ee]=lt[Ce]=lt[De]=lt[Re]=lt[Oe]=lt[he]=lt[ve]=lt[ye]=lt[Ae]=!0,lt["[object Error]"]=lt[fe]=lt[Ve]=!1;var _t=typeof B.g=="object"&&B.g&&B.g.Object===Object&&B.g,nn=typeof self=="object"&&self&&self.Object===Object&&self,Ot=_t||nn||Function("return this")(),ft=U&&!U.nodeType&&U,_n=ft&&k&&!k.nodeType&&k,Se=_n&&_n.exports===ft;function Gt(ke,tt){return ke.set(tt[0],tt[1]),ke}function Vt(ke,tt){return ke.add(tt),ke}function wt(ke,tt,St,Ut){var Yt=-1,sn=ke?ke.length:0;for(Ut;++Yt<sn;)St=tt(St,ke[Yt],Yt,ke);return St}function Fe(ke){var tt=!1;if(ke!=null&&typeof ke.toString!="function")try{tt=!!(ke+"")}catch{}return tt}function Qe(ke){var tt=-1,St=Array(ke.size);return ke.forEach(function(Ut,Yt){St[++tt]=[Yt,Ut]}),St}function ze(ke,tt){return function(St){return ke(tt(St))}}function je(ke){var tt=-1,St=Array(ke.size);return ke.forEach(function(Ut){St[++tt]=Ut}),St}var rt,dt=Array.prototype,ht=Function.prototype,mt=Object.prototype,At=Ot["__core-js_shared__"],kn=(rt=/[^.]+$/.exec(At&&At.keys&&At.keys.IE_PROTO||""))?"Symbol(src)_1."+rt:"",Kn=ht.toString,Xt=mt.hasOwnProperty,j=mt.toString,zi=RegExp("^"+Kn.call(Xt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$=Se?Ot.Buffer:void 0,Xe=Ot.Symbol,it=Ot.Uint8Array,Qt=ze(Object.getPrototypeOf,Object),Q=Object.create,Rr=mt.propertyIsEnumerable,ws=dt.splice,Xu=Object.getOwnPropertySymbols,hd=$?$.isBuffer:void 0,cr=ze(Object.keys,Object),Cc=Sa(Ot,"DataView"),si=Sa(Ot,"Map"),cl=Sa(Ot,"Promise"),ul=Sa(Ot,"Set"),fl=Sa(Ot,"WeakMap"),Go=Sa(Object,"create"),Yu=Ba(Cc),Jr=Ba(si),oa=Ba(cl),xc=Ba(ul),Ju=Ba(fl),Zu=Xe?Xe.prototype:void 0,zo=Zu?Zu.valueOf:void 0;function Di(ke){var tt=-1,St=ke?ke.length:0;for(this.clear();++tt<St;){var Ut=ke[tt];this.set(Ut[0],Ut[1])}}function sa(ke){var tt=-1,St=ke?ke.length:0;for(this.clear();++tt<St;){var Ut=ke[tt];this.set(Ut[0],Ut[1])}}function mo(ke){var tt=-1,St=ke?ke.length:0;for(this.clear();++tt<St;){var Ut=ke[tt];this.set(Ut[0],Ut[1])}}function vo(ke){this.__data__=new sa(ke)}function yo(ke,tt,St){var Ut=ke[tt];Xt.call(ke,tt)&&e0(Ut,St)&&(St!==void 0||tt in ke)||(ke[tt]=St)}function Wo(ke,tt){for(var St=ke.length;St--;)if(e0(ke[St][0],tt))return St;return-1}function Sc(ke,tt,St,Ut,Yt,sn,ur){var Jn;if(Ut&&(Jn=sn?Ut(ke,Yt,sn,ur):Ut(ke)),Jn!==void 0)return Jn;if(!Ke(ke))return ke;var Zr=Ho(ke);if(Zr){if(Jn=function(Jt){var Pn=Jt.length,ar=Jt.constructor(Pn);return Pn&&typeof Jt[0]=="string"&&Xt.call(Jt,"index")&&(ar.index=Jt.index,ar.input=Jt.input),ar}(ke),!tt)return function(Jt,Pn){var ar=-1,Ar=Jt.length;for(Pn||(Pn=Array(Ar));++ar<Ar;)Pn[ar]=Jt[ar];return Pn}(ke,Jn)}else{var tr=Ua(ke),xs=tr==fe||tr==pe;if(_c(ke))return function(Jt,Pn){if(Pn)return Jt.slice();var ar=new Jt.constructor(Jt.length);return Jt.copy(ar),ar}(ke,tt);if(tr==ee||tr==J||xs&&!sn){if(Fe(ke))return sn?ke:{};if(Jn=function(Jt){return typeof Jt.constructor!="function"||Tc(Jt)?{}:Ke(Pn=Qt(Jt))?Q(Pn):{};var Pn}(xs?{}:ke),!tt)return function(Jt,Pn){return jo(Jt,Ec(Jt),Pn)}(ke,function(Jt,Pn){return Jt&&jo(Pn,dl(Pn),Jt)}(Jn,ke))}else{if(!lt[tr])return sn?ke:{};Jn=function(Jt,Pn,ar,Ar){var Ga,fn=Jt.constructor;switch(Pn){case Ge:return mr(Jt);case X:case re:return new fn(+Jt);case qe:return function(Un,Ht){var Bn=Ht?mr(Un.buffer):Un.buffer;return new Un.constructor(Bn,Un.byteOffset,Un.byteLength)}(Jt,Ar);case Be:case ae:case H:case ce:case se:case he:case ve:case ye:case Ae:return function(Un,Ht){var Bn=Ht?mr(Un.buffer):Un.buffer;return new Un.constructor(Bn,Un.byteOffset,Un.length)}(Jt,Ar);case ie:return function(Un,Ht,Bn){return wt(Ht?Bn(Qe(Un),!0):Qe(Un),Gt,new Un.constructor)}(Jt,Ar,ar);case te:case Re:return new fn(Jt);case Ce:return function(Un){var Ht=new Un.constructor(Un.source,Ue.exec(Un));return Ht.lastIndex=Un.lastIndex,Ht}(Jt);case De:return function(Un,Ht,Bn){return wt(Ht?Bn(je(Un),!0):je(Un),Vt,new Un.constructor)}(Jt,Ar,ar);case Oe:return Ga=Jt,zo?Object(zo.call(Ga)):{}}}(ke,tr,Sc,tt)}}ur||(ur=new vo);var t0=ur.get(ke);if(t0)return t0;if(ur.set(ke,Jn),!Zr)var an=St?function(Jt){return function(Pn,ar,Ar){var Ga=ar(Pn);return Ho(Pn)?Ga:function(fn,Un){for(var Ht=-1,Bn=Un.length,gd=fn.length;++Ht<Bn;)fn[gd+Ht]=Un[Ht];return fn}(Ga,Ar(Pn))}(Jt,dl,Ec)}(ke):dl(ke);return function(Jt,Pn){for(var ar=-1,Ar=Jt?Jt.length:0;++ar<Ar&&Pn(Jt[ar],ar)!==!1;);}(an||ke,function(Jt,Pn){an&&(Jt=ke[Pn=Jt]),yo(Jn,Pn,Sc(Jt,tt,St,Ut,Pn,ke,ur))}),Jn}function mr(ke){var tt=new ke.constructor(ke.byteLength);return new it(tt).set(new it(ke)),tt}function jo(ke,tt,St,Ut){St||(St={});for(var Yt=-1,sn=tt.length;++Yt<sn;){var ur=tt[Yt],Jn=void 0;yo(St,ur,Jn===void 0?ke[ur]:Jn)}return St}function Cs(ke,tt){var St,Ut,Yt=ke.__data__;return((Ut=typeof(St=tt))=="string"||Ut=="number"||Ut=="symbol"||Ut=="boolean"?St!=="__proto__":St===null)?Yt[typeof tt=="string"?"string":"hash"]:Yt.map}function Sa(ke,tt){var St=function(Ut,Yt){return Ut==null?void 0:Ut[Yt]}(ke,tt);return function(Ut){return!(!Ke(Ut)||(Yt=Ut,kn&&kn in Yt))&&(Dc(Ut)||Fe(Ut)?zi:Je).test(Ba(Ut));var Yt}(St)?St:void 0}Di.prototype.clear=function(){this.__data__=Go?Go(null):{}},Di.prototype.delete=function(ke){return this.has(ke)&&delete this.__data__[ke]},Di.prototype.get=function(ke){var tt=this.__data__;if(Go){var St=tt[ke];return St===z?void 0:St}return Xt.call(tt,ke)?tt[ke]:void 0},Di.prototype.has=function(ke){var tt=this.__data__;return Go?tt[ke]!==void 0:Xt.call(tt,ke)},Di.prototype.set=function(ke,tt){return this.__data__[ke]=Go&&tt===void 0?z:tt,this},sa.prototype.clear=function(){this.__data__=[]},sa.prototype.delete=function(ke){var tt=this.__data__,St=Wo(tt,ke);return!(St<0||(St==tt.length-1?tt.pop():ws.call(tt,St,1),0))},sa.prototype.get=function(ke){var tt=this.__data__,St=Wo(tt,ke);return St<0?void 0:tt[St][1]},sa.prototype.has=function(ke){return Wo(this.__data__,ke)>-1},sa.prototype.set=function(ke,tt){var St=this.__data__,Ut=Wo(St,ke);return Ut<0?St.push([ke,tt]):St[Ut][1]=tt,this},mo.prototype.clear=function(){this.__data__={hash:new Di,map:new(si||sa),string:new Di}},mo.prototype.delete=function(ke){return Cs(this,ke).delete(ke)},mo.prototype.get=function(ke){return Cs(this,ke).get(ke)},mo.prototype.has=function(ke){return Cs(this,ke).has(ke)},mo.prototype.set=function(ke,tt){return Cs(this,ke).set(ke,tt),this},vo.prototype.clear=function(){this.__data__=new sa},vo.prototype.delete=function(ke){return this.__data__.delete(ke)},vo.prototype.get=function(ke){return this.__data__.get(ke)},vo.prototype.has=function(ke){return this.__data__.has(ke)},vo.prototype.set=function(ke,tt){var St=this.__data__;if(St instanceof sa){var Ut=St.__data__;if(!si||Ut.length<199)return Ut.push([ke,tt]),this;St=this.__data__=new mo(Ut)}return St.set(ke,tt),this};var Ec=Xu?ze(Xu,Object):function(){return[]},Ua=function(ke){return j.call(ke)};function Qu(ke,tt){return!!(tt=tt??K)&&(typeof ke=="number"||et.test(ke))&&ke>-1&&ke%1==0&&ke<tt}function Tc(ke){var tt=ke&&ke.constructor;return ke===(typeof tt=="function"&&tt.prototype||mt)}function Ba(ke){if(ke!=null){try{return Kn.call(ke)}catch{}try{return ke+""}catch{}}return""}function e0(ke,tt){return ke===tt||ke!=ke&&tt!=tt}(Cc&&Ua(new Cc(new ArrayBuffer(1)))!=qe||si&&Ua(new si)!=ie||cl&&Ua(cl.resolve())!=we||ul&&Ua(new ul)!=De||fl&&Ua(new fl)!=Ve)&&(Ua=function(ke){var tt=j.call(ke),St=tt==ee?ke.constructor:void 0,Ut=St?Ba(St):void 0;if(Ut)switch(Ut){case Yu:return qe;case Jr:return ie;case oa:return we;case xc:return De;case Ju:return Ve}return tt});var Ho=Array.isArray;function vr(ke){return ke!=null&&function(tt){return typeof tt=="number"&&tt>-1&&tt%1==0&&tt<=K}(ke.length)&&!Dc(ke)}var _c=hd||function(){return!1};function Dc(ke){var tt=Ke(ke)?j.call(ke):"";return tt==fe||tt==pe}function Ke(ke){var tt=typeof ke;return!!ke&&(tt=="object"||tt=="function")}function dl(ke){return vr(ke)?function(tt,St){var Ut=Ho(tt)||function(Jn){return function(Zr){return function(tr){return!!tr&&typeof tr=="object"}(Zr)&&vr(Zr)}(Jn)&&Xt.call(Jn,"callee")&&(!Rr.call(Jn,"callee")||j.call(Jn)==J)}(tt)?function(Jn,Zr){for(var tr=-1,xs=Array(Jn);++tr<Jn;)xs[tr]=Zr(tr);return xs}(tt.length,String):[],Yt=Ut.length,sn=!!Yt;for(var ur in tt)!Xt.call(tt,ur)||sn&&(ur=="length"||Qu(ur,Yt))||Ut.push(ur);return Ut}(ke):function(tt){if(!Tc(tt))return cr(tt);var St=[];for(var Ut in Object(tt))Xt.call(tt,Ut)&&Ut!="constructor"&&St.push(Ut);return St}(ke)}k.exports=function(ke){return Sc(ke,!0,!0)}},485:(k,U,B)=>{var z,K="__lodash_hash_undefined__",J=1/0,X="[object Function]",re="[object GeneratorFunction]",fe="[object Symbol]",pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ie=/^\w*$/,te=/^\./,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,we=/\\(\\)?/g,Ce=/^\[object .+?Constructor\]$/,De=typeof B.g=="object"&&B.g&&B.g.Object===Object&&B.g,Re=typeof self=="object"&&self&&self.Object===Object&&self,Oe=De||Re||Function("return this")(),Ve=Array.prototype,Ge=Function.prototype,qe=Object.prototype,Be=Oe["__core-js_shared__"],ae=(z=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"",H=Ge.toString,ce=qe.hasOwnProperty,se=qe.toString,he=RegExp("^"+H.call(ce).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ve=Oe.Symbol,ye=Ve.splice,Ae=_n(Oe,"Map"),Ue=_n(Object,"create"),Je=ve?ve.prototype:void 0,et=Je?Je.toString:void 0;function lt(ze){var je=-1,rt=ze?ze.length:0;for(this.clear();++je<rt;){var dt=ze[je];this.set(dt[0],dt[1])}}function _t(ze){var je=-1,rt=ze?ze.length:0;for(this.clear();++je<rt;){var dt=ze[je];this.set(dt[0],dt[1])}}function nn(ze){var je=-1,rt=ze?ze.length:0;for(this.clear();++je<rt;){var dt=ze[je];this.set(dt[0],dt[1])}}function Ot(ze,je){for(var rt,dt,ht=ze.length;ht--;)if((rt=ze[ht][0])===(dt=je)||rt!=rt&&dt!=dt)return ht;return-1}function ft(ze,je){var rt,dt,ht=ze.__data__;return((dt=typeof(rt=je))=="string"||dt=="number"||dt=="symbol"||dt=="boolean"?rt!=="__proto__":rt===null)?ht[typeof je=="string"?"string":"hash"]:ht.map}function _n(ze,je){var rt=function(dt,ht){return dt==null?void 0:dt[ht]}(ze,je);return function(dt){if(!Fe(dt)||ae&&ae in dt)return!1;var ht=function(mt){var At=Fe(mt)?se.call(mt):"";return At==X||At==re}(dt)||function(mt){var At=!1;if(mt!=null&&typeof mt.toString!="function")try{At=!!(mt+"")}catch{}return At}(dt)?he:Ce;return ht.test(function(mt){if(mt!=null){try{return H.call(mt)}catch{}try{return mt+""}catch{}}return""}(dt))}(rt)?rt:void 0}lt.prototype.clear=function(){this.__data__=Ue?Ue(null):{}},lt.prototype.delete=function(ze){return this.has(ze)&&delete this.__data__[ze]},lt.prototype.get=function(ze){var je=this.__data__;if(Ue){var rt=je[ze];return rt===K?void 0:rt}return ce.call(je,ze)?je[ze]:void 0},lt.prototype.has=function(ze){var je=this.__data__;return Ue?je[ze]!==void 0:ce.call(je,ze)},lt.prototype.set=function(ze,je){return this.__data__[ze]=Ue&&je===void 0?K:je,this},_t.prototype.clear=function(){this.__data__=[]},_t.prototype.delete=function(ze){var je=this.__data__,rt=Ot(je,ze);return!(rt<0||(rt==je.length-1?je.pop():ye.call(je,rt,1),0))},_t.prototype.get=function(ze){var je=this.__data__,rt=Ot(je,ze);return rt<0?void 0:je[rt][1]},_t.prototype.has=function(ze){return Ot(this.__data__,ze)>-1},_t.prototype.set=function(ze,je){var rt=this.__data__,dt=Ot(rt,ze);return dt<0?rt.push([ze,je]):rt[dt][1]=je,this},nn.prototype.clear=function(){this.__data__={hash:new lt,map:new(Ae||_t),string:new lt}},nn.prototype.delete=function(ze){return ft(this,ze).delete(ze)},nn.prototype.get=function(ze){return ft(this,ze).get(ze)},nn.prototype.has=function(ze){return ft(this,ze).has(ze)},nn.prototype.set=function(ze,je){return ft(this,ze).set(ze,je),this};var Se=Vt(function(ze){var je;ze=(je=ze)==null?"":function(dt){if(typeof dt=="string")return dt;if(Qe(dt))return et?et.call(dt):"";var ht=dt+"";return ht=="0"&&1/dt==-J?"-0":ht}(je);var rt=[];return te.test(ze)&&rt.push(""),ze.replace(ee,function(dt,ht,mt,At){rt.push(mt?At.replace(we,"$1"):ht||dt)}),rt});function Gt(ze){if(typeof ze=="string"||Qe(ze))return ze;var je=ze+"";return je=="0"&&1/ze==-J?"-0":je}function Vt(ze,je){if(typeof ze!="function"||je&&typeof je!="function")throw new TypeError("Expected a function");var rt=function(){var dt=arguments,ht=je?je.apply(this,dt):dt[0],mt=rt.cache;if(mt.has(ht))return mt.get(ht);var At=ze.apply(this,dt);return rt.cache=mt.set(ht,At),At};return rt.cache=new(Vt.Cache||nn),rt}Vt.Cache=nn;var wt=Array.isArray;function Fe(ze){var je=typeof ze;return!!ze&&(je=="object"||je=="function")}function Qe(ze){return typeof ze=="symbol"||function(je){return!!je&&typeof je=="object"}(ze)&&se.call(ze)==fe}k.exports=function(ze,je,rt){var dt=ze==null?void 0:function(ht,mt){var At;mt=function(Xt,j){if(wt(Xt))return!1;var zi=typeof Xt;return!(zi!="number"&&zi!="symbol"&&zi!="boolean"&&Xt!=null&&!Qe(Xt))||ie.test(Xt)||!pe.test(Xt)||j!=null&&Xt in Object(j)}(mt,ht)?[mt]:wt(At=mt)?At:Se(At);for(var kn=0,Kn=mt.length;ht!=null&&kn<Kn;)ht=ht[Gt(mt[kn++])];return kn&&kn==Kn?ht:void 0}(ze,je);return dt===void 0?rt:dt}},396:k=>{k.exports=d},785:k=>{k.exports=o},807:k=>{k.exports=i},847:k=>{k.exports=x},348:k=>{k.exports=f},283:k=>{k.exports=s},441:k=>{k.exports=l},70:k=>{k.exports=h},543:k=>{k.exports=a},614:k=>{k.exports=w},518:k=>{k.exports=T},474:k=>{k.exports=C},744:k=>{k.exports=_},424:k=>{k.exports=y},795:k=>{k.exports=c},610:k=>{k.exports=p},953:k=>{k.exports=r},976:k=>{k.exports=n}},M={};function I(k){var U=M[k];if(U!==void 0)return U.exports;var B=M[k]={id:k,loaded:!1,exports:{}};return b[k](B,B.exports,I),B.loaded=!0,B.exports}I.m=b,I.n=k=>{var U=k&&k.__esModule?()=>k.default:()=>k;return I.d(U,{a:U}),U},I.d=(k,U)=>{for(var B in U)I.o(U,B)&&!I.o(k,B)&&Object.defineProperty(k,B,{enumerable:!0,get:U[B]})},I.u=k=>k+".index.js",I.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),I.o=(k,U)=>Object.prototype.hasOwnProperty.call(k,U),I.r=k=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(k,"__esModule",{value:!0})},I.nmd=k=>(k.paths=[],k.children||(k.children=[]),k),(()=>{var k;I.g.importScripts&&(k=I.g.location+"");var U=I.g.document;if(!k&&U&&(U.currentScript&&(k=U.currentScript.src),!k)){var B=U.getElementsByTagName("script");if(B.length)for(var z=B.length-1;z>-1&&!k;)k=B[z--].src}if(!k)throw new Error("Automatic publicPath is not supported in this browser");k=k.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),I.p=k})(),I.b=document.baseURI||self.location.href;var A={};return(()=>{I.r(A),I.d(A,{AdvancedMagnifyTool:()=>rh,AngleTool:()=>Dq,AnnotationDisplayTool:()=>Lc,AnnotationTool:()=>ei,ArrowAnnotateTool:()=>Tq,BaseTool:()=>kr,BidirectionalTool:()=>z9,BrushTool:()=>_9,CONSTANTS:()=>Qe,CircleROIStartEndThresholdTool:()=>qq,CircleROITool:()=>XD,CircleScissorsTool:()=>Hq,CobbAngleTool:()=>Iq,CrosshairsTool:()=>aq,DragProbeTool:()=>BK,EllipticalROITool:()=>cq,Enums:()=>Xt,EraserTool:()=>Gq,HeightTool:()=>QK,KeyImageTool:()=>Aq,LengthTool:()=>JK,LivewireContourSegmentationTool:()=>xq,LivewireContourTool:()=>ZD,MIPJumpToClickTool:()=>XK,MagnifyTool:()=>Lq,OrientationMarkerTool:()=>tX,OverlayGridTool:()=>oq,PaintFillTool:()=>rX,PanTool:()=>kK,PlanarFreehandContourSegmentationTool:()=>Gc,PlanarFreehandROITool:()=>R3,PlanarRotateTool:()=>HK,ProbeTool:()=>UD,RectangleROIStartEndThresholdTool:()=>P9,RectangleROIThresholdTool:()=>k9,RectangleROITool:()=>a3,RectangleScissorsTool:()=>jq,ReferenceCursors:()=>Vq,ReferenceLines:()=>WD,ReferenceLinesTool:()=>WD,ScaleOverlayTool:()=>Uq,SculptorTool:()=>Bq,SegmentSelectTool:()=>nX,SegmentationDisplayTool:()=>k3,SegmentationIntersectionTool:()=>sq,SphereScissorsTool:()=>$q,SplineContourSegmentationTool:()=>yq,SplineROITool:()=>JD,StackScrollMouseWheelTool:()=>$K,StackScrollTool:()=>jK,Synchronizer:()=>RD,SynchronizerManager:()=>wt,ToolGroupManager:()=>Fe,TrackballRotateTool:()=>PK,Types:()=>dt,UltrasoundDirectionalTool:()=>Mq,VideoRedactionTool:()=>iX,VolumeRotateMouseWheelTool:()=>qK,WindowLevelRegionTool:()=>zK,WindowLevelTool:()=>GK,ZoomTool:()=>WK,addTool:()=>Y_,annotation:()=>mt,cancelActiveManipulations:()=>X$,cursors:()=>rt,destroy:()=>q$,drawing:()=>je,init:()=>K$,removeTool:()=>ej,segmentation:()=>Kn,state:()=>Ke,synchronizers:()=>ze,utilities:()=>Vt});var k={};I.r(k),I.d(k,{checkAndDefineIsLockedProperty:()=>si,getAnnotationsLocked:()=>hd,getAnnotationsLockedCount:()=>Cc,isAnnotationLocked:()=>cr,setAnnotationLocked:()=>ws,unlockAllAnnotations:()=>Xu});var U={};I.r(U),I.d(U,{deselectAnnotation:()=>xc,getAnnotationsSelected:()=>Ju,getAnnotationsSelectedByToolName:()=>Zu,getAnnotationsSelectedCount:()=>Di,isAnnotationSelected:()=>zo,setAnnotationSelected:()=>oa});var B={};I.r(B),I.d(B,{checkAndDefineIsVisibleProperty:()=>jo,isAnnotationVisible:()=>mr,setAnnotationVisibility:()=>Wo,showAllAnnotations:()=>Sc});var z={};I.r(z),I.d(z,{addAnnotation:()=>fn,addChildAnnotation:()=>ar,clearParentAnnotation:()=>Pn,getAllAnnotations:()=>Jt,getAnnotation:()=>Bn,getAnnotationManager:()=>tr,getAnnotations:()=>an,getChildAnnotations:()=>Ga,getNumberOfAnnotations:()=>Un,getParentAnnotation:()=>Ar,invalidateAnnotation:()=>pd,removeAllAnnotations:()=>gd,removeAnnotation:()=>Ht,removeAnnotations:()=>Gy,resetAnnotationManager:()=>t0,setAnnotationManager:()=>xs});var K={};I.r(K),I.d(K,{triggerSegmentationDataModified:()=>pi,triggerSegmentationModified:()=>Ta,triggerSegmentationRemoved:()=>Ss,triggerSegmentationRepresentationModified:()=>ji,triggerSegmentationRepresentationRemoved:()=>vd});var J={};I.r(J),I.d(J,{addColorLUT:()=>Ky,addSegmentation:()=>P8,addSegmentationRepresentation:()=>z8,findSegmentationRepresentationByUID:()=>Hy,getAllSegmentationRepresentations:()=>r0,getColorLUT:()=>wd,getDefaultSegmentationStateManager:()=>or,getGlobalConfig:()=>W8,getNextColorLUTIndex:()=>H8,getSegmentSpecificRepresentationConfig:()=>B8,getSegmentation:()=>dn,getSegmentationIdRepresentations:()=>jy,getSegmentationRepresentationByUID:()=>hl,getSegmentationRepresentationSpecificConfig:()=>U8,getSegmentationRepresentations:()=>Hi,getSegmentations:()=>Ip,getToolGroupIdFromSegmentationRepresentationUID:()=>bz,getToolGroupIdsWithSegmentation:()=>bc,getToolGroupSpecificConfig:()=>F8,removeColorLUT:()=>Mz,removeSegmentation:()=>Iz,removeSegmentationRepresentation:()=>yd,removeSegmentationRepresentations:()=>Oz,setGlobalConfig:()=>j8,setSegmentSpecificRepresentationConfig:()=>G8,setSegmentationRepresentationSpecificConfig:()=>$y,setToolGroupSpecificConfig:()=>V8});var X={};I.r(X),I.d(X,{copyPoints:()=>e5,copyPointsList:()=>$o,getDeltaDistance:()=>Qy,getDeltaDistanceBetweenIPoints:()=>Ap,getDeltaPoints:()=>Rp,getDeltaRotation:()=>Fz,getMeanPoints:()=>xd,getMeanTouchPoints:()=>wo});var re={};I.r(re),I.d(re,{getSegmentVisibility:()=>W6,getSegmentationVisibility:()=>z6,setSegmentVisibility:()=>Kz,setSegmentationVisibility:()=>s5,setSegmentsVisibility:()=>$z});var fe={};I.r(fe),I.d(fe,{addColorLUT:()=>rW,getColorForSegmentIndex:()=>Es,setColorForSegmentIndex:()=>e_,setColorLUT:()=>iW});var pe={};I.r(pe),I.d(pe,{InterpolationManager:()=>Oi});var ie={};I.r(ie),I.d(ie,{AnnotationToPointData:()=>jW,acceptAutogeneratedInterpolations:()=>ij,areCoplanarContours:()=>PW,calculatePerimeter:()=>z5,contourFinder:()=>FW,detectContourHoles:()=>VW,findHandlePolylineIndex:()=>G5,generateContourSetsFromLabelmap:()=>N_,getContourHolesDataCanvas:()=>bd,getContourHolesDataWorld:()=>R_,getDeduplicatedVTKPolyDataPoints:()=>M_,interpolation:()=>pe,updateContourPolyline:()=>_s});var te={};I.r(te),I.d(te,{hideElementCursor:()=>Wt,initElementCursor:()=>S9,resetElementCursor:()=>rn,setElementCursor:()=>Pd});var ee={};I.r(ee),I.d(ee,{getActiveSegmentation:()=>vj,getActiveSegmentationRepresentation:()=>Ko,setActiveSegmentationRepresentation:()=>yj});var we={};I.r(we),I.d(we,{getLockedSegments:()=>Ac,isSegmentIndexLocked:()=>wj,setSegmentIndexLocked:()=>Cj});var Ce={};I.r(Ce),I.d(Ce,{getActiveSegmentIndex:()=>vl,setActiveSegmentIndex:()=>T9});var De={};I.r(De),I.d(De,{contourAndFindLargestBidirectional:()=>B9,createBidirectionalToolData:()=>G9,createImageIdReferenceMap:()=>v5,createLabelmapVolumeForViewport:()=>Nj,createMergedLabelmapForIndex:()=>Ij,floodFill:()=>e1,getBrushSizeForToolGroup:()=>Aj,getBrushThresholdForToolGroup:()=>kj,getBrushToolInstances:()=>v0,getDefaultRepresentationConfig:()=>Mj,getHoveredContourSegmentationAnnotation:()=>q9,getSegmentAtLabelmapBorder:()=>$9,getSegmentAtWorldPoint:()=>H9,getUniqueSegmentIndices:()=>Wi,invalidateBrushCursor:()=>E9,isValidRepresentationConfig:()=>Oj,rectangleROIThresholdVolumeByRange:()=>bj,segmentContourAction:()=>Bj,setBrushSizeForToolGroup:()=>Rj,setBrushThresholdForToolGroup:()=>Lj,thresholdSegmentationByRange:()=>Pj,thresholdVolumeByRange:()=>b9,triggerSegmentationRender:()=>x1});var Re={};I.r(Re),I.d(Re,{getTextBoxCoordsCanvas:()=>Ha});var Oe={};I.r(Oe),I.d(Oe,{distanceToPoint:()=>Wj,distanceToPointSquared:()=>c1,intersectAABB:()=>F_});var Ve={};I.r(Ve),I.d(Ve,{BasicStatsCalculator:()=>ti,Calculator:()=>R9});var Ge={};I.r(Ge),I.d(Ge,{getCanvasEllipseCorners:()=>kd,pointInEllipse:()=>t1,precalculatePointInEllipse:()=>j5});var qe={};I.r(qe),I.d(qe,{distanceToPoint:()=>mi,distanceToPointSquared:()=>Id,distanceToPointSquaredInfo:()=>Hp,intersectLine:()=>l3,isPointOnLineSegment:()=>qp});var Be={};I.r(Be),I.d(Be,{distanceToPoint:()=>$a,distanceToPointSquared:()=>Ts,mirror:()=>u3});var ae={};I.r(ae),I.d(ae,{addCanvasPointsToArray:()=>qj,containsPoint:()=>Nc,containsPoints:()=>F5,decimate:()=>A_,getAABB:()=>Dd,getArea:()=>u1,getClosestLineSegmentIntersection:()=>Hj,getFirstLineSegmentIntersectionIndexes:()=>V_,getLineSegmentIntersectionsCoordinates:()=>X9,getLineSegmentIntersectionsIndexes:()=>V5,getNormal2:()=>Od,getNormal3:()=>jj,getSignedArea:()=>R5,getSubPixelSpacingAndXYDirections:()=>$j,getWindingDirection:()=>A5,intersectPolyline:()=>U_,isClosed:()=>B_,isPointInsidePolyline3D:()=>j9,mergePolylines:()=>H_,pointCanProjectOnLine:()=>Xj,pointsAreWithinCloseContourProximity:()=>Kj,projectTo2D:()=>W9,subtractPolylines:()=>$_});var H={};I.r(H),I.d(H,{distanceToPoint:()=>n3});var ce={};I.r(ce),I.d(ce,{findClosestPoint:()=>t3,liangBarksyClip:()=>Gd});var se={};I.r(se),I.d(se,{BasicStatsCalculator:()=>Ve,aabb:()=>Oe,ellipse:()=>Ge,lineSegment:()=>qe,point:()=>Be,polyline:()=>ae,rectangle:()=>H,vec2:()=>ce});var he={};I.r(he),I.d(he,{default:()=>Qj,filterAnnotationsForDisplay:()=>r1,filterAnnotationsWithinSamePlane:()=>o1,filterAnnotationsWithinSlice:()=>J5,getPointInLineOfSightWithCriteria:()=>d3,getWorldWidthAndHeightFromCorners:()=>i1,isPlaneIntersectingAABB:()=>J9});var ve={};I.r(ve),I.d(ve,{filterViewportsWithFrameOfReferenceUID:()=>K_,filterViewportsWithParallelNormals:()=>q_,filterViewportsWithToolEnabled:()=>Xp,getViewportIdsWithToolToRender:()=>Mt});var ye={};I.r(ye),I.d(ye,{getOrientationStringLPS:()=>eH,invertOrientationStringLPS:()=>tH});var Ae={};I.r(Ae),I.d(Ae,{Events:()=>d1,addToolState:()=>Q9,getToolState:()=>g3,playClip:()=>nH,stopClip:()=>n7});var Ue={};I.r(Ue),I.d(Ue,{extend2DBoundingBoxInViewAxis:()=>F9,getBoundingBoxAroundShape:()=>ml,getBoundingBoxAroundShapeIJK:()=>ml,getBoundingBoxAroundShapeWorld:()=>S_});var Je={};I.r(Je),I.d(Je,{default:()=>iH,smoothAnnotation:()=>s7});var et={};I.r(et),I.d(et,{getBoundsIJKFromRectangleAnnotations:()=>V9,isAxisAlignedRectangle:()=>c7});var lt={};I.r(lt),I.d(lt,{isViewportPreScaled:()=>qo,jumpToSlice:()=>Wp,jumpToWorld:()=>p7});var _t={};I.r(_t),I.d(_t,{generateImageFromTimeData:()=>uH,getDataInTime:()=>cH});var nn={};I.r(nn),I.d(nn,{getPoint:()=>m7,getPolyDataPointIndexes:()=>v7,getPolyDataPoints:()=>y7});var Ot={};I.r(Ot),I.d(Ot,{ColorbarRangeTextPosition:()=>Co});var ft={};I.r(ft),I.d(ft,{Colorbar:()=>Kd,Enums:()=>Ot,ViewportColorbar:()=>S0});var _n={};I.r(_n),I.d(_n,{calculateMinMaxMean:()=>x7,extractWindowLevelRegionToolData:()=>S7,getLuminanceFromRegion:()=>C7});var Se={};I.r(Se),I.d(Se,{colorbar:()=>ft,windowLevel:()=>_n});var Gt={};I.r(Gt),I.d(Gt,{addContourSegmentationAnnotation:()=>g0,areSameSegment:()=>X_,isContourSegmentationAnnotation:()=>Ad,removeContourSegmentationAnnotation:()=>Yp});var Vt={};I.r(Vt),I.d(Vt,{annotationFrameRange:()=>T_,annotationHydration:()=>LW,boundingBox:()=>Ue,calibrateImageSpacing:()=>RW,cine:()=>Ae,clip:()=>zp,contourSegmentation:()=>Gt,contours:()=>ie,debounce:()=>Vp,drawing:()=>Re,dynamicVolume:()=>_t,getAnnotationNearPoint:()=>OW,getAnnotationNearPointOnEnabledElement:()=>w_,getCalibratedAspect:()=>D5,getCalibratedLengthUnitsAndScale:()=>za,getCalibratedProbeUnitsAndValue:()=>Gp,getClosestImageIdForStackViewport:()=>O5,getSphereBoundsInfo:()=>E_,getViewportForAnnotation:()=>jp,isObject:()=>h5,jumpToSlice:()=>Wp,math:()=>se,orientation:()=>ye,planar:()=>he,planarFreehandROITool:()=>Je,pointInShapeCallback:()=>Ii,pointInSurroundingSphereCallback:()=>AW,pointToString:()=>u5,polyDataUtils:()=>nn,rectangleROITool:()=>et,roundNumber:()=>cn,scroll:()=>Mc,segmentation:()=>De,stackContextPrefetch:()=>lH,stackPrefetch:()=>sH,throttle:()=>$i,touch:()=>X,triggerAnnotationRender:()=>c0,triggerAnnotationRenderForToolGroupIds:()=>C_,triggerAnnotationRenderForViewportIds:()=>We,triggerEvent:()=>j.triggerEvent,viewport:()=>lt,viewportFilters:()=>ve,voi:()=>Se});var wt={};I.r(wt),I.d(wt,{createSynchronizer:()=>Wc,destroy:()=>Y$,destroySynchronizer:()=>Q$,getAllSynchronizers:()=>Z$,getSynchronizer:()=>J$,getSynchronizersForViewport:()=>vD});var Fe={};I.r(Fe),I.d(Fe,{createToolGroup:()=>LD,destroy:()=>ID,destroyToolGroup:()=>bD,getAllToolGroups:()=>uK,getToolGroup:()=>qn,getToolGroupForViewport:()=>nr,getToolGroupsWithToolName:()=>St});var Qe={};I.r(Qe),I.d(Qe,{COLOR_LUT:()=>u_});var ze={};I.r(ze),I.d(ze,{createCameraPositionSynchronizer:()=>hK,createImageSliceSynchronizer:()=>PD,createPresentationViewSynchronizer:()=>mK,createSlabThicknessSynchronizer:()=>bK,createStackImageSynchronizer:()=>IK,createVOISynchronizer:()=>yK,createZoomPanSynchronizer:()=>xK});var je={};I.r(je),I.d(je,{draw:()=>f_,drawArrow:()=>b1,drawCircle:()=>_a,drawEllipse:()=>OK,drawEllipseByCoordinates:()=>j3,drawHandle:()=>n1,drawHandles:()=>Qn,drawHeight:()=>FD,drawLine:()=>Mn,drawLinkedTextBox:()=>Ki,drawPath:()=>yl,drawPolyline:()=>Xo,drawRect:()=>Vd,drawRectByCoordinates:()=>Y5,drawRedactionRect:()=>VD,drawTextBox:()=>kc,setAttributesIfNecessary:()=>ja,setNewAttributesIfValid:()=>bs});var rt={};I.r(rt),I.d(rt,{CursorNames:()=>NK,CursorSVG:()=>D1,ImageMouseCursor:()=>Jd,MouseCursor:()=>Mi,SVGMouseCursor:()=>jc,elementCursor:()=>te,registerCursor:()=>nK,setCursorForElement:()=>MK});var dt={};I.r(dt);var ht={};I.r(ht),I.d(ht,{getFont:()=>RK,getState:()=>O9,style:()=>Z5});var mt={};I.r(mt),I.d(mt,{AnnotationGroup:()=>AK,FrameOfReferenceSpecificAnnotationManager:()=>e0,config:()=>ht,locking:()=>k,selection:()=>U,state:()=>z,visibility:()=>B});var At={};I.r(At),I.d(At,{color:()=>fe,getGlobalConfig:()=>Ed,getGlobalRepresentationConfig:()=>zz,getSegmentSpecificConfig:()=>G6,getSegmentationRepresentationSpecificConfig:()=>B6,getToolGroupSpecificConfig:()=>kp,setGlobalConfig:()=>V6,setGlobalRepresentationConfig:()=>Wz,setSegmentSpecificConfig:()=>Hz,setSegmentationRepresentationSpecificConfig:()=>jz,setToolGroupSpecificConfig:()=>U6,visibility:()=>re});var kn={};I.r(kn),I.d(kn,{canComputeRequestedRepresentation:()=>Fp,computeAndAddContourRepresentation:()=>M7,computeAndAddLabelmapRepresentation:()=>a_,computeAndAddSurfaceRepresentation:()=>p_});var Kn={};I.r(Kn),I.d(Kn,{activeSegmentation:()=>ee,addRepresentationData:()=>Q6,addSegmentationRepresentations:()=>Bp,addSegmentations:()=>LK,config:()=>At,convertStackToVolumeSegmentation:()=>EW,convertVolumeToStackSegmentation:()=>hW,polySeg:()=>kn,removeSegmentationsFromToolGroup:()=>DD,segmentIndex:()=>Ce,segmentLocking:()=>we,state:()=>J,triggerSegmentationEvents:()=>K});var Xt={};I.r(Xt),I.d(Xt,{AnnotationStyleStates:()=>Is,ChangeTypes:()=>vr,Events:()=>Q,KeyboardBindings:()=>li,MouseBindings:()=>Uc,SegmentationRepresentations:()=>Nt,StrategyCallbacks:()=>qt,Swipe:()=>i0,ToolModes:()=>ke,WorkerTypes:()=>s0});var j=I(953);function zi(E){return zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},zi(E)}function $(E,u,g){return(u=function(m){var v=function(S,D){if(zi(S)!=="object"||S===null)return S;var O=S[Symbol.toPrimitive];if(O!==void 0){var N=O.call(S,"string");if(zi(N)!=="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(S)}(m);return zi(v)==="symbol"?v:String(v)}(u))in E?Object.defineProperty(E,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):E[u]=g,E}var Xe=I(907),it=I.n(Xe),Qt=function(E){return E.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",E.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",E.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",E.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",E.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",E.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",E.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",E.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",E.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",E.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",E.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",E.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",E.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",E.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",E.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",E.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",E.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",E.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",E.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",E.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",E.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",E.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",E.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",E.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",E.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",E.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",E.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",E.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",E.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",E.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",E.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",E.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",E.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",E.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",E.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",E.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",E.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE",E}(Qt||{});const Q=Qt,Rr=new Set;function ws(E){let u=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const g=cl();E&&(u?function(m,v,S){v.has(m)||(v.add(m),S.added.push(m))}(E,Rr,g):ul(E,Rr,g)),fl(g,Rr)}function Xu(){const E=cl();(function(u,g){u.forEach(m=>{ul(m,u,g)})})(Rr,E),fl(E,Rr)}function hd(){return Array.from(Rr)}function cr(E){return Rr.has(E)}function Cc(){return Rr.size}function si(E){if(E){const u=!!E.isLocked;(function(g){const m=Object.getOwnPropertyDescriptor(g,"isLocked");return m?m.configurable&&(m.set!==Go||m.get!==Yu):Object.isExtensible(g)})(E)&&Object.defineProperty(E,"isLocked",{configurable:!1,enumerable:!0,set:Go,get:Yu}),ws(E,u)}}function cl(){return Object.freeze({added:[],removed:[],locked:[]})}function ul(E,u,g){u.delete(E)&&g.removed.push(E)}function fl(E,u){(E.added.length>0||E.removed.length>0)&&(u.forEach(g=>{E.locked.push(g)}),(0,j.triggerEvent)(j.eventTarget,Q.ANNOTATION_LOCK_CHANGE,E))}function Go(E){ws(this,E)}function Yu(){return cr(this)}const Jr=new Set;function oa(E){arguments.length>1&&arguments[1]!==void 0&&!arguments[1]?xc(E):function(u){let g=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const m=sa();g||mo(Jr,m),u&&!Jr.has(u)&&(Jr.add(u),m.added.push(u)),vo(m,Jr)}(E,arguments.length>2&&arguments[2]!==void 0&&arguments[2])}function xc(E){const u=sa();E?Jr.delete(E)&&u.removed.push(E):mo(Jr,u),vo(u,Jr)}function Ju(){return Array.from(Jr)}function Zu(E){return Ju().filter(u=>{var g;const m=Bn(u);return(m==null||(g=m.metadata)===null||g===void 0?void 0:g.toolName)===E})}function zo(E){return Jr.has(E)}function Di(){return Jr.size}function sa(){return Object.freeze({added:[],removed:[],selection:[]})}function mo(E,u){E.forEach(g=>{E.delete(g)&&u.removed.push(g)})}function vo(E,u){(E.added.length>0||E.removed.length>0)&&(u.forEach(g=>{E.selection.push(g)}),(0,j.triggerEvent)(j.eventTarget,Q.ANNOTATION_SELECTION_CHANGE,E))}const yo=new Set;function Wo(E){let u=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const g=Cs();E&&(u?Sa(E,yo,g):function(m,v,S){v.has(m)||(v.add(m),zo(m)&&xc(m),S.lastHidden.push(m))}(E,yo,g)),Ec(g)}function Sc(){const E=Cs();yo.forEach(u=>{Sa(u,yo,E)}),Ec(E)}function mr(E){if(Bn(E))return!yo.has(E)}function jo(E){if(E){var u;const g=(u=E.isVisible)===null||u===void 0||u;(function(m){const v=Object.getOwnPropertyDescriptor(m,"isVisible");return v?v.configurable&&(v.set!==Ua||v.get!==Qu):Object.isExtensible(m)})(E)&&Object.defineProperty(E,"isVisible",{configurable:!1,enumerable:!0,set:Ua,get:Qu}),Wo(E.annotationUID,g)}}function Cs(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function Sa(E,u,g){u.delete(E)&&g.lastVisible.push(E)}function Ec(E){(E.lastHidden.length>0||E.lastVisible.length>0)&&(yo.forEach(u=>{E.hidden.push(u)}),(0,j.triggerEvent)(j.eventTarget,Q.ANNOTATION_VISIBILITY_CHANGE,E))}function Ua(E){Wo(this.annotationUID,E)}function Qu(){return mr(this.annotationUID)}class Tc{constructor(u){$(this,"annotations",void 0),$(this,"uid",void 0),$(this,"getGroupKey",g=>{if(typeof g=="string")return g;const m=g,v=(0,j.getEnabledElement)(m);if(!v)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return v.FrameOfReferenceUID}),$(this,"_imageVolumeModifiedHandler",g=>{const m=g.detail,{FrameOfReferenceUID:v}=m,S=this.annotations[v];S&&Object.keys(S).forEach(D=>{S[D].forEach(O=>{O.invalidated!==void 0&&(O.invalidated=!0)})})}),$(this,"getFramesOfReference",()=>Object.keys(this.annotations)),$(this,"getAnnotations",(g,m)=>{const v=this.annotations;return v[g]?m?v[g][m]?v[g][m]:[]:v[g]:[]}),$(this,"getAnnotation",g=>{const m=this.annotations;for(const v in m){const S=m[v];for(const D in S){const O=S[D];for(const N of O)if(g===N.annotationUID)return N}}}),$(this,"getNumberOfAnnotations",(g,m)=>{const v=this.getAnnotations(g,m);if(!v.length)return 0;if(m)return v.length;let S=0;for(const D in v)S+=v[D].length;return S}),$(this,"addAnnotation",(g,m)=>{const{metadata:v}=g,{FrameOfReferenceUID:S,toolName:D}=v;m=m||S;const O=this.annotations;let N=O[m];N||(O[m]={},N=O[m]);let R=N[D];R||(N[D]=[],R=N[D]),R.push(g),si(g),jo(g),(L=>{L.data||(L.data={}),L.data.handles||(L.data.handles={}),L.data.handles.textBox||(L.data.handles.textBox={})})(g),(L=>{L.data||(L.data={}),L.data.cachedStats||(L.data.cachedStats={})})(g)}),$(this,"removeAnnotation",g=>{const{annotations:m}=this;for(const v in m){const S=m[v];for(const D in S){const O=S[D],N=O.findIndex(R=>R.annotationUID===g);N!==-1&&(O.splice(N,1),O.length===0&&delete S[D])}Object.keys(S).length===0&&delete m[v]}}),$(this,"removeAnnotations",(g,m)=>{const v=this.annotations,S=[];if(!v[g])return S;if(m){const D=v[g][m];for(const O of D)this.removeAnnotation(O.annotationUID),S.push(O)}else for(const D in v[g]){const O=v[g][D];for(const N of O)this.removeAnnotation(N.annotationUID),S.push(N)}return S}),$(this,"saveAnnotations",(g,m)=>{const v=this.annotations;if(g&&m){const S=v[g];if(!S)return;const D=S[m];return it()(D)}if(g){const S=v[g];return it()(S)}return it()(v)}),$(this,"restoreAnnotations",(g,m,v)=>{const S=this.annotations;if(m&&v){let D=S[m];D||(S[m]={},D=S[m]),D[v]=g}else m?S[m]=g:this.annotations=it()(g)}),$(this,"getAllAnnotations",()=>Object.values(this.annotations).map(g=>Object.values(g)).flat(2)),$(this,"getNumberOfAllAnnotations",()=>{let g=0;const m=this.annotations;for(const v in m){const S=m[v];for(const D in S)g+=S[D].length}return g}),$(this,"removeAllAnnotations",()=>{const g=[];for(const m of this.getAllAnnotations())this.removeAnnotation(m.annotationUID),g.push(m);return g}),u||(u=j.utilities.uuidv4()),this.annotations={},this.uid=u,j.eventTarget.addEventListener(j.Enums.Events.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}}const Ba=new Tc("DEFAULT"),e0=Tc;var Ho=function(E){return E.Interaction="Interaction",E.HandlesUpdated="HandlesUpdated",E.StatsUpdated="StatsUpdated",E.InitialSetup="InitialSetup",E.Completed="Completed",E.InterpolationUpdated="InterpolationUpdated",E}(Ho||{});const vr=Ho;let _c={};const Dc={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:_c,enabledElements:[],handleRadius:6};let Ke={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:_c,enabledElements:[],handleRadius:6};var dl=function(E){return E.Active="Active",E.Passive="Passive",E.Enabled="Enabled",E.Disabled="Disabled",E}(dl||{});const ke=dl,tt=[ke.Active,ke.Passive,ke.Enabled],St=function(E){return Ke.toolGroups.filter(u=>{let{toolOptions:g}=u;const m=Object.keys(g);for(let v=0;v<m.length;v++)if(E===m[v]&&g[E]&&tt.includes(g[E].mode))return!0;return!1})};function Ut(E){const u=Q.ANNOTATION_REMOVED;(0,j.triggerEvent)(j.eventTarget,u,E)}function Yt(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vr.HandlesUpdated;const m=(0,j.getEnabledElement)(u),{viewportId:v,renderingEngineId:S}=m,D=Q.ANNOTATION_MODIFIED,O={annotation:E,viewportId:v,renderingEngineId:S,changeType:g};(0,j.triggerEvent)(j.eventTarget,D,O)}function sn(E){Jn({annotation:E})}function ur(E){Jn({annotation:E,contourHoleProcessingEnabled:arguments.length>1&&arguments[1]!==void 0&&arguments[1]})}function Jn(E){const u=Q.ANNOTATION_COMPLETED;(0,j.triggerEvent)(j.eventTarget,u,E)}let Zr=Ba;function tr(){return Zr}function xs(E){Zr=E}function t0(){Zr=Ba}function an(E,u){const g=tr(),m=g.getGroupKey(u);return g.getAnnotations(m,E)}function Jt(){return tr().getAllAnnotations()}function Pn(E){const{annotationUID:u,parentAnnotationUID:g}=E;if(!g)return;const m=Bn(g),v=m.childAnnotationUIDs.indexOf(u);m.childAnnotationUIDs.splice(v,1),E.parentAnnotationUID=void 0}function ar(E,u){const{annotationUID:g}=E,{annotationUID:m}=u;Pn(u),E.childAnnotationUIDs||(E.childAnnotationUIDs=[]),E.childAnnotationUIDs.includes(m)||(E.childAnnotationUIDs.push(m),u.parentAnnotationUID=g)}function Ar(E){return E.parentAnnotationUID?Bn(E.parentAnnotationUID):void 0}function Ga(E){var u,g;return(u=(g=E.childAnnotationUIDs)===null||g===void 0?void 0:g.map(m=>Bn(m)))!==null&&u!==void 0?u:[]}function fn(E,u){E.annotationUID||(E.annotationUID=j.utilities.uuidv4());const g=tr();if(u instanceof HTMLDivElement){const m=g.getGroupKey(u);g.addAnnotation(E,m),function(v,S){const D=(0,j.getEnabledElement)(S),{renderingEngine:O,viewportId:N}=D,R=Q.ANNOTATION_ADDED,L={annotation:v,viewportId:N,renderingEngineId:O.id};(0,j.triggerEvent)(j.eventTarget,R,L)}(E,u)}else g.addAnnotation(E),function(m){const{toolName:v}=m.metadata,S=St(v);if(!S.length)return;const D=[];S.forEach(R=>{R.viewportsInfo.forEach(L=>{const{renderingEngineId:P,viewportId:F}=L,{FrameOfReferenceUID:V}=(0,j.getEnabledElementByIds)(F,P);m.metadata.FrameOfReferenceUID===V&&D.push(L)})});const O=Q.ANNOTATION_ADDED,N={annotation:m};D.length?D.forEach(R=>{let{renderingEngineId:L,viewportId:P}=R;N.viewportId=P,N.renderingEngineId=L,(0,j.triggerEvent)(j.eventTarget,O,N)}):(0,j.triggerEvent)(j.eventTarget,O,N)}(E);return E.annotationUID}function Un(E,u){const g=tr(),m=g.getGroupKey(u);return g.getNumberOfAnnotations(m,E)}function Ht(E){var u;if(!E)return;const g=tr(),m=g.getAnnotation(E);m&&((u=m.childAnnotationUIDs)===null||u===void 0||u.forEach(v=>Ht(v)),g.removeAnnotation(E),Ut({annotation:m,annotationManagerUID:g.uid}))}function Bn(E){return tr().getAnnotation(E)}function gd(){const E=tr(),u=E.removeAllAnnotations();for(const g of u)Ut({annotation:g,annotationManagerUID:E.uid})}function Gy(E,u){const g=tr(),m=g.getGroupKey(u),v=g.removeAnnotations(m,E);for(const S of v)Ut({annotation:S,annotationManagerUID:g.uid})}function pd(E){let u=E;for(;u;)u.invalidated=!0,u=u.parentAnnotationUID?Bn(u.parentAnnotationUID):void 0}var Dp=function(E){return E.Labelmap="LABELMAP",E.Contour="CONTOUR",E.Surface="SURFACE",E}(Dp||{});const Nt=Dp,zy={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidthActive:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDashActive:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3},md={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85},bp=function(){return md},Wy={renderFill:!0,fillAlpha:1},Te=bp(),$e=zy,nt=Wy,Pt={colorLUT:[],segmentations:[],globalConfig:{renderInactiveSegmentations:!0,representations:{[Nt.Labelmap]:Te,[Nt.Contour]:$e,[Nt.Surface]:nt}},toolGroups:{}},Qr=new class{constructor(E){$(this,"state",void 0),$(this,"uid",void 0),E||(E=j.utilities.uuidv4()),this.state=it()(Pt),this.uid=E}getState(){return this.state}getToolGroups(){return Object.keys(this.state.toolGroups)}getColorLUT(E){return this.state.colorLUT[E]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=it()(Pt)}getSegmentation(E){return this.state.segmentations.find(u=>u.segmentationId===E)}addSegmentation(E){if(this.getSegmentation(E.segmentationId))throw new Error("Segmentation with id ".concat(E.segmentationId," already exists"));this.state.segmentations.push(E)}getSegmentationRepresentations(E){const u=this.state.toolGroups[E];if(u)return u.segmentationRepresentations}getAllSegmentationRepresentations(){const E={};return Object.entries(this.state.toolGroups).forEach(u=>{let[g,m]=u;E[g]=m.segmentationRepresentations}),E}addSegmentationRepresentation(E,u){this.state.toolGroups[E]||(this.state.toolGroups[E]={segmentationRepresentations:[],config:{}}),this.state.toolGroups[E].segmentationRepresentations.push(u),this._handleActiveSegmentation(E,u)}getGlobalConfig(){return this.state.globalConfig}setGlobalConfig(E){this.state.globalConfig=E}getSegmentationRepresentationByUID(E,u){const g=this.getSegmentationRepresentations(E);return g==null?void 0:g.find(m=>m.segmentationRepresentationUID===u)}removeSegmentation(E){this.state.segmentations=this.state.segmentations.filter(u=>u.segmentationId!==E)}removeSegmentationRepresentation(E,u){const g=this.getSegmentationRepresentations(E);if(!g||!g.length)throw new Error("No viewport specific segmentation state found for viewport ".concat(E));const m=g.findIndex(S=>S.segmentationRepresentationUID===u);m===-1&&console.warn("No viewport specific segmentation state data found for viewport ".concat(E," and segmentation data UID ").concat(u));const v=g[m];g.splice(m,1),this._handleActiveSegmentation(E,v)}setActiveSegmentationRepresentation(E,u){const g=this.getSegmentationRepresentations(E);if(!g||!g.length)throw new Error("No segmentation data found for toolGroupId: ".concat(E));const m=g.find(v=>v.segmentationRepresentationUID===u);if(!m)throw new Error("No segmentation data found for segmentation data UID ".concat(u));m.active=!0,this._handleActiveSegmentation(E,m)}getToolGroupSpecificConfig(E){const u=this.state.toolGroups[E];if(u)return u.config}getSegmentationRepresentationSpecificConfig(E,u){const g=this.getSegmentationRepresentationByUID(E,u);if(g)return g.segmentationRepresentationSpecificConfig}setSegmentationRepresentationSpecificConfig(E,u,g){const m=this.getSegmentationRepresentationByUID(E,u);m&&(m.segmentationRepresentationSpecificConfig=g)}getSegmentSpecificConfig(E,u,g){const m=this.getSegmentationRepresentationByUID(E,u);if(m)return m.segmentSpecificConfig[g]}setSegmentSpecificConfig(E,u,g,m){const v=this.getSegmentationRepresentationByUID(E,u);v&&((!v.segmentSpecificConfig||m!=null&&m.clear)&&(v.segmentSpecificConfig={}),Object.keys(g).forEach(S=>{v.segmentSpecificConfig[S]=g[S]}))}setSegmentationRepresentationConfig(E,u){let g=this.state.toolGroups[E];g||(this.state.toolGroups[E]={segmentationRepresentations:[],config:{renderInactiveSegmentations:!0,representations:{}}},g=this.state.toolGroups[E]),g.config={...g.config,...u}}addColorLUT(E,u){this.state.colorLUT[u]&&console.warn("Color LUT table already exists, overwriting"),this.state.colorLUT[u]=it()(E)}removeColorLUT(E){delete this.state.colorLUT[E]}_handleActiveSegmentation(E,u){const g=this.getSegmentationRepresentations(E);g.length!==0&&(g.length!==1&&g.filter(m=>m.active).length!==0?u.active&&g.forEach(m=>{m.segmentationRepresentationUID!==u.segmentationRepresentationUID&&(m.active=!1)}):g[0].active=!0)}}("DEFAULT");function Zn(E,u){const{imageIdReferenceMap:g}=E,{volumeId:m}=E;if(m&&!g)return!0;if(g&&!m)return!1;if(m&&g&&!u)throw new Error("isVolumeSegmentation: viewport is required when both volumeId and imageIdReferenceMap are provided");return u instanceof j.VolumeViewport}const Ea=new Map,bi=E=>{const u=Ea.get(E);u&&(u.isDirty=!0)};function Wi(E){const u=function(v){const S=Ea.get(v);return S&&!S.isDirty?S.indices:null}(E);if(u)return u;const g=dn(E);if(!g)throw new Error("No segmentation found for segmentationId ".concat(E));let m;switch(g.type){case Nt.Labelmap:m=function(v,S){const D=v.representationData[Nt.Labelmap],O=new Set;return Zn(D)?function(N,R){j.cache.getVolume(R).getScalarData().forEach(L=>{L!==0&&N.add(L)})}(O,S):function(N,R){R.forEach(L=>{j.cache.getImage(L).getPixelData().forEach(P=>{P!==0&&N.add(P)})})}(O,D.imageIdReferenceMap),Array.from(O).map(Number).sort((N,R)=>N-R)}(g,E);break;case Nt.Contour:m=function(v){const{annotationUIDsMap:S,geometryIds:D}=v.representationData.CONTOUR||{};if(!D)throw new Error("No geometryIds found for segmentationId ".concat(v.segmentationId));const O=new Set([...S.keys()]);return D.forEach(N=>{const R=j.cache.getGeometry(N);O.add(R.data.getSegmentIndex())}),Array.from(O).sort((N,R)=>N-R)}(g);break;case Nt.Surface:m=function(v){var S,D;const O=(S=(D=v.representationData.SURFACE)===null||D===void 0?void 0:D.geometryIds)!==null&&S!==void 0?S:[];return Array.from(O.keys()).map(Number).sort((N,R)=>N-R)}(g);break;default:throw new Error("Unsupported segmentation type: ".concat(g.type))}return Ea.set(E,{indices:m,isDirty:!1}),m}function Ss(E){const u={segmentationId:E};(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_REMOVED,u)}function vd(E,u){const g={toolGroupId:E,segmentationRepresentationUID:u};(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_REPRESENTATION_REMOVED,g)}function ji(E,u){const g={toolGroupId:E,segmentationRepresentationUID:u};u?(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_REPRESENTATION_MODIFIED,g):(Hi(E)||[]).forEach(m=>{const{segmentationRepresentationUID:v}=m,S={toolGroupId:E,segmentationRepresentationUID:v};(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_REPRESENTATION_MODIFIED,S)})}function Ta(E){let u;u=E?[E]:Ip().map(g=>{let{segmentationId:m}=g;return m}),u.forEach(g=>{const m={segmentationId:g};(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_MODIFIED,m)})}function pi(E,u){const g={segmentationId:E,modifiedSlicesToUse:u};bi(E),(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_DATA_MODIFIED,g)}const n0=function(E){const{segmentationId:u,representation:g}=E,m=g.type===Nt.Contour;let v=g.data?{...g.data}:null;if(v=!v&&m?{}:v,!v)throw new Error("Segmentation representation data may not be undefined");if(m){var S,D;const O=v;O.geometryIds=(S=O.geometryIds)!==null&&S!==void 0?S:[],O.annotationUIDsMap=(D=O.annotationUIDsMap)!==null&&D!==void 0?D:new Map}return{segmentationId:u,cachedStats:{},segmentLabels:{},label:null,segmentsLocked:new Set,type:g.type,activeSegmentIndex:1,representationData:{[g.type]:{...v}}}};function or(){return Qr}function dn(E){return or().getSegmentation(E)}function Ip(){return or().getState().segmentations}function P8(E,u){const g=or(),m=n0(E);g.addSegmentation(m),u||Ta(m.segmentationId)}function Hi(E){return or().getSegmentationRepresentations(E)}function r0(){return or().getAllSegmentationRepresentations()}function jy(E){const u=r0()||{},g=[];for(const m in u){const v=u[m].find(S=>S.segmentationId===E);v&&g.push(v)}return g}function Hy(E){const u=r0()||[],g=Object.keys(u);for(const m of g){const v=r0()[m].find(S=>S.segmentationRepresentationUID===E);if(v)return{segmentationRepresentation:v,toolGroupId:m}}}function bc(E){if(!E)throw new Error("getToolGroupIdsWithSegmentation: segmentationId is empty");const u=or(),g=u.getState(),m=Object.keys(g.toolGroups),v=[];return m.forEach(S=>{u.getSegmentationRepresentations(S).forEach(D=>{D.segmentationId===E&&v.push(S)})}),v}function F8(E){return or().getToolGroupSpecificConfig(E)}function V8(E,u,g){or().setSegmentationRepresentationConfig(E,u),g||ji(E)}function $y(E,u,g){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3];or().setSegmentationRepresentationSpecificConfig(E,u,g),m||ji(E,u)}function U8(E,u){return or().getSegmentationRepresentationSpecificConfig(E,u)}function B8(E,u,g){return or().getSegmentSpecificConfig(E,u,g)}function G8(E,u,g){let m=arguments.length>3&&arguments[3]!==void 0&&arguments[3];or().setSegmentSpecificConfig(E,u,g),m||ji(E,u)}function bz(E){const u=r0()||[],g=Object.keys(u);for(const m of g)if(r0()[m].find(v=>v.segmentationRepresentationUID===E))return m}function z8(E,u,g){or().addSegmentationRepresentation(E,u),g||ji(E,u.segmentationRepresentationUID)}function W8(){return or().getGlobalConfig()}function j8(E,u){or().setGlobalConfig(E),u||Ta()}function hl(E,u){return or().getSegmentationRepresentationByUID(E,u)}function Iz(E){or().removeSegmentation(E),Ss(E)}function yd(E,u){or().removeSegmentationRepresentation(E,u),vd(E,u)}function Oz(E){(Hi(E)||[]).forEach(u=>{yd(E,u.segmentationRepresentationUID)})}function Mz(E){or().removeColorLUT(E)}function wd(E){return or().getColorLUT(E)}function H8(){return or().getNextColorLUTIndex()}function Ky(E,u){or().addColorLUT(E,u)}function Ic(E,u){const g=u||E.currentTarget,{viewport:m}=(0,j.getEnabledElement)(g),v=function(O){return[O.clientX,O.clientY]}(E),S=function(O){return[O.pageX,O.pageY]}(E),D=function(O,N){const R=O.getBoundingClientRect();return[N[0]-R.left-window.pageXOffset,N[1]-R.top-window.pageYOffset]}(g,S);return{page:S,client:v,canvas:D,world:m.canvasToWorld(D)}}const $8=function(E){const u=E.currentTarget,{viewportId:g,renderingEngineId:m}=(0,j.getEnabledElement)(u),v=Ic(E,u),S={event:E,eventName:Q.MOUSE_DOUBLE_CLICK,viewportId:g,renderingEngineId:m,camera:{},element:u,startPoints:v,lastPoints:v,currentPoints:v,deltaPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};!(0,j.triggerEvent)(u,Q.MOUSE_DOUBLE_CLICK,S)&&(E.stopImmediatePropagation(),E.preventDefault())},K8=Q.MOUSE_MOVE,Cd=function(E){const u=E.currentTarget,g=(0,j.getEnabledElement)(u),{renderingEngineId:m,viewportId:v}=g,S={renderingEngineId:m,viewportId:v,camera:{},element:u,currentPoints:Ic(E),eventName:K8,event:E};!(0,j.triggerEvent)(u,K8,S)&&(E.stopImmediatePropagation(),E.preventDefault())},{MOUSE_DOWN:q8,MOUSE_DOWN_ACTIVATE:Nz,MOUSE_CLICK:Rz,MOUSE_UP:Az,MOUSE_DRAG:X8}=Q,Lz=3,kz={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Zt={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const Hr={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function Y8(E){const u=Ic(E,Zt.element),g=e6(Zt.element,Zt.lastPoints),m=Mp(u,g);if(Hr.doubleClickTimeout){if(!Z8(m.canvas))return;Op()}const v={event:E,eventName:X8,mouseButton:Zt.mouseButton,renderingEngineId:Zt.renderingEngineId,viewportId:Zt.viewportId,camera:{},element:Zt.element,startPoints:gl(Zt.startPoints),lastPoints:gl(g),currentPoints:u,deltaPoints:m};!(0,j.triggerEvent)(Zt.element,X8,v)&&(E.stopImmediatePropagation(),E.preventDefault()),Zt.lastPoints=gl(u)}function qy(E){if(clearTimeout(Zt.preventClickTimeout),Hr.doubleClickTimeout)Hr.mouseUpEvent?Xy():(Hr.mouseUpEvent=E,Zt.element.addEventListener("mousemove",J8));else{const u=Zt.isClickEvent?Rz:Az,g=Ic(E,Zt.element),m=Mp(g,Zt.lastPoints),v={event:E,eventName:u,mouseButton:Zt.mouseButton,element:Zt.element,renderingEngineId:Zt.renderingEngineId,viewportId:Zt.viewportId,camera:{},startPoints:gl(Zt.startPoints),lastPoints:gl(Zt.lastPoints),currentPoints:g,deltaPoints:m};(0,j.triggerEvent)(v.element,u,v),Xy()}document.removeEventListener("mousemove",Y8)}function J8(E){Z8(Mp(Ic(E,Zt.element),e6(Zt.element,Zt.lastPoints)).canvas)&&(Op(),Cd(E))}function Z8(E){return Math.abs(E[0])+Math.abs(E[1])>Lz}function Pz(){Zt.isClickEvent=!1}function Op(){Hr.ignoreDoubleClick=!0;const E=Hr.mouseDownEvent,u=Hr.mouseUpEvent;Q8(),function(g){const m=Mp(Zt.startPoints,Zt.startPoints),v={event:g,eventName:q8,element:Zt.element,mouseButton:Zt.mouseButton,renderingEngineId:Zt.renderingEngineId,viewportId:Zt.viewportId,camera:{},startPoints:Zt.startPoints,lastPoints:Zt.startPoints,currentPoints:Zt.startPoints,deltaPoints:m};Zt.lastPoints=gl(v.lastPoints),(0,j.triggerEvent)(v.element,q8,v)&&(0,j.triggerEvent)(v.element,Nz,v)}(E),u&&qy(u)}function Q8(){Hr.doubleClickTimeout&&(clearTimeout(Hr.doubleClickTimeout),Hr.doubleClickTimeout=null),Hr.mouseDownEvent=null,Hr.mouseUpEvent=null}function Xy(){var E,u;document.removeEventListener("mouseup",qy),(E=Zt.element)===null||E===void 0||E.removeEventListener("mousemove",J8),(u=Zt.element)===null||u===void 0||u.addEventListener("mousemove",Cd),Q8(),Zt=JSON.parse(JSON.stringify(kz))}function gl(E){return JSON.parse(JSON.stringify(E))}function e6(E,u){const{viewport:g}=(0,j.getEnabledElement)(E),m=g.canvasToWorld(u.canvas);return{page:u.page,client:u.client,canvas:u.canvas,world:m}}function Mp(E,u){return{page:Yy(E.page,u.page),client:Yy(E.client,u.client),canvas:Yy(E.canvas,u.canvas),world:(g=E.world,m=u.world,[g[0]-m[0],g[1]-m[1],g[2]-m[2]])};var g,m}function Yy(E,u){return[E[0]-u[0],E[1]-u[1]]}function t6(E){Hr.ignoreDoubleClick?(Hr.ignoreDoubleClick=!1,E.stopImmediatePropagation(),E.preventDefault()):Xy()}const n6=function(E){if(Hr.doubleClickTimeout)return E.buttons===Hr.mouseDownEvent.buttons?void 0:(Hr.mouseDownEvent=E,void Op());Hr.doubleClickTimeout=setTimeout(Op,E.buttons===1?400:150),Hr.mouseDownEvent=E,Hr.ignoreDoubleClick=!1,Zt.element=E.currentTarget,Zt.mouseButton=E.buttons;const u=(0,j.getEnabledElement)(Zt.element),{renderingEngineId:g,viewportId:m}=u;Zt.renderingEngineId=g,Zt.viewportId=m,Zt.preventClickTimeout=setTimeout(Pz,Zt.clickDelay),Zt.element.removeEventListener("mousemove",Cd);const v=Ic(E,Zt.element);Zt.startPoints=gl(v),Zt.lastPoints=gl(v),document.addEventListener("mouseup",qy),document.addEventListener("mousemove",Y8)};function r6(E){E.removeEventListener("dblclick",$8),E.removeEventListener("mousedown",n6),E.removeEventListener("mousemove",Cd),E.removeEventListener("dblclick",t6,{capture:!0})}const i6={enable:function(E){r6(E),E.addEventListener("dblclick",$8),E.addEventListener("mousedown",n6),E.addEventListener("mousemove",Cd),E.addEventListener("dblclick",t6,{capture:!0})},disable:r6},a6=function(E){const u=E.currentTarget,g=(0,j.getEnabledElement)(u),{renderingEngineId:m,viewportId:v}=g;if(E.deltaY>-1&&E.deltaY<1)return;E.preventDefault();const{spinX:S,spinY:D,pixelX:O,pixelY:N}=function(P){let F=0,V=0,G=0,W=0;return"detail"in P&&(V=P.detail),"wheelDelta"in P&&(V=-P.wheelDelta/120),"wheelDeltaY"in P&&(V=-P.wheelDeltaY/120),"wheelDeltaX"in P&&(F=-P.wheelDeltaX/120),G=10*F,W=10*V,"deltaY"in P&&(W=P.deltaY),"deltaX"in P&&(G=P.deltaX),(G||W)&&P.deltaMode&&(P.deltaMode===1?(G*=40,W*=40):(G*=800,W*=800)),G&&!F&&(F=G<1?-1:1),W&&!V&&(V=W<1?-1:1),{spinX:F,spinY:V,pixelX:G,pixelY:W}}(E),R=D<0?-1:1,L={event:E,eventName:Q.MOUSE_WHEEL,renderingEngineId:m,viewportId:v,element:u,camera:{},detail:E,wheel:{spinX:S,spinY:D,pixelX:O,pixelY:N,direction:R},points:Ic(E)};(0,j.triggerEvent)(u,Q.MOUSE_WHEEL,L)};function o6(E){E.removeEventListener("wheel",a6)}const s6={enable:function(E){o6(E),E.addEventListener("wheel",a6,{passive:!1})},disable:o6},Jy=0,Zy=1;let l6,c6;function u6(E,u){const g=Date.now();if(E!==l6){if(g-c6<=2e3)return u.preventDefault(),u.stopPropagation(),u.stopImmediatePropagation(),!1;l6=E}c6=g}const f6=u6.bind(null,Jy),d6=u6.bind(null,Zy);function h6(E,u,g){const m=g?f6:d6;u.forEach(function(v){E.addEventListener(v,m,{passive:!1})})}function g6(E,u,g){const m=g?f6:d6;u.forEach(function(v){E.removeEventListener(v,m)})}const p6=["mousedown","mouseup","mousemove"],m6=["touchstart","touchend"];function v6(E){g6(E,p6,Jy),g6(E,m6,Zy)}const y6={enable:function(E){v6(E),h6(E,p6,Jy),h6(E,m6,Zy)},disable:v6};var i0=function(E){return E.UP="UP",E.DOWN="DOWN",E.LEFT="LEFT",E.RIGHT="RIGHT",E}(i0||{});function Np(E,u){const g=u||E.currentTarget,m=E.type==="touchend"?E.changedTouches:E.touches;return Object.keys(m).map(v=>{const S=function(R){return[R.clientX,R.clientY]}(m[v]),D=function(R){return[R.pageX,R.pageY]}(m[v]),O=function(R,L){const P=R.getBoundingClientRect();return[L[0]-P.left-window.pageXOffset,L[1]-P.top-window.pageYOffset]}(g,D),{viewport:N}=(0,j.getEnabledElement)(g);return{page:D,client:S,canvas:O,world:N.canvasToWorld(O),touch:{identifier:v,radiusX:m[v].radiusX,radiusY:m[v].radiusY,force:m[v].force,rotationAngle:m[v].rotationAngle}}})}function Rp(E,u){const g=xd(E),m=xd(u);return{page:t5(g.page,m.page),client:t5(g.client,m.client),canvas:t5(g.canvas,m.canvas),world:(v=g.world,S=m.world,[v[0]-S[0],v[1]-S[1],v[2]-S[2]])};var v,S}function Qy(E,u){const g=xd(E),m=xd(u);return{page:a0(g.page,m.page),client:a0(g.client,m.client),canvas:a0(g.canvas,m.canvas),world:C6(g.world,m.world)}}function Fz(E,u){}function Ap(E,u){const g=w6(E),m=w6(u);return{page:g.page-m.page,client:g.client-m.client,canvas:g.canvas-m.canvas,world:g.world-m.world}}function $o(E){return JSON.parse(JSON.stringify(E))}function e5(E){return JSON.parse(JSON.stringify(E))}function xd(E){return E.reduce((u,g)=>({page:[u.page[0]+g.page[0]/E.length,u.page[1]+g.page[1]/E.length],client:[u.client[0]+g.client[0]/E.length,u.client[1]+g.client[1]/E.length],canvas:[u.canvas[0]+g.canvas[0]/E.length,u.canvas[1]+g.canvas[1]/E.length],world:[u.world[0]+g.world[0]/E.length,u.world[1]+g.world[1]/E.length,u.world[2]+g.world[2]/E.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function wo(E){return E.reduce((u,g)=>({page:[u.page[0]+g.page[0]/E.length,u.page[1]+g.page[1]/E.length],client:[u.client[0]+g.client[0]/E.length,u.client[1]+g.client[1]/E.length],canvas:[u.canvas[0]+g.canvas[0]/E.length,u.canvas[1]+g.canvas[1]/E.length],world:[u.world[0]+g.world[0]/E.length,u.world[1]+g.world[1]/E.length,u.world[2]+g.world[2]/E.length],touch:{identifier:null,radiusX:u.touch.radiusX+g.touch.radiusX/E.length,radiusY:u.touch.radiusY+g.touch.radiusY/E.length,force:u.touch.force+g.touch.force/E.length,rotationAngle:u.touch.rotationAngle+g.touch.rotationAngle/E.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function t5(E,u){return[E[0]-u[0],E[1]-u[1]]}function w6(E){const u=[];for(let g=0;g<E.length;g++)for(let m=0;m<E.length;m++)g<m&&u.push({page:a0(E[g].page,E[m].page),client:a0(E[g].client,E[m].client),canvas:a0(E[g].canvas,E[m].canvas),world:C6(E[g].world,E[m].world)});return u.reduce((g,m)=>({page:g.page+m.page/u.length,client:g.client+m.client/u.length,canvas:g.canvas+m.canvas/u.length,world:g.world+m.world/u.length}),{page:0,client:0,canvas:0,world:0})}function a0(E,u){return Math.sqrt(Math.pow(E[0]-u[0],2)+Math.pow(E[1]-u[1],2))}function C6(E,u){return Math.sqrt(Math.pow(E[0]-u[0],2)+Math.pow(E[1]-u[1],2)+Math.pow(E[2]-u[2],2))}j.Settings.getRuntimeSettings();const{TOUCH_START:x6,TOUCH_START_ACTIVATE:Vz,TOUCH_PRESS:S6,TOUCH_DRAG:E6,TOUCH_END:T6,TOUCH_TAP:_6,TOUCH_SWIPE:n5}=Q,Sd={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},Lp={page:0,client:0,canvas:0,world:0},D6={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Sd,touch:null}],lastPointsList:[{...Sd,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:Lp,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},b6={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Sd,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let It=JSON.parse(JSON.stringify(D6)),Lr=JSON.parse(JSON.stringify(b6));function pl(E,u,g){return(0,j.triggerEvent)(E,u,g)}function I6(E){const u=Np(E,It.element),g=M6(It.element,It.lastPointsList),m=u.length===g.length?Rp(u,g):Sd,v=u.length===g.length?Ap(u,g):Lp,S=u.length===g.length?Qy(u,It.lastPointsList):Lp;It.accumulatedDistance={page:It.accumulatedDistance.page+S.page,client:It.accumulatedDistance.client+S.client,canvas:It.accumulatedDistance.canvas+S.canvas,world:It.accumulatedDistance.world+S.world};const D={event:E,eventName:E6,renderingEngineId:It.renderingEngineId,viewportId:It.viewportId,camera:{},element:It.element,startPoints:wo(It.startPointsList),lastPoints:wo(g),currentPoints:wo(u),startPointsList:$o(It.startPointsList),lastPointsList:$o(g),currentPointsList:u,deltaPoints:m,deltaDistance:v};pl(It.element,E6,D),function(O,N){const R=new Date().getTime(),L=It.startTime.getTime();if(It.swiped||R-L>It.swipeToleranceMs)return;const[P,F]=N.canvas,V={event:O,eventName:n5,renderingEngineId:It.renderingEngineId,viewportId:It.viewportId,camera:{},element:It.element,swipe:null};Math.abs(P)>It.swipeDistanceThreshold&&(V.swipe=P>0?i0.RIGHT:i0.LEFT,pl(V.element,n5,V),It.swiped=!0),Math.abs(F)>It.swipeDistanceThreshold&&(V.swipe=F>0?i0.DOWN:i0.UP,pl(V.element,n5,V),It.swiped=!0)}(E,m),It.lastPointsList=$o(u)}function O6(E){clearTimeout(It.pressTimeout);const u=Np(E,It.element),g=M6(It.element,It.lastPointsList),m=u.length===g.length?Rp(u,g):Rp(u,u),v=u.length===g.length?Ap(u,g):Ap(u,u),S={event:E,eventName:T6,element:It.element,renderingEngineId:It.renderingEngineId,viewportId:It.viewportId,camera:{},startPointsList:$o(It.startPointsList),lastPointsList:$o(g),currentPointsList:u,startPoints:wo(It.startPointsList),lastPoints:wo(g),currentPoints:wo(u),deltaPoints:m,deltaDistance:v};pl(S.element,T6,S),function(D){if(new Date().getTime()-It.startTime.getTime()>Lr.tapToleranceMs||(Lr.taps===0&&(Lr.element=It.element,Lr.renderingEngineId=It.renderingEngineId,Lr.viewportId=It.viewportId,Lr.startPointsList=It.startPointsList),Lr.taps>0&&(Lr.element!=It.element||Lr.renderingEngineId!=It.renderingEngineId||Lr.viewportId!=It.viewportId)))return;const O=Np(D,Lr.element);Qy(O,Lr.startPointsList).canvas>Lr.tapMaxDistance||(clearTimeout(Lr.tapTimeout),Lr.taps+=1,Lr.tapTimeout=setTimeout(()=>{const N={event:D,eventName:_6,element:Lr.element,renderingEngineId:Lr.renderingEngineId,viewportId:Lr.viewportId,camera:{},currentPointsList:O,currentPoints:wo(O),taps:Lr.taps};pl(N.element,_6,N),Lr=JSON.parse(JSON.stringify(b6))},Lr.tapToleranceMs))}(E),It=JSON.parse(JSON.stringify(D6)),document.removeEventListener("touchmove",I6),document.removeEventListener("touchend",O6)}function M6(E,u){const{viewport:g}=(0,j.getEnabledElement)(E);return u.map(m=>{const v=g.canvasToWorld(m.canvas);return{page:m.page,client:m.client,canvas:m.canvas,world:v,touch:m.touch}})}const N6=function(E){It.element=E.currentTarget;const u=(0,j.getEnabledElement)(It.element),{renderingEngineId:g,viewportId:m}=u;It.renderingEngineId=g,It.viewportId=m,It.isTouchStart||(clearTimeout(It.pressTimeout),It.pressTimeout=setTimeout(()=>function(v){if(It.accumulatedDistance.canvas>It.pressMaxDistance)return;const S={event:v,eventName:S6,renderingEngineId:It.renderingEngineId,viewportId:It.viewportId,camera:{},element:It.element,startPointsList:$o(It.startPointsList),lastPointsList:$o(It.lastPointsList),startPoints:e5(wo(It.startPointsList)),lastPoints:e5(wo(It.lastPointsList))};pl(S.element,S6,S)}(E),It.pressDelay),function(v){It.isTouchStart=!0,It.startTime=new Date;const S=Np(v,It.element),D=wo(S),O=Sd,N=Lp,R={event:v,eventName:x6,element:It.element,renderingEngineId:It.renderingEngineId,viewportId:It.viewportId,camera:{},startPointsList:S,lastPointsList:S,currentPointsList:S,startPoints:D,lastPoints:D,currentPoints:D,deltaPoints:O,deltaDistance:N};It.startPointsList=$o(R.startPointsList),It.lastPointsList=$o(R.lastPointsList),pl(R.element,x6,R)&&pl(R.element,Vz,R)}(E),document.addEventListener("touchmove",I6),document.addEventListener("touchend",O6))};function R6(E){y6.disable(E),E.removeEventListener("touchstart",N6)}const A6={enable:function(E){R6(E),y6.enable(E),E.addEventListener("touchstart",N6,{passive:!1})},disable:R6},Uz={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Br={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function r5(E){Br.element=E.currentTarget;const u=(0,j.getEnabledElement)(Br.element),{renderingEngineId:g,viewportId:m}=u;Br.renderingEngineId=g,Br.viewportId=m,Br.key=E.key,Br.keyCode=E.keyCode,E.preventDefault();const v={renderingEngineId:Br.renderingEngineId,viewportId:Br.viewportId,element:Br.element,key:Br.key,keyCode:Br.keyCode};(0,j.triggerEvent)(v.element,Q.KEY_DOWN,v),document.addEventListener("keyup",L6),document.addEventListener("visibilitychange",i5),Br.element.removeEventListener("keydown",r5)}function i5(){document.removeEventListener("visibilitychange",i5),document.visibilityState==="hidden"&&k6()}function L6(E){const u={renderingEngineId:Br.renderingEngineId,viewportId:Br.viewportId,element:Br.element,key:Br.key,keyCode:Br.keyCode};document.removeEventListener("keyup",L6),document.removeEventListener("visibilitychange",i5),Br.element.addEventListener("keydown",r5),Br=it()(Uz),(0,j.triggerEvent)(u.element,Q.KEY_UP,u)}function k6(){Br.keyCode=void 0}const P6=r5;function F6(E){E.removeEventListener("keydown",P6)}const o0={enable:function(E){F6(E),E.addEventListener("keydown",P6)},disable:F6,getModifierKey:function(){return Br.keyCode}};var Bz=I(785),a5=I.n(Bz),Gz=I(283),o5=I.n(Gz);const nr=function(E,u){var g;u||(u=(g=(0,j.getRenderingEngines)().find(v=>v.getViewports().find(S=>S.id===E)))===null||g===void 0?void 0:g.id);const m=Ke.toolGroups.filter(v=>v.viewportsInfo.some(S=>S.renderingEngineId===u&&(!S.viewportId||S.viewportId===E)));if(m.length){if(m.length>1)throw new Error("Multiple tool groups found for renderingEngineId: ".concat(u," and viewportId: ").concat(E,`. You should only
      have one tool group per viewport in a renderingEngine.`));return m[0]}},qn=function(E){return Ke.toolGroups.find(u=>u.id===E)};function Ed(){return W8()}function V6(E){j8(E)}function zz(E){return Ed().representations[E]}function Wz(E,u){const g=Ed();V6({...g,representations:{...g.representations,[E]:{...g.representations[E],...u}}})}function kp(E){return F8(E)}function U6(E,u){V8(E,u)}function B6(E,u){return U8(E,u)}function jz(E,u,g){$y(E,u,g)}function G6(E,u,g){return B8(E,u,g)}function Hz(E,u,g){G8(E,u,g)}function s5(E,u,g){const m=Hi(E);if(!m)return;const v=m.find(N=>N.segmentationRepresentationUID===u);if(!v)return;const{segmentsHidden:S,segmentationId:D}=v,O=Wi(D);g?S.clear():O.forEach(N=>{S.add(N)}),ji(E,v.segmentationRepresentationUID)}function z6(E,u){const g=Hi(E).find(O=>O.segmentationRepresentationUID===u);if(!g)return;const{segmentsHidden:m,segmentationId:v}=g,S=Wi(v),D=new Set(S);return m.forEach(O=>D.delete(O)),!!D.size}function $z(E,u,g,m){const v=hl(E,u);v&&(g.forEach(S=>{m?v.segmentsHidden.delete(S):v.segmentsHidden.add(S)}),ji(E,u))}function Kz(E,u,g,m){const v=hl(E,u);v&&(m?v.segmentsHidden.delete(g):v.segmentsHidden.add(g),ji(E,u))}function W6(E,u,g){const m=hl(E,u);return!!m&&!m.segmentsHidden.has(g)}class l5{constructor(u,g){$(this,"supportedInteractionTypes",void 0),$(this,"configuration",void 0),$(this,"toolGroupId",void 0),$(this,"mode",void 0);const m=j.utilities.deepMerge(g,u),{configuration:v={},supportedInteractionTypes:S,toolGroupId:D}=m;v.strategies||(v.strategies={},v.defaultStrategy=void 0,v.activeStrategy=void 0,v.strategyOptions={}),this.toolGroupId=D,this.supportedInteractionTypes=S||[],this.configuration=Object.assign({},v),this.mode=ke.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(u,g){var m;const{strategies:v,activeStrategy:S}=this.configuration;return(m=v[S])===null||m===void 0?void 0:m.call(this,u,g)}applyActiveStrategyCallback(u,g,m){var v;const{strategies:S,activeStrategy:D}=this.configuration;if(!S[D])throw new Error("applyActiveStrategyCallback: active strategy ".concat(D," not found, check tool configuration or spellings"));return(v=S[D][m])===null||v===void 0?void 0:v.call(this,u,g)}setConfiguration(u){this.configuration=j.utilities.deepMerge(this.configuration,u)}setActiveStrategy(u){this.setConfiguration({activeStrategy:u})}getTargetVolumeId(u){var g;if(this.configuration.volumeId)return this.configuration.volumeId;const m=u.getActors();return m?(g=m.find(v=>v.actor.getClassName()==="vtkVolume"))===null||g===void 0?void 0:g.uid:void 0}getTargetIdImage(u,g){if(u.startsWith("imageId:")){const m=u.split("imageId:")[1],v=j.utilities.imageIdToURI(m);let S=j.utilities.getViewportsWithImageURI(v,g.id);return!S||!S.length||(S=S.filter(D=>D.getCurrentImageId()===m),!S||!S.length)?void 0:S[0].getImageData()}if(u.startsWith("volumeId:")){const m=j.utilities.getVolumeId(u),v=j.utilities.getViewportsWithVolumeId(m,g.id);return!v||!v.length?void 0:v[0].getImageData()}if(u.startsWith("videoId:")){const m=j.utilities.imageIdToURI(u),v=j.utilities.getViewportsWithImageURI(m,g.id);return!v||!v.length?void 0:v[0].getImageData()}throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(u){var g;const m=(g=u.getReferenceId)===null||g===void 0?void 0:g.call(u);if(m)return m;if(u instanceof j.BaseVolumeViewport)return"volumeId:".concat(this.getTargetVolumeId(u));throw new Error("getTargetId: viewport must have a getReferenceId method")}}$(l5,"toolName",void 0),l5.toolName="BaseTool";const kr=l5,qz=function(E,u){const g=(0,j.getEnabledElement)(E),{viewport:m}=g,v=m.getActors().map(S=>{let{uid:D}=S;return D.startsWith(u)?D:void 0}).filter(Boolean);m.removeActors(v)};var Xz=I(610),j6=I.n(Xz),Yz=I(474),H6=I.n(Yz),Jz=I(70),c5=I.n(Jz),Zz=I(396),$6=I.n(Zz),K6=function(E){return E.POLYSEG_CONTOUR_TO_LABELMAP="polySeg/convertContourToVolumeLabelmap",E.POLYSEG_SURFACE_TO_LABELMAP="polySeg/convertSurfacesToVolumeLabelmap",E.POLYSEG_CONTOUR_TO_SURFACE="polySeg/convertContourToSurface",E.POLYSEG_LABELMAP_TO_SURFACE="polySeg/convertLabelmapToSurface",E.SURFACE_CLIPPING="surfaceClipping",E}(K6||{});const s0=K6;function u5(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return parseFloat(E[0]).toFixed(u)+","+parseFloat(E[1]).toFixed(u)+","+parseFloat(E[2]).toFixed(u)+","}let q6=!1;function X6(){q6||(q6=!0,(0,j.getWebWorkerManager)().registerWorker("polySeg",()=>new Worker(new URL(I.p+I.u(985),I.b),{name:"polySeg"}),{maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}}))}const Y6=(0,j.getWebWorkerManager)(),f5=new Map,d5=new Map,Pp=(E,u)=>{(0,j.triggerEvent)(E,j.Enums.Events.WEB_WORKER_PROGRESS,{progress:u,type:s0.SURFACE_CLIPPING})};async function J6(E,u,g){var m;X6();const v=(m=u.getSlicesClippingPlanes)===null||m===void 0?void 0:m.call(u);if(!v)return;const S=u.getSliceIndex();v.sort((N,R)=>Math.abs(N.sliceIndex-S)-Math.abs(R.sliceIndex-S)),Pp(j.eventTarget,0),await async function(N){const R=N.filter(L=>!d5.has(L.id));R.length&&(await Y6.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:R},{callbacks:[L=>{let{progress:P}=L;Pp(j.eventTarget,P)}]})).forEach((L,P)=>{d5.set(P,L)})}(E);const D=new Map;E.forEach(N=>{D.set(N.id,d5.get(N.id))});const O=u.getCamera();return await Y6.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:E,planesInfo:v,surfacesAABB:D},{callbacks:[N=>{let{progress:R}=N;Pp(j.eventTarget,R)},N=>{let{sliceIndex:R,polyDataResults:L}=N;L.forEach((P,F)=>{const V="".concat(g,"_").concat(F),G=function(W,q,Y){return"".concat(W.id,"-").concat(u5(q),"-").concat(Y)}(u,O.viewPlaneNormal,R);(function(W,q,Y){const{points:Z,lines:ne,numberOfCells:oe}=Y;let ue=f5.get(W);ue||(ue=new Map,f5.set(W,ue)),ue.set(q,{points:Z,lines:ne,numberOfCells:oe})})(V,G,P)})}]}).catch(N=>{console.error(N)}),Pp(j.eventTarget,1),f5}function Z6(E){if("volumeId"in E){if(!j.cache.getVolume(E.volumeId))throw new Error("volumeId of ".concat(E.volumeId," not found in cache, you should load and cache volume before adding segmentation"))}else{if(!("imageIdReferenceMap"in E))throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData");if(!E.imageIdReferenceMap)throw new Error("The segmentationInput.representationData.imageIdReferenceMap is undefined, please provide a valid representationData.imageIdReferenceMap")}}function Qz(E){Z6(E)}const eW=new Map([[Nt.Labelmap,new Set([Nt.Surface,Nt.Contour])],[Nt.Contour,new Set([Nt.Labelmap,Nt.Surface])],[Nt.Surface,new Set([Nt.Labelmap])]]);function Fp(E){const u=Hy(E);if(u==null||!u.segmentationRepresentation)return!1;const{segmentationRepresentation:g}=u,{type:m,polySeg:v}=g;if(!v||!v.enabled)return!1;const{representationData:S}=dn(g.segmentationId);return function(O){const N=[];return Object.keys(O).forEach(R=>{const L=O[R];let P;if(R===Nt.Labelmap&&(P=Qz),P)try{P(L),N.push(R)}catch{console.warn("Validation failed for labelmap of type ".concat(R))}else N.push(R)}),N}(S).some(O=>async function(N,R){var L;return((L=eW.get(N))===null||L===void 0?void 0:L.has(R))||!1}(O,m))}const Q6=function(E){let{segmentationId:u,type:g,data:m}=E;const v=dn(u);switch(v.representationData[g]&&console.warn("Representation data of type ".concat(g," already exists for segmentation ").concat(u,", overwriting it.")),g){case Nt.Labelmap:case Nt.Contour:case Nt.Surface:m&&(v.representationData[g]=m);break;default:throw new Error("Invalid representation type ".concat(g))}},h5=function(E){const u=typeof E;return E!==null&&(u==="object"||u==="function")},Vp=function(E,u,g){let m,v,S,D,O,N,R=0,L=!1,P=!1,F=!0;const V=!u&&u!==0&&typeof window.requestAnimationFrame=="function";if(typeof E!="function")throw new TypeError("Expected a function");function G(oe){const ue=m,ge=v;return m=v=void 0,R=oe,D=E.apply(ge,ue),D}function W(oe,ue){return V?window.requestAnimationFrame(oe):setTimeout(oe,ue)}function q(oe){const ue=oe-N;return N===void 0||ue>=u||ue<0||P&&oe-R>=S}function Y(){const oe=Date.now();if(q(oe))return Z(oe);O=W(Y,function(ue){const ge=ue-R,me=u-(ue-N);return P?Math.min(me,S-ge):me}(oe))}function Z(oe){return O=void 0,F&&m?G(oe):(m=v=void 0,D)}function ne(){const oe=Date.now(),ue=q(oe);for(var ge=arguments.length,me=new Array(ge),xe=0;xe<ge;xe++)me[xe]=arguments[xe];if(m=me,v=this,N=oe,ue){if(O===void 0)return function(Ee){return R=Ee,O=W(Y,u),L?G(Ee):D}(N);if(P)return O=W(Y,u),G(N)}return O===void 0&&(O=W(Y,u)),D}return u=Number(u)||0,h5(g)&&(L=!!g.leading,P="maxWait"in g,S=P?Math.max(Number(g.maxWait)||0,u):S,F="trailing"in g?!!g.trailing:F),ne.cancel=function(){O!==void 0&&function(oe){if(V)return window.cancelAnimationFrame(oe);clearTimeout(oe)}(O),R=0,m=N=v=O=void 0},ne.flush=function(){return O===void 0?D:Z(Date.now())},ne.pending=function(){return O!==void 0},ne},Up=new Map;async function g5(E,u,g,m){X6();const v=await g();Q6({segmentationId:E,type:u,data:v}),Up.has(E)||Up.set(E,[]);const S=Up.get(E);return S.includes(u)||S.push(u),function(D){D._debouncedUpdateFunction=O=>{tW(O,D)},j.eventTarget.removeEventListener(Q.SEGMENTATION_DATA_MODIFIED,D._debouncedUpdateFunction),j.eventTarget.addEventListener(Q.SEGMENTATION_DATA_MODIFIED,D._debouncedUpdateFunction)}(m),Ta(E),v}const tW=Vp((E,u)=>{const g=E.detail.segmentationId,m=Up.get(g);m&&m.length&&(u(g),m.length&&Ta(g))},300),nW=(0,j.getWebWorkerManager)(),p5=(E,u)=>{(0,j.triggerEvent)(E,j.Enums.Events.WEB_WORKER_PROGRESS,{progress:u,type:s0.POLYSEG_CONTOUR_TO_SURFACE})};function rW(E,u){if(!E)throw new Error("addColorLUT: colorLUT is required");j.utilities.isEqual(E[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),E.unshift([0,0,0,0])),Ky(E,u)}function iW(E,u,g){const m=hl(E,u);if(!m)throw new Error("setColorLUT: could not find segmentation representation with UID ".concat(u));if(!wd(g))throw new Error("setColorLUT: could not find colorLUT with index ".concat(g));m.colorLUTIndex=g,ji(E,u)}function Es(E,u,g){const m=hl(E,u);if(!m)throw new Error("segmentation representation with UID ".concat(u," does not exist for tool group ").concat(E));const{colorLUTIndex:v}=m,S=wd(v);let D=S[g];if(!D){if(typeof g!="number")throw new Error("Can't create colour for LUT index ".concat(g));D=S[g]=[0,0,0,0]}return D}function e_(E,u,g,m){const v=Es(E,u,g);for(let S=0;S<m.length;S++)v[S]=m[S];ji(E,u)}async function t_(E,u){let g,m,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};v.segmentationRepresentationUID&&({segmentationRepresentation:g,toolGroupId:m}=Hy(v.segmentationRepresentationUID));const S=dn(E),D=new Map,O=Object.keys(u).map(async N=>{const R=u[N],L=R.segmentIndex,P=g;if(Es(m,g.segmentationRepresentationUID,L).slice(0,3),!P)throw new Error("No color found for segment index, unable to create surface");const F={id:"segmentation_".concat(S.segmentationId,"_surface_").concat(L),color:P,frameOfReferenceUID:"test-frameOfReferenceUID",data:{points:R.data.points,polys:R.data.polys}},V=F.id;return D.set(L,V),j.geometryLoader.createAndCacheGeometry(V,{type:j.Enums.GeometryType.SURFACE,geometryData:F})});return await Promise.all(O),{geometryIds:D}}var aW=I(441),oW=I.n(aW),sW=I(795),lW=I.n(sW);const cW=function(E,u){const g=(0,j.getEnabledElement)(E),{viewport:m}=g;m.removeActors([u])};var le=I(976);const n_=(0,j.getWebWorkerManager)(),l0=(E,u)=>{(0,j.triggerEvent)(E,j.Enums.Events.WEB_WORKER_PROGRESS,{progress:u,type:s0.POLYSEG_CONTOUR_TO_LABELMAP})};async function uW(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{viewport:g}=u,m=j.utilities.getViewportImageIds(g);if(!m)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const v=j.utilities.uuidv4(),S=j.utilities.generateVolumePropsFromImageIds(m,v),{metadata:D,dimensions:O,origin:N,direction:R,spacing:L,scalarData:P}=S,F=await j.volumeLoader.createLocalSegmentationVolume({dimensions:O,origin:N,direction:R,spacing:L,metadata:D,imageIds:m.map(q=>"generated://".concat(q)),referencedImageIds:m},v),{segmentIndices:V,annotationUIDsInSegmentMap:G}=r_(E,u);l0(j.eventTarget,0);const W=await n_.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:V,dimensions:O,scalarData:P,origin:N,direction:R,spacing:L,annotationUIDsInSegmentMap:G},{callbacks:[q=>{l0(j.eventTarget,q)}]});return l0(j.eventTarget,1),F.imageData.getPointData().getScalars().setData(W),F.imageData.modified(),F.modified(),{volumeId:F.volumeId}}async function fW(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!u.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const g=u.viewport.getImageIds();if(!g)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");g.forEach(R=>{if(!j.cache.getImageLoadObject(R))throw new Error("ImageIds must be cached before converting contour to labelmap")});const{imageIds:m}=await j.imageLoader.createAndCacheDerivedSegmentationImages(g),{segmentIndices:v,annotationUIDsInSegmentMap:S}=r_(E,u),D=new Map;m.forEach((R,L)=>{var P,F,V,G,W;const q=j.cache.getImage(R),Y=j.metaData.get(j.Enums.MetadataModules.IMAGE_PLANE,R);let{columnCosines:Z,rowCosines:ne,rowPixelSpacing:oe,columnPixelSpacing:ue,imagePositionPatient:ge}=Y;Z=(P=Z)!==null&&P!==void 0?P:[0,1,0],ne=(F=ne)!==null&&F!==void 0?F:[1,0,0],oe=(V=oe)!==null&&V!==void 0?V:1,ue=(G=ue)!==null&&G!==void 0?G:1,ge=(W=ge)!==null&&W!==void 0?W:[0,0,0];const me=le.vec3.fromValues(ne[0],ne[1],ne[2]),xe=le.vec3.fromValues(Z[0],Z[1],Z[2]),Ee=le.vec3.create();le.vec3.cross(Ee,me,xe);const Ie=[...me,...xe,...Ee],be=[oe,ue,1],Ne=ge;D.set(g[L],{direction:Ie,spacing:be,origin:Ne,scalarData:q.getPixelData(),imageId:R,dimensions:[q.width,q.height,1]})}),l0(j.eventTarget,0);const O=await n_.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:D,annotationUIDsInSegmentMap:S,segmentIndices:v},{callbacks:[R=>{l0(j.eventTarget,R)}]});l0(j.eventTarget,1);const N=new Map;return O.forEach((R,L)=>{var P;let{scalarData:F}=R;const V=D.get(L),{imageId:G}=V,W=j.cache.getImage(G);W.getPixelData().set(F),(P=W.imageFrame)===null||P===void 0||(P=P.pixelData)===null||P===void 0||P.set(F),N.set(L,G)}),{imageIdReferenceMap:N}}function r_(E){var u;let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m=E.annotationUIDsMap,v=(u=g.segmentIndices)!==null&&u!==void 0&&u.length?g.segmentIndices:Array.from(m.keys()),S=new Map;return v.forEach(D=>{const O=m.get(D);let N=Array.from(O);N=N.filter(L=>!Bn(L).parentAnnotationUID);const R=N.map(L=>{var P;const F=Bn(L),V=(P=F.childAnnotationUIDs)===null||P===void 0?void 0:P.length;return{polyline:F.data.contour.polyline,referencedImageId:F.metadata.referencedImageId,holesPolyline:V&&F.childAnnotationUIDs.map(G=>Bn(G).data.contour.polyline)}});S.set(D,R)}),{segmentIndices:v,annotationUIDsInSegmentMap:S}}const dW=(0,j.getWebWorkerManager)(),m5=(E,u)=>{(0,j.triggerEvent)(E,j.Enums.Events.WEB_WORKER_PROGRESS,{progress:u,type:s0.POLYSEG_SURFACE_TO_LABELMAP})};function v5(E,u){return new Map(E.map((g,m)=>[g,u[m]]))}async function i_(E){let{volumeId:u}=E;const g=j.cache.getVolume(u);let m=!1;g.imageCacheOffsetMap.size>0&&(m=g.imageIds.every(D=>j.cache.getImage(D)));const v=(0,j.getRenderingEngines)()[0].getVolumeViewports().find(D=>D.hasVolumeId(u));return g.decache(!v&&m),{imageIdReferenceMap:function(D){var O,N;if((O=D.additionalDetails)!==null&&O!==void 0&&O.imageIdReferenceMap)return D.additionalDetails.imageIdReferenceMap;if((N=D.referencedImageIds)!==null&&N!==void 0&&N.length&&!D.referencedImageIds[0].startsWith("derived"))return v5(D.referencedImageIds,[...D.imageIds].reverse());{var R,L,P;const F=D.referencedVolumeId,V=j.cache.getVolume(F);if(!V)throw new Error("Cannot convert volumetric segmentation without referenced volume to stack segmentation yet");if(V==null||(R=V.imageIds)===null||R===void 0||!R.length)throw new Error("Cannot convert volumetric segmentation without imageIds to stack segmentation yet");if((L=V.imageIds)!==null&&L!==void 0&&L[0].startsWith("derived"))throw new Error(`Cannot convert volume segmentation that is derived from another segmentation
         to stack segmentation yet, include the additionalDetails.imageIdReferenceMap
         in the volume segmentation in case you need it for the conversion`);const G=V.imageIds;let W=D.imageIds;return(P=W)!==null&&P!==void 0&&P.length||(W=D.convertToImageSlicesAndCache()),v5(G,[...W].reverse())}}(g)}}async function hW(E){let{segmentationId:u,options:g}=E;const m=dn(u).representationData.LABELMAP,{imageIdReferenceMap:v}=await i_({volumeId:m.volumeId});await async function(S){let{segmentationId:D,toolGroupId:O,imageIdReferenceMap:N,options:R}=S;const L=dn(D);if(R!=null&&R.removeOriginal){const P=L.representationData.LABELMAP;j.cache.getVolume(P.volumeId)&&j.cache.removeVolumeLoadObject(P.volumeId),L.representationData.LABELMAP={imageIdReferenceMap:N}}else L.representationData.LABELMAP={...L.representationData.LABELMAP,imageIdReferenceMap:N};await Bp(O,[{segmentationId:D,type:Nt.Labelmap}]),x1(O),j.eventTarget.addEventListenerOnce(Q.SEGMENTATION_RENDERED,()=>pi(D))}({segmentationId:u,toolGroupId:g.toolGroupId,imageIdReferenceMap:v,options:g})}function a_(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return g5(E,Nt.Labelmap,()=>async function(g){var m;let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const S=(m=v.segmentIndices)!==null&&m!==void 0&&m.length?v.segmentIndices:Wi(g);let D;const O=dn(g),N=O.representationData;try{N.CONTOUR?D=await async function(R){var L,P;let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const V=(L=F.viewport instanceof j.VolumeViewport)===null||L===void 0||L;if(V&&!F.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const G=(P=F.segmentIndices)!==null&&P!==void 0&&P.length?F.segmentIndices:Wi(R),W=dn(R).representationData.CONTOUR;return await(V?uW:fW)(W,{segmentIndices:G,segmentationRepresentationUID:F.segmentationRepresentationUID,viewport:F.viewport})}(g,{segmentIndices:S,...v}):N.SURFACE&&(D=await async function(R){var L,P;let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const V=(L=F.viewport instanceof j.VolumeViewport)===null||L===void 0||L,G=(P=F.segmentIndices)!==null&&P!==void 0&&P.length?F.segmentIndices:Wi(R),W=dn(R),q=new Map;if(W.representationData.SURFACE.geometryIds.forEach((ne,oe)=>{G.includes(oe)&&q.set(oe,ne)}),V&&!F.viewport)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let Y;if(V){const ne=F.viewport.getDefaultActor(),{uid:oe}=ne;Y=await j.volumeLoader.createAndCacheDerivedSegmentationVolume(oe)}else{const ne=F.viewport.getImageIds(),oe="generatedSegmentationVolumeId",ue=j.utilities.generateVolumePropsFromImageIds(ne,oe);delete ue.imageIds,Y=await j.volumeLoader.createLocalSegmentationVolume({...ue,scalarData:ue.scalarData,referencedImageIds:ne},oe)}const Z=await async function(ne,oe){const{geometryIds:ue}=ne;if(ue==null||!ue.size)throw new Error("No geometry IDs found for surface representation");const ge=new Map;ue.forEach((Ne,_e)=>{const Me=j.cache.getGeometry(Ne).data,Pe=Me.getPoints(),Ze=Me.getPolys();ge.set(_e,{points:Pe,polys:Ze})});const{dimensions:me,direction:xe,origin:Ee,spacing:Ie}=oe;m5(j.eventTarget,0);const be=await dW.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:ge,dimensions:me,spacing:Ie,direction:xe,origin:Ee},{callbacks:[Ne=>{m5(j.eventTarget,Ne)}]});return m5(j.eventTarget,1),oe.imageData.getPointData().getScalars().setData(be),oe.imageData.modified(),oe.modified(),{volumeId:oe.volumeId}}({geometryIds:q},Y);return V?Z:await i_({volumeId:Y.volumeId})}(O.segmentationId,{segmentIndices:S,...v}))}catch(R){throw console.error(R),R}if(!D)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return D}(E,u),()=>{})}const y5=new Map;function o_(){const E=lW().newInstance(),u=oW().newInstance();return u.addPoint(0,0),{ofun:u,cfun:E}}let w5=!1;function s_(E,u,g,m){const v={...E,...u,...m||{}};return{fillAlpha:g?v.fillAlpha:v.fillAlphaInactive,outlineWidth:g?v.outlineWidthActive:v.outlineWidthInactive,renderFill:g?v.renderFill:v.renderFillInactive,renderOutline:v.renderOutline,outlineOpacity:g?v.outlineOpacity:v.outlineOpacityInactive}}function gW(E,u,g,m){let{fillAlpha:v,renderFill:S,renderOutline:D,segmentColor:O,outlineWidth:N,segmentsHidden:R}=m;const L="".concat(E,"-").concat(u,"-").concat(g),P=y5.get(L);if(!P)return y5.set(L,{fillAlpha:v,renderFill:S,renderOutline:D,outlineWidth:N,segmentColor:O.slice(),segmentsHidden:new Set(R)}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:F,renderFill:V,renderOutline:G,outlineWidth:W,segmentColor:q,segmentsHidden:Y}=P,Z=q[0]!==O[0]||q[1]!==O[1]||q[2]!==O[2],ne=q[3]!==O[3]||F!==v||V!==S||G!==D||W!==N||Y.has(g)!==R.has(g);return y5.set(L,{fillAlpha:v,renderFill:S,renderOutline:D,outlineWidth:N,segmentColor:O.slice(),segmentsHidden:new Set(R)}),{forceOpacityUpdate:ne,forceColorUpdate:Z}}async function l_(E,u,g){await async function(m,v,S){const D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{id:R}=N;if(Zn(v,N)){const L=[{volumeId:v.volumeId,actorUID:S,visibility:!0,blendMode:j.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND}];await(0,j.addVolumesToViewports)(O,L,[R],!1,!0)}else{const L=[{imageId:v.imageIdReferenceMap.get(N.getCurrentImageId()),actorUID:S}];await(0,j.addImageSlicesToViewports)(O,L,[R])}}(E.element,u,g)}const c_={getRepresentationRenderingConfig:o_,render:async function(E,u,g){const{colorLUTIndex:m,active:v,segmentationId:S,segmentationRepresentationUID:D,segmentsHidden:O,config:N}=u,R=dn(S);if(!R)return void console.warn("No segmentation found for segmentationId: ",S);let L=R.representationData[Nt.Labelmap],P=E.getActor(D);if(!L&&Fp(D)&&!w5){if(w5=!0,L=await a_(S,{segmentationRepresentationUID:D,viewport:E}),!L)throw new Error("No labelmap data found for segmentationId ".concat(S,"."));w5=!1}if(!L)return;if(Zn(L,E)){var F;if(E instanceof j.StackViewport)return;const{volumeId:q}=L;if(!j.cache.getVolume(q))throw new Error("No Labelmap found for volumeId: ".concat(q));if(!function(Y,Z){if(!Z)return!0;const ne=Y.getDefaultActor();if(!ne)return!1;const{uid:oe}=ne,ue=j.cache.getVolume(oe);if(ue){const ge=j.cache.getVolume(Z);if(ge&&ue.metadata.FrameOfReferenceUID===ge.metadata.FrameOfReferenceUID)return!0}return!1}(E,(F=L)===null||F===void 0?void 0:F.referencedVolumeId))return;P||await l_(E,L,D),P=E.getActor(D)}else{if(E instanceof j.VolumeViewport)return;const q=E.getCurrentImageId(),{imageIdReferenceMap:Y}=L;if(!Y.has(q))return;P||await l_(E,L,D),P=E.getActor(D)}if(!P)return;const{cfun:V,ofun:G}=N,W=g.renderInactiveSegmentations;(function(q,Y,Z,ne,oe,ue,ge,me,xe,Ee){const{segmentSpecificConfig:Ie,segmentationRepresentationSpecificConfig:be}=ge,Ne=be[Nt.Labelmap],_e=wd(oe),Me=Math.min(256,_e.length),{uid:Pe}=Y,{outlineWidth:Ze,renderOutline:Ye,outlineOpacity:at}=s_(ue,Ne,me);for(let Ct=0;Ct<Me;Ct++){var ot;const gt=Ct,Dt=_e[gt],en=(ot=Ie[gt])===null||ot===void 0?void 0:ot[Nt.Labelmap],{fillAlpha:$t,outlineWidth:mn,renderFill:Cn,renderOutline:br}=s_(ue,Ne,me,en),{forceOpacityUpdate:ci,forceColorUpdate:qi}=gW(q,Pe,gt,{fillAlpha:$t,renderFill:Cn,renderOutline:br,segmentColor:Dt,outlineWidth:mn,segmentsHidden:Ee});if(qi&&Z.addRGBPoint(gt,Dt[0]/255,Dt[1]/255,Dt[2]/255),ci)if(Cn){const Da=Ee.has(gt)?0:Dt[3]/255*$t;ne.removePoint(gt),ne.addPointLong(gt,Da,.5,1)}else ne.addPointLong(gt,.01,.5,1)}const st=Y.actor;st.getProperty().setRGBTransferFunction(0,Z),ne.setClamping(!1),st.getProperty().setScalarOpacity(0,ne),st.getProperty().setInterpolationTypeToNearest(),st.getProperty().setUseLabelOutline(Ye),st.getProperty().setLabelOutlineOpacity(at);const{activeSegmentIndex:ct}=dn(ge.segmentationId),Tt=new Array(Me-1);for(let Ct=1;Ct<Me;Ct++)Ee.has(Ct)?Tt[Ct-1]=0:Tt[Ct-1]=Ct===ct?Ze+ue.activeSegmentOutlineWidthDelta:Ze;st.getProperty().setLabelOutlineThickness(Tt);const pt=me||xe;st.setVisibility(pt)})(E.id,P,V,G,m,g.representations[Nt.Labelmap],u,v,W,O)},removeSegmentationRepresentation:function(E,u){let g=arguments.length>2&&arguments[2]!==void 0&&arguments[2];(function(m,v){const S=qn(m);if(S===void 0)throw new Error("ToolGroup with ToolGroupId ".concat(m," does not exist"));const{viewportsInfo:D}=S;for(const O of D){const{viewportId:N,renderingEngineId:R}=O,L=(0,j.getEnabledElementByIds)(N,R);cW(L.viewport.element,v)}})(E,u),yd(E,u),g&&qn(E).getViewportsInfo().forEach(m=>{let{viewportId:v,renderingEngineId:S}=m;(0,j.getEnabledElementByIds)(v,S).viewport.render()})}};function pW(E){const{type:u}=E;return u===Nt.Labelmap?o_():{}}const u_=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]];function mW(E,u){if(Ke.svgNodeCache[E])return Ke.svgNodeCache[E][u]?Ke.svgNodeCache[E][u].domRef:void 0}function vW(E,u,g,m){if(!Ke.svgNodeCache[u])return null;Ke.svgNodeCache[u][m]={touched:!0,domRef:g},E.appendChild(g)}function yW(E,u){Ke.svgNodeCache[E]&&Ke.svgNodeCache[E][u]&&(Ke.svgNodeCache[E][u].touched=!0)}function wW(E,u){Ke.svgNodeCache[u]&&Object.keys(Ke.svgNodeCache[u]).forEach(g=>{const m=Ke.svgNodeCache[u][g];!m.touched&&m.domRef&&(E.removeChild(m.domRef),delete Ke.svgNodeCache[u][g])})}const f_=function(E,u){const g=function(m){const v=(0,j.getEnabledElement)(m),{viewportId:S,renderingEngineId:D}=v,O="".concat(S,":").concat(D),N=function(R){const L=".".concat("viewport-element");return R.querySelector(L).querySelector(":scope > .svg-layer")}(m);return Object.keys(Ke.svgNodeCache[O]).forEach(R=>{Ke.svgNodeCache[O][R].touched=!1}),{svgLayerElement:N,svgNodeCacheForCanvas:Ke.svgNodeCache,getSvgNode:mW.bind(this,O),appendNode:vW.bind(this,N,O),setNodeTouched:yW.bind(this,O),clearUntouched:wW.bind(this,N,O)}}(E);u(g),g.clearUntouched()};function d_(E,u){const g=(0,j.getEnabledElement)(E),{renderingEngineId:m,viewportId:v}=g,S=nr(v,m);if(!S)return[];const D=[],O=Object.keys(S.toolOptions);for(let N=0;N<O.length;N++){const R=O[N],L=S.toolOptions[R];if(L&&u.includes(L.mode)){const P=S.getToolInstance(R);D.push(P)}}return D}const{Active:CW,Passive:xW,Enabled:SW}=ke,C5=new class{constructor(){$(this,"hasBeenDestroyed",void 0),$(this,"_needsRender",new Set),$(this,"_animationFrameSet",!1),$(this,"_animationFrameHandle",null),$(this,"_viewportElements",void 0),$(this,"_renderFlaggedViewports",()=>{this._throwIfDestroyed();const E=Array.from(this._viewportElements.values());for(let u=0;u<E.length;u++){const g=E[u];if(this._needsRender.has(g)&&(this._triggerRender(g),this._needsRender.delete(g),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()}),this._viewportElements=new Map}addViewportElement(E,u){this._viewportElements.set(E,u)}removeViewportElement(E,u){this._viewportElements.delete(E),this._needsRender.delete(u),this._reset()}renderViewport(E){this._setViewportsToBeRenderedNextFrame([E])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(E=>{this._needsRender.add(E)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(E){const u=[...this._viewportElements.values()];E.forEach(g=>{u.indexOf(g)!==-1&&this._needsRender.add(g)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(E){const u=(0,j.getEnabledElement)(E);if(!u)return;if(!(0,j.getRenderingEngine)(u.renderingEngineId))return void console.warn("rendering Engine has been destroyed");const g=d_(E,[CW,xW,SW]),{renderingEngineId:m,viewportId:v}=u,S={element:E,renderingEngineId:m,viewportId:v};f_(E,D=>{let O=!1;g.forEach(N=>{if(N.renderAnnotation){const R=N.renderAnnotation(u,D);O=O||R}}),O&&(0,j.triggerEvent)(E,Q.ANNOTATION_RENDERED,{...S})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}},c0=function(E){C5.renderViewport(E)};function h_(E,u){u.length&&E&&u.forEach(g=>{const m=E.getViewport(g);if(!m)return void console.warn("Viewport not available for ".concat(g));const{element:v}=m;c0(v)})}const We=h_,Bp=async function(E,u,g){if(!qn(E))throw new Error("No tool group found for toolGroupId: ".concat(E));const m=u.map(v=>async function(S,D,O){var N;const{segmentationId:R,options:L={}}=D,P=((N=D.options)===null||N===void 0?void 0:N.segmentationRepresentationUID)||j.utilities.uuidv4(),F=new Set,V=function(){const W=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).colorLUTOrIndex;let q;if(typeof W=="number")q=W;else{const Y=H8();Ky(Array.isArray(W)?W:u_,Y),q=Y}return q}(L),G={segmentationId:R,segmentationRepresentationUID:P,type:D.type,segmentsHidden:F,colorLUTIndex:V,active:!0,segmentationRepresentationSpecificConfig:{},segmentSpecificConfig:{},config:pW(D),polySeg:L.polySeg};if(O){const W=kp(S),q=j.utilities.deepMerge(W,O);U6(S,{renderInactiveSegmentations:q.renderInactiveSegmentations||!0,representations:{...q.representations}})}return z8(S,G),D.type===Nt.Contour&&qn(S).getViewportsInfo().forEach(W=>{let{viewportId:q,renderingEngineId:Y}=W;const Z=(0,j.getRenderingEngine)(Y);We(Z,[q])}),P}(E,v,g));return await Promise.all(m)};async function g_(E){var u;let{imageIdReferenceMap:g,options:m}=E;const v=Array.from(g.values()),S={imageIdReferenceMap:g},D=(u=m==null?void 0:m.volumeId)!==null&&u!==void 0?u:j.utilities.uuidv4();return await j.volumeLoader.createAndCacheVolumeFromImages(D,v,{additionalDetails:S}),{volumeId:D}}async function EW(E){let{segmentationId:u,options:g}=E;const m=dn(u).representationData.LABELMAP,{volumeId:v}=await g_({imageIdReferenceMap:m.imageIdReferenceMap,options:g});await async function(S){let{segmentationId:D,toolGroupId:O,volumeId:N,options:R}=S;const L=dn(D);if(R!=null&&R.removeOriginal){const P=L.representationData.LABELMAP.imageIdReferenceMap;Array.from(P.values()).forEach(F=>{j.cache.removeImageLoadObject(F)}),L.representationData.LABELMAP={volumeId:N}}else L.representationData.LABELMAP={...L.representationData.LABELMAP,volumeId:N};await Bp(O,[{segmentationId:D,type:Nt.Labelmap}]),x1(O),j.eventTarget.addEventListenerOnce(Q.SEGMENTATION_RENDERED,()=>pi(D))}({segmentationId:u,toolGroupId:g.toolGroupId,options:g,volumeId:v})}const TW=(0,j.getWebWorkerManager)(),x5=(E,u)=>{(0,j.triggerEvent)(E,j.Enums.Events.WEB_WORKER_PROGRESS,{progress:u,type:s0.POLYSEG_LABELMAP_TO_SURFACE})};async function S5(E){var u;let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m=dn(E);if(m==null||(u=m.representationData)===null||u===void 0||!u.LABELMAP)return void console.warn("Only support surface update from labelmaps");const v=Zn(m.representationData.LABELMAP),S=m.representationData.LABELMAP,D=g.segmentIndices||Wi(E),O=D.map(L=>async function(F,V){let G;if(arguments.length>2&&arguments[2]!==void 0&&!arguments[2]){const{imageIdReferenceMap:ge}=F;({volumeId:G}=await g_({imageIdReferenceMap:ge}))}else G=F.volumeId;const W=j.cache.getVolume(G),q=W.getScalarData(),{dimensions:Y,spacing:Z,origin:ne,direction:oe}=W;x5(j.eventTarget,0);const ue=await TW.executeTask("polySeg","convertLabelmapToSurface",{scalarData:q,dimensions:Y,spacing:Z,origin:ne,direction:oe,segmentIndex:V},{callbacks:[ge=>{x5(j.eventTarget,ge)}]});return x5(j.eventTarget,1),ue}(S,L,v)),N=await Promise.allSettled(O),R=N.filter(L=>L.status==="rejected");if(R.length>0)throw console.error(R),new Error("Failed to convert labelmap to surface");return N.map((L,P)=>{if(L.status==="fulfilled")return{segmentIndex:D[P],data:L.value}}).filter(Boolean)}function p_(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return g5(E,Nt.Surface,()=>async function(g){var m;let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const S=(m=v.segmentIndices)!==null&&m!==void 0&&m.length?v.segmentIndices:Wi(g);let D;const O=dn(g),N=O.representationData;try{N.CONTOUR?D=await async function(R){let L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const P=dn(R).representationData.CONTOUR,F=(L.segmentIndices||Wi(R)).map(async V=>{const G=await async function(W,q){const{annotationUIDsMap:Y}=W,Z=[],ne=[],oe=Y.get(q);for(const ge of oe){const me=Bn(ge),{polyline:xe}=me.data.contour;ne.push(xe.length),xe.forEach(Ee=>Z.push(...Ee))}p5(j.eventTarget,0);const ue=await nW.executeTask("polySeg","convertContourToSurface",{polylines:Z,numPointsArray:ne},{callbacks:[ge=>{p5(j.eventTarget,ge)}]});return p5(j.eventTarget,1),ue}(P,V);return{segmentIndex:V,data:G}});return await Promise.all(F)}(g,{segmentIndices:S,...v}):N.LABELMAP&&(D=await S5(O.segmentationId,{segmentIndices:S,...v}))}catch(R){throw console.error(R),R}if(!D)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await t_(g,D,v)}(E,u),()=>async function(g){const m=await S5(g);if(!m)return;const v=dn(g),S=Wi(g);if(!S.length)return v.representationData.SURFACE.geometryIds.forEach(O=>{const N=j.cache.getGeometry(O).data;N.setPoints([]),N.setPolys([])}),void Ta(g);const D=m.map(O=>{let{data:N,segmentIndex:R}=O;const L="segmentation_".concat(g,"_surface_").concat(R),P=j.cache.getGeometry(L);if(!P)return bc(g).map(F=>Hi(F).map(V=>{if(V.type===Nt.Surface)return v.representationData.SURFACE.geometryIds.set(R,L),t_(g,[{segmentIndex:R,data:N}],{segmentationRepresentationUID:V.segmentationRepresentationUID})}));if(S.includes(R)){const F=P.data;F.setPoints(N.points),F.setPolys(N.polys)}else{const F=P.data;F.setPoints([]),F.setPolys([])}});await Promise.all(D),Ta(g)}(E))}const _W={render:async function(E,u){const{colorLUTIndex:g,segmentationId:m,segmentationRepresentationUID:v}=u,S=dn(m);if(!S)return;if(!(E instanceof j.VolumeViewport3D))throw new Error("Surface rendering is only supported in 3D viewports, if you need to visualize the surface cuts in 2D viewports, you can use the Contour representation, see polySeg converters");let D=S.representationData[Nt.Surface];if(!D&&Fp(v)&&(D=await p_(m,{segmentationRepresentationUID:v}),!D))throw new Error("No Surface data found for segmentationId ".concat(m,"."));const{geometryIds:O}=D;O!=null&&O.size||console.warn("No Surfaces found for segmentationId ".concat(m,". Skipping render."));const N=wd(g);O.forEach((R,L)=>{const P=j.cache.getGeometry(R);if(P==null||!P.data)return void console.warn("No Surfaces found for geometryId ".concat(R,". Skipping render."));const F=P.data,V=N[L];F.setColor(V.slice(0,3)),function(G,W,q){var Y;const Z=function(_e,Me){return"".concat(_e,"_").concat(Me)}(q,W.id),ne=(0,j.getEnabledElement)(G),{viewport:oe}=ne,ue=(Y=oe.getActor(Z))===null||Y===void 0?void 0:Y.actor;if(ue){const _e=ue.getMapper(),Me=_e.getInputData(),Pe=W.getPoints(),Ze=W.getPolys(),Ye=Me.getPoints().getData(),at=Me.getPolys().getData();if(Pe.length===Ye.length&&Ze.length===at.length)return;const ot=c5().newInstance();ot.getPoints().setData(Pe,3);const st=$6().newInstance({values:Float32Array.from(Ze)});return ot.setPolys(st),_e.setInputData(ot),_e.modified(),void setTimeout(()=>{oe.getRenderer().resetCameraClippingRange()},0)}const ge=W.getPoints(),me=W.getPolys(),xe=W.getColor(),Ee=c5().newInstance();Ee.getPoints().setData(ge,3);const Ie=$6().newInstance({values:Float32Array.from(me)});Ee.setPolys(Ie);const be=j6().newInstance({});be.setInputData(Ee);const Ne=H6().newInstance();Ne.setMapper(be),Ne.getProperty().setColor(xe[0]/255,xe[1]/255,xe[2]/255),Ne.getProperty().setLineWidth(2),oe.addActor({actor:Ne,uid:Z,clippingFilter:void 0}),oe.resetCamera(),oe.render(),setTimeout(()=>{oe.getRenderer().resetCameraClippingRange()},0)}(E.element,F,v)}),E.render()},removeSegmentationRepresentation:function(E,u){let g=arguments.length>2&&arguments[2]!==void 0&&arguments[2];(function(m,v){const S=qn(m);if(S===void 0)throw new Error("ToolGroup with ToolGroupId ".concat(m," does not exist"));const{viewportsInfo:D}=S;for(const O of D){const{viewportId:N,renderingEngineId:R}=O,L=(0,j.getEnabledElementByIds)(N,R);qz(L.viewport.element,v)}})(E,u),yd(E,u),g&&qn(E).getViewportsInfo().forEach(m=>{let{viewportId:v,renderingEngineId:S}=m;(0,j.getEnabledElementByIds)(v,S).viewport.render()})}},DW=function(E,u){const g=hl(u,E),{segmentationId:m}=g,v=dn(m),{annotationUIDsMap:S}=v.representationData.CONTOUR;S.forEach(D=>{D.forEach(O=>{Ht(O)})})},E5=new Map;function m_(E){return E5.get(E)}function T5(E,u){E5.set(E,u)}function v_(E,u){const g=new Map;for(const[m,v]of E){const S=m.split("_")[1];for(const[D,O]of v){if(!O)continue;const N=Number(S)||(u==null?void 0:u.get(S));N&&(g.has(N)||g.set(N,[]),g.get(N).push(O))}}return g}const{CalibrationTypes:Td}=j.Enums,Oc="px",y_=[1],bW=["3,3"],IW=["4,3"],_5={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},_d="",za=(E,u)=>{const{calibration:g,hasPixelSpacing:m}=E;let v=m?"mm":Oc,S=v+_d,D=1,O="";if(!g||!g.type&&!g.sequenceOfUltrasoundRegions)return{units:v,areaUnits:S,scale:D};if(g.type===Td.UNCALIBRATED)return{units:Oc,areaUnits:Oc+_d,scale:D};if(g.sequenceOfUltrasoundRegions){var N;let R,L;if(Array.isArray(u)&&u.length===2)[R,L]=u;else if(typeof u=="function"){const W=u();R=W[0],L=W[1]}let P=g.sequenceOfUltrasoundRegions.filter(W=>R[0]>=W.regionLocationMinX0&&R[0]<=W.regionLocationMaxX1&&R[1]>=W.regionLocationMinY0&&R[1]<=W.regionLocationMaxY1&&L[0]>=W.regionLocationMinX0&&L[0]<=W.regionLocationMaxX1&&L[1]>=W.regionLocationMinY0&&L[1]<=W.regionLocationMaxY1);if((N=P)===null||N===void 0||!N.length)return{units:v,areaUnits:S,scale:D};if(P=P.filter(W=>y_.includes(W.regionDataType)&&bW.includes("".concat(W.physicalUnitsXDirection,",").concat(W.physicalUnitsYDirection))),!P.length)return{units:Oc,areaUnits:Oc+_d,scale:D};const F=P[0],V=Math.abs(F.physicalDeltaX),G=Math.abs(F.physicalDeltaY);if(!j.utilities.isEqual(V,G,.001))return{units:Oc,areaUnits:Oc+_d,scale:D};D=1/V,O="US Region",v=_5[F.physicalUnitsXDirection]||"unknown",S=v+_d}else g.scale&&(D=g.scale);return[Td.ERMF,Td.USER,Td.ERROR,Td.PROJECTION].includes(g==null?void 0:g.type)&&(O=g.type),{units:v+(O?" ".concat(O):""),areaUnits:S+(O?" ".concat(O):""),scale:D}},Gp=(E,u)=>{const[g]=u,{calibration:m}=E;let v=["raw"],S=[null],D="";if(!m||!m.type&&!m.sequenceOfUltrasoundRegions)return{units:v,values:S};if(m.sequenceOfUltrasoundRegions){const O=m.sequenceOfUltrasoundRegions.filter(G=>y_.includes(G.regionDataType)&&IW.includes("".concat(G.physicalUnitsXDirection,",").concat(G.physicalUnitsYDirection)));if(O==null||!O.length)return{units:v,values:S};const N=O.find(G=>g[0]>=G.regionLocationMinX0&&g[0]<=G.regionLocationMaxX1&&g[1]>=G.regionLocationMinY0&&g[1]<=G.regionLocationMaxY1);if(!N)return{units:v,values:S};const{referencePixelX0:R=0,referencePixelY0:L=0}=N,{physicalDeltaX:P,physicalDeltaY:F}=N,V=(g[1]-N.regionLocationMinY0-L)*F;D="US Region",S=[(g[0]-N.regionLocationMinX0-R)*P,V],v=[_5[N.physicalUnitsXDirection],_5[N.physicalUnitsYDirection]]}return{units:v,values:S,calibrationType:D}},D5=E=>{var u;return((u=E.calibration)===null||u===void 0?void 0:u.aspect)||1};function Dd(E,u){let g=E;const m=(u==null?void 0:u.numDimensions)||2,v=m===3;if(!Array.isArray(E[0])){const P=E,F=P.length/m;g=new Array(P.length/m);for(let V=0,G=F;V<G;V++)g[V]=[P[V*m],P[V*m+1]],v&&g[V].push(P[V*m+2])}let S=1/0,D=1/0,O=-1/0,N=-1/0,R=1/0,L=-1/0;for(let P=0,F=g.length;P<F;P++){const[V,G,W]=g[P];S=S<V?S:V,D=D<G?D:G,O=O>V?O:V,N=N>G?N:G,v&&(R=R<W?R:W,L=L>W?L:W)}return v?{minX:S,maxX:O,minY:D,maxY:N,minZ:R,maxZ:L}:{minX:S,maxX:O,minY:D,maxY:N}}function OW(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;const m=(0,j.getEnabledElement)(E);if(!m)throw new Error("getAnnotationNearPoint: enabledElement not found");return w_(m,u,g)}function w_(E,u,g){const{renderingEngineId:m,viewportId:v}=E,S=nr(v,m);if(!S)return null;const{_toolInstances:D}=S;for(const O in D){const N=MW(D[O],E,u,g);if(N)return N}return null}function MW(E,u,g,m){var v;const{viewport:S}=u,D=an(E.constructor.toolName,S==null?void 0:S.element),O=S==null||(v=S.getCurrentImageId)===null||v===void 0?void 0:v.call(S);if(D!=null&&D.length){const{element:R}=u.viewport;for(const L of D){var N;const P=(N=L.metadata)===null||N===void 0?void 0:N.referencedImageId;if(!(O&&P&&O!==P||!E.isPointNearTool)&&(E.isPointNearTool(R,L,g,m,"")||E.getHandleNearImagePoint(R,L,g,m)))return L}}return null}const $i=function(E,u,g){let m=!0,v=!0;if(typeof E!="function")throw new TypeError("Expected a function");return h5(g)&&(m="leading"in g?!!g.leading:m,v="trailing"in g?!!g.trailing:v),Vp(E,u,{leading:m,trailing:v,maxWait:u})},zp=function(E,u,g){return Math.min(Math.max(u,E),g)},{calibratedPixelSpacingMetadataProvider:NW}=j.utilities;function RW(E,u,g){typeof g=="number"&&(g={type:j.Enums.CalibrationTypes.USER,scale:g}),NW.add(E,g),u.getStackViewports().forEach(m=>{m.getImageIds().includes(E)&&m.calibrateSpacing(E)})}const C_=function(E){E.forEach(u=>{const g=qn(u);g?g.getViewportsInfo().forEach(m=>{const{renderingEngineId:v,viewportId:S}=m,D=(0,j.getRenderingEngine)(v);if(!D)return void console.warn("RenderingEngine not available for ".concat(v));const O=D.getViewport(S);c0(O.element)}):console.warn("ToolGroup not available for ".concat(u))})};function Mc(E,u){if(!(0,j.getEnabledElement)(E.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(E instanceof j.StackViewport&&E.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:g,delta:m,scrollSlabs:v}=u;E instanceof j.VolumeViewport?function(S,D,O){const N=arguments.length>3&&arguments[3]!==void 0&&arguments[3],{numScrollSteps:R,currentStepIndex:L,sliceRangeInfo:P}=j.utilities.getVolumeViewportScrollInfo(S,D,N);if(!P)return;const{sliceRange:F,spacingInNormalDirection:V,camera:G}=P,{focalPoint:W,viewPlaneNormal:q,position:Y}=G,{newFocalPoint:Z,newPosition:ne}=j.utilities.snapFocalPointToSlice(W,Y,F,q,V,O);S.setCamera({focalPoint:Z,position:ne}),S.render();const oe=L+O,ue={volumeId:D,viewport:S,delta:O,desiredStepIndex:oe,currentStepIndex:L,numScrollSteps:R,currentImageId:S.getCurrentImageId()};(oe>R||oe<0)&&S.getCurrentImageId()?j.utilities.triggerEvent(j.eventTarget,j.EVENTS.VOLUME_SCROLL_OUT_OF_BOUNDS,ue):j.utilities.triggerEvent(j.eventTarget,j.EVENTS.VOLUME_VIEWPORT_SCROLL,ue)}(E,g,m,v):E.scroll(m,u.debounceLoading,u.loop)}const Wp=async function(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{imageIndex:g,debounceLoading:m,volumeId:v}=u,S=(0,j.getEnabledElement)(E);if(!S)throw new Error("Element has been disabled");const{viewport:D}=S,{imageIndex:O,numberOfSlices:N}=function(L,P){return L instanceof j.StackViewport?{numberOfSlices:L.getImageIds().length,imageIndex:P?L.getTargetImageIdIndex():L.getCurrentImageIdIndex()}:{numberOfSlices:L.getNumberOfSlices(),imageIndex:L.getSliceIndex()}}(D,m),R=function(L,P){return zp(P,0,L-1)}(N,g);Mc(D,{delta:R-O,debounceLoading:m,volumeId:v})};function Ii(E,u,g,m){let v,S,D,O,N,R,L;const{numComps:P}=E;if(L=E.getScalarData?E.getScalarData():E.getPointData().getScalars().getData(),!L)return void console.warn("No scalar data found for imageData",E);const F=E.getDimensions();m?[[v,S],[D,O],[N,R]]=m:(v=0,S=F[0],D=0,O=F[1],N=0,R=F[2]);const V=le.vec3.fromValues(v,D,N),G=E.getDirection(),W=G.slice(0,3),q=G.slice(3,6),Y=G.slice(6,9),Z=E.getSpacing(),[ne,oe,ue]=Z,ge=E.indexToWorld(V),me=le.vec3.fromValues(W[0]*ne,W[1]*ne,W[2]*ne),xe=le.vec3.fromValues(q[0]*oe,q[1]*oe,q[2]*oe),Ee=le.vec3.fromValues(Y[0]*ue,Y[1]*ue,Y[2]*ue),Ie=P||L.length/F[2]/F[1]/F[0],be=F[0]*Ie,Ne=F[1]*be,_e=[],Me=le.vec3.clone(ge);for(let Pe=N;Pe<=R;Pe++){const Ze=le.vec3.clone(Me);for(let Ye=D;Ye<=O;Ye++){const at=le.vec3.clone(Me);for(let ot=v;ot<=S;ot++){const st=[ot,Ye,Pe];if(u(Me,st)){const ct=Pe*Ne+Ye*be+ot*Ie;let Tt;Tt=Ie>2?[L[ct],L[ct+1],L[ct+2]]:L[ct],_e.push({value:Tt,index:ct,pointIJK:st,pointLPS:Me.slice()}),g&&g({value:Tt,index:ct,pointIJK:st,pointLPS:Me})}le.vec3.add(Me,Me,me)}le.vec3.copy(Me,at),le.vec3.add(Me,Me,xe)}le.vec3.copy(Me,Ze),le.vec3.add(Me,Me,Ee)}return _e}const{EPSILON:u0}=j.CONSTANTS;function x_(E,u){var g;let m=arguments.length>2&&arguments[2]!==void 0&&arguments[2],v=1/0,S=m?-1/0:0,D=1/0,O=m?-1/0:0,N=1/0,R=m?-1/0:0;const L=((g=E[0])===null||g===void 0?void 0:g.length)===3;for(let V=0;V<E.length;V++){const G=E[V];var P,F;v=Math.min(G[0],v),S=Math.max(G[0],S),D=Math.min(G[1],D),O=Math.max(G[1],O),L&&(N=Math.min((P=G[2])!==null&&P!==void 0?P:N,N),R=Math.max((F=G[2])!==null&&F!==void 0?F:R,R))}return u?(v=Math.max(m?u[0]+u0:0,v),S=Math.min(m?u[0]-u0:u[0]-1,S),D=Math.max(m?u[1]+u0:0,D),O=Math.min(m?u[1]-u0:u[1]-1,O),L&&u.length===3&&(N=Math.max(m?u[2]+u0:0,N),R=Math.min(m?u[2]-u0:u[2]-1,R))):m||(v=Math.max(0,v),S=Math.min(1/0,S),D=Math.max(0,D),O=Math.min(1/0,O),L&&(N=Math.max(0,N),R=Math.min(1/0,R))),L?[[v,S],[D,O],[N,R]]:[[v,S],[D,O],null]}function ml(E,u){return x_(E,u,!1)}function S_(E,u){return x_(E,u,!0)}const{transformWorldToIndex:b5}=j.utilities;function E_(E,u,g){const[m,v]=E,S=le.vec3.fromValues((m[0]+v[0])/2,(m[1]+v[1])/2,(m[2]+v[2])/2),D=le.vec3.distance(m,v)/2;if(!g)throw new Error("viewport is required in order to calculate the sphere bounds");const{boundsIJK:O,topLeftWorld:N,bottomRightWorld:R}=function(L,P,F,V,G){const[W,q]=F,Y=L.getDimensions(),Z=P.getCamera(),ne=le.vec3.fromValues(Z.viewUp[0],Z.viewUp[1],Z.viewUp[2]),oe=le.vec3.fromValues(Z.viewPlaneNormal[0],Z.viewPlaneNormal[1],Z.viewPlaneNormal[2]),ue=le.vec3.create();le.vec3.cross(ue,ne,oe);const ge=le.vec3.create(),me=le.vec3.create();return le.vec3.scaleAndAdd(ge,q,oe,G),le.vec3.scaleAndAdd(me,W,oe,-G),le.vec3.scaleAndAdd(ge,ge,ue,-G),le.vec3.scaleAndAdd(me,me,ue,G),{boundsIJK:ml([b5(L,ge),b5(L,me),...F.map(xe=>b5(L,xe))],Y),topLeftWorld:ge,bottomRightWorld:me}}(u,g,E,0,D);return{boundsIJK:O,centerWorld:S,radiusWorld:D,topLeftWorld:N,bottomRightWorld:R}}class T_{static imageIdToFrames(u){const g=u.match(this.frameRangeExtractor);if(!g||!g[2])return null;const m=g[2].split("-").map(v=>Number(v));return m.length===1?m[0]:m}static framesToString(u){return Array.isArray(u)?"".concat(u[0],"-").concat(u[1]):String(u)}static framesToImageId(u,g){const m=u.match(this.frameRangeExtractor);if(!m||!m[2])return null;const v=this.framesToString(g);return u.replace(this.frameRangeExtractor,"".concat(m[1]).concat(v))}static setFrameRange(u,g,m){const{referencedImageId:v}=u.metadata;u.metadata.referencedImageId=this.framesToImageId(v,g);const S={...m,annotation:u};(0,j.triggerEvent)(j.eventTarget,Q.ANNOTATION_MODIFIED,S)}static getFrameRange(u){return this.imageIdToFrames(u.metadata.referencedImageId)}}function __(E,u){const{center:g,radius:m}=E,v=E.radius2||m*m;return(u[0]-g[0])*(u[0]-g[0])+(u[1]-g[1])*(u[1]-g[1])+(u[2]-g[2])*(u[2]-g[2])<=v}$(T_,"frameRangeExtractor",/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i);const{transformWorldToIndex:I5}=j.utilities;function AW(E,u,g,m){const{boundsIJK:v,centerWorld:S,radiusWorld:D}=function(N,R,L){const[P,F]=N,V=le.vec3.fromValues((P[0]+F[0])/2,(P[1]+F[1])/2,(P[2]+F[2])/2),G=le.vec3.distance(P,F)/2;let W;if(!L){const q=I5(R,V),Y=R.getSpacing(),Z=Math.min(...Y),ne=Math.ceil(G/Z);return W=[[q[0]-ne,q[0]+ne],[q[1]-ne,q[1]+ne],[q[2]-ne,q[2]+ne]],{boundsIJK:W,centerWorld:V,radiusWorld:G}}return W=function(q,Y,Z,ne,oe){const[ue,ge]=Z,me=q.getDimensions(),xe=Y.getCamera(),Ee=le.vec3.fromValues(xe.viewUp[0],xe.viewUp[1],xe.viewUp[2]),Ie=le.vec3.fromValues(xe.viewPlaneNormal[0],xe.viewPlaneNormal[1],xe.viewPlaneNormal[2]),be=le.vec3.create();le.vec3.cross(be,Ee,Ie);const Ne=le.vec3.create(),_e=le.vec3.create();return le.vec3.scaleAndAdd(Ne,ge,Ie,oe),le.vec3.scaleAndAdd(_e,ue,Ie,-oe),le.vec3.scaleAndAdd(Ne,Ne,be,-oe),le.vec3.scaleAndAdd(_e,_e,be,oe),ml([I5(q,Ne),I5(q,_e)],me)}(R,L,N,0,G),{boundsIJK:W,centerWorld:V,radiusWorld:G}}(u,E,m),O={center:S,radius:D};Ii(E,N=>__(O,N),g,v)}const{isEqual:D_}=j.utilities;function b_(E){const{metadata:u}=E;return(0,j.getEnabledElements)().filter(g=>{if(g.FrameOfReferenceUID===u.FrameOfReferenceUID){const m=g.viewport,{viewPlaneNormal:v,viewUp:S}=m.getCamera();return D_(v,u.viewPlaneNormal)&&(!u.viewUp||D_(S,u.viewUp))}}).map(g=>g.viewport)}function jp(E){const u=b_(E);return u.length?u[0]:void 0}function LW(E,u,g,m){const v=E.getViewReference(),{viewPlaneNormal:S,FrameOfReferenceUID:D}=v,O={annotationUID:(m==null?void 0:m.annotationUID)||j.utilities.uuidv4(),data:{handles:{points:g}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:u,viewPlaneNormal:S,FrameOfReferenceUID:D,referencedImageId:kW(E,g[0],S),...m}};return fn(O,E.element),O}function kW(E,u,g){let m;if(E instanceof j.StackViewport)m=O5(E,u,g);else{if(!(E instanceof j.BaseVolumeViewport))throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");{const v=function(O){var N;const R=(N=O.getReferenceId)===null||N===void 0?void 0:N.call(O);if(R)return R;if(O instanceof j.BaseVolumeViewport)return"volumeId:".concat(function(L){var P;const F=L.getActors();if(F)return(P=F.find(V=>V.actor.getClassName()==="vtkVolume"))===null||P===void 0?void 0:P.uid}(O));throw new Error("getTargetId: viewport must have a getTargetId method")}(E),S=j.utilities.getVolumeId(v),D=j.cache.getVolume(S);m=j.utilities.getClosestImageId(D,u,g)}}return m}function O5(E,u,g){const m=E.getImageIds();if(!m||!m.length)return;const v=m.map(S=>{const{imagePositionPatient:D}=j.metaData.get("imagePlaneModule",S),O=function(N,R,L){const P=le.vec3.create();le.vec3.sub(P,N,R);const F=le.vec3.dot(P,L);return Math.abs(F)}(u,D,g);return{imageId:S,distance:O}});return v.sort((S,D)=>S.distance-D.distance),v[0].imageId}function PW(E,u){const{viewPlaneNormal:g}=E.metadata,{viewPlaneNormal:m}=u.metadata,v=le.vec3.dot(g,m);if(!le.glMatrix.equals(1,Math.abs(v)))return!1;const{polyline:S}=E.data.contour,{polyline:D}=u.data.contour,O=le.vec3.dot(g,S[0]),N=le.vec3.dot(g,D[0]);return le.glMatrix.equals(O,N)}function I_(E,u,g){let m=-1;if(u.forEach((v,S)=>{m>=0||v.a==E.b&&(m=S)}),m>=0){const v=u[m];return u.splice(m,1),g.push(v.b),g[0]==v.b?{remainingLines:u,contourPoints:g,type:"CLOSED_PLANAR"}:I_(v,u,g)}return{remainingLines:u,contourPoints:g,type:"OPEN_PLANAR"}}function M5(E){if(E.length==0)return[];const u=[],g=E.shift();u.push(g.a),u.push(g.b);const m=I_(g,E,u);if(m.remainingLines.length==0)return[{type:m.type,contourPoints:m.contourPoints}];{const v=M5(m.remainingLines);return v.push({type:m.type,contourPoints:m.contourPoints}),v}}function O_(E){return M5(E)}const FW={findContours:M5,findContoursFromReducedSet:O_};function M_(E){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const g=E.getPoints(),m=E.getLines(),v=new Array(g.getNumberOfPoints()).fill(0).map((O,N)=>g.getPoint(N).slice()),S=new Array(m.getNumberOfCells()).fill(0).map((O,N)=>{const R=m.getCell(3*N).slice();return{a:R[0],b:R[1]}});if(u)return{points:v,lines:S};const D=[];for(const[O,N]of v.entries()){const R=D.findIndex(L=>L[0]===N[0]&&L[1]===N[1]&&L[2]===N[2]);if(R>=0)S.map(L=>(L.a===O&&(L.a=R),L.b===O&&(L.b=R),L));else{const L=D.length;D.push(N),S.map(P=>(P.a===O&&(P.a=L),P.b===O&&(P.b=L),P))}}return{points:D,lines:S.filter(O=>O.a!==O.b)}}const VW={processContourHoles:function(E,u){let g=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const m=E.filter(O=>O.type!=="CLOSED_PLANAR"),v=E.filter(O=>O.type==="CLOSED_PLANAR"),S=[];let D=[];return v.forEach((O,N)=>{const R=[];v.forEach((L,P)=>{N!=P&&function(F,V,G){const W=[];F.contourPoints.forEach(Y=>{W.push([G[Y][0],G[Y][1]])});let q=0;return V.contourPoints.forEach(Y=>{((Z,ne)=>{const oe=Z[0],ue=Z[1];let ge=!1;for(let me=0,xe=ne.length-1;me<ne.length;xe=me++){const Ee=ne[me][0],Ie=ne[me][1],be=ne[xe][0],Ne=ne[xe][1];Ie>ue!=Ne>ue&&oe<(be-Ee)*(ue-Ie)/(Ne-Ie)+Ee&&(ge=!ge)}return ge})([G[Y][0],G[Y][1]],W)||q++}),q===0}(O,L,u)&&R.push(P)}),R.length>0?S.push({contour:O,holes:R}):D.push(N)}),g&&(S.forEach(O=>{O.contour.type="CLOSEDPLANAR_XOR",m.push(O.contour),O.holes.forEach(N=>{v[N].type="CLOSEDPLANAR_XOR",m.push(v[N]),D=D.filter(R=>R!==N)})}),D.forEach(O=>{m.push(v[O])})),m}};var UW=I(543),BW=I.n(UW);const{Labelmap:GW}=Nt;function N_(E){let{segmentations:u}=E;const{representationData:g,segments:m=[0,1]}=u,{volumeId:v}=g[GW],S=j.cache.getVolume(v);if(!S)return void console.warn("No volume found for ".concat(v));const D=S.dimensions[2],O=S.imageData.getPointData().getScalars().getData(),N=S.dimensions[0]*S.dimensions[1];for(let V=0;V<D;V++)for(let G=0;G<S.dimensions[1];G++){const W=G*S.dimensions[0]+V*N;O[W]=0,O[W+S.dimensions[0]-1]=0}const R=[],{FrameOfReferenceUID:L}=S.metadata,P=m.length;for(let V=0;V<P;V++){const G=m[V];if(!G)continue;const W=[],q=a5().newInstance({name:"Scalars",numberOfComponents:1,size:N*D,dataType:"Uint8Array"}),{containedSegmentIndices:Y}=G;for(let oe=0;oe<D;oe++){if(zW(oe,O,N,V))continue;const ue=oe*N;try{var F;for(let Ie=0;Ie<N;Ie++){const be=O[Ie+ue];be===V||Y!=null&&Y.has(be)?q.setValue(Ie+ue,1):q.setValue(Ie,0)}const ge=BW().newInstance({slice:oe}),me=o5().newInstance();me.shallowCopy(S.imageData),me.getPointData().setScalars(q),ge.setInputData(me);const xe=[1];ge.setContourValues(xe),ge.setMergePoints(!1);const Ee=M_(ge.getOutputData());if((F=Ee.points)!==null&&F!==void 0&&F.length){const Ie=O_(Ee.lines);W.push({contours:Ie,polyData:Ee,FrameNumber:oe+1,sliceIndex:oe,FrameOfReferenceUID:L})}}catch(ge){console.warn(oe),console.warn(ge)}}const Z={FrameOfReferenceUID:L},ne={label:G.label,color:G.color,metadata:Z,sliceContours:W};R.push(ne)}return R}function zW(E,u,g,m){const v=E*g,S=v+g;for(let D=v;D<S;D++)if(u[D]===m)return!1;return!0}class N5{constructor(){}static getContourSequence(u,g){const{data:m}=u,{projectionPoints:v,projectionPointsImageIds:S}=m.cachedStats;return v.map((D,O)=>{const N=function(L){return[...L[0],...L[1],...L[3],...L[2]].flat().map(F=>F.toFixed(2))}(D),R=function(L,P){const F=P.get("sopCommonModule",L);return{ReferencedSOPClassUID:F.sopClassUID,ReferencedSOPInstanceUID:F.sopInstanceUID}}(S[O],g);return{NumberOfContourPoints:N.length/3,ContourImageSequence:R,ContourGeometricType:"CLOSED_PLANAR",ContourData:N}})}}$(N5,"toolName",void 0),N5.toolName="RectangleROIStartEndThreshold";const WW=N5;class f0{constructor(){}static convert(u,g,m){(function(O){if(O==null||!O.data)throw new Error("Tool data is empty");if(!O.metadata||O.metadata.referenceImageId)throw new Error("Tool data is not associated with any imageId")})(u);const{toolName:v}=u.metadata,S=f0.TOOL_NAMES[v];if(!S)throw new Error("Unknown tool type: ".concat(v,", cannot convert to RTSSReport"));const D=S.getContourSequence(u,m);return{ReferencedROINumber:g+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:D}}static register(u){f0.TOOL_NAMES[u.toolName]=u}}$(f0,"TOOL_NAMES",{}),f0.register(WW);const jW=f0;function R_(E){var u;return((u=E.childAnnotationUIDs)!==null&&u!==void 0?u:[]).map(g=>Bn(g).data.contour.polyline)}function bd(E,u){const g=R_(E),m=[];return g.forEach(v=>{const S=v.length,D=new Array(S);for(let O=0;O<S;O++)D[O]=u.worldToCanvas(v[O]);m.push(D)}),m}function Ts(E,u){if(E.length!==u.length)throw Error("Both points should have the same dimensionality");const[g,m,v=0]=E,[S,D,O=0]=u,N=S-g,R=D-m,L=O-v;return N*N+R*R+L*L}function Hp(E,u,g){let m;const v=Ts(E,u);if(E[0]===u[0]&&E[1]===u[1]&&(m=E),!m){const S=((g[0]-E[0])*(u[0]-E[0])+(g[1]-E[1])*(u[1]-E[1]))/v;m=S<0?E:S>1?u:[E[0]+S*(u[0]-E[0]),E[1]+S*(u[1]-E[1])]}return{point:[...m],distanceSquared:Ts(g,m)}}function Id(E,u,g){return Hp(E,u,g).distanceSquared}const HW=.1;function A_(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HW;const g=E.length;if(g<3)return E;const m=u*u,v=[[0,g-1]],S=new Array(g).fill(!1);let D=2;for(S[0]=!0,S[g-1]=!0;v.length;){const[N,R]=v.pop();if(R-N==1)continue;const L=E[N],P=E[R];let F=-1/0,V=-1;for(let G=N+1;G<R;G++){const W=Id(L,P,E[G]);W>F&&(F=W,V=G)}F<m||(S[V]=!0,D++,v.push([V,R]),v.push([N,V]))}const O=new Array(D);for(let N=0,R=0;N<g;N++)S[N]&&(O[R++]=E[N]);return O}function R5(E){if(E.length<3)return 0;const u=E[0];let g=0;for(let m=0,v=E.length;m<v;m++){const S=E[m],D=E[m===v-1?0:m+1],O=S[0]-u[0],N=S[1]-u[1],R=D[0]-u[0];g+=O*(D[1]-u[1])-N*R}return g*=.5,g}function A5(E){return R5(E)>=0?1:-1}function _s(E,u,g,m){var v;const{canvasToWorld:S,worldToCanvas:D}=g,{data:O}=E,{targetWindingDirection:N}=u;let{points:R}=u;var L;m!=null&&(v=m.decimate)!==null&&v!==void 0&&v.enabled&&(R=A_(u.points,m==null||(L=m.decimate)===null||L===void 0?void 0:L.epsilon));let{closed:P}=u;const F=R.length,V=new Array(F),G=A5(R),W=Ar(E);if(P===void 0){let Z=!1;if(R.length>3){const ne=Ts(R[0],R[F-1]);Z=j.utilities.isEqual(0,ne)}P=Z}let q=W?-1*W.data.contour.windingDirection:N;q===void 0&&(q=G),q!==G&&R.reverse();const Y=O.handles.points.map(Z=>D(Z));Y.length>2&&A5(Y)!==q&&O.handles.points.reverse();for(let Z=0;Z<F;Z++)V[Z]=S(R[Z]);O.contour.polyline=V,O.contour.closed=P,O.contour.windingDirection=q,pd(E)}const L_="PlanarFreehandContourSegmentationTool";function L5(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const{viewport:g,sliceData:m,annotation:v}=E,S=new Map,{toolName:D,originalToolName:O}=v.metadata,N=O||D,R=(an(N,g.element)||[]).filter(L=>!L.metadata.originalToolName||L.metadata.originalToolName===N);if(N!==L_){const L=an(L_,g.element);L!=null&&L.length&&L.forEach(P=>{const{metadata:F}=P;F.originalToolName===N&&F.originalToolName!==F.toolName&&R.push(P)})}if(R==null||!R.length)return S;for(let L=0;L<m.numberOfSlices;L++){const P=R.filter(V=>V.metadata.sliceIndex===L);if(P==null||!P.length)continue;const F=P.filter(V=>u.every(G=>{const W=G.parentKey?G.parentKey(V):V,q=W==null?void 0:W[G.key];return Array.isArray(q)?q.every((Y,Z)=>Y===G.value[Z]):q===G.value}));F.length&&S.set(L,F)}return S}function k_(E,u,g){const m=j.utilities.deepMerge({data:{},metadata:{}},g);return Object.assign(m,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(m.data,{handles:{points:u.points||u||[],interpolationSources:u.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...g.data.contour,polyline:E}}),m}function $W(E,u){const g=E.get(u);return!(g!=null&&g.length)||g.length===1&&g[0].autoGenerated}function KW(E,u,g){const[m]=E;u[m]||(u[m]={pair:E,list:[]}),u[m].list.push(g)}function qW(E,u,g){const m=[];let v=!0;for(let S=E-1;S>=u[0];S--){const D=g.get(S);if(D!=null&&D.length){if(D[0].autoGenerated)continue;D.length>1&&(v=!1),m.push(S);break}}if(v&&m.length){for(let S=E+1;S<=u[1];S++){const D=g.get(S);if(D!=null&&D.length){if(D[0].autoGenerated)continue;D.length>1&&(v=!1),m.push(S);break}}if(v&&!(m.length<2))return m}}const{PointsManager:P_}=j.utilities;function d0(E,u,g,m,v){g<u&&(g+=v);const S=g-u,D=Math.ceil(S/m);if(D<=0)return E[E.length-1]!==g&&E.push(k5(g,v)),g;for(let O=1;O<=D;O++){const N=k5(u+O*S/D,v);E.push(N)}return E[E.length-1]}function k5(E,u){return(Math.round(E)+u)%u}function F_(E,u){return E.minX<=u.maxX&&E.maxX>=u.minX&&E.minY<=u.maxY&&E.maxY>=u.minY}function P5(E,u,g,m){let v=!1;const S=E[0]<u[0]?E[0]:u[0],D=E[1]<u[1]?E[1]:u[1],O=E[0]>u[0]?E[0]:u[0],N=E[1]>u[1]?E[1]:u[1],R=g[0]<m[0]?g[0]:m[0],L=g[1]<m[1]?g[1]:m[1],P=g[0]>m[0]?g[0]:m[0],F=g[1]>m[1]?g[1]:m[1];if(S>P||O<R||D>F||N<L)return!1;const V=[$p(E,u,g),$p(E,u,m),$p(g,m,E),$p(g,m,u)];return V[0]!==V[1]&&V[2]!==V[3]||((V[0]===0&&Kp(E,g,u)||V[1]===0&&Kp(E,m,u)||V[2]===0&&Kp(g,E,m)||V[3]===0&&Kp(g,u,m))&&(v=!0),v)}function $p(E,u,g){const m=(u[1]-E[1])*(g[0]-u[0])-(u[0]-E[0])*(g[1]-u[1]);return m===0?0:m>0?1:2}function Kp(E,u,g){return u[0]<=Math.max(E[0],g[0])&&u[0]>=Math.min(E[0],g[0])&&u[1]<=Math.max(E[1],g[1])&&u[1]>=Math.min(E[1],g[1])}function V_(E,u,g){let m,v;arguments.length>3&&arguments[3]!==void 0&&!arguments[3]?(v=0,m=1):(v=E.length-1,m=0);for(let S=m;S<E.length;S++){if(P5(u,g,E[v],E[S]))return[v,S];v=S}}function U_(E,u){for(let g=0,m=E.length;g<m;g++){const v=V_(u,E[g],E[g===m-1?0:g+1]);if((v==null?void 0:v.length)===2)return!0}return!1}function B_(E){if(E.length<3)return!1;const u=E.length,g=Ts(E[0],E[u-1]);return le.glMatrix.equals(0,g)}function Nc(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{closed:void 0};if(E.length<3)return!1;const m=E.length;let v=0;const{closed:S,holes:D}=g;if(D!=null&&D.length){for(const R of D)if(Nc(R,u))return!1}const O=!(S===void 0?B_(E):S),N=E.length-(O?1:2);for(let R=0;R<=N;R++){const L=E[R],P=E[R===m-1?0:R+1],F=L[0]>=P[0]?L[0]:P[0],V=L[1]>=P[1]?L[1]:P[1],G=L[1]<=P[1]?L[1]:P[1];if(u[0]<=F&&u[1]>=G&&u[1]<V){let W=L[0]===P[0];if(!W){const q=(u[1]-L[1])*(P[0]-L[0])/(P[1]-L[1])+L[0];W=u[0]<=q}v+=W?1:0}}return!!(v%2)}function F5(E,u){for(let g=0,m=u.length;g<m;g++)if(!Nc(E,u[g]))return!1;return!0}function V5(E,u,g){let m=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const v=[],S=E.length,D=S-(m?1:2);for(let O=0;O<=D;O++){const N=O===S-1?0:O+1;P5(u,g,E[O],E[N])&&v.push([O,N])}return v}function Od(E){const u=R5(E);return[0,0,u/Math.abs(u)]}const Md=.01;function qp(E,u,g){const m=E[0]<=u[0]?E[0]:u[0],v=E[0]>=u[0]?E[0]:u[0],S=E[1]<=u[1]?E[1]:u[1],D=E[1]>=u[1]?E[1]:u[1];if(!(g[0]>=m-Md&&g[0]<=v+Md&&g[1]>=S-Md&&g[1]<=D+Md))return!1;const O=(u[1]-E[1])*(g[0]-u[0])-(u[0]-E[0])*(g[1]-u[1]);return(O>=0?O:-O)<=Md}const XW=.01;function G_(E,u,g,m){const v=[u[0]-E[0],u[1]-E[1]],S=[m[0]-g[0],m[1]-g[1]],D=S[1]*v[0]-S[0]*v[1];if((D>=0?D:-D)<XW){const L=[E[0]<u[0]?E[0]:u[0],E[0]>u[0]?E[0]:u[0],E[1]<u[1]?E[1]:u[1],E[1]>u[1]?E[1]:u[1]],P=[g[0]<m[0]?g[0]:m[0],g[0]>m[0]?g[0]:m[0],g[1]<m[1]?g[1]:m[1],g[1]>m[1]?g[1]:m[1]];return!(L[0]<=P[1]&&L[1]>=P[0]&&L[2]<=P[3]&&L[3]>=P[2])||!(qp(E,u,g)||qp(E,u,m)||qp(g,m,E))?void 0:[.5*((L[0]>P[0]?L[0]:P[0])+(L[1]<P[1]?L[1]:P[1])),.5*((L[2]>P[2]?L[2]:P[2])+(L[3]<P[3]?L[3]:P[3]))]}let O=E[1]-g[1],N=E[0]-g[0];const R=v[0]*O-v[1]*N;return O=(S[0]*O-S[1]*N)/D,N=R/D,[E[0]+O*v[0],E[1]+O*v[1]]}var h0=function(E){return E[E.Vertex=0]="Vertex",E[E.Intersection=1]="Intersection",E}(h0||{}),Nd=function(E){return E[E.Outside=-1]="Outside",E[E.Edge=0]="Edge",E[E.Inside=1]="Inside",E}(Nd||{}),Rd=function(E){return E[E.Exiting=-1]="Exiting",E[E.Unknown=0]="Unknown",E[E.Entering=1]="Entering",E}(Rd||{});function z_(E){for(let u=0,g=E.length;u<g;u++){const m=E[u];m.next||(m.next=E[u===g-1?0:u+1])}}function W_(E,u){const g=[],m=[],v=new Map;let S=Nc(u,E[0])?Rd.Exiting:Rd.Entering;for(let D=0,O=E.length;D<O;D++){const N=E[D],R=Nc(u,N),L={type:h0.Vertex,coordinates:N,position:R?Nd.Inside:Nd.Outside,visited:!1,next:null};g.push(L);const P=E[D===O-1?0:D+1],F=V5(u,N,P).map(V=>{const G=V[0],W=u[V[0]],q=u[V[1]],Y=G_(N,P,W,q);return{sourceLineSegmentId:G,coordinate:Y,targetStartPointDistSquared:Ts(N,Y)}});F.sort((V,G)=>V.targetStartPointDistSquared-G.targetStartPointDistSquared),F.forEach(V=>{const{sourceLineSegmentId:G,coordinate:W}=V,q={type:h0.Intersection,coordinates:W,position:Nd.Edge,direction:S,visited:!1,next:null},Y={...q,direction:Rd.Unknown,cloned:!0};S===Rd.Entering?q.next=Y:Y.next=q;let Z=v.get(G);Z||(Z=[],v.set(G,Z)),g.push(q),Z.push(Y),S*=-1})}for(let D=0,O=u.length;D<O;D++){const N=D,R=u[D],L={type:h0.Vertex,coordinates:R,visited:!1,next:null};m.push(L);const P=v.get(N);P!=null&&P.length&&P.map(F=>({intersectionPoint:F,lineSegStartDistSquared:Ts(R,F.coordinates)})).sort((F,V)=>F.lineSegStartDistSquared-V.lineSegStartDistSquared).map(F=>{let{intersectionPoint:V}=F;return V}).forEach(F=>m.push(F))}return z_(g),z_(m),{targetPolylinePoints:g,sourcePolylinePoints:m}}function j_(E){for(let u=0,g=E.length;u<g;u++){const m=E[u];if(!m.visited&&m.position===Nd.Outside)return m}}function H_(E,u){const g=Od(E),m=Od(u),v=le.vec3.dot(m,g);le.glMatrix.equals(1,v)||(u=u.slice().reverse());const{targetPolylinePoints:S}=W_(E,u),D=j_(S);if(!D)return E.slice();const O=[D.coordinates];let N=D.next;for(;N!==D;)N.type===h0.Intersection&&N.cloned||O.push(N.coordinates),N=N.next;return O}function $_(E,u){const g=Od(E),m=Od(u),v=le.vec3.dot(m,g);le.glMatrix.equals(-1,v)||(u=u.slice().reverse());const{targetPolylinePoints:S}=W_(E,u);let D=null;const O=[];for(;D=j_(S);){const N=[D.coordinates];let R=D.next;for(D.visited=!0;R!==D;)R.visited=!0,R.type===h0.Intersection&&R.cloned||N.push(R.coordinates),R=R.next;O.push(N)}return O}function K_(E,u){const g=E.length,m=[];for(let v=0;v<g;v++){const S=E[v];S.getFrameOfReferenceUID()===u&&m.push(S)}return m}const{Active:YW,Passive:JW,Enabled:ZW}=ke;function Xp(E,u){const g=E.length,m=[];for(let v=0;v<g;v++){const S=E[v],D=nr(S.id,S.renderingEngineId);D&&QW(D,u)&&m.push(S)}return m}function QW(E,u){const{toolOptions:g}=E,m=g[u];if(!m)return!1;const v=m.mode;return v===YW||v===JW||v===ZW}const q_=function(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.999;return E.filter(m=>{const v=m.getCamera();return Math.abs(le.vec3.dot(v.viewPlaneNormal,u.viewPlaneNormal))>g})};function Mt(E,u){let g=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const m=(0,j.getEnabledElement)(E),{renderingEngine:v,FrameOfReferenceUID:S}=m;let D=v.getViewports();D=K_(D,S),D=Xp(D,u);const O=v.getViewport(m.viewportId);return g&&(D=q_(D,O.getCamera())),D.map(N=>N.id)}function Ad(E){var u;return!((u=E.data)===null||u===void 0||!u.segmentation)}function X_(E,u){const{segmentation:g}=E.data,{segmentation:m}=u.data;return g.segmentationId===m.segmentationId&&g.segmentIndex===m.segmentIndex}function Yp(E){if(!E.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:u,segmentIndex:g}=E.data.segmentation,m=dn(u),{annotationUIDsMap:v}=(m==null?void 0:m.representationData.CONTOUR)||{},S=v==null?void 0:v.get(g);S&&(S.delete(E.annotationUID),S.size||v.delete(g))}function g0(E){if(E.parentAnnotationUID)return;if(!E.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:u,segmentIndex:g}=E.data.segmentation,m=dn(u);m.representationData.CONTOUR||(m.representationData.CONTOUR={annotationUIDsMap:new Map});const{annotationUIDsMap:v}=m.representationData.CONTOUR;let S=v.get(g);S||(S=new Set,v.set(g,S)),v.set(g,S.add(E.annotationUID))}function Y_(E){const u=E.toolName,g=Ke.tools[u]!==void 0;if(!u)throw new Error("No Tool Found for the ToolClass ".concat(E.name));if(g)throw new Error("".concat(u," has already been added globally"));Ke.tools[u]={toolClass:E}}function ej(E){const u=E.toolName;if(!u)throw new Error("No tool found for: ".concat(E.name));if(!Ke.tools[u]===void 0)throw new Error("".concat(u," cannot be removed because it has not been added"));delete Ke.tools[u]}let p0=function(E){return E[E.CounterClockwise=-1]="CounterClockwise",E[E.Unknown=0]="Unknown",E[E.Clockwise=1]="Clockwise",E}({});const U5="PlanarFreehandContourSegmentationTool";function J_(E){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const{toolName:g}=Gc,m=nr(E.id,E.renderingEngineId);let v;return m.hasTool(g)?m.getToolOptions(g)||(v="Tool ".concat(g," must be in active/passive state")):v="Tool ".concat(g," not added to ").concat(m.id," toolGroup"),v&&!u&&console.warn(v),!v}function Jp(E,u){const g=E.length,m=new Array(g);for(let v=0;v<g;v++)m[v]=u.worldToCanvas(E[v]);return m}function Z_(E,u,g){u.data.contour,g.data.contour,ar(u,g),Yp(g);const{contour:m}=g.data;_s(g,{points:Jp(m.polyline,E),closed:m.closed},E);const{element:v}=E,S=(0,j.getEnabledElement)(v),{renderingEngine:D}=S,O=new Set([U5,u.metadata.toolName,g.metadata.toolName]);for(const N of O.values()){const R=Mt(v,N);We(D,R)}}const{PointsManager:Ld}=j.utilities;function tj(E,u,g,m){const v=g.get(u[0])[0],S=g.get(u[1])[0],D=o9(v.data.contour.polyline),O=o9(S.data.contour.polyline),{c1Interp:N,c2Interp:R}=function(L,P){const F=a9(L),V=a9(P),G=Math.max(Math.ceil(F[F.length-1]/.2),Math.ceil(V[V.length-1]/.2)),W=i9(F),q=i9(V),Y=G+P.x.length,Z=G+L.x.length,ne=r9(Y,W),oe=r9(Z,q),ue=n9(Y-2,L.x.length),ge=n9(Z-2,P.x.length),me=t9(ne,ue),xe=t9(oe,ge),Ee=e9(L,me),Ie=e9(P,xe);return function(be,Ne){const _e=be.x.length,Me={startingNode:0,totalSquaredXYLengths:1/0};for(let Ze=0;Ze<_e;Ze++){let Ye=Ze,at=0;for(let ot=0;ot<_e;ot++)at+=(be.x[Ye]-Ne.x[ot])**2+(be.y[Ye]-Ne.y[ot])**2+(be.z[Ye]-Ne.z[ot])**2,Ye++,Ye===_e&&(Ye=0);at<Me.totalSquaredXYLengths&&(Me.totalSquaredXYLengths=at,Me.startingNode=Ze)}const Pe=Me.startingNode;Zp(be.x,Pe),Zp(be.y,Pe),Zp(be.z,Pe),Zp(be.I,Pe)}(Ee,Ie),function(be,Ne){const _e={x:[],y:[],z:[],I:[]},Me={x:[],y:[],z:[],I:[]};for(let Pe=0;Pe<be.x.length;Pe++)(be.I[Pe]||Ne.I[Pe])&&(_e.x.push(be.x[Pe]),_e.y.push(be.y[Pe]),_e.z.push(be.z[Pe]),_e.I.push(be.I[Pe]),Me.x.push(Ne.x[Pe]),Me.y.push(Ne.y[Pe]),Me.z.push(Ne.z[Pe]),Me.I.push(Ne.I[Pe]));return{c1Interp:_e,c2Interp:Me}}(Ee,Ie)}(D,O);N.kIndex=u[0],R.kIndex=u[1],E.forEach(function(L){(function(P,F,V,G,W,q,Y){const[Z,ne]=G,oe=(V-Z)/(ne-Z),ue=W.get(Z)[0],ge=W.get(ne)[0],me=function(Ie,be,Ne,_e){const Me=_e?Ie.I:be.I,Pe=Ld.fromXYZ(Ie),Ze=Ld.fromXYZ(be),{length:Ye}=Pe,at=Ld.create3(Ye),ot=le.vec3.create(),st=le.vec3.create(),ct=Ld.create3(Ye);ct.kIndex=Ie.kIndex;const Tt=Ld.create3(Ye);Tt.kIndex=be.kIndex;for(let pt=0;pt<Ie.x.length;pt++)if(Me[pt]){const Ct=Pe.getPoint(pt),gt=Ze.getPoint(pt);ct.push(Ct),Tt.push(gt),le.vec3.sub(ot,gt,Ct),at.push(le.vec3.scaleAndAdd(st,Ct,ot,Ne))}return at.sources=[ct,Tt],at}(P,F,oe,q),xe=oe>.5?ge:ue,Ee=function(Ie){let be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:12;const Ne=P_.create3(be);Ne.sources=[];const{sources:_e}=Ne,{length:Me,sources:Pe=[]}=Ie;if(Me<15)return Ie.subselect(be);const Ze=Math.floor(Math.max(2*Me/be,10));Pe.forEach(()=>_e.push(P_.create3(be)));const Ye=function(st){let ct=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6;const{length:Tt}=st,pt=le.vec3.create(),Ct=le.vec3.create(),gt=new Float32Array(Tt);for(let Dt=0;Dt<Tt;Dt++){const en=st.getPoint(Dt),$t=st.getPoint(Dt-ct),mn=st.getPoint((Dt+ct)%Tt);le.vec3.sub(pt,en,$t),le.vec3.sub(Ct,mn,en);const Cn=le.vec3.dot(pt,Ct)/(le.vec3.len(pt)*le.vec3.len(Ct));gt[Dt]=Cn}return gt}(Ie,5),at=function(st,ct){const{max:Tt,deviation:pt}=function(mn){const{length:Cn}=mn;let br=0,ci=1/0,qi=-1/0,Da=0;for(let Xi=0;Xi<Cn;Xi++){const ca=mn[Xi];br+=ca,ci=Math.min(ci,ca),qi=Math.max(qi,ca)}const xl=br/Cn;for(let Xi=0;Xi<Cn;Xi++){const ca=mn[Xi]-xl;Da+=ca*ca}return{mean:xl,max:qi,min:ci,sumSq:Da,deviation:Math.sqrt(Da/Cn)}}(st),{length:Ct}=st;if(pt<.01||Ct<3*ct)return[];const gt=[];let Dt,en=null,$t=0;for(let mn=0;mn<Ct;mn++){const Cn=st[mn];Cn<Tt-pt?en?(en[2]=mn,Cn<Dt&&(Dt=Cn,$t=mn),en[1]=$t):(Dt=Cn,$t=mn,en=[mn,mn,mn]):en&&(gt.push(en),en=null)}return en&&(gt[0][0]===0?gt[0][0]=en[0]:(en[1]=$t,en[2]=Ct-1,gt.push(en))),gt}(Ye,be),ot=[];if((at==null?void 0:at.length)>2){let st=-1;const ct=Ze/3;at.forEach(pt=>{const[Ct,,gt]=pt,Dt=Math.ceil((Ct+gt)/2);gt-st<ct||(Dt-Ct>2*ct?(d0(ot,st,Ct,Ze,Me),st=d0(ot,Ct,Dt,Ze,Me)):st=d0(ot,st,Dt,Ze,Me),gt-st>ct&&(st=d0(ot,st,gt,Ze,Me)))});const Tt=ot[0];k5(Tt+Me-st,Me)>2*ct&&d0(ot,st,Tt-ct,Ze,Me)}else{const st=Math.floor(Me/be);d0(ot,-1,Me-st,st,Me)}return ot.forEach(st=>{const ct=Ie.getPointArray(st);Ne.push(ct),Pe.forEach((Tt,pt)=>_e[pt].push(Tt.getPoint(st)))}),Ne}(me);W.has(V)?function(Ie,be,Ne,_e,Me){const Pe=Q_(_e,Ne,Me),Ze=k_(Ie.points,be,Pe);Object.assign(Pe,{metadata:Ze.metadata,data:Ze.data})}(me,Ee,V,xe,Y):function(Ie,be,Ne,_e,Me){var Pe;const Ze=Ie.points,{viewport:Ye}=Me,at=k_(Ze,be,_e),ot=Ye.getViewReference({sliceIndex:Ne});if(!ot)throw new Error("Can't find slice ".concat(Ne));Object.assign(at.metadata,ot),fn(at,Ye.element),(Pe=_e.onInterpolationComplete)===null||Pe===void 0||Pe.call(_e,at,_e);const{parentAnnotationUID:st}=_e;st&&Z_(Ye,Q_(Bn(st),Ne,Me),at)}(me,Ee,V,xe,Y)})(N,R,L,u,g,D.x.length>O.x.length,m)})}function Q_(E,u,g){const{viewport:m}=g,v=an(E.metadata.toolName,m.element);for(let S=0;S<v.length;S++){const D=v[S];if(D.interpolationUID===E.interpolationUID&&D.metadata.sliceIndex===u)return D}}function Zp(E,u){u-=E.length*Math.floor(u/E.length);const g=E.splice(0,u);return E.push(...g),E}function e9(E,u){const g={x:[],y:[],z:[],I:[]};for(let m=0;m<E.x.length-1;m++){g.x.push(E.x[m]),g.y.push(E.y[m]),g.z.push(E.z[m]),g.I.push(!0);const v=(E.x[m+1]-E.x[m])/(u[m]+1),S=(E.y[m+1]-E.y[m])/(u[m]+1),D=(E.z[m+1]-E.z[m])/(u[m]+1);for(let O=0;O<u[m]-1;O++)g.x.push(g.x[g.x.length-1]+v),g.y.push(g.y[g.y.length-1]+S),g.z.push(g.z[g.z.length-1]+D),g.I.push(!1)}return g}function t9(E,u){const g=[];for(let D=0;D<E.length;++D)g[D]=D;g.sort(function(D,O){return E[D]<E[O]?-1:1});const m=[];for(let D=0;D<u.length;D++)m.push(u[g[D]]);const v=m.reduce(function(D,O,N){return O&&D.push(N),D},[]),S=[];for(let D=0;D<v.length-1;D++)S.push(v[D+1]-v[D]);return S}function n9(E,u){const g=new Array(E+u);return g.fill(!1,0,E),g.fill(!0,E,E+u),g}function r9(E,u){const g=1/(E-1),m=[g];for(let v=1;v<E-2;v++)m.push(m[m.length-1]+g);return m.concat(u)}function i9(E){const u=[];for(let g=0;g<E.length;g++)u.push(E[g]/E[E.length-1]);return u}function a9(E){const u=[0];for(let g=1;g<E.x.length;g++){const m=Math.sqrt((E.x[g]-E.x[g-1])**2+(E.y[g]-E.y[g-1])**2+(E.z[g]-E.z[g-1])**2);u.push(u[g-1]+m)}return u}function o9(E){const u={x:[],y:[],z:[]};for(let g=0;g<E.length;g++)u.x[g]=E[g][0],u.y[g]=E[g][1],u.z[g]=E[g][2];return u.x.push(u.x[0]),u.y.push(u.y[0]),u.z.push(u.z[0]),u}const Qp=function(E){if(!E.annotation)return;const{isInterpolationUpdate:u,annotation:g}=E;queueMicrotask(()=>{try{u&&(g.isInterpolationUpdate=!0,g.autoGenerated=!1),function(m){const{annotation:v}=m;(function(F){const{parentAnnotationUID:V,annotationUID:G}=F;if(!V)return F.interpolationUID;const W=Bn(V),{interpolationUID:q}=W,Y=W.childAnnotationUIDs.indexOf(G);F.interpolationUID="".concat(q,"-").concat(Y),F.interpolationUID})(v);const{interpolationData:S,interpolationList:D}=function(F,V){const G=L5(V,[{key:"interpolationUID",value:V.interpolationUID}]),W=function(Z){let ne=1/0,oe=-1/0,ue=!1;for(const[ge,me]of Z.entries())me.length&&(ne=Math.min(ge,ne),oe=Math.max(ge,oe),ue=!0);if(ue)return[ne,oe]}(G);if(!W)return void console.warn("No annotations found to interpolate",G);const q=function(Z,ne){for(const[oe,ue]of Z)for(let ge=0;ge<ue.length;ge++)if(ue[ge].annotationUID===ne)return oe}(G,F.annotationUID),Y=[];for(let Z=W[0]+1;Z<W[1];Z++)if($W(G,Z)){const ne=qW(Z,W,G);(ne==null?void 0:ne[0])!==q&&(ne==null?void 0:ne[1])!==q||KW(ne,Y,Z)}return{interpolationData:G,interpolationList:Y}}(v,m)||{};if(!S||!D)return;const O={toolName:v.metadata.toolName,toolType:v.metadata.toolName,viewport:m.viewport};for(let F=0;F<D.length;F++)D[F]&&tj(D[F].list,D[F].pair,S,O);const{id:N,renderingEngineId:R,element:L}=m.viewport,P={annotation:v,element:L,viewportId:N,renderingEngineId:R};D.length&&(0,j.triggerEvent)(m.viewport.element,Q.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,P)}(E)}finally{u&&(g.autoGenerated=!0)}})};function s9(E){const{annotation:u}=E,g=L5(E,[{key:"interpolationUID",value:E.interpolationUID}]),m=u.metadata.sliceIndex;let v=-1,S=E.sliceData.numberOfSlices;for(const[O,N]of g.entries()){if(O===m)continue;N.find(L=>!L.autoGenerated)&&(O<m?v=Math.max(O,v):S=Math.min(O,S))}const D=[];for(const[O,N]of g.entries())O<=v||O>=S||O===m||N.forEach(R=>{R.autoGenerated&&(Ht(R.annotationUID),D.push(R))});if(D.length){const O={annotations:D,element:E.viewport.element,viewportId:E.viewport.id,renderingEngineId:E.viewport.getRenderingEngine().id};(0,j.triggerEvent)(E.viewport.element,Q.INTERPOLATED_ANNOTATIONS_REMOVED,O)}if(v>=0&&S<E.sliceData.numberOfSlices){const O=g.get(S)[0],N={viewport:E.viewport,sliceData:{numberOfSlices:E.sliceData.numberOfSlices,imageIndex:O.metadata.sliceIndex},annotation:O,interpolationUID:O.interpolationUID};Qp(N)}}var m0;const{uuidv4:nj}=j.utilities,rj=[vr.HandlesUpdated,vr.InterpolationUpdated];class Oi{static addTool(u){this.toolNames.includes(u)||this.toolNames.push(u)}static acceptAutoGenerated(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{toolNames:m,segmentationId:v,segmentIndex:S,sliceIndex:D}=g;for(const O of m||Oi.toolNames){const N=an(O,u);if(N!=null&&N.length)for(const R of N){const{interpolationUID:L,data:P,autoGenerated:F,metadata:V}=R;L&&(R.interpolationCompleted=!0),F&&(S&&S!==P.segmentation.segmentIndex||D!==void 0&&V&&D!==V.sliceIndex||v&&v!==P.segmentation.segmentationId||(g0(R),R.autoGenerated=!1))}}}}function B5(E){return{numberOfSlices:E.getNumberOfSlices(),imageIndex:E.getCurrentImageIdIndex()}}function ij(E,u){Oi.acceptAutoGenerated(E,u)}m0=Oi,$(Oi,"toolNames",[]),$(Oi,"handleAnnotationCompleted",E=>{var u;const g=E.detail.annotation;if(g==null||!g.metadata)return;const{toolName:m,originalToolName:v}=g.metadata;if(!m0.toolNames.includes(m)&&!m0.toolNames.includes(v))return;const S=jp(g);if(!S)return void console.warn("Unable to find viewport for",g);const D={viewport:S,sliceData:B5(S),annotation:g,interpolationUID:g.interpolationUID},O=!!g.interpolationUID;if(g.autoGenerated=!1,O)return s9(D),void Qp(D);const N=[{key:"segmentIndex",value:g.data.segmentation.segmentIndex,parentKey:F=>F.data.segmentation},{key:"viewPlaneNormal",value:g.metadata.viewPlaneNormal,parentKey:F=>F.metadata},{key:"viewUp",value:g.metadata.viewUp,parentKey:F=>F.metadata}];let R=function(F,V){const G=L5(F,V),W=[];if(G==null||!G.size)return W;for(const q of G.values())q.forEach(Y=>{W.push(Y)});return W}(D,N);const{sliceIndex:L}=g.metadata,P=new Set;R.forEach(F=>{if(F.interpolationCompleted||F.metadata.sliceIndex===L){const{interpolationUID:V}=F;P.add(V)}}),R=R.filter(F=>!P.has(F.interpolationUID)),g.interpolationUID=((u=R[0])===null||u===void 0?void 0:u.interpolationUID)||nj(),D.interpolationUID=g.interpolationUID,Qp(D)}),$(Oi,"handleAnnotationUpdate",E=>{const u=E.detail.annotation,{changeType:g=vr.HandlesUpdated}=E.detail;if(u==null||!u.metadata)return;const{toolName:m,originalToolName:v}=u.metadata;if(!m0.toolNames.includes(m)&&!m0.toolNames.includes(v)||!rj.includes(g))return;const S=jp(u);if(!S)return void console.warn("Unable to find matching viewport for annotation interpolation",u);u.autoGenerated&&(g0(u),u.autoGenerated=!1);const D={viewport:S,sliceData:B5(S),annotation:u,interpolationUID:u.interpolationUID,isInterpolationUpdate:g===vr.InterpolationUpdated};Qp(D)}),$(Oi,"handleAnnotationDelete",E=>{const u=E.detail.annotation;if(u==null||!u.metadata)return;const{toolName:g}=u.metadata;if(!m0.toolNames.includes(g)||u.autoGenerated)return;const m=jp(u);if(!m)return void console.warn("No viewport, can't delete interpolated results",u);const v={viewport:m,sliceData:B5(m),annotation:u,interpolationUID:u.interpolationUID};u.autoGenerated=!1,s9(v)});const{isEqual:aj}=j.utilities;function G5(E,u){const{polyline:g}=E.data.contour,{points:m}=E.data.handles,{length:v}=m;if(u===v)return g.length;if(u<0&&(u=(u+v)%v),u===0)return 0;const S=m[u],D=g.findIndex(N=>aj(S,N));if(D!==-1)return D;let O=1/0;return g.reduce((N,R,L)=>{const P=le.vec3.squaredDistance(R,S);return P<O?(O=P,L):N},-1)}const z5=function(E,u){let g=0;for(let m=0;m<E.length-1;m++){const v=E[m],S=E[m+1];g+=Math.sqrt(Math.pow(S[0]-v[0],2)+Math.pow(S[1]-v[1],2))}if(u){const m=E[0],v=E[E.length-1];g+=Math.sqrt(Math.pow(v[0]-m[0],2)+Math.pow(v[1]-m[1],2))}return g};var l9=function(E){return E.OnInteractionStart="onInteractionStart",E.OnInteractionEnd="onInteractionEnd",E.Preview="preview",E.RejectPreview="rejectPreview",E.AcceptPreview="acceptPreview",E.Fill="fill",E.StrategyFunction="strategyFunction",E.CreateIsInThreshold="createIsInThreshold",E.Initialize="initialize",E.INTERNAL_setValue="setValue",E.ComputeInnerCircleRadius="computeInnerCircleRadius",E}(l9||{});const qt=l9,oj={[qt.Initialize]:E=>{const{strategySpecificConfiguration:u}=E;if(!u)return;const{centerSegmentIndex:g}=u;g&&(E.segmentIndex=g.segmentIndex)},[qt.OnInteractionStart]:E=>{const{segmentIndex:u,previewSegmentIndex:g,segmentationVoxelManager:m,centerIJK:v,strategySpecificConfiguration:S,imageVoxelManager:D,segmentationImageData:O,preview:N}=E;if(S==null||!S.useCenterSegmentIndex)return;delete S.centerSegmentIndex;let R=!1,L=!1;if(Ii(O,D.isInObject,F=>{let{value:V}=F;R||(R=V===u),L||(L=V===g)},m.boundsIJK),!R&&!L)return;let P=m.getAtIJKPoint(v);if(P===g){if(!N)return;P=N.segmentIndex}else L&&(P=null);E.segmentIndex=P,S.centerSegmentIndex={segmentIndex:P}}},sj={[qt.Initialize]:E=>{const{operationName:u,centerIJK:g,strategySpecificConfiguration:m,segmentationVoxelManager:v,imageVoxelManager:S,segmentIndex:D}=E,{THRESHOLD:O}=m;if(O==null||!O.isDynamic||!g||!D||u===qt.RejectPreview||u===qt.OnInteractionEnd)return;const{boundsIJK:N}=v,{threshold:R,dynamicRadius:L=0}=O,P=R?0:L,F=N.map((G,W)=>{const[q,Y]=G;return[Math.max(q,g[W]-P),Math.min(Y,g[W]+P)]}),V=R||[1/0,-1/0];S.forEach(G=>{let{value:W}=G;const q=Array.isArray(W)?le.vec3.len(W):W;V[0]=Math.min(q,V[0]),V[1]=Math.max(q,V[1])},{boundsIJK:F}),E.strategySpecificConfiguration.THRESHOLD.threshold=V},[qt.OnInteractionStart]:E=>{var u;const{strategySpecificConfiguration:g,preview:m}=E;(g!=null&&(u=g.THRESHOLD)!==null&&u!==void 0&&u.isDynamic||m)&&(g.THRESHOLD.threshold=null)},[qt.ComputeInnerCircleRadius]:E=>{const{configuration:u,viewport:g}=E,{THRESHOLD:{dynamicRadius:m=0}={}}=u.strategySpecificConfiguration||{};if(m===0)return;const{spacing:v}=g.getImageData(),S=[g.element.clientWidth/2,g.element.clientHeight/2],D=m*v[0],O=g.canvasToWorld(S).map(F=>F+D),N=g.worldToCanvas(O),R=Math.abs(S[0]-N[0]),{strategySpecificConfiguration:L,activeStrategy:P}=u;L[P]||(L[P]={}),L[P].dynamicRadiusInCanvas=R}},lj={[qt.Initialize]:E=>{E.segmentIndex=0}};function cj(E,u,g){return(new Array(g+1).join(u)+E).slice(-g)}const e1=function(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const m=g.onFlood,v=g.onBoundary,S=g.equals,D=g.diagonals||!1,O=G(u),N=function(W){const q=[],Y=function(Z){return Z.split("").map(function(ne){return parseInt(ne,10)-1})};for(let Z=0;Z<Math.pow(3,W);Z+=1){const ne=cj(Z.toString(3),"0",W);q.push(Y(ne))}return q}(u.length).filter(function(W){const q=function(Y){let Z=0;for(let ne=0;ne<Y.length;ne+=1)Y[ne]!==0&&(Z+=1);return Z}(W);return q!==0&&(q===1||D)}),R=[],L=[],P=new Set,F=new Map;for(R.push({currentArgs:u});R.length>0;)V(R.pop());return{flooded:L,boundaries:function(){const W=Array.from(F.values());return W.reverse(),W}()};function V(W){const q=W.currentArgs,Y=W.previousArgs;(function(Z){const[ne,oe,ue=0]=Z,ge=ne+32768+65536*(oe+32768+65536*(ue+32768));return P.has(ge)})(q)||(function(Z){const[ne,oe,ue=0]=Z,ge=ne+32768+65536*(oe+32768+65536*(ue+32768));P.add(ge)}(q),function(Z){const ne=G(Z);return S?S(ne,O):ne===O}(q)?(function(Z){L.push(Z),m&&m(...Z)}(q),function(Z){for(let ne=0;ne<N.length;ne+=1){const oe=N[ne],ue=Z.slice(0);for(let ge=0;ge<Z.length;ge+=1)ue[ge]+=oe[ge];R.push({currentArgs:ue,previousArgs:Z})}}(q)):function(Z){const[ne,oe,ue=0]=Z,ge=ne+32768+65536*(oe+32768+65536*(ue+32768));F.set(ge,Z),v&&v(...Z)}(Y))}function G(W){return E(...W)}},Gr={determineSegmentIndex:oj,dynamicThreshold:sj,erase:lj,islandRemoval:{[qt.OnInteractionEnd]:E=>{const{previewVoxelManager:u,segmentationVoxelManager:g,strategySpecificConfiguration:m,previewSegmentIndex:v,segmentIndex:S}=E;if(!m.THRESHOLD||S===null)return;const D=u.getPoints();if(D==null||!D.length||v===void 0)return;const O=u.getBoundsIJK().map((W,q)=>[Math.min(W[0],...D.map(Y=>Y[q])),Math.max(W[1],...D.map(Y=>Y[q]))]);if(O.find(W=>W[0]<0||W[1]>65535))return;const N=new Set,R=(W,q,Y)=>{if(W<O[0][0]||W>O[0][1]||q<O[1][0]||q>O[1][1]||Y<O[2][0]||Y>O[2][1])return-1;const Z=g.toIndex([W,q,Y]);if(N.has(Z))return-2;const ne=g.getAtIndex(Z),oe=ne===v||ne===S?1:0;return oe||g.addPoint(Z),oe};let L=0;const P=(W,q,Y)=>{const Z=g.toIndex([W,q,Y]);N.has(Z)||(u.setAtIJK(W,q,Y,v),N.add(Z),L++)};D.forEach(W=>{R(...W)===1&&e1(R,W,{onFlood:P,diagonals:!0})});let F=0,V=0;u.forEach(W=>{let{index:q,pointIJK:Y,value:Z}=W;const ne=g.getAtIndex(q);if(N.has(q)){V++;const oe=Z===S?S:v;u.setAtIJKPoint(Y,oe)}else if(ne===v){F++;const oe=Z??0;u.setAtIJKPoint(Y,oe)}},{}),L-V!=0&&console.warn("There were flooded=",L,"cleared=",F,"preview count=",V,"not handled",L-V);const G=new Set(g.points||[]);N.clear();for(const W of G.keys()){if(N.has(W))continue;let q=!0;const Y=new Set,Z=(oe,ue,ge)=>{const me=u.toIndex([oe,ue,ge]);N.add(me),(O[0][0]===O[0][1]||oe!==O[0][0]&&oe!==O[0][1])&&(O[1][0]===O[1][1]||ue!==O[1][0]&&ue!==O[1][1])&&(O[2][0]===O[2][1]||ge!==O[2][0]&&ge!==O[2][1])||(q=!1),q&&Y.add(me)},ne=u.toIJK(W);if(R(...ne)===0&&(e1(R,ne,{onFlood:Z,diagonals:!1}),q))for(const oe of Y)u.setAtIndex(oe,v)}pi(E.segmentationId,u.getArrayOfSlices())}},preview:{[qt.Preview]:function(E){var u;const{previewColors:g,strategySpecificConfiguration:m,enabledElement:v}=E;if(!g||!m)return;E.preview&&delete E.preview,delete m.centerSegmentIndex,(u=this.onInteractionStart)===null||u===void 0||u.call(this,v,E);const S=this.fill(v,E);var D;return S&&(S.isPreviewFromHover=!0,E.preview=S,(D=this.onInteractionEnd)===null||D===void 0||D.call(this,v,E)),S},[qt.Initialize]:E=>{const{toolGroupId:u,segmentIndex:g,segmentationRepresentationUID:m,previewSegmentIndex:v,previewColors:S,preview:D}=E;if(S===void 0||(D&&(D.previewVoxelManager.sourceVoxelManager=E.segmentationVoxelManager,E.previewVoxelManager=D.previewVoxelManager),g===null||!v))return;const O=S==null?void 0:S[g],N=Es(u,m,g);(O||N)&&e_(u,m,v,O||function(R,L,P,F){let V=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.4;return[Math.round(R+(255-R)*V),Math.round(L+(255-L)*V),Math.round(P+(255-P)*V),F]}(...N))},[qt.AcceptPreview]:E=>{var u;const{segmentationVoxelManager:g,previewVoxelManager:m,previewSegmentIndex:v,preview:S}=E||{};if(v===void 0)return;const D=(u=S==null?void 0:S.segmentIndex)!==null&&u!==void 0?u:E.segmentIndex,O=m;O&&O.modifiedSlices.size!==0&&(O.forEach(N=>{let{index:R}=N;g.getAtIndex(R)===v&&g.setAtIndex(R,D)},{}),pi(E.segmentationId,O.getArrayOfSlices()),O.clear())},[qt.RejectPreview]:E=>{const{previewVoxelManager:u,segmentationVoxelManager:g}=E;u.modifiedSlices.size!==0&&(u.forEach(m=>{let{index:v,value:S}=m;g.setAtIndex(v,S)}),pi(E.segmentationId,u.getArrayOfSlices()),u.clear())}},regionFill:{[qt.Fill]:E=>{var u;const{segmentsLocked:g,segmentationImageData:m,segmentationVoxelManager:v,previewVoxelManager:S,imageVoxelManager:D,brushStrategy:O,centerIJK:N}=E,R=(u=O.createIsInThreshold)===null||u===void 0?void 0:u.call(O,E),{setValue:L}=O,P=R?F=>{const{value:V,index:G}=F;!g.includes(V)&&R(G)&&L(E,F)}:F=>L(E,F);Ii(m,(D==null?void 0:D.isInObject)||v.isInObject,P,v.boundsIJK),S.addPoint(N)}},setValue:{[qt.INTERNAL_setValue]:(E,u)=>{let{value:g,index:m}=u;const{segmentsLocked:v,segmentIndex:S,previewVoxelManager:D,previewSegmentIndex:O,segmentationVoxelManager:N}=E,R=N.getAtIndex(m);if(S===null){const P=D.getAtIndex(m);return void(P!==void 0&&D.setAtIndex(m,P))}if(R===S||v.includes(g))return;if(R===O){if(D.getAtIndex(m)!==void 0)return;N.setAtIndex(m,S)}const L=O??S;D.setAtIndex(m,L)}},threshold:{[qt.CreateIsInThreshold]:E=>{const{imageVoxelManager:u,strategySpecificConfiguration:g,segmentIndex:m}=E;if(g&&m)return v=>{const{THRESHOLD:S,THRESHOLD_INSIDE_CIRCLE:D}=g,O=u.getAtIndex(v),N=Array.isArray(O)?le.vec3.length(O):O,{threshold:R}=S||D||{};return R==null||!R.length||R[0]<=N&&N<=R[1]}}}},{VoxelManager:c9}=j.utilities;function u9(E){let u,g,m,v,S,D,O,{operationData:N,viewport:R}=E;if(Zn(N,R)){const{volumeId:P,referencedVolumeId:F}=N,V=j.cache.getVolume(P);if(!V)return;if(O=V.voxelManager,F){const G=j.cache.getVolume(F);m=G.getScalarData(),v=G.dimensions}({imageData:u}=V),g=V.getScalarData(),S=V.dimensions}else{var L;const{imageIdReferenceMap:P,segmentationRepresentationUID:F}=N;if(!P)return;const V=R.getCurrentImageId();if(!V)return;const G=R.getActor(F);if(!G)return;u=G.actor.getMapper().getInputData(),O=u.voxelManager;const W=P.get(V),q=j.cache.getImage(W);if(!q)return;g=(L=q.getPixelData)===null||L===void 0?void 0:L.call(q);const Y=j.cache.getImage(V),Z=Y?null:R.getImageData();m=(Y==null?void 0:Y.getPixelData())||Z.getScalarData(),v=Y?[Y.columns,Y.rows,1]:Z.dimensions,S=[q.columns,q.rows,1],D=Y==null?void 0:Y.voxelManager}return O||(O=c9.createVolumeVoxelManager(S,g)),D||(D=v&&c9.createVolumeVoxelManager(v,m)),{segmentationImageData:u,segmentationScalarData:g,segmentationVoxelManager:O,imageScalarData:m,imageVoxelManager:D}}const{VoxelManager:uj}=j.utilities;class Wa{constructor(u){$(this,"compositions",void 0),$(this,"strategyFunction",void 0),$(this,"configurationName",void 0),$(this,"_initialize",[]),$(this,"_fill",[]),$(this,"_acceptPreview",void 0),$(this,"_onInteractionStart",[]),$(this,"fill",(S,D)=>{const O=this.initialize(S,D,qt.Fill);if(!O)return;const{strategySpecificConfiguration:N={},centerIJK:R}=O;if(j.utilities.isEqual(R,N.centerIJK))return D.preview;N.centerIJK=R,this._fill.forEach(V=>V(O));const{segmentationVoxelManager:L,previewVoxelManager:P,previewSegmentIndex:F}=O;return pi(O.segmentationId,L.getArrayOfSlices()),F&&P.modifiedSlices.size?O.preview||O:null}),$(this,"onInteractionStart",(S,D)=>{const{preview:O}=D;if(O!=null&&O.isPreviewFromHover)return void(O.isPreviewFromHover=!1);const N=this.initialize(S,D);N&&this._onInteractionStart.forEach(R=>R.call(this,N))}),$(this,"onInteractionEnd",void 0),$(this,"rejectPreview",void 0),$(this,"acceptPreview",void 0),$(this,"preview",void 0),$(this,"setValue",void 0),$(this,"createIsInThreshold",void 0),this.configurationName=u;for(var g=arguments.length,m=new Array(g>1?g-1:0),v=1;v<g;v++)m[v-1]=arguments[v];this.compositions=m,m.forEach(S=>{const D=typeof S=="function"?S():S;if(D)for(const O in D){if(!Wa.childFunctions[O])throw new Error("Didn't find ".concat(O," as a brush strategy"));Wa.childFunctions[O](this,D[O])}}),this.strategyFunction=(S,D)=>this.fill(S,D);for(const S of Object.keys(Wa.childFunctions))this.strategyFunction[S]=this[S]}initialize(u,g,m){var v;const{viewport:S}=u,D=u9({operationData:g,viewport:S});if(!D)return console.warn("No data found for BrushStrategy"),g.preview;const{imageVoxelManager:O,segmentationVoxelManager:N,segmentationImageData:R}=D,L=((v=g.preview)===null||v===void 0?void 0:v.previewVoxelManager)||uj.createHistoryVoxelManager(N),P={operationName:m,previewSegmentIndex:g.previewColors?255:void 0,...g,enabledElement:u,imageVoxelManager:O,segmentationVoxelManager:N,segmentationImageData:R,previewVoxelManager:L,viewport:S,centerWorld:null,brushStrategy:this};return this._initialize.forEach(F=>F(P)),P}}function Rc(E,u){const g="_".concat(E);return(m,v)=>{m[g]||(m[g]=[]),m[g].push(v),m[E]||(m[E]=u?(S,D)=>{const O=m[u](S,D,E);m[g].forEach(N=>N.call(m,O))}:S=>{m[g].forEach(D=>D.call(m,S))})}}function W5(E){let u=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return(g,m)=>{if(g[E])throw new Error("The singleton method ".concat(E," already exists"));g[E]=u?m:(v,S)=>(S.enabledElement=v,m.call(g,S))}}function kd(E){const[u,g,m,v]=E;return[[m[0],g[1]],[v[0],u[1]]]}function t1(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return g.precalculated||j5(E,g),g.precalculated(u)}$(Wa,"COMPOSITIONS",Gr),$(Wa,"childFunctions",{[qt.OnInteractionStart]:Rc(qt.OnInteractionStart,qt.Initialize),[qt.OnInteractionEnd]:Rc(qt.OnInteractionEnd,qt.Initialize),[qt.Fill]:Rc(qt.Fill),[qt.Initialize]:Rc(qt.Initialize),[qt.CreateIsInThreshold]:W5(qt.CreateIsInThreshold),[qt.AcceptPreview]:Rc(qt.AcceptPreview,qt.Initialize),[qt.RejectPreview]:Rc(qt.RejectPreview,qt.Initialize),[qt.INTERNAL_setValue]:W5(qt.INTERNAL_setValue),[qt.Preview]:W5(qt.Preview,!1),[qt.ComputeInnerCircleRadius]:Rc(qt.ComputeInnerCircleRadius),compositions:null});const j5=function(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{xRadius:g,yRadius:m,zRadius:v}=E;u.invXRadiusSq!==void 0&&u.invYRadiusSq!==void 0&&u.invZRadiusSq!==void 0||(u.invXRadiusSq=g!==0?1/g**2:0,u.invYRadiusSq=m!==0?1/m**2:0,u.invZRadiusSq=v!==0?1/v**2:0);const{invXRadiusSq:S,invYRadiusSq:D,invZRadiusSq:O}=u,{center:N}=E,[R,L,P]=N;return u.precalculated=F=>{const V=F[0]-R;let G=V*V*S;if(G>1)return!1;const W=F[1]-L;if(G+=W*W*D,G>1)return!1;const q=F[2]-P;return G+=q*q*O,G<=1},u},{transformWorldToIndex:f9,isEqual:H5}=j.utilities,d9={[qt.Initialize]:E=>{const{points:u,imageVoxelManager:g,viewport:m,segmentationImageData:v,segmentationVoxelManager:S}=E;if(!u)return;const D=le.vec3.fromValues(0,0,0);u.forEach(V=>{le.vec3.add(D,D,V)}),le.vec3.scale(D,D,1/u.length),E.centerWorld=D,E.centerIJK=f9(v,D);const O=u.map(V=>m.worldToCanvas(V)),[N,R]=kd(O),L=m.canvasToWorld(N),P=m.canvasToWorld(R),F=ml(u.map(V=>f9(v,V)),v.getDimensions());S.boundsIJK=F,g.isInObject=$5({topLeftWorld:L,bottomRightWorld:P,center:D})}};function $5(E){const{topLeftWorld:u,bottomRightWorld:g,center:m}=E,v=Math.abs(u[0]-g[0])/2,S=Math.abs(u[1]-g[1])/2,D=Math.abs(u[2]-g[2])/2,O=Math.max(v,S,D);if(H5(v,O)&&H5(S,O)&&H5(D,O)){const L={center:m,radius:O,radius2:O*O};return P=>__(L,P)}const N={center:m,xRadius:v,yRadius:S,zRadius:D},{precalculated:R}=j5(N,{});return R}const h9=new Wa("Circle",Gr.regionFill,Gr.setValue,d9,Gr.determineSegmentIndex,Gr.preview),fj=new Wa("CircleThreshold",Gr.regionFill,Gr.setValue,d9,Gr.determineSegmentIndex,Gr.dynamicThreshold,Gr.threshold,Gr.preview,Gr.islandRemoval),g9=h9.strategyFunction,dj=fj.strategyFunction,{transformWorldToIndex:hj}=j.utilities,gj={[qt.Initialize]:E=>{const{points:u,imageVoxelManager:g,viewport:m,segmentationImageData:v,segmentationVoxelManager:S}=E;if(!u)return;const D=le.vec3.fromValues(0,0,0);u.forEach(L=>{le.vec3.add(D,D,L)}),le.vec3.scale(D,D,1/u.length),E.centerWorld=D,E.centerIJK=hj(v,D);const{boundsIJK:O,topLeftWorld:N,bottomRightWorld:R}=E_(u.slice(0,2),v,m);S.boundsIJK=O,g?g.isInObject=$5({topLeftWorld:N,bottomRightWorld:R,center:D}):S.isInObject=$5({topLeftWorld:N,bottomRightWorld:R,center:D})}},K5=new Wa("Sphere",Gr.regionFill,Gr.setValue,gj,Gr.determineSegmentIndex,Gr.preview),p9=K5.strategyFunction,pj=new Wa("SphereThreshold",...K5.compositions,Gr.dynamicThreshold,Gr.threshold,Gr.islandRemoval).strategyFunction,m9=new Wa("EraseSphere",Gr.erase,...K5.compositions).strategyFunction,v9=new Wa("EraseCircle",Gr.erase,...h9.compositions).strategyFunction,Ds=function(E,u,g){return"".concat(E,"::").concat(u,"::").concat(g)},ja=function(E,u){Object.keys(E).forEach(g=>{const m=u.getAttribute(g),v=E[g];v===void 0||v===""?u.removeAttribute(g):m!==v&&u.setAttribute(g,v)})},bs=function(E,u){Object.keys(E).forEach(g=>{const m=E[g];m!==void 0&&m!==""&&u.setAttribute(g,m)})},_a=function(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},D=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"";const{color:O,fill:N,width:R,lineWidth:L,lineDash:P,fillOpacity:F,strokeOpacity:V}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},S),G=L||R,W=Ds(u,"circle",g),q=E.getSvgNode(W),Y={cx:"".concat(m[0]),cy:"".concat(m[1]),r:"".concat(v),stroke:O,fill:N,"stroke-width":G,"stroke-dasharray":P,"fill-opacity":F,"stroke-opacity":V};if(q)ja(Y,q),E.setNodeTouched(W);else{const Z=document.createElementNS("http://www.w3.org/2000/svg","circle");D!==""&&Z.setAttribute("data-id",D),bs(Y,Z),E.appendNode(Z,W)}},y9=Symbol("DefinedCursors"),w9=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class Mi{constructor(u,g){$(this,"name",void 0),$(this,"fallback",void 0),this.name=u+"",this.fallback=g}getName(){return this.name+""}addFallbackStyleProperty(u){const{fallback:g}=this;return g instanceof Mi?"".concat(u,", ").concat(g.getStyleProperty()):u+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(u){const g=C9(Mi,y9);let m=g.get(u);return m instanceof Mi?m:w9.has(u)?(m=new Mi(u),g.set(u,m),m):void 0}static setDefinedCursor(u,g){return g instanceof Mi&&(C9(Mi,y9).set(u,g),!0)}}function C9(E,u){let g=E[u];return g instanceof Map||(g=new Map,Object.defineProperty(E,u,{value:g})),g}const mj=w9.values(),x9=Symbol("ElementCursorsMap");function S9(E,u){Fd(E)[0]=u,Pd(E,u)}function Pd(E,u){const g=Fd(E);g[1]=g[0],g[0]=u,E.style.cursor=(u instanceof Mi?u:Mi.getDefinedCursor("auto")).getStyleProperty()}function rn(E){Pd(E,Fd(E)[1])}function Wt(E){Pd(E,Mi.getDefinedCursor("none"))}function Fd(E){let u=Fd[x9];u instanceof WeakMap||(u=new WeakMap,Object.defineProperty(Fd,x9,{value:u}));let g=u.get(E);return g||(g=[null,null],u.set(E,g)),g}function Ko(E){const u=or().getSegmentationRepresentations(E);if(u)return u.find(g=>g.active)}function vj(E){const u=Ko(E);if(u)return dn(u.segmentationId)}function yj(E,u){or().setActiveSegmentationRepresentation(E,u),ji(E,u)}function wj(E,u){const g=dn(E);if(!g)throw new Error("No segmentation state found for ".concat(E));const{segmentsLocked:m}=g;return m.has(u)}function Cj(E,u){let g=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];const m=dn(E);if(!m)throw new Error("No segmentation state found for ".concat(E));const{segmentsLocked:v}=m;g?v.add(u):v.delete(u),Ta(E)}function Ac(E){const u=dn(E);if(!u)throw new Error("No segmentation state found for ".concat(E));const{segmentsLocked:g}=u;return Array.from(g)}function E9(E){const u=qn(E);if(u===void 0)return;v0(E).forEach(O=>{O.invalidateBrushCursor()});const g=u.getViewportsInfo(),m=Object.keys(g).map(O=>g[O]);if(!m.length)return;const{renderingEngineId:v}=m[0],S=u.getViewportIds(),D=(0,j.getRenderingEngine)(v);We(D,S)}function T9(E,u){const g=dn(E);typeof u=="string"&&(console.warn("segmentIndex is a string, converting to number"),u=Number(u)),(g==null?void 0:g.activeSegmentIndex)!==u&&(g.activeSegmentIndex=u,Ta(E)),bc(E).forEach(m=>{E9(m)})}function vl(E){const u=dn(E);if(u)return u.activeSegmentIndex}class q5 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:g9,ERASE_INSIDE_CIRCLE:v9,FILL_INSIDE_SPHERE:p9,ERASE_INSIDE_SPHERE:m9,THRESHOLD_INSIDE_CIRCLE:dj,THRESHOLD_INSIDE_SPHERE:pj},strategySpecificConfiguration:{THRESHOLD:{threshold:[-150,-70]}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",thresholdVolumeId:null,brushSize:25,preview:{enabled:!1,previewColors:{},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[qt.AcceptPreview]:{method:qt.AcceptPreview,bindings:[{key:"Enter"}]},[qt.RejectPreview]:{method:qt.RejectPreview,bindings:[{key:"Escape"}]}}}}),$(this,"_editData",void 0),$(this,"_hoverData",void 0),$(this,"_previewData",{preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1}),$(this,"onSetToolPassive",u=>{this.disableCursor()}),$(this,"onSetToolEnabled",()=>{this.disableCursor()}),$(this,"onSetToolDisabled",u=>{this.disableCursor()}),$(this,"preMouseDownCallback",u=>{const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),{renderingEngine:S}=v;this._editData=this.createEditData(m),this._activateDraw(m),Wt(m),u.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const D=this._hoverData||this.createHoverData(m);return We(S,D.viewportIdsToRender),this.applyActiveStrategyCallback(v,this.getOperationData(m),qt.OnInteractionStart),!0}),$(this,"mouseMoveCallback",u=>{if(this.mode===ke.Active){if(this.updateCursor(u),!this.configuration.preview.enabled)return;const{previewTimeMs:g,previewMoveDistance:m,dragMoveDistance:v}=this.configuration.preview,{currentPoints:S,element:D}=u.detail,{canvas:O}=S,{preview:N,startPoint:R,timer:L,timerStart:P,isDrag:F}=this._previewData,V=le.vec2.distance(O,R),G=Date.now()-P;if((V>m||G>g&&V>v)&&(L&&(window.clearTimeout(L),this._previewData.timer=null),N&&!F&&this.rejectPreview(D)),!this._previewData.timer){const W=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:W,startPoint:O,element:D})}}}),$(this,"previewCallback",()=>{this._previewData.preview||(this._previewData.timer=null,this._previewData.preview=this.applyActiveStrategyCallback((0,j.getEnabledElement)(this._previewData.element),this.getOperationData(this._previewData.element),qt.Preview))}),$(this,"_dragCallback",u=>{const g=u.detail,{element:m,currentPoints:v}=g,S=(0,j.getEnabledElement)(m),{renderingEngine:D}=S;this.updateCursor(u);const{viewportIdsToRender:O}=this._hoverData;We(D,O);const N=le.vec2.distance(v.canvas,this._previewData.startPoint),{dragTimeMs:R,dragMoveDistance:L}=this.configuration.preview;!this._previewData.isDrag&&this._previewData.preview&&Date.now()-this._previewData.timerStart<R&&N<L||(this._previewData.preview=this.applyActiveStrategy(S,this.getOperationData(m)),this._previewData.element=m,this._previewData.timerStart=Date.now()+R,this._previewData.isDrag=!0,this._previewData.startPoint=v.canvas)}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),S=this.getOperationData(m);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(v,S),this._deactivateDraw(m),rn(m),this.updateCursor(u),this._editData=null,this.applyActiveStrategyCallback(v,S,qt.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(m)}),$(this,"_activateDraw",u=>{u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback)}),$(this,"_deactivateDraw",u=>{u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback)})}disableCursor(){this._hoverData=void 0,this.rejectPreview()}createEditData(u){const g=(0,j.getEnabledElement)(u),{viewport:m}=g,v=Ko(this.toolGroupId);if(!v)throw new Error("No active segmentation detected, create a segmentation representation before using the brush tool");const{segmentationId:S,type:D,segmentationRepresentationUID:O}=v;if(D===Nt.Contour)throw new Error("Not implemented yet");const N=Ac(S),{representationData:R}=dn(S),L=R[Nt.Labelmap];if(Zn(L,m)){var P,F,V;const{volumeId:G}=R[D],W=m.getActors();if(m instanceof j.StackViewport){const ne=new CustomEvent(j.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return j.eventTarget.dispatchEvent(ne),null}const q=W.map(ne=>j.cache.getVolume(ne.referenceId)),Y=j.cache.getVolume(G),Z=((P=q.find(ne=>j.utilities.isEqual(ne.dimensions,Y.dimensions)))===null||P===void 0?void 0:P.volumeId)||((F=q[0])===null||F===void 0?void 0:F.volumeId);return{volumeId:G,referencedVolumeId:(V=this.configuration.thresholdVolumeId)!==null&&V!==void 0?V:Z,segmentsLocked:N,segmentationRepresentationUID:O}}{const{imageIdReferenceMap:G}=L,W=m.getCurrentImageId();if(!G.get(W))return;if(this.configuration.activeStrategy.includes("SPHERE"))throw new Error("Sphere manipulation is not supported for stacks of image segmentations yet");return{imageIdReferenceMap:G,segmentsLocked:N,segmentationRepresentationUID:O}}}createHoverData(u,g){const m=(0,j.getEnabledElement)(u),{viewport:v}=m,S=v.getCamera(),{viewPlaneNormal:D,viewUp:O}=S,N=[v.id],{segmentIndex:R,segmentationId:L,segmentationRepresentationUID:P,segmentColor:F}=this.getActiveSegmentationData()||{};return{brushCursor:{metadata:{viewPlaneNormal:[...D],viewUp:[...O],FrameOfReferenceUID:v.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:F},data:{}},centerCanvas:g,segmentIndex:R,segmentationId:L,segmentationRepresentationUID:P,segmentColor:F,viewportIdsToRender:N}}getActiveSegmentationData(){const u=this.toolGroupId,g=Ko(u);if(!g)return void console.warn("No active segmentation detected, create one before using the brush tool");const{segmentationRepresentationUID:m,segmentationId:v}=g,S=vl(v);return{segmentIndex:S,segmentationId:v,segmentationRepresentationUID:m,segmentColor:Es(u,m,S)}}updateCursor(u){const g=u.detail,{element:m}=g,{currentPoints:v}=g,S=v.canvas;this._hoverData=this.createHoverData(m,S),this._calculateCursor(m,S),this._hoverData&&We((0,j.getEnabledElement)(m).renderingEngine,this._hoverData.viewportIdsToRender)}getOperationData(u){var g,m;const v=this._editData||this.createEditData(u),{segmentIndex:S,segmentationId:D,segmentationRepresentationUID:O,brushCursor:N}=this._hoverData||this.createHoverData(u),{data:R,metadata:L={}}=N||{},{viewPlaneNormal:P,viewUp:F}=L;return{...v,points:R==null||(g=R.handles)===null||g===void 0?void 0:g.points,segmentIndex:S,previewColors:this.configuration.preview.enabled?this.configuration.preview.previewColors:null,viewPlaneNormal:P,toolGroupId:this.toolGroupId,segmentationId:D,segmentationRepresentationUID:O,viewUp:F,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration,preview:(m=this._previewData)===null||m===void 0?void 0:m.preview}}_calculateCursor(u,g){const m=(0,j.getEnabledElement)(u),{viewport:v}=m,{canvasToWorld:S}=v,D=v.getCamera(),{brushSize:O}=this.configuration,N=le.vec3.fromValues(D.viewUp[0],D.viewUp[1],D.viewUp[2]),R=le.vec3.fromValues(D.viewPlaneNormal[0],D.viewPlaneNormal[1],D.viewPlaneNormal[2]),L=le.vec3.create();le.vec3.cross(L,N,R);const P=S([g[0],g[1]]),F=le.vec3.create(),V=le.vec3.create(),G=le.vec3.create(),W=le.vec3.create();for(let oe=0;oe<=2;oe++)F[oe]=P[oe]-N[oe]*O,V[oe]=P[oe]+N[oe]*O,G[oe]=P[oe]-L[oe]*O,W[oe]=P[oe]+L[oe]*O;if(!this._hoverData)return;const{brushCursor:q}=this._hoverData,{data:Y}=q;Y.handles===void 0&&(Y.handles={}),Y.handles.points=[F,V,G,W];const Z=this.configuration.activeStrategy,ne=this.configuration.strategies[Z];typeof ne.computeInnerCircleRadius=="function"&&ne.computeInnerCircleRadius({configuration:this.configuration,viewport:v}),Y.invalidated=!1}rejectPreview(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._previewData.element;if(!u||!this._previewData.preview)return;const g=(0,j.getEnabledElement)(u);this.applyActiveStrategyCallback(g,this.getOperationData(u),qt.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._previewData.element;if(!u)return;const g=(0,j.getEnabledElement)(u);this.applyActiveStrategyCallback(g,this.getOperationData(u),qt.AcceptPreview),this._previewData.isDrag=!1,this._previewData.preview=null}invalidateBrushCursor(){if(this._hoverData===void 0)return;const{data:u}=this._hoverData.brushCursor;u.invalidated=!0;const{segmentColor:g}=this.getActiveSegmentationData()||{};this._hoverData.brushCursor.metadata.segmentColor=g}renderAnnotation(u,g){var m;if(!this._hoverData)return;const{viewport:v}=u;if(!this._hoverData.viewportIdsToRender.includes(v.id))return;const S=this._hoverData.brushCursor;if(S.data.invalidated===!0){const{centerCanvas:Z}=this._hoverData,{element:ne}=v;this._calculateCursor(ne,Z)}const D=S.metadata;if(!D)return;const O=D.brushCursorUID,N=S.data,{points:R}=N.handles,L=R.map(Z=>v.worldToCanvas(Z)),P=L[0],F=L[1],V=[Math.floor((P[0]+F[0])/2),Math.floor((P[1]+F[1])/2)],G=Math.abs(P[1]-Math.floor((P[1]+F[1])/2)),W="rgb(".concat(((m=D.segmentColor)===null||m===void 0?void 0:m.slice(0,3))||[0,0,0],")");if(!v.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");_a(g,O,"0",V,G,{color:W});const q=this.configuration.activeStrategy,{dynamicRadiusInCanvas:Y}=this.configuration.strategySpecificConfiguration[q]||{dynamicRadiusInCanvas:0};Y&&_a(g,O,"1",V,Y,{color:W})}}$(q5,"toolName",void 0),q5.toolName="Brush";const _9=q5;function v0(E,u){const g=qn(E);if(g===void 0)return;const m=g._toolInstances;return Object.keys(m).length?u&&m[u]?[m[u]]:Object.values(m).filter(v=>v instanceof _9):void 0}function X5(E,u,g,m){const v=[];for(let S=0;S<2;S++)for(let D=0;D<2;D++)for(let O=0;O<2;O++){const N=[...m];N[0]=N[0]+(2*S-1)*g[0]/2,N[1]=N[1]+(2*D-1)*g[1]/2,N[2]=N[2]+(2*O-1)*g[2]/2,v.push(N)}return ml(v.map(S=>j.utilities.transformWorldToIndex(E,S)),u)}function D9(E,u){const{spacing:g}=E,m=E.getScalarData(),v=[];let S=0;for(let N=0;N<u.length;N++){const{imageData:R,spacing:L,dimensions:P}=u[N].volume,F=u[N].volume.getScalarData().length;F===m.length&&(D=L,O=g,JSON.stringify(D)===JSON.stringify(O))&&(S=N);const V=R.getPointData().getScalars().getData(),G=u[N].lower,W=u[N].upper;v.push({imageData:R,referenceValues:V,lower:G,upper:W,spacing:L,dimensions:P,volumeSize:F})}var D,O;return{volumeInfoList:v,baseVolumeIdx:S}}const b9=function(E,u,g){const{imageData:m}=E,v=E.getScalarData(),{overwrite:S,boundsIJK:D}=g,O=(g==null?void 0:g.overlapType)||0;if(S)for(let W=0;W<v.length;W++)v[W]=0;const{baseVolumeIdx:N,volumeInfoList:R}=D9(E,u);let L,P,F;const V=(W,q,Y)=>{const{imageData:Z,dimensions:ne,lower:oe,upper:ue}=W,ge=X5(Z,ne,q,Y);P=0,L=0,F={lower:oe,upper:ue};let me=!1;return Ii(Z,()=>!0,xe=>{let{value:Ee}=xe;P+=1,Ee>=F.lower&&Ee<=F.upper&&(L+=1)},ge),O===0?me=L>0:O==1&&(me=L===P),me},G=(W,q)=>{const{imageData:Y,referenceValues:Z,lower:ne,upper:oe}=W,ue=Z[Y.computeOffsetIndex(q)];return!(ue<=ne||ue>=oe)};return Ii(m,()=>!0,W=>{let{index:q,pointIJK:Y,pointLPS:Z}=W,ne=R.length>0;for(let oe=0;oe<R.length&&(ne=R[oe].volumeSize===v.length?G(R[oe],Y):V(R[oe],R[N].spacing,Z),ne);oe++);ne&&(v[q]=g.segmentIndex||1)},D),pi(E.volumeId),E},n1=function(E,u,g,m){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},S=arguments.length>5?arguments[5]:void 0;const{color:D,handleRadius:O,width:N,lineWidth:R,fill:L,type:P,opacity:F}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},v),V=R||N,G=Ds(u,"handle","hg-".concat(g,"-index-").concat(S));let W;if(P==="circle")W={cx:"".concat(m[0]),cy:"".concat(m[1]),r:O,stroke:D,fill:L,"stroke-width":V,opacity:F};else{if(P!=="rect")throw new Error("Unsupported handle type: ".concat(P));{const Y=1.5*parseFloat(O),Z=m[0]-.5*Y,ne=m[1]-.5*Y;W={x:"".concat(Z),y:"".concat(ne),width:"".concat(Y),height:"".concat(Y),stroke:D,fill:L,"stroke-width":V,rx:"".concat(.1*Y),opacity:F}}}const q=E.getSvgNode(G);if(q)ja(W,q),E.setNodeTouched(G);else{const Y=document.createElementNS("http://www.w3.org/2000/svg",P);bs(W,Y),E.appendNode(Y,G)}},Qn=function(E,u,g,m){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};m.forEach((S,D)=>{n1(E,u,g,S,v,D)})};function Y5(E,u,g,m){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"";const{color:D,width:O,lineWidth:N,lineDash:R}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},v),L=N||O,P=Ds(u,"rect",g),F=E.getSvgNode(P),[V,G,W,q]=m,Y=Math.hypot(V[0]-G[0],V[1]-G[1]),Z=Math.hypot(V[0]-W[0],V[1]-W[1]),ne=[(q[0]+V[0])/2,(q[1]+V[1])/2],oe=[(W[0]+V[0])/2,(W[1]+V[1])/2],ue=180*Math.atan2(ne[1]-oe[1],ne[0]-oe[0])/Math.PI,ge={x:"".concat(ne[0]-Y/2),y:"".concat(ne[1]-Z/2),width:"".concat(Y),height:"".concat(Z),stroke:D,fill:"transparent",transform:"rotate(".concat(ue," ").concat(ne[0]," ").concat(ne[1],")"),"stroke-width":L,"stroke-dasharray":R};if(F)ja(ge,F),E.setNodeTouched(P);else{const me=document.createElementNS("http://www.w3.org/2000/svg","rect");S!==""&&me.setAttribute("data-id",S),bs(ge,me),E.appendNode(me,P)}}function Vd(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},D=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"";Y5(E,u,g,[[m[0],m[1]],[v[0],m[1]],[m[0],v[1]],[v[0],v[1]]],S,D)}const{EPSILON:xj}=j.CONSTANTS,Sj=1-xj;function J5(E,u,g){const{viewPlaneNormal:m}=u,v=E.filter(N=>{let R=N.metadata.viewPlaneNormal;if(!R){const{referencedImageId:P}=N.metadata,{imageOrientationPatient:F}=j.metaData.get("imagePlaneModule",P),V=le.vec3.fromValues(F[0],F[1],F[2]),G=le.vec3.fromValues(F[3],F[4],F[5]);R=le.vec3.create(),le.vec3.cross(R,V,G),N.metadata.viewPlaneNormal=R}const L=Math.abs(le.vec3.dot(m,R))>Sj;return R&&L});if(!v.length)return[];const S=g/2,{focalPoint:D}=u,O=[];for(const N of v){const R=N.data.handles.points[0];if(!N.isVisible)continue;const L=le.vec3.create();le.vec3.sub(L,D,R);const P=le.vec3.dot(L,m);Math.abs(P)<S&&O.push(N)}return O}function r1(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(E instanceof j.VolumeViewport){const m=E.getCamera(),{spacingInNormalDirection:v}=j.utilities.getTargetVolumeAndSpacingInNormalDir(E,m);return J5(u,m,v)}if(E instanceof j.StackViewport){const m=E.getCurrentImageId(),v=m.indexOf(":");g.imageURI=m.substring(v+1)}return u.filter(m=>!!m.isVisible&&(!!m.data.isCanvasAnnotation||E.isReferenceViewable(m.metadata,g)))}const Z5=new class{constructor(){$(this,"config",void 0),this._initializeConfig({color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(255, 255, 0)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0})}getAnnotationToolStyles(E){return this.config.annotations&&this.config.annotations[E]}getViewportToolStyles(E){return this.config.viewports&&this.config.viewports[E]}getToolGroupToolStyles(E){return this.config.toolGroups&&this.config.toolGroups[E]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(E,u){let g=this.config.annotations;g||(this.config={...this.config,annotations:{}},g=this.config.annotations),g[E]=u}setViewportToolStyles(E,u){let g=this.config.viewports;g||(this.config={...this.config,viewports:{}},g=this.config.viewports),g[E]=u}setToolGroupToolStyles(E,u){let g=this.config.toolGroups;g||(this.config={...this.config,toolGroups:{}},g=this.config.toolGroups),g[E]=u}setDefaultToolStyles(E){this.config.default=E}getStyleProperty(E,u){const{annotationUID:g,viewportId:m,toolGroupId:v,toolName:S}=u;return this._getToolStyle(E,g,m,v,S)}_getToolStyle(E,u,g,m,v){if(u){const D=this.getAnnotationToolStyles(u);if(D&&D[E]!==void 0)return D[E]}if(g){const D=this.getViewportToolStyles(g);if(D){if(D[v]&&D[v][E]!==void 0)return D[v][E];if(D.global&&D.global[E]!==void 0)return D.global[E]}}if(m){const D=this.getToolGroupToolStyles(m);if(D){if(D[v]&&D[v][E]!==void 0)return D[v][E];if(D.global&&D.global[E]!==void 0)return D.global[E]}}const S=this.getDefaultToolStyles();return S[v]&&S[v][E]!==void 0?S[v][E]:S.global&&S.global[E]!==void 0?S.global[E]:void 0}_initializeConfig(E){const u={};for(const g in E)u[g]=E[g];this.config={default:{global:u}}}};function y0(E,u,g,m){const v=function(S,D,O){const N=["".concat(S)];return D&&N.push("".concat(N[0]).concat(D)),O&&N.push("".concat(N[N.length-1]).concat(O)),N}(E,g,m);for(let S=v.length-1;S>=0;--S){const D=Z5.getStyleProperty(v[S],u);if(D!==void 0)return D}}var I9=function(E){return E.Default="",E.Highlighted="Highlighted",E.Selected="Selected",E.Locked="Locked",E.AutoGenerated="AutoGenerated",E}(I9||{});const Is=I9,O9=function(E){if(E){if(E.data&&E.highlighted)return Is.Highlighted;if(zo(E.annotationUID))return Is.Selected;if(cr(E))return Is.Locked;if(E.data&&E.autoGenerated)return Is.AutoGenerated}return Is.Default};class Q5 extends kr{constructor(){super(...arguments),$(this,"onImageSpacingCalibrated",u=>{const{element:g,imageId:m}=u.detail,v=j.utilities.imageIdToURI(m),S=tr();S.getFramesOfReference().forEach(D=>{const O=S.getAnnotations(D)[this.getToolName()];O&&O.length&&(O.forEach(N=>{var R;(R=N.metadata)!==null&&R!==void 0&&R.referencedImageId&&j.utilities.imageIdToURI(N.metadata.referencedImageId)===v&&(N.invalidated=!0,N.data.cachedStats={})}),c0(g))})})}filterInteractableAnnotationsForElement(u,g){if(!g||!g.length)return;const m=(0,j.getEnabledElement)(u),{viewport:v}=m;return r1(v,g)}getReferencedImageId(u,g,m,v){const S=this.getTargetId(u);let D=S.split(/^[a-zA-Z]+:/)[1];if(u instanceof j.BaseVolumeViewport){const O=j.utilities.getVolumeId(S),N=j.cache.getVolume(O);D=j.utilities.getClosestImageId(N,g,m)}return D}getStyle(u,g,m){return y0(u,g,O9(m),this.mode)}}$(Q5,"toolName",void 0),Q5.toolName="AnnotationDisplayTool";const Lc=Q5;class e3 extends Lc{static createAnnotation(){let u={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(var g=arguments.length,m=new Array(g),v=0;v<g;v++)m[v]=arguments[v];for(const S of m)u=j.utilities.deepMerge(u,S);return u}static createAnnotationForViewport(u){for(var g=arguments.length,m=new Array(g>1?g-1:0),v=1;v<g;v++)m[v-1]=arguments[v];return this.createAnnotation({metadata:u.getViewReference()},...m)}static createAndAddAnnotation(u){for(var g=arguments.length,m=new Array(g>1?g-1:0),v=1;v<g;v++)m[v-1]=arguments[v];const S=this.createAnnotationForViewport(u,...m);fn(S,u.element),Yt(S,u.element)}constructor(u,g){var m,v;super(u,g),$(this,"mouseMoveCallback",(S,D)=>{if(!D)return!1;const{element:O,currentPoints:N}=S.detail,R=N.canvas;let L=!1;for(const P of D){if(cr(P)||!mr(P.annotationUID))continue;const{data:F}=P,V=F.handles?F.handles.activeHandleIndex:void 0,G=this._imagePointNearToolOrHandle(O,P,R,6),W=G&&!P.highlighted,q=!G&&P.highlighted;W||q?(P.highlighted=!P.highlighted,L=!0):F.handles&&F.handles.activeHandleIndex!==V&&(L=!0)}return L}),(m=u.configuration)!==null&&m!==void 0&&m.getTextLines&&(this.configuration.getTextLines=u.configuration.getTextLines),(v=u.configuration)!==null&&v!==void 0&&v.statsCalculator&&(this.configuration.statsCalculator=u.configuration.statsCalculator)}getHandleNearImagePoint(u,g,m,v){const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,{isCanvasAnnotation:N}=O,{points:R,textBox:L}=O.handles;if(L){const{worldBoundingBox:P}=L;if(P){const F={topLeft:D.worldToCanvas(P.topLeft),topRight:D.worldToCanvas(P.topRight),bottomLeft:D.worldToCanvas(P.bottomLeft),bottomRight:D.worldToCanvas(P.bottomRight)};if(m[0]>=F.topLeft[0]&&m[0]<=F.bottomRight[0]&&m[1]>=F.topLeft[1]&&m[1]<=F.bottomRight[1])return O.handles.activeHandleIndex=null,L}}for(let P=0;P<(R==null?void 0:R.length);P++){const F=R[P],V=N?F.slice(0,2):D.worldToCanvas(F);if(le.vec2.distance(m,V)<v)return O.handles.activeHandleIndex=P,F}O.handles.activeHandleIndex=null}getLinkedTextBoxStyle(u,g){return{visibility:this.getStyle("textBoxVisibility",u,g),fontFamily:this.getStyle("textBoxFontFamily",u,g),fontSize:this.getStyle("textBoxFontSize",u,g),color:this.getStyle("textBoxColor",u,g),shadow:this.getStyle("textBoxShadow",u,g),background:this.getStyle("textBoxBackground",u,g),lineWidth:this.getStyle("textBoxLinkLineWidth",u,g),lineDash:this.getStyle("textBoxLinkLineDash",u,g)}}isSuvScaled(u,g,m){if(u instanceof j.BaseVolumeViewport){var v;const D=j.utilities.getVolumeId(g),O=j.cache.getVolume(D);return(O==null||(v=O.scaling)===null||v===void 0?void 0:v.PT)!==void 0}const S=m&&j.metaData.get("scalingModule",m);return typeof(S==null?void 0:S.suvbw)=="number"}getAnnotationStyle(u){const{annotation:g,styleSpecifier:m}=u,v=P=>this.getStyle(P,m,g),{annotationUID:S}=g,D=mr(S),O=cr(g),N=v("lineWidth"),R=v("lineDash"),L=v("color");return{visibility:D,locked:O,color:L,lineWidth:N,lineDash:R,lineOpacity:1,fillColor:L,fillOpacity:0,shadow:v("shadow"),textbox:this.getLinkedTextBoxStyle(m,g)}}_imagePointNearToolOrHandle(u,g,m,v){return!!this.getHandleNearImagePoint(u,g,m,v)||!!this.isPointNearTool(u,g,m,v,"mouse")||void 0}}$(e3,"toolName",void 0),e3.toolName="AnnotationTool";const ei=e3;function M9(E){const u=document.createElementNS("http://www.w3.org/2000/svg","tspan");return u.setAttribute("x","0"),u.setAttribute("dy","1.2em"),u.textContent=E,u}function N9(E,u){let g=E.querySelector("rect.background");if(!u)return g&&E.removeChild(g),E.getBBox();g||(g=document.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("class","background"),E.insertBefore(g,E.firstChild));const m=E.getBBox(),v={x:"".concat(m.x),y:"".concat(m.y),width:"".concat(m.width),height:"".concat(m.height),fill:u};return ja(v,g),m}const kc=function(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return function(D,O,N){let R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[""],L=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;const{padding:F,color:V,fontFamily:G,fontSize:W,background:q}=P;let Y;const[Z,ne]=[L[0]+F,L[1]+F],oe=Ds(O,"text",N),ue=D.getSvgNode(oe);if(ue){const ge=ue.querySelector("text"),me=Array.from(ge.children);for(let Ie=0;Ie<me.length;Ie++){const be=me[Ie],Ne=R[Ie]||"";be.textContent=Ne}if(R.length>me.length){for(let Ie=0;Ie<R.length-me.length;Ie++){const be=M9(R[Ie+me.length]);ge.appendChild(be)}ue.appendChild(ge),D.appendNode(ue,oe)}const xe={fill:V,"font-size":W,"font-family":G},Ee={transform:"translate(".concat(Z," ").concat(ne,")")};ja(xe,ge),ja(Ee,ue),Y=N9(ue,q),D.setNodeTouched(oe)}else{const ge=document.createElementNS("http://www.w3.org/2000/svg","g");ge.setAttribute("transform","translate(".concat(Z," ").concat(ne,")"));const me=function(xe,Ee){const{color:Ie,fontFamily:be,fontSize:Ne}=Ee,_e=document.createElementNS("http://www.w3.org/2000/svg","text"),Me="filter:url(#shadow-".concat(xe.svgLayerElement.id,");"),Pe="".concat("user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);").concat(Me);return _e.setAttribute("x","0"),_e.setAttribute("y","0"),_e.setAttribute("fill",Ie),_e.setAttribute("font-family",be),_e.setAttribute("font-size",Ne),_e.setAttribute("style",Pe),_e}(D,P);for(let xe=0;xe<R.length;xe++){const Ee=M9(R[xe]);me.appendChild(Ee)}ge.appendChild(me),D.appendNode(ge,oe),Y=N9(ge,q)}return Object.assign({},Y,{x:Z,y:ne,height:Y.height+F,width:Y.width+F})}(E,u,g,m,v,Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},S))};function Mn(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},D=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"";if(isNaN(m[0])||isNaN(m[1])||isNaN(v[0])||isNaN(v[1]))return;const{color:O,width:N,lineWidth:R,lineDash:L,shadow:P}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},S),F=R||N,V=Ds(u,"line",g),G=E.getSvgNode(V),W=P?"filter:url(#shadow-".concat(E.svgLayerElement.id,");"):"",q={x1:"".concat(m[0]),y1:"".concat(m[1]),x2:"".concat(v[0]),y2:"".concat(v[1]),stroke:O,style:W,"stroke-width":F,"stroke-dasharray":L};if(G)ja(q,G),E.setNodeTouched(V);else{const Y=document.createElementNS("http://www.w3.org/2000/svg","line");D!==""&&Y.setAttribute("data-id",D),bs(q,Y),E.appendNode(Y,V)}}function t3(E,u){let g=[0,0],m=Number.MAX_SAFE_INTEGER;return E.forEach(function(v){const S=function(D,O){const[N,R]=D,[L,P]=O;return Math.sqrt(Math.pow(N-L,2)+Math.pow(R-P,2))}(u,v);S<m&&(m=S,g=[...v])}),g}const Ki=function(E,u,g,m,v,S,D){let O=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{};const N=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},O),R=kc(E,u,g,m,v,N);return function(L,P,F,V,G,W){let q=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{};const Y=V.length>0?t3(V,G):G,Z=t3(function(oe){const{x:ue,y:ge,height:me,width:xe}=oe,Ee=xe/2,Ie=me/2;return[[ue+Ee,ge],[ue,ge+Ie],[ue+Ee,ge+me],[ue+xe,ge+Ie]]}(W),Y),ne=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},q);Mn(L,P,"link-".concat(F),Y,Z,ne)}(E,u,g,S,v,R,N),R};function mi(E,u,g){if(E.length!==2||u.length!==2||g.length!==2)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(Id(E,u,g))}function n3(E,u){if(E.length!==4||u.length!==2)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[g,m,v,S]=E;let D=655535;const O=function(N,R,L,P){return{top:[[N,R],[N+L,R]],right:[[N+L,R],[N+L,R+P]],bottom:[[N+L,R+P],[N,R+P]],left:[[N,R+P],[N,R]]}}(g,m,v,S);return Object.keys(O).forEach(N=>{const[R,L]=O[N],P=mi(R,L,u);P<D&&(D=P)}),D}function Ha(E){const u=function(m){const v=[m[0],m[1]].sort(function(O,N){return O[0]<N[0]?-1:1}),S=[m[0],m[1]].sort(function(O,N){return O[1]<N[1]?-1:1}),D=v[v.length-1];return{top:S[0],bottom:S[S.length-1],right:D}}(E),g=(u.top[1]+u.bottom[1])/2;return[u.right[0],g]}function i1(E,u,g,m){const v=le.vec3.create();le.vec3.cross(v,u,E);const S=le.vec3.fromValues(...g),D=le.vec3.fromValues(...m),O=le.vec3.create();le.vec3.subtract(O,S,D);const N=le.vec3.length(O);if(N<1e-4)return{worldWidth:0,worldHeight:0};const R=le.vec3.dot(O,v)/(N*le.vec3.length(v));return{worldWidth:Math.sqrt(1-R*R)*N,worldHeight:R*N}}function Pc(E,u,g){return E==="CT"?"HU":E==="PT"?function(m,v){if(!v.isPreScaled)return"raw";if(v.isSuvScaled)return"SUV";const S=j.metaData.get("generalSeriesModule",m);if((S==null?void 0:S.modality)==="PT"){const D=j.metaData.get("petSeriesModule",m);return(D==null?void 0:D.units)||"unitless"}}(u,g):""}function qo(E,u){if(E instanceof j.BaseVolumeViewport){const g=j.utilities.getVolumeId(u),m=j.cache.getVolume(g);return!(m==null||!m.scaling)&&Object.keys(m.scaling).length>0}if(E instanceof j.StackViewport){const{preScale:g}=E.getImageData()||{};return!(g==null||!g.scaled)}return!1}class r3{}$(r3,"run",void 0),$(r3,"getStatistics",void 0);const R9=r3;var pn;const{PointsManager:A9}=j.utilities;class ti extends R9{static statsInit(u){u.noPointsCollection&&(ti.pointsInShape=null)}}function a1(E){return E.length===1?E[0]:E}pn=ti,$(ti,"max",[-1/0]),$(ti,"min",[1/0]),$(ti,"sum",[0]),$(ti,"count",0),$(ti,"runMean",[0]),$(ti,"m2",[0]),$(ti,"pointsInShape",A9.create3(1024)),$(ti,"statsCallback",E=>{var u;let{value:g,pointLPS:m=null}=E;Array.isArray(g)&&g.length>1&&pn.max.length===1&&(pn.max.push(pn.max[0],pn.max[0]),pn.min.push(pn.min[0],pn.min[0]),pn.sum.push(pn.sum[0],pn.sum[0]),pn.runMean.push(0,0),pn.m2.push(pn.m2[0],pn.m2[0])),(u=pn.pointsInShape)===null||u===void 0||u.push(m);const v=Array.isArray(g)?g:[g];pn.count+=1,pn.max.map((S,D)=>{const O=v[D],N=O-pn.runMean[D];pn.sum[D]+=O,pn.runMean[D]+=N/pn.count;const R=O-pn.runMean[D];pn.m2[D]+=N*R,pn.min[D]=Math.min(pn.min[D],O),pn.max[D]=Math.max(S,O)})}),$(ti,"getStatistics",E=>{const u=pn.sum.map(S=>S/pn.count),g=pn.m2.map(S=>Math.sqrt(S/pn.count)),m=(E==null?void 0:E.unit)||null,v={max:{name:"max",label:"Max Pixel",value:a1(pn.max),unit:m},min:{name:"min",label:"Min Pixel",value:a1(pn.min),unit:m},mean:{name:"mean",label:"Mean Pixel",value:a1(u),unit:m},stdDev:{name:"stdDev",label:"Standard Deviation",value:a1(g),unit:m},count:{name:"count",label:"Pixel Count",value:pn.count,unit:null},pointsInShape:pn.pointsInShape,array:[]};return v.array.push(v.max,v.mean,v.stdDev,v.stdDev,v.count),pn.max=[-1/0],pn.min=[1/0],pn.sum=[0],pn.m2=[0],pn.runMean=[0],pn.count=0,pn.pointsInShape=A9.create3(1024),v});const{transformWorldToIndex:L9}=j.utilities;class i3 extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Ej,statsCalculator:ti}}),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F,...O.getViewReference({points:[S]})},data:{label:"",handles:{points:[[...S],[...S],[...S],[...S]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,W),G}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,{points:N}=O.handles,R=D.worldToCanvas(N[0]),L=D.worldToCanvas(N[3]),P=this._getRectangleImageCoordinates([R,L]),F=[m[0],m[1]],{left:V,top:G,width:W,height:q}=P;return n3([V,G,W,q],F)<=v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const{renderingEngine:R}=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R,S),D&&sn(v)}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world,{points:V}=N.handles;V.forEach(G=>{G[0]+=F[0],G[1]+=F[1],G[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=(0,j.getEnabledElement)(m),{worldToCanvas:V,canvasToWorld:G}=F.viewport,W=P.world,{points:q}=N.handles;let Y,Z,ne,oe,ue,ge,me,xe;switch(q[D]=[...W],D){case 0:case 3:Y=V(q[0]),oe=V(q[3]),Z=[oe[0],Y[1]],ne=[Y[0],oe[1]],ge=G(Z),me=G(ne),q[1]=ge,q[2]=me;break;case 1:case 2:Z=V(q[1]),ne=V(q[2]),Y=[ne[0],Z[1]],oe=[Z[0],ne[1]],ue=G(Y),xe=G(oe),q[0]=ue,q[3]=xe}v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{points:q,activeHandleIndex:Y}=W.handles,Z=q.map(Ye=>D.worldToCanvas(Ye));P.annotationUID=G;const{color:ne,lineWidth:oe,lineDash:ue}=this.getAnnotationStyle({annotation:V,styleSpecifier:P}),{viewPlaneNormal:ge,viewUp:me}=D.getCamera();if(W.cachedStats[R]&&W.cachedStats[R].areaUnit!=null){if(V.invalidated&&(this._throttledCalculateCachedStats(V,ge,me,L,u),D instanceof j.VolumeViewport)){const{referencedImageId:Ye}=V.metadata;for(const at in W.cachedStats)at.startsWith("imageId")&&L.getStackViewports().find(ot=>{const st=j.utilities.imageIdToURI(Ye),ct=ot.hasImageURI(st),Tt=j.utilities.imageIdToURI(ot.getCurrentImageId());return ct&&Tt!==st})&&delete W.cachedStats[at]}}else W.cachedStats[R]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(V,ge,me,L,u);if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let xe;if(!mr(G))continue;cr(V)||this.editData||Y===null||(xe=[Z[Y]]),xe&&Qn(g,G,"0",xe,{color:ne}),Y5(g,G,"0",Z,{color:ne,lineDash:ue,lineWidth:oe},"".concat(G,"-rect")),S=!0;const Ee=this.getLinkedTextBoxStyle(P,V);if(!Ee.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Ie=this.configuration.getTextLines(W,R);if(!Ie||Ie.length===0)continue;if(!W.handles.textBox.hasMoved){const Ye=Ha(Z);W.handles.textBox.worldPosition=D.canvasToWorld(Ye)}const be=D.worldToCanvas(W.handles.textBox.worldPosition),Ne=Ki(g,G,"1",Ie,be,Z,{},Ee),{x:_e,y:Me,width:Pe,height:Ze}=Ne;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([_e,Me]),topRight:D.canvasToWorld([_e+Pe,Me]),bottomLeft:D.canvasToWorld([_e,Me+Ze]),bottomRight:D.canvasToWorld([_e+Pe,Me+Ze])}}return S}),$(this,"_getRectangleImageCoordinates",u=>{const[g,m]=u;return{left:Math.min(g[0],m[0]),top:Math.min(g[1],m[1]),width:Math.abs(g[0]-m[0]),height:Math.abs(g[1]-m[1])}}),$(this,"_calculateCachedStats",(u,g,m,v,S)=>{const{data:D}=u,{viewport:O}=S,{element:N}=O,R=D.handles.points[0],L=D.handles.points[3],{cachedStats:P}=D,F=Object.keys(P);for(let q=0;q<F.length;q++){const Y=F[q],Z=this.getTargetIdImage(Y,v);if(!Z)continue;const{dimensions:ne,imageData:oe,metadata:ue}=Z,ge=L9(oe,R);ge[0]=Math.floor(ge[0]),ge[1]=Math.floor(ge[1]),ge[2]=Math.floor(ge[2]);const me=L9(oe,L);if(me[0]=Math.floor(me[0]),me[1]=Math.floor(me[1]),me[2]=Math.floor(me[2]),this._isInsideVolume(ge,me,ne)){var V,G,W;this.isHandleOutsideImage=!1;const xe=[[Math.min(ge[0],me[0]),Math.max(ge[0],me[0])],[Math.min(ge[1],me[1]),Math.max(ge[1],me[1])],[Math.min(ge[2],me[2]),Math.max(ge[2],me[2])]],{worldWidth:Ee,worldHeight:Ie}=i1(g,m,R,L),be=[ge,me],{scale:Ne,areaUnits:_e}=za(Z,be),Me=Math.abs(Ee*Ie)/(Ne*Ne),Pe={isPreScaled:qo(O,Y),isSuvScaled:this.isSuvScaled(O,Y,u.metadata.referencedImageId)},Ze=Pc(ue.Modality,u.metadata.referencedImageId,Pe),Ye=Ii(oe,()=>!0,this.configuration.statsCalculator.statsCallback,xe),at=this.configuration.statsCalculator.getStatistics();P[Y]={Modality:ue.Modality,area:Me,mean:(V=at.mean)===null||V===void 0?void 0:V.value,stdDev:(G=at.stdDev)===null||G===void 0?void 0:G.value,max:(W=at.max)===null||W===void 0?void 0:W.value,statsArray:at.array,pointsInShape:Ye,areaUnit:_e,modalityUnit:Ze}}else this.isHandleOutsideImage=!0,P[Y]={Modality:ue.Modality}}return u.invalidated=!1,Yt(u,N),P}),$(this,"_isInsideVolume",(u,g,m)=>j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}}function Ej(E,u){const g=E.cachedStats[u],{area:m,mean:v,max:S,stdDev:D,areaUnit:O,modalityUnit:N}=g;if(v===void 0)return;const R=[];return R.push("Area: ".concat(cn(m)," ").concat(O)),R.push("Mean: ".concat(cn(v)," ").concat(N)),R.push("Max: ".concat(cn(S)," ").concat(N)),R.push("Std Dev: ".concat(cn(D)," ").concat(N)),R}$(i3,"toolName",void 0),i3.toolName="RectangleROI";const a3=i3;class o3 extends a3{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getTargetId(O);let V,G;if(O instanceof j.StackViewport)V=F.split("imageId:")[1];else{G=j.utilities.getVolumeId(F);const Z=j.cache.getVolume(G);V=j.utilities.getClosestImageId(Z,S,L)}const W=O.getFrameOfReferenceUID(),q={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...L],enabledElement:D,viewUp:[...P],FrameOfReferenceUID:W,referencedImageId:V,toolName:this.getToolName(),volumeId:G},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null},segmentationId:null}};fn(q,v);const Y=Mt(v,this.getToolName());return this.editData={annotation:q,viewportIdsToRender:Y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,Y),q}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let L=0;L<N.length;L++){const P=N[L],{annotationUID:F,data:V}=P,{points:G,activeHandleIndex:W}=V.handles,q=G.map(ue=>D.worldToCanvas(ue));R.annotationUID=F;const Y=this.getStyle("lineWidth",R,P),Z=this.getStyle("lineDash",R,P),ne=this.getStyle("color",R,P);if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let oe;Yt(P,O),mr(F)&&(cr(P)||this.editData||W===null||(oe=[q[W]]),oe&&Qn(g,F,"0",oe,{color:ne}),Vd(g,F,"0",q[0],q[3],{color:ne,lineDash:Z,lineWidth:Y}),S=!0)}return S})}}$(o3,"toolName",void 0),o3.toolName="RectangleROIThreshold";const k9=o3,{EPSILON:Tj}=j.CONSTANTS,_j=1-Tj;function o1(E,u){const{viewPlaneNormal:g}=u,m=E.filter(v=>{let S=v.metadata.viewPlaneNormal;if(!S){const{referencedImageId:O}=v.metadata,{imageOrientationPatient:N}=j.metaData.get("imagePlaneModule",O),R=le.vec3.fromValues(N[0],N[1],N[2]),L=le.vec3.fromValues(N[3],N[4],N[5]);S=le.vec3.create(),le.vec3.cross(S,R,L),v.metadata.viewPlaneNormal=S}const D=Math.abs(le.vec3.dot(g,S))>_j;return S&&D});return m.length?m:[]}const{transformWorldToIndex:Ud}=j.utilities;class s3 extends a3{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{configuration:{numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:Dj,statsCalculator:ti,showTextBox:!1}}),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R;let F,V,G;if(O instanceof j.StackViewport)throw new Error("Stack Viewport Not implemented");{const ue=this.getTargetId(O);G=j.utilities.getVolumeId(ue),V=j.cache.getVolume(G),F=j.utilities.getClosestImageId(V,S,L)}const W=j.utilities.getSpacingInNormalDirection(V,L),q=this._getStartCoordinate(S,L),Y=this._getEndCoordinate(S,W,L),Z=O.getFrameOfReferenceUID(),ne={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...L],enabledElement:D,viewUp:[...P],FrameOfReferenceUID:Z,referencedImageId:F,toolName:this.getToolName(),volumeId:G,spacingInNormal:W},data:{label:"",startCoordinate:q,endCoordinate:Y,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[F],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(ne,V),fn(ne,v);const oe=Mt(v,this.getToolName());return this.editData={annotation:ne,viewportIdsToRender:oe,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,oe),ne}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R.renderingEngine,S),D&&sn(v)}),$(this,"renderAnnotation",(u,g)=>{var m;let v=!1;const{viewport:S}=u;let D=an(this.getToolName(),S.element);if((m=D)===null||m===void 0||!m.length)return v;D=o1(D,S.getCamera());const O={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let N=0;N<D.length;N++){const R=D[N],{annotationUID:L,data:P}=R,{startCoordinate:F,endCoordinate:V}=P,{points:G,activeHandleIndex:W}=P.handles,q=G.map(Pe=>S.worldToCanvas(Pe));O.annotationUID=L;const Y=this.getStyle("lineWidth",O,R),Z=this.getStyle("lineDash",O,R),ne=this.getStyle("color",O,R),oe=S.getCamera().focalPoint,ue=S.getCamera().viewPlaneNormal;let ge=F,me=V;Array.isArray(F)&&(ge=this._getCoordinateForViewplaneNormal(ge,ue),P.startCoordinate=ge,P.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(ue)]=ge),Array.isArray(V)&&(me=this._getCoordinateForViewplaneNormal(me,ue),P.endCoordinate=me);const xe=j.utilities.roundToPrecision(ge),Ee=j.utilities.roundToPrecision(me),Ie=this._getCoordinateForViewplaneNormal(oe,ue),be=j.utilities.roundToPrecision(Ie);if(be<Math.min(xe,Ee)||be>Math.max(xe,Ee))continue;R.invalidated&&this._throttledCalculateCachedStats(R,u);let Ne,_e=!1;if(be!==xe&&be!==Ee||(_e=!0),!S.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),v;if(!mr(L))continue;cr(R)||this.editData||W===null||!_e||(Ne=[q[W]]),Ne&&Qn(g,L,"0",Ne,{color:ne});let Me=Z;if(_e||(Me=2),Vd(g,L,"0",q[0],q[3],{color:ne,lineDash:Me,lineWidth:Y}),v=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const Pe=this.getLinkedTextBoxStyle(O,R);if(!Pe.visibility){P.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Ze=this.configuration.getTextLines(P);if(!Ze||Ze.length===0)continue;if(!P.handles.textBox.hasMoved){const pt=Ha(q);P.handles.textBox.worldPosition=S.canvasToWorld(pt)}const Ye=S.worldToCanvas(P.handles.textBox.worldPosition),at=Ki(g,L,"1",Ze,Ye,q,{},Pe),{x:ot,y:st,width:ct,height:Tt}=at;P.handles.textBox.worldBoundingBox={topLeft:S.canvasToWorld([ot,st]),topRight:S.canvasToWorld([ot+ct,st]),bottomLeft:S.canvasToWorld([ot,st+Tt]),bottomRight:S.canvasToWorld([ot+ct,st+Tt])}}}return v}),this._throttledCalculateCachedStats=$i(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(u,g){const{data:m,metadata:v}=u,{viewPlaneNormal:S,spacingInNormal:D}=v,{imageData:O}=g,{startCoordinate:N,endCoordinate:R}=m,{points:L}=m.handles,P=Ud(O,L[0]),F=Ud(O,L[0]),V=le.vec3.create();O.indexToWorldVec3(P,V);const G=le.vec3.create();O.indexToWorldVec3(F,G),this._getIndexOfCoordinatesForViewplaneNormal(S)==2?(V[2]=N,G[2]=R):this._getIndexOfCoordinatesForViewplaneNormal(S)==0?(V[0]=N,G[0]=R):this._getIndexOfCoordinatesForViewplaneNormal(S)==1&&(V[1]=N,G[1]=R);const W=le.vec3.distance(V,G),q=[];for(let Y=0;Y<W;Y+=D)q.push(L.map(Z=>{const ne=le.vec3.create();return le.vec3.scaleAndAdd(ne,Z,S,Y),Array.from(ne)}));m.cachedStats.projectionPoints=q}_computePointsInsideVolume(u,g,m,v){var S,D,O;const{data:N,metadata:R}=u,{viewPlaneNormal:L,viewUp:P}=R,{viewport:F,renderingEngine:V}=v,G=N.cachedStats.projectionPoints,W=[[]],q=this.getTargetIdImage(g,V),Y=N.handles.points[0],Z=N.handles.points[3],{worldWidth:ne,worldHeight:oe}=i1(L,P,Y,Z),ue=za(q,N.habdles),ge=Math.abs(ne*oe)/(ue.scale*ue.scale),me={isPreScaled:qo(F,g),isSuvScaled:this.isSuvScaled(F,g,u.metadata.referencedImageId)},xe=Pc(R.Modality,u.metadata.referencedImageId,me);for(let Ie=0;Ie<G.length;Ie++){if(!m)continue;const be=G[Ie][0],{dimensions:Ne,imageData:_e}=m,Me=Ud(_e,Y),Pe=Ud(_e,be),Ze=this._getIndexOfCoordinatesForViewplaneNormal(L);Me[0]=Math.floor(Me[0]),Me[1]=Math.floor(Me[1]),Me[2]=Math.floor(Me[2]),Me[Ze]=Pe[Ze];const Ye=Ud(_e,Z);if(Ye[0]=Math.floor(Ye[0]),Ye[1]=Math.floor(Ye[1]),Ye[2]=Math.floor(Ye[2]),Ye[Ze]=Pe[Ze],this._isInsideVolume(Me,Ye,Ne)){this.isHandleOutsideImage=!1;const at=[[Math.min(Me[0],Ye[0]),Math.max(Me[0],Ye[0])],[Math.min(Me[1],Ye[1]),Math.max(Me[1],Ye[1])],[Math.min(Me[2],Ye[2]),Math.max(Me[2],Ye[2])]],ot=Ii(_e,()=>!0,this.configuration.statsCalculator.statsCallback,at);W.push(ot)}}const Ee=this.configuration.statsCalculator.getStatistics();N.cachedStats.pointsInVolume=W,N.cachedStats.statistics={Modality:R.Modality,area:ge,mean:(S=Ee.mean)===null||S===void 0?void 0:S.value,stdDev:(D=Ee.stdDev)===null||D===void 0?void 0:D.value,max:(O=Ee.max)===null||O===void 0?void 0:O.value,statsArray:Ee.array,areaUnit:ue.areaUnits,modalityUnit:xe}}_calculateCachedStatsTool(u,g){const m=u.data,{viewport:v}=g,{cachedStats:S}=m,D=this.getTargetId(v),O=j.cache.getVolume(D.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(u,O),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(u,D,O,g),u.invalidated=!1,Yt(u,v.element),S}_getStartCoordinate(u,g){const m=u;return this._getCoordinateForViewplaneNormal(m,g)}_getEndCoordinate(u,g,m){const v=this.configuration.numSlicesToPropagate,S=le.vec3.create();return le.vec3.scaleAndAdd(S,u,m,v*g),this._getCoordinateForViewplaneNormal(S,m)}_getIndexOfCoordinatesForViewplaneNormal(u){const g=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];return g.indexOf(Math.max(...g))}_getCoordinateForViewplaneNormal(u,g){return u[this._getIndexOfCoordinatesForViewplaneNormal(g)]}}function Dj(E){const u=E.cachedStats.statistics,{area:g,mean:m,max:v,stdDev:S,areaUnit:D,modalityUnit:O}=u;if(m===void 0)return;const N=[];return N.push("Area: ".concat(cn(g)," ").concat(D)),N.push("Mean: ".concat(cn(m)," ").concat(O)),N.push("Max: ".concat(cn(v)," ").concat(O)),N.push("Std Dev: ".concat(cn(S)," ").concat(O)),N}$(s3,"toolName",void 0),s3.toolName="RectangleROIStartEndThreshold";const P9=s3,F9=function(E,u){const g=E.findIndex(m=>{let[v,S]=m;return v===S});if(g===-1)throw new Error("3D bounding boxes not supported in an oblique plane");return E[g][0]-=u,E[g][1]+=u,E},V9=function(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const m=[];return E.forEach(v=>{var S,D;const{data:O}=v,{points:N}=O.handles,{imageData:R,dimensions:L}=u;let P=N;if((S=O.cachedStats)!==null&&S!==void 0&&S.projectionPoints){const{projectionPoints:V}=O.cachedStats;P=[].concat(...V)}let F=ml(P.map(V=>j.utilities.transformWorldToIndex(R,V)),L);!g.numSlicesToProject||(D=O.cachedStats)!==null&&D!==void 0&&D.projectionPoints||(F=F9(F,g.numSlicesToProject)),m.push(F)}),m.length===1?m[0]:m.reduce((v,S)=>({iMin:Math.min(v.iMin,S.iMin),jMin:Math.min(v.jMin,S.jMin),kMin:Math.min(v.kMin,S.kMin),iMax:Math.max(v.iMax,S.iMax),jMax:Math.max(v.jMax,S.jMax),kMax:Math.max(v.kMax,S.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})},bj=function(E,u,g,m){const v=E.map(O=>Bn(O));let S;(function(O){const N=[k9.toolName,P9.toolName];for(const R of O){const L=R.metadata.toolName;if(!N.includes(L))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}})(v);for(let O=0;O<g.length;O++)g[O].volume.getScalarData().length!==u.getScalarData().length&&O!==0||(S=V9(v,g[O].volume,m));const D=b9(u,g,{...m,boundsIJK:S});return D.modified(),D},Ij=function(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"mergedLabelmap";E.forEach(D=>{let{direction:O,dimensions:N,origin:R,spacing:L}=D;if(!(j.utilities.isEqual(N,E[0].dimensions)&&j.utilities.isEqual(O,E[0].direction)&&j.utilities.isEqual(L,E[0].spacing)&&j.utilities.isEqual(R,E[0].origin)))throw new Error("labelmaps must have the same size and shape")});const m=E[0],v=new(m.getScalarData()).constructor(m.getScalarData().length);E.forEach(D=>{const O=D.getScalarData();for(let N=0;N<O.length;N++)O[N]===u&&(v[N]=u)});const S={scalarData:v,metadata:m.metadata,spacing:m.spacing,origin:m.origin,direction:m.direction,dimensions:m.dimensions};return j.volumeLoader.createLocalVolume(S,g,!0)};function Oj(E,u){if(E===Nt.Labelmap)return function(g){return g&&typeof g.renderOutline=="boolean"&&typeof g.outlineWidthActive=="number"&&typeof g.outlineWidthInactive=="number"&&typeof g.activeSegmentOutlineWidthDelta=="number"&&typeof g.renderFill=="boolean"&&typeof g.renderFillInactive=="boolean"&&typeof g.fillAlpha=="number"&&typeof g.fillAlphaInactive=="number"&&typeof g.outlineOpacity=="number"&&typeof g.outlineOpacityInactive=="number"}(u);throw new Error("Unknown representation type: ".concat(E))}function Mj(E){const{type:u}=E;if(u===Nt.Labelmap)return bp();throw new Error("Unknown representation type: ".concat(u))}async function Nj(E){const{viewportId:u,renderingEngineId:g,options:m}=E;let{segmentationId:v}=E;const S=(0,j.getEnabledElementByIds)(u,g);if(!S)throw new Error("element disabled");const{viewport:D}=S;if(!(D instanceof j.VolumeViewport))throw new Error("Segmentation only supports VolumeViewport");const{uid:O}=D.getDefaultActor();var N;if(v===void 0&&(v="".concat(O,"-based-segmentation-").concat((N=m==null?void 0:m.volumeId)!==null&&N!==void 0?N:j.utilities.uuidv4().slice(0,8))),m){const R=it()(m);await j.volumeLoader.createLocalVolume(R,v)}else{const{uid:R}=D.getDefaultActor();await j.volumeLoader.createAndCacheDerivedSegmentationVolume(R,{volumeId:v})}return v}function Rj(E,u,g){const m=qn(E);if(m===void 0)return;v0(E,g).forEach(R=>{R.configuration.brushSize=u,R.invalidateBrushCursor()});const v=m.getViewportsInfo(),S=Object.keys(v).map(R=>v[R]);if(!S.length)return;const{renderingEngineId:D}=S[0],O=m.getViewportIds(),N=(0,j.getRenderingEngine)(D);We(N,O)}function Aj(E,u){const g=qn(E);if(g===void 0)return;const m=g._toolInstances;if(!Object.keys(m).length)return;const v=v0(E,u)[0];return v?v.configuration.brushSize:void 0}function Lj(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{isDynamic:!1};const m=qn(E);if(m===void 0)return;const v=v0(E),S={...g,...u!==void 0&&{threshold:u}};v.forEach(L=>{L.configuration.strategySpecificConfiguration.THRESHOLD={...L.configuration.strategySpecificConfiguration.THRESHOLD,...S}});const D=m.getViewportsInfo();if(!D.length)return;const{renderingEngineId:O}=D[0],N=m.getViewportIds(),R=(0,j.getRenderingEngine)(O);We(R,N)}function kj(E){const u=qn(E);if(u===void 0)return;const g=u._toolInstances;if(!Object.keys(g).length)return;const m=v0(E)[0];return m?m.configuration.strategySpecificConfiguration.THRESHOLD.threshold:void 0}const Pj=function(E,u,g,m){const v=E.getScalarData(),{baseVolumeIdx:S,volumeInfoList:D}=D9(E,g);return D.forEach(O=>{const{volumeSize:N}=O;N===v.length?function(R,L,P){const{referenceValues:F,lower:V,upper:G}=P;for(let W=0;W<R.length;W++)if(R[W]===L){const q=F[W];R[W]=q>=V&&q<=G?L:0}}(v,u,O):function(R,L,P,F,V,G){const{imageData:W,lower:q,upper:Y,dimensions:Z}=P;let ne,oe,ue;for(let ge=0;ge<R.length;ge++)if(R[ge]===L){const me=X5(W,Z,F[V].spacing,F[V].imageData.getPoint(ge)),xe=Ie=>{let{value:be}=Ie;ne+=1,be>=ue.lower&&be<=ue.upper&&(oe+=1)};ne=0,oe=0,ue={lower:q,upper:Y};let Ee=!1;Ii(W,()=>!0,xe,me),Ee=G===0?oe>0:oe===ne,R[ge]=Ee?L:0}}(v,u,O,D,S,m)}),pi(E.volumeId),E};function U9(E,u,g){const m=g.toIJK(E),v=g.toIJK(u),S=le.vec3.create(),{testIJK:D}=g,O=le.vec3.sub(le.vec3.create(),m,v),N=Math.round(Math.max(...O.map(Math.abs)));if(N<2)return!0;const R=le.vec3.scale(le.vec3.create(),O,1/N);for(let L=1;L<N;L++)if(le.vec3.scaleAndAdd(S,v,R,L),!D(S))return!1;return!0}const Bd=.01;function Fj(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{maxMajor:0,maxMinor:0};const{points:m}=E.polyData,{maxMinor:v,maxMajor:S}=g;let D,O=S*S,N=v*v;for(let V=0;V<m.length;V++)for(let G=V+1;G<m.length;G++){const W=m[V],q=m[G],Y=le.vec3.sqrDist(W,q);Y<O||Y-Bd<O+Bd&&D||u.testCenter(W,q)&&U9(W,q,u)&&(O=Y-Bd,D=[V,G],N=0)}if(!D)return;O=Math.sqrt(O+Bd);const R=m[D[0]],L=m[D[1]],P=le.vec3.sub(le.vec3.create(),R,L);let F;le.vec3.scale(P,P,1/O);for(let V=0;V<m.length;V++)for(let G=V+1;G<m.length;G++){const W=m[V],q=m[G],Y=le.vec3.sqrDist(W,q);if(Y<=N)continue;const Z=le.vec3.sub(le.vec3.create(),W,q);Math.abs(le.vec3.dot(Z,P))/Math.sqrt(Y)>Bd||u.testCenter(W,q)&&U9(W,q,u)&&(N=Y,F=[V,G])}return F?(N=Math.sqrt(N),{majorAxis:[R,L],minorAxis:[m[F[0]],m[F[1]]],maxMajor:O,maxMinor:N,...E}):void 0}const{Labelmap:Vj}=Nt;function B9(E){const u=N_({segmentations:E});if(u==null||!u.length||!u[0].sliceContours.length)return;const{representationData:g,segments:m=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=E,{volumeId:v}=g[Vj],S=m.findIndex(D=>!!D);return S!==-1?(m[S].segmentIndex=S,function(D,O,N){const{sliceContours:R}=D,{segmentIndex:L,containedSegmentIndices:P}=N;let F;const V=function(G,W,q){const Y=j.cache.getVolume(G);if(!Y)return void console.warn("No volume found for ".concat(G));const Z=Y.imageData.getPointData().getScalars().getData(),ne=Y.dimensions[0],oe=ne*Y.dimensions[1];return{testCenter:(ue,ge)=>{const me=le.vec3.add(le.vec3.create(),ue,ge).map(_e=>_e/2),xe=Y.imageData.worldToIndex(me).map(Math.round),[Ee,Ie,be]=xe,Ne=Z[Ee+Ie*ne+be*oe];return Ne===W||(q==null?void 0:q.has(Ne))},toIJK:ue=>Y.imageData.worldToIndex(ue),testIJK:ue=>{const[ge,me,xe]=ue,Ee=Math.round(ge)+Math.round(me)*ne+Math.round(xe)*oe,Ie=Z[Ee];return Ie===W||(q==null?void 0:q.has(Ie))}}}(O,L,P);for(const G of R){const W=Fj(G,V,F);W&&(F=W)}return F&&Object.assign(F,N),F}(u[0],v,m[S])):void 0}function G9(E,u){const{majorAxis:g,minorAxis:m,label:v="",sliceIndex:S}=E,[D,O]=g,[N,R]=m,L=[D,O,N,R];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...u.getViewReference({sliceIndex:S})},data:{handles:{points:L,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:v,cachedStats:{}},isLocked:!1,isVisible:!0}}function s1(E){return typeof E=="number"?E?E<0?-1:1:E==E?0:NaN:NaN}function l3(E,u,g,m){const[v,S]=E,[D,O]=u,[N,R]=g,[L,P]=m,F=O-S,V=v-D,G=D*S-v*O,W=F*N+V*R+G,q=F*L+V*P+G;if(W!==0&&q!==0&&s1(W)===s1(q))return;const Y=P-R,Z=N-L,ne=L*R-N*P,oe=Y*v+Z*S+ne,ue=Y*D+Z*O+ne;if(oe!==0&&ue!==0&&s1(oe)===s1(ue))return;const ge=F*Z-Y*V;let me;me=V*ne-Z*G;const xe=me/ge;return me=Y*G-F*ne,[xe,me/ge]}const{transformWorldToIndex:l1}=j.utilities;class c3 extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Uj}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"preventHandleOutsideImage",void 0),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,{points:N}=O.handles;let R=D.worldToCanvas(N[0]),L=D.worldToCanvas(N[1]),P={start:{x:R[0],y:R[1]},end:{x:L[0],y:L[1]}},F=mi([P.start.x,P.start.y],[P.end.x,P.end.y],[m[0],m[1]]);return F<=v||(R=D.worldToCanvas(N[2]),L=D.worldToCanvas(N[3]),P={start:{x:R[0],y:R[1]},end:{x:L[0],y:L[1]}},F=mi([P.start.x,P.start.y],[P.end.x,P.end.y],[m[0],m[1]]),F<=v)}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),Wt(v),u.preventDefault()}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,D=g.data;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());Wt(S),this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const{renderingEngine:R}=(0,j.getEnabledElement)(m);if(this.editData.handleIndex!==void 0){const{points:L}=N.handles,P=le.vec3.distance(L[0],L[1]);if(le.vec3.distance(L[2],L[3])>P){const F=[[...L[2]],[...L[3]]],V=[...L[0]],G=[...L[1]],W=le.vec2.create();le.vec2.set(W,F[1][0]-F[0][0],F[1][1]-F[1][0]);const q=le.vec2.create();le.vec2.set(q,-W[1],W[0]);const Y=le.vec2.create();let Z;le.vec2.set(Y,G[0]-V[0],G[1]-V[0]),Z=le.vec2.dot(Y,q)>0?[V,G]:[G,V],N.handles.points=[F[0],F[1],Z[0],Z[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R,S),D&&sn(v),this.editData=null,this.isDrawing=!1}),$(this,"_dragDrawCallback",u=>{this.isDrawing=!0;const g=u.detail,{currentPoints:m,element:v}=g,S=(0,j.getEnabledElement)(v),{renderingEngine:D,viewport:O}=S,{worldToCanvas:N}=O,{annotation:R,viewportIdsToRender:L,handleIndex:P}=this.editData,{data:F}=R,V=m.world;F.handles.points[P]=[...V];const G=F.handles.points.map(N),W={x:G[0][0],y:G[0][1]},q={x:G[1][0],y:G[1][1]},Y=(G[2][0],G[2][1],G[3][0],G[3][1],le.vec2.distance(G[0],G[1])/3),Z=W.x-q.x,ne=W.y-q.y,oe=Math.sqrt(Z*Z+ne*ne),ue=Z/oe,ge=ne/oe,me=(W.x+q.x)/2,xe=(W.y+q.y)/2,Ee=me+Y*ge,Ie=xe-Y*ue,be=me-Y*ge,Ne=xe+Y*ue;F.handles.points[2]=O.canvasToWorld([Ee,Ie]),F.handles.points[3]=O.canvasToWorld([be,Ne]),R.invalidated=!0,We(D,L),this.editData.hasMoved=!0}),$(this,"_dragModifyCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),{renderingEngine:S}=v,{annotation:D,viewportIdsToRender:O,handleIndex:N,movingTextBox:R}=this.editData,{data:L}=D;if(R){const{deltaPoints:P}=g,F=P.world,{textBox:V}=L.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(N===void 0){const{deltaPoints:P}=g,F=P.world;L.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),D.invalidated=!0}else this._dragModifyHandle(u),D.invalidated=!0;We(S,O)}),$(this,"_dragModifyHandle",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=(0,j.getEnabledElement)(v),{viewport:D}=S,{annotation:O,handleIndex:N}=this.editData,{data:R}=O,L=m.world,P=[D.worldToCanvas(R.handles.points[0]),D.worldToCanvas(R.handles.points[1]),D.worldToCanvas(R.handles.points[2]),D.worldToCanvas(R.handles.points[3])],F={start:{x:P[0][0],y:P[0][1]},end:{x:P[1][0],y:P[1][1]}},V={start:{x:P[2][0],y:P[2][1]},end:{x:P[3][0],y:P[3][1]}},G=[...L],W=D.worldToCanvas(G);if(N===0||N===1){const q=P[N===0?1:0],Y=le.vec2.set(le.vec2.create(),W[0]-q[0],W[1]-q[1]),Z=le.vec2.set(le.vec2.create(),P[N][0]-q[0],P[N][1]-q[1]);le.vec2.normalize(Y,Y),le.vec2.normalize(Z,Z);const ne={start:{x:q[0],y:q[1]},end:{x:W[0],y:W[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(ne,V))return;const oe=q,ue=this._getSignedAngle(Z,Y);let ge=P[2][0],me=P[2][1],xe=P[3][0],Ee=P[3][1];ge-=oe[0],me-=oe[1],xe-=oe[0],Ee-=oe[1];const Ie=ge*Math.cos(ue)-me*Math.sin(ue),be=ge*Math.sin(ue)+me*Math.cos(ue),Ne=xe*Math.cos(ue)-Ee*Math.sin(ue),_e=xe*Math.sin(ue)+Ee*Math.cos(ue);ge=Ie+oe[0],me=be+oe[1],xe=Ne+oe[0],Ee=_e+oe[1];const Me=D.canvasToWorld([ge,me]),Pe=D.canvasToWorld([xe,Ee]);R.handles.points[N]=G,R.handles.points[2]=Me,R.handles.points[3]=Pe}else{const q=N===2?3:2,Y={longLineSegment:{start:F.start,end:F.end},shortLineSegment:{start:V.start,end:V.end}},Z=le.vec2.subtract(le.vec2.create(),[Y.longLineSegment.end.x,Y.longLineSegment.end.y],[Y.longLineSegment.start.x,Y.longLineSegment.start.y]),ne=le.vec2.normalize(le.vec2.create(),Z),oe=le.vec2.subtract(le.vec2.create(),[W[0],W[1]],[P[N][0],P[N][1]]),ue=le.vec2.length(oe),ge=this._getSignedAngle(ne,oe),me=Math.cos(ge)*ue,xe=le.vec2.scaleAndAdd(le.vec2.create(),[P[q][0],P[q][1]],ne,me);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:W[0],y:W[1]},end:{x:xe[0],y:xe[1]}},{start:{x:Y.longLineSegment.start.x,y:Y.longLineSegment.start.y},end:{x:Y.longLineSegment.end.x,y:Y.longLineSegment.end.y}})||!l3([W[0],W[1]],[xe[0],xe[1]],[F.start.x,F.start.y],[F.end.x,F.end.y]))return;R.handles.points[q]=D.canvasToWorld(xe),R.handles.points[N]=G}}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragDrawCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragDrawCallback)}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!0;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{points:q,activeHandleIndex:Y}=W.handles,Z=q.map(ot=>D.worldToCanvas(ot));P.annotationUID=G;const{color:ne,lineWidth:oe,lineDash:ue,shadow:ge}=this.getAnnotationStyle({annotation:V,styleSpecifier:P});if(W.cachedStats[R]&&W.cachedStats[R].unit!=null?V.invalidated&&this._throttledCalculateCachedStats(V,L,u):(W.cachedStats[R]={length:null,width:null,unit:null},this._calculateCachedStats(V,L,u)),!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let me;if(!mr(G))continue;cr(V)||this.editData||Y===null||(me=[Z[Y]]),me&&Qn(g,G,"0",me,{color:ne});const xe="".concat(G,"-line-1"),Ee="".concat(G,"-line-2");Mn(g,G,"0",Z[0],Z[1],{color:ne,lineDash:ue,lineWidth:oe,shadow:ge},xe),Mn(g,G,"1",Z[2],Z[3],{color:ne,lineDash:ue,lineWidth:oe,shadow:ge},Ee),S=!0;const Ie=this.getLinkedTextBoxStyle(P,V);if(!Ie.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const be=this.configuration.getTextLines(W,R);if(!be||be.length===0)continue;let Ne;W.handles.textBox.hasMoved||(Ne=Ha(Z),W.handles.textBox.worldPosition=D.canvasToWorld(Ne));const _e=D.worldToCanvas(W.handles.textBox.worldPosition),Me=Ki(g,G,"1",be,_e,Z,{},Ie),{x:Pe,y:Ze,width:Ye,height:at}=Me;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([Pe,Ze]),topRight:D.canvasToWorld([Pe+Ye,Ze]),bottomLeft:D.canvasToWorld([Pe,Ze+at]),bottomRight:D.canvasToWorld([Pe+Ye,Ze+at])}}return S}),$(this,"_movingLongAxisWouldPutItThroughShortAxis",(u,g)=>{const m=le.vec2.create();le.vec2.set(m,g.end.x-g.start.x,g.end.y-g.start.y),le.vec2.normalize(m,m);const v={start:{x:g.start.x-10*m[0],y:g.start.y-10*m[1]},end:{x:g.end.x+10*m[0],y:g.end.y+10*m[1]}};return!l3([v.start.x,v.start.y],[v.end.x,v.end.y],[u.start.x,u.start.y],[u.end.x,u.end.y])}),$(this,"_calculateCachedStats",(u,g,m)=>{const{data:v}=u,{element:S}=m.viewport,D=v.handles.points[0],O=v.handles.points[1],N=v.handles.points[2],R=v.handles.points[3],{cachedStats:L}=v,P=Object.keys(L);for(let F=0;F<P.length;F++){const V=P[F],G=this.getTargetIdImage(V,g);if(!G)continue;const{imageData:W,dimensions:q}=G,Y=l1(W,D),Z=l1(W,O),ne=l1(W,N),oe=l1(W,R),ue=[Y,Z],ge=[ne,oe],{scale:me,units:xe}=za(G,ue),{scale:Ee,units:Ie}=za(G,ge),be=this._calculateLength(D,O)/me,Ne=this._calculateLength(N,R)/Ee,_e=be>Ne?be:Ne,Me=be>Ne?Ne:be,Pe=be>Ne?xe:Ie,Ze=be>Ne?Ie:xe;this._isInsideVolume(Y,Z,ne,oe,q)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,L[V]={length:_e,width:Me,unit:xe,lengthUnit:Pe,widthUnit:Ze}}return u.invalidated=!1,Yt(u,S),L}),$(this,"_isInsideVolume",(u,g,m,v,S)=>j.utilities.indexWithinDimensions(u,S)&&j.utilities.indexWithinDimensions(g,S)&&j.utilities.indexWithinDimensions(m,S)&&j.utilities.indexWithinDimensions(v,S)),$(this,"_getSignedAngle",(u,g)=>Math.atan2(u[0]*g[1]-u[1]*g[0],u[0]*g[0]+u[1]*g[1])),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(u){const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F,...O.getViewReference({points:[S]})},data:{handles:{points:[[...S],[...S],[...S],[...S]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,W),G}_calculateLength(u,g){const m=u[0]-g[0],v=u[1]-g[1],S=u[2]-g[2];return Math.sqrt(m*m+v*v+S*S)}}function Uj(E,u){const{cachedStats:g,label:m}=E,{length:v,width:S,unit:D,lengthUnit:O,widthUnit:N}=g[u],R=[];return m&&R.push(m),v===void 0||R.push("L: ".concat(cn(v)," ").concat(O||D),"W: ".concat(cn(S)," ").concat(N||D)),R}$(c3,"toolName",void 0),c3.toolName="Bidirectional";const z9=c3;function Bj(E,u){const{data:g}=u,m=(0,j.getEnabledElement)(E),v=(g.getSegment||Gj)(m,g);if(!v)return;const S=m.viewport.getFrameOfReferenceUID(),D=Ip(),{segmentIndex:O,segmentationId:N}=v,R=an(this.toolName||z9.toolName,S);let L=!1;const P=R.filter(V=>{const{segment:G}=V.data;if(G)return G.segmentationId===N&&G.segmentIndex===O&&(L=!0,V.data.segment=G),!!G});let F;if(L||P.push({data:{segment:v}}),P.forEach(V=>{const G=[],{segment:W}=V.data,{segmentIndex:q,segmentationId:Y}=W;G[q]=W,Ht(V.annotationUID);const Z=B9({...D.find(ue=>ue.segmentationId===Y),segments:G});if(!Z)return;const ne=G9(Z,m.viewport);ne.annotationUID=V.annotationUID,ne.data.segment=W;const oe=fn(ne,S);if(W.segmentIndex===v.segmentIndex&&W.segmentationId===v.segmentationId){F=Z;const{style:ue}=v;ue&&Z5.setAnnotationStyles(oe,ue)}}),F){const{sliceIndex:V}=F,G=m.viewport.getImageIds();Wp(E,{imageIndex:G.length-1-V}),m.viewport.render()}else console.warn("No bidirectional found");return F}function Gj(E,u){var g,m;const v=Ip();if(!v.length)return;const S=u.segmentationId||v[0].segmentationId,D=(g=u.segmentIndex)!==null&&g!==void 0?g:vl(S);if(!D)return;const O=(m=u.segmentData)===null||m===void 0?void 0:m.get(D);return{label:"Segment ".concat(D),segmentIndex:D,segmentationId:S,...O}}const zj=1e-6;function W9(E){let u;const g=j.utilities.getRandomSampleFromArray(E,50);for(let D=0;D<3;D++)if(g.every((O,N,R)=>Math.abs(O[D]-R[0][D])<zj)){u=D;break}if(u===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const m=[],v=(u+1)%3,S=(u+2)%3;for(let D=0;D<E.length;D++)m.push([E[D][v],E[D][S]]);return{sharedDimensionIndex:u,projectedPolyline:m}}function j9(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sharedDimensionIndex:m,projectedPolyline:v}=W9(u),{holes:S}=g,D=[];if(S)for(let O=0;O<S.length;O++){const N=S[O],R=[];for(let L=0;L<N.length;L++)R.push([N[L][(m+1)%3],N[L][(m+2)%3]]);D.push(R)}return Nc(v,[E[(m+1)%3],E[(m+2)%3]],{holes:D})}function H9(E,u){var g;let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const v=dn(E),S=v.representationData,D=(g=m==null?void 0:m.representationType)!==null&&g!==void 0?g:Object.keys(S)[0];if(!D)throw new Error("Segmentation ".concat(E," does not have any representations"));switch(D){case Nt.Labelmap:return function(O,N,R){let{viewport:L}=R;const P=O.representationData.LABELMAP;if(Zn(P)){const{volumeId:ue}=P,ge=j.cache.getVolume(ue);return ge?ge.imageData.getScalarValueFromWorld(N):void 0}const{imageIdReferenceMap:F}=P,V=L.getCurrentImageId(),G=F.get(V);if(!j.cache.getImage(G))return;const W=jy(O.segmentationId),{segmentationRepresentationUID:q}=W[0],Y=L.getActor(q),Z=Y==null?void 0:Y.actor.getMapper().getInputData(),ne=j.utilities.transformWorldToIndex(Z,N),oe=Z.getDimensions();return(Z.voxelManager||j.utilities.VoxelManager.createVolumeVoxelManager(oe,Z.getPointData().getScalars().getData())).getAtIJKPoint(ne)}(v,u,m);case Nt.Contour:return function(O,N,R){let{viewport:L}=R;const P=O.representationData.CONTOUR,F=Array.from(P.annotationUIDsMap.keys()),{viewPlaneNormal:V}=L.getCamera();for(const G of F){const W=P.annotationUIDsMap.get(G);if(W)for(const q of W){const Y=Bn(q);if(!Y)continue;const{polyline:Z}=Y.data.contour;if(j.utilities.isEqual(V,Y.metadata.viewPlaneNormal)&&j9(N,Z))return Number(G)}}}(v,u,m);default:return}}function $9(E,u,g){let{viewport:m,searchRadius:v}=g;const S=dn(E),D=S.representationData.LABELMAP;if(Zn(D)){const{volumeId:ne}=D,oe=j.cache.getVolume(ne);if(!oe)return;const ue=oe.imageData,ge=ue.getScalarValueFromWorld(u);return function(xe,Ee,Ie,be,Ne){return K9((_e,Me)=>{const Pe=[xe[0]+_e,xe[1]+Me],Ze=Ie.canvasToWorld(Pe);return be.getScalarValueFromWorld(Ze)},Ee,Ne)}(m.worldToCanvas(u),ge,m,ue,v)?ge:void 0}const{imageIdReferenceMap:O}=D,N=m.getCurrentImageId(),R=O.get(N);if(!j.cache.getImage(R))return;const L=jy(S.segmentationId),{segmentationRepresentationUID:P}=L[0],F=m.getActor(P),V=F==null?void 0:F.actor.getMapper().getInputData(),G=j.utilities.transformWorldToIndex(V,u),W=V.getDimensions(),q=V.voxelManager||j.utilities.VoxelManager.createVolumeVoxelManager(W,V.getPointData().getScalars().getData()),Y=q.getAtIJKPoint(G);return function(ne,oe,ue,ge,me){return K9((xe,Ee,Ie)=>{const be=[ne[0]+xe,ne[1]+Ee,ne[2]+Ie];return ue.getAtIJK(...be)},ge,void 0)}(G,0,q,Y)?Y:void 0}function K9(E,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const m=Array.from({length:2*g+1},(v,S)=>S-g);for(const v of m)for(const S of m)for(const D of m){if(v===0&&S===0&&D===0)continue;const O=E(v,S,D);if(O!==void 0&&u!==O)return!0}return!1}function q9(E){const u=dn(E),{annotationUIDsMap:g}=u.representationData.CONTOUR;for(const[m,v]of g.entries())if(Array.from(v).find(S=>Bn(S).highlighted))return m}function c1(E,u){const g=E.maxX-E.minX,m=E.maxY-E.minY,v=[g,m],S=[E.minX+g/2,E.minY+m/2],D=[Math.abs(u[0]-S[0]),Math.abs(u[1]-S[1])],O=D[0]-.5*v[0],N=D[1]-.5*v[1];if(O>0&&N>0)return O*O+N*N;const R=Math.max(O,0)+Math.max(N,0);return R*R}function Wj(E,u){return Math.sqrt(c1(E,u))}function $a(E,u){return Math.sqrt(Ts(E,u))}function u3(E,u){const[g,m]=E,[v,S]=u;return[2*v-g,2*S-m]}function u1(E){const u=E.length;let g=0,m=u-1;for(let v=0;v<u;v++)g+=(E[m][0]+E[v][0])*(E[m][1]-E[v][1]),m=v;return Math.abs(g/2)}function jj(E){const u=function(g){const m=le.vec3.create(),v=g[0];for(let S=0,D=g.length;S<D;S++){const O=g[S],N=g[S===D-1?0:S+1],R=O[0]-v[0],L=O[1]-v[1],P=O[2]-v[2],F=N[0]-v[0],V=N[1]-v[1],G=N[2]-v[2];m[0]+=L*G-P*V,m[1]+=P*F-R*G,m[2]+=R*V-L*F}return le.vec3.scale(m,m,.5),m}(E);return le.vec3.normalize(u,u)}function X9(E,u,g){const m=[],v=V5(E,u,g,!(arguments.length>3&&arguments[3]!==void 0)||arguments[3]);for(let S=0;S<v.length;S++){const D=G_(u,g,E[v[S][0]],E[v[S][1]]);m.push(D)}return m}function Hj(E,u,g){let m,v;arguments.length>3&&arguments[3]!==void 0&&!arguments[3]?(v=0,m=1):(v=E.length-1,m=0);const S=[];for(let N=m;N<E.length;N++){const R=E[v],L=E[N];P5(u,g,R,L)&&S.push([v,N]),v=N}if(S.length===0)return;const D=[];S.forEach(N=>{const R=[E[N[0]],E[N[1]]],L=[(R[0][0]+R[1][0])/2,(R[0][1]+R[1][1])/2];D.push(le.vec2.distance(L,u))});const O=Math.min(...D);return{segment:S[D.indexOf(O)],distance:O}}const w0=.001,$j=(E,u)=>{let g,m,v;if(E instanceof j.StackViewport){const S=E.getImageData();m=S.direction.slice(0,3),v=S.direction.slice(3,6),g=S.spacing}else{const S=E.getImageData(),{direction:D,spacing:O}=S,{viewPlaneNormal:N,viewUp:R}=E.getCamera(),L=D.slice(0,3),P=D.slice(3,6),F=D.slice(6,9),V=le.vec3.create();le.vec3.cross(V,R,N);const G=Math.abs(le.vec3.dot(V,L)),W=Math.abs(le.vec3.dot(V,P)),q=Math.abs(le.vec3.dot(V,F));let Y;if(Math.abs(1-G)<w0)Y=O[0],m=L;else if(Math.abs(1-W)<w0)Y=O[1],m=P;else{if(!(Math.abs(1-q)<w0))throw new Error("No support yet for oblique plane planar contours");Y=O[2],m=F}const Z=Math.abs(le.vec3.dot(R,L)),ne=Math.abs(le.vec3.dot(R,P)),oe=Math.abs(le.vec3.dot(R,F));let ue;if(Math.abs(1-Z)<w0)ue=O[0],v=L;else if(Math.abs(1-ne)<w0)ue=O[1],v=P;else{if(!(Math.abs(1-oe)<w0))throw new Error("No support yet for oblique plane planar contours");ue=O[2],v=F}g=[Y,ue]}return{spacing:[g[0]/u,g[1]/u],xDir:m,yDir:v}},Kj=(E,u,g)=>le.vec2.dist(E,u)<g,qj=(E,u,g,m)=>{const{xDir:v,yDir:S,spacing:D}=m,O=(0,j.getEnabledElement)(E),{viewport:N}=O;if(!u.length)return u.push(g),console.log(">>>>> !canvasPoints. :: RETURN"),1;const R=N.canvasToWorld(u[u.length-1]),L=N.canvasToWorld(g),P=le.vec3.create();le.vec3.subtract(P,L,R);const F=Math.abs(le.vec3.dot(P,v)),V=Math.abs(le.vec3.dot(P,S)),G=Math.max(Math.floor(F/D[0]),Math.floor(V/D[0]));if(G>1){const W=u[u.length-1],q=le.vec2.dist(W,g),Y=le.vec2.create();le.vec2.subtract(Y,g,W),le.vec2.set(Y,Y[0]/q,Y[1]/q);const Z=q/G;for(let ne=1;ne<=G;ne++)u.push([W[0]+Z*Y[0]*ne,W[1]+Z*Y[1]*ne])}else u.push(g);return G},Xj=(E,u,g,m)=>{const v=[E[0]-u[0],E[1]-u[1]],S=[g[0]-u[0],g[1]-u[1]],D=v[0]*S[0]+v[1]*S[1];if(D<0)return!1;const O=Math.sqrt(S[0]*S[0]+S[1]*S[1]);if(O===0)return!1;const N=D/O,R=[S[0]/O,S[1]/O],L=[R[0]*N,R[1]*N],P=[u[0]+L[0],u[1]+L[1]];return!(le.vec2.distance(E,P)>m||le.vec2.distance(u,P)>le.vec2.distance(u,g))},f3=1e-6,Y9=1,Yj=0;function f1(E,u,g){const[m,v]=g;if(Math.abs(u)<f3)return E<0;const S=E/u;if(u>0){if(S>v)return 0;S>m&&(g[0]=S)}else{if(S<m)return 0;S<v&&(g[1]=S)}return 1}function Gd(E,u,g,m,v){const[S,D]=E,[O,N]=u,R=O-S,L=N-D;if(m===void 0||v===void 0?(m=E,v=u):(m[0]=E[0],m[1]=E[1],v[0]=u[0],v[1]=u[1]),Math.abs(R)<f3&&Math.abs(L)<f3&&S>=g[0]&&S<=g[2]&&D>=g[1]&&D<=g[3])return Y9;const P=[0,1];if(f1(g[0]-S,R,P)&&f1(S-g[2],-R,P)&&f1(g[1]-D,L,P)&&f1(D-g[3],-L,P)){const[F,V]=P;return V<1&&(v[0]=S+V*R,v[1]=D+V*L),F>0&&(m[0]+=F*R,m[1]+=F*L),Y9}return Yj}var Jj=I(807),hn=I.n(Jj);function d3(E,u,g,m){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.25;const S=E.getCamera(),{position:D}=S,{spacingInNormalDirection:O}=j.utilities.getTargetVolumeAndSpacingInNormalDir(E,S,g),N=O*v,R=E.getBounds(),L=R[0],P=R[1],F=[0,0,0];let V,G=[0,0,0];hn().subtract(u,D,F);for(let W=L;W<=P;W+=N){G=[W,0,0];const q=(W-D[0])/F[0];if(G[1]=q*F[1]+D[1],G[2]=q*F[2]+D[2],Zj(G,R)){const Y=m(E.getIntensityFromWorld(G),G);Y&&(V=Y)}}return V}const Zj=function(E,u){const[g,m,v,S,D,O]=u;return E[0]>g&&E[0]<m&&E[1]>v&&E[1]<S&&E[2]>D&&E[2]<O},J9=(E,u,g,m,v,S,D,O)=>{const N=[le.vec3.fromValues(g,m,v),le.vec3.fromValues(S,m,v),le.vec3.fromValues(g,D,v),le.vec3.fromValues(S,D,v),le.vec3.fromValues(g,m,O),le.vec3.fromValues(S,m,O),le.vec3.fromValues(g,D,O),le.vec3.fromValues(S,D,O)],R=le.vec3.fromValues(u[0],u[1],u[2]),L=le.vec3.fromValues(E[0],E[1],E[2]),P=-le.vec3.dot(R,L);let F=null;for(const V of N){const G=le.vec3.dot(R,V)+P;if(F===null)F=Math.sign(G);else if(Math.sign(G)!==F)return!0}return!1},Qj={filterAnnotationsWithinSlice:J5,getWorldWidthAndHeightFromCorners:i1,filterAnnotationsForDisplay:r1,getPointInLineOfSightWithCriteria:d3,isPlaneIntersectingAABB:J9,filterAnnotationsWithinSamePlane:o1};function eH(E){let u="";const g=E[0]<0?"R":"L",m=E[1]<0?"A":"P",v=E[2]<0?"F":"H",S=[Math.abs(E[0]),Math.abs(E[1]),Math.abs(E[2])],D=1e-4;for(let O=0;O<3;O++)if(S[0]>D&&S[0]>S[1]&&S[0]>S[2])u+=g,S[0]=0;else if(S[1]>D&&S[1]>S[0]&&S[1]>S[2])u+=m,S[1]=0;else if(S[2]>D&&S[2]>S[0]&&S[2]>S[1])u+=v,S[2]=0;else if(S[0]>D&&S[1]>D&&S[0]===S[1])u+=g+m,S[0]=0,S[1]=0;else if(S[0]>D&&S[2]>D&&S[0]===S[2])u+=g+v,S[0]=0,S[2]=0;else{if(!(S[1]>D&&S[2]>D&&S[1]===S[2]))break;u+=m+v,S[1]=0,S[2]=0}return u}function tH(E){let u=E.replace("H","f");return u=u.replace("F","h"),u=u.replace("R","l"),u=u.replace("L","r"),u=u.replace("A","p"),u=u.replace("P","a"),u=u.toUpperCase(),u}var Z9=function(E){return E.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",E.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED",E}(Z9||{});const d1=Z9,h3={};function Q9(E,u){const g=(0,j.getEnabledElement)(E),{viewportId:m}=g;h3[m]=u}function g3(E){const u=(0,j.getEnabledElement)(E),{viewportId:g}=u;return h3[g]}const{ViewportStatus:e7}=j.Enums,{triggerEvent:p3}=j.utilities,t7=!0,m3=new Map;function nH(E,u){var g;let m,v;if(E===void 0)throw new Error("playClip: element must not be undefined");const S=(0,j.getEnabledElement)(E);if(!S)throw new Error("playClip: element must be a valid Cornerstone enabled element");u||(u={}),u.dynamicCineEnabled=(g=u.dynamicCineEnabled)===null||g===void 0||g;const{viewport:D}=S,O=y3(D),N=function(Y,Z){var ne,oe;if(Y instanceof j.StackViewport)return function(ue,ge){const me=ue.getImageIds();return{get numScrollSteps(){return me.length},get currentStepIndex(){return ue.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(xe){this.waitForRenderedCount<=ge&&ue.viewportStatus!==e7.RENDERED?this.waitForRenderedCount++:(this.waitForRenderedCount=0,Mc(ue,{delta:xe,debounceLoading:t7}))}}}(Y,(ne=Z.waitForRendered)!==null&&ne!==void 0?ne:30);if(Y instanceof j.VolumeViewport){const ue=y3(Y);return Z.dynamicCineEnabled&&ue!=null&&ue.isDynamicVolume()?function(ge){return{get numScrollSteps(){return ge.numTimePoints},get currentStepIndex(){return ge.timePointIndex},get frameTimeVectorEnabled(){return!1},scroll(me){ge.timePointIndex+=me}}}(ue):function(ge,me){const{volumeId:xe}=me,Ee={viewPlaneNormal:le.vec3.create(),scrollInfo:null},Ie=()=>{const be=ge.getCamera();if(!Ee.scrollInfo||!le.vec3.equals(be.viewPlaneNormal,Ee.viewPlaneNormal)){const Ne=j.utilities.getVolumeViewportScrollInfo(ge,xe);Ee.viewPlaneNormal=be.viewPlaneNormal,Ee.scrollInfo=Ne}return Ee.scrollInfo};return{get numScrollSteps(){return Ie().numScrollSteps},get currentStepIndex(){return Ie().currentStepIndex},get frameTimeVectorEnabled(){const be=ge.getCamera(),Ne=me.direction.slice(6,9).map(Me=>-Me),_e=le.vec3.dot(Ne,be.viewPlaneNormal);return le.glMatrix.equals(_e,1)},scroll(be){Ie().currentStepIndex+=be,Mc(ge,{delta:be})}}}(Y,ue)}if(Y instanceof j.VideoViewport)return function(ue,ge){return{get numScrollSteps(){return ue.getNumberOfSlices()},get currentStepIndex(){return ue.getSliceIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(me){this.waitForRenderedCount<=ge&&ue.viewportStatus!==e7.RENDERED?this.waitForRenderedCount++:(this.waitForRenderedCount=0,Mc(ue,{delta:me,debounceLoading:t7}))},play:me=>(me&&ue.setPlaybackRate(me/24),ue.play(),ue.getFrameRate())}}(Y,(oe=Z.waitForRendered)!==null&&oe!==void 0?oe:30);throw new Error("Unknown viewport type")}(D,u);let R=g3(E);const L=u.dynamicCineEnabled&&(O==null?void 0:O.isDynamicVolume());var P,F,V,G;if(L&&r7(E),R?v3(E,{stopDynamicCine:!L,viewportId:D.id}):(R={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:(P=u.frameTimeVector)!==null&&P!==void 0?P:void 0,speed:(F=u.frameTimeVectorSpeedMultiplier)!==null&&F!==void 0?F:1,reverse:(V=u.reverse)!==null&&V!==void 0&&V,loop:(G=u.loop)===null||G===void 0||G},Q9(E,R)),R.dynamicCineEnabled=u.dynamicCineEnabled,(u.framesPerSecond<0||u.framesPerSecond>0)&&(R.framesPerSecond=Number(u.framesPerSecond),R.reverse=R.framesPerSecond<0,R.ignoreFrameTimeVector=!0),R.ignoreFrameTimeVector!==!0&&R.frameTimeVector&&R.frameTimeVector.length===N.numScrollSteps&&N.frameTimeVectorEnabled){const{timeouts:Y,isTimeVarying:Z}=function(ne,oe){let ue,ge,me,xe=0;const Ee=ne.length,Ie=[];let be=!1;for((typeof oe!="number"||oe<=0)&&(oe=1),ue=1;ue<Ee;ue++)me=Number(ne[ue])/oe|0,Ie.push(me),ue===1?ge=me:me!==ge&&(be=!0),xe+=me;return Ie.length>0&&(me=be?xe/Ie.length|0:Ie[0],Ie.push(me)),{timeouts:Ie,isTimeVarying:be}}(R.frameTimeVector,R.speed);m=Y,v=Z}const W=()=>{const{numScrollSteps:Y,currentStepIndex:Z}=N;let ne=Z+(R.reverse?-1:1);const oe=ne<0||ne>=Y;if(!R.loop&&oe){v3(E,{stopDynamicCine:!L,viewportId:D.id});const ge={element:E};return void p3(E,d1.CLIP_STOPPED,ge)}ne>=Y?ne=0:ne<0&&(ne=Y-1);const ue=ne-Z;if(ue)try{N.scroll(ue)}catch(ge){return console.warn("Play clip not scrolling",ge),i7(R),void p3(E,d1.CLIP_STOPPED,q)}};L&&m3.set(O.volumeId,E),N.play?R.framesPerSecond=N.play(u.framesPerSecond):m&&m.length>0&&v?(R.usingFrameTimeVector=!0,R.intervalId=window.setTimeout(function Y(){R.intervalId=window.setTimeout(Y,m[N.currentStepIndex]),W()},0)):(R.usingFrameTimeVector=!1,R.intervalId=window.setInterval(W,1e3/Math.abs(R.framesPerSecond)));const q={element:E};p3(E,d1.CLIP_STARTED,q)}function n7(E){v3(E,{stopDynamicCine:!0,...arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}})}function v3(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{stopDynamicCine:!0,viewportId:void 0};const{stopDynamicCine:g,viewportId:m}=u,v=(0,j.getEnabledElement)(E);let S;const D=v==null?void 0:v.viewport;if(v){const{viewport:O}=v;S=g3(O.element)}else{if(!m)return;S=function(O){return h3[O]}(m)}S&&i7(S),D instanceof j.VideoViewport?D.pause():g&&D instanceof j.BaseVolumeViewport&&r7(E)}function r7(E){const{viewport:u}=(0,j.getEnabledElement)(E),g=y3(u);if(g!=null&&g.isDynamicVolume()){const m=m3.get(g.volumeId);m3.delete(g.volumeId),m&&m!==E&&n7(m)}}function i7(E){const u=E.intervalId;u!==void 0&&(E.intervalId=void 0,E.usingFrameTimeVector?clearTimeout(u):clearInterval(u))}function y3(E){const u=function(m){return m.getActors().map(v=>j.cache.getVolume(v.uid)).filter(v=>!!v)}(E),g=u.find(m=>m.isDynamicVolume());return g??u[0]}function w3(E){var u=E.length-1;return function(g){var m=g<=0?g=0:g>=1?(g=1,u-1):Math.floor(g*u),v=E[m],S=E[m+1],D=m>0?E[m-1]:2*v-S,O=m<u-1?E[m+2]:2*S-v;return function(N,R,L,P,F){var V=N*N,G=V*N;return((1-3*N+3*V-G)*R+(4-6*V+3*G)*L+(1+3*N+3*V-3*G)*P+G*F)/6}((g-m/u)*u,D,v,S,O)}}function zd(E,u){for(var g=new Array(u),m=0;m<u;++m)g[m]=E(m/(u-1));return g}function rH(E){return E.length}function a7(){return function(E){if(!(v=E.length))return[];for(var u=-1,g=function(O,N){let R;if(N===void 0)for(const L of O)L!=null&&(R>L||R===void 0&&L>=L)&&(R=L);else{let L=-1;for(let P of O)(P=N(P,++L,O))!=null&&(R>P||R===void 0&&P>=P)&&(R=P)}return R}(E,rH),m=new Array(g);++u<g;)for(var v,S=-1,D=m[u]=new Array(v);++S<v;)D[S]=E[S][u];return m}(arguments)}function o7(E,u,g,m){var v,S;const D=g-u+1,O=(v=Math.floor(m/100*D))!==null&&v!==void 0?v:1,N=(S=Math.floor(D/O))!==null&&S!==void 0?S:1;if(isNaN(D)||!D||!N||D/N<2)return E;const R=Math.max(0,u),L=Math.min(E.length-1,g),P=E.slice(0,R),F=E.slice(L+1,E.length);return[...P,...function(V,G){if(!G||G.length===0||G.length===V.length)return V;const W=G[G.length-1]-G[0]+1,q=w3(G.map(ne=>V[ne][0])),Y=w3(G.map(ne=>V[ne][1]));if(((Z=V[0])===null||Z===void 0?void 0:Z.length)===3){const ne=w3(G.map(oe=>V[oe][2]));return a7(zd(q,W),zd(Y,W),zd(ne,W))}return a7(zd(q,W),zd(Y,W));var Z}(E,function(V,G){const W=[],[q,Y]=G,Z=Y-q+1,ne=Math.floor(Z/V);let oe=0,ue=Math.round((Z-1)/(ne-1)*oe)+q;for(;ue<=Y;)W.push(ue),oe++,ue=Math.round((Z-1)/(ne-1)*oe)+q;return W}(N,[R,L])),...F]}function s7(E,u,g){if(function(D,O,N){var R;if(O==null||(R=O.data)===null||R===void 0||!R.polyline||N<=0||!D.viewport)return!0;const{renderingEngineId:L,viewportId:P,FrameOfReferenceUID:F}=D,V=nr(P,L);if(O.metadata.FrameOfReferenceUID!==F||!V)return!0;const G=V.getToolInstance(O.metadata.toolName);return!(G instanceof R3)||G.isDrawing||G.isEditingOpen||G.isEditingClosed}(E,u,g))return!1;const{viewport:m}=E,v=u.data.contour.polyline.map(m.worldToCanvas),S=o7(v,0,v.length,g);return S!==v&&(u.data.contour.polyline=S.map(m.canvasToWorld),!0)}const iH={smoothAnnotation:s7},{isEqual:h1}=j.utilities,l7=[le.vec3.fromValues(1,0,0),le.vec3.fromValues(0,1,0),le.vec3.fromValues(0,0,1)];function c7(E){const u=le.vec3.subtract(le.vec3.create(),E[0],E[1]),g=le.vec3.subtract(le.vec3.create(),E[0],E[2]);return[...u7(u,l7),...u7(g,l7)].every(m=>h1(m,0)||h1(m,90)||h1(m,180)||h1(m,270))}function u7(E,u){return u.map(g=>180*le.vec3.angle(E,g)/Math.PI)}const f7={};function d7(E,u){const g=(0,j.getEnabledElement)(E),{viewportId:m}=g;f7[m]=u}function C0(E){const u=(0,j.getEnabledElement)(E),{viewportId:g}=u;return f7[g]}const Fc=j.Enums.RequestType.Prefetch,h7=0;function aH(E,u){E=Math.round(E)||0;const g=[];let m=(u=Math.round(u)||0)-E+1;if(m<=0)return g;for(;m--;)g[m]=u--;return g}function x0(E){const u=(0,j.getEnabledElement)(E);if(!u)return null;const{viewport:g}=u;return g instanceof j.StackViewport?{currentImageIdIndex:g.getCurrentImageIdIndex(),imageIds:g.getImageIds()}:null}function g1(E){return function(u){const g=u.detail;let m;try{m=x0(E)}catch{return}if(!m||!m.imageIds||m.imageIds.length===0)return;const v=m.imageIds.indexOf(g.imageId);if(v<0)return;const S=C0(E);S&&S.data&&S.data.length&&S.indicesToRequest.push(v)}}const oH=E=>{const u=new Set(E.imageIds);return g=>g.type!==Fc||!u.has(g.additionalDetails.imageId)};let C3,Wd={maxImagesToPrefetch:1/0,preserveExistingPool:!0};function g7(E){var u,g;const m=C0(E);if(!m)return;const v=m||{},S=x0(E);if(S==null||(u=S.imageIds)===null||u===void 0||!u.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:D}=S;if(v.enabled&&(v.enabled=(g=v.indicesToRequest)===null||g===void 0?void 0:g.length),v.enabled===!1||(m.indicesToRequest.sort((Y,Z)=>Y-Z),v.indicesToRequest.slice().forEach(function(Y){const Z=S.imageIds[Y];Z&&(Math.abs(D-Y)<6?j.cache.getImageLoadObject(Z):j.cache.isLoaded(Z))&&function(ne){const oe=v.indicesToRequest.indexOf(ne);oe>-1&&v.indicesToRequest.splice(oe,1)}(Y)}),!v.indicesToRequest.length))return;Wd.preserveExistingPool||j.imageLoadPoolManager.clearRequestStack(Fc);const O=function(Y,Z){let ne=0,oe=Y.length-1;return Y.forEach((ue,ge)=>{ue<Z?ne=Math.max(ge,ne):ue>Z&&(oe=Math.min(ge,oe))}),{low:ne,high:oe}}(v.indicesToRequest,S.currentImageIdIndex);let N,R,L=O.low,P=O.high;const F=[];for(;L>=0||P<v.indicesToRequest.length;){const Y=S.currentImageIdIndex,Z=!(Y-v.indicesToRequest[L]>Wd.maxImagesToPrefetch)&&L>=0,ne=!(v.indicesToRequest[P]-Y>Wd.maxImagesToPrefetch)&&P<v.indicesToRequest.length;if(!ne&&!Z)break;Z&&(R=v.indicesToRequest[L--],N=S.imageIds[R],F.push(N)),ne&&(R=v.indicesToRequest[P++],N=S.imageIds[R],F.push(N))}const V=(Y,Z)=>j.imageLoader.loadAndCacheImage(Y,Z),{useNorm16Texture:G,preferSizeOverAccuracy:W}=(0,j.getConfiguration)().rendering,q=G||W;F.forEach(Y=>{const Z={targetBuffer:{type:q?void 0:"Float32Array"},preScale:{enabled:!0},useNativeDataType:q,requestType:Fc};j.imageLoadPoolManager.addRequest(V.bind(null,Y,Z),Fc,{imageId:Y},h7)})}function x3(E){clearTimeout(C3),C3=setTimeout(function(){const u=E.target;try{g7(u)}catch{return}},10)}const sH={enable:function(E){const u=x0(E);if(!u||!u.imageIds||u.imageIds.length===0)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const g={indicesToRequest:aH(0,u.imageIds.length-1),enabled:!0,direction:1},m=g.indicesToRequest.indexOf(u.currentImageIdIndex);g.indicesToRequest.splice(m,1),d7(E,g),g7(E),E.removeEventListener(j.Enums.Events.STACK_NEW_IMAGE,x3),E.addEventListener(j.Enums.Events.STACK_NEW_IMAGE,x3);const v=g1(E);j.eventTarget.removeEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,v),j.eventTarget.addEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,v)},disable:function(E){clearTimeout(C3),E.removeEventListener(j.Enums.Events.STACK_NEW_IMAGE,x3);const u=g1(E);j.eventTarget.removeEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,u);const g=C0(E);g&&g.indicesToRequest.length&&(g.enabled=!1,j.imageLoadPoolManager.clearRequestStack(Fc))},getConfiguration:function(){return Wd},setConfiguration:function(E){Wd=E}};let S3,jd={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1};function E3(E){var u,g;const m=x0(E);if(!m)return;if(m==null||(u=m.imageIds)===null||u===void 0||!u.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const v=C0(E);if(!v)return;const S=v||{};if(S.enabled&&(S.enabled=(g=S.indicesToRequest)===null||g===void 0?void 0:g.length),S.enabled===!1)return;function D(V){const G=S.indicesToRequest.indexOf(V);G>-1&&S.indicesToRequest.splice(G,1)}const O=S.indicesToRequest.slice(),{currentImageIdIndex:N}=m;if(O.forEach(V=>{const G=m.imageIds[V];G&&(Math.abs(N-V)<6?j.cache.getImageLoadObject(G):j.cache.isLoaded(G))&&D(V)}),!S.indicesToRequest.length)return;jd.preserveExistingPool||j.imageLoadPoolManager.filterRequests(oH(m));const R=(V,G)=>j.imageLoader.loadAndCacheImage(V,G).then(()=>function(W){var q;D(m.imageIds.indexOf(W));const Y=j.cache.getCachedImageBasedOnImageURI(W),{stats:Z}=S,ne=(Y==null||(q=Y.image)===null||q===void 0?void 0:q.decodeTimeInMS)||0;if(ne){var oe;Z.imageIds.set(W,ne),Z.decodeTimeInMS+=ne;const ue=(Y==null||(oe=Y.image)===null||oe===void 0?void 0:oe.loadTimeInMS)||0;Z.loadTimeInMS+=ue}if(!S.indicesToRequest.length&&Y!=null&&Y.sizeInBytes){const{sizeInBytes:ue}=Y,ge=j.cache.getMaxCacheSize()/4/ue;if(S.cacheFill){if(Z.imageIds.size){Z.fillTime=Date.now()-Z.start;const{size:me}=Z.imageIds;Z.fillSize=me,console.log("Done cache fill",Z.fillTime,"ms",me,"items","average total time",cn(Z.fillTime/me),"ms","average load",cn(Z.loadTimeInMS/me),"ms","average decode",cn(Z.decodeTimeInMS/me),"ms")}}else Z.initialTime=Date.now()-Z.start,Z.initialSize=Z.imageIds.size,_3(E,ge),E3(E)}}(V)),{useNorm16Texture:L,preferSizeOverAccuracy:P}=(0,j.getConfiguration)().rendering,F=L||P;S.indicesToRequest.forEach(V=>{const G=m.imageIds[V],W={targetBuffer:{type:F?void 0:"Float32Array"},preScale:{enabled:!0},useNativeDataType:F,requestType:Fc};j.imageLoadPoolManager.addRequest(R.bind(null,G,W),Fc,{imageId:G},h7)})}function T3(E){clearTimeout(S3),S3=setTimeout(function(){const u=E.target;try{_3(u),E3(u)}catch{return}},5)}const _3=(E,u)=>{var g;const m=x0(E);if(!m)return;if((g=m.imageIds)===null||g===void 0||!g.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:v}=m;let{maxAfter:S=2,minBefore:D=2}=jd;const{directionExtraImages:O=10}=jd,N=C0(E)||{indicesToRequest:[],currentImageIdIndex:v,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},R=v-N.currentImageIdIndex;if(N.direction=R<0?-1:1,N.currentImageIdIndex=v,N.enabled=!0,N.stackCount<100&&(N.stackCount+=O),Math.abs(R)>S||!R)if(N.stackCount=0,u){const V=v/m.imageIds.length;D=Math.ceil(u*V),S=Math.ceil(u*(1-V)),N.cacheFill=!0}else N.cacheFill=!1;else R<0?(D+=N.stackCount,S=0):(S+=N.stackCount,D=0);const L=Math.max(0,v-D),P=Math.min(m.imageIds.length-1,v+S),F=[];for(let V=v+1;V<=P;V++)F.push(V);for(let V=v-1;V>=L;V--)F.push(V);N.indicesToRequest=F,d7(E,N)},lH={enable:E=>{var u;const g=x0(E);if(!g)return;if((u=g.imageIds)===null||u===void 0||!u.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");_3(E),E3(E),E.removeEventListener(j.Enums.Events.STACK_NEW_IMAGE,T3),E.addEventListener(j.Enums.Events.STACK_NEW_IMAGE,T3);const m=g1(E);j.eventTarget.removeEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,m),j.eventTarget.addEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,m)},disable:function(E){clearTimeout(S3),E.removeEventListener(j.Enums.Events.STACK_NEW_IMAGE,T3);const u=g1(E);j.eventTarget.removeEventListener(j.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,u);const g=C0(E);g&&(g.enabled=!1)},getConfiguration:function(){return jd},setConfiguration:function(E){jd=E}};function p7(E,u){if(!(E instanceof j.VolumeViewport))return;const{focalPoint:g}=E.getCamera(),m=[0,0,0];return le.vec3.sub(m,u,g),function(v,S){const D=v.getCamera(),O=D.viewPlaneNormal,N=le.vec3.dot(S,O),R=le.vec3.fromValues(O[0],O[1],O[2]);if(le.vec3.scale(R,R,N),Math.abs(R[0])>.001||Math.abs(R[1])>.001||Math.abs(R[2])>.001){const L=[0,0,0],P=[0,0,0];le.vec3.add(L,D.focalPoint,R),le.vec3.add(P,D.position,R),v.setCamera({focalPoint:L,position:P}),v.render()}}(E,m),!0}const cH=function(E,u){const g=u.frameNumbers||[...Array(E.numTimePoints).keys()];if(!u.maskVolumeId&&!u.imageCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(u.maskVolumeId&&u.imageCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(u.maskVolumeId){const m=j.cache.getVolume(u.maskVolumeId),[v,S]=function(D,O,N){const{imageData:R}=N,L=N.getScalarData(),P=L.length,F=[];F.length=P;const V=[],G=N.dimensions;let W=0;for(let Z=0,ne=L.length;Z<ne;Z++)L[Z]!==0&&(V.push([Z%G[0],Math.floor(Z/G[0]%G[1]),Math.floor(Z/(G[0]*G[1]))]),F[W++]=Z);F.length=W;const q=O.getScalarDataArrays(),Y=[];if(q[0].length===P&&JSON.stringify(O.spacing)===JSON.stringify(N.spacing)){for(let Z=0;Z<F.length;Z++){const ne=[];D.forEach(oe=>{const ue=q[oe];ne.push(ue[F[Z]])}),Y.push(ne)}return[Y,V]}return Ii(R,()=>!0,Z=>{let{pointLPS:ne,value:oe,pointIJK:ue}=Z;if(oe===0)return;const ge=X5(O.imageData,O.dimensions,O.spacing,ne);let me=0;const xe=new Map;D.forEach(Ie=>xe.set(Ie,0)),Ii(O.imageData,()=>!0,Ie=>{let{index:be}=Ie;for(let Ne=0;Ne<D.length;Ne++){const _e=q[Ne][be],Me=D[Ne];xe.set(Me,xe.get(Me)+_e)}me++},ge);const Ee=[];xe.forEach(Ie=>{Ee.push(Ie/me)}),V.push(ue),Y.push(Ee)}),[Y,V]}(g,E,m);return[v,S]}if(u.imageCoordinate)return function(v,S,D){const{dimensions:O,imageData:N}=D,R=N.worldToIndex(S);if(R[0]=Math.floor(R[0]),R[1]=Math.floor(R[1]),R[2]=Math.floor(R[2]),!j.utilities.indexWithinDimensions(R,O))throw new Error("outside bounds");const L=O[0],P=O[0]*O[1],F=D.getScalarDataArrays(),V=[];return v.forEach(G=>{const W=F[G],q=R[2]*P+R[1]*L+R[0];V.push(W[q])}),V}(g,u.imageCoordinate,E)},uH=function(E,u,g){const m=g||[...Array(E.numTimePoints).keys()],v=m.length;if(m.length<=1)throw new Error("Please provide two or more time points");const S=E.getScalarDataArrays(),D=S[0].length,O=new Float32Array(D);if(u===j.Enums.DynamicOperatorType.SUM){for(let N=0;N<v;N++){const R=S[m[N]];for(let L=0;L<D;L++)O[L]+=R[L]}return O}if(u===j.Enums.DynamicOperatorType.SUBTRACT){if(m.length>2)throw new Error("Please provide only 2 time points for subtraction.");for(let N=0;N<D;N++)O[N]+=S[m[0]][N]-S[m[1]][N];return O}if(u===j.Enums.DynamicOperatorType.AVERAGE){for(let N=0;N<v;N++){const R=S[m[N]];for(let L=0;L<D;L++)O[L]+=R[L]}for(let N=0;N<D;N++)O[N]=O[N]/v;return O}};function m7(E,u){const g=3*u;if(g<E.length)return le.vec3.fromValues(E[g],E[g+1],E[g+2])}function v7(E){const u=E.getLines().getData();let g=0;const m=new Map;for(;g<u.length;){const O=u[g++],N=[];for(let R=0;R<O;R++)N.push(u[g+R]);m.set(N[0],N),g+=O}const v=[],S=O=>{for(const[N,R]of O.entries())if(R!==void 0)return N;return-1};let D=S(m);for(;D!==-1;){const O=[D];for(;m.has(D);){const N=m.get(D)[1];m.has(N)&&O.push(N),m.delete(D),D=N}v.push(O),D=S(m)}return v.length?v:void 0}function y7(E){const u=v7(E);if(!u)return;const g=E.getPoints().getData();return u.map(m=>m.map(v=>m7(g,v)))}let Co=function(E){return E.Top="top",E.Left="left",E.Bottom="bottom",E.Right="right",E}({});const Os=E=>E&&E.upper>E.lower,Hd=(E,u)=>!!E&&!!u&&E.lower===u.lower&&E.upper===u.upper,p1=E=>!!E&&E.width>0&&E.height>0,w7=(E,u)=>!!E&&!!u&&E.width===u.width&&E.height===u.height,{clamp:fH}=j.utilities;class D3{constructor(u){$(this,"_canvas",void 0),$(this,"_imageRange",void 0),$(this,"_voiRange",void 0),$(this,"_colormap",void 0),$(this,"_showFullImageRange",void 0),D3.validateProps(u);const{colormap:g,size:m={width:20,height:100},imageRange:v={lower:0,upper:1},voiRange:S={lower:0,upper:1},container:D,showFullPixelValueRange:O=!1}=u;this._colormap=g,this._imageRange=v,this._voiRange=S,this._showFullImageRange=O,this._canvas=this._createRootElement(m),D&&this.appendTo(D)}get colormap(){return this._colormap}set colormap(u){this._colormap=u,this.render()}get size(){const{width:u,height:g}=this._canvas;return{width:u,height:g}}set size(u){const{_canvas:g}=this;p1(u)&&!w7(g,u)&&(this._setCanvasSize(g,u),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(u){Os(u)&&!Hd(u,this._imageRange)&&(this._imageRange=u,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(u){Os(u)&&!Hd(u,this._voiRange)&&(this._voiRange=u,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(u){u!==this._showFullImageRange&&(this._showFullImageRange=u,this.render())}appendTo(u){u.appendChild(this._canvas),this.render()}dispose(){const{_canvas:u}=this,{parentElement:g}=u;g==null||g.removeChild(u)}static validateProps(u){const{size:g,imageRange:m,voiRange:v}=u;if(g&&!p1(g))throw new Error('Invalid "size"');if(m&&!Os(m))throw new Error('Invalid "imageRange"');if(v&&!Os(v))throw new Error('Invalid "voiRange"')}_setCanvasSize(u,g){const{width:m,height:v}=g;u.width=m,u.height=v,Object.assign(u.style,{width:"".concat(m,"px"),height:"".concat(v,"px")})}_createRootElement(u){const g=document.createElement("canvas");return Object.assign(g.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(g,u),g}render(){if(!this._canvas.isConnected)return;const{_colormap:u}=this,{RGBPoints:g}=u,m=g.length/4,v=oe=>{const ue=4*oe;if(!(oe<0||oe>=m))return{index:oe,position:g[ue],color:[g[ue+1],g[ue+2],g[ue+3]]}},{width:S,height:D}=this._canvas,O=this._canvas.getContext("2d"),N=S>D,R=N?S:D,{_voiRange:L}=this,P=this._showFullImageRange?this._imageRange:{...L},{windowWidth:F}=j.utilities.windowLevel.toWindowLevel(L.lower,L.upper);let V,G=v(0);const W=(P.upper-P.lower)/(R-1);let q=P.lower;for(let oe=0;oe<R;oe++){const ue=(q-L.lower)/F;if(G)for(let xe=G.index;xe<m&&!(ue<=G.position);xe++)V=G,G=v(xe+1);let ge;if(V)if(G){const xe=(ue-V.position)/(G.position-V.position);Y=V.color,Z=G.color,ne=xe,ge=[Y[0]*(1-ne)+Z[0]*ne,Y[1]*(1-ne)+Z[1]*ne,Y[2]*(1-ne)+Z[2]*ne]}else ge=[...V.color];else ge=[...G.color];const me=ge.map(xe=>fH(Math.round(255*xe),0,255));O.fillStyle="rgb(".concat(me[0],", ").concat(me[1],", ").concat(me[2],")"),N?O.fillRect(oe,0,1,D):O.fillRect(0,D-oe-1,S,1),q+=W}var Y,Z,ne}}const Vc={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class b3{constructor(u){var g,m,v,S,D,O;$(this,"_canvas",void 0),$(this,"_imageRange",void 0),$(this,"_voiRange",void 0),$(this,"_color",void 0),$(this,"_tickSize",void 0),$(this,"_tickWidth",void 0),$(this,"_labelMargin",void 0),$(this,"_maxNumTicks",void 0),$(this,"_rangeTextPosition",void 0),$(this,"_showFullPixelValueRange",void 0),$(this,"_font",void 0),b3.validateProps(u);const{top:N=0,left:R=0,size:L={width:20,height:100},imageRange:P={lower:0,upper:1},voiRange:F={lower:0,upper:1},ticks:V,container:G,showFullPixelValueRange:W=!1}=u,{style:q,position:Y}=V??{};this._imageRange=P,this._voiRange=F,this._font=(g=q==null?void 0:q.font)!==null&&g!==void 0?g:Vc.FONT,this._color=(m=q==null?void 0:q.color)!==null&&m!==void 0?m:Vc.COLOR,this._tickSize=(v=q==null?void 0:q.tickSize)!==null&&v!==void 0?v:Vc.TICK_SIZE,this._tickWidth=(S=q==null?void 0:q.tickWidth)!==null&&S!==void 0?S:Vc.TICK_WIDTH,this._labelMargin=(D=q==null?void 0:q.labelMargin)!==null&&D!==void 0?D:Vc.TICK_LABEL_MARGIN,this._maxNumTicks=(O=q==null?void 0:q.maxNumTicks)!==null&&O!==void 0?O:Vc.MAX_NUM_TICKS,this._rangeTextPosition=Y??Co.Right,this._showFullPixelValueRange=W,this._canvas=this._createCanvasElement(L,N,R),G&&this.appendTo(G)}get size(){const{width:u,height:g}=this._canvas;return{width:u,height:g}}set size(u){const{_canvas:g}=this;p1(u)&&!w7(g,u)&&(this._setCanvasSize(g,u),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(u){const{_canvas:g}=this;u!==this.top&&(g.style.top="".concat(u,"px"),this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(u){const{_canvas:g}=this;u!==this.left&&(g.style.left="".concat(u,"px"),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(u){Os(u)&&!Hd(u,this._imageRange)&&(this._imageRange=u,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(u){Os(u)&&!Hd(u,this._voiRange)&&(this._voiRange=u,this.render())}get tickSize(){return this._tickSize}set tickSize(u){u!==this._tickSize&&(this._tickSize=u,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(u){u!==this._tickWidth&&(this._tickWidth=u,this.render())}get color(){return this._color}set color(u){u!==this._color&&(this._color=u,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(u){u!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=u,this.render())}get visible(){return this._canvas.style.display==="block"}set visible(u){u!==this.visible&&(this._canvas.style.display=u?"block":"none",u&&this.render())}appendTo(u){u.appendChild(this._canvas),this.render()}static validateProps(u){const{size:g,imageRange:m,voiRange:v}=u;if(g&&!p1(g))throw new Error('Invalid "size"');if(m&&!Os(m))throw new Error('Invalid "imageRange"');if(v&&!Os(v))throw new Error('Invalid "voiRange"')}_setCanvasSize(u,g){const{width:m,height:v}=g;u.width=m,u.height=v,Object.assign(u.style,{width:"".concat(m,"px"),height:"".concat(v,"px")})}_createCanvasElement(u,g,m){const v=document.createElement("canvas");return Object.assign(v.style,{display:"none",position:"absolute",boxSizing:"border-box",top:"".concat(g,"px"),left:"".concat(m,"px")}),this._setCanvasSize(v,u),v}_getTicks(u){const{lower:g,upper:m}=u,v=(m-g)/(this._maxNumTicks-1),S=Math.pow(10,-Math.floor(Math.log10(Math.abs(v)))),D=v*S,O=Vc.TICKS_STEPS.find(F=>F>=D)/S,N=Math.ceil(m/O)*O,R=Math.floor(g/O)*O,L=Math.round((N-R)/O)+1,P=[];for(let F=0;F<L;F++)P.push(R+F*O);return{scaleMin:R,scaleMax:N,step:O,ticks:P}}_getLeftTickInfo(u){let{position:g,labelMeasure:m}=u;const{width:v}=this._canvas;return{labelPoint:[v-this.tickSize-m.width-this._labelMargin,g],tickPoints:{start:[v-this._tickSize,g],end:[v,g]}}}_getRightTickInfo(u){let{position:g}=u;return{labelPoint:[this._tickSize+this._labelMargin,g],tickPoints:{start:[0,g],end:[this._tickSize,g]}}}_getTopTickInfo(u){throw new Error("Not implemented")}_getBottomTickInfo(u){throw new Error("Not implemented")}render(){const{_canvas:u}=this;if(!u.isConnected||!this.visible)return;const{width:g,height:m}=u,v=g>=m,S=v?g:m,D=u.getContext("2d"),{_voiRange:O}=this,N=this._showFullPixelValueRange?this._imageRange:{...O},R=N.upper-N.lower,{ticks:L}=this._getTicks(N);D.clearRect(0,0,g,m),D.font=this._font,D.textBaseline="middle",D.fillStyle=this._color,D.strokeStyle=this._color,D.lineWidth=this.tickWidth,L.forEach(P=>{let F=Math.round(S*((P-N.lower)/R));if(v||(F=m-F),F<0||F>S)return;const V=P.toString(),G=D.measureText(V);let W;W=v?this._rangeTextPosition===Co.Top?this._getTopTickInfo({position:F,labelMeasure:G}):this._getBottomTickInfo({position:F,labelMeasure:G}):this._rangeTextPosition===Co.Left?this._getLeftTickInfo({position:F,labelMeasure:G}):this._getRightTickInfo({position:F});const{labelPoint:q,tickPoints:Y}=W,{start:Z,end:ne}=Y;return D.beginPath(),D.moveTo(Z[0],Z[1]),D.lineTo(ne[0],ne[1]),D.fillText(V,q[0],q[1]),D.stroke(),F})}}class dH{constructor(u){let{id:g,container:m}=u;$(this,"_id",void 0),$(this,"_rootElement",void 0),$(this,"_containerSize",void 0),$(this,"_containerResizeObserver",void 0),$(this,"_containerResizeCallback",v=>{let S,D;const{contentRect:O,contentBoxSize:N}=v[0];O?(S=O.width,D=O.height):N!=null&&N.length&&(S=N[0].inlineSize,D=N[0].blockSize),this._containerSize={width:S,height:D},this.onContainerResize()}),this._id=g,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(g),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),m&&this.appendTo(m)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(u){const{_rootElement:g,_containerResizeObserver:m}=this,{parentElement:v}=g;u&&u!==v&&(v&&m.unobserve(v),u.appendChild(g),m.observe(u))}destroy(){const{_rootElement:u,_containerResizeObserver:g}=this,{parentElement:m}=u;m==null||m.removeChild(u),g.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(u){const g=document.createElement("div");return g.id=u,g.classList.add("widget"),Object.assign(g.style,{width:"100%",height:"100%"}),g}onContainerResize(){}}const $d={MULTIPLIER:1,RANGE_TEXT_POSITION:Co.Right,TICKS_BAR_SIZE:50};class Kd extends dH{constructor(u){var g,m;super(u),$(this,"_colormaps",void 0),$(this,"_activeColormapName",void 0),$(this,"_eventListenersManager",void 0),$(this,"_canvas",void 0),$(this,"_ticksBar",void 0),$(this,"_rangeTextPosition",void 0),$(this,"_isMouseOver",!1),$(this,"_isInteracting",!1),$(this,"_mouseOverCallback",v=>{this._isMouseOver=!0,this.showTicks(),v.stopPropagation()}),$(this,"_mouseOutCallback",v=>{this._isMouseOver=!1,this.hideTicks(),v.stopPropagation()}),$(this,"_mouseDownCallback",v=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(v),v.stopPropagation()}),$(this,"_mouseDragCallback",(v,S)=>{const D=this.getVOIMultipliers(),O=this._getPointsFromMouseEvent(v),{points:N,voiRange:R}=S,L=le.vec2.sub(le.vec2.create(),O.local,N.local),P=L[0]*D[0],F=L[1]*D[1];if(!P&&!F)return;const{lower:V,upper:G}=R;let{windowWidth:W,windowCenter:q}=j.utilities.windowLevel.toWindowLevel(V,G);W=Math.max(W+P,1),q+=F;const Y=j.utilities.windowLevel.toLowHighRange(W,q);this.voiRange=Y,v.stopPropagation(),v.preventDefault()}),$(this,"_mouseUpCallback",v=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),v.stopPropagation()}),this._eventListenersManager=new j.utilities.eventListener.MultiTargetEventListenerManager,this._colormaps=Kd.getColormapsMap(u),this._activeColormapName=Kd.getInitialColormapName(u),this._canvas=this._createCanvas(u),this._ticksBar=this._createTicksBar(u),this._rangeTextPosition=(g=(m=u.ticks)===null||m===void 0?void 0:m.position)!==null&&g!==void 0?g:$d.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(u){if(u===this._activeColormapName)return;const g=this._colormaps.get(u);g?(this._activeColormapName=u,this._canvas.colormap=g):console.warn("Invalid colormap name (".concat(u,")"))}get imageRange(){return this._canvas.imageRange}set imageRange(u){this._canvas.imageRange=u,this._ticksBar.imageRange=u}get voiRange(){return this._canvas.voiRange}set voiRange(u){const{voiRange:g}=this._canvas;Os(u)&&!Hd(u,g)&&(this._canvas.voiRange=u,this._ticksBar.voiRange=u,this.onVoiChange(u))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(u){this._canvas.showFullImageRange=u,this._ticksBar.showFullPixelValueRange=u}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const u=document.createElement("div");return Object.assign(u.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),u}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[$d.MULTIPLIER,$d.MULTIPLIER]}onVoiChange(u){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(u){const{colormaps:g}=u;return g.reduce((m,v)=>m.set(v.Name,v),new Map)}static getInitialColormapName(u){const{activeColormapName:g,colormaps:m}=u;return g&&m.some(v=>v.Name===g)?g:m[0].Name}_createCanvas(u){const{imageRange:g,voiRange:m,showFullPixelValueRange:v}=u,S=this._colormaps.get(this._activeColormapName);return new D3({colormap:S,imageRange:g,voiRange:m,showFullPixelValueRange:v})}_createTicksBar(u){const g=u.ticks;return new b3({imageRange:u.imageRange,voiRange:u.voiRange,ticks:g,showFullPixelValueRange:u.showFullPixelValueRange})}_getPointsFromMouseEvent(u){const{rootElement:g}=this,m=[u.clientX,u.clientY],v=[u.pageX,u.pageY],S=g.getBoundingClientRect();return{client:m,page:v,local:[v[0]-S.left-window.pageXOffset,v[1]-S.top-window.pageYOffset]}}updateTicksBar(){const{width:u,height:g}=this.containerSize;if(u===0&&g===0)return;const{_ticksBar:m,_rangeTextPosition:v}=this,S=u>=g,D=S?u:$d.TICKS_BAR_SIZE,O=S?$d.TICKS_BAR_SIZE:g;if(!function(L,P,F){return(L>=P?[Co.Top,Co.Bottom]:[Co.Left,Co.Right]).includes(F)}(u,g,v))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let N,R;m.size={width:D,height:O},S?(R=0,N=v===Co.Top?-O:g):(N=0,R=v===Co.Left?-D:u),m.top=N,m.left=R}_addRootElementEventListeners(){const{_eventListenersManager:u}=this,{rootElement:g}=this;u.addEventListener(g,"mouseover",this._mouseOverCallback),u.addEventListener(g,"mouseout",this._mouseOutCallback),u.addEventListener(g,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(u){const{_eventListenersManager:g}=this,m={points:this._getPointsFromMouseEvent(u),voiRange:{...this._canvas.voiRange}};this._removeVOIEventListeners(),g.addEventListener(document,"voi.mouseup",this._mouseUpCallback),g.addEventListener(document,"voi.mousemove",v=>this._mouseDragCallback(v,m))}_removeVOIEventListeners(){const{_eventListenersManager:u}=this;u.removeEventListener(document,"voi.mouseup"),u.removeEventListener(document,"voi.mousemove")}}const{Events:m1}=j.Enums,v1={lower:-1e3,upper:1e3};class S0 extends Kd{constructor(u){const{element:g,volumeId:m}=u,v=S0._getImageRange(g,m),S=S0._getVOIRange(g,m);super({...u,imageRange:v,voiRange:S}),$(this,"_element",void 0),$(this,"_volumeId",void 0),$(this,"_hideTicksTime",void 0),$(this,"_hideTicksTimeoutId",void 0),$(this,"autoHideTicks",()=>{if(this._hideTicksTimeoutId)return;const D=this._hideTicksTime-Date.now();D<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},D)}),$(this,"_stackNewImageCallback",()=>{this.imageRange=S0._getImageRange(this._element)}),$(this,"_imageVolumeModifiedCallback",D=>{const{volumeId:O}=D.detail.imageVolume;if(O!==this._volumeId)return;const{_element:N}=this;this.imageRange=S0._getImageRange(N,O)}),$(this,"_viewportVOIModifiedCallback",D=>{const{viewportId:O,volumeId:N,range:R,colormap:L}=D.detail,{viewport:P}=this.enabledElement;O===P.id&&N===this._volumeId&&(this.voiRange=R,L&&(this.activeColormapName=L.name),this.showAndAutoHideTicks())}),$(this,"_viewportColormapModifiedCallback",D=>{const{viewportId:O,colormap:N,volumeId:R}=D.detail,{viewport:L}=this.enabledElement;O===L.id&&R===this._volumeId&&(this.activeColormapName=N.name)}),this._element=g,this._volumeId=m,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return(0,j.getEnabledElement)(this._element)}getVOIMultipliers(){const{viewport:u}=this.enabledElement;return function(g,m,v){if(j.utilities.getViewportModality(g,m)==="PT"){const{clientWidth:S,clientHeight:D}=g.element,O=5/Math.max(S,D),N=qo(g,m),{fixedPTWindowWidth:R=!0}={},L=R?0:O;return N?[L,O]:[L,4]}return[4,4]}(u,this._volumeId)}onVoiChange(u){super.onVoiChange(u);const{viewport:g}=this.enabledElement;if(g instanceof j.StackViewport)g.setProperties({voiRange:u}),g.render();else if(g instanceof j.VolumeViewport){const{_volumeId:m}=this,v=j.utilities.getViewportsWithVolumeId(m,g.renderingEngineId);g.setProperties({voiRange:u},m),v.forEach(S=>S.render())}}static _getImageRange(u,g){const m=(0,j.getEnabledElement)(u),{viewport:v}=m,S=g?v.getActor(g):v.getDefaultActor();if(!S)return v1;const D=S.actor.getMapper().getInputData().getPointData().getScalars().getRange();return D[0]===0&&D[1]===0?v1:{lower:D[0],upper:D[1]}}static _getVOIRange(u,g){const m=(0,j.getEnabledElement)(u),{viewport:v}=m,S=g?v.getActor(g):v.getDefaultActor();if(!S||!j.utilities.isImageActor(S))return v1;const D=S.actor.getProperty().getRGBTransferFunction(0).getRange();return D[0]===0&&D[1]===0?v1:{lower:D[0],upper:D[1]}}showAndAutoHideTicks(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1e3;this._hideTicksTime=Date.now()+u,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:u}=this;j.eventTarget.addEventListener(m1.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),u.addEventListener(m1.STACK_NEW_IMAGE,this._stackNewImageCallback),u.addEventListener(m1.VOI_MODIFIED,this._viewportVOIModifiedCallback),u.addEventListener(m1.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}function C7(E,u,g,m,v){const S=[];let D=0;const O=E.scalarData;let N,R,L;if(E.color)for(R=0;R<v;R++)for(L=0;L<m;L++){N=4*((R+g)*E.columns+(L+u));const P=O[N],F=O[N+1],V=O[N+2];S[D++]=.2126*P+.7152*F+.0722*V}else for(R=0;R<v;R++)for(L=0;L<m;L++)N=(R+g)*E.columns+(L+u),S[D++]=O[N];return S}function x7(E,u,g){const m=E.length;let v=g,S=u,D=0;if(m<2)return{min:v,max:S,mean:(u+g)/2};for(let O=0;O<m;O++){const N=E[O];v=Math.min(v,N),S=Math.max(S,N),D+=N}return{min:v,max:S,mean:D/m}}function S7(E){if(E instanceof j.VolumeViewport)return function(u){const{scalarData:g,width:m,height:v}=j.utilities.getCurrentVolumeViewportSlice(u),{min:S,max:D}=j.utilities.getMinMax(g),O=u.getVolumeId(),N=j.cache.getVolume(O),{metadata:R,cornerstoneImageMetaData:L}=N,{Rows:P,Columns:F}=R,{color:V}=L;return{scalarData:g,width:m,height:v,minPixelValue:S,maxPixelValue:D,rows:P,columns:F,color:V}}(E);if(E instanceof j.StackViewport)return function(u){const g=u.getImageData(),{scalarData:m}=g,{min:v,max:S}=j.utilities.getMinMax(m),D=g.dimensions[0],O=g.dimensions[1],{rows:N,columns:R,color:L}=u.getCornerstoneImage();return{scalarData:m,width:D,height:O,minPixelValue:v,maxPixelValue:S,rows:N,columns:R,color:L}}(E);throw new Error("Viewport not supported")}const cn=j.utilities.roundNumber;function y1(E,u){var g,m;return(u==null||!u.autoGenerated)&&((E==null||(g=E.smoothing)===null||g===void 0?void 0:g.smoothOnAdd)===!0||(E==null||(m=E.smoothing)===null||m===void 0?void 0:m.smoothOnEdit)===!0)}function E0(E,u,g){return(E+u+g)%u}function E7(E,u,g,m){const[,v,S]=E,[,D,O]=u,N=S.length,R=O.length;let L=E[0],P=u[0];if(!(S[L]&&O[P]&&S[v]&&O[D]))return[void 0,void 0];for(;L!==v&&P!==D;){if(g(O[P],S[L]))return[L,P];L=E0(L,N,m),P=E0(P,R,m)}return[void 0,void 0]}function w1(E,u,g){const{interpolation:m,smoothing:v}=E,S=u;if(m){const{knotsRatioPercentageOnAdd:D,knotsRatioPercentageOnEdit:O,smoothOnAdd:N=!1,smoothOnEdit:R=!1}=v,L=g?O:D;if(g?R:N){const[P,F]=g?function(V,G){const[W,q]=function(ue,ge){for(let me=0;me<ue.length;me++)for(let xe=0;xe<ge.length;xe++)if($a(ue[me],ge[xe])===0)return[me,xe]}(V,G)||[],Y=(ue,ge)=>function(me,xe){return $a(me,xe)<.001}(ue,ge)===!1,[Z,ne]=E7([E0(W,V.length,1),W,V],[E0(q,G.length,1),q,G],Y,1),[oe]=E7([E0(Z,V.length,-1),Z,V],[E0(ne,G.length,-1),ne,G],Y,-1);return[Z,oe]}(u,g):[0,u.length-1];return u[P]&&u[F]?o7(u,P,F,L):u}}return S}var Uc=function(E){return E[E.Primary=1]="Primary",E[E.Secondary=2]="Secondary",E[E.Primary_And_Secondary=3]="Primary_And_Secondary",E[E.Auxiliary=4]="Auxiliary",E[E.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",E[E.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",E[E.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",E[E.Fourth_Button=8]="Fourth_Button",E[E.Fifth_Button=16]="Fifth_Button",E}(Uc||{}),li=function(E){return E[E.Shift=16]="Shift",E[E.Ctrl=17]="Ctrl",E[E.Alt=18]="Alt",E[E.Meta=91]="Meta",E[E.ShiftCtrl=1617]="ShiftCtrl",E[E.ShiftAlt=1618]="ShiftAlt",E[E.ShiftMeta=1691]="ShiftMeta",E[E.CtrlAlt=1718]="CtrlAlt",E[E.CtrlMeta=1791]="CtrlMeta",E[E.AltMeta=1891]="AltMeta",E}(li||{});const T0=E=>E.shiftKey?E.ctrlKey?li.ShiftCtrl:E.altKey?li.ShiftAlt:E.metaKey?li.ShiftMeta:li.Shift:E.ctrlKey?E.altKey?li.CtrlAlt:E.metaKey?li.CtrlMeta:li.Ctrl:E.altKey?E.metaKey&&li.AltMeta||li.Alt:E.metaKey?li.Meta:void 0;function I3(E,u){const g=E[0],m=E[E.length-1],v=le.vec2.create();le.vec2.set(v,m[0]-g[0],m[1]-g[1]),le.vec2.normalize(v,v);const S=le.vec2.create(),D=le.vec2.create();le.vec2.set(S,-v[1],v[0]),le.vec2.set(D,v[1],-v[0]);const O=[(g[0]+m[0])/2,(g[1]+m[1])/2],N={dist:0,index:null};for(let R=0;R<E.length;R++){const L=E[R],P=le.vec2.dist(L,O);P>N.dist&&(N.dist=P,N.index=R)}return[E[N.index],O].map(u.canvasToWorld)}const{addCanvasPointsToArray:O3,pointsAreWithinCloseContourProximity:T7,getFirstLineSegmentIntersectionIndexes:_7,getSubPixelSpacingAndXYDirections:hH}=ae;function gH(E,u,g){this.isDrawing=!0;const m=E.detail,{currentPoints:v,element:S}=m,D=v.canvas,O=(0,j.getEnabledElement)(S),{viewport:N}=O,R=T0(E.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:L,xDir:P,yDir:F}=hH(N,this.configuration.subPixelResolution);this.drawData={canvasPoints:[D],polylineIndex:0,contourHoleProcessingEnabled:R},this.commonData={annotation:u,viewportIdsToRender:g,spacing:L,xDir:P,yDir:F,movingTextBox:!1},Ke.isInteractingWithTool=!0,S.addEventListener(Q.MOUSE_UP,this.mouseUpDrawCallback),S.addEventListener(Q.MOUSE_DRAG,this.mouseDragDrawCallback),S.addEventListener(Q.MOUSE_CLICK,this.mouseUpDrawCallback),S.addEventListener(Q.TOUCH_END,this.mouseUpDrawCallback),S.addEventListener(Q.TOUCH_DRAG,this.mouseDragDrawCallback),S.addEventListener(Q.TOUCH_TAP,this.mouseUpDrawCallback),Wt(S)}function pH(E){Ke.isInteractingWithTool=!1,E.removeEventListener(Q.MOUSE_UP,this.mouseUpDrawCallback),E.removeEventListener(Q.MOUSE_DRAG,this.mouseDragDrawCallback),E.removeEventListener(Q.MOUSE_CLICK,this.mouseUpDrawCallback),E.removeEventListener(Q.TOUCH_END,this.mouseUpDrawCallback),E.removeEventListener(Q.TOUCH_DRAG,this.mouseDragDrawCallback),E.removeEventListener(Q.TOUCH_TAP,this.mouseUpDrawCallback),rn(E)}function mH(E){const u=E.detail,{currentPoints:g,element:m}=u,v=g.world,S=g.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{annotation:R,viewportIdsToRender:L,xDir:P,yDir:F,spacing:V,movingTextBox:G}=this.commonData,{polylineIndex:W,canvasPoints:q}=this.drawData,Y=q[q.length-1],Z=N.canvasToWorld(Y),ne=le.vec3.create();le.vec3.subtract(ne,v,Z);const oe=Math.abs(le.vec3.dot(ne,P)),ue=Math.abs(le.vec3.dot(ne,F));if(!(oe<=V[0]&&ue<=V[1])){if(G){this.isDrawing=!1;const{deltaPoints:ge}=u,me=ge.world,{textBox:xe}=R.data.handles,{worldPosition:Ee}=xe;Ee[0]+=me[0],Ee[1]+=me[1],Ee[2]+=me[2],xe.hasMoved=!0}else{const ge=this.findCrossingIndexDuringCreate(E);if(ge!==void 0)this.applyCreateOnCross(E,ge);else{const me=O3(m,q,S,this.commonData);this.drawData.polylineIndex=W+me}}We(O,L)}}function vH(E){const{allowOpenContours:u}=this.configuration,{canvasPoints:g,contourHoleProcessingEnabled:m}=this.drawData,v=g[0],S=g[g.length-1],D=E.detail,{element:O}=D;u&&!T7(v,S,this.configuration.closeContourProximity)?this.completeDrawOpenContour(O,{contourHoleProcessingEnabled:m}):this.completeDrawClosedContour(O,{contourHoleProcessingEnabled:m})}function yH(E,u){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:g}=this.drawData,{contourHoleProcessingEnabled:m,minPointsToSave:v}=u??{};if(v&&g.length<v||this.haltDrawing(E,g))return!1;const{annotation:S,viewportIdsToRender:D}=this.commonData,O=(0,j.getEnabledElement)(E),{viewport:N,renderingEngine:R}=O;O3(E,g,g[0],this.commonData),g.pop();const L=y1(this.configuration,S)?w1(this.configuration,g):g;this.updateContourPolyline(S,{points:L,closed:!0,targetWindingDirection:p0.Clockwise},N);const{textBox:P}=S.data.handles;return P!=null&&P.hasMoved||ur(S,m),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,We(R,D),this.deactivateDraw(E),!0}function wH(){const{canvasPoints:E}=this.drawData,u=E.length,g=[E[0],E[u-1]],m=E.slice(0,-1).slice(1),v=_7(m,g[0],g[1],!1);if(v){const S=v[1];this.drawData.canvasPoints=S===1?E.splice(1):E.splice(0,S)}}function CH(E,u){const{canvasPoints:g}=this.drawData,{contourHoleProcessingEnabled:m}=u??{};if(this.haltDrawing(E,g))return!1;const{annotation:v,viewportIdsToRender:S}=this.commonData,D=(0,j.getEnabledElement)(E),{viewport:O,renderingEngine:N}=D,R=y1(this.configuration,v)?w1(this.configuration,g):g;this.updateContourPolyline(v,{points:R,closed:!1},O);const{textBox:L}=v.data.handles,P=v.data.contour.polyline;return v.data.handles.points=[P[0],P[P.length-1]],v.data.isOpenUShapeContour&&(v.data.openUShapeContourVectorToPeak=I3(g,O)),L.hasMoved||ur(v,m),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,We(N,S),this.deactivateDraw(E),!0}function xH(E){const u=E.detail,{currentPoints:g,lastPoints:m}=u,v=g.canvas,S=m.canvas,{canvasPoints:D}=this.drawData,O=D.slice(0,-1),N=_7(O,v,S,!1);if(N!==void 0)return N[0]}function SH(E,u){const g=E.detail,{element:m}=g,{canvasPoints:v,contourHoleProcessingEnabled:S}=this.drawData,{annotation:D,viewportIdsToRender:O}=this.commonData;O3(m,v,v[u],this.commonData),v.pop();const N=u1(v.slice(u));if(j.utilities.isEqual(N,0))return void v.splice(u+1);v.splice(0,u);const R={contourHoleProcessingEnabled:S,minPointsToSave:3};this.completeDrawClosedContour(m,R)&&this.activateClosedContourEdit(E,D,O)}function EH(E){const{allowOpenContours:u}=this.configuration,{canvasPoints:g,contourHoleProcessingEnabled:m}=this.drawData,v=g[0],S=g[g.length-1];u&&!T7(v,S,this.configuration.closeContourProximity)?this.completeDrawOpenContour(E,{contourHoleProcessingEnabled:m}):this.completeDrawClosedContour(E,{contourHoleProcessingEnabled:m})}function TH(E,u){const{subPixelResolution:g}=this.configuration;if(function(m,v){const S=Math.max(3*v,3);return m.length<S}(u,g)){const{annotation:m,viewportIdsToRender:v}=this.commonData,S=(0,j.getEnabledElement)(E),{renderingEngine:D}=S;return Ht(m.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,We(D,v),this.deactivateDraw(E),!0}return!1}const _H=function(E){E.activateDraw=gH.bind(E),E.deactivateDraw=pH.bind(E),E.applyCreateOnCross=SH.bind(E),E.findCrossingIndexDuringCreate=xH.bind(E),E.completeDrawOpenContour=CH.bind(E),E.removeCrossedLinesOnCompleteDraw=wH.bind(E),E.mouseDragDrawCallback=mH.bind(E),E.mouseUpDrawCallback=vH.bind(E),E.completeDrawClosedContour=yH.bind(E),E.cancelDrawing=EH.bind(E),E.haltDrawing=TH.bind(E)},{addCanvasPointsToArray:DH,getFirstLineSegmentIntersectionIndexes:Bc}=ae;function bH(E,u){const g=E.detail,{element:m,currentPoints:v,lastPoints:S}=g,D=v.canvas,O=S.canvas,{editCanvasPoints:N,prevCanvasPoints:R}=this.editData,L=Bc(R,D,O,u);if(L)this.editData.startCrossingIndex=L[0],this.removePointsUpUntilFirstCrossing(u);else if(R.length>=2)if(N.length>this.configuration.checkCanvasEditFallbackProximity){const P=N[0],F=[];for(let W=0;W<R.length;W++){const q=R[W],Y=le.vec2.distance(q,P);F.push({distance:Y,index:W})}F.sort((W,q)=>W.distance-q.distance);const V=[F[0],F[1]],G=Math.min(V[0].index,V[1].index);this.editData.startCrossingIndex=G}else{const P=le.vec2.create();le.vec2.subtract(P,N[1],N[0]),le.vec2.normalize(P,P);const F=6,V=[N[0][0]-P[0]*F,N[0][1]-P[1]*F],G=Bc(R,V,N[0],u);if(G){const W=[V];DH(m,W,N[0],this.commonData),N.unshift(...W),this.removePointsUpUntilFirstCrossing(u),this.editData.editIndex=N.length-1,this.editData.startCrossingIndex=G[0]}}}function IH(E){const{editCanvasPoints:u,prevCanvasPoints:g}=this.editData;let m=0;for(let v=0;v<u.length-1;v++){const S=[u[v],u[v+1]];if(m++,Bc(g,S[0],S[1],E))break}u.splice(0,m),this.editData.editIndex=u.length-1}function OH(E,u){const g=E.detail,{currentPoints:m,lastPoints:v}=g,S=m.canvas,D=v.canvas,{prevCanvasPoints:O}=this.editData;return!!Bc(O,S,D,u)}function MH(E){const{prevCanvasPoints:u,editCanvasPoints:g}=this.editData;for(let m=g.length-1;m>0;m--){const v=[g[m],g[m-1]],S=!!Bc(u,v[0],v[1],E);if(g.pop(),S)break}}function NH(){const{editCanvasPoints:E,prevCanvasPoints:u,startCrossingIndex:g}=this.editData;if(g===void 0)return;const m=E[E.length-1],v=[];for(let D=0;D<u.length;D++){const O=u[D],N=le.vec2.distance(O,m);v.push({distance:N,index:D})}v.sort((D,O)=>D.distance-O.distance);const S=E.slice(0,-1);for(let D=0;D<v.length;D++){const{index:O}=v[D],N=u[O],R=E[E.length-1];if(!Bc(S,N,R,!1))return O}return-1}function RH(E){const u=E.detail,{currentPoints:g,lastPoints:m}=u,v=g.canvas,S=m.canvas,{editCanvasPoints:D}=this.editData,O=D.slice(0,-2),N=Bc(O,v,S,!1);if(!N)return;const R=N[0],L=D.length-R;for(let P=0;P<L;P++)D.pop()}const AH=function(E){E.checkForFirstCrossing=bH.bind(E),E.removePointsUpUntilFirstCrossing=IH.bind(E),E.checkForSecondCrossing=OH.bind(E),E.findSnapIndex=NH.bind(E),E.removePointsAfterSecondCrossing=MH.bind(E),E.checkAndRemoveCrossesOnEditLine=RH.bind(E)},{getSubPixelSpacingAndXYDirections:LH,addCanvasPointsToArray:D7,getArea:b7}=ae;function kH(E,u,g){this.isEditingClosed=!0;const m=E.detail,{currentPoints:v,element:S}=m,D=v.canvas,O=(0,j.getEnabledElement)(S);if(!O)return;const{viewport:N}=O,R=u.data.contour.polyline.map(N.worldToCanvas),{spacing:L,xDir:P,yDir:F}=LH(N,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:R,editCanvasPoints:[D],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:u,viewportIdsToRender:g,spacing:L,xDir:P,yDir:F,movingTextBox:!1},Ke.isInteractingWithTool=!0,S.addEventListener(Q.MOUSE_UP,this.mouseUpClosedContourEditCallback),S.addEventListener(Q.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),S.addEventListener(Q.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),S.addEventListener(Q.TOUCH_END,this.mouseUpClosedContourEditCallback),S.addEventListener(Q.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),S.addEventListener(Q.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Wt(S)}function PH(E){Ke.isInteractingWithTool=!1,E.removeEventListener(Q.MOUSE_UP,this.mouseUpClosedContourEditCallback),E.removeEventListener(Q.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),E.removeEventListener(Q.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),E.removeEventListener(Q.TOUCH_END,this.mouseUpClosedContourEditCallback),E.removeEventListener(Q.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),E.removeEventListener(Q.TOUCH_TAP,this.mouseUpClosedContourEditCallback),rn(E)}function FH(E){const u=E.detail,{currentPoints:g,element:m}=u,v=g.world,S=g.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{viewportIdsToRender:R,xDir:L,yDir:P,spacing:F}=this.commonData,{editIndex:V,editCanvasPoints:G,startCrossingIndex:W}=this.editData,q=G[G.length-1],Y=N.canvasToWorld(q),Z=le.vec3.create();le.vec3.subtract(Z,v,Y);const ne=Math.abs(le.vec3.dot(Z,L)),oe=Math.abs(le.vec3.dot(Z,P));if(ne<=F[0]&&oe<=F[1])return;W!==void 0&&this.checkAndRemoveCrossesOnEditLine(E);const ue=V+D7(m,G,S,this.commonData);this.editData.editIndex=ue,W===void 0&&G.length>1&&this.checkForFirstCrossing(E,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex!==-1?(this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(E),W!==void 0&&this.checkForSecondCrossing(E,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(E)),We(O,R)):this.finishEditAndStartNewEdit(E)}function VH(E){const u=E.detail,{element:g}=u,m=(0,j.getEnabledElement)(g),{viewport:v,renderingEngine:S}=m,{annotation:D,viewportIdsToRender:O}=this.commonData,{fusedCanvasPoints:N,editCanvasPoints:R}=this.editData;_s(D,{points:N,closed:!0,targetWindingDirection:p0.Clockwise},v),D.autoGenerated&&(D.autoGenerated=!1),Yt(D,g);const L=R.pop();this.editData={prevCanvasPoints:N,editCanvasPoints:[L],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0},We(S,O)}function UH(E){const{prevCanvasPoints:u,editCanvasPoints:g,startCrossingIndex:m,snapIndex:v}=this.editData;if(m===void 0||v===void 0)return;const S=E.detail,{element:D}=S,O=[...g];let N,R;D7(D,O,u[v],this.commonData),O.length>g.length&&O.pop(),m>v?(N=v,R=m):(N=m,R=v);const L=le.vec2.distance(u[N],O[0]),P=le.vec2.distance(u[N],O[O.length-1]),F=le.vec2.distance(u[R],O[0]),V=le.vec2.distance(u[R],O[O.length-1]),G=[];for(let Z=0;Z<N;Z++){const ne=u[Z];G.push([ne[0],ne[1]])}let W=L+V,q=P+F;if(W<q)for(let Z=0;Z<O.length;Z++){const ne=O[Z];G.push([ne[0],ne[1]])}else for(let Z=O.length-1;Z>=0;Z--){const ne=O[Z];G.push([ne[0],ne[1]])}for(let Z=R;Z<u.length;Z++){const ne=u[Z];G.push([ne[0],ne[1]])}const Y=[];for(let Z=N;Z<R;Z++){const ne=u[Z];Y.push([ne[0],ne[1]])}if(W=F+P,q=V+L,W<q)for(let Z=0;Z<O.length;Z++){const ne=O[Z];Y.push([ne[0],ne[1]])}else for(let Z=O.length-1;Z>=0;Z--){const ne=O[Z];Y.push([ne[0],ne[1]])}return b7(G)>b7(Y)?G:Y}function BH(E){const u=E.detail,{element:g}=u;this.completeClosedContourEdit(g)}function GH(E){const u=(0,j.getEnabledElement)(E),{viewport:g,renderingEngine:m}=u,{annotation:v,viewportIdsToRender:S}=this.commonData,{fusedCanvasPoints:D,prevCanvasPoints:O}=this.editData;if(D){var N;const R=y1(this.configuration,v)?w1(this.configuration,D,O):D,L=((N=this.configuration)===null||N===void 0?void 0:N.decimate)||{};_s(v,{points:R,closed:!0,targetWindingDirection:p0.Clockwise},g,{decimate:{enabled:!!L.enabled,epsilon:L.epsilon}}),v.autoGenerated&&(v.autoGenerated=!1),Yt(v,E)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,We(m,S),this.deactivateClosedContourEdit(E)}function zH(E){this.completeClosedContourEdit(E)}const WH=function(E){E.activateClosedContourEdit=kH.bind(E),E.deactivateClosedContourEdit=PH.bind(E),E.mouseDragClosedContourEditCallback=FH.bind(E),E.mouseUpClosedContourEditCallback=BH.bind(E),E.finishEditAndStartNewEdit=VH.bind(E),E.fuseEditPointsWithClosedContour=UH.bind(E),E.cancelClosedContourEdit=zH.bind(E),E.completeClosedContourEdit=GH.bind(E)},{addCanvasPointsToArray:I7,getSubPixelSpacingAndXYDirections:jH}=ae;function HH(E,u,g){this.isEditingOpen=!0;const m=E.detail,{currentPoints:v,element:S}=m,D=v.canvas,O=(0,j.getEnabledElement)(S),{viewport:N}=O,R=u.data.contour.polyline.map(N.worldToCanvas),{spacing:L,xDir:P,yDir:F}=jH(N,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:R,editCanvasPoints:[D],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:u,viewportIdsToRender:g,spacing:L,xDir:P,yDir:F,movingTextBox:!1},Ke.isInteractingWithTool=!0,S.addEventListener(Q.MOUSE_UP,this.mouseUpOpenContourEditCallback),S.addEventListener(Q.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),S.addEventListener(Q.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),S.addEventListener(Q.TOUCH_END,this.mouseUpOpenContourEditCallback),S.addEventListener(Q.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),S.addEventListener(Q.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Wt(S)}function $H(E){Ke.isInteractingWithTool=!1,E.removeEventListener(Q.MOUSE_UP,this.mouseUpOpenContourEditCallback),E.removeEventListener(Q.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),E.removeEventListener(Q.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),E.removeEventListener(Q.TOUCH_END,this.mouseUpOpenContourEditCallback),E.removeEventListener(Q.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),E.removeEventListener(Q.TOUCH_TAP,this.mouseUpOpenContourEditCallback),rn(E)}function KH(E){const u=E.detail,{currentPoints:g,element:m}=u,v=g.world,S=g.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{viewportIdsToRender:R,xDir:L,yDir:P,spacing:F}=this.commonData,{editIndex:V,editCanvasPoints:G,startCrossingIndex:W}=this.editData,q=G[G.length-1],Y=N.canvasToWorld(q),Z=le.vec3.create();le.vec3.subtract(Z,v,Y);const ne=Math.abs(le.vec3.dot(Z,L)),oe=Math.abs(le.vec3.dot(Z,P));if(ne<=F[0]&&oe<=F[1])return;W!==void 0&&this.checkAndRemoveCrossesOnEditLine(E);const ue=V+I7(m,G,S,this.commonData);this.editData.editIndex=ue,W===void 0&&G.length>1&&this.checkForFirstCrossing(E,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(E),W!==void 0&&this.checkForSecondCrossing(E,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(E)):this.checkIfShouldOverwriteAnEnd(E)&&this.openContourEditOverwriteEnd(E),We(O,R)}function qH(E){const u=E.detail,{element:g}=u,m=(0,j.getEnabledElement)(g),{viewport:v}=m,{annotation:S,viewportIdsToRender:D}=this.commonData;_s(S,{points:this.fuseEditPointsForOpenContourEndEdit(),closed:!1},v);const O=S.data.contour.polyline;S.data.handles.points=[O[0],O[O.length-1]],S.data.handles.activeHandleIndex=1,Yt(S,g),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.deactivateOpenContourEdit(g),this.activateOpenContourEndEdit(E,S,D,null)}function XH(E){const u=E.detail,{currentPoints:g,lastPoints:m}=u,v=g.canvas,S=m.canvas,{snapIndex:D,prevCanvasPoints:O,startCrossingIndex:N}=this.editData;if(N===void 0||D===void 0)return!1;if(D===-1)return!0;if(D!==0&&D!==O.length-1)return!1;const R=v,L=S,P=O[D],F=le.vec2.create(),V=le.vec2.create();le.vec2.set(F,R[0]-L[0],R[1]-L[1]),le.vec2.set(V,R[0]-P[0],R[1]-P[1]);const G=le.vec2.dot(F,V),W=Math.sqrt(F[0]*F[0]+F[1]*F[1]),q=Math.sqrt(V[0]*V[0]+V[1]*V[1]);return Math.acos(G/(W*q))<Math.PI/2}function YH(){const{snapIndex:E,prevCanvasPoints:u,editCanvasPoints:g,startCrossingIndex:m}=this.editData,v=[];if(E===0)for(let S=u.length-1;S>=m;S--){const D=u[S];v.push([D[0],D[1]])}else for(let S=0;S<m;S++){const D=u[S];v.push([D[0],D[1]])}if(le.vec2.distance(u[m],g[0])<le.vec2.distance(u[m],g[g.length-1]))for(let S=0;S<g.length;S++){const D=g[S];v.push([D[0],D[1]])}else for(let S=g.length-1;S>=0;S--){const D=g[S];v.push([D[0],D[1]])}return v}function JH(E){const{prevCanvasPoints:u,editCanvasPoints:g,startCrossingIndex:m,snapIndex:v}=this.editData;if(m===void 0||v===void 0)return;const S=E.detail,{element:D}=S,O=[...g];let N,R;I7(D,O,u[v],this.commonData),O.length>g.length&&O.pop(),m>v?(N=v,R=m):(N=m,R=v);const L=le.vec2.distance(u[N],O[0]),P=le.vec2.distance(u[N],O[O.length-1]),F=le.vec2.distance(u[R],O[0]),V=le.vec2.distance(u[R],O[O.length-1]),G=[];for(let W=0;W<N;W++){const q=u[W];G.push([q[0],q[1]])}if(L+V<P+F)for(let W=0;W<O.length;W++){const q=O[W];G.push([q[0],q[1]])}else for(let W=O.length-1;W>=0;W--){const q=O[W];G.push([q[0],q[1]])}for(let W=R;W<u.length;W++){const q=u[W];G.push([q[0],q[1]])}return G}function ZH(E){const u=E.detail,{element:g}=u,m=(0,j.getEnabledElement)(g),{viewport:v,renderingEngine:S}=m,{annotation:D,viewportIdsToRender:O}=this.commonData,{fusedCanvasPoints:N,editCanvasPoints:R}=this.editData;_s(D,{points:N,closed:!1},v);const L=D.data.contour.polyline;D.data.handles.points=[L[0],L[L.length-1]],Yt(D,g);const P=R.pop();this.editData={prevCanvasPoints:N,editCanvasPoints:[P],startCrossingIndex:void 0,editIndex:0},We(S,O)}function QH(E){const u=E.detail,{element:g}=u;this.completeOpenContourEdit(g)}function e$(E){const u=(0,j.getEnabledElement)(E),{viewport:g,renderingEngine:m}=u,{annotation:v,viewportIdsToRender:S}=this.commonData,{fusedCanvasPoints:D,prevCanvasPoints:O}=this.editData;if(D){var N;const R=y1(this.configuration)?w1(this.configuration,D,O):D,L=((N=this.configuration)===null||N===void 0?void 0:N.decimate)||{};_s(v,{points:R,closed:!1},g,{decimate:{enabled:!!L.enabled,epsilon:L.epsilon}});const P=v.data.contour.polyline;v.data.handles.points=[P[0],P[P.length-1]],v.data.isOpenUShapeContour&&(v.data.openUShapeContourVectorToPeak=I3(D,g)),Yt(v,E)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,We(m,S),this.deactivateOpenContourEdit(E)}function t$(E){this.completeOpenContourEdit(E)}const n$=function(E){E.activateOpenContourEdit=HH.bind(E),E.deactivateOpenContourEdit=$H.bind(E),E.mouseDragOpenContourEditCallback=KH.bind(E),E.mouseUpOpenContourEditCallback=QH.bind(E),E.fuseEditPointsWithOpenContour=JH.bind(E),E.finishEditOpenOnSecondCrossing=ZH.bind(E),E.checkIfShouldOverwriteAnEnd=XH.bind(E),E.fuseEditPointsForOpenContourEndEdit=YH.bind(E),E.openContourEditOverwriteEnd=qH.bind(E),E.cancelOpenContourEdit=t$.bind(E),E.completeOpenContourEdit=e$.bind(E)},{getSubPixelSpacingAndXYDirections:r$}=ae;function i$(E,u,g,m){this.isDrawing=!0;const v=E.detail,{element:S}=v,D=(0,j.getEnabledElement)(S),{viewport:O}=D,{spacing:N,xDir:R,yDir:L}=r$(O,this.configuration.subPixelResolution),P=u.data.contour.polyline.map(O.worldToCanvas);u.data.handles.activeHandleIndex===0&&P.reverse();let F=!1;m!=null&&m.worldPosition&&(F=!0),this.drawData={canvasPoints:P,polylineIndex:P.length-1},this.commonData={annotation:u,viewportIdsToRender:g,spacing:N,xDir:R,yDir:L,movingTextBox:F},Ke.isInteractingWithTool=!0,S.addEventListener(Q.MOUSE_UP,this.mouseUpDrawCallback),S.addEventListener(Q.MOUSE_DRAG,this.mouseDragDrawCallback),S.addEventListener(Q.MOUSE_CLICK,this.mouseUpDrawCallback),S.addEventListener(Q.TOUCH_END,this.mouseUpDrawCallback),S.addEventListener(Q.TOUCH_DRAG,this.mouseDragDrawCallback),S.addEventListener(Q.TOUCH_TAP,this.mouseUpDrawCallback),Wt(S)}const a$=function(E){E.activateOpenContourEndEdit=i$.bind(E)};function yl(E,u,g,m,v){const S=m.length&&m[0].length&&Array.isArray(m[0][0])?m:[m],{color:D="rgb(0, 255, 0)",width:O=10,fillColor:N="none",fillOpacity:R=0,lineWidth:L,lineDash:P,closePath:F=!1}=v,V=L||O,G=Ds(u,"path",g),W=E.getSvgNode(G);let q="";for(let Z=0,ne=S.length;Z<ne;Z++){const oe=S[Z],ue=oe.length;if(!(ue<2)){for(let ge=0;ge<ue;ge++){const me=oe[ge];q+="".concat(ge?"L":"M"," ").concat(me[0].toFixed(1),", ").concat(me[1].toFixed(1)," ")}F&&(q+="Z ")}}if(!q)return;const Y={d:q,stroke:D,fill:N,"fill-opacity":R,"stroke-width":V,"stroke-dasharray":P};if(W)ja(Y,W),E.setNodeTouched(G);else{const Z=document.createElementNS("http://www.w3.org/2000/svg","path");bs(Y,Z),E.appendNode(Z,G)}}function Xo(E,u,g,m,v){if(m.length<2)return;const{color:S="rgb(0, 255, 0)",width:D=10,fillColor:O="none",fillOpacity:N=0,lineWidth:R,lineDash:L,closePath:P=!1}=v,F=R||D,V=Ds(u,"polyline",g),G=E.getSvgNode(V);let W="";for(const Y of m)W+="".concat(Y[0].toFixed(1),", ").concat(Y[1].toFixed(1)," ");if(P){const Y=m[0];W+="".concat(Y[0],", ").concat(Y[1])}const q={points:W,stroke:S,fill:O,"fill-opacity":N,"stroke-width":F,"stroke-dasharray":L};if(G)ja(q,G),E.setNodeTouched(V);else{const Y=document.createElementNS("http://www.w3.org/2000/svg","polyline");bs(q,Y),E.appendNode(Y,V)}}const{pointsAreWithinCloseContourProximity:o$}=ae;function s$(E,u){const g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:E.viewport.id,annotationUID:u.annotationUID},{lineWidth:m,lineDash:v,color:S,fillColor:D,fillOpacity:O}=this.getAnnotationStyle({annotation:u,styleSpecifier:g}),{closed:N}=u.data.contour;return{color:S,width:m,lineDash:v,fillColor:D,fillOpacity:O,closePath:N}}function l$(E,u,g){var m;E!=null&&(m=E.viewport)!==null&&m!==void 0&&m.getImageData()&&(g.data.contour.closed?this.renderClosedContour(E,u,g):g.data.isOpenUShapeContour?(function(v,S){S.data.openUShapeContourVectorToPeak||(S.data.openUShapeContourVectorToPeak=function(D,O){const{viewport:N}=D;return I3(O.data.contour.polyline.map(N.worldToCanvas),N)}(v,S))}(E,g),this.renderOpenUShapedContour(E,u,g)):this.renderOpenContour(E,u,g))}function c$(E,u,g){if(g.parentAnnotationUID)return;const{viewport:m}=E,v=this._getRenderingOptions(E,g),S=[g.data.contour.polyline.map(D=>m.worldToCanvas(D)),...bd(g,m)];yl(u,g.annotationUID,"1",S,v)}function u$(E,u,g){var m;const{viewport:v}=E,S=this._getRenderingOptions(E,g),D=g.data.contour.polyline.map(N=>v.worldToCanvas(N));Xo(u,g.annotationUID,"1",D,S);const O=g.data.handles.activeHandleIndex;if(((m=this.configuration.alwaysRenderOpenContourHandles)===null||m===void 0?void 0:m.enabled)===!0){const N=this.configuration.alwaysRenderOpenContourHandles.radius,R="0",L=[D[0],D[D.length-1]];O===0?L.shift():O===1&&L.pop(),Qn(u,g.annotationUID,R,L,{color:S.color,handleRadius:N})}if(O!==null){const N="1",R=D[O===0?0:D.length-1];Qn(u,g.annotationUID,N,[R],{color:S.color})}}function f$(E,u,g){const{viewport:m}=E,{openUShapeContourVectorToPeak:v}=g.data,{polyline:S}=g.data.contour;if(this.renderOpenContour(E,u,g),!v)return;const D=m.worldToCanvas(S[0]),O=m.worldToCanvas(S[S.length-1]),N=[m.worldToCanvas(v[0]),m.worldToCanvas(v[1])],R=this._getRenderingOptions(E,g);Xo(u,g.annotationUID,"first-to-last",[D,O],{color:R.color,width:R.width,closePath:!1,lineDash:"2,2"}),Xo(u,g.annotationUID,"midpoint-to-open-contour",[N[0],N[1]],{color:R.color,width:R.width,closePath:!1,lineDash:"2,2"})}function d$(E,u,g){const m=this._getRenderingOptions(E,g),{allowOpenContours:v}=this.configuration,{canvasPoints:S}=this.drawData;if(m.closePath=!1,Xo(u,g.annotationUID,"1",S,m),v){const D=S[0],O=S[S.length-1];o$(D,O,this.configuration.closeContourProximity)?Xo(u,g.annotationUID,"2",[O,D],m):Qn(u,g.annotationUID,"0",[D],{color:m.color,handleRadius:2})}}function h$(E,u,g){const{viewport:m}=E,{fusedCanvasPoints:v}=this.editData;if(v===void 0)return void this.renderClosedContour(E,u,g);const S=[v,...bd(g,m)],D=this._getRenderingOptions(E,g);g.parentAnnotationUID&&D.fillOpacity&&(D.fillOpacity=0),yl(u,g.annotationUID,"preview-1",S,D)}function g$(E,u,g){const{fusedCanvasPoints:m}=this.editData;if(m===void 0)return void this.renderOpenContour(E,u,g);const v=this._getRenderingOptions(E,g);Xo(u,g.annotationUID,"preview-1",m,v)}function p$(E,u,g){if(g.parentAnnotationUID)return;const{viewport:m}=E,v=this._getRenderingOptions(E,g),S=g.data.contour.polyline.map(P=>m.worldToCanvas(P)),D=bd(g,m),O=S[0],N=[];for(let P=0;P<100;P++){const F=P/100*2*Math.PI,V=O[0]+6*Math.cos(F),G=O[1]+6*Math.sin(F);N.push([V,G])}const R=[[O[0]-12,O[1]],[O[0]+12,O[1]],[O[0],O[1]-12],[O[0],O[1]+12]];yl(u,g.annotationUID,"1-crosshair_v",[R[0],R[1]],v),yl(u,g.annotationUID,"1-crosshair_h",[R[2],R[3]],v);const L=[N,...D];yl(u,g.annotationUID,"1",L,v)}const m$=function(E){E.renderContour=l$.bind(E),E.renderClosedContour=c$.bind(E),E.renderOpenContour=u$.bind(E),E.renderPointContourWithMarker=p$.bind(E),E.renderOpenUShapedContour=f$.bind(E),E.renderContourBeingDrawn=d$.bind(E),E.renderClosedContourBeingEdited=h$.bind(E),E.renderOpenContourBeingEdited=g$.bind(E),E._getRenderingOptions=s$.bind(E)};class v$ extends ei{constructor(u,g){super(u,g)}renderAnnotation(u,g){var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let P=0;P<N.length;P++){const F=N[P];L.annotationUID=F.annotationUID;const V=this.getAnnotationStyle({annotation:F,styleSpecifier:L});if(!V.visibility)continue;const G=this.renderAnnotationInstance({enabledElement:u,targetId:R,annotation:F,annotationStyle:V,svgDrawingHelper:g});S||(S=G),F.invalidated=!1}return S}createAnnotation(u){const g=u.detail,{currentPoints:m,element:v}=g,{world:S}=m,D=(0,j.getEnabledElement)(v),{viewport:O}=D,N=O.getCamera(),{viewPlaneNormal:R,viewUp:L,position:P}=N,F=this.getReferencedImageId(O,S,R,L),V=O.getViewReference({points:[S]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...V,referencedImageId:F,viewUp:L,cameraPosition:P},data:{handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{polyline:[],closed:!1}},interpolationUID:"",autoGenerated:!1}}addAnnotation(u,g){return fn(u,g)}cancelAnnotation(u){}moveAnnotation(u,g){const{points:m}=u.data.handles;for(let v=0,S=m.length;v<S;v++){const D=m[v];D[0]+=g[0],D[1]+=g[1],D[2]+=g[2]}u.invalidated=!0,Ga(u).forEach(v=>this.moveAnnotation(v,g))}updateContourPolyline(u,g,m){var v;const S=((v=this.configuration)===null||v===void 0?void 0:v.decimate)||{};_s(u,g,m,{decimate:{enabled:!!S.enabled,epsilon:S.epsilon}})}getPolylinePoints(u){var g,m;return(g=(m=u.data.contour)===null||m===void 0?void 0:m.polyline)!==null&&g!==void 0?g:u.data.polyline}renderAnnotationInstance(u){const{enabledElement:g,annotationStyle:m,svgDrawingHelper:v}=u,S=u.annotation;if(S.parentAnnotationUID)return;const{annotationUID:D}=S,{viewport:O}=g,{worldToCanvas:N}=O,R=this.getPolylinePoints(S).map(W=>N(W)),{lineWidth:L,lineDash:P,color:F,fillColor:V,fillOpacity:G}=m;return yl(v,D,"contourPolyline",[R,...bd(S,O)],{color:F,lineDash:P,lineWidth:Math.max(.1,L),fillColor:V,fillOpacity:G}),!0}}class M3 extends v${constructor(u,g){var m;super(u,g),(m=this.configuration.interpolation)!==null&&m!==void 0&&m.enabled&&Oi.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(u){const{toolGroupId:g}=this,m=super.createAnnotation(u);if(!this.isContourSegmentationTool())return m;const v=Ko(g);if(!v)throw new Error("No active segmentation detected, create one before using scissors tool");const{type:S}=v;if(S!==Nt.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:D}=v,O=vl(D);return j.utilities.deepMerge(m,{data:{segmentation:{segmentationId:D,segmentIndex:O}}})}addAnnotation(u,g){const m=super.addAnnotation(u,g);return this.isContourSegmentationTool()&&g0(u),m}cancelAnnotation(u){this.isContourSegmentationTool()&&Yp(u),super.cancelAnnotation(u)}getAnnotationStyle(u){const g=super.getAnnotationStyle(u);if(!this.isContourSegmentationTool())return g;const m=this._getContourSegmentationStyle(u);return j.utilities.deepMerge(g,m)}renderAnnotationInstance(u){const{annotation:g}=u,{invalidated:m}=g,v=super.renderAnnotationInstance(u);if(m&&this.isContourSegmentationTool()){const{segmentationId:S}=g.data.segmentation;pi(S);const D=bc(S);C_(D)}return v}_getContourSegmentationStyle(u){var g,m,v,S,D,O;const{toolGroupId:N}=this,R=u.annotation,{segmentationId:L,segmentIndex:P}=R.data.segmentation,F=dn(L),V=this._getSegmentationRepresentation(L);if(!V)return{};const{segmentationRepresentationUID:G}=V,{active:W}=V,{autoGenerated:q}=R,Y=Ac(L).includes(P),Z=Es(N,G,P),ne=z6(N,G),oe=Ed(),ue=kp(N),ge=B6(N,G),me=G6(N,G,P),xe=W6(N,G,P),Ee=Object.assign({},(g=oe==null||(m=oe.representations)===null||m===void 0?void 0:m.CONTOUR)!==null&&g!==void 0?g:{},(v=ue==null||(S=ue.representations)===null||S===void 0?void 0:S.CONTOUR)!==null&&v!==void 0?v:{},(D=ge==null?void 0:ge.CONTOUR)!==null&&D!==void 0?D:{},(O=me==null?void 0:me.CONTOUR)!==null&&O!==void 0?O:{});let Ie,be=1,Ne=1,_e=0;var Me,Pe,Ze,Ye;if(q)be=(Me=Ee.outlineWidthAutoGenerated)!==null&&Me!==void 0?Me:be,Ie=(Pe=Ee.outlineDashAutoGenerated)!==null&&Pe!==void 0?Pe:Ie,Ne=(Ze=Ee.outlineOpacity)!==null&&Ze!==void 0?Ze:Ne,_e=(Ye=Ee.fillAlphaAutoGenerated)!==null&&Ye!==void 0?Ye:_e;else if(W){var at,ot,st,ct;be=(at=Ee.outlineWidthActive)!==null&&at!==void 0?at:be,Ie=(ot=Ee.outlineDashActive)!==null&&ot!==void 0?ot:Ie,Ne=(st=Ee.outlineOpacity)!==null&&st!==void 0?st:Ne,_e=(ct=Ee.fillAlpha)!==null&&ct!==void 0?ct:_e}else{var Tt,pt,Ct,gt;be=(Tt=Ee.outlineWidthInactive)!==null&&Tt!==void 0?Tt:be,Ie=(pt=Ee.outlineDashInactive)!==null&&pt!==void 0?pt:Ie,Ne=(Ct=Ee.outlineOpacityInactive)!==null&&Ct!==void 0?Ct:Ne,_e=(gt=Ee.fillAlphaInactive)!==null&&gt!==void 0?gt:_e}F.activeSegmentIndex===P&&(be+=Ee.activeSegmentOutlineWidthDelta),be=Ee.renderOutline?be:0,_e=Ee.renderFill?_e:0;const Dt="rgba(".concat(Z[0],", ").concat(Z[1],", ").concat(Z[2],", ").concat(Ne,")");return{color:Dt,fillColor:"rgb(".concat(Z[0],", ").concat(Z[1],", ").concat(Z[2],")"),lineWidth:be,fillOpacity:_e,lineDash:Ie,textbox:{color:Dt},visibility:ne&&xe,locked:Y}}_getSegmentationRepresentation(u){const g=Hi(this.toolGroupId).filter(m=>m.segmentationId===u);if(g)return Hi(this.toolGroupId).length>1&&console.warn("Multiple segmentation representations detected for this tool group. The first one will be used."),g[0];console.warn("No segmentation representation found for toolGroupId: ".concat(this.toolGroupId))}}const{pointCanProjectOnLine:O7}=ae,{EPSILON:y$}=j.CONSTANTS,w$=1-y$;class N3 extends M3{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:li.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:C$,statsCalculator:ti}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"commonData",void 0),$(this,"isDrawing",!1),$(this,"isEditingClosed",!1),$(this,"isEditingOpen",!1),$(this,"activateDraw",void 0),$(this,"activateClosedContourEdit",void 0),$(this,"activateOpenContourEdit",void 0),$(this,"activateOpenContourEndEdit",void 0),$(this,"cancelDrawing",void 0),$(this,"cancelClosedContourEdit",void 0),$(this,"cancelOpenContourEdit",void 0),$(this,"renderContour",void 0),$(this,"renderContourBeingDrawn",void 0),$(this,"renderClosedContourBeingEdited",void 0),$(this,"renderOpenContourBeingEdited",void 0),$(this,"renderPointContourWithMarker",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),{renderingEngine:S}=v,D=this.createAnnotation(u);this.addAnnotation(D,m);const O=Mt(m,this.getToolName());return this.activateDraw(u,D,O),u.preventDefault(),We(S,O),D}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,D=Mt(S,this.getToolName());this.activateOpenContourEndEdit(u,g,D,m)}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m,S=Mt(v,this.getToolName());g.data.contour.closed?this.activateClosedContourEdit(u,g,S):this.activateOpenContourEdit(u,g,S),u.preventDefault()}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{polyline:O}=g.data.contour;let N=D.worldToCanvas(O[0]);for(let P=1;P<O.length;P++){const F=N,V=D.worldToCanvas(O[P]);if(O7(m,F,V,v))return!0;N=V}if(!g.data.contour.closed)return!1;const R=D.worldToCanvas(O[0]),L=D.worldToCanvas(O[O.length-1]);return O7(m,R,L,v)}),$(this,"cancel",u=>{const g=this.isDrawing,m=this.isEditingOpen,v=this.isEditingClosed;g?this.cancelDrawing(u):m?this.cancelOpenContourEdit(u):v&&this.cancelClosedContourEdit(u)}),$(this,"_calculateCachedStats",(u,g,m,v)=>{const{data:S}=u,{cachedStats:D}=S,{polyline:O,closed:N}=S.contour,R=Object.keys(D);for(let L=0;L<R.length;L++){const P=R[L],F=this.getTargetIdImage(P,m);if(!F)continue;const{imageData:V,metadata:G}=F,W=O.map(ne=>g.worldToCanvas(ne)),q={isPreScaled:qo(g,P),isSuvScaled:this.isSuvScaled(g,P,u.metadata.referencedImageId)},Y=Pc(G.Modality,u.metadata.referencedImageId,q),Z=za(F,()=>{const ne=S.contour.polyline,oe=ne.length,ue=new Array(oe);for(let _e=0;_e<oe;_e++)ue[_e]=g.worldToCanvas(ne[_e]);const{maxX:ge,maxY:me,minX:xe,minY:Ee}=Dd(ue),Ie=g.canvasToWorld([xe,Ee]),be=j.utilities.transformWorldToIndex(V,Ie),Ne=g.canvasToWorld([ge,me]);return[be,j.utilities.transformWorldToIndex(V,Ne)]});N?this.updateClosedCachedStats({targetId:P,viewport:g,canvasCoordinates:W,points:O,imageData:V,metadata:G,cachedStats:D,modalityUnit:Y,calibratedScale:Z}):this.updateOpenCachedStats({metadata:G,canvasCoordinates:W,targetId:P,cachedStats:D,modalityUnit:Y,calibratedScale:Z})}return Yt(u,v.viewport.element,vr.StatsUpdated),u.invalidated=!1,D}),$(this,"_renderStats",(u,g,m,v)=>{var S;const{data:D}=u,O=this.getTargetId(g),N={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:m.viewport.id},R=this.getLinkedTextBoxStyle(N,u);if(!R.visibility)return;const L=this.configuration.getTextLines(D,O);if(!L||L.length===0)return;const P=D.contour.polyline.map(Z=>g.worldToCanvas(Z));if(!D.handles.textBox.hasMoved){const Z=Ha(P);D.handles.textBox.worldPosition=g.canvasToWorld(Z)}const F=g.worldToCanvas(D.handles.textBox.worldPosition),V=Ki(v,(S=u.annotationUID)!==null&&S!==void 0?S:"","1",L,F,P,{},R),{x:G,y:W,width:q,height:Y}=V;D.handles.textBox.worldBoundingBox={topLeft:g.canvasToWorld([G,W]),topRight:g.canvasToWorld([G+q,W]),bottomLeft:g.canvasToWorld([G,W+Y]),bottomRight:g.canvasToWorld([G+q,W+Y])}}),_H(this),AH(this),WH(this),n$(this),a$(this),m$(this),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(u,g){if(!g||!g.length)return;const m=(0,j.getEnabledElement)(u),{viewport:v}=m;let S;if(v instanceof j.VolumeViewport){const D=v.getCamera(),{spacingInNormalDirection:O}=j.utilities.getTargetVolumeAndSpacingInNormalDir(v,D);S=this.filterAnnotationsWithinSlice(g,D,O)}else S=r1(v,g);return S}filterAnnotationsWithinSlice(u,g,m){const{viewPlaneNormal:v}=g,S=u.filter(R=>{const L=R.metadata.viewPlaneNormal,P=Math.abs(le.vec3.dot(v,L))>w$;return L&&P});if(!S.length)return[];const D=m/2,{focalPoint:O}=g,N=[];for(const R of S){const L=R.data.contour.polyline[0];if(!R.isVisible)continue;const P=le.vec3.create();le.vec3.sub(P,O,L);const F=le.vec3.dot(P,v);Math.abs(F)<D&&N.push(R)}return N}isContourSegmentationTool(){return!1}createAnnotation(u){const g=u.detail.currentPoints.world,m=super.createAnnotation(u);return j.utilities.deepMerge(m,{data:{contour:{polyline:[[...g]]},label:"",cachedStats:{}},onInterpolationComplete:v=>{v.data.handles.points.length=0}})}getAnnotationStyle(u){return super.getAnnotationStyle(u)}renderAnnotationInstance(u){const{enabledElement:g,targetId:m,svgDrawingHelper:v}=u,S=u.annotation;let D=!1;const{viewport:O,renderingEngine:N}=g,R=this.isDrawing,L=this.isEditingOpen,P=this.isEditingClosed;if(R||L||P){const F=this.commonData.annotation.annotationUID;if(S.annotationUID===F)if(R)this.renderContourBeingDrawn(g,v,S);else if(P)this.renderClosedContourBeingEdited(g,v,S);else{if(!L)throw new Error("Unknown ".concat(this.getToolName()," annotation rendering state"));this.renderOpenContourBeingEdited(g,v,S)}else this.configuration.displayOnePointAsCrosshairs&&S.data.contour.polyline.length===1?this.renderPointContourWithMarker(g,v,S):this.renderContour(g,v,S);D=!0}else this.configuration.displayOnePointAsCrosshairs&&S.data.contour.polyline.length===1?this.renderPointContourWithMarker(g,v,S):this.renderContour(g,v,S);if(this.configuration.calculateStats)return this._calculateStatsIfActive(S,m,O,N,g),this._renderStats(S,O,g,v),D}_calculateStatsIfActive(u,g,m,v,S){var D,O,N;const R=(D=this.commonData)===null||D===void 0?void 0:D.annotation.annotationUID;if((u.annotationUID!==R||(O=this.commonData)!==null&&O!==void 0&&O.movingTextBox)&&((N=this.commonData)===null||N===void 0||!N.movingTextBox)){const{data:L}=u;L.cachedStats[g]&&L.cachedStats[g].areaUnit!=null?u.invalidated&&this._throttledCalculateCachedStats(u,m,v,S):(L.cachedStats[g]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(u,m,v,S))}}updateClosedCachedStats(u){var g,m,v;let{viewport:S,points:D,imageData:O,metadata:N,cachedStats:R,targetId:L,modalityUnit:P,canvasCoordinates:F,calibratedScale:V}=u;const{scale:G,areaUnits:W,units:q}=V,Y=F[0],Z=S.canvasToWorld(Y),ne=S.canvasToWorld([Y[0]+1,Y[1]]),oe=S.canvasToWorld([Y[0],Y[1]+1]),ue=le.vec3.distance(Z,ne),ge=le.vec3.distance(Z,oe),me=j.utilities.transformWorldToIndex(O,D[0]);me[0]=Math.floor(me[0]),me[1]=Math.floor(me[1]),me[2]=Math.floor(me[2]);let xe=me[0],Ee=me[0],Ie=me[1],be=me[1],Ne=me[2],_e=me[2];for(let en=1;en<D.length;en++){const $t=j.utilities.transformWorldToIndex(O,D[en]);$t[0]=Math.floor($t[0]),$t[1]=Math.floor($t[1]),$t[2]=Math.floor($t[2]),xe=Math.min(xe,$t[0]),Ee=Math.max(Ee,$t[0]),Ie=Math.min(Ie,$t[1]),be=Math.max(be,$t[1]),Ne=Math.min(Ne,$t[2]),_e=Math.max(_e,$t[2])}const Me=j.utilities.transformWorldToIndex(O,D[1]);Me[0]=Math.floor(Me[0]),Me[1]=Math.floor(Me[1]),Me[2]=Math.floor(Me[2]);let Pe=u1(F)/G/G;Pe*=ue*ge;const Ze=.01*(Ee-xe),Ye=.01*(be-Ie),at=.01*(_e-Ne);xe=Math.floor(xe-Ze),Ee=Math.ceil(Ee+Ze),Ie=Math.floor(Ie-Ye),be=Math.ceil(be+Ye),Ne=Math.floor(Ne-at),_e=Math.ceil(_e+at);const ot=[[xe,Ee],[Ie,be],[Ne,_e]],st=O.indexToWorld([Ee,be,_e]),ct=S.worldToCanvas(st);let Tt=0,pt=[],Ct=0;const gt=Ii(O,(en,$t)=>{let mn=!0;const Cn=S.worldToCanvas(en);return Cn[1]!=Tt&&(Ct=0,Tt=Cn[1],pt=X9(F,Cn,[ct[0],Cn[1]]),pt.sort(function(br,ci){return br[0]===ci[0]?0:br[0]<ci[0]?-1:1})),pt.length&&Cn[0]>pt[0][0]&&(pt.shift(),Ct++),Ct%2==0&&(mn=!1),mn},this.configuration.statsCalculator.statsCallback,ot),Dt=this.configuration.statsCalculator.getStatistics();R[L]={Modality:N.Modality,area:Pe,perimeter:z5(F,closed)/G,mean:(g=Dt.mean)===null||g===void 0?void 0:g.value,max:(m=Dt.max)===null||m===void 0?void 0:m.value,stdDev:(v=Dt.stdDev)===null||v===void 0?void 0:v.value,statsArray:Dt.array,pointsInShape:gt,areaUnit:W,modalityUnit:P,unit:q}}updateOpenCachedStats(u){let{targetId:g,metadata:m,canvasCoordinates:v,cachedStats:S,modalityUnit:D,calibratedScale:O}=u;const{scale:N,units:R}=O;S[g]={Modality:m.Modality,length:z5(v,!1)/N,modalityUnit:D,unit:R}}}function C$(E,u){const g=E.cachedStats[u],{area:m,mean:v,stdDev:S,length:D,perimeter:O,max:N,isEmptyArea:R,areaUnit:L,modalityUnit:P,unit:F}=g||{},V=[];if(m){const G=R?"Area: Oblique not supported":"Area: ".concat(cn(m)," ").concat(L);V.push(G)}return v&&V.push("Mean: ".concat(cn(v)," ").concat(P)),Number.isFinite(N)&&V.push("Max: ".concat(cn(N)," ").concat(P)),S&&V.push("Std Dev: ".concat(cn(S)," ").concat(P)),O&&V.push("Perimeter: ".concat(cn(O)," ").concat(F)),D&&V.push("".concat(cn(D)," ").concat(F)),V}$(N3,"toolName",void 0),N3.toolName="PlanarFreehandROI";const R3=N3;class A3 extends R3{constructor(u){super(j.utilities.deepMerge({configuration:{calculateStats:!1,allowOpenContours:!1}},u))}isContourSegmentationTool(){return!0}renderAnnotationInstance(u){const g=u.annotation,{invalidated:m}=g,v=super.renderAnnotationInstance(u);if(m){const{segmentationId:S}=g.data.segmentation;pi(S)}return v}}$(A3,"toolName",void 0),A3.toolName="PlanarFreehandContourSegmentationTool";const Gc=A3,x$=E=>{const{numberOfCells:u,lines:g}=E,m=[],v=[];for(let S=0;S<g.length;){const D=g[S];if(v.push(D),m.push(g.slice(S+1,S+D+1)),S+=D+1,m.length===u)break}return{lineSegments:m,linesNumberOfPoints:v}};function M7(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return g5(E,Nt.Contour,()=>async function(g){var m,v;let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const D=(m=S.segmentIndices)!==null&&m!==void 0&&m.length?S.segmentIndices:Wi(g);let O;const N=dn(g).representationData;try{N.SURFACE?O=await async function(F){var V;let G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!G.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:W,segmentationRepresentationUID:q}=G,Y=(V=G.segmentIndices)!==null&&V!==void 0&&V.length?G.segmentIndices:Wi(F),Z=new Map,ne=new Map,oe=dn(F).representationData.SURFACE,ue=[];return oe.geometryIds.forEach((ge,me)=>{if(Y.includes(me)){var xe;Z.set(me,ge);const Ee=(xe=j.cache.getGeometry(ge))===null||xe===void 0?void 0:xe.data;Ee&&ue.push({id:ge,points:Ee.getPoints(),polys:Ee.getPolys()})}}),Z.forEach((ge,me)=>{ne.set(ge,me)}),v_(await J6(ue,W,q),ne)}(g,{segmentIndices:D,...S}):N.LABELMAP&&(O=await async function(F){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!V.viewport)throw new Error("Viewport is required to compute contour from labelmap");const G=await S5(F,V);if(G==null||!G.length)return void console.error("Failed to convert labelmap to surface or labelmap is empty");const{viewport:W,segmentationRepresentationUID:q}=V,Y=G.map(Z=>({id:Z.segmentIndex.toString(),points:Z.data.points,polys:Z.data.polys,segmentIndex:Z.segmentIndex}));return v_(await J6(Y,W,q))}(g,{segmentIndices:D,...S}))}catch(F){throw console.error(F),F}if(!O)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:R,segmentationRepresentationUID:L}=S,P=function(F,V,G){const W=new Map;for(const[q,Y]of F)for(const Z of Y){const{points:ne}=Z,{lineSegments:oe,linesNumberOfPoints:ue}=x$(Z);for(let ge=0;ge<oe.length;ge++){const me=oe[ge],xe=[];for(let be=0;be<ue[ge];be++){const Ne=me[be];xe.push([ne[3*Ne],ne[3*Ne+1],ne[3*Ne+2]])}if(xe.length<3)continue;const Ee={annotationUID:j.utilities.uuidv4(),data:{contour:{closed:!0,polyline:xe},segmentation:{segmentationId:G,segmentIndex:q},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:Gc.toolName,...V.getViewReference()}};fn(Ee,V.element);const Ie=W.get(q)||new Set;Ie.add(Ee.annotationUID),W.set(q,Ie)}}return W}(O,R,g);return $y((v=nr(R.id))===null||v===void 0?void 0:v.id,L,{CONTOUR:{fillAlpha:0}}),{annotationUIDsMap:P}}(E,u),()=>{})}function N7(E,u,g){var m;let v=(m=E.segmentSpecificConfig)===null||m===void 0?void 0:m[u];var S;return v||(v=(S=E.segmentSpecificConfig)===null||S===void 0?void 0:S[g]),v?v.CONTOUR:null}function S$(E,u,g,m){const{segmentationRepresentationUID:v,segmentsHidden:S}=g,D=m.representations.CONTOUR,O=m_(v),N=D.outlineWidthActive;(O==null?void 0:O.outlineWidthActive)!==N&&T5(v,Object.assign({},O,{outlineWidthActive:N}));const R=[],L=[];for(const W of S)O.segmentsHidden.has(W)||R.push(W);for(const W of O.segmentsHidden)S.has(W)||L.push(W);const P=Array.from(O.segmentsHidden).filter(W=>!L.includes(W)).concat(R),{segmentSpecificConfigs:F}=u.reduce((W,q)=>{const Y=j.cache.getGeometry(q),{data:Z}=Y,ne=Z.getSegmentIndex(),oe=N7(g,q,ne);return W.segmentSpecificConfigs[ne]=oe??{},W},{contourSets:[],segmentSpecificConfigs:{}}),V=[...P,...L],G=Object.values(F).some(W=>Object.keys(W).length>0);(V.length||G)&&T5(v,Object.assign({},O,{segmentsHidden:new Set(S)})),E.render()}function E$(E,u,g,m){const{segmentationRepresentationUID:v,segmentationId:S,segmentsHidden:D}=g,O=new Map;u.forEach(R=>{const L=j.cache.getGeometry(R);if(!L)return void console.warn("No geometry found for geometryId ".concat(R,". Skipping render."));const P=L.data.getSegmentIndex();(function(V){if(!V)throw new Error("No contours found for geometryId ".concat(V.id));const G=V.id;if(V.type!==j.Enums.GeometryType.CONTOUR)throw new Error("Geometry type ".concat(V.type," not supported for rendering."));V.data||console.warn("No contours found for geometryId ".concat(G,". Skipping render."))})(L);const F=N7(g,R,P);L.data.contours.forEach(V=>{const{points:G,color:W,id:q}=V,Y={annotationUID:j.utilities.uuidv4(),data:{contour:{closed:!0,polyline:G},segmentation:{segmentationId:S,segmentIndex:P,color:W,id:q},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:O5(E,G[0],E.getCamera().viewPlaneNormal),toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:E.getFrameOfReferenceUID(),viewPlaneNormal:E.getCamera().viewPlaneNormal}};fn(Y,E.element),g0(Y)}),F&&O.set(P,F)});const N=m.representations.CONTOUR.outlineWidthActive;T5(v,Object.assign({},m_(v),{segmentsHidden:new Set(D),segmentSpecificMap:O,outlineWidthActive:N})),E.resetCamera(),E.render()}I(348);let R7=!1;const A7={render:async function(E,u,g){var m;const{segmentationId:v}=u,S=dn(v);if(!S)return;let D=S.representationData[Nt.Contour];D||!Fp(u.segmentationRepresentationUID)||R7||(R7=!0,D=await M7(v,{segmentationRepresentationUID:u.segmentationRepresentationUID,viewport:E})),D&&(m=D)!==null&&m!==void 0&&(m=m.geometryIds)!==null&&m!==void 0&&m.length&&function(O,N,R,L,P){(R.size?S$:E$)(O,N,L,P)}(E,D.geometryIds,D.annotationUIDsMap,u,g)},removeSegmentationRepresentation:function(E,u){let g=arguments.length>2&&arguments[2]!==void 0&&arguments[2];(function(m,v){const S=qn(m);if(S===void 0)throw new Error("ToolGroup with ToolGroupId ".concat(m," does not exist"));const{viewportsInfo:D}=S;for(const O of D){const{viewportId:N,renderingEngineId:R}=O;(0,j.getEnabledElementByIds)(N,R),DW(v,m)}})(E,u),yd(E,u),function(m){E5.delete(m)}(u),g&&qn(E).getViewportsInfo().forEach(m=>{let{viewportId:v,renderingEngineId:S}=m;(0,j.getEnabledElementByIds)(v,S).viewport.render()})}},C1=Gc.toolName;class L3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{configuration:{}}),$(this,"renderSegmentation",u=>{const g=qn(u);if(!g)return;const m=Hi(u);if(!m||m.length===0)return;const v=g.viewportsInfo.map(D=>{let{renderingEngineId:O,viewportId:N}=D;const R=(0,j.getEnabledElementByIds)(N,O);if(R)return R.viewport}),S=m.map(D=>{const O=this._getMergedRepresentationsConfig(u),N=[],R={[Nt.Labelmap]:c_,[Nt.Contour]:A7,[Nt.Surface]:_W};D.type===Nt.Contour&&this.addPlanarFreeHandToolIfAbsent(u);const L=R[D.type];for(const P of v){const F=L.render(P,D,O);N.push(F)}return N});Promise.allSettled(S).then(()=>{v.forEach(D=>{D.render()})})})}onSetToolEnabled(){const u=this.toolGroupId,g=Hi(u);g&&g.length!==0&&g.forEach(m=>{s5(u,m.segmentationRepresentationUID,!0)})}onSetToolDisabled(){const u=this.toolGroupId,g=Hi(u);g&&g.length!==0&&g.forEach(m=>{s5(u,m.segmentationRepresentationUID,!1)})}addPlanarFreeHandToolIfAbsent(u){C1 in Ke.tools||Y_(Gc);const g=qn(u);g.hasTool(C1)||(g.addTool(C1),g.setToolPassive(C1))}_getMergedRepresentationsConfig(u){const g=kp(u),m=Ed();return j.utilities.deepMerge(m,g)}}$(L3,"toolName",void 0),L3.toolName="SegmentationDisplay";const k3=L3,L7=new class{constructor(){$(this,"_needsRender",new Set),$(this,"_animationFrameSet",!1),$(this,"_animationFrameHandle",null),$(this,"hasBeenDestroyed",void 0),$(this,"_renderFlaggedToolGroups",()=>{this._throwIfDestroyed();const E=Array.from(this._needsRender.values());for(const u of E)if(this._triggerRender(u),this._needsRender.delete(u),this._needsRender.size===0)return this._animationFrameSet=!1,void(this._animationFrameHandle=null)})}removeToolGroup(E){this._needsRender.delete(E),this._needsRender.size===0&&this._reset()}renderToolGroupSegmentations(E){this._setToolGroupSegmentationToBeRenderedNextFrame([E])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setToolGroupSegmentationToBeRenderedNextFrame(E){E.forEach(u=>{this._needsRender.add(u)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedToolGroups),this._animationFrameSet=!0)}_triggerRender(E){const u=qn(E);if(!u)return void console.warn("No tool group found with toolGroupId: ".concat(E));const{viewportsInfo:g}=u,m=g.map(D=>{let{viewportId:O,renderingEngineId:N}=D;const R=(0,j.getRenderingEngine)(N);return R?R.getViewport(O)||void 0:void console.warn("rendering Engine has been destroyed")}).filter(Boolean),v=u.getToolInstance(k3.toolName);function S(D){const{element:O,viewportId:N,renderingEngineId:R}=D.detail;O.removeEventListener(j.Enums.Events.IMAGE_RENDERED,S);const L=nr(N,R);if(!L)return void console.warn("toolGroup has been destroyed");const P={toolGroupId:L.id,viewportId:N};(0,j.triggerEvent)(j.eventTarget,Q.SEGMENTATION_RENDERED,{...P})}v?(m.forEach(D=>{let{element:O}=D;O.addEventListener(j.Enums.Events.IMAGE_RENDERED,S)}),v.renderSegmentation(E)):console.warn("No segmentation tool found inside",E)}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}};function x1(E){L7.renderToolGroupSegmentations(E)}const qd=x1,k7=new Map;function Xd(E){var u;const g=E.detail,{viewportId:m,renderingEngineId:v}=g,{viewport:S}=(0,j.getEnabledElementByIds)(m,v),D=nr(m,v);if(!D)return;let O=Hi(D.id)||[];if(O=O.filter(F=>F.type===Nt.Labelmap),(u=O)===null||u===void 0||!u.length)return;const N={};O.forEach(F=>{var V;const G=dn(F.segmentationId);if(!G||(V=G.representationData)===null||V===void 0||!V.LABELMAP)return;const W=G.representationData.LABELMAP;if(Zn(W,S))return;const{imageIdReferenceMap:q}=W;N[F.segmentationRepresentationUID]={imageIdReferenceMap:q}});const R=Object.keys(N),L=S.getCurrentImageId(),P=S.getActors();P.find(F=>!!R.includes(F.uid))?P.forEach(F=>{if(!R.includes(F.uid))return;const V=F.actor,{imageIdReferenceMap:G}=N[F.uid],W=G.get(L),q=V.getMapper().getInputData();if(!W){if(q.setDerivedImage)return void q.setDerivedImage(null);const xe=a5().newInstance({name:"Pixels",numberOfComponents:1,values:new Uint8Array(q.getNumberOfPoints())}),Ee=o5().newInstance();return Ee.getPointData().setScalars(xe),void V.getMapper().setInputData(Ee)}const Y=j.cache.getImage(W),{dimensions:Z,spacing:ne,direction:oe}=S.getImageDataMetadata(Y),ue=j.cache.getImage(L)||{imageId:L},{origin:ge}=S.getImageDataMetadata(ue),me=ge;if(q.setOrigin(me),q.modified(),q.getDimensions()[0]!==Z[0]||q.getDimensions()[1]!==Z[1])return S.removeActors([F.uid]),S.addImages([{imageId:W,actorUID:F.uid,callback:xe=>{let{imageActor:Ee}=xe;const Ie=a5().newInstance({name:"Pixels",numberOfComponents:1,values:[...Y.getPixelData()]}),be=o5().newInstance();be.setDimensions(Z[0],Z[1],1),be.setSpacing(ne),be.setDirection(oe),be.setOrigin(me),be.getPointData().setScalars(Ie),Ee.getMapper().setInputData(be)}}]),void qd(D.id);q.setDerivedImage?q.setDerivedImage(Y):j.utilities.updateVTKImageDataWithCornerstoneImage(q,Y),S.render(),E.type===j.Enums.Events.IMAGE_RENDERED&&S.element.removeEventListener(j.Enums.Events.IMAGE_RENDERED,Xd)}):k7.has(D.id)||(k7.set(D.id,!0),qd(D.id))}const P7={enable:function(E){const{viewport:u}=(0,j.getEnabledElement)(E);u instanceof j.BaseVolumeViewport||(E.addEventListener(j.Enums.Events.STACK_NEW_IMAGE,Xd),E.addEventListener(j.Enums.Events.IMAGE_RENDERED,Xd))},disable:function(E){E.removeEventListener(j.Enums.Events.STACK_NEW_IMAGE,Xd),E.removeEventListener(j.Enums.Events.IMAGE_RENDERED,Xd)}},F7=function(E){c0(E.detail.element)},V7={enable:function(E){E.addEventListener(j.Enums.Events.IMAGE_RENDERED,F7)},disable:function(E){E.removeEventListener(j.Enums.Events.IMAGE_RENDERED,F7)}};function _0(E,u,g){const{renderingEngineId:m,viewportId:v}=E.detail,S=nr(v,m);if(!S)return[];const D=[],O=Object.keys(S.toolOptions);for(let N=0;N<O.length;N++){const R=O[N],L=S.toolOptions[R],P=g!=null&&L.bindings.length&&L.bindings.some(F=>F.mouseButton===g);if(u.includes(L.mode)&&(!g||P)){const F=S.getToolInstance(R);D.push(F)}}return D}const{Active:T$,Passive:_$,Enabled:D$}=ke,U7=function(E){_0(E,[T$,_$,D$]).forEach(u=>{u.onCameraModified&&u.onCameraModified(E)})},B7={enable:function(E){E.addEventListener(j.Enums.Events.CAMERA_MODIFIED,U7)},disable:function(E){E.removeEventListener(j.Enums.Events.CAMERA_MODIFIED,U7)}},{Active:b$,Passive:I$,Enabled:O$}=ke,G7=function(E){_0(E,[b$,I$,O$]).forEach(u=>{u.onImageSpacingCalibrated&&u.onImageSpacingCalibrated(E)})},z7={enable:function(E){E.addEventListener(j.Enums.Events.IMAGE_SPACING_CALIBRATED,G7)},disable:function(E){E.removeEventListener(j.Enums.Events.IMAGE_SPACING_CALIBRATED,G7)}},{Active:M$,Passive:N$,Enabled:R$}=ke,W7=function(E){_0(E,[M$,N$,R$]).forEach(u=>{u.onResetCamera&&u.onResetCamera(E)})},j7={enable:function(E){E.addEventListener(j.Enums.Events.CAMERA_RESET,W7)},disable:function(E){E.removeEventListener(j.Enums.Events.CAMERA_RESET,W7)}},{Active:A$}=ke;function zc(E,u,g){if(Ke.isInteractingWithTool)return!1;const{renderingEngineId:m,viewportId:v}=g.detail,S=nr(v,m);if(!S)return!1;let D;const O=Object.keys(S.toolOptions);for(let N=0;N<O.length;N++){const R=O[N],L=S.toolOptions[R],P=S.getToolInstance(R);if(L.mode===A$&&typeof P[u]=="function"){D=S.getToolInstance(R);break}}D&&D[u](g)}const H7=zc.bind(null,"Mouse","mouseClickCallback");function $7(E,u,g){const m=(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse")==="touch"?36:6,v=[];return u.forEach(S=>{let{tool:D,annotations:O}=S;for(const N of O){if(N.isLocked||!N.isVisible)continue;const R=D.getHandleNearImagePoint(E,N,g,m);if(R){v.push({tool:D,annotation:N,handle:R});break}}}),v}function Yd(E,u){const g=[];for(let v=0;v<u.length;v++){var m;const S=u[v];if(!S){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let D=an(S.constructor.toolName,E);(m=D)!==null&&m!==void 0&&m.length&&(typeof S.filterInteractableAnnotationsForElement=="function"&&(D=S.filterInteractableAnnotationsForElement(E,D)),D.length>0&&g.push({tool:S,annotations:D}))}return g}function P3(E,u,g){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse";const v=m==="touch"?36:6,S=[];return u.forEach(D=>{let{tool:O,annotations:N}=D;for(const R of N)if(!R.isLocked&&R.isVisible&&O.isPointNearTool(E,R,g,v,m)){S.push({tool:O,annotation:R});break}}),S}const{Active:L$}=ke;function F3(E){const{renderingEngineId:u,viewportId:g}=E.detail,m=E.detail.event,v=T0(m)||o0.getModifierKey(),S=nr(g,u);if(!S)return null;const D=Object.keys(S.toolOptions),O=S.getDefaultMousePrimary();for(let N=0;N<D.length;N++){const R=D[N],L=S.toolOptions[R],P=L.bindings.length&&L.bindings.some(F=>F.mouseButton===(m?m.buttons:O)&&F.modifierKey===v);if(L.mode===L$&&P)return S.getToolInstance(R)}}const{Active:k$,Passive:P$}=ke,{Active:F$,Passive:V$}=ke;function K7(E){if(Ke.isInteractingWithTool)return;const u=F3(E);if(u&&typeof u.preMouseDownCallback=="function"&&u.preMouseDownCallback(E))return;const g=E.detail.event.buttons===1,m=[..._0(E,[F$],E.detail.event.buttons)||[],...(g?_0(E,[V$]):void 0)||[]];if(function(P){if(Ke.isInteractingWithTool)return!1;const F=P.detail,{element:V}=F,G=(0,j.getEnabledElement)(V),{canvas:W}=F.currentPoints;if(!G)return!1;const q=function(Z,ne){var oe;const ue=new Map,{renderingEngineId:ge,viewportId:me}=Z.detail,xe=nr(me,ge);if(!xe)return ue;const Ee=Object.keys(xe.toolOptions),Ie=xe.getDefaultMousePrimary(),be=Z.detail.event,Ne=(oe=be==null?void 0:be.buttons)!==null&&oe!==void 0?oe:Ie,_e=T0(be)||o0.getModifierKey();for(let Ze=0;Ze<Ee.length;Ze++){var Me,Pe;const Ye=Ee[Ze],at=xe.getToolInstance(Ye),ot=(Me=(Pe=at.configuration)===null||Pe===void 0?void 0:Pe.actions)!==null&&Me!==void 0?Me:{},st=Object.values(ot);if(st==null||!st.length||!ne.includes(at.mode))continue;const ct=st.find(Tt=>Tt.bindings.length&&Tt.bindings.some(pt=>pt.mouseButton===Ne&&pt.modifierKey===_e));ct&&ue.set(at,ct)}return ue}(P,[k$,P$]),Y=P3(V,Yd(V,Array.from(q.keys())),W);if(Y.length>0){const{tool:Z,annotation:ne}=Y[0],oe=q.get(Z);return(typeof oe.method=="string"?Z[oe.method]:oe.method).call(Z,P,ne),!0}return!1}(E))return;const v=E.detail,{element:S}=v,D=Yd(S,m),O=v.currentPoints.canvas,N=$7(S,D,O,"mouse"),R=!!E.detail.event.shiftKey;if(N.length>0){const{tool:P,annotation:F,handle:V}=q7(N);return X7(F.annotationUID,R),void P.handleSelectedCallback(E,F,V,"Mouse")}const L=P3(S,D,O,"mouse");if(L.length>0){const{tool:P,annotation:F}=q7(L);return X7(F.annotationUID,R),void P.toolSelectedCallback(E,F,"Mouse",O)}!u||typeof u.postMouseDownCallback!="function"||u.postMouseDownCallback(E)}function q7(E){return E.length>1&&E.find(u=>!cr(u.annotation)&&mr(u.annotation.annotationUID))||E[0]}function X7(E){arguments.length>1&&arguments[1]!==void 0&&arguments[1]?zo(E)?oa(E,!1):oa(E,!0,!0):oa(E,!0,!1)}function Y7(E){if(Ke.isInteractingWithTool)return;const u=F3(E);u&&!Ke.isMultiPartToolActive&&u.addNewAnnotation&&oa(u.addNewAnnotation(E,"mouse").annotationUID)}const J7=zc.bind(null,"Mouse","doubleClickCallback");function Z7(E){if(Ke.isInteractingWithTool)return;const u=F3(E);!u||typeof u.mouseDragCallback!="function"||u.mouseDragCallback(E)}const{Active:U$,Passive:B$}=ke;function Q7(E){if(Ke.isInteractingWithTool||Ke.isMultiPartToolActive)return;const u=_0(E,[U$,B$]),g=E.detail,{element:m}=g,v=Yd(m,u),S=u.filter(O=>!v.some(N=>N.tool.getToolName()===O.getToolName()));let D=!1;for(const{tool:O,annotations:N}of v)typeof O.mouseMoveCallback=="function"&&(D=O.mouseMoveCallback(E,N)||D);S.forEach(O=>{typeof O.mouseMoveCallback=="function"&&O.mouseMoveCallback(E)}),D===!0&&c0(m)}const eD=zc.bind(null,"Mouse","mouseUpCallback"),tD=zc.bind(null,"MouseWheel","mouseWheelCallback"),nD={enable:function(E){E.addEventListener(Q.MOUSE_CLICK,H7),E.addEventListener(Q.MOUSE_DOWN,K7),E.addEventListener(Q.MOUSE_DOWN_ACTIVATE,Y7),E.addEventListener(Q.MOUSE_DOUBLE_CLICK,J7),E.addEventListener(Q.MOUSE_DRAG,Z7),E.addEventListener(Q.MOUSE_MOVE,Q7),E.addEventListener(Q.MOUSE_UP,eD),E.addEventListener(Q.MOUSE_WHEEL,tD)},disable:function(E){E.removeEventListener(Q.MOUSE_CLICK,H7),E.removeEventListener(Q.MOUSE_DOWN,K7),E.removeEventListener(Q.MOUSE_DOWN_ACTIVATE,Y7),E.removeEventListener(Q.MOUSE_DOUBLE_CLICK,J7),E.removeEventListener(Q.MOUSE_DRAG,Z7),E.removeEventListener(Q.MOUSE_MOVE,Q7),E.removeEventListener(Q.MOUSE_UP,eD),E.removeEventListener(Q.MOUSE_WHEEL,tD)}},{Active:G$}=ke;function rD(E){const{renderingEngineId:u,viewportId:g}=E.detail,m=Zt.mouseButton,v=o0.getModifierKey(),S=nr(g,u);if(!S)return null;const D=Object.keys(S.toolOptions),O=S.getDefaultMousePrimary();for(let N=0;N<D.length;N++){const R=D[N],L=S.toolOptions[R];if(L.mode===G$&&L.bindings.length&&L.bindings.some(P=>P.mouseButton===(m??O)&&P.modifierKey===v))return S.getToolInstance(R)}}function iD(E){const u=rD(E);if(u){const{renderingEngineId:m,viewportId:v}=E.detail,S=nr(v,m),D=u.getToolName();Object.keys(S.toolOptions).includes(D)&&S.setViewportsCursorByToolName(D)}const g=function(m,v){const S=new Map,{renderingEngineId:D,viewportId:O}=m.detail,N=nr(O,D);if(!N)return S;const R=Object.keys(N.toolOptions),L=m.detail.key;for(let F=0;F<R.length;F++){var P;const V=R[F],G=N.getToolInstance(V),W=(P=G.configuration)===null||P===void 0?void 0:P.actions;if(!W)continue;const q=Object.values(W);if(q==null||!q.length||!v.includes(G.mode))continue;const Y=q.find(Z=>Z.bindings.some(ne=>ne.key===L));Y&&S.set(G,Y)}return S}(E,[ke.Active]);if(g!=null&&g.size){const{element:m}=E.detail;for(const[v,S]of[...g.entries()])(typeof S.method=="function"?S.method:v[S.method]).call(v,m,S,E)}}function aD(E){const u=rD(E);if(!u)return;const{renderingEngineId:g,viewportId:m}=E.detail,v=nr(m,g);k6();const S=u.getToolName();Object.keys(v.toolOptions).includes(S)&&v.setViewportsCursorByToolName(S)}const oD={enable:function(E){E.addEventListener(Q.KEY_DOWN,iD),E.addEventListener(Q.KEY_UP,aD)},disable:function(E){E.removeEventListener(Q.KEY_DOWN,iD),E.removeEventListener(Q.KEY_UP,aD)}},{Active:z$}=ke;function V3(E){const{renderingEngineId:u,viewportId:g}=E.detail,m=E.detail.event,v=nr(g,u);if(!v)return null;const S=Object.keys(v.toolOptions),D=Object.keys(m.touches).length,O=T0(m)||o0.getModifierKey(),N=v.getDefaultMousePrimary();for(let R=0;R<S.length;R++){const L=S[R],P=v.toolOptions[L],F=P.bindings.length&&P.bindings.some(V=>(V.numTouchPoints===D||D===1&&V.mouseButton===N)&&V.modifierKey===O);if(P.mode===z$&&F)return v.getToolInstance(L)}}function sD(E,u,g){const{renderingEngineId:m,viewportId:v}=E.detail,S=nr(v,m);if(!S)return[];const D=[],O=Object.keys(S.toolOptions);for(let N=0;N<O.length;N++){const R=O[N],L=S.toolOptions[R],P=g!=null&&L.bindings.length&&L.bindings.some(F=>F.numTouchPoints===g);if(u.includes(L.mode)&&(!g||P)){const F=S.getToolInstance(R);D.push(F)}}return D}const{Active:W$,Passive:j$}=ke;function lD(E){if(Ke.isInteractingWithTool)return;const u=V3(E);if(u&&typeof u.preTouchStartCallback=="function"&&u.preTouchStartCallback(E))return;const g=Object.keys(E.detail.event.touches).length===1,m=[...sD(E,[W$],Object.keys(E.detail.event.touches).length)||[],...(g?sD(E,[j$]):void 0)||[],u],v=E.detail,{element:S}=v,D=Yd(S,m),O=v.currentPoints.canvas,N=$7(S,D,O,"touch"),R=!1;if(N.length>0){const{tool:P,annotation:F,handle:V}=cD(N);return uD(F.annotationUID,R),void P.handleSelectedCallback(E,F,V,"Touch")}const L=P3(S,D,O,"touch");if(L.length>0){const{tool:P,annotation:F}=cD(L);return uD(F.annotationUID,R),void P.toolSelectedCallback(E,F,"Touch")}!u||typeof u.postTouchStartCallback!="function"||u.postTouchStartCallback(E)}function cD(E){return E.length>1&&E.find(u=>!cr(u.annotation)&&mr(u.annotation.annotationUID))||E[0]}function uD(E){arguments.length>1&&arguments[1]!==void 0&&arguments[1]?zo(E)?oa(E,!1):oa(E,!0,!0):oa(E,!0,!1)}function fD(E){if(Ke.isInteractingWithTool)return;const u=V3(E);u&&!Ke.isMultiPartToolActive&&u.addNewAnnotation&&oa(u.addNewAnnotation(E,"touch").annotationUID)}function dD(E){if(Ke.isInteractingWithTool)return;const u=V3(E);!u||typeof u.touchDragCallback!="function"||u.touchDragCallback(E)}const hD=zc.bind(null,"Touch","touchEndCallback"),H$=zc.bind(null,"Touch","touchTapCallback"),gD=zc.bind(null,"Touch","touchPressCallback"),pD={enable:function(E){E.addEventListener(Q.TOUCH_START,lD),E.addEventListener(Q.TOUCH_START_ACTIVATE,fD),E.addEventListener(Q.TOUCH_DRAG,dD),E.addEventListener(Q.TOUCH_END,hD),E.addEventListener(Q.TOUCH_TAP,H$),E.addEventListener(Q.TOUCH_PRESS,gD)},disable:function(E){E.removeEventListener(Q.TOUCH_START,lD),E.removeEventListener(Q.TOUCH_START_ACTIVATE,fD),E.removeEventListener(Q.TOUCH_DRAG,dD),E.removeEventListener(Q.TOUCH_END,hD),E.removeEventListener(Q.TOUCH_PRESS,gD)}};function mD(E){const{element:u,viewportId:g}=E.detail,m=function(S){const D="http://www.w3.org/2000/svg",O=document.createElementNS(D,"svg"),N="svg-layer-".concat(S);O.classList.add("svg-layer"),O.setAttribute("id",N),O.setAttribute("xmlns","http://www.w3.org/2000/svg"),O.style.width="100%",O.style.height="100%",O.style.pointerEvents="none",O.style.position="absolute";const R=document.createElementNS(D,"defs"),L=document.createElementNS(D,"filter"),P=document.createElementNS(D,"feOffset"),F=document.createElementNS(D,"feColorMatrix"),V=document.createElementNS(D,"feBlend");return L.setAttribute("id","shadow-".concat(N)),L.setAttribute("filterUnits","userSpaceOnUse"),P.setAttribute("result","offOut"),P.setAttribute("in","SourceGraphic"),P.setAttribute("dx","0.5"),P.setAttribute("dy","0.5"),F.setAttribute("result","matrixOut"),F.setAttribute("in","offOut"),F.setAttribute("in2","matrix"),F.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),V.setAttribute("in","SourceGraphic"),V.setAttribute("in2","matrixOut"),V.setAttribute("mode","normal"),L.appendChild(P),L.appendChild(F),L.appendChild(V),R.appendChild(L),O.appendChild(R),O}(g);var v;(function(S){const{viewportUid:D,renderingEngineUid:O}=S.dataset,N="".concat(D,":").concat(O);Ke.svgNodeCache[N]={}})(u),v=m,u.querySelector("div.viewport-element").appendChild(v),C5.addViewportElement(g,u),i6.enable(u),s6.enable(u),A6.enable(u),o0.enable(u),P7.enable(u),V7.enable(u),B7.enable(u),z7.enable(u),j7.enable(u),nD.enable(u),oD.enable(u),pD.enable(u),Ke.enabledElements.push(u)}const vD=function(E,u){const g=[];if(!u&&!E)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let m=0;m<Ke.synchronizers.length;m++){const v=Ke.synchronizers[m],S=!v.isDisabled(),D=v.hasSourceViewport(u,E),O=v.hasTargetViewport(u,E);S&&(D||O)&&g.push(v)}return g},yD=function(E){const{element:u,viewportId:g}=E.detail;(function(m){const{viewportUid:v,renderingEngineUid:S}=m.dataset,D="".concat(v,":").concat(S);delete Ke.svgNodeCache[D]})(u),function(m){const v=m.querySelector("div.".concat("viewport-element")),S=v.querySelector("svg");S&&v.removeChild(S)}(u),C5.removeViewportElement(g,u),i6.disable(u),s6.disable(u),A6.disable(u),o0.disable(u),P7.disable(u),V7.disable(u),B7.disable(u),z7.disable(u),j7.disable(u),nD.disable(u),oD.disable(u),pD.disable(u),(m=>{const v=(0,j.getEnabledElement)(m);vD(v.viewportId,v.renderingEngineId).forEach(S=>{S.remove(v)})})(u),(m=>{const{renderingEngineId:v,viewportId:S}=(0,j.getEnabledElement)(m),D=nr(S,v);D&&D.removeViewports(v,S)})(u),function(m){const v=Ke.enabledElements.findIndex(S=>S===m);v>-1&&Ke.enabledElements.splice(v,1)}(u)};function wD(E){Ad(E.detail.annotation)&&async function(u){const g=u.detail.annotation;if(!Ad(g))return;const m=function(L){const P=b_(L),F=P.find(V=>J_(V,!0));return F??P[0]}(g),v=function(L,P){const{annotationUID:F}=P;return Jt().filter(V=>V.annotationUID&&V.annotationUID!==F&&Ad(V)&&X_(V,P)&&L.isReferenceViewable(V.metadata))}(m,g);if(!v.length)return;const S=Jp(g.data.contour.polyline,m),D=function(L,P,F){const V=Dd(P);for(let G=0;G<F.length;G++){const W=F[G],q=Jp(W.data.contour.polyline,L),Y=F_(V,Dd(q)),Z=Y&&U_(P,q),ne=Y&&!Z&&F5(q,P);if(Z||ne)return{targetAnnotation:W,targetPolyline:q,isContourHole:ne}}}(m,S,v);if(!D)return;const{targetAnnotation:O,targetPolyline:N,isContourHole:R}=D;if(R){const{contourHoleProcessingEnabled:L=!1}=u.detail;if(!L)return;Z_(m,O,g)}else(function(L,P,F,V,G){if(!function(_e){const Me=_e.toolName;return!(!Me||!Ke.tools[Me])}(Gc))return void console.warn("".concat(Gc.toolName," is not registered in cornerstone"));if(!J_(L))return;const W=Nc(F,G[0]),q=function(_e,Me){return Ga(Me).map(Pe=>({annotation:Pe,polyline:Jp(Pe.data.contour.polyline,_e)}))}(L,P),Y=new Set(q),Z=new Map,ne=(_e,Me)=>{let Pe=Z.get(_e);Pe||(Pe=[],Z.set(_e,Pe)),Pe.push(Me),Y.delete(Me)},oe=[];if(W){const _e=H_(F,G);oe.push(_e),Array.from(Y.keys()).forEach(Me=>ne(_e,Me))}else $_(F,G).forEach(_e=>{oe.push(_e),Array.from(Y.keys()).forEach(Me=>{F5(_e,Me.polyline)&&(ne(_e,Me),Y.delete(Me))})});Array.from(Z.values()).forEach(_e=>_e.forEach(Me=>Pn(Me.annotation)));const{element:ue}=L,ge=(0,j.getEnabledElement)(ue),{metadata:me,data:xe}=P,{handles:Ee,segmentation:Ie}=xe,{textBox:be}=Ee;Ht(V.annotationUID),Ht(P.annotationUID);for(let _e=0;_e<oe.length;_e++){var Ne;const Me=oe[_e],Pe=L.canvasToWorld(Me[0]),Ze=L.canvasToWorld(Me[Me.length-1]),Ye={metadata:{...me,toolName:U5,originalToolName:me.originalToolName||me.toolName},data:{cachedStats:{},handles:{points:[Pe,Ze],textBox:be?{...be}:void 0},contour:{polyline:[],closed:!0},spline:P.data.spline,segmentation:{...Ie}},annotationUID:j.utilities.uuidv4(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:P.interpolationUID,interpolationCompleted:P.interpolationCompleted};_s(Ye,{points:Me,closed:!0,targetWindingDirection:p0.Clockwise},L),fn(Ye,ue),g0(Ye),Yt(Ye,L.element),(Ne=Z.get(Me))===null||Ne===void 0||Ne.forEach(at=>ar(Ye,at.annotation))}(function(_e,Me,Pe){const{viewport:Ze}=_e,{element:Ye}=Ze,{renderingEngine:at}=_e,ot=new Set([U5,Me.metadata.toolName,Pe.metadata.toolName]);for(const st of ot.values()){const ct=Mt(Ye,st);We(at,ct)}new Promise(st=>window.requestAnimationFrame(st))})(ge,P,V)})(m,O,N,g,S)}(E)}const CD=function(E){const{viewportId:u,renderingEngineId:g}=E.detail,m=(0,j.getRenderingEngine)(g);We(m,[u])},S1=function(E){E.detail.removed.length&&(0,j.getRenderingEngines)().forEach(u=>{const g=u.getViewports().map(m=>m.id);We(u,g)})};function $$(E){Ad(E.detail.annotation)&&function(u){Yp(u.detail.annotation)}(E)}const xD=function(E){const{segmentationId:u}=E.detail;bc(u).forEach(g=>{Hi(g).forEach(m=>{m.segmentationId===u&&ji(g,m.segmentationRepresentationUID)})})},SD=function(E){const{segmentationId:u}=E.detail,{type:g}=dn(u),m=bc(u);g===Nt.Labelmap&&function(v){const{segmentationId:S,modifiedSlicesToUse:D}=v.detail,{representationData:O,type:N}=dn(S),R=bc(S),L=O[N];"volumeId"in L&&function(P){let{modifiedSlicesToUse:F,representationData:V,type:G}=P;const W=j.cache.getVolume(V[G].volumeId);if(!W)return void console.warn("segmentation not found in cache");const{imageData:q,vtkOpenGLTexture:Y}=W;let Z;if(F&&Array.isArray(F))Z=F;else{const ne=q.getDimensions()[2];Z=[...Array(ne).keys()]}Z.forEach(ne=>{Y.setUpdatedFrame(ne)}),q.modified()}({modifiedSlicesToUse:D,representationData:O,type:N}),"imageIdReferenceMap"in L&&function(P){let{toolGroupIds:F,segmentationId:V,representationData:G,type:W}=P;F.forEach(q=>{const Y=Hi(q),Z=qn(q).getViewportsInfo();Y.forEach(ne=>{ne.segmentationId===V&&Z.forEach(oe=>{let{viewportId:ue,renderingEngineId:ge}=oe;const me=(0,j.getEnabledElementByIds)(ue,ge).viewport;if(me instanceof j.VolumeViewport)return;const xe=me.getActor(ne.segmentationRepresentationUID);if(!xe)return;const Ee=me.getCurrentImageId(),Ie=xe.actor.getMapper().getInputData(),{imageIdReferenceMap:be}=G[W],Ne=be.get(Ee),_e=j.cache.getImage(Ne);Ie.modified(),j.utilities.updateVTKImageDataWithCornerstoneImage(Ie,_e)})})})}({toolGroupIds:R,segmentationId:S,representationData:O,type:N})}(E),m.forEach(v=>{qd(v)})},ED=function(E){const{toolGroupId:u}=E.detail;qd(u)},TD=function(E){const{toolGroupId:u,segmentationRepresentationUID:g}=E.detail;qd(u)},_D={enable:function(){j.eventTarget.addEventListener(Q.ANNOTATION_COMPLETED,Oi.handleAnnotationCompleted),j.eventTarget.addEventListener(Q.ANNOTATION_MODIFIED,Oi.handleAnnotationUpdate),j.eventTarget.addEventListener(Q.ANNOTATION_REMOVED,Oi.handleAnnotationDelete)},disable:function(){j.eventTarget.removeEventListener(Q.ANNOTATION_COMPLETED,Oi.handleAnnotationCompleted),j.eventTarget.removeEventListener(Q.ANNOTATION_MODIFIED,Oi.handleAnnotationUpdate),j.eventTarget.removeEventListener(Q.ANNOTATION_REMOVED,Oi.handleAnnotationDelete)}},DD=function(E,u,g){const m=Hi(E);if(!m||m.length===0)return;const v=m.map(D=>D.segmentationRepresentationUID);let S=u;if(S){const D=u.filter(O=>!v.includes(O));if(D.length>0)throw new Error("The following segmentationRepresentationUIDs are not part of the toolGroup: ".concat(JSON.stringify(D)))}else S=v;S.forEach(D=>{(function(O,N,R){const L=hl(O,N),{type:P}=L;if(P===Nt.Labelmap)c_.removeSegmentationRepresentation(O,N,R);else{if(P!==Nt.Contour)throw new Error("The representation ".concat(P," is not supported yet"));A7.removeSegmentationRepresentation(O,N,R)}})(E,D,g)})},bD=function(E){const u=Ke.toolGroups.findIndex(g=>g.id===E);u>-1&&(L7.removeToolGroup(E),DD(E),Ke.toolGroups.splice(u,1))},ID=function(){const E=[...Ke.toolGroups];for(const u of E)bD(u.id);Ke.toolGroups=[]};let U3=!1;function K$(){U3||(function(){OD();const E=j.Enums.Events.ELEMENT_ENABLED,u=j.Enums.Events.ELEMENT_DISABLED;j.eventTarget.addEventListener(E,mD),j.eventTarget.addEventListener(u,yD),_D.enable()}(),MD(),j.eventTarget.addEventListener(Q.ANNOTATION_COMPLETED,wD),j.eventTarget.addEventListener(Q.ANNOTATION_MODIFIED,CD),j.eventTarget.addEventListener(Q.ANNOTATION_SELECTION_CHANGE,S1),j.eventTarget.addEventListener(Q.ANNOTATION_SELECTION_CHANGE,S1),j.eventTarget.addEventListener(Q.ANNOTATION_REMOVED,$$),j.eventTarget.addEventListener(Q.SEGMENTATION_MODIFIED,xD),j.eventTarget.addEventListener(Q.SEGMENTATION_DATA_MODIFIED,SD),j.eventTarget.addEventListener(Q.SEGMENTATION_REPRESENTATION_MODIFIED,ED),j.eventTarget.addEventListener(Q.SEGMENTATION_REPRESENTATION_REMOVED,TD),U3=!0)}function q$(){OD(),MD(),ID(),_c={},Ke={...it()({...Dc,svgNodeCache:{}}),svgNodeCache:{...Dc.svgNodeCache}};const E=tr(),u=or();E.restoreAnnotations({}),u.resetState(),U3=!1}function OD(){const E=j.Enums.Events.ELEMENT_ENABLED,u=j.Enums.Events.ELEMENT_DISABLED;j.eventTarget.removeEventListener(E,mD),j.eventTarget.removeEventListener(u,yD),_D.disable()}function MD(){j.eventTarget.removeEventListener(Q.ANNOTATION_COMPLETED,wD),j.eventTarget.removeEventListener(Q.ANNOTATION_MODIFIED,CD),j.eventTarget.removeEventListener(Q.ANNOTATION_SELECTION_CHANGE,S1),j.eventTarget.removeEventListener(Q.ANNOTATION_SELECTION_CHANGE,S1),j.eventTarget.removeEventListener(Q.SEGMENTATION_MODIFIED,xD),j.eventTarget.removeEventListener(Q.SEGMENTATION_DATA_MODIFIED,SD),j.eventTarget.removeEventListener(Q.SEGMENTATION_REPRESENTATION_MODIFIED,ED),j.eventTarget.removeEventListener(Q.SEGMENTATION_REPRESENTATION_REMOVED,TD)}function X$(E){const u=Yd(E,d_(E,[ke.Active,ke.Passive]));for(const{tool:g}of u){const m=g.cancel(E);if(m)return m}}function ND(E,u){return E.findIndex(g=>u.renderingEngineId===g.renderingEngineId&&u.viewportId===g.viewportId)}function E1(E,u){return E.some(g=>g.renderingEngineId===u.renderingEngineId&&g.viewportId===u.viewportId)}const RD=class{constructor(E,u,g,m){$(this,"_enabled",void 0),$(this,"_eventName",void 0),$(this,"_auxiliaryEventNames",void 0),$(this,"_eventHandler",void 0),$(this,"_ignoreFiredEvents",void 0),$(this,"_sourceViewports",void 0),$(this,"_targetViewports",void 0),$(this,"_viewportOptions",{}),$(this,"_options",void 0),$(this,"id",void 0),$(this,"_onEvent",v=>{if(this._ignoreFiredEvents===!0||!this._targetViewports.length)return;const S=(0,j.getEnabledElement)(v.currentTarget);if(!S)return;const{renderingEngineId:D,viewportId:O}=S;this._sourceViewports.find(N=>N.viewportId===O)&&this.fireEvent({renderingEngineId:D,viewportId:O},v)}),this._enabled=!0,this._eventName=u,this._eventHandler=g,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=m||{},this._auxiliaryEventNames=this._options.auxiliaryEventNames||[],this.id=E}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(E){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._viewportOptions[E]=u}setEnabled(E){this._enabled=E}getOptions(E){return this._viewportOptions[E]}add(E){this.addTarget(E),this.addSource(E)}addSource(E){if(E1(this._sourceViewports,E))return;const{renderingEngineId:u,viewportId:g}=E,m=(0,j.getRenderingEngine)(u).getViewport(g);if(!m)return void console.warn("Synchronizer.addSource: No viewport for ".concat(u," ").concat(g));const v=m.element;v.addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEventNames.length&&this._auxiliaryEventNames.forEach(S=>{v.addEventListener(S,this._onEvent.bind(this))}),this._updateDisableHandlers(),this._sourceViewports.push(E)}addTarget(E){E1(this._targetViewports,E)||(this._targetViewports.push(E),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach(E=>this.removeSource(E)),this._targetViewports.forEach(E=>this.removeTarget(E))}remove(E){this.removeTarget(E),this.removeSource(E)}removeSource(E){const u=ND(this._sourceViewports,E);if(u===-1)return;const g=function(m){const v=(0,j.getRenderingEngine)(m.renderingEngineId);if(!v)throw new Error("No RenderingEngine for Id: ".concat(m.renderingEngineId));return v.getViewport(m.viewportId).element}(E);this._sourceViewports.splice(u,1),g.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEventNames&&this._auxiliaryEventNames.forEach(m=>{g.removeEventListener(m,this._eventHandler)}),this._updateDisableHandlers()}removeTarget(E){const u=ND(this._targetViewports,E);u!==-1&&(this._targetViewports.splice(u,1),this._updateDisableHandlers())}hasSourceViewport(E,u){return E1(this._sourceViewports,{renderingEngineId:E,viewportId:u})}hasTargetViewport(E,u){return E1(this._targetViewports,{renderingEngineId:E,viewportId:u})}fireEvent(E,u){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const g=[];try{for(let m=0;m<this._targetViewports.length;m++){const v=this._targetViewports[m];if(E.viewportId===v.viewportId)continue;const S=this._eventHandler(this,E,v,u,this._options);S instanceof Promise&&g.push(S)}}catch(m){console.warn("Synchronizer, for: ".concat(this._eventName),m)}finally{g.length?Promise.allSettled(g).then(()=>{this._ignoreFiredEvents=!1}):this._ignoreFiredEvents=!1}}_hasSourceElements(){return this._sourceViewports.length!==0}_updateDisableHandlers(){const E=function(m,v){const S=[],D=m.concat(v);for(let O=0;O<D.length;O++){const N=D[O];S.some(R=>N.renderingEngineId===R.renderingEngineId&&N.viewportId===R.viewportId)||S.push(N)}return S}(this._sourceViewports,this._targetViewports),u=this.remove,g=m=>{u(m.detail.element)};E.forEach(function(m){const v=(0,j.getRenderingEngine)(m.renderingEngineId);if(!v)return;const S=v.getViewport(m.viewportId);if(!S)return;const{element:D}=S;D.removeEventListener(j.Enums.Events.ELEMENT_DISABLED,g),D.addEventListener(j.Enums.Events.ELEMENT_DISABLED,g)})}},Wc=function(E,u,g,m){if(Ke.synchronizers.some(S=>S.id===E))throw new Error("Synchronizer with id '".concat(E,"' already exists."));const v=new RD(E,u,g,m);return Ke.synchronizers.push(v),v},Y$=function(){for(;Ke.synchronizers.length>0;)Ke.synchronizers.pop().destroy()},J$=function(E){return Ke.synchronizers.find(u=>u.id===E)},Z$=function(){return Ke.synchronizers},Q$=function(E){const u=Ke.synchronizers.findIndex(g=>g.id===E);u>-1&&(Ke.synchronizers[u].destroy(),Ke.synchronizers.splice(u,1))};var eK=I(485),tK=I.n(eK);class Jd extends Mi{constructor(u,g,m,v,S){super(v||Jd.getUniqueInstanceName("image-cursor"),S),$(this,"url",void 0),$(this,"x",void 0),$(this,"y",void 0),this.url=u,this.x=Number(g)||0,this.y=Number(m)||0}getStyleProperty(){const{url:u,x:g,y:m}=this;let v="url('".concat(u,"')");return g>=0&&m>=0&&(g>0||m>0)&&(v+=" ".concat(g," ").concat(m)),this.addFallbackStyleProperty(v)}static getUniqueInstanceName(u){return"".concat(u,"-").concat(j.utilities.getRuntimeId(Jd))}}const bn={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},la={x:127,y:60},D0=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,wl=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,T1='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',b0='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',_1='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',D1={Angle:In(bn,{iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:In(bn,{iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:In(bn,{iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:In(bn,{iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:In(bn,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:In(bn,{iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:In(bn,{iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:In(bn,{iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:In(bn,{iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:In(bn,{iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:In(bn,{iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:In(bn,{iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),TextMarker:In(bn,{iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:In(bn,{iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:In(bn,{iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:In(bn,{iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:In(bn,{iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:In(bn,{iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:In(bn,{iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:In(bn,{iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:In(bn,{iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:In(bn,{iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:In(bn,{iconContent:"".concat(T1," ").concat(D0),viewBox:la}),SegmentationFreeHandFillInside:In(bn,{iconContent:"".concat(T1," ").concat(wl),viewBox:la}),SegmentationFreeHandEraseOutside:In(bn,{iconContent:"".concat(T1," ").concat(D0),viewBox:la}),SegmentationFreeHandFillOutside:In(bn,{iconContent:"".concat(T1," ").concat(wl),viewBox:la}),SegmentationRectangleEraseInside:In(bn,{iconContent:"".concat(b0," ").concat(D0),viewBox:la}),RectangleScissor:In(bn,{iconContent:"".concat(b0," ").concat(wl),viewBox:la}),"RectangleScissor.FILL_INSIDE":In(bn,{iconContent:"".concat(b0," ").concat(wl),viewBox:la}),"RectangleScissor.FILL_OUTSIDE":In(bn,{iconContent:"".concat(b0," ").concat(wl),viewBox:la}),"RectangleScissor.ERASE_OUTSIDE":In(bn,{iconContent:"".concat(b0," ").concat(D0),viewBox:la}),"RectangleScissor.ERASE_INSIDE":In(bn,{iconContent:"".concat(b0," ").concat(D0),viewBox:la}),CircleScissor:In(bn,{iconContent:"".concat(_1," ").concat(wl),viewBox:la}),"CircleScissor.FILL_INSIDE":In(bn,{iconContent:"".concat(_1," ").concat(wl),viewBox:la}),"CircleScissor.ERASE_OUTSIDE":In(bn,{iconContent:"".concat(_1," ").concat(D0),viewBox:la}),"CircleScissor.FILL_OUTSIDE":In(bn,{iconContent:"".concat(_1," ").concat(wl),viewBox:la})};function In(E,u){return Object.assign(Object.create(E),u)}function nK(E,u,g){D1[E]=In(bn,{iconContent:u,viewBox:g})}const rK=Object.keys(D1),iK=Is.Highlighted,aK=ke.Active;class jc extends Jd{constructor(u,g,m,v,S){super(u,g,m,v,S)}static getDefinedCursor(u){let g=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2?arguments[2]:void 0;m||(m=y0("color",{},iK,aK));const v=function(D,O,N){return"".concat(O?"pointer":"cursor",":").concat(D,"/").concat(N)}(u,g,m);let S=super.getDefinedCursor(v);if(!S){const D=function(O){return D1[O]}(u);D&&(S=function(O,N,R,L,P){const{x:F,y:V}=O.mousePoint;return new jc(function(G,W,q){return URL.createObjectURL(function(Y,Z,ne){const oe=(Z?sK:oK)(Y,ne);return new Blob([oe],{type:"image/svg+xml"})}(G,W,q))}(O,R,{color:L}),F,V,N,P)}(D,v,g,m,super.getDefinedCursor("default")),super.setDefinedCursor(v,S))}return S}}function AD(E,u){const g=Object(u),m=Object.prototype.hasOwnProperty.bind(g);return(E+"").replace(/\{\{(\w+)\}\}/g,(v,S)=>m(S)?g[S]+"":"")}function oK(E,u){const{iconContent:g,iconSize:m,viewBox:v}=E;return AD(`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="`.concat(m,'" height="').concat(m,`" viewBox="0 0
      `).concat(v.x," ").concat(v.y,`">
      `).concat(g,`
    </svg>`),u)}function sK(E,u){const{iconContent:g,iconSize:m,viewBox:v,mousePointerGroupString:S}=E,D=m/Math.max(v.x,v.y,1),O=16+m;return AD(`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="`.concat(O,'" height="').concat(O,'" viewBox="0 0 ').concat(O," ").concat(O,`">
      <g>`).concat(S,`</g>
      <g transform="translate(16, 16) scale(`).concat(D,')">').concat(g,`</g>
    </svg>`),u)}const{Active:Zd,Passive:B3,Enabled:G3,Disabled:z3}=ke,lK=[{mouseButton:Uc.Primary}];class cK{constructor(u){$(this,"id",void 0),$(this,"viewportsInfo",[]),$(this,"toolOptions",{}),$(this,"currentActivePrimaryToolName",null),$(this,"prevActivePrimaryToolName",null),$(this,"restoreToolOptions",{}),$(this,"_toolInstances",{}),this.id=u}getViewportIds(){return this.viewportsInfo.map(u=>{let{viewportId:g}=u;return g})}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(u){const g=this._toolInstances[u];if(g)return g;console.warn("'".concat(u,"' is not registered with this toolGroup (").concat(this.id,")."))}getToolInstances(){return this._toolInstances}hasTool(u){return!!this._toolInstances[u]}addTool(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m=Ke.tools[u],v=u!==void 0&&u!=="",S=this.toolOptions[u];if(!v)return void console.warn("Tool with configuration did not produce a toolName: ",g);if(!m)return void console.warn("'".concat(u,"' is not registered with the library. You need to use cornerstoneTools.addTool to register it."));if(S)return void console.warn("'".concat(u,"' is already registered for ToolGroup ").concat(this.id,"."));const{toolClass:D}=m,O=new D({name:u,toolGroupId:this.id,configuration:g});this._toolInstances[u]=O}addToolInstance(u,g){var m;let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},S=(m=Ke.tools[u])===null||m===void 0?void 0:m.toolClass;if(!S){const D=Ke.tools[g].toolClass;class O extends D{}O.toolName=u,S=O,Ke.tools[u]={toolClass:O}}this.addTool(S.toolName,v)}addViewport(u,g){if(typeof u!="string")throw new Error("viewportId must be defined and be a string");const m=(0,j.getRenderingEngines)();if(!g&&m.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");const v=g||m[0].id;this.viewportsInfo.some(O=>{let{viewportId:N}=O;return N===u})||this.viewportsInfo.push({viewportId:u,renderingEngineId:v});const S=this.getActivePrimaryMouseButtonTool();j.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(S);const D={toolGroupId:this.id,viewportId:u,renderingEngineId:v};(0,j.triggerEvent)(j.eventTarget,Q.TOOLGROUP_VIEWPORT_ADDED,D)}removeViewports(u,g){const m=[];if(this.viewportsInfo.forEach((S,D)=>{let O=!1;S.renderingEngineId===u&&(O=!0,g&&S.viewportId!==g&&(O=!1)),O&&m.push(D)}),m.length)for(let S=m.length-1;S>=0;S--)this.viewportsInfo.splice(m[S],1);const v={toolGroupId:this.id,viewportId:g,renderingEngineId:u};(0,j.triggerEvent)(j.eventTarget,Q.TOOLGROUP_VIEWPORT_REMOVED,v)}setActiveStrategy(u,g){const m=this._toolInstances[u];m!==void 0?m.setActiveStrategy(g):console.warn("Tool ".concat(u," not added to toolGroup, can't set tool configuration."))}setToolMode(u,g){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};u?g!==ke.Active?g!==ke.Passive?g!==ke.Enabled?g!==ke.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(u):this.setToolEnabled(u):this.setToolPassive(u):this.setToolActive(u,m||this.restoreToolOptions[u]):console.warn("setToolMode: toolName must be defined")}setToolActive(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m=this._toolInstances[u];if(m===void 0)return void console.warn("Tool ".concat(u," not added to toolGroup, can't set tool mode."));if(!m)return void console.warn("'".concat(u,"' instance ").concat(m," is not registered with this toolGroup, can't set tool mode."));const v={bindings:[...this.toolOptions[u]?this.toolOptions[u].bindings:[],...g.bindings?g.bindings:[]].reduce((O,N)=>{const R=N.numTouchPoints!==void 0,L=N.mouseButton!==void 0;return O.some(P=>W3(P,N))||!R&&!L||O.push(N),O},[]),mode:Zd};this.toolOptions[u]=v,this._toolInstances[u].mode=Zd;const S=j.Settings.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(g)&&S)this.setViewportsCursorByToolName(u);else if(!this.getActivePrimaryMouseButtonTool()&&S){const O=Mi.getDefinedCursor("default");this._setCursorForViewports(O)}this._hasMousePrimaryButtonBinding(g)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=u:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=u),typeof m.onSetToolActive=="function"&&m.onSetToolActive(),this._renderViewports();const D={toolGroupId:this.id,toolName:u,toolBindingsOptions:g};(0,j.triggerEvent)(j.eventTarget,Q.TOOL_ACTIVATED,D),this._triggerToolModeChangedEvent(u,Zd,g)}setToolPassive(u,g){const m=this._toolInstances[u];if(m===void 0)return void console.warn("Tool ".concat(u," not added to toolGroup, can't set tool mode."));const v=this.getToolOptions(u),S=Object.assign({bindings:v?v.bindings:[]},v,{mode:B3}),D=Array.isArray(g==null?void 0:g.removeAllBindings)?g.removeAllBindings:this.getDefaultPrimaryBindings();S.bindings=S.bindings.filter(N=>(g==null?void 0:g.removeAllBindings)!==!0&&!D.some(R=>W3(N,R)));let O=B3;S.bindings.length!==0&&(O=Zd,S.mode=O),this.toolOptions[u]=S,m.mode=O,typeof m.onSetToolPassive=="function"&&m.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(u,B3)}setToolEnabled(u){const g=this._toolInstances[u];if(g===void 0)return void console.warn("Tool ".concat(u," not added to toolGroup, can't set tool mode."));const m={bindings:[],mode:G3};this.toolOptions[u]=m,g.mode=G3,typeof g.onSetToolEnabled=="function"&&g.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(u,G3)}setToolDisabled(u){const g=this._toolInstances[u];if(g===void 0)return void console.warn("Tool ".concat(u," not added to toolGroup, can't set tool mode."));const m={bindings:[],mode:z3};this.restoreToolOptions[u]=this.toolOptions[u],this.toolOptions[u]=m,g.mode=z3,typeof g.onSetToolDisabled=="function"&&g.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(u,z3)}getToolOptions(u){const g=this.toolOptions[u];if(g!==void 0)return g}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(u=>{const g=this.toolOptions[u];return g.mode===Zd&&this._hasMousePrimaryButtonBinding(g)})}setViewportsCursorByToolName(u,g){const m=this._getCursor(u,g);this._setCursorForViewports(m)}_getCursor(u,g){let m,v;return g&&(m="".concat(u,".").concat(g),v=jc.getDefinedCursor(m,!0),v)?v:(m="".concat(u),v=jc.getDefinedCursor(m,!0),v||(m=u,v=jc.getDefinedCursor(m,!0),v||Mi.getDefinedCursor("default")))}_setCursorForViewports(u){this.viewportsInfo.forEach(g=>{let{renderingEngineId:m,viewportId:v}=g;const S=(0,j.getEnabledElementByIds)(v,m);if(!S)return;const{viewport:D}=S;S9(D.element,u)})}setToolConfiguration(u,g,m){const v=this._toolInstances[u];if(v===void 0)return console.warn("Tool ".concat(u," not present, can't set tool configuration.")),!1;let S;return S=m?g:Object.assign(v.configuration,g),v.configuration=S,typeof v.onSetToolConfiguration=="function"&&v.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return Uc.Primary}getDefaultPrimaryBindings(){return lK}getToolConfiguration(u,g){if(this._toolInstances[u]===void 0)return void console.warn("Tool ".concat(u," not present, can't set tool configuration."));const m=tK()(this._toolInstances[u].configuration,g)||this._toolInstances[u].configuration;return it()(m)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}clone(u){var g;let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,v=qn(u);return v?(console.warn("ToolGroup ".concat(u," already exists")),v):(v=LD(u),m=(g=m)!==null&&g!==void 0?g:()=>!0,Object.keys(this._toolInstances).filter(m).forEach(S=>{var D;const O=this._toolInstances[S],N=this.toolOptions[S],R=O.mode;v.addTool(S),v.setToolMode(S,R,{bindings:(D=N.bindings)!==null&&D!==void 0?D:[]})}),v)}_hasMousePrimaryButtonBinding(u){var g;const m=this.getDefaultPrimaryBindings();return u==null||(g=u.bindings)===null||g===void 0?void 0:g.some(v=>m.some(S=>W3(v,S)))}_renderViewports(){this.viewportsInfo.forEach(u=>{let{renderingEngineId:g,viewportId:m}=u;(0,j.getRenderingEngine)(g).renderViewport(m)})}_triggerToolModeChangedEvent(u,g,m){const v={toolGroupId:this.id,toolName:u,mode:g,toolBindingsOptions:m};(0,j.triggerEvent)(j.eventTarget,Q.TOOL_MODE_CHANGED,v)}}function W3(E,u){return E.mouseButton===u.mouseButton&&E.numTouchPoints===u.numTouchPoints&&E.modifierKey===u.modifierKey}const LD=function(E){if(Ke.toolGroups.some(g=>g.id===E))return void console.warn("'".concat(E,"' already exists."));const u=new cK(E);return Ke.toolGroups.push(u),u},uK=function(){return Ke.toolGroups};function fK(E,u,g,m){const{camera:v}=m.detail,S=(0,j.getRenderingEngine)(g.renderingEngineId);if(!S)throw new Error("No RenderingEngine for Id: ".concat(g.renderingEngineId));const D=S.getViewport(g.viewportId);D.setCamera(v),D.render()}const{CAMERA_MODIFIED:dK}=j.Enums.Events;function hK(E){return Wc(E,dK,fK)}function gK(E,u,g,m,v){const S=(0,j.getRenderingEngine)(g.renderingEngineId);if(!S)throw new Error("No RenderingEngine for Id: ".concat(g.renderingEngineId));const D=S.getViewport(g.viewportId),O=S.getViewport(u.viewportId).getViewPresentation(v);D.setViewPresentation(O),D.render()}const{CAMERA_MODIFIED:pK}=j.Enums.Events;function mK(E,u){return Wc(E,pK,gK,u)}function vK(E,u,g,m,v){const S=m.detail,{volumeId:D,range:O,invertStateChanged:N,invert:R,colormap:L}=S,P=(0,j.getRenderingEngine)(g.renderingEngineId);if(!P)throw new Error("Rendering Engine does not exist: ".concat(g.renderingEngineId));const F=P.getViewport(g.viewportId),V={voiRange:O};if(v!=null&&v.syncInvertState&&N&&(V.invert=R),v!=null&&v.syncColormap&&L&&(V.colormap=L),F instanceof j.BaseVolumeViewport)F._actors&&F._actors.size>1?F.setProperties(V,D):F.setProperties(V);else{if(!(F instanceof j.StackViewport))throw new Error("Viewport type not supported.");F.setProperties(V)}F.render()}function yK(E,u){return u=Object.assign({syncInvertState:!0,syncColormap:!0},u),Wc(E,j.Enums.Events.VOI_MODIFIED,vK,{auxiliaryEventNames:[j.Enums.Events.COLORMAP_MODIFIED],...u})}function wK(E,u,g){const m=(0,j.getRenderingEngine)(g.renderingEngineId);if(!m)throw new Error("No RenderingEngine for Id: ".concat(g.renderingEngineId));const v=E.getOptions(g.viewportId),S=m.getViewport(g.viewportId),D=m.getViewport(u.viewportId);if((v==null?void 0:v.syncZoom)!==!1){const O=D.getZoom();S.setZoom(O)}if((v==null?void 0:v.syncPan)!==!1){const O=D.getPan();S.setPan(O)}S.render()}const{CAMERA_MODIFIED:CK}=j.Enums.Events;function xK(E){return Wc(E,CK,wK)}const kD=(E,u)=>j.utilities.spatialRegistrationMetadataProvider.get("spatialRegistrationModule",E,u);async function SK(E,u,g){const m=(0,j.getRenderingEngine)(g.renderingEngineId);if(!m)throw new Error("No RenderingEngine for Id: ".concat(g.renderingEngineId));const v=m.getViewport(u.viewportId),S=E.getOptions(g.viewportId);if(S!=null&&S.disabled)return;const D=m.getViewport(g.viewportId),O=v.getCurrentImageId(),N=j.metaData.get("imagePlaneModule",O).imagePositionPatient,R=D.getImageIds();if(!function(W,q){const{viewPlaneNormal:Y}=W.getCamera(),{viewPlaneNormal:Z}=q.getCamera(),ne=le.vec3.dot(Y,Z);return Math.abs(ne)>.9}(v,D))return;let L=kD(g.viewportId,u.viewportId);if(!L&&(v.getFrameOfReferenceUID()===D.getFrameOfReferenceUID()&&(S==null?void 0:S.useInitialPosition)!==!1?L=le.mat4.identity(le.mat4.create()):(j.utilities.calculateViewportsSpatialRegistration(v,D),L=kD(g.viewportId,u.viewportId)),!L))return;const P=le.vec3.transformMat4(le.vec3.create(),N,L),F=(V=P,R.reduce((W,q,Y)=>{const{imagePositionPatient:Z}=j.metaData.get("imagePlaneModule",q),ne=le.vec3.distance(Z,V);return ne<W.distance?{distance:ne,index:Y}:W},{distance:1/0,index:-1}));var V;let G=F.index;D instanceof j.VolumeViewport&&(G=R.length-F.index-1),F.index!==-1&&D.getCurrentImageIdIndex()!==F.index&&await Wp(D.element,{imageIndex:G})}const{STACK_NEW_IMAGE:EK,VOLUME_NEW_IMAGE:TK}=j.Enums.Events;function PD(E){return Wc(E,EK,SK,{auxiliaryEventNames:[TK]})}function _K(E,u,g){var m,v,S,D;const O=(0,j.getRenderingEngine)(g.renderingEngineId);if(!O)throw new Error("No RenderingEngine for Id: ".concat(g.renderingEngineId));const N=O.getViewport(g.viewportId),R=(m=(v=O.getViewport(u.viewportId)).getSlabThickness)===null||m===void 0?void 0:m.call(v);R&&((S=(D=N).setSlabThickness)===null||S===void 0||S.call(D,R),N.render())}const{CAMERA_MODIFIED:DK}=j.Enums.Events;function bK(E){return Wc(E,DK,_K)}const IK=PD,j3=function(E,u,g,m){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"";const{color:D,width:O,lineWidth:N,lineDash:R}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},v),L=N||O,P=Ds(u,"ellipse",g),F=E.getSvgNode(P),[V,G,W,q]=m,Y=Math.hypot(W[0]-q[0],W[1]-q[1]),Z=Math.hypot(G[0]-V[0],G[1]-V[1]),ne=180*Math.atan2(W[1]-q[1],W[0]-q[0])/Math.PI,oe=[(W[0]+q[0])/2,(G[1]+V[1])/2],ue=Y/2,ge=Z/2,me={cx:"".concat(oe[0]),cy:"".concat(oe[1]),rx:"".concat(ue),ry:"".concat(ge),stroke:D,fill:"transparent",transform:"rotate(".concat(ne," ").concat(oe[0]," ").concat(oe[1],")"),"stroke-width":L,"stroke-dasharray":R};if(F)ja(me,F),E.setNodeTouched(P);else{const xe=document.createElementNS("http://www.w3.org/2000/svg","ellipse");S!==""&&xe.setAttribute("data-id",S),bs(me,xe),E.appendNode(xe,P)}},OK=function(E,u,g,m,v){const S=[(m[0]+v[0])/2,m[1]],D=[(m[0]+v[0])/2,v[1]],O=[m[0],(m[1]+v[1])/2],N=[v[0],(m[1]+v[1])/2];j3(E,u,g,[D,S,O,N],{},"")};function FD(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(isNaN(m[0])||isNaN(m[1])||isNaN(v[0])||isNaN(v[1]))return;const{color:D,width:O,lineWidth:N,lineDash:R}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},S),L=v[0]+(m[0]-v[0])/2,P=[L,m[1]],F=[L,v[1]],V={start:m,end:P},G={start:P,end:F},W={start:F,end:v};Mn(E,u,"1",V.start,V.end,{color:D,width:O,lineWidth:N}),Mn(E,u,"2",G.start,G.end,{color:D,width:O,lineWidth:N}),Mn(E,u,"3",W.start,W.end,{color:D,width:O,lineWidth:N})}function b1(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(isNaN(m[0])||isNaN(m[1])||isNaN(v[0])||isNaN(v[1]))return;const{color:D,width:O,lineWidth:N,lineDash:R}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},S);Mn(E,u,g,m,v,{color:D,width:O,lineWidth:N,lineDash:R});const L=Math.atan2(v[1]-m[1],v[0]-m[0]),P={start:[v[0]-10*Math.cos(L-Math.PI/7),v[1]-10*Math.sin(L-Math.PI/7)],end:v},F={start:[v[0]-10*Math.cos(L+Math.PI/7),v[1]-10*Math.sin(L+Math.PI/7)],end:v};Mn(E,u,"2",P.start,P.end,{color:D,width:O,lineWidth:N}),Mn(E,u,"3",F.start,F.end,{color:D,width:O,lineWidth:N})}function VD(E,u,g,m,v){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};const{color:D,width:O,lineWidth:N,lineDash:R}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},S),L=N||O,P=Ds(u,"rect",g),F=E.getSvgNode(P),V=[Math.min(m[0],v[0]),Math.min(m[1],v[1])],G=Math.abs(m[0]-v[0]),W=Math.abs(m[1]-v[1]),q={x:"".concat(V[0]),y:"".concat(V[1]),width:"".concat(G),height:"".concat(W),stroke:D,fill:"black","stroke-width":L,"stroke-dasharray":R};if(F)ja(q,F),E.setNodeTouched(P);else{const Y=document.createElementNS("http://www.w3.org/2000/svg","rect");bs(q,Y),E.appendNode(Y,P)}}const MK=function(E,u){let g=jc.getDefinedCursor(u,!0);g||(g=Mi.getDefinedCursor(u)),g||(console.log("Cursor ".concat(u," is not defined either as SVG or as a standard cursor.")),g=Mi.getDefinedCursor(u)),Pd(E,g)},NK=[...rK,...mj],RK=function(E,u,g){const m=y0("textBoxFontSize",E,u,g),v=y0("textBoxFontFamily",E,u,g);return"".concat(m,"px ").concat(v)};class AK{constructor(){$(this,"annotationUIDs",new Set),$(this,"_isVisible",!0),$(this,"visibleFilter",void 0),this.visibleFilter=this.unboundVisibleFilter.bind(this)}unboundVisibleFilter(u){return!this._isVisible||!this.annotationUIDs.has(u)}has(u){return this.annotationUIDs.has(u)}setVisible(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],g=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;this._isVisible!==u&&(this._isVisible=u,this.annotationUIDs.forEach(v=>{const S=Bn(v);if(!S)return void this.annotationUIDs.delete(v);if(S.isVisible===u||!u&&(m==null?void 0:m(v))===!1)return;S.isVisible=u;const D={...g,annotation:S};(0,j.triggerEvent)(j.eventTarget,Q.ANNOTATION_MODIFIED,D)}))}get isVisible(){return this._isVisible}findNearby(u,g){const m=[...this.annotationUIDs];if(m.length===0)return null;if(!u)return m[g===1?0:m.length-1];const v=m.indexOf(u);return v===-1||v+g<0||v+g>=m.length?null:m[v+g]}add(){for(var u=arguments.length,g=new Array(u),m=0;m<u;m++)g[m]=arguments[m];g.forEach(v=>this.annotationUIDs.add(v))}remove(){for(var u=arguments.length,g=new Array(u),m=0;m<u;m++)g[m]=arguments[m];g.forEach(v=>this.annotationUIDs.delete(v))}clear(){this.annotationUIDs.clear()}}const LK=function(E){(function(u){if(!u||u.length===0)throw new Error("The segmentationInputArray is undefined or an empty array");u.forEach(g=>{if(g.segmentationId===void 0)throw new Error("Undefined segmentationInput.segmentationId. Please provide a valid segmentationId");if(g.representation===void 0)throw new Error("Undefined segmentationInput.representation. Please provide a valid representation");g.representation.type===Nt.Labelmap&&function(m){if(!m.representation.data)throw new Error("The segmentationInput.representationData.data is undefined, please provide a valid representationData.data");Z6(m.representation.data)}(g)})})(E),E.map(u=>{P8(it()(u))})};class H3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]})}touchDragCallback(u){this._dragCallback(u)}mouseDragCallback(u){this._dragCallback(u)}_dragCallback(u){const{element:g,deltaPoints:m}=u.detail,v=(0,j.getEnabledElement)(g),S=m.world;if(S[0]===0&&S[1]===0&&S[2]===0)return;const D=v.viewport.getCamera(),{focalPoint:O,position:N}=D,R=[N[0]-S[0],N[1]-S[1],N[2]-S[2]],L=[O[0]-S[0],O[1]-S[1],O[2]-S[2]];v.viewport.setCamera({focalPoint:L,position:R}),v.viewport.render()}}$(H3,"toolName",void 0),H3.toolName="Pan";const kK=H3;class $3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"cleanUp",void 0),$(this,"_resizeObservers",new Map),$(this,"_viewportAddedListener",void 0),$(this,"_hasResolutionChanged",!1),$(this,"preMouseDownCallback",u=>{const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),{viewport:S}=v,D=S.getDefaultActor().actor.getMapper(),O=D.getSampleDistance();return this._hasResolutionChanged||(D.setSampleDistance(2*O),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{D.setSampleDistance(O),S.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})),!0}),$(this,"_getViewportsInfo",()=>qn(this.toolGroupId).viewportsInfo),$(this,"onSetToolActive",()=>{const u=()=>{this._getViewportsInfo().forEach(g=>{let{viewportId:m,renderingEngineId:v}=g;if(!this._resizeObservers.has(m)){const{viewport:S}=(0,j.getEnabledElementByIds)(m,v)||{viewport:null};if(!S)return;const{element:D}=S,O=new ResizeObserver(()=>{const N=(0,j.getEnabledElementByIds)(m,v);if(!N)return;const{viewport:R}=N;R.resetCamera(),R.render()});O.observe(D),this._resizeObservers.set(m,O)}})};u(),this._viewportAddedListener=g=>{g.detail.toolGroupId===this.toolGroupId&&u()},j.eventTarget.addEventListener(Q.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)}),$(this,"onSetToolDisabled",()=>{this._resizeObservers.forEach((u,g)=>{u.disconnect(),this._resizeObservers.delete(g)}),this._viewportAddedListener&&(j.eventTarget.removeEventListener(Q.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)}),$(this,"rotateCamera",(u,g,m,v)=>{const S=u.getVtkActiveCamera(),D=S.getViewUp(),O=S.getFocalPoint(),N=S.getPosition(),R=[0,0,0],L=[0,0,0],P=[0,0,0],F=le.mat4.identity(new Float32Array(16));le.mat4.translate(F,F,g),le.mat4.rotate(F,F,v,m),le.mat4.translate(F,F,[-g[0],-g[1],-g[2]]),le.vec3.transformMat4(R,N,F),le.vec3.transformMat4(L,O,F),le.mat4.identity(F),le.mat4.rotate(F,F,v,m),le.vec3.transformMat4(P,D,F),u.setCamera({position:R,viewUp:P,focalPoint:L})}),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(u){const{element:g,currentPoints:m,lastPoints:v}=u.detail,S=m.canvas,D=v.canvas,{rotateIncrementDegrees:O}=this.configuration,N=(0,j.getEnabledElement)(g),{viewport:R}=N,L=R.getCamera(),P=g.clientWidth,F=g.clientHeight,V=[S[0]/P,S[1]/F],G=[D[0]/P,D[1]/F],W=[.5*P,.5*F],q=R.canvasToWorld(W),Y=(1+Math.abs(.5))**2,Z=[G[0],0,0],ne=[V[0],0,0],oe=Z[0]**2,ue=ne[0]**2,ge=oe>Y?0:Math.sqrt(Y-oe),me=ue>Y?0:Math.sqrt(Y-ue),xe=[Z[0],0,ge];hn().normalize(xe);const Ee=[ne[0],0,me];hn().normalize(Ee);const Ie=hn().dot(xe,Ee);if(Math.abs(Ie)>1e-4){const be=-2*Math.acos(hn().clampValue(Ie,-1,1))*Math.sign(V[0]-G[0])*O,Ne=L.viewUp,_e=L.viewPlaneNormal,Me=[0,0,0],Pe=[0,0,0];hn().cross(Ne,_e,Me),hn().normalize(Me),hn().cross(_e,Me,Pe),hn().normalize(Pe),hn().normalize(Ne),this.rotateCamera(R,q,Pe,be);const Ze=(G[1]-V[1])*O;this.rotateCamera(R,q,Me,Ze),R.render()}}}$($3,"toolName",void 0),$3.toolName="TrackballRotate";const PK=$3,{transformWorldToIndex:FK}=j.utilities;class K3 extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:VK}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"editData",void 0),$(this,"eventDispatchDetail",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F},data:{label:"",handles:{points:[[...S]]},cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,newAnnotation:!0,viewportIdsToRender:W},this._activateModify(v),Wt(v),u.preventDefault(),We(N,W),G}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D}=this.editData,{viewportId:O,renderingEngine:N}=(0,j.getEnabledElement)(m);this.eventDispatchDetail={viewportId:O,renderingEngineId:N.id},this._deactivateModify(m),rn(m),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(N,S),D&&sn(v)}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,{annotation:D,viewportIdsToRender:O}=this.editData,{data:N}=D;N.handles.points[0]=[...S],D.invalidated=!0;const R=(0,j.getEnabledElement)(v),{renderingEngine:L}=R;We(L,O)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],G=V.annotationUID,W=V.data,q=W.handles.points[0],Y=D.worldToCanvas(q);P.annotationUID=G;const{color:Z}=this.getAnnotationStyle({annotation:V,styleSpecifier:P});if(W.cachedStats||(W.cachedStats={}),W.cachedStats[R]&&W.cachedStats[R].value!=null){if(V.invalidated&&(this._calculateCachedStats(V,L,u),D instanceof j.VolumeViewport)){const{referencedImageId:ue}=V.metadata;for(const ge in W.cachedStats)ge.startsWith("imageId")&&L.getStackViewports().find(me=>{const xe=j.utilities.imageIdToURI(ue),Ee=me.hasImageURI(xe),Ie=j.utilities.imageIdToURI(me.getCurrentImageId());return Ee&&Ie!==xe})&&delete W.cachedStats[ge]}}else W.cachedStats[R]={Modality:null,index:null,value:null},this._calculateCachedStats(V,L,u);if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;Qn(g,G,"0",[Y],{color:Z}),S=!0;const ne=this.getLinkedTextBoxStyle(P,V);if(!ne.visibility)continue;const oe=this.configuration.getTextLines(W,R);if(oe){const ue=[Y[0]+6,Y[1]-6];kc(g,G,"0",oe,[ue[0],ue[1]],ne)}}return S})}isPointNearTool(){return!1}toolSelectedCallback(){}getHandleNearImagePoint(u,g,m,v){const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,N=O.handles.points[0],R=D.worldToCanvas(N);if(le.vec2.distance(m,R)<v)return N}handleSelectedCallback(u,g){const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}_calculateCachedStats(u,g,m){const v=u.data,{renderingEngineId:S,viewport:D}=m,{element:O}=D,N=v.handles.points[0],{cachedStats:R}=v,L=Object.keys(R);for(let P=0;P<L.length;P++){const F=L[P],V={isPreScaled:qo(D,F),isSuvScaled:this.isSuvScaled(D,F,u.metadata.referencedImageId)},G=this.getTargetIdImage(F,g);if(!G)continue;const{dimensions:W,imageData:q,metadata:Y}=G,Z="getScalarData"in G?G.getScalarData():G.scalarData,ne=Y.Modality,oe=FK(q,N);oe[0]=Math.round(oe[0]),oe[1]=Math.round(oe[1]),oe[2]=Math.round(oe[2]);const ue=Z.length/W[2]/W[1]/W[0];if(j.utilities.indexWithinDimensions(oe,W)){this.isHandleOutsideImage=!1;const ge=W[0]*ue,me=W[0]*W[1]*ue,xe=oe[2]*me+oe[1]*ge+oe[0]*ue;let Ee,Ie=ue>2?[Z[xe],Z[xe+1],Z[xe+2]]:Z[xe];if(F.startsWith("imageId:")){const be=F.split("imageId:")[1],Ne=j.utilities.imageIdToURI(be),_e=j.utilities.getViewportsWithImageURI(Ne,S)[0];oe[2]=_e.getCurrentImageIdIndex()}if(ne==="US"){const be=Gp(G,[oe]),Ne=be.values.every(_e=>_e!==null);Ie=Ne?be.values:Ie,Ee=Ne?be.units:"raw"}else Ee=Pc(ne,u.metadata.referencedImageId,V);R[F]={index:oe,value:Ie,Modality:ne,modalityUnit:Ee}}else this.isHandleOutsideImage=!0,R[F]={index:oe,Modality:ne};u.invalidated=!1,Yt(u,O)}return R}}function VK(E,u){const g=E.cachedStats[u],{index:m,value:v,modalityUnit:S}=g;if(v===void 0)return;const D=[];if(D.push("(".concat(m[0],", ").concat(m[1],", ").concat(m[2],")")),v instanceof Array&&S instanceof Array)for(let O=0;O<v.length;O++)D.push("".concat(cn(v[O])," ").concat(S[O]));else D.push("".concat(cn(v)," ").concat(S));return D}$(K3,"toolName",void 0),K3.toolName="Probe";const UD=K3;class q3 extends UD{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:UK}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"editData",void 0),$(this,"eventDispatchDetail",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"postMouseDownCallback",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:O.getFrameOfReferenceUID(),referencedImageId:F},data:{label:"",handles:{points:[[...S]]},cachedStats:{}}},G=Mt(v,this.getToolName());return this.editData={annotation:V,newAnnotation:!0,viewportIdsToRender:G},this._activateModify(v),Wt(v),u.preventDefault(),We(N,G),V}),$(this,"postTouchStartCallback",u=>this.postMouseDownCallback(u)),$(this,"renderAnnotation",(u,g)=>{let m=!1;const{viewport:v}=u;if(!this.editData)return m;const S=this.filterInteractableAnnotationsForElement(v.element,[this.editData.annotation]);if(S==null||!S.length)return m;const D=this.getTargetId(v),O=v.getRenderingEngine(),N={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id},R=this.editData.annotation,L=R.annotationUID,P=R.data,F=P.handles.points[0],V=v.worldToCanvas(F);N.annotationUID=L;const{color:G}=this.getAnnotationStyle({annotation:R,styleSpecifier:N});if(qo(v,D),this.isSuvScaled(v,D,R.metadata.referencedImageId),P.cachedStats[D]&&P.cachedStats[D].value!=null?R.invalidated&&this._calculateCachedStats(R,O,u):(P.cachedStats[D]={Modality:null,index:null,value:null},this._calculateCachedStats(R,O,u)),!v.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),m;Qn(g,L,"0",[V],{color:G}),m=!0;const W=this.configuration.getTextLines(P,D);if(W){const q=[V[0]+6,V[1]-6];kc(g,L,"0",W,[q[0],q[1]],this.getLinkedTextBoxStyle(N,R))}return m})}}function UK(E,u){const g=E.cachedStats[u],{index:m,value:v,modalityUnit:S}=g;if(v===void 0)return;const D=[];return D.push("(".concat(m[0],", ").concat(m[1],", ").concat(m[2],")")),D.push("".concat(v.toFixed(2)," ").concat(S)),D}$(q3,"toolName",void 0),q3.toolName="DragProbe";const BK=q3;class X3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]}),$(this,"_getImageDynamicRangeFromMiddleSlice",(u,g)=>{const m=Math.floor(g[2]/2),v=g[0]*g[1];let S,D;u instanceof Float32Array?(S=4,D=Float32Array):u instanceof Uint8Array?(S=1,D=Uint8Array):u instanceof Uint16Array?(S=2,D=Uint16Array):u instanceof Int16Array&&(S=2,D=Int16Array);const O=new D(u.buffer,m*v*S,v),{max:N,min:R}=this._getMinMax(O,v);return N-R})}touchDragCallback(u){this.mouseDragCallback(u)}mouseDragCallback(u){const{element:g,deltaPoints:m}=u.detail,v=(0,j.getEnabledElement)(g),{renderingEngine:S,viewport:D}=v;let O,N,R,L,P,F,V=!1;const G=D.getProperties();if(D instanceof j.VolumeViewport){O=this.getTargetVolumeId(D),F=j.utilities.getViewportsWithVolumeId(O,S.id),{lower:N,upper:R}=G.voiRange;const Y=j.cache.getVolume(O);if(!Y)throw new Error("Volume not found "+O);L=Y.metadata.Modality,V=Y.scaling&&Object.keys(Y.scaling).length>0}else{if(!G.voiRange)throw new Error("Viewport is not a valid type");{var W,q;L=D.modality,{lower:N,upper:R}=G.voiRange;const{preScale:Y={scaled:!1}}=((W=D.getImageData)===null||W===void 0?void 0:W.call(D))||{};V=Y.scaled&&((q=Y.scalingParameters)===null||q===void 0?void 0:q.suvbw)!==void 0}}P=L==="PT"&&V?this.getPTScaledNewRange({deltaPointsCanvas:m.canvas,lower:N,upper:R,clientHeight:g.clientHeight,isPreScaled:V,viewport:D,volumeId:O}):this.getNewRange({viewport:D,deltaPointsCanvas:m.canvas,volumeId:O,lower:N,upper:R}),P.lower>=P.upper||(D.setProperties({voiRange:P}),D.render(),D instanceof j.VolumeViewport&&F.forEach(Y=>{D!==Y&&Y.render()}))}getPTScaledNewRange(u){let{deltaPointsCanvas:g,lower:m,upper:v,clientHeight:S,viewport:D,volumeId:O,isPreScaled:N}=u,R=4;return R=N?5/S:this._getMultiplierFromDynamicRange(D,O)||4,v-=g[1]*R,v=N?Math.max(v,.1):v,{lower:m,upper:v}}getNewRange(u){let{viewport:g,deltaPointsCanvas:m,volumeId:v,lower:S,upper:D}=u;const O=this._getMultiplierFromDynamicRange(g,v)||4,N=m[0]*O,R=m[1]*O;let{windowWidth:L,windowCenter:P}=j.utilities.windowLevel.toWindowLevel(S,D);return L+=N,P+=R,L=Math.max(L,1),j.utilities.windowLevel.toLowHighRange(L,P)}_getMultiplierFromDynamicRange(u,g){let m;if(g){var v;const D=j.cache.getVolume(g),{dimensions:O}=D,N=D.getScalarData(),R=this._getImageDynamicRangeFromMiddleSlice(N,O),L=D==null||(v=D.metadata)===null||v===void 0?void 0:v.BitsStored,P=L?2**L:1/0;m=Math.min(R,P)}else m=this._getImageDynamicRangeFromViewport(u);const S=m/1024;return S>1?Math.round(S):S}_getImageDynamicRangeFromViewport(u){const{imageData:g}=u.getImageData(),m=g.getDimensions();if(g.getRange){const D=g.getRange();return D[1]-D[0]}let v,S;if(v=g.getScalarData?g.getScalarData():g.getPointData().getScalars().getData(),m[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(v,m);if(v.getRange)S=v.getRange();else{const{min:D,max:O}=this._getMinMax(v,v.length);S=[D,O]}return S[1]-S[0]}_getMinMax(u,g){let m=1/0,v=-1/0;for(let S=0;S<g;S++){const D=u[S];D<m&&(m=D),D>v&&(v=D)}return{max:v,min:m}}}$(X3,"toolName",void 0),X3.toolName="WindowLevel";const GK=X3;class Y3 extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F},data:{handles:{points:[[...S],[...S],[...S],[...S]]},cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,W),G}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S}=this.editData;this._deactivateDraw(m),rn(m);const{renderingEngine:D}=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,Ht(v.annotationUID),We(D,S),sn(v),this.applyWindowLevelRegion(v,m)}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S}=this.editData,{data:D}=v,{currentPoints:O}=g,N=(0,j.getEnabledElement)(m),{worldToCanvas:R,canvasToWorld:L}=N.viewport,P=O.world,{points:F}=D.handles;F[3]=[...P];const V=R(F[0]),G=R(F[3]),W=[G[0],V[1]],q=[V[0],G[1]],Y=L(W),Z=L(q);F[1]=Y,F[2]=Z,v.invalidated=!0;const{renderingEngine:ne}=N;We(ne,S)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let L=0;L<N.length;L++){const P=N[L],{annotationUID:F,data:V}=P,{points:G}=V.handles,W=G.map(oe=>D.worldToCanvas(oe));R.annotationUID=F;const{color:q,lineWidth:Y,lineDash:Z}=this.getAnnotationStyle({annotation:P,styleSpecifier:R});if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;const ne="".concat(F,"-rect");Vd(g,F,"0",W[0],W[3],{color:q,lineDash:Z,lineWidth:Y},ne),S=!0}return S}),$(this,"applyWindowLevelRegion",(u,g)=>{const m=(0,j.getEnabledElement)(g),{viewport:v}=m,S=S7(v),{data:D}=u,{points:O}=D.handles,N=O.map(ne=>v.worldToCanvas(ne)),R=N[0],L=N[3];let P=Math.min(R[0],L[0]),F=Math.min(R[1],L[1]),V=Math.abs(R[0]-L[0]),G=Math.abs(R[1]-L[1]);P=zp(P,0,S.width),F=zp(F,0,S.height),V=Math.floor(Math.min(V,Math.abs(S.width-P))),G=Math.floor(Math.min(G,Math.abs(S.height-F)));const W=x7(C7(S,Math.round(P),Math.round(F),V,G),S.minPixelValue,S.maxPixelValue);this.configuration.minWindowWidth===void 0&&(this.configuration.minWindowWidth=10);const q=Math.max(Math.abs(W.max-W.min),this.configuration.minWindowWidth),Y=W.mean,Z=j.utilities.windowLevel.toLowHighRange(q,Y);v.setProperties({voiRange:Z}),v.render()}),$(this,"cancel",()=>null),$(this,"isPointNearTool",()=>null),$(this,"toolSelectedCallback",()=>null),$(this,"handleSelectedCallback",()=>null),$(this,"_activateModify",()=>null),$(this,"_deactivateModify",()=>null)}}$(Y3,"toolName",void 0),Y3.toolName="WindowLevelRegion";const zK=Y3;class J3 extends kr{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}),u=this,$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"initialMousePosWorld",void 0),$(this,"dirVec",void 0),$(this,"preMouseDownCallback",g=>{const m=g.detail,{element:v,currentPoints:S}=m,D=S.world,O=(0,j.getEnabledElement)(v).viewport.getCamera(),{focalPoint:N}=O;this.initialMousePosWorld=D;let R=le.vec3.fromValues(N[0]-D[0],N[1]-D[1],N[2]-D[2]);return R=le.vec3.normalize(le.vec3.create(),R),this.dirVec=R,!1}),$(this,"preTouchStartCallback",g=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(g)}),$(this,"_dragParallelProjection",function(g,m,v){let S=arguments.length>3&&arguments[3]!==void 0&&arguments[3];const{element:D,deltaPoints:O}=g.detail,N=S?g.detail.deltaDistance.canvas:O.canvas[1],R=[D.clientWidth,D.clientHeight],{parallelScale:L,focalPoint:P,position:F}=v,V=N*(5/R[1])*(u.configuration.invert?-1:1),G=(1-V)*L;let W=P,q=F;if(!u.configuration.zoomToCenter){const Ee=le.vec3.distance(P,u.initialMousePosWorld);q=le.vec3.scaleAndAdd(le.vec3.create(),F,u.dirVec,-Ee*V),W=le.vec3.scaleAndAdd(le.vec3.create(),P,u.dirVec,-Ee*V)}const Y=m.getImageData();let Z=[1,1,1];Y&&(Z=Y.spacing);const{minZoomScale:ne,maxZoomScale:oe}=u.configuration,ue=D.clientHeight*Z[1]*.5,ge=ue/G;let me=G,xe=!1;Y&&(ge<ne?(me=ue/ne,xe=!0):ge>=oe&&(me=ue/oe,xe=!0)),m.setCamera({parallelScale:me,focalPoint:xe?P:W,position:xe?F:q})}),$(this,"_dragPerspectiveProjection",function(g,m,v){let S=arguments.length>3&&arguments[3]!==void 0&&arguments[3];const{element:D,deltaPoints:O}=g.detail,N=S?g.detail.deltaDistance.canvas:O.canvas[1],R=[D.clientWidth,D.clientHeight],{position:L,focalPoint:P,viewPlaneNormal:F}=v,V=hn().distance2BetweenPoints(L,P),G=Math.sqrt(V)/R[1],W=[-F[0],-F[1],-F[2]],q=u.configuration.invert?N/G:N*G;let Y=q*W[0];L[0]+=Y,P[0]+=Y,Y=q*W[1],L[1]+=Y,P[1]+=Y,Y=q*W[2],L[2]+=Y,P[2]+=Y,m.setCamera({position:L,focalPoint:P})}),this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(u){if(u.detail.currentPointsList.length>1){const{element:g,currentPoints:m}=u.detail,v=(0,j.getEnabledElement)(g),{viewport:S}=v,D=S.getCamera(),O=m.world,{focalPoint:N}=D;this.initialMousePosWorld=O;let R=le.vec3.fromValues(N[0]-O[0],N[1]-O[1],N[2]-O[2]);R=le.vec3.normalize(le.vec3.create(),R),this.dirVec=R,D.parallelProjection?this._dragParallelProjection(u,S,D,!0):this._dragPerspectiveProjection(u,S,D,!0),S.render()}this.configuration.pan&&this._panCallback(u)}_dragCallback(u){const{element:g}=u.detail,m=(0,j.getEnabledElement)(g),{viewport:v}=m,S=v.getCamera();S.parallelProjection?this._dragParallelProjection(u,v,S):this._dragPerspectiveProjection(u,v,S),v.render()}_panCallback(u){const{element:g,deltaPoints:m}=u.detail,v=(0,j.getEnabledElement)(g),S=m.world,D=v.viewport.getCamera(),{focalPoint:O,position:N}=D,R=[N[0]-S[0],N[1]-S[1],N[2]-S[2]],L=[O[0]-S[0],O[1]-S[1],O[2]-S[2]];v.viewport.setCamera({focalPoint:L,position:R}),v.viewport.render()}}$(J3,"toolName",void 0),J3.toolName="Zoom";const WK=J3;class Z3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}),$(this,"deltaY",void 0),this.deltaY=1}mouseDragCallback(u){this._dragCallback(u)}touchDragCallback(u){this._dragCallback(u)}_dragCallback(u){const{deltaPoints:g,viewportId:m,renderingEngineId:v}=u.detail,{viewport:S}=(0,j.getEnabledElementByIds)(m,v),{debounceIfNotLoaded:D,invert:O,loop:N}=this.configuration,R=g.canvas[1];let L;S instanceof j.VolumeViewport&&(L=this.getTargetVolumeId(S));const P=this._getPixelPerImage(S),F=R+this.deltaY;if(P)if(Math.abs(F)>=P){const V=Math.round(F/P);Mc(S,{delta:O?-V:V,volumeId:L,debounceLoading:D,loop:N}),this.deltaY=F%P}else this.deltaY=F}_getPixelPerImage(u){const{element:g}=u,m=u.getNumberOfSlices();return Math.max(2,g.offsetHeight/Math.max(m,8))}}$(Z3,"toolName",void 0),Z3.toolName="StackScroll";const jK=Z3;function Qd(E,u){return E[0].length===3?function(g,m){const[v,S]=g,[D,O]=m,N=le.vec3.sub(le.vec3.create(),S,v),R=le.vec3.sub(le.vec3.create(),D,O),L=le.vec3.dot(N,R)/(le.vec3.length(N)*le.vec3.length(R));return 180*Math.acos(L)/Math.PI}(E,u):function(g,m){const[v,S]=g,[D,O]=m,N=le.vec2.sub(le.vec2.create(),S,v),R=le.vec2.sub(le.vec2.create(),D,O),L=le.vec2.dot(N,R)/(le.vec2.length(N)*le.vec2.length(R));return Math.acos(L)*(180/Math.PI)}(E,u)}class Q3 extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(u){const{element:g,currentPoints:m,startPoints:v}=u.detail,S=m.world,D=v.world,O=(0,j.getEnabledElement)(g),{viewport:N}=O,R=N.getCamera(),L=[.5*g.clientWidth,.5*g.clientHeight],P=N.canvasToWorld(L);let F=Qd([D,P],[P,S]);const{viewPlaneNormal:V,viewUp:G}=R,W=le.vec3.sub(le.vec3.create(),P,D),q=le.vec3.sub(le.vec3.create(),P,S),Y=le.vec3.cross(le.vec3.create(),W,q);if(le.vec3.dot(V,Y)>0&&(F=-F),!Number.isNaN(F)){if(N instanceof j.BaseVolumeViewport){const Z=F*Math.PI/180,ne=le.mat4.identity(new Float32Array(16));le.mat4.rotate(ne,ne,Z,V);const oe=le.vec3.transformMat4(le.vec3.create(),G,ne);N.setCamera({viewUp:oe})}else{const{rotation:Z}=N.getProperties();N.setProperties({rotation:Z+F})}N.render()}}}$(Q3,"toolName",void 0),Q3.toolName="PlanarRotate";const HK=Q3;class ew extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1,scrollSlabs:!1}}),$(this,"_configuration",void 0)}mouseWheelCallback(u){const{wheel:g,element:m}=u.detail,{direction:v}=g,{invert:S}=this.configuration,{viewport:D}=(0,j.getEnabledElement)(m),O=v*(S?-1:1),N=this.getTargetVolumeId(D);Mc(D,{delta:O,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:N,scrollSlabs:this.configuration.scrollSlabs})}}$(ew,"toolName",void 0),ew.toolName="StackScrollMouseWheel";const $K=ew,KK={X:[1,0,0],Y:[0,1,0],Z:[0,0,1],CUSTOM:[]};class tw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:KK.Z,rotateIncrementDegrees:30}}),$(this,"_configuration",void 0)}mouseWheelCallback(u){const{element:g,wheel:m}=u.detail,v=(0,j.getEnabledElement)(g),{viewport:S}=v,{direction:D,rotateIncrementDegrees:O}=this.configuration,N=S.getCamera(),{viewUp:R,position:L,focalPoint:P}=N,{direction:F}=m,[V,G,W]=P,[q,Y,Z]=D,ne=F*(O*Math.PI)/180,oe=[0,0,0],ue=[0,0,0],ge=[0,0,0],me=le.mat4.identity(new Float32Array(16));le.mat4.translate(me,me,[V,G,W]),le.mat4.rotate(me,me,ne,[q,Y,Z]),le.mat4.translate(me,me,[-V,-G,-W]),le.vec3.transformMat4(oe,L,me),le.vec3.transformMat4(ue,P,me),le.mat4.identity(me),le.mat4.rotate(me,me,ne,[q,Y,Z]),le.vec3.transformMat4(ge,R,me),S.setCamera({position:oe,viewUp:ge,focalPoint:ue}),S.render()}}$(tw,"toolName",void 0),tw.toolName="VolumeRotateMouseWheel";const qK=tw;class nw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}),$(this,"_bounds",void 0)}mouseClickCallback(u){const{element:g,currentPoints:m}=u.detail,v=(0,j.getEnabledElement)(g),{viewport:S,renderingEngine:D}=v,O=this.getTargetVolumeId(S);if(!O)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let N=-1/0;const R=d3(S,m.world,O,(F,V)=>{if(F>N)return N=F,V});if(!R||!R.length)return;const{targetViewportIds:L,toolGroupId:P}=this.configuration;D.getViewports().filter(F=>{if((L==null?void 0:L.indexOf(F.id))>=0)return!0;const V=nr(F.id,D.id);return!(!P||P!==(V==null?void 0:V.id))}).forEach(F=>{F instanceof j.VolumeViewport?p7(F,R):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}$(nw,"toolName",void 0),nw.toolName="MIPJumpToClickTool";const XK=nw,{transformWorldToIndex:BD}=j.utilities;class rw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:YK}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;Wt(v),this.isDrawing=!0;const{viewPlaneNormal:R,viewUp:L,position:P}=O.getCamera(),F=this.getReferencedImageId(O,S,R,L),V={highlighted:!0,invalidated:!0,metadata:{...O.getViewReference({points:[S]}),toolName:this.getToolName(),referencedImageId:F,viewUp:L,cameraPosition:P},data:{handles:{points:[[...S],[...S]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};fn(V,v);const G=Mt(v,this.getToolName());return this.editData={annotation:V,viewportIdsToRender:G,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),u.preventDefault(),We(N,G),V}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,[N,R]=O.handles.points,L=D.worldToCanvas(N),P=D.worldToCanvas(R),F={start:{x:L[0],y:L[1]},end:{x:P[0],y:P[1]}};return mi([F.start.x,F.start.y],[F.end.x,F.end.y],[m[0],m[1]])<=v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(L,S),D&&sn(v),this.editData=null,this.isDrawing=!1}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=P.world;N.handles.points[D]=[...F],v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const D=(0,j.getEnabledElement)(u),{renderingEngine:O}=D;return We(O,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{points:q,activeHandleIndex:Y}=W.handles;P.annotationUID=G;const{color:Z,lineWidth:ne,lineDash:oe,shadow:ue}=this.getAnnotationStyle({annotation:V,styleSpecifier:P}),ge=q.map(Ye=>D.worldToCanvas(Ye));let me;if(W.cachedStats[R]&&W.cachedStats[R].unit!=null?V.invalidated&&this._throttledCalculateCachedStats(V,L,u):(W.cachedStats[R]={length:null,unit:null},this._calculateCachedStats(V,L,u)),!mr(G))continue;cr(V)||this.editData||Y===null||(me=[ge[Y]]),me&&Qn(g,G,"0",ge,{color:Z,lineDash:oe,lineWidth:ne});const xe="".concat(G,"-line");if(Mn(g,G,"1",ge[0],ge[1],{color:Z,width:ne,lineDash:oe,shadow:ue},xe),S=!0,!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;const Ee=this.getLinkedTextBoxStyle(P,V);if(!Ee.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Ie=this.configuration.getTextLines(W,R);if(!W.handles.textBox.hasMoved){const Ye=Ha(ge);W.handles.textBox.worldPosition=D.canvasToWorld(Ye)}const be=D.worldToCanvas(W.handles.textBox.worldPosition),Ne=Ki(g,G,"1",Ie,be,ge,{},Ee),{x:_e,y:Me,width:Pe,height:Ze}=Ne;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([_e,Me]),topRight:D.canvasToWorld([_e+Pe,Me]),bottomLeft:D.canvasToWorld([_e,Me+Ze]),bottomRight:D.canvasToWorld([_e+Pe,Me+Ze])}}return S}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}_calculateLength(u,g){const m=u[0]-g[0],v=u[1]-g[1],S=u[2]-g[2];return Math.sqrt(m*m+v*v+S*S)}_calculateCachedStats(u,g,m){const v=u.data,{element:S}=m.viewport,D=v.handles.points[0],O=v.handles.points[1],{cachedStats:N}=v,R=Object.keys(N);for(let L=0;L<R.length;L++){const P=R[L],F=this.getTargetIdImage(P,g);if(!F)continue;const{imageData:V,dimensions:G}=F,W=BD(V,D),q=BD(V,O),Y=[W,q],{scale:Z,units:ne}=za(F,Y),oe=this._calculateLength(D,O)/Z;this._isInsideVolume(W,q,G)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,N[P]={length:oe,unit:ne}}return u.invalidated=!1,Yt(u,S),N}_isInsideVolume(u,g,m){return j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)}}function YK(E,u){const g=E.cachedStats[u],{length:m,unit:v}=g;if(m!=null&&!isNaN(m))return["".concat(cn(m)," ").concat(v)]}$(rw,"toolName",void 0),rw.toolName="Length";const JK=rw,{transformWorldToIndex:GD}=j.utilities;class iw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:ZK}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"endfirstLine",void 0),$(this,"endsecondLine",void 0),$(this,"midX",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;Wt(v),this.isDrawing=!0;const{viewPlaneNormal:R,viewUp:L,position:P}=O.getCamera(),F=this.getReferencedImageId(O,S,R,L),V={highlighted:!0,invalidated:!0,metadata:{...O.getViewReference({points:[S]}),toolName:this.getToolName(),referencedImageId:F,viewUp:L,cameraPosition:P},data:{handles:{points:[[...S],[...S]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};fn(V,v);const G=Mt(v,this.getToolName());return this.editData={annotation:V,viewportIdsToRender:G,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),u.preventDefault(),We(N,G),V}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,[N,R]=O.handles.points,L=D.worldToCanvas(N),P=D.worldToCanvas(R),F={start:{x:L[0],y:L[1]},end:{x:P[0],y:P[1]}};return mi([F.start.x,F.start.y],[F.end.x,F.end.y],[m[0],m[1]])<=v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(L,S),D&&sn(v),this.editData=null,this.isDrawing=!1}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=P.world;N.handles.points[D]=[...F],v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const D=(0,j.getEnabledElement)(u),{renderingEngine:O}=D;return We(O,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{points:q,activeHandleIndex:Y}=W.handles;P.annotationUID=G;const{color:Z,lineWidth:ne,lineDash:oe,shadow:ue}=this.getAnnotationStyle({annotation:V,styleSpecifier:P}),ge=q.map(Ze=>D.worldToCanvas(Ze));let me;if(W.cachedStats[R]&&W.cachedStats[R].unit!=null?V.invalidated&&this._throttledCalculateCachedStats(V,L,u):(W.cachedStats[R]={length:null,unit:null},this._calculateCachedStats(V,L,u)),!mr(G))continue;if(cr(V)||this.editData||Y===null||(me=[ge[Y]]),me&&Qn(g,G,"0",ge,{color:Z,lineDash:oe,lineWidth:ne}),FD(g,G,"0",ge[0],ge[1],{color:Z,width:ne,lineDash:oe}),S=!0,!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;const xe=this.getLinkedTextBoxStyle(P,V);if(!xe.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Ee=this.configuration.getTextLines(W,R);if(!W.handles.textBox.hasMoved){const Ze=Ha(ge);W.handles.textBox.worldPosition=D.canvasToWorld(Ze)}const Ie=D.worldToCanvas(W.handles.textBox.worldPosition),be=Ki(g,G,"1",Ee,Ie,ge,{},xe),{x:Ne,y:_e,width:Me,height:Pe}=be;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([Ne,_e]),topRight:D.canvasToWorld([Ne+Me,_e]),bottomLeft:D.canvasToWorld([Ne,_e+Pe]),bottomRight:D.canvasToWorld([Ne+Me,_e+Pe])}}return S}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}_calculateHeight(u,g){const m=g[0]-u[0],v=g[1]-u[1],S=g[2]-u[2];return m==0?v!=0?Math.abs(S):0:v==0?Math.abs(S):S==0?Math.abs(v):void 0}_calculateCachedStats(u,g,m){const v=u.data,{element:S}=m.viewport,D=v.handles.points[0],O=v.handles.points[1],{cachedStats:N}=v,R=Object.keys(N);for(let L=0;L<R.length;L++){const P=R[L],F=this.getTargetIdImage(P,g);if(!F)continue;const{imageData:V,dimensions:G}=F,W=GD(V,D),q=GD(V,O),Y=[W,q],{scale:Z,units:ne}=za(F,Y),oe=this._calculateHeight(D,O)/Z;this._isInsideVolume(W,q,G)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,N[P]={height:oe,unit:ne}}return u.invalidated=!1,Yt(u,S),N}_isInsideVolume(u,g,m){return j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)}}function ZK(E,u){const g=E.cachedStats[u],{height:m,unit:v}=g;if(m!=null&&!isNaN(m))return["".concat(cn(m)," ").concat(v)]}$(iw,"toolName",void 0),iw.toolName="Height";const QK=iw;var eq=I(847),zD=I.n(eq);const{RENDERING_DEFAULTS:aw}=j.CONSTANTS;function tq(){return"rgb(0, 200, 0)"}function nq(){return!0}function rq(){return!0}function iq(){return!0}class ow extends ei{constructor(){var u,g,m,v;let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(S,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},referenceLinesCenterGapRadius:20,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:j.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}}),$(this,"toolCenter",[0,0,0]),$(this,"_getReferenceLineColor",void 0),$(this,"_getReferenceLineControllable",void 0),$(this,"_getReferenceLineDraggableRotatable",void 0),$(this,"_getReferenceLineSlabThicknessControlsOn",void 0),$(this,"editData",void 0),$(this,"initializeViewport",D=>{let{renderingEngineId:O,viewportId:N}=D;const R=(0,j.getEnabledElementByIds)(N,O),{FrameOfReferenceUID:L,viewport:P}=R,{element:F}=P,{position:V,focalPoint:G,viewPlaneNormal:W}=P.getCamera();let q=this._getAnnotations(R);return q=this.filterInteractableAnnotationsForElement(F,q),q.length&&Ht(q[0].annotationUID),fn({highlighted:!1,metadata:{cameraPosition:[...V],cameraFocalPoint:[...G],FrameOfReferenceUID:L,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:N}},F),{normal:W,point:P.canvasToWorld([P.canvas.clientWidth/2,P.canvas.clientHeight/2])}}),$(this,"_getViewportsInfo",()=>qn(this.toolGroupId).viewportsInfo),$(this,"resetCrosshairs",()=>{const D=this._getViewportsInfo();for(const O of D){const{viewportId:N,renderingEngineId:R}=O,L=(0,j.getEnabledElementByIds)(N,R),{viewport:P}=L;P.resetCamera(!0,!0,!0,!0,!0),P.resetSlabThickness();const{element:Y}=P;let Z=this._getAnnotations(L);Z=this.filterInteractableAnnotationsForElement(Y,Z),Z.length&&Ht(Z[0].annotationUID),P.render()}this.computeToolCenter(D)}),$(this,"computeToolCenter",D=>{if(!D.length||D.length===1)return void console.warn("For crosshairs to operate, at least two viewports must be given.");const[O,N,R]=D,{normal:L,point:P}=this.initializeViewport(O),{normal:F,point:V}=this.initializeViewport(N);let G=[0,0,0],W=le.vec3.create();R?{normal:G,point:W}=this.initializeViewport(R):(le.vec3.add(W,P,V),le.vec3.scale(W,W,.5),le.vec3.cross(G,L,F));const q=j.utilities.planar.planeEquation(L,P),Y=j.utilities.planar.planeEquation(F,V),Z=j.utilities.planar.planeEquation(G,W);this.toolCenter=j.utilities.planar.threePlaneIntersection(q,Y,Z);const{renderingEngine:ne}=(0,j.getEnabledElementByIds)(D[0].viewportId,D[0].renderingEngineId);We(ne,D.map(oe=>{let{viewportId:ue}=oe;return ue}))}),$(this,"addNewAnnotation",D=>{const O=D.detail,{element:N}=O,{currentPoints:R}=O,L=R.world,P=(0,j.getEnabledElement)(N),{viewport:F}=P;this._jump(P,L);const V=this._getAnnotations(P),G=this.filterInteractableAnnotationsForElement(F.element,V),{data:W}=G[0],{rotationPoints:q}=W.handles,Y=[];for(let Z=0;Z<q.length-1;++Z){const ne=q[Z][1],oe=this._getReferenceLineControllable(ne.id),ue=this._getReferenceLineDraggableRotatable(ne.id);oe&&ue&&(Y.push(ne.id),Z++)}return W.activeViewportIds=[...Y],W.handles.activeOperation=1,D.preventDefault(),Wt(N),this._activateModify(N),G[0]}),$(this,"cancel",()=>{console.log("Not implemented yet")}),$(this,"handleSelectedCallback",(D,O)=>{const N=D.detail,{element:R}=N;O.highlighted=!0,this._activateModify(R),Wt(R),D.preventDefault()}),$(this,"isPointNearTool",(D,O,N,R)=>!!this._pointNearTool(D,O,N,6)),$(this,"toolSelectedCallback",(D,O,N)=>{const R=D.detail,{element:L}=R;O.highlighted=!0,this._activateModify(L),Wt(L),D.preventDefault()}),$(this,"onCameraModified",D=>{var O;const N=D.detail,{element:R}=N,L=(0,j.getEnabledElement)(R),{renderingEngine:P}=L,F=L.viewport,V=this._getAnnotations(L),G=this.filterInteractableAnnotationsForElement(R,V)[0];if(!G)return;const W=F.getCamera(),q=G.metadata.cameraPosition,Y=[0,0,0];hn().subtract(W.position,q,Y);const Z=G.metadata.cameraFocalPoint,ne=[0,0,0];hn().subtract(W.focalPoint,Z,ne),G.metadata.cameraPosition=[...W.position],G.metadata.cameraFocalPoint=[...W.focalPoint];const oe=this._getReferenceLineControllable(F.id),ue=this._getReferenceLineDraggableRotatable(F.id);if(!j.utilities.isEqual(W.position,q,.001)&&oe&&ue){let me=!1;j.utilities.isEqual(Y,ne,.001)||(me=!0);const xe=Math.abs(hn().dot(Y,W.viewPlaneNormal))<.01;me||xe||(this.toolCenter[0]+=Y[0],this.toolCenter[1]+=Y[1],this.toolCenter[2]+=Y[2])}(O=this.configuration.autoPan)!==null&&O!==void 0&&O.enabled&&nr(F.id,P.id).getViewportIds().filter(me=>me!==F.id).forEach(me=>{this._autoPanViewportIfNecessary(me,P)});const ge=Mt(R,this.getToolName(),!1);We(P,ge)}),$(this,"onResetCamera",D=>{this.resetCrosshairs()}),$(this,"mouseMoveCallback",(D,O)=>{const{element:N,currentPoints:R}=D.detail,L=R.canvas;let P=!1;for(let F=0;F<O.length;F++){const V=O[F];if(cr(V))continue;const{data:G,highlighted:W}=V;if(!G.handles)continue;const q=G.handles.activeOperation,Y=G.activeViewportIds&&G.activeViewportIds.length>0?[...G.activeViewportIds]:[];G.activeViewportIds=[],G.handles.activeOperation=null;let Z=!1;Z=!!this.getHandleNearImagePoint(N,V,L,6)||this._pointNearTool(N,V,L,6),Z&&!W||!Z&&W?(V.highlighted=!W,P=!0):G.handles.activeOperation===q&&this._areViewportIdArraysEqual(G.activeViewportIds,Y)||(P=!0)}return P}),$(this,"filterInteractableAnnotationsForElement",(D,O)=>{if(!O||!O.length)return[];const N=(0,j.getEnabledElement)(D),{viewportId:R}=N;return O.filter(L=>L.data.viewportId===R)}),$(this,"renderAnnotation",(D,O)=>{let N=!1;const{viewport:R,renderingEngine:L}=D,{element:P}=R,F=this._getAnnotations(D),V=R.getCamera(),G=this.filterInteractableAnnotationsForElement(P,F)[0];if(F==null||!F.length||G==null||!G.data)return N;const W=G.annotationUID,{clientWidth:q,clientHeight:Y}=R.canvas,Z=Math.sqrt(q*q+Y*Y),ne=Math.min(q,Y),oe=G.data,ue=R.worldToCanvas(this.toolCenter),ge=this._filterAnnotationsByUniqueViewportOrientations(D,F),me=[],xe=[0,0,q,Y];ge.forEach(_e=>{const{data:Me}=_e;Me.handles.toolCenter=this.toolCenter;const Pe=L.getViewport(Me.viewportId),Ze=Pe.getCamera(),Ye=this._getReferenceLineControllable(Pe.id),at=this._getReferenceLineDraggableRotatable(Pe.id),ot=this._getReferenceLineSlabThicknessControlsOn(Pe.id),{clientWidth:st,clientHeight:ct}=Pe.canvas,Tt=Math.sqrt(st*st+ct*ct),pt=[.5*st,.5*ct],Ct=Pe.canvasToWorld(pt),gt=[0,0,0];hn().cross(V.viewPlaneNormal,Ze.viewPlaneNormal,gt),hn().normalize(gt),hn().multiplyScalar(gt,Tt);const Dt=[0,0,0];hn().add(Ct,gt,Dt);const en=[0,0,0];hn().subtract(Ct,gt,en);const $t=R.worldToCanvas(Dt),mn=R.worldToCanvas(Ct),Cn=le.vec2.create();le.vec2.subtract(Cn,$t,mn),le.vec2.normalize(Cn,Cn);const br=le.vec2.create();le.vec2.scale(br,Cn,100*Z);const ci=le.vec2.create();le.vec2.scale(ci,Cn,.4*ne);const qi=le.vec2.create();le.vec2.scale(qi,Cn,.2*ne);const Da=le.vec2.create(),xl=this.configuration.referenceLinesCenterGapRadius;le.vec2.scale(Da,Cn,ge.length===2?xl:0);const Xi=le.vec2.create(),ca=le.vec2.create(),qc=le.vec2.create(),Xc=le.vec2.create();let Rs=le.vec2.clone(ue);at&&Ye||(Rs=le.vec2.clone(mn)),le.vec2.add(Xi,Rs,Da),le.vec2.add(ca,Rs,br),le.vec2.subtract(qc,Rs,Da),le.vec2.subtract(Xc,Rs,br),Gd(Xi,ca,xe),Gd(qc,Xc,xe);const O0=le.vec2.create();le.vec2.subtract(O0,ue,ci);const M0=le.vec2.create();le.vec2.add(M0,ue,ci);let ua=le.vec2.clone(ue);!at&&ot&&(ua=le.vec2.clone(mn));let As=[...this.toolCenter];!at&&ot&&(As=[...Ct]);const Yc=[0,0,0];hn().subtract(Dt,en,Yc),hn().normalize(Yc);const{viewPlaneNormal:Aw}=V,{matrix:Lw}=zD().buildFromDegree().rotate(90,Aw),Jc=[0,0,0];le.vec3.transformMat4(Jc,Yc,Lw);const ah=Pe.getSlabThickness(),A1=[...Jc];hn().multiplyScalar(A1,ah);const L1=[0,0,0];hn().add(As,A1,L1);const kw=R.worldToCanvas(L1),xo=le.vec2.create();le.vec2.subtract(xo,ua,kw);const Yi=le.vec2.create();le.vec2.subtract(Yi,ua,br),le.vec2.add(Yi,Yi,xo);const oh=le.vec2.create();le.vec2.add(oh,ua,br),le.vec2.add(oh,oh,xo),Gd(Yi,oh,xe);const sh=le.vec2.create();le.vec2.add(sh,ua,br),le.vec2.subtract(sh,sh,xo);const lh=le.vec2.create();le.vec2.subtract(lh,ua,br),le.vec2.subtract(lh,lh,xo),Gd(sh,lh,xe);const k1=le.vec2.create(),P1=le.vec2.create(),F1=le.vec2.create(),V1=le.vec2.create();le.vec2.subtract(k1,ua,qi),le.vec2.add(k1,k1,xo),le.vec2.add(P1,ua,qi),le.vec2.add(P1,P1,xo),le.vec2.subtract(F1,ua,qi),le.vec2.subtract(F1,F1,xo),le.vec2.add(V1,ua,qi),le.vec2.subtract(V1,V1,xo),me.push([Pe,Xi,ca,qc,Xc,Yi,oh,sh,lh,O0,M0,k1,P1,F1,V1])});const Ee=[],Ie=[],be=this._getReferenceLineColor(R.id),Ne=be!==void 0?be:"rgb(200, 200, 200)";if(me.forEach((_e,Me)=>{var Pe,Ze;const Ye=_e[0],at=this._getReferenceLineColor(Ye.id),ot=this._getReferenceLineControllable(Ye.id),st=this._getReferenceLineDraggableRotatable(Ye.id)||((Pe=this.configuration.mobile)===null||Pe===void 0?void 0:Pe.enabled),ct=this._getReferenceLineSlabThicknessControlsOn(Ye.id)||((Ze=this.configuration.mobile)===null||Ze===void 0?void 0:Ze.enabled),Tt=oe.activeViewportIds.find(As=>As===Ye.id);let pt=at!==void 0?at:"rgb(200, 200, 200)",Ct=1;const gt=oe.handles.activeOperation!==null&&oe.handles.activeOperation===1&&Tt;gt&&(Ct=2.5);let Dt="".concat(Me);if(ot&&st?(Dt="".concat(Me,"One"),Mn(O,W,Dt,_e[1],_e[2],{color:pt,lineWidth:Ct}),Dt="".concat(Me,"Two"),Mn(O,W,Dt,_e[3],_e[4],{color:pt,lineWidth:Ct})):Mn(O,W,Dt,_e[2],_e[4],{color:pt,lineWidth:Ct}),ot){var en;pt=at!==void 0?at:"rgb(200, 200, 200)";const As=oe.handles.activeOperation===2,Yc=[_e[9],_e[10]],Aw=[R.canvasToWorld(_e[9]),Ye,_e[1],_e[2]],Lw=[R.canvasToWorld(_e[10]),Ye,_e[3],_e[4]];Ee.push(Aw,Lw);const Jc=oe.handles.activeOperation===3,ah=[_e[11],_e[12],_e[13],_e[14]],A1=[R.canvasToWorld(_e[11]),Ye,_e[5],_e[6]],L1=[R.canvasToWorld(_e[12]),Ye,_e[5],_e[6]],kw=[R.canvasToWorld(_e[13]),Ye,_e[7],_e[8]],xo=[R.canvasToWorld(_e[14]),Ye,_e[7],_e[8]];if(Ie.push(A1,L1,kw,xo),(gt||(en=this.configuration.mobile)!==null&&en!==void 0&&en.enabled)&&!As&&!Jc&&st&&ct){var $t,mn,Cn,br,ci,qi,Da,xl;let Yi="".concat(Me,"One");Qn(O,W,Yi,Yc,{color:pt,handleRadius:($t=this.configuration.mobile)!==null&&$t!==void 0&&$t.enabled?(mn=this.configuration.mobile)===null||mn===void 0?void 0:mn.handleRadius:3,opacity:(Cn=this.configuration.mobile)!==null&&Cn!==void 0&&Cn.enabled?(br=this.configuration.mobile)===null||br===void 0?void 0:br.opacity:1,type:"circle"}),Yi="".concat(Me,"Two"),Qn(O,W,Yi,ah,{color:pt,handleRadius:(ci=this.configuration.mobile)!==null&&ci!==void 0&&ci.enabled?(qi=this.configuration.mobile)===null||qi===void 0?void 0:qi.handleRadius:3,opacity:(Da=this.configuration.mobile)!==null&&Da!==void 0&&Da.enabled?(xl=this.configuration.mobile)===null||xl===void 0?void 0:xl.opacity:1,type:"rect"})}else if(gt&&!As&&!Jc&&st){var Xi,ca,qc,Xc;const Yi="".concat(Me);Qn(O,W,Yi,Yc,{color:pt,handleRadius:(Xi=this.configuration.mobile)!==null&&Xi!==void 0&&Xi.enabled?(ca=this.configuration.mobile)===null||ca===void 0?void 0:ca.handleRadius:3,opacity:(qc=this.configuration.mobile)!==null&&qc!==void 0&&qc.enabled?(Xc=this.configuration.mobile)===null||Xc===void 0?void 0:Xc.opacity:1,type:"circle"})}else if(Tt&&!As&&!Jc&&ct){var Rs,O0,M0,ua;const Yi="".concat(Me);Qn(O,W,Yi,ah,{color:pt,handleRadius:(Rs=this.configuration.mobile)!==null&&Rs!==void 0&&Rs.enabled?(O0=this.configuration.mobile)===null||O0===void 0?void 0:O0.handleRadius:3,opacity:(M0=this.configuration.mobile)!==null&&M0!==void 0&&M0.enabled?(ua=this.configuration.mobile)===null||ua===void 0?void 0:ua.opacity:1,type:"rect"})}else if(As&&st){const Yi="".concat(Me);Qn(O,W,Yi,Yc,{color:pt,handleRadius:2,fill:pt,type:"circle"})}else Jc&&Tt&&ct&&Qn(O,W,Dt,ah,{color:pt,handleRadius:2,fill:pt,type:"rect"});Ye.getSlabThickness()>.5&&ct&&(Dt="".concat(Me,"STOne"),Mn(O,W,Dt,_e[5],_e[6],{color:pt,width:1,lineDash:[2,3]}),Dt="".concat(Me,"STTwo"),Mn(O,W,Dt,_e[7],_e[8],{color:pt,width:_e,lineDash:[2,3]}))}}),N=!0,oe.handles.rotationPoints=Ee,oe.handles.slabThicknessPoints=Ie,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:_e}=this.configuration,Me=[q*((_e==null?void 0:_e.xOffset)||.95),Y*((_e==null?void 0:_e.yOffset)||.05)],Pe=(_e==null?void 0:_e.circleRadius)||.01*Z;_a(O,W,"0",Me,Pe,{color:Ne,fill:Ne})}return N}),$(this,"_getAnnotations",D=>{const{viewport:O}=D,N=an(this.getToolName(),O.element)||[],R=this._getViewportsInfo().map(L=>{let{viewportId:P}=L;return P});return N.filter(L=>{const{data:P}=L;return R.includes(P.viewportId)})}),$(this,"_onNewVolume",D=>{const O=this._getViewportsInfo();this.computeToolCenter(O)}),$(this,"_areViewportIdArraysEqual",(D,O)=>D.length===O.length&&(D.forEach(N=>{let R=!1;for(let L=0;L<O.length;++L)if(N===O[L]){R=!0;break}if(R===!1)return!1}),!0)),$(this,"_getAnnotationsForViewportsWithDifferentCameras",(D,O)=>{const{viewportId:N,renderingEngine:R,viewport:L}=D,P=O.filter(q=>q.data.viewportId!==N);if(!P||!P.length)return[];const F=L.getCamera(),{viewPlaneNormal:V,position:G}=F;return P.filter(q=>{const{viewportId:Y}=q.data,Z=R.getViewport(Y).getCamera();return!(j.utilities.isEqual(Z.viewPlaneNormal,V,.01)&&j.utilities.isEqual(Z.position,G,1))})}),$(this,"_filterViewportWithSameOrientation",(D,O,N)=>{const{renderingEngine:R}=D,{data:L}=O,P=R.getViewport(L.viewportId),F=N.filter(W=>{const{data:q}=W,Y=R.getViewport(q.viewportId);return this._getReferenceLineControllable(Y.id)===!0});if(!F||!F.length)return[];const V=P.getCamera(),G=V.viewPlaneNormal;return hn().normalize(G),F.filter(W=>{const{viewportId:q}=W.data,Y=R.getViewport(q).getCamera(),Z=Y.viewPlaneNormal;return hn().normalize(Z),j.utilities.isEqual(G,Z,.01)&&j.utilities.isEqual(V.viewUp,Y.viewUp,.01)})}),$(this,"_filterAnnotationsByUniqueViewportOrientations",(D,O)=>{const{renderingEngine:N,viewport:R}=D,L=R.getCamera().viewPlaneNormal;hn().normalize(L);const P=O.filter(W=>{const{data:q}=W,Y=N.getViewport(q.viewportId),Z=this._getReferenceLineControllable(Y.id);return R!==Y&&Z===!0}),F=[];for(let W=0;W<P.length;++W){const q=P[W],{viewportId:Y}=q.data,Z=N.getViewport(Y).getCamera(),ne=Z.viewPlaneNormal;if(hn().normalize(ne),j.utilities.isEqual(L,ne,.01)||j.utilities.isOpposite(L,ne,.01))continue;let oe=!1;for(let ue=0;ue<F.length;++ue){const ge=F[ue],{viewportId:me}=ge.data,xe=N.getViewport(me).getCamera();j.utilities.isEqual(xe.viewPlaneNormal,Z.viewPlaneNormal,.01)&&j.utilities.isEqual(xe.position,Z.position,1)&&(oe=!0)}oe||F.push(q)}const V=O.filter(W=>{const{data:q}=W,Y=N.getViewport(q.viewportId),Z=this._getReferenceLineControllable(Y.id);return R!==Y&&Z!==!0});for(let W=0;W<V.length;++W){const q=V[W],{viewportId:Y}=q.data,Z=N.getViewport(Y).getCamera(),ne=Z.viewPlaneNormal;if(hn().normalize(ne),j.utilities.isEqual(L,ne,.01)||j.utilities.isOpposite(L,ne,.01))continue;let oe=!1;for(let ue=0;ue<F.length;++ue){const ge=F[ue],{viewportId:me}=ge.data,xe=N.getViewport(me).getCamera();j.utilities.isEqual(xe.viewPlaneNormal,Z.viewPlaneNormal,.01)&&j.utilities.isEqual(xe.position,Z.position,1)&&(oe=!0)}oe||F.push(q)}const G=this._getAnnotationsForViewportsWithDifferentCameras(D,O);for(let W=0;W<G.length;++W){const q=G[W];if(F.some(ue=>ue===q))continue;const{viewportId:Y}=q.data,Z=N.getViewport(Y).getCamera(),ne=Z.viewPlaneNormal;if(hn().normalize(ne),j.utilities.isEqual(L,ne,.01)||j.utilities.isOpposite(L,ne,.01))continue;let oe=!1;for(let ue=0;ue<F.length;++ue){const ge=F[ue],{viewportId:me}=ge.data,xe=N.getViewport(me).getCamera();j.utilities.isEqual(xe.viewPlaneNormal,Z.viewPlaneNormal,.01)&&j.utilities.isEqual(xe.position,Z.position,1)&&(oe=!0)}oe||F.push(q)}return F}),$(this,"_checkIfViewportsRenderingSameScene",(D,O)=>{const N=D.getActors(),R=O.getActors();let L=!0;return N.forEach(P=>{N.length===R.length&&R.find(F=>{let{uid:V}=F;return V===P.uid})!==void 0||(L=!1)}),L}),$(this,"_jump",(D,O)=>{Ke.isInteractingWithTool=!0;const{viewport:N,renderingEngine:R}=D,L=this._getAnnotations(D),P=[0,0,0];hn().subtract(O,this.toolCenter,P);const F=this._getAnnotationsForViewportsWithDifferentCameras(D,L).filter(V=>{const{data:G}=V,W=R.getViewport(G.viewportId),q=this._checkIfViewportsRenderingSameScene(N,W);return this._getReferenceLineControllable(W.id)&&this._getReferenceLineDraggableRotatable(W.id)&&q});return F.length===0?(Ke.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(R,F,P),Ke.isInteractingWithTool=!1,!0)}),$(this,"_activateModify",D=>{var O;Ke.isInteractingWithTool=!((O=this.configuration.mobile)!==null&&O!==void 0&&O.enabled),D.addEventListener(Q.MOUSE_UP,this._endCallback),D.addEventListener(Q.MOUSE_DRAG,this._dragCallback),D.addEventListener(Q.MOUSE_CLICK,this._endCallback),D.addEventListener(Q.TOUCH_END,this._endCallback),D.addEventListener(Q.TOUCH_DRAG,this._dragCallback),D.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",D=>{Ke.isInteractingWithTool=!1,D.removeEventListener(Q.MOUSE_UP,this._endCallback),D.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),D.removeEventListener(Q.MOUSE_CLICK,this._endCallback),D.removeEventListener(Q.TOUCH_END,this._endCallback),D.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),D.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_endCallback",D=>{const O=D.detail,{element:N}=O;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(N),rn(N),this.editData=null;const R=(0,j.getEnabledElement)(N),{renderingEngine:L}=R,P=Mt(N,this.getToolName(),!1);We(L,P)}),$(this,"_dragCallback",D=>{const O=D.detail,N=O.deltaPoints.world;if(Math.abs(N[0])<.001&&Math.abs(N[1])<.001&&Math.abs(N[2])<.001)return;const{element:R}=O,L=(0,j.getEnabledElement)(R),{renderingEngine:P,viewport:F}=L,V=this._getAnnotations(L),G=this.filterInteractableAnnotationsForElement(R,V)[0];if(!G)return;const{handles:W}=G.data,{currentPoints:q}=D.detail,Y=q.canvas;if(W.activeOperation===1){const Z=this._getAnnotationsForViewportsWithDifferentCameras(L,V).filter(ne=>{const{data:oe}=ne,ue=P.getViewport(oe.viewportId),ge=this._getReferenceLineControllable(ue.id),me=this._getReferenceLineDraggableRotatable(ue.id);return ge===!0&&me===!0&&G.data.activeViewportIds.find(xe=>xe===ue.id)});this._applyDeltaShiftToSelectedViewportCameras(P,Z,N)}else if(W.activeOperation===2){const Z=this._getAnnotationsForViewportsWithDifferentCameras(L,V).filter(_e=>{const{data:Me}=_e,Pe=P.getViewport(Me.viewportId),Ze=this._getReferenceLineControllable(Pe.id),Ye=this._getReferenceLineDraggableRotatable(Pe.id);return Ze===!0&&Ye===!0}),ne=le.vec2.create(),oe=le.vec2.create(),ue=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],ge=F.worldToCanvas(ue),me=O.currentPoints.canvas,xe=le.vec2.create();le.vec2.sub(xe,me,O.deltaPoints.canvas),le.vec2.sub(ne,xe,ge),le.vec2.sub(oe,me,ge);let Ee=le.vec2.angle(ne,oe);this._isClockWise(ge,xe,me)&&(Ee*=-1),Ee=Math.round(100*Ee)/100;const Ie=F.getCamera().viewPlaneNormal,{matrix:be}=zD().buildFromRadian().translate(ue[0],ue[1],ue[2]).rotate(Ee,Ie).translate(-ue[0],-ue[1],-ue[2]),Ne=[];Z.forEach(_e=>{const{data:Me}=_e;Me.handles.toolCenter=ue;const Pe=P.getViewport(Me.viewportId),Ze=Pe.getCamera(),{viewUp:Ye,position:at,focalPoint:ot}=Ze;Ye[0]+=at[0],Ye[1]+=at[1],Ye[2]+=at[2],le.vec3.transformMat4(ot,ot,be),le.vec3.transformMat4(at,at,be),le.vec3.transformMat4(Ye,Ye,be),Ye[0]-=at[0],Ye[1]-=at[1],Ye[2]-=at[2],Pe.setCamera({position:at,viewUp:Ye,focalPoint:ot}),Ne.push(Pe.id)}),P.renderViewports(Ne)}else if(W.activeOperation===3){const Z=this._getAnnotationsForViewportsWithDifferentCameras(L,V).filter(ue=>{const{data:ge}=ue,me=P.getViewport(ge.viewportId),xe=this._getReferenceLineControllable(me.id),Ee=this._getReferenceLineSlabThicknessControlsOn(me.id);return xe===!0&&Ee===!0&&G.data.activeViewportIds.find(Ie=>Ie===me.id)});if(Z.length===0)return;const ne=this._filterViewportWithSameOrientation(L,Z[0],V),oe=[];oe.push(F.id),ne.forEach(ue=>{const{data:ge}=ue,me=P.getViewport(ge.viewportId),xe=me.getCamera().viewPlaneNormal,Ee=hn().dot(N,xe),Ie=[...xe];if(hn().multiplyScalar(Ie,Ee),Math.abs(Ie[0])>.001||Math.abs(Ie[1])>.001||Math.abs(Ie[2])>.001){const be=Math.sqrt(Ie[0]*Ie[0]+Ie[1]*Ie[1]+Ie[2]*Ie[2]),Ne=O.lastPoints.world,_e=[0,0,0],Me=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(me.id)){const{rotationPoints:st}=this.editData.annotation.data.handles,ct=st.filter(Tt=>Tt[1].uid===me.id);if(ct.length===2){const Tt=F.canvasToWorld(ct[0][3]),pt=F.canvasToWorld(ct[1][3]);hn().add(Tt,pt,Me),hn().multiplyScalar(Me,.5)}}hn().subtract(Ne,Me,_e);const Pe=hn().dot(_e,xe),Ze=[...xe];hn().multiplyScalar(Ze,Pe);const Ye=[Ze[0],Ze[1],Ze[2]];le.vec3.normalize(Ye,Ye);const at=[Ie[0],Ie[1],Ie[2]];le.vec3.normalize(at,at);let ot=me.getSlabThickness();j.utilities.isOpposite(Ye,at,.001)?ot-=be:ot+=be,ot=Math.abs(ot),ot=Math.max(aw.MINIMUM_SLAB_THICKNESS,ot),this._pointNearReferenceLine(G,Y,6,me)&&(ot=aw.MINIMUM_SLAB_THICKNESS),nr(me.id,P.id).getToolInstance(this.getToolName()).setSlabThickness(me,ot),oe.push(me.id)}}),P.renderViewports(oe)}}),$(this,"_pointNearReferenceLine",(D,O,N,R)=>{const{data:L}=D,{rotationPoints:P}=L.handles;for(let F=0;F<P.length-1;++F){const V=P[F][1];if(V.id!==R.id||!this._getReferenceLineControllable(V.id))continue;const G={start:{x:P[F][2][0],y:P[F][2][1]},end:{x:P[F][3][0],y:P[F][3][1]}},W=mi([G.start.x,G.start.y],[G.end.x,G.end.y],[O[0],O[1]]),q={start:{x:P[F+1][2][0],y:P[F+1][2][1]},end:{x:P[F+1][3][0],y:P[F+1][3][1]}},Y=mi([q.start.x,q.start.y],[q.end.x,q.end.y],[O[0],O[1]]);if(W<=N||Y<=N)return!0;F++}return!1}),this._getReferenceLineColor=((u=S.configuration)===null||u===void 0?void 0:u.getReferenceLineColor)||tq,this._getReferenceLineControllable=((g=S.configuration)===null||g===void 0?void 0:g.getReferenceLineControllable)||nq,this._getReferenceLineDraggableRotatable=((m=S.configuration)===null||m===void 0?void 0:m.getReferenceLineDraggableRotatable)||rq,this._getReferenceLineSlabThicknessControlsOn=((v=S.configuration)===null||v===void 0?void 0:v.getReferenceLineSlabThicknessControlsOn)||iq}onSetToolActive(){const u=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(u),this._subscribeToViewportNewVolumeSet(u),this.computeToolCenter(u)}onSetToolPassive(){const u=this._getViewportsInfo();this.computeToolCenter(u)}onSetToolEnabled(){const u=this._getViewportsInfo();this.computeToolCenter(u)}onSetToolDisabled(){const u=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(u),u.forEach(g=>{let{renderingEngineId:m,viewportId:v}=g;const S=(0,j.getEnabledElementByIds)(v,m);if(!S)return;const D=this._getAnnotations(S);D!=null&&D.length&&D.forEach(O=>{Ht(O.annotationUID)})})}getHandleNearImagePoint(u,g,m,v){const S=(0,j.getEnabledElement)(u),{viewport:D}=S;let O=this._getRotationHandleNearImagePoint(D,g,m,v);return O!==null?O:(O=this._getSlabThicknessHandleNearImagePoint(D,g,m,v),O!==null?O:void 0)}_unsubscribeToViewportNewVolumeSet(u){u.forEach(g=>{let{viewportId:m,renderingEngineId:v}=g;const{viewport:S}=(0,j.getEnabledElementByIds)(m,v),{element:D}=S;D.removeEventListener(j.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(u){u.forEach(g=>{let{viewportId:m,renderingEngineId:v}=g;const{viewport:S}=(0,j.getEnabledElementByIds)(m,v),{element:D}=S;D.addEventListener(j.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(u,g){const m=g.getViewport(u),{clientWidth:v,clientHeight:S}=m.canvas,D=m.worldToCanvas(this.toolCenter),O=this.configuration.autoPan.panSize,N=[D[0],D[1]];if(D[0]<0?N[0]=O:D[0]>v&&(N[0]=v-O),D[1]<0?N[1]=O:D[1]>S&&(N[1]=S-O),N[0]===D[0]&&N[1]===D[1])return;const R=m.canvasToWorld(N),L=[R[0]-this.toolCenter[0],R[1]-this.toolCenter[1],R[2]-this.toolCenter[2]],P=m.getCamera(),{focalPoint:F,position:V}=P,G=[V[0]-L[0],V[1]-L[1],V[2]-L[2]],W=[F[0]-L[0],F[1]-L[1],F[2]-L[2]];m.setCamera({focalPoint:W,position:G}),m.render()}setSlabThickness(u,g){let m;const{filterActorUIDsToSetSlabThickness:v}=this.configuration;v&&v.length>0&&(m=v);let S=this.configuration.slabThicknessBlendMode;g===aw.MINIMUM_SLAB_THICKNESS&&(S=j.Enums.BlendModes.COMPOSITE),u.setBlendMode(S,m,!1),u.setSlabThickness(g,m)}_isClockWise(u,g,m){return(g[0]-u[0])*(m[1]-u[1])-(g[1]-u[1])*(m[0]-u[0])>0}_applyDeltaShiftToSelectedViewportCameras(u,g,m){g.forEach(v=>{this._applyDeltaShiftToViewportCamera(u,v,m)})}_applyDeltaShiftToViewportCamera(u,g,m){const{data:v}=g,S=u.getViewport(v.viewportId),D=S.getCamera(),O=D.viewPlaneNormal,N=hn().dot(m,O),R=[...O];if(hn().multiplyScalar(R,N),Math.abs(R[0])>.001||Math.abs(R[1])>.001||Math.abs(R[2])>.001){const L=[0,0,0],P=[0,0,0];hn().add(D.focalPoint,R,L),hn().add(D.position,R,P),S.setCamera({focalPoint:L,position:P}),S.render()}}_getRotationHandleNearImagePoint(u,g,m,v){const{data:S}=g,{rotationPoints:D}=S.handles;for(let O=0;O<D.length;O++){const N=D[O][0],R=D[O][1];if(!this._getReferenceLineControllable(R.id)||!this._getReferenceLineDraggableRotatable(R.id))continue;const L=u.worldToCanvas(N);if(le.vec2.distance(m,L)<v)return S.handles.activeOperation=2,this.editData={annotation:g},N}return null}_getSlabThicknessHandleNearImagePoint(u,g,m,v){const{data:S}=g,{slabThicknessPoints:D}=S.handles;for(let O=0;O<D.length;O++){const N=D[O][0],R=D[O][1];if(!this._getReferenceLineControllable(R.id)||!this._getReferenceLineSlabThicknessControlsOn(R.id))continue;const L=u.worldToCanvas(N);if(le.vec2.distance(m,L)<v)return S.handles.activeOperation=3,S.activeViewportIds=[R.id],this.editData={annotation:g},N}return null}_pointNearTool(u,g,m,v){const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{clientWidth:O,clientHeight:N}=D.canvas,R=Math.sqrt(O*O+N*N),{data:L}=g,{rotationPoints:P}=L.handles,{slabThicknessPoints:F}=L.handles,V=[];for(let G=0;G<P.length-1;++G){const W=P[G][1],q=this._getReferenceLineControllable(W.id),Y=this._getReferenceLineDraggableRotatable(W.id);if(!q||!Y)continue;const Z={start:{x:P[G][2][0],y:P[G][2][1]},end:{x:P[G][3][0],y:P[G][3][1]}},ne=mi([Z.start.x,Z.start.y],[Z.end.x,Z.end.y],[m[0],m[1]]),oe={start:{x:P[G+1][2][0],y:P[G+1][2][1]},end:{x:P[G+1][3][0],y:P[G+1][3][1]}},ue=mi([oe.start.x,oe.start.y],[oe.end.x,oe.end.y],[m[0],m[1]]);(ne<=v||ue<=v)&&(V.push(W.id),L.handles.activeOperation=1),G++}for(let G=0;G<F.length-1;++G){const W=F[G][1];if(V.find(_e=>_e===W.id))continue;const q=this._getReferenceLineControllable(W.id),Y=this._getReferenceLineSlabThicknessControlsOn(W.id);if(!q||!Y)continue;const Z=F[G][2],ne=F[G][3],oe=le.vec2.create();le.vec2.add(oe,Z,ne),le.vec2.scale(oe,oe,.5);const ue=le.vec2.create();le.vec2.subtract(ue,Z,oe),le.vec2.normalize(ue,ue);const ge=le.vec2.create();le.vec2.scale(ge,ue,.05*R);const me=le.vec2.create(),xe=le.vec2.create();le.vec2.add(me,oe,ge),le.vec2.subtract(xe,oe,ge);const Ee={start:{x:me[0],y:me[1]},end:{x:Z[0],y:Z[1]}},Ie=mi([Ee.start.x,Ee.start.y],[Ee.end.x,Ee.end.y],[m[0],m[1]]),be={start:{x:xe[0],y:xe[1]},end:{x:ne[0],y:ne[1]}},Ne=mi([be.start.x,be.start.y],[be.end.x,be.end.y],[m[0],m[1]]);(Ie<=v||Ne<=v)&&(V.push(W.id),L.handles.activeOperation=null),G++}return L.activeViewportIds=[...V],this.editData={annotation:g},L.handles.activeOperation===1}}$(ow,"toolName",void 0),ow.toolName="Crosshairs";const aq=ow,{EPSILON:sw}=j.CONSTANTS;class lw extends Lc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",showFullDimension:!1}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",{}),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"_init",()=>{const u=(0,j.getRenderingEngines)()[0];if(!u)return;let g=u.getViewports();g=Xp(g,this.getToolName());const m=u.getViewport(this.configuration.sourceViewportId);if(m==null||!m.getImageData())return;const{element:v}=m,{viewUp:S,viewPlaneNormal:D}=m.getCamera(),O=j.utilities.getViewportImageCornersInWorld(m);let N=this.editData.annotation;const R=m.getFrameOfReferenceUID();if(N)this.editData.annotation.data.handles.points=O;else{const L={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...D],viewUp:[...S],FrameOfReferenceUID:R,referencedImageId:null},data:{handles:{points:O}}};fn(L,v),N=L}this.editData={sourceViewportId:m.id,renderingEngine:u,annotation:N},We(u,g.filter(L=>L.id!==m.id).map(L=>L.id))}),$(this,"onSetToolEnabled",()=>{this._init()}),$(this,"onSetToolConfiguration",()=>{this._init()}),$(this,"onCameraModified",u=>{this._init()}),$(this,"renderAnnotation",(u,g)=>{var m;const{viewport:v}=u,{annotation:S,sourceViewportId:D}=this.editData;let O=!1;const{viewport:N}=(0,j.getEnabledElementByViewportId)(D)||{};if(!N||N.id===v.id||!S||S==null||(m=S.data)===null||m===void 0||(m=m.handles)===null||m===void 0||!m.points)return O;const R={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id},L=S.data.handles.points[0],P=S.data.handles.points[1],F=S.data.handles.points[2],V=S.data.handles.points[3],{focalPoint:G,viewPlaneNormal:W,viewUp:q}=v.getCamera(),{viewPlaneNormal:Y}=N.getCamera();if(this.isParallel(W,Y))return O;const Z=j.utilities.planar.planeEquation(W,G),ne=[L,F,P,V],oe=[L,P,F,V];let ue=ne,ge=le.vec3.subtract(le.vec3.create(),ne[0],ne[1]);ge=le.vec3.normalize(le.vec3.create(),ge);let me=le.vec3.subtract(le.vec3.create(),ne[2],ne[0]);me=le.vec3.normalize(le.vec3.create(),me);const xe=le.vec3.cross(le.vec3.create(),ge,me);if(this.isParallel(xe,W))return O;this.isPerpendicular(ge,W)&&(ue=oe);const Ee=j.utilities.planar.linePlaneIntersection(ue[0],ue[1],Z),Ie=j.utilities.planar.linePlaneIntersection(ue[2],ue[3],Z),{annotationUID:be}=S;R.annotationUID=be;const Ne=this.getStyle("lineWidth",R,S),_e=this.getStyle("lineDash",R,S),Me=this.getStyle("color",R,S),Pe=this.getStyle("shadow",R,S);let Ze=[Ee,Ie].map(at=>v.worldToCanvas(at));if(this.configuration.showFullDimension&&(Ze=this.handleFullDimension(v,Ee,W,q,Ie,Ze)),Ze.length<2)return O;const Ye="".concat(be,"-line");return Mn(g,be,"1",Ze[0],Ze[1],{color:Me,width:Ne,lineDash:_e,shadow:Pe},Ye),O=!0,O}),$(this,"isPerpendicular",(u,g)=>{const m=le.vec3.dot(u,g);return Math.abs(m)<sw})}handleFullDimension(u,g,m,v,S,D){const O=u.getRenderingEngine(),N=this.getTargetId(u),R=this.getTargetIdImage(N,O),L=this.getReferencedImageId(u,g,m,v);if(L&&R)try{const{imageData:P,dimensions:F}=R,[V,G,W,q]=[P.indexToWorld([0,0,0]),P.indexToWorld([F[0]-1,0,0]),P.indexToWorld([F[0]-1,F[1]-1,0]),P.indexToWorld([0,F[1]-1,0])].map(ne=>j.utilities.worldToImageCoords(L,ne)),[Y,Z]=[g,S].map(ne=>j.utilities.worldToImageCoords(L,ne));D=[[V,G],[G,W],[q,W],[V,q]].map(ne=>{let[oe,ue]=ne;return this.intersectInfiniteLines(oe,ue,Y,Z)}).filter(ne=>ne&&this.isInBound(ne,F)).map(ne=>{const oe=j.utilities.imageToWorldCoords(L,ne);return u.worldToCanvas(oe)})}catch(P){console.log(P)}return D}intersectInfiniteLines(u,g,m,v){const[S,D]=u,[O,N]=g,[R,L]=m,[P,F]=v,V=N-D,G=S-O,W=O*D-S*N,q=F-L,Y=R-P,Z=P*L-R*F;if(!(Math.abs(V*Y-q*G)<sw))return[(G*Z-Y*W)/(V*Y-q*G),(q*W-V*Z)/(V*Y-q*G)]}isParallel(u,g){return Math.abs(le.vec3.dot(u,g))>1-sw}isInBound(u,g){return u[0]>=0&&u[0]<=g[0]&&u[1]>=0&&u[1]<=g[1]}}$(lw,"toolName",void 0),lw.toolName="ReferenceLines";const WD=lw,{EPSILON:jD}=j.CONSTANTS;class cw extends Lc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"onSetToolEnabled",()=>{this._init()}),$(this,"onSetToolActive",()=>{this._init()}),$(this,"_init",()=>{const u=this.configuration.sourceImageIds;if(u==null||!u.length)return void console.warn("OverlayGridTool: No sourceImageIds provided in configuration");const g=j.metaData.get("imagePlaneModule",u[0]);if(!g)return void console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");const{frameOfReferenceUID:m}=g,v=qn(this.toolGroupId).viewportsInfo;if(v==null||!v.length)return void console.warn("OverlayGridTool: No viewports found");const S=an(this.getToolName(),m);if(S==null||!S.length){const D=u.map(O=>this.calculateImageIdPointSets(O));fn({highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:m,referencedImageId:null},data:{viewportData:new Map,pointSets:D}},m)}We((0,j.getRenderingEngine)(v[0].renderingEngineId),v.map(D=>{let{viewportId:O}=D;return O}))}),$(this,"calculateImageIdPointSets",u=>{const{imagePositionPatient:g,rows:m,columns:v,rowCosines:S,columnCosines:D,rowPixelSpacing:O,columnPixelSpacing:N}=j.metaData.get("imagePlaneModule",u),R=[...g],L=[...g],P=[...g],F=[...g];return le.vec3.scaleAndAdd(L,g,D,v*N),le.vec3.scaleAndAdd(P,g,S,m*O),le.vec3.scaleAndAdd(F,P,D,v*N),{pointSet1:[R,P,L,F],pointSet2:[R,L,P,F]}}),$(this,"renderAnnotation",(u,g)=>{const m=this.configuration.sourceImageIds;let v=!1;if(m==null||!m.length)return v;const{viewport:S,FrameOfReferenceUID:D}=u;if(S.getImageIds().length<2)return v;const O=an(this.getToolName(),D);if(O==null||!O.length)return v;const N=O[0],{annotationUID:R}=N,{focalPoint:L,viewPlaneNormal:P}=S.getCamera(),F={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id},V=this.getImageIdNormal(m[0]);if(this.isParallel(P,V))return v;const G=j.utilities.planar.planeEquation(P,L),W=N.data.pointSets,q=N.data.viewportData;for(let Y=0;Y<m.length;Y++){const{pointSet1:Z,pointSet2:ne}=W[Y],oe=q.get(S.id)||this.initializeViewportData(q,S.id);if(!oe.pointSetsToUse[Y]){let _e=Z,Me=le.vec3.subtract(le.vec3.create(),Z[0],Z[1]);Me=le.vec3.normalize(le.vec3.create(),Me),this.isPerpendicular(Me,P)&&(_e=ne),oe.pointSetsToUse[Y]=_e,oe.lineStartsWorld[Y]=j.utilities.planar.linePlaneIntersection(_e[0],_e[1],G),oe.lineEndsWorld[Y]=j.utilities.planar.linePlaneIntersection(_e[2],_e[3],G)}const ue=oe.lineStartsWorld[Y],ge=oe.lineEndsWorld[Y];F.annotationUID=R;const me=this.getStyle("lineWidth",F,N),xe=this.getStyle("lineDash",F,N),Ee=this.getStyle("color",F,N),Ie=this.getStyle("shadow",F,N),be=[ue,ge].map(_e=>S.worldToCanvas(_e)),Ne="".concat(R,"-line");Mn(g,R,"".concat(Y),be[0],be[1],{color:Ee,width:me,lineDash:xe,shadow:Ie},Ne)}return v=!0,v}),$(this,"initializeViewportData",(u,g)=>(u.set(g,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),u.get(g))),$(this,"isPerpendicular",(u,g)=>{const m=le.vec3.dot(u,g);return Math.abs(m)<jD})}isParallel(u,g){return Math.abs(le.vec3.dot(u,g))>1-jD}getImageIdNormal(u){const{imageOrientationPatient:g}=j.metaData.get("imagePlaneModule",u),m=le.vec3.fromValues(g[0],g[1],g[2]),v=le.vec3.fromValues(g[3],g[4],g[5]);return le.vec3.cross(le.vec3.create(),m,v)}}$(cw,"toolName",void 0),cw.toolName="OverlayGrid";const oq=cw;class uw extends Lc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{configuration:{opacity:.5}}),$(this,"_init",()=>{var u;const g=qn(this.toolGroupId).viewportsInfo;if(g==null||!g.length)return void console.warn(this.getToolName()+"Tool: No viewports found");const m=(u=(0,j.getRenderingEngine)(g[0].renderingEngineId))===null||u===void 0?void 0:u.getViewport(g[0].viewportId);if(!m)return;const v=m.getFrameOfReferenceUID(),S=an(this.getToolName(),v);if(S==null||!S.length){const D=new Map;(function(O,N){N.forEach(R=>{var L;let{viewportId:P,renderingEngineId:F}=R;const V=(L=(0,j.getRenderingEngine)(F))===null||L===void 0?void 0:L.getViewport(P);HD(O,V)})})(D,g),fn({highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:v,referencedImageId:null},data:{actorsWorldPointsMap:D}},v)}We((0,j.getRenderingEngine)(g[0].renderingEngineId),g.map(D=>{let{viewportId:O}=D;return O}))}),$(this,"onSetToolEnabled",()=>{this._init()}),$(this,"onCameraModified",u=>{this._init()}),$(this,"renderAnnotation",(u,g)=>{const{viewport:m,FrameOfReferenceUID:v}=u;let S=!1;const D=an(this.getToolName(),v);if(D==null||!D.length)return S;const O=D[0],{annotationUID:N}=O,R=O.data.actorsWorldPointsMap;HD(R,m);const L=m.getActors(),P=$D(m);return L.forEach(F=>{if(F==null||!F.clippingFilter)return;const V=R.get(F.uid);if(!V||!V.get(P))return;let G=1;const{worldPointsSet:W,color:q}=V.get(P);for(let Y=0;Y<W.length;Y++){const Z=W[Y].map(ue=>m.worldToCanvas(ue)),ne={color:q,fillColor:q,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},oe=F.uid+"#"+G;yl(g,N,oe,Z,ne),G++}}),S=!0,S})}}function HD(E,u){const g=u.getActors(),m=$D(u);g.forEach(v=>{if(v==null||!v.clippingFilter)return;let S=E.get(v.uid);if(S||(S=new Map,E.set(v.uid,S)),!S.get(m)){const D=y7(v.clippingFilter.getOutputData());if(!D)return;const O=function(N){function R(L){let P=Math.floor(255*L).toString(16);return P.length===1&&(P="0"+P),P}return"#"+R(N[0])+R(N[1])+R(N[2])}(v.actor.getProperty().getColor());S.set(m,{worldPointsSet:D,color:O})}})}function $D(E){const{viewPlaneNormal:u}=E.getCamera(),g=E.getCurrentImageIdIndex();return"".concat(E.id,"-").concat(u5(u),"-").concat(g)}$(uw,"toolName",void 0),uw.toolName="SegmentationIntersection";const sq=uw;function I1(E,u,g,m){const v=le.vec3.create();le.vec3.cross(v,u,E);const S=le.vec3.fromValues(...g),D=le.vec3.fromValues(...m),O=le.vec3.create();le.vec3.subtract(O,S,D);const N=le.vec3.length(O);if(N<1e-4)return{worldWidth:0,worldHeight:0};const R=le.vec3.dot(O,v)/(N*le.vec3.length(v));return{worldWidth:Math.sqrt(1-R*R)*N,worldHeight:R*N}}const{transformWorldToIndex:KD}=j.utilities;class fw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0,getTextLines:lq,statsCalculator:ti}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",!1),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(m.canvas,(0,j.getEnabledElement)(v)),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F,...O.getViewReference({points:[S]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null},cachedStats:{},initialRotation:O.getRotation()}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,centerWorld:S,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,W),G}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,{points:N}=O.handles,R=kd(N.map(W=>D.worldToCanvas(W))),[L,P]=R,F={left:Math.min(L[0],P[0])+v/2,top:Math.min(L[1],P[1])+v/2,width:Math.abs(L[0]-P[0])-v,height:Math.abs(L[1]-P[1])-v},V={left:Math.min(L[0],P[0])-v/2,top:Math.min(L[1],P[1])-v/2,width:Math.abs(L[0]-P[0])+v,height:Math.abs(L[1]-P[1])+v},G=this._pointInEllipseCanvas(F,m);return!(!this._pointInEllipseCanvas(V,m)||G)}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},Wt(v),this._activateModify(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N,R,L,P,F,V=!1;if(m.worldPosition)V=!0;else{const{points:Y}=D.handles,{viewport:Z}=(0,j.getEnabledElement)(S),{worldToCanvas:ne,canvasToWorld:oe}=Z;O=Y.findIndex(ge=>ge===m);const ue=Y.map(ne);F=ue[O],L=Math.abs(ue[2][0]-ue[3][0]),P=Math.abs(ue[0][1]-ue[1][1]),N=[(ue[2][0]+ue[3][0])/2,(ue[0][1]+ue[1][1])/2],R=oe(N)}const G=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:G,handleIndex:O,canvasWidth:L,canvasHeight:P,centerWorld:R,originalHandleCanvas:F,movingTextBox:V},this._activateModify(S),Wt(S);const W=(0,j.getEnabledElement)(S),{renderingEngine:q}=W;We(q,G),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;v.highlighted=!1,N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const{renderingEngine:R}=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R,S),D&&sn(v)}),$(this,"_dragDrawCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{currentPoints:v}=g,S=v.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{canvasToWorld:R}=N,{annotation:L,viewportIdsToRender:P,centerWorld:F}=this.editData,V=N.worldToCanvas(F),{data:G}=L,W=Math.abs(S[0]-V[0]),q=Math.abs(S[1]-V[1]),Y=[V[0],V[1]-q],Z=[V[0],V[1]+q],ne=[V[0]-W,V[1]],oe=[V[0]+W,V[1]];G.handles.points=[R(Y),R(Z),R(ne),R(oe)],L.invalidated=!0,this.editData.hasMoved=!0,We(O,P)}),$(this,"_dragModifyCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else this._dragHandle(u),v.invalidated=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"_dragHandle",u=>{const g=u.detail,{element:m}=g,{viewport:v}=(0,j.getEnabledElement)(m),{canvasToWorld:S,worldToCanvas:D}=v,{annotation:O,canvasWidth:N,canvasHeight:R,handleIndex:L,centerWorld:P,originalHandleCanvas:F}=this.editData,V=v.worldToCanvas(P),{data:G}=O,{points:W}=G.handles,{currentPoints:q}=g,Y=q.canvas;if(L===0||L===1){const Z=Math.abs(Y[1]-V[1]),ne=[V[0],V[1]-Z],oe=[V[0],V[1]+Z];W[0]=S(ne),W[1]=S(oe);const ue=N/2+(Y[0]-F[0]),ge=[V[0]-ue,V[1]],me=[V[0]+ue,V[1]];W[2]=S(ge),W[3]=S(me)}else{const Z=Math.abs(Y[0]-V[0]),ne=[V[0]-Z,V[1]],oe=[V[0]+Z,V[1]];W[2]=S(ne),W[3]=S(oe);const ue=R/2+(Y[1]-F[1]),ge=[V[0],V[1]-ue],me=[V[0],V[1]+ue];W[0]=S(ge),W[1]=S(me)}}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragDrawCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragDrawCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{handles:q}=W,{points:Y,activeHandleIndex:Z}=q;P.annotationUID=G;const{color:ne,lineWidth:oe,lineDash:ue}=this.getAnnotationStyle({annotation:V,styleSpecifier:P}),ge=Y.map(ct=>D.worldToCanvas(ct)),me=(Math.abs(D.getRotation()-(W.initialRotation||0)),kd(ge)),{centerPointRadius:xe}=this.configuration;if(W.cachedStats[R]&&W.cachedStats[R].areaUnit!=null){if(V.invalidated&&(this._throttledCalculateCachedStats(V,D,L,u),D instanceof j.VolumeViewport)){const{referencedImageId:ct}=V.metadata;for(const Tt in W.cachedStats)Tt.startsWith("imageId")&&L.getStackViewports().find(pt=>{const Ct=j.utilities.imageIdToURI(ct),gt=pt.hasImageURI(Ct),Dt=j.utilities.imageIdToURI(pt.getCurrentImageId());return gt&&Dt!==Ct})&&delete W.cachedStats[Tt]}}else W.cachedStats[R]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(V,D,L);if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let Ee;if(!mr(G))continue;cr(V)||this.editData||Z===null||(Ee=[ge[Z]]),Ee&&Qn(g,G,"0",Ee,{color:ne});const Ie="".concat(G,"-ellipse"),be="0";if(j3(g,G,be,ge,{color:ne,lineDash:ue,lineWidth:oe},Ie),xe>0&&Math.min(Math.abs(me[0][0]-me[1][0])/2,Math.abs(me[0][1]-me[1][1])/2)>3*xe){const ct=this._getCanvasEllipseCenter(ge);_a(g,G,"".concat(be,"-center"),ct,xe,{color:ne,lineDash:ue,lineWidth:oe})}S=!0;const Ne=this.getLinkedTextBoxStyle(P,V);if(!Ne.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const _e=this.configuration.getTextLines(W,R);if(!_e||_e.length===0)continue;let Me;W.handles.textBox.hasMoved||(Me=Ha(me),W.handles.textBox.worldPosition=D.canvasToWorld(Me));const Pe=D.worldToCanvas(W.handles.textBox.worldPosition),Ze=Ki(g,G,"1",_e,Pe,ge,{},Ne),{x:Ye,y:at,width:ot,height:st}=Ze;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([Ye,at]),topRight:D.canvasToWorld([Ye+ot,at]),bottomLeft:D.canvasToWorld([Ye,at+st]),bottomRight:D.canvasToWorld([Ye+ot,at+st])}}return S}),$(this,"_calculateCachedStats",(u,g,m)=>{const v=u.data,{element:S}=g,{points:D}=v.handles,O=D.map(ue=>g.worldToCanvas(ue)),{viewPlaneNormal:N,viewUp:R}=g.getCamera(),[L,P]=kd(O),F=g.canvasToWorld(L),V=g.canvasToWorld(P),{cachedStats:G}=v,W=Object.keys(G),q=F,Y=V;for(let ue=0;ue<W.length;ue++){var Z,ne,oe;const ge=W[ue],me=this.getTargetIdImage(ge,m);if(!me)continue;const{dimensions:xe,imageData:Ee,metadata:Ie}=me,be=KD(Ee,q);be[0]=Math.floor(be[0]),be[1]=Math.floor(be[1]),be[2]=Math.floor(be[2]);const Ne=KD(Ee,Y);Ne[0]=Math.floor(Ne[0]),Ne[1]=Math.floor(Ne[1]),Ne[2]=Math.floor(Ne[2]),this.isHandleOutsideImage=!this._isInsideVolume(be,Ne,xe);const _e=[[Math.min(be[0],Ne[0]),Math.max(be[0],Ne[0])],[Math.min(be[1],Ne[1]),Math.max(be[1],Ne[1])],[Math.min(be[2],Ne[2]),Math.max(be[2],Ne[2])]],Me={center:[(F[0]+V[0])/2,(F[1]+V[1])/2,(F[2]+V[2])/2],xRadius:Math.abs(F[0]-V[0])/2,yRadius:Math.abs(F[1]-V[1])/2,zRadius:Math.abs(F[2]-V[2])/2},{worldWidth:Pe,worldHeight:Ze}=I1(N,R,q,Y),Ye=Pe===0&&Ze===0,at=[be,Ne],{scale:ot,areaUnits:st}=za(me,at),ct=Math.abs(Math.PI*(Pe/2)*(Ze/2))/ot/ot,Tt={isPreScaled:qo(g,ge),isSuvScaled:this.isSuvScaled(g,ge,u.metadata.referencedImageId)},pt=Pc(Ie.Modality,u.metadata.referencedImageId,Tt),Ct=Ii(Ee,Dt=>t1(Me,Dt,{fast:!0}),this.configuration.statsCalculator.statsCallback,_e),gt=this.configuration.statsCalculator.getStatistics();G[ge]={Modality:Ie.Modality,area:ct,mean:(Z=gt.mean)===null||Z===void 0?void 0:Z.value,max:(ne=gt.max)===null||ne===void 0?void 0:ne.value,stdDev:(oe=gt.stdDev)===null||oe===void 0?void 0:oe.value,statsArray:gt.array,pointsInShape:Ct,isEmptyArea:Ye,areaUnit:st,modalityUnit:pt}}return u.invalidated=!1,Yt(u,S),G}),$(this,"_isInsideVolume",(u,g,m)=>j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(u,g){const m=u.width/2,v=u.height/2;if(m<=0||v<=0)return!1;const S=[u.left+m,u.top+v],D=[g[0]-S[0],g[1]-S[1]];return D[0]*D[0]/(m*m)+D[1]*D[1]/(v*v)<=1}_getCanvasEllipseCenter(u){const[g,m,v,S]=u,D=[v[0],m[1]],O=[S[0],g[1]];return[(D[0]+O[0])/2,(D[1]+O[1])/2]}}function lq(E,u){const g=E.cachedStats[u],{area:m,mean:v,stdDev:S,max:D,isEmptyArea:O,areaUnit:N,modalityUnit:R}=g,L=[];if(m){const P=O?"Area: Oblique not supported":"Area: ".concat(cn(m)," ").concat(N);L.push(P)}return v&&L.push("Mean: ".concat(cn(v)," ").concat(R)),D&&L.push("Max: ".concat(cn(D)," ").concat(R)),S&&L.push("Std Dev: ".concat(cn(S)," ").concat(R)),L}$(fw,"toolName",void 0),fw.toolName="EllipticalROI";const cq=fw;function I0(E){const[u,g]=E;return $a(u,g)}function eh(E){const[u,g]=E,m=$a(u,g);return[[u[0]-m,u[1]-m],[u[0]+m,u[1]+m]]}const{transformWorldToIndex:qD}=j.utilities;class dw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0,getTextLines:uq,statsCalculator:ti}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",!1),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F,...O.getViewReference({points:[S]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...S],[...S]],activeHandleIndex:null},cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,W),G}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,{points:N}=O.handles,R=N.map(F=>D.worldToCanvas(F)),L=I0(R),P=I0([R[0],m]);return Math.abs(P-L)<v/2}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},Wt(v),this._activateModify(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;if(m.worldPosition)N=!0;else{const{points:F}=D.handles;O=F.findIndex(V=>V===m)}const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;v.highlighted=!1,N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const{renderingEngine:R}=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R,S),D&&sn(v)}),$(this,"_dragDrawCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{currentPoints:v}=g,S=v.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{canvasToWorld:R}=N,{annotation:L,viewportIdsToRender:P}=this.editData,{data:F}=L;F.handles.points=[F.handles.points[0],R(S)],L.invalidated=!0,this.editData.hasMoved=!0,We(O,P)}),$(this,"_dragModifyCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else this._dragHandle(u),v.invalidated=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"_dragHandle",u=>{const g=u.detail,{element:m}=g,v=(0,j.getEnabledElement)(m),{canvasToWorld:S,worldToCanvas:D}=v.viewport,{annotation:O,handleIndex:N}=this.editData,{data:R}=O,{points:L}=R.handles,P=L.map(G=>D(G)),{currentPoints:F}=g,V=F.canvas;if(N===0){const G=V[0]-P[0][0],W=V[1]-P[0][1],q=V,Y=[P[1][0]+G,P[1][1]+W];L[0]=S(q),L[1]=S(Y)}else L[1]=S(V)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragDrawCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragDrawCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragDrawCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{handles:q}=W,{points:Y,activeHandleIndex:Z}=q;P.annotationUID=G;const{color:ne,lineWidth:oe,lineDash:ue}=this.getAnnotationStyle({annotation:V,styleSpecifier:P}),ge=Y.map(pt=>D.worldToCanvas(pt)),me=ge[0],xe=I0(ge),Ee=eh(ge),{centerPointRadius:Ie}=this.configuration;if(W.cachedStats[R]&&W.cachedStats[R].areaUnit!=null){if(V.invalidated&&(this._throttledCalculateCachedStats(V,D,L,u),D instanceof j.VolumeViewport)){const{referencedImageId:pt}=V.metadata;for(const Ct in W.cachedStats)Ct.startsWith("imageId")&&L.getStackViewports().find(gt=>{const Dt=j.utilities.imageIdToURI(pt),en=gt.hasImageURI(Dt),$t=j.utilities.imageIdToURI(gt.getCurrentImageId());return en&&$t!==Dt})&&delete W.cachedStats[Ct]}}else W.cachedStats[R]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(V,D,L,u);if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let be;if(!mr(G))continue;cr(V)||this.editData||Z===null||(be=[ge[Z]]),be&&Qn(g,G,"0",be,{color:ne});const Ne="".concat(G,"-circle"),_e="0";_a(g,G,_e,me,xe,{color:ne,lineDash:ue,lineWidth:oe},Ne),Ie>0&&xe>3*Ie&&_a(g,G,"".concat(_e,"-center"),me,Ie,{color:ne,lineDash:ue,lineWidth:oe}),S=!0;const Me=this.getLinkedTextBoxStyle(P,V);if(!Me.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Pe=this.configuration.getTextLines(W,R);if(!Pe||Pe.length===0)continue;let Ze;W.handles.textBox.hasMoved||(Ze=Ha(Ee),W.handles.textBox.worldPosition=D.canvasToWorld(Ze));const Ye=D.worldToCanvas(W.handles.textBox.worldPosition),at=Ki(g,G,"1",Pe,Ye,ge,{},Me),{x:ot,y:st,width:ct,height:Tt}=at;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([ot,st]),topRight:D.canvasToWorld([ot+ct,st]),bottomLeft:D.canvasToWorld([ot,st+Tt]),bottomRight:D.canvasToWorld([ot+ct,st+Tt])}}return S}),$(this,"_calculateCachedStats",(u,g,m,v)=>{const S=u.data,{element:D}=g,{points:O}=S.handles,N=O.map(ge=>g.worldToCanvas(ge)),{viewPlaneNormal:R,viewUp:L}=g.getCamera(),[P,F]=eh(N),V=g.canvasToWorld(P),G=g.canvasToWorld(F),{cachedStats:W}=S,q=Object.keys(W),Y=V,Z=G;for(let ge=0;ge<q.length;ge++){const me=q[ge],xe=this.getTargetIdImage(me,m);if(!xe)continue;const{dimensions:Ee,imageData:Ie,metadata:be,hasPixelSpacing:Ne}=xe,_e=qD(Ie,Y);_e[0]=Math.floor(_e[0]),_e[1]=Math.floor(_e[1]),_e[2]=Math.floor(_e[2]);const Me=qD(Ie,Z);if(Me[0]=Math.floor(Me[0]),Me[1]=Math.floor(Me[1]),Me[2]=Math.floor(Me[2]),this._isInsideVolume(_e,Me,Ee)){var ne,oe,ue;const Pe=[[Math.min(_e[0],Me[0]),Math.max(_e[0],Me[0])],[Math.min(_e[1],Me[1]),Math.max(_e[1],Me[1])],[Math.min(_e[2],Me[2]),Math.max(_e[2],Me[2])]],Ze={center:[(V[0]+G[0])/2,(V[1]+G[1])/2,(V[2]+G[2])/2],xRadius:Math.abs(V[0]-G[0])/2,yRadius:Math.abs(V[1]-G[1])/2,zRadius:Math.abs(V[2]-G[2])/2},{worldWidth:Ye,worldHeight:at}=I1(R,L,Y,Z),ot=Ye===0&&at===0,st=[_e,Me],{scale:ct,units:Tt,areaUnits:pt}=za(xe,st),Ct=D5(xe),gt=Math.abs(Math.PI*(Ye/ct/2)*(at/Ct/ct/2)),Dt={isPreScaled:qo(g,me),isSuvScaled:this.isSuvScaled(g,me,u.metadata.referencedImageId)},en=Pc(be.Modality,u.metadata.referencedImageId,Dt),$t=Ii(Ie,Cn=>t1(Ze,Cn,{fast:!0}),this.configuration.statsCalculator.statsCallback,Pe),mn=this.configuration.statsCalculator.getStatistics();W[me]={Modality:be.Modality,area:gt,mean:(ne=mn.mean)===null||ne===void 0?void 0:ne.value,max:(oe=mn.max)===null||oe===void 0?void 0:oe.value,stdDev:(ue=mn.stdDev)===null||ue===void 0?void 0:ue.value,statsArray:mn.array,pointsInShape:$t,isEmptyArea:ot,areaUnit:pt,radius:Ye/2/ct,radiusUnit:Tt,perimeter:2*Math.PI*(Ye/2)/ct,modalityUnit:en}}else this.isHandleOutsideImage=!0,W[me]={Modality:be.Modality}}return u.invalidated=!1,Yt(u,D),W}),$(this,"_isInsideVolume",(u,g,m)=>j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}}function uq(E,u){const g=E.cachedStats[u],{radius:m,radiusUnit:v,area:S,mean:D,stdDev:O,max:N,isEmptyArea:R,areaUnit:L,modalityUnit:P}=g,F=[];if(m){const V=R?"Radius: Oblique not supported":"Radius: ".concat(cn(m)," ").concat(v);F.push(V)}if(S){const V=R?"Area: Oblique not supported":"Area: ".concat(cn(S)," ").concat(L);F.push(V)}return D&&F.push("Mean: ".concat(cn(D)," ").concat(P)),N&&F.push("Max: ".concat(cn(N)," ").concat(P)),O&&F.push("Std Dev: ".concat(cn(O)," ").concat(P)),F}$(dw,"toolName",void 0),dw.toolName="CircleROI";const XD=dw;class fq{constructor(u){var g,m,v;$(this,"_controlPoints",[]),$(this,"_resolution",void 0),$(this,"_fixedResolution",void 0),$(this,"_closed",void 0),$(this,"_invalidated",!1),$(this,"_curveSegments",void 0),$(this,"_aabb",void 0),$(this,"_length",0),this._controlPoints=[],this._resolution=(g=u==null?void 0:u.resolution)!==null&&g!==void 0?g:20,this._fixedResolution=(m=u==null?void 0:u.fixedResolution)!==null&&m!==void 0&&m,this._closed=(v=u==null?void 0:u.closed)!==null&&v!==void 0&&v,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(u){this._fixedResolution||this._resolution===u||(this._resolution=u,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(u){this._closed!==u&&(this._closed=u,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(u){this._invalidated=u}hasTangentPoints(){return!1}addControlPoint(u){this._controlPoints.push([u[0],u[1]]),this.invalidated=!0}addControlPoints(u){u.forEach(g=>this.addControlPoint(g))}addControlPointAtU(u){const g=this._getLineSegmentAt(u),{start:m,end:v}=g.points,S=Math.floor(u),D=this._curveSegments[S],O=u-Math.floor(S),N=[m[0]+O*(v[0]-m[0]),m[1]+O*(v[1]-m[1])],R=this._controlPoints.indexOf(D.controlPoints.p1)+1;return this._controlPoints.splice(R,0,N),this.invalidated=!0,{index:R,point:N}}deleteControlPointByIndex(u){const g=this._closed?3:1;return u>=0&&u<this._controlPoints.length&&this._controlPoints.length>g&&(this._controlPoints.splice(u,1),this.invalidated=!0,!0)}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(u){this.clearControlPoints(),this.addControlPoints(u)}updateControlPoint(u,g){if(u<0||u>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[u]=[...g],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(u=>[u[0],u[1]])}getClosestControlPoint(u){const g=this._controlPoints;let m=1/0,v=-1;for(let S=0,D=g.length;S<D;S++){const O=g[S],N=u[0]-O[0],R=u[1]-O[1],L=N*N+R*R;L<m&&(m=L,v=S)}return{index:v,point:v===-1?void 0:[...g[v]],distance:Math.sqrt(m)}}getClosestControlPointWithinDistance(u,g){const m=this.getClosestControlPoint(u);return m.distance<=g?m:void 0}getClosestPoint(u){this._update();const g=this._getCurveSegmmentsDistanceSquaredInfo(u);if(!g.length)return;let m;g.sort((N,R)=>N.distanceSquared-R.distanceSquared);let v,S,D=-1,O=1/0;for(let N=0;N<g.length;N++){const R=g[N];if(R.distanceSquared>O)continue;const{curveSegmentIndex:L,curveSegment:P}=R,{lineSegments:F}=P;for(let V=0;V<F.length;V++){const G=F[V],{point:W,distanceSquared:q}=Hp(G.points.start,G.points.end,u);q<O&&(S=G,D=L,v=R.curveSegment,m=W,O=q)}}return{point:m,uValue:D+(S.previousLineSegmentsLength+$a(S.points.start,m))/v.length,distance:Math.sqrt(O)}}getClosestPointOnControlPointLines(u){const g=[...this._controlPoints];if(this._closed&&g.push(this._controlPoints[0]),!g.length)return;let m,v=1/0,S=g[0];for(let D=1,O=g.length;D<O;D++){const N=g[D],{point:R,distanceSquared:L}=Hp(S,N,u);L<v&&(m=R,v=L),S=N}return{point:m,distance:Math.sqrt(v)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(u,g){if(this._closed)return[];this._update();const m=this.getClosestControlPointWithinDistance(u,g),v=(m==null?void 0:m.index)===0,S=this.getPreviewCurveSegments(u,v);return S!=null&&S.length?this._convertCurveSegmentsToPolyline(S):[]}isPointNearCurve(u,g){this._update();const m=this._getCurveSegmmentsWithinDistance(u,g),v=g*g;for(let S=0;S<m.length;S++){const{lineSegments:D}=m[S];for(let O=0;O<D.length;O++){const N=D[O];if(Id(N.points.start,N.points.end,u)<=v)return!0}}return!1}containsPoint(u){if(this._update(),this._controlPoints.length<3)return!1;const g=[...this._curveSegments],m=this._getClosingCurveSegmentWithStraightLineSegment();m&&g.push(m);let v=0;for(let S=0;S<g.length;S++){const D=g[S],{aabb:O}=D;if(!(u[0]<=O.maxX&&u[1]>=O.minY&&u[1]<O.maxY))continue;const{lineSegments:N}=D;for(let R=0;R<N.length;R++){const L=N[R],{aabb:P}=L;if(u[0]<=P.maxX&&u[1]>=P.minY&&u[1]<P.maxY){const{start:F,end:V}=L.points,G=F[0]===V[0],W=(u[1]-F[1])*(V[0]-F[0])/(V[1]-F[1])+F[0];v+=G||u[0]<=W?1:0}}}return v%2==1}_update(){if(!this._invalidated)return;const u=this.getSplineCurves();let g=0,m=1/0,v=1/0,S=-1/0,D=-1/0;for(let O=0,N=u.length;O<N;O++){const{aabb:R,length:L}=u[O];m=m<=R.minX?m:R.minX,v=v<=R.minY?v:R.minY,S=S>=R.maxX?S:R.maxX,D=D>=R.maxY?D:R.maxY,g+=L}this._curveSegments=u,this._aabb={minX:m,minY:v,maxX:S,maxY:D},this._length=g,this._invalidated=!1}_convertCurveSegmentsToPolyline(u){this._update();const g=[];return u.forEach((m,v)=>{let{lineSegments:S}=m;S.forEach((D,O)=>{v===0&&O===0&&g.push([...D.points.start]),g.push([...D.points.end])})}),g}_getCurveSegmmentsDistanceSquaredInfo(u){this._update();const g=[],{_curveSegments:m}=this;for(let v=0;v<m.length;v++){const S=m[v],D=c1(S.aabb,u);g.push({curveSegmentIndex:v,curveSegment:S,distanceSquared:D})}return g}_getCurveSegmmentsWithinDistance(u,g){this._update();const m=g*g;if(c1(this.aabb,u)>m)return[];const v=this._getCurveSegmmentsDistanceSquaredInfo(u),S=[];for(let D=0,O=v.length;D<O;D++){const{curveSegment:N,distanceSquared:R}=v[D];R<=m&&S.push(N)}return S}_getLineSegmentAt(u){this._update();const g=Math.floor(u),m=u-g,v=this._curveSegments[g],{lineSegments:S}=v,D=v.length*m;for(let O=0;O<S.length;O++){const N=S[O],R=N.previousLineSegmentsLength+N.length;if(D>=N.previousLineSegmentsLength&&D<=R)return N}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const u=this._controlPoints,g=u[0],m=u[u.length-1],v={points:{start:[...g],end:[...m]},aabb:{minX:Math.min(g[0],m[0]),minY:Math.min(g[1],m[1]),maxX:Math.max(g[0],m[0]),maxY:Math.max(g[1],m[1])}};return{aabb:{minX:v.aabb.minX,minY:v.aabb.minY,maxX:v.aabb.maxX,maxY:v.aabb.maxY},lineSegments:[v]}}}class YD extends fq{getPreviewCurveSegments(u,g){const m=this._getNumCurveSegments()+1,v=Math.max(0,m-2),S=g?m:m-1,D=this.getTransformMatrix(),O=[...this.controlPoints],N=[];g||O.push(u);for(let R=v;R<=S;R++){const L=this._getCurveSegment(R,D,O,g);N.push(L)}return N}getSplineCurves(){const u=this._getNumCurveSegments(),g=new Array(u);if(u<=0)return[];const m=this.getTransformMatrix();let v=0;for(let S=0;S<u;S++){const D=this._getCurveSegment(S,m);D.previousCurveSegmentsLength=v,g[S]=D,v+=D.length}return g}_getNumCurveSegments(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.controlPoints;return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.closed)?u.length:Math.max(0,u.length-1)}_getPoint(u,g){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.controlPoints,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.closed;const S=this._getNumCurveSegments(m,v),D=Math.floor(u);let O=D%S;const N=u-D;if(O<0||O>=S){if(!this.closed)return;O=(S+O)%S}const{p0:R,p1:L,p2:P,p3:F}=this._getCurveSegmentPoints(O,m,v),V=N*N,G=V*N,W=le.vec4.fromValues(1,N,V,G),q=le.vec4.transformMat4(le.vec4.create(),W,g);return[le.vec4.dot(q,le.vec4.fromValues(R[0],L[0],P[0],F[0])),le.vec4.dot(q,le.vec4.fromValues(R[1],L[1],P[1],F[1]))]}_getCurveSegmentPoints(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.controlPoints,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.closed;const v=this._getNumCurveSegments(g,m),S=u-1,D=m?(u+1)%v:u+1,O=D+1,N=g[u],R=g[D];let L,P;return L=S>=0?g[S]:m?g[g.length-1]:u3(R,N),P=O<g.length?g[O]:m?g[0]:u3(N,R),{p0:L,p1:N,p2:R,p3:P}}_getLineSegments(u,g){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.controlPoints,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.closed;const S=this._getNumCurveSegments(m,v),D=this.resolution+1,O=1/D;let N=u+1;v||u!==S-1||(N-=1e-8);const R=[];let L,P,F=0;for(let V=0,G=u;V<=D;V++,G+=O){G=G>N?N:G;const W=this._getPoint(G,g,m,v);if(!V){L=W;continue}P=W;const q=P[0]-L[0],Y=P[1]-L[1],Z=Math.sqrt(q**2+Y**2),ne={minX:L[0]<=P[0]?L[0]:P[0],maxX:L[0]>=P[0]?L[0]:P[0],minY:L[1]<=P[1]?L[1]:P[1],maxY:L[1]>=P[1]?L[1]:P[1]};R.push({points:{start:L,end:P},aabb:ne,length:Z,previousLineSegmentsLength:F}),L=P,F+=Z}return R}_getCurveSegment(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getTransformMatrix(),m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.controlPoints,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.closed;const{p0:S,p1:D,p2:O,p3:N}=this._getCurveSegmentPoints(u,m,v),R=this._getLineSegments(u,g,m,v);let L=0,P=1/0,F=1/0,V=-1/0,G=-1/0;return R.forEach(W=>{let{aabb:q,length:Y}=W;P=Math.min(P,q.minX),F=Math.min(F,q.minY),V=Math.max(V,q.maxX),G=Math.max(G,q.maxY),L+=Y}),{controlPoints:{p0:S,p1:D,p2:O,p3:N},aabb:{minX:P,minY:F,maxX:V,maxY:G},length:L,previousCurveSegmentsLength:0,lineSegments:R}}}class O1 extends YD{constructor(u){var g,m;super(u),$(this,"_scale",void 0),$(this,"_fixedScale",void 0),this._scale=(g=u==null?void 0:u.scale)!==null&&g!==void 0?g:.5,this._fixedScale=(m=u==null?void 0:u.fixedScale)!==null&&m!==void 0&&m}get scale(){return this._scale}set scale(u){this._fixedScale||this._scale===u||(this._scale=u,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:u}=this,g=2*u;return[0,1,0,0,-u,0,u,0,g,u-3,3-g,-u,-u,2-u,u-2,u]}}class dq extends O1{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class hq extends O1{constructor(){super({scale:.5,fixedScale:!0})}}const gq=le.mat4.multiplyScalar(le.mat4.create(),le.mat4.fromValues(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class pq extends YD{getTransformMatrix(){return gq}}const mq={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var Hc=function(E){return E.Cardinal="CARDINAL",E.Linear="LINEAR",E.CatmullRom="CATMULLROM",E.BSpline="BSPLINE",E}(Hc||{}),M1=function(E){return E.AddControlPoint="addControlPoint",E.DeleteControlPoint="deleteControlPoint",E}(M1||{});class th extends M3{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:vq,contourHoleAdditionModifierKey:li.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[Hc.Cardinal]:{Class:O1,scale:.5},[Hc.CatmullRom]:{Class:hq},[Hc.Linear]:{Class:dq},[Hc.BSpline]:{Class:pq,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:Hc.CatmullRom,drawPreviewEnabled:!0,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[M1.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:Uc.Primary,modifierKey:li.Shift}]},[M1.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:Uc.Primary,modifierKey:li.Ctrl}]}}}}),u=this,$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",!1),$(this,"fireChangeOnUpdate",null),$(this,"isPointNearTool",(g,m,v,S)=>{const{instance:D}=m.data.spline;return D.isPointNearCurve(v,S)}),$(this,"toolSelectedCallback",(g,m)=>{const v=g.detail,{element:S}=v;m.highlighted=!0;const D=Mt(S,this.getToolName());this.editData={annotation:m,viewportIdsToRender:D,movingTextBox:!1};const O=(0,j.getEnabledElement)(S),{renderingEngine:N}=O;this._activateModify(S),We(N,D),g.preventDefault()}),$(this,"handleSelectedCallback",(g,m,v)=>{const S=g.detail,{element:D}=S,{data:O}=m;m.highlighted=!0;let N,R=!1;if(v.worldPosition)R=!0;else{const{points:V}=O.handles;N=V.findIndex(G=>G===v)}const L=Mt(D,this.getToolName());this.editData={annotation:m,viewportIdsToRender:L,handleIndex:N,movingTextBox:R},this._activateModify(D);const P=(0,j.getEnabledElement)(D),{renderingEngine:F}=P;We(F,L),g.preventDefault()}),$(this,"_endCallback",g=>{const m=g.detail,{element:v}=m,{annotation:S,viewportIdsToRender:D,newAnnotation:O,contourHoleProcessingEnabled:N}=this.editData,{data:R}=S;S.autoGenerated=!1,R.handles.activeHandleIndex=null,this._deactivateModify(v),this._deactivateDraw(v),rn(v);const L=(0,j.getEnabledElement)(v),{renderingEngine:P}=L,F=this.getTargetIdImage(this.getTargetId(L.viewport),L.renderingEngine),{imageData:V,dimensions:G}=F;this.isHandleOutsideImage=R.handles.points.map(q=>j.utilities.transformWorldToIndex(V,q)).some(q=>!j.utilities.indexWithinDimensions(q,G)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(S.annotationUID);const W=O?vr.Completed:vr.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=S.annotationUID,this.fireChangeOnUpdate.changeType=W):this.fireChangeOnUpdate={annotationUID:S.annotationUID,changeType:W,contourHoleProcessingEnabled:N},We(P,D),this.editData=null,this.isDrawing=!1}),$(this,"_keyDownCallback",g=>{var m;const v=g.detail,{element:S}=v,D=(m=v.key)!==null&&m!==void 0?m:"",{lastControlPointDeletionKeys:O}=this.configuration.spline;if(!O.includes(D))return;const{annotation:N}=this.editData,{data:R}=N;if(R.handles.points.length!==3){{const L=R.handles.points.length-1;this._deleteControlPointByIndex(S,N,L)}g.preventDefault()}else this.cancel(S)}),$(this,"_mouseMoveCallback",g=>{const{drawPreviewEnabled:m}=this.configuration.spline;if(!m)return;const{element:v}=g.detail,{renderingEngine:S}=(0,j.getEnabledElement)(v),D=Mt(v,this.getToolName());this.editData.lastCanvasPoint=g.detail.currentPoints.canvas,We(S,D),g.preventDefault()}),$(this,"_mouseDownCallback",g=>{const m=g.type===Q.MOUSE_DOUBLE_CLICK,{annotation:v,viewportIdsToRender:S}=this.editData,{data:D}=v;if(D.contour.closed)return;const O=g.detail,{element:N}=O,{currentPoints:R}=O,{canvas:L,world:P}=R,F=(0,j.getEnabledElement)(N),{renderingEngine:V}=F;let G=D.handles.points.length>=2&&m,W=!0;if(D.handles.points.length>=3){const{instance:q}=D.spline,Y=q.getClosestControlPointWithinDistance(L,10);(Y==null?void 0:Y.index)===0&&(W=!1,G=!0)}W&&D.handles.points.push(P),D.contour.closed=D.contour.closed||G,v.invalidated=!0,We(V,S),D.contour.closed&&this._endCallback(g),g.preventDefault()}),$(this,"_dragCallback",g=>{this.isDrawing=!0;const m=g.detail,{element:v}=m,{annotation:S,viewportIdsToRender:D,handleIndex:O,movingTextBox:N}=this.editData,{data:R}=S;if(N){const{deltaPoints:F}=m,V=F.world,{textBox:G}=R.handles,{worldPosition:W}=G;W[0]+=V[0],W[1]+=V[1],W[2]+=V[2],G.hasMoved=!0}else if(O===void 0){const{deltaPoints:F}=m,V=F.world;this.moveAnnotation(S,V)}else{const{currentPoints:F}=m,V=F.world;R.handles.points[O]=[...V],S.invalidated=!0}this.editData.hasMoved=!0;const L=(0,j.getEnabledElement)(v),{renderingEngine:P}=L;We(P,D)}),$(this,"triggerAnnotationCompleted",(g,m)=>{const v=Q.ANNOTATION_COMPLETED,S={annotation:g,changeType:vr.Completed,contourHoleProcessingEnabled:m};(0,j.triggerEvent)(j.eventTarget,v,S)}),$(this,"triggerAnnotationModified",function(g,m){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vr.StatsUpdated;const{viewportId:S,renderingEngineId:D}=m,O=Q.ANNOTATION_MODIFIED,N={annotation:g,viewportId:S,renderingEngineId:D,changeType:v};(0,j.triggerEvent)(j.eventTarget,O,N)}),$(this,"triggerChangeEvent",function(g,m){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vr.StatsUpdated,S=arguments.length>3?arguments[3]:void 0;v===vr.Completed?u.triggerAnnotationCompleted(g,S):u.triggerAnnotationModified(g,m,v)}),$(this,"_activateModify",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._endCallback),g.addEventListener(Q.MOUSE_DRAG,this._dragCallback),g.addEventListener(Q.MOUSE_CLICK,this._endCallback),g.addEventListener(Q.TOUCH_END,this._endCallback),g.addEventListener(Q.TOUCH_DRAG,this._dragCallback),g.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._endCallback),g.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._endCallback),g.removeEventListener(Q.TOUCH_END,this._endCallback),g.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),g.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.KEY_DOWN,this._keyDownCallback),g.addEventListener(Q.MOUSE_MOVE,this._mouseMoveCallback),g.addEventListener(Q.MOUSE_DOWN,this._mouseDownCallback),g.addEventListener(Q.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),g.addEventListener(Q.TOUCH_TAP,this._mouseDownCallback)}),$(this,"_deactivateDraw",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.KEY_DOWN,this._keyDownCallback),g.removeEventListener(Q.MOUSE_MOVE,this._mouseMoveCallback),g.removeEventListener(Q.MOUSE_DOWN,this._mouseDownCallback),g.removeEventListener(Q.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),g.removeEventListener(Q.TOUCH_TAP,this._mouseDownCallback)}),$(this,"_renderStats",(g,m,v,S)=>{var D;const O=g.data,N=this.getTargetId(m);if(!O.spline.instance.closed||!S.visibility)return;const R=this.configuration.getTextLines(O,N);if(!R||R.length===0)return;const L=O.handles.points.map(Y=>m.worldToCanvas(Y));if(!O.handles.textBox.hasMoved){const Y=Ha(L);O.handles.textBox.worldPosition=m.canvasToWorld(Y)}const P=m.worldToCanvas(O.handles.textBox.worldPosition),F=Ki(v,(D=g.annotationUID)!==null&&D!==void 0?D:"","textBox",R,P,L,{},S),{x:V,y:G,width:W,height:q}=F;O.handles.textBox.worldBoundingBox={topLeft:m.canvasToWorld([V,G]),topRight:m.canvasToWorld([V+W,G]),bottomLeft:m.canvasToWorld([V,G+q]),bottomRight:m.canvasToWorld([V+W,G+q])}}),$(this,"addControlPointCallback",(g,m)=>{const{data:v}=m,S=v.spline.type,D=this._getSplineConfig(S),O=D.controlPointAdditionDistance;if(D.controlPointAdditionEnabled===!1)return;const N=g.detail,{element:R}=N,L=(0,j.getEnabledElement)(R),{renderingEngine:P,viewport:F}=L,{canvasToWorld:V}=F,{instance:G}=v.spline,W=g.detail.currentPoints.canvas,q=G.getClosestPoint(W);if(q.distance>O)return;const{index:Y,point:Z}=G.addControlPointAtU(q.uValue);v.handles.points.splice(Y,0,V(Z)),m.invalidated=!0;const ne=Mt(R,this.getToolName());We(P,ne)}),$(this,"deleteControlPointCallback",(g,m)=>{const v=m.data.spline.type,S=this._getSplineConfig(v),D=S.controlPointDeletionDistance;if(S.controlPointDeletionEnabled===!1)return;const O=g.detail,{element:N,currentPoints:R}=O,{canvas:L}=R,{instance:P}=m.data.spline,F=P.getClosestControlPointWithinDistance(L,D);F&&this._deleteControlPointByIndex(N,m,F.index)}),$(this,"_calculateCachedStats",(g,m)=>{if(!this.configuration.calculateStats)return;const v=g.data;if(!v.contour.closed)return;const S=(0,j.getEnabledElement)(m),{viewport:D,renderingEngine:O}=S,{cachedStats:N}=v,{polyline:R}=v.contour,L=Object.keys(N);for(let P=0;P<L.length;P++){const F=L[P],V=this.getTargetIdImage(F,O);if(!V)continue;const{metadata:G}=V,W=R.map(Ie=>D.worldToCanvas(Ie)),q=W[0],Y=D.canvasToWorld(q),Z=D.canvasToWorld([q[0]+1,q[1]]),ne=D.canvasToWorld([q[0],q[1]+1]),oe=le.vec3.distance(Y,Z),ue=le.vec3.distance(Y,ne),{imageData:ge}=V,{scale:me,areaUnits:xe}=za(V,()=>{const{maxX:Ie,maxY:be,minX:Ne,minY:_e}=Dd(W),Me=D.canvasToWorld([Ne,_e]),Pe=j.utilities.transformWorldToIndex(ge,Me),Ze=D.canvasToWorld([Ie,be]);return[Pe,j.utilities.transformWorldToIndex(ge,Ze)]});let Ee=u1(W)/me/me;Ee*=oe*ue,N[F]={Modality:G.Modality,area:Ee,areaUnit:xe}}return this.triggerAnnotationModified(g,S,vr.StatsUpdated),N}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(u){const g=u.detail,{currentPoints:m,element:v}=g,{canvas:S}=m,D=T0(u.detail.event)===this.configuration.contourHoleAdditionModifierKey,O=(0,j.getEnabledElement)(v),{renderingEngine:N}=O,R=this.createAnnotation(u);this.isDrawing=!0,this.addAnnotation(R,v);const L=Mt(v,this.getToolName());return this.editData={annotation:R,viewportIdsToRender:L,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:S,contourHoleProcessingEnabled:D},this._activateDraw(v),u.preventDefault(),We(N,L),R}cancel(u){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData;v&&Ht(g.annotationUID),super.cancelAnnotation(g);const S=(0,j.getEnabledElement)(u),{renderingEngine:D}=S;return We(D,m),this.editData=null,g.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(u){var g,m,v;const{enabledElement:S,targetId:D,svgDrawingHelper:O,annotationStyle:N}=u,{viewport:R}=S,{worldToCanvas:L}=R,{element:P}=R,F=u.annotation,{annotationUID:V,data:G,highlighted:W}=F,{handles:q}=G,{points:Y,activeHandleIndex:Z}=q,ne=(g=this.editData)===null||g===void 0?void 0:g.newAnnotation,{lineWidth:oe,lineDash:ue,color:ge,locked:me}=N,xe=Y.map(Pe=>L(Pe)),{drawPreviewEnabled:Ee}=this.configuration.spline,Ie=F.data.spline.type,be=this._getSplineConfig(Ie),Ne=F.data.spline.instance,_e=Ga(F);if(_e.findIndex(Pe=>!Pe)!==-1)throw new Error("Can't find annotation for child ".concat(F.childAnnotationUIDs.join()));let Me;if([F,..._e].filter(Pe=>this._isSplineROIAnnotation(Pe)).forEach(Pe=>{const Ze=this._updateSplineInstance(P,Pe).getPolylinePoints();this.updateContourPolyline(Pe,{points:Ze,closed:G.contour.closed,targetWindingDirection:p0.Clockwise},R)}),super.renderAnnotationInstance(u),G.cachedStats[D]&&G.cachedStats[D].areaUnit!=null?F.invalidated&&this._throttledCalculateCachedStats(F,P):(G.cachedStats[D]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(F,P)),me||this.editData||Z===null||(Me=[xe[Z]]),(Me||ne||W)&&Qn(O,V,"0",xe,{color:ge,lineWidth:Math.max(1,oe),handleRadius:"3"}),Ee&&Ne.numControlPoints>1&&(m=this.editData)!==null&&m!==void 0&&m.lastCanvasPoint&&!Ne.closed){const{lastCanvasPoint:Pe}=this.editData;Xo(O,V,"previewSplineChange",Ne.getPreviewPolylinePoints(Pe,10),{color:"#9EA0CA",lineDash:ue,lineWidth:1})}if(be.showControlPointsConnectors){const Pe=[...xe];Ne.closed&&Pe.push(xe[0]),Xo(O,V,"controlPointsConnectors",Pe,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(F,R,O,N.textbox),((v=this.fireChangeOnUpdate)===null||v===void 0?void 0:v.annotationUID)===V&&(this.triggerChangeEvent(F,S,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),F.invalidated=!1,!0}createInterpolatedSplineControl(u){var g;if((g=u.data.handles.points)!==null&&g!==void 0&&g.length)return;const{polyline:m}=u.data.contour;if(!m||!m.length)return;u.data.handles.points=[];const{points:v}=u.data.handles,S=Math.max(10,Math.floor(m.length/20));for(let D=0;D<m.length-S;D+=S)v.push(m[D]);v.push(m[m.length-1])}createAnnotation(u){var g;const m=super.createAnnotation(u),{world:v}=u.detail.currentPoints,{type:S}=this.configuration.spline,D=this._getSplineConfig(S),O=new D.Class,N=()=>({type:D.type,instance:O,resolution:D.resolution});let R;return(g=this.configuration.interpolation)!==null&&g!==void 0&&g.enabled&&(R=L=>{var P;(P=L.data).spline||(P.spline=N()),this.createInterpolatedSplineControl(L)}),j.utilities.deepMerge(m,{data:{handles:{points:[[...v]]},spline:N(),cachedStats:{}},onInterpolationComplete:R})}_deleteControlPointByIndex(u,g,m){const v=(0,j.getEnabledElement)(u),{points:S}=g.data.handles;S.length===3?Ht(g.annotationUID):S.splice(m,1);const{renderingEngine:D}=v,O=Mt(u,this.getToolName());g.invalidated=!0,We(D,O)}_isSplineROIAnnotation(u){var g;return!((g=u.data)===null||g===void 0||!g.spline)}_getSplineConfig(u){const{configuration:g}=this,m=g.spline.configuration;return Object.assign({type:u},mq,m[u])}_updateSplineInstance(u,g){const m=(0,j.getEnabledElement)(u),{viewport:v}=m,{worldToCanvas:S}=v,{data:D}=g,{type:O,instance:N}=g.data.spline,R=this._getSplineConfig(O),L=D.handles.points.map(S),P=R.resolution!==void 0?parseInt(R.resolution):void 0,F=R.scale!==void 0?parseFloat(R.scale):void 0;return N.setControlPoints(L),N.closed=!!D.contour.closed,N.fixedResolution||P===void 0||N.resolution===P||(N.resolution=P,g.invalidated=!0),N instanceof O1&&!N.fixedScale&&F!==void 0&&N.scale!==F&&(N.scale=F,g.invalidated=!0),N}}function vq(E,u){const g=E.cachedStats[u],{area:m,isEmptyArea:v,areaUnit:S}=g,D=[];if(m){const O=v?"Area: Oblique not supported":"Area: ".concat(cn(m)," ").concat(S);D.push(O)}return D}$(th,"toolName",void 0),$(th,"SplineTypes",Hc),$(th,"Actions",M1),th.toolName="SplineROI";const JD=th;class hw extends JD{constructor(u){super(j.utilities.deepMerge({configuration:{calculateStats:!1}},u))}isContourSegmentationTool(){return!0}}$(hw,"toolName",void 0),hw.toolName="SplineContourSegmentationTool";const yq=hw;class wq{constructor(u){let{numBits:g,getPriority:m,areEqual:v}=u;$(this,"_bucketCount",void 0),$(this,"_mask",void 0),$(this,"_size",void 0),$(this,"_currentBucketIndex",void 0),$(this,"_getPriority",void 0),$(this,"_areEqual",void 0),$(this,"_buckets",void 0),this._bucketCount=1<<g,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=m!==void 0?m:S=>S,this._areEqual=typeof v=="function"?v:(S,D)=>S===D}push(u){const g=this._getBucketIndex(u),m={value:u,next:this._buckets[g]};this._buckets[g]=m,this._size++}pop(){if(this._size===0)throw new Error("Cannot pop because the queue is empty.");for(;this._buckets[this._currentBucketIndex]===null;)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const u=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=u.next,this._size--,u.value}remove(u){if(!u)return!1;const g=this._getBucketIndex(u),m=this._buckets[g];let v,S=m;for(;S!==null&&!this._areEqual(u,S.value);)v=S,S=S.next;return S!==null&&(S===m?this._buckets[g]=S.next:v.next=S.next,this._size--,!0)}isEmpty(){return this._size===0}_getBucketIndex(u){return this._getPriority(u)&this._mask}_buildArray(u){const g=new Array(u);return g.fill(null),g}}j.utilities;const gw=4294967295,Cq=2/(3*Math.PI);class N1{constructor(u,g,m){$(this,"searchGranularityBits",void 0),$(this,"searchGranularity",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"grayscalePixelData",void 0),$(this,"laplace",void 0),$(this,"gradMagnitude",void 0),$(this,"gradXNew",void 0),$(this,"gradYNew",void 0),$(this,"startPoint",void 0),$(this,"visited",void 0),$(this,"parents",void 0),$(this,"costs",void 0),$(this,"priorityQueueNew",void 0),$(this,"_getPointIndex",(S,D)=>{const{width:O}=this;return S*O+D}),$(this,"_getPointCoordinate",S=>[S%this.width,Math.floor(S/this.width)]),$(this,"_getPointCost",S=>Math.round(this.searchGranularity*this.costs[S]));const v=u.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=g,this.height=m,this.grayscalePixelData=u,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(v),this.parents=new Uint32Array(v),this.costs=new Float32Array(v)}startSearch(u){const g=this._getPointIndex(u[1],u[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(gw),this.costs.fill(1/0),this.priorityQueueNew=new wq({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=u,this.costs[g]=0,this.priorityQueueNew.push(g)}findMinNearby(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;const[m,v]=u,{costs:S}=this,D=[Math.max(0,m-g),Math.min(m+g+1,this.width)],O=[Math.max(0,v-g),Math.min(v+g+1,this.height)];let N=.8*S[this._getPointIndex(v,m)],R=u;for(let L=D[0];L<D[1];L++)for(let P=O[0];P<O[1];P++){const F=1-(Math.abs(L-u[0])+Math.abs(P-u[1]))/g/2,V=.8*S[this._getPointIndex(P,L)]+.2*F;V<N&&(R=[L,P],N=V)}return R}findPathToPoint(u){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:g,_getPointIndex:m,_getPointCoordinate:v}=this,S=m(g[1],g[0]),D=m(u[1],u[0]),{visited:O,parents:N,costs:R,priorityQueueNew:L}=this;if(D===S)return[];for(;!L.isEmpty()&&N[D]===gw;){const V=L.pop();if(O[V])continue;const G=v(V),W=this._getNeighborPoints(G);O[V]=!0;for(let q=0,Y=W.length;q<Y;q++){const Z=W[q],ne=m(Z[1],Z[0]),oe=this._getWeightedDistance(G,Z),ue=R[V]+oe;ue<R[ne]&&(R[ne]!==1/0&&L.remove(ne),R[ne]=ue,N[ne]=V,L.push(ne))}}const P=[];let F=D;for(;F!==gw;)P.push(v(F)),F=N[F];return P.reverse()}_getDeltaX(u,g){const{grayscalePixelData:m,width:v}=this;let S=this._getPointIndex(g,u);return u+1===v&&S--,m[S+1]-m[S]}_getDeltaY(u,g){const{grayscalePixelData:m,width:v,height:S}=this;let D=this._getPointIndex(g,u);return g+1===S&&(D-=v),m[D]-m[D+v]}_getGradientMagnitude(u,g){const m=this._getDeltaX(u,g),v=this._getDeltaY(u,g);return Math.sqrt(m*m+v*v)}_getLaplace(u,g){const{grayscalePixelData:m,_getPointIndex:v}=this;let S=m[v(g-2,u)];return S+=m[v(g-1,u-1)]+2*m[v(g-1,u)]+m[v(g-1,u+1)],S+=m[v(g,u-2)]+2*m[v(g,u-1)]-16*m[v(g,u)]+2*m[v(g,u+1)]+m[v(g,u+2)],S+=m[v(g+1,u-1)]+2*m[v(g+1,u)]+m[v(g+1,u+1)],S+=m[v(g+2,u)],S}_computeGradient(){const{width:u,height:g}=this,m=new Float32Array(u*g);let v=0,S=0,D=0,O=0;for(O=0;O<g-1;O++){for(D=0;D<u-1;D++)m[v]=this._getGradientMagnitude(D,O),S=Math.max(m[v],S),v++;m[v]=m[v-1],v++}for(let N=m.length;v<N;v++)m[v]=m[v-u];for(let N=0,R=m.length;N<R;N++)m[N]=1-m[N]/S;return m}_computeLaplace(){const{width:u,height:g,_getPointIndex:m}=this,v=new Float32Array(u*g);v.fill(1,0,m(2,0));for(let S=2;S<g-2;S++){v[m(S,0)]=1,v[m(S,1)]=1;for(let D=2;D<u-2;D++)v[m(S,D)]=this._getLaplace(D,S)>.33?0:1;v[m(S,u-2)]=1,v[m(S,u-1)]=1}return v.fill(1,m(g-2,0)),v}_computeGradientX(){const{width:u,height:g}=this,m=new Float32Array(u*g);let v=0;for(let S=0;S<g;S++)for(let D=0;D<u;D++)m[v++]=this._getDeltaX(D,S);return m}_computeGradientY(){const{width:u,height:g}=this,m=new Float32Array(u*g);let v=0;for(let S=0;S<g;S++)for(let D=0;D<u;D++)m[v++]=this._getDeltaY(D,S);return m}_getGradientUnitVector(u,g){const{gradXNew:m,gradYNew:v,_getPointIndex:S}=this,D=m[S(g,u)],O=v[S(g,u)];let N=Math.sqrt(D*D+O*O);return N=Math.max(N,1e-100),[D/N,O/N]}_getGradientDirection(u,g,m,v){const S=this._getGradientUnitVector(u,g),D=this._getGradientUnitVector(m,v);let O=S[1]*(m-u)-S[0]*(v-g),N=D[1]*(m-u)-D[0]*(v-g);O<0&&(O=-O,N=-N),u!==m&&g!==v&&(O*=Math.SQRT1_2,N*=Math.SQRT1_2),N=Math.min(Math.max(N,-1),1);const R=Cq*(Math.acos(Math.min(O,1))+Math.acos(N));return isNaN(R)||!isFinite(R)?(console.warn("Found non-direction:",u,g,m,v,O,N,R),1):R}getCost(u,g){return this._getWeightedDistance(u,g)}_getWeightedDistance(u,g){const{_getPointIndex:m,width:v,height:S}=this,[D,O]=u,[N,R]=g;if(N<0||N>=v||R<0||R>=S)return 1;if(D<0||O<0||D>=v||O>=S)return 0;const L=m(R,N);let P=this.gradMagnitude[L];return D!==N&&O!==R||(P*=Math.SQRT1_2),.43*P+.43*this.laplace[L]+.11*this._getGradientDirection(D,O,N,R)}_getNeighborPoints(u){const{width:g,height:m}=this,v=[],S=Math.max(u[0]-1,0),D=Math.max(u[1]-1,0),O=Math.min(u[0]+1,g-1),N=Math.min(u[1]+1,m-1);for(let R=D;R<=N;R++)for(let L=S;L<=O;L++)L===u[0]&&R===u[1]||v.push([L,R]);return v}static createInstanceFromRawPixelData(u,g,m,v){const S=u.length,D=new Float32Array(S),{lower:O,upper:N}=v,R=N-O;for(let L=0,P=u.length;L<P;L++)D[L]=Math.max(0,Math.min(1,(u[L]-O)/R));return new N1(D,g,m)}}class Ms{constructor(u,g){$(this,"pointArray",void 0),$(this,"_controlPointIndexes",void 0),this.pointArray=u?u.slice():[],this._controlPointIndexes=g?g.slice():[]}getPoint(u){return this.pointArray[u]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(u){const g=this.pointArray.indexOf(u);if(g!==-1)return this._controlPointIndexes.indexOf(g)!==-1;throw new Error("Error: isControlPoint called with not in list point.")}addPoint(u){this.pointArray.push(u)}addControlPoint(u){const g=this.pointArray.indexOf(u);if(g===-1)throw new Error("Cannot mark a non registered point as control point.");this._controlPointIndexes.push(g)}getControlPoints(){return this._controlPointIndexes.map(u=>this.pointArray[u])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(u){this.pointArray.splice(this.pointArray.length-u,u)}addPoints(u){this.pointArray=this.pointArray.concat(u)}prependPath(u){const g=u.pointArray.length,m=[];this.pointArray=u.pointArray.concat(this.pointArray);for(let v=0;v<this._controlPointIndexes.length;++v)m[v]=this._controlPointIndexes[v]+g;this._controlPointIndexes=u._controlPointIndexes.concat(m)}appendPath(u){this.addPoints(u.pointArray),u._controlPointIndexes.forEach(g=>this._controlPointIndexes.push(g))}}class pw extends M3{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:li.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{undo:{method:"undo",bindings:[{key:"Escape"}]}}}}),u=this,$(this,"scissors",void 0),$(this,"scissorsNext",void 0),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",!1),$(this,"isPointNearTool",(g,m,v,S)=>{const D=(0,j.getEnabledElement)(g),{viewport:O}=D,N=S*S,R=m.data.contour.polyline.map(P=>O.worldToCanvas(P));let L=R[R.length-1];for(let P=0;P<R.length;P++){const F=R[P];if(Id(L,F,v)<=N)return!0;L=F}return!1}),$(this,"toolSelectedCallback",(g,m)=>{const v=g.detail,{element:S}=v;m.highlighted=!0;const D=Mt(S,this.getToolName());this.editData={annotation:m,viewportIdsToRender:D};const O=(0,j.getEnabledElement)(S),{renderingEngine:N}=O;this._activateModify(S),We(N,D),g.preventDefault()}),$(this,"handleSelectedCallback",(g,m,v)=>{const S=g.detail,{element:D}=S,{data:O}=m;m.highlighted=!0;const{points:N}=O.handles,R=N.findIndex(V=>V===v),L=Mt(D,this.getToolName());this.editData={annotation:m,viewportIdsToRender:L,handleIndex:R},this._activateModify(D);const P=(0,j.getEnabledElement)(D),{renderingEngine:F}=P;We(F,L),g.preventDefault()}),$(this,"_endCallback",function(g){let m=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const v=g.detail,{element:S}=v,{annotation:D,viewportIdsToRender:O,newAnnotation:N,contourHoleProcessingEnabled:R}=u.editData,{data:L}=D;L.handles.activeHandleIndex=null,u._deactivateModify(S),u._deactivateDraw(S),rn(S);const P=(0,j.getEnabledElement)(S),{renderingEngine:F}=P;if(u.isHandleOutsideImage&&u.configuration.preventHandleOutsideImage||m)return Ht(D.annotationUID),u.clearEditData(),void We(F,O);We(F,O);const V=N?vr.Completed:vr.HandlesUpdated;u.triggerChangeEvent(D,P,V,R),u.clearEditData()}),$(this,"triggerChangeEvent",function(g,m){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vr.StatsUpdated,S=arguments.length>3&&arguments[3]!==void 0&&arguments[3];v===vr.Completed?ur(g,S):Yt(g,m.viewport.element,v)}),$(this,"_mouseDownCallback",g=>{const m=g.type===Q.MOUSE_DOUBLE_CLICK,{annotation:v,viewportIdsToRender:S,worldToSlice:D,sliceToWorld:O}=this.editData;if(this.editData.closed)return;const N=g.detail,{element:R}=N,{currentPoints:L}=N,{canvas:P,world:F}=L;let V=F;const G=(0,j.getEnabledElement)(R),{viewport:W,renderingEngine:q}=G,Y=this.editData.currentPath.getControlPoints();let Z=Y.length>=2&&m;if(Y.length>=2){const ue={index:-1,distSquared:1/0};for(let ge=0,me=Y.length;ge<me;ge++){const xe=O(Y[ge]),Ee=Ts(P,W.worldToCanvas(xe));Ee<=100&&Ee<ue.distSquared&&(ue.distSquared=Ee,ue.index=ge)}ue.index===0&&(Z=!0)}const{snapHandleNearby:ne}=this.configuration;if(ne&&!this.editData.closed){const ue=new Ms,ge=this.scissors.findMinNearby(D(F),1),me=this.scissors.findPathToPoint(ge);ue.addPoints(me),ue.prependPath(this.editData.confirmedPath),V=O(ge),this.editData.currentPath=ue}this.editData.closed=this.editData.closed||Z,this.editData.confirmedPath=this.editData.currentPath;const oe=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(oe),v.data.handles.points.push(O(oe)),this.scissors.startSearch(D(V)),v.invalidated=!0,We(q,S),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(g)),g.preventDefault()}),$(this,"_mouseMoveCallback",g=>{const{element:m,currentPoints:v}=g.detail,{world:S,canvas:D}=v,{renderingEngine:O}=(0,j.getEnabledElement)(m),N=Mt(m,this.getToolName());this.editData.lastCanvasPoint=D;const{width:R,height:L}=this.scissors,{worldToSlice:P}=this.editData,F=P(S);if(F[0]<0||F[1]<0||F[0]>=R||F[1]>=L)return;const V=this.scissors.findPathToPoint(F),G=new Ms;G.addPoints(V),G.prependPath(this.editData.confirmedPath),this.editData.currentPath=G,We(O,N),g.preventDefault()}),$(this,"_dragCallback",g=>{this.isDrawing=!0;const m=g.detail,{element:v}=m,{annotation:S,viewportIdsToRender:D,handleIndex:O}=this.editData;if(O===void 0)console.warn("No drag implemented for livewire");else{const{currentPoints:L}=m,P=L.world;this.editHandle(P,v,S,O)}const N=(0,j.getEnabledElement)(v),{renderingEngine:R}=N;We(R,D)}),$(this,"cancel",g=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(g),this._deactivateModify(g),rn(g);const{annotation:m,viewportIdsToRender:v,newAnnotation:S}=this.editData;S&&Ht(m.annotationUID);const D=(0,j.getEnabledElement)(g),{renderingEngine:O}=D;return We(O,v),this.editData=null,this.scissors=null,m.annotationUID}),$(this,"_activateModify",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._endCallback),g.addEventListener(Q.MOUSE_DRAG,this._dragCallback),g.addEventListener(Q.MOUSE_CLICK,this._endCallback),g.addEventListener(Q.TOUCH_END,this._endCallback),g.addEventListener(Q.TOUCH_DRAG,this._dragCallback),g.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._endCallback),g.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._endCallback),g.removeEventListener(Q.TOUCH_END,this._endCallback),g.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),g.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_activateDraw",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_MOVE,this._mouseMoveCallback),g.addEventListener(Q.MOUSE_DOWN,this._mouseDownCallback),g.addEventListener(Q.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),g.addEventListener(Q.TOUCH_TAP,this._mouseDownCallback)}),$(this,"_deactivateDraw",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_MOVE,this._mouseMoveCallback),g.removeEventListener(Q.MOUSE_DOWN,this._mouseDownCallback),g.removeEventListener(Q.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),g.removeEventListener(Q.TOUCH_TAP,this._mouseDownCallback)})}setupBaseEditData(u,g,m,v,S){var D,O,N;const R=(0,j.getEnabledElement)(g),{viewport:L}=R;this.isDrawing=!0;const P=L.getImageData(),{imageData:F}=P;let V,G,W,q,{scalarData:Y}=P;if(L instanceof j.VolumeViewport||!Y){if(!(L instanceof j.VolumeViewport))throw new Error("Viewport not supported");{const Ie=j.utilities.getCurrentVolumeViewportSlice(L),{sliceToIndexMatrix:be,indexToSliceMatrix:Ne}=Ie;V=_e=>{const Me=j.utilities.transformWorldToIndex(F,_e),Pe=le.vec3.transformMat4([0,0,0],Me,Ne);return[Pe[0],Pe[1]]},G=_e=>{const Me=le.vec3.transformMat4([0,0,0],[_e[0],_e[1],0],be);return j.utilities.transformIndexToWorld(F,Me)},Y=Ie.scalarData,W=Ie.width,q=Ie.height}}else W=P.dimensions[0],q=P.dimensions[1],V=Ie=>{const be=j.utilities.transformWorldToIndex(F,Ie);return[be[0],be[1]]},G=Ie=>j.utilities.transformIndexToWorld(F,[Ie[0],Ie[1],0]);Y=j.utilities.convertToGrayscale(Y,W,q);const{voiRange:Z}=L.getProperties(),ne=V(u);this.scissors=N1.createInstanceFromRawPixelData(Y,W,q,Z),v&&(this.scissorsNext=N1.createInstanceFromRawPixelData(Y,W,q,Z),this.scissorsNext.startSearch(V(v))),this.scissors.startSearch(ne);const oe=!v,ue=new Ms,ge=new Ms,me=oe?void 0:new Ms;ue.addPoint(ne),ue.addControlPoint(ne);const xe=Mt(g,this.getToolName()),Ee=L.worldToCanvas(u);this.editData={annotation:m,viewportIdsToRender:xe,newAnnotation:oe,hasMoved:!1,lastCanvasPoint:Ee,confirmedPath:ue,currentPath:ge,confirmedPathNext:me,closed:!1,handleIndex:(D=(O=this.editData)===null||O===void 0?void 0:O.handleIndex)!==null&&D!==void 0?D:(N=m.handles)===null||N===void 0?void 0:N.activeHandleIndex,worldToSlice:V,sliceToWorld:G,contourHoleProcessingEnabled:S}}addNewAnnotation(u){const g=u.detail,{currentPoints:m,element:v}=g,{world:S}=m,{renderingEngine:D}=(0,j.getEnabledElement)(v),O=this.createAnnotation(u),N=T0(u.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(S,v,O,void 0,N),this.addAnnotation(O,v),this._activateDraw(v),u.preventDefault(),We(D,this.editData.viewportIdsToRender),O}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(u,g,m,v){var S;const{data:D}=m,{points:O}=D.handles,{length:N}=O,R=O[(v-1+N)%N],L=O[(v+1)%N];if((S=this.editData)===null||S===void 0||!S.confirmedPathNext){this.setupBaseEditData(R,g,m,L);const{polyline:oe}=D.contour,ue=new Ms,ge=new Ms,{worldToSlice:me}=this.editData,xe=G5(m,v-1),Ee=G5(m,v+1);if(Ee===-1||xe===-1)throw new Error("Can't find handle index ".concat(Ee===-1&&L," ").concat(xe===-1&&R));v===0?ge.addPoints(oe.slice(Ee+1,xe).map(me)):(ue.addPoints(oe.slice(0,xe+1).map(me)),ge.addPoints(oe.slice(Ee,oe.length).map(me))),this.editData.confirmedPath=ue,this.editData.confirmedPathNext=ge}const{editData:P,scissors:F}=this,{worldToSlice:V,sliceToWorld:G}=P,{activeHandleIndex:W}=D.handles;if(W==null)D.handles.activeHandleIndex=v;else if(W!==v)throw new Error("Trying to edit a different handle than the one currently being edited ".concat(v,"!==").concat(D.handles.activeHandleIndex));const q=V(u);if(q[0]<0||q[0]>=F.width||q[1]<0||q[1]>=F.height)return;O[v]=G(q);const Y=F.findPathToPoint(q),Z=this.scissorsNext.findPathToPoint(q),ne=new Ms;ne.prependPath(P.confirmedPath),v!==0&&ne.addPoints(Y),ne.addPoints(Z.reverse()),ne.appendPath(P.confirmedPathNext),v===0&&ne.addPoints(Y),P.currentPath=ne,m.invalidated=!0,P.hasMoved=!0}renderAnnotation(u,g){var m;return this.updateAnnotation((m=this.editData)===null||m===void 0?void 0:m.currentPath),super.renderAnnotation(u,g)}isContourSegmentationTool(){return!1}createAnnotation(u){const g=super.createAnnotation(u),{world:m}=u.detail.currentPoints;return j.utilities.deepMerge(g,{data:{handles:{points:[[...m]]}}})}undo(u,g,m){this.editData&&this._endCallback(m,!0)}renderAnnotationInstance(u){var g,m;const{annotation:v,enabledElement:S,svgDrawingHelper:D,annotationStyle:O}=u,{viewport:N}=S,{worldToCanvas:R}=N,{annotationUID:L,data:P,highlighted:F}=v,{handles:V}=P,G=(g=this.editData)===null||g===void 0?void 0:g.newAnnotation,{lineWidth:W,lineDash:q,color:Y}=O;if(F||G&&v.annotationUID===((m=this.editData)===null||m===void 0||(m=m.annotation)===null||m===void 0?void 0:m.annotationUID)){const Z="0",ne=V.points.map(R);Qn(D,L,Z,ne,{color:Y,lineDash:q,lineWidth:W})}return super.renderAnnotationInstance(u),!0}updateAnnotation(u){if(!this.editData||!u)return;const{annotation:g,sliceToWorld:m,worldToSlice:v,closed:S,newAnnotation:D}=this.editData;let{pointArray:O}=u;O.length>1&&(O=[...O,O[0]]);const N=D&&S?p0.Clockwise:void 0;this.updateContourPolyline(g,{points:O,closed:S,targetWindingDirection:N},{canvasToWorld:m,worldToCanvas:v})}}$(pw,"toolName",void 0),pw.toolName="LivewireContour";const ZD=pw;class mw extends ZD{updateInterpolatedAnnotation(u,g){!this.editData&&u.invalidated&&u.data.handles.interpolationSources&&(u.data.contour.originalPolyline=u.data.contour.polyline,queueMicrotask(()=>{if(!u.data.handles.interpolationSources)return;const{points:m}=u.data.handles,{element:v}=g.viewport;this.setupBaseEditData(m[0],v,u);const{length:S}=m,{scissors:D}=this,{nearestEdge:O,repeatInterpolation:N}=this.configuration.interpolation;u.data.handles.originalPoints=m;const{worldToSlice:R,sliceToWorld:L}=this.editData,P=[];if(O){let V=R(m[m.length-1]);m.forEach((G,W)=>{const q=R(G);V=q,P.push(q),D.startSearch(V),D.findPathToPoint(q),D.findPathToPoint(R(m[(W+3)%m.length]));const Y=D.findMinNearby(q,O);j.utilities.isEqual(q,Y)||(P[W]=Y,V=Y,m[W]=L(Y))})}const F=new Ms;for(let V=0;V<S;V++){D.startSearch(R(m[V]));const G=D.findPathToPoint(R(m[(V+1)%S]));F.addPoints(G)}this.updateAnnotation(F),this.scissors=null,this.scissorsNext=null,this.editData=null,u.data.handles.interpolationSources=null,N&&Yt(u,g.viewport.element,vr.InterpolationUpdated)}))}renderAnnotationInstance(u){var g;const{enabledElement:m,svgDrawingHelper:v}=u,S=u.annotation,{annotationUID:D}=S,{viewport:O}=m,{worldToCanvas:N}=O,{showInterpolationPolyline:R}=this.configuration.interpolation||{};(g=this.updateInterpolatedAnnotation)===null||g===void 0||g.call(this,S,m);const{originalPolyline:L}=S.data.contour,P=super.renderAnnotationInstance(u);if(R&&L&&S.autoGenerated){const F=L.map(N);F.push(F[0]),Xo(v,D,"interpolationContour-0",F,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return P}isContourSegmentationTool(){return!0}}$(mw,"toolName",void 0),mw.toolName="LivewireContourSegmentationTool";const xq=mw;class vw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:Sq,changeTextCallback:Eq,preventHandleOutsideImage:!1,arrowFirst:!0}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;Wt(v),this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),{arrowFirst:V}=this.configuration,G=O.getFrameOfReferenceUID(),W={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:G,referencedImageId:F,...O.getViewReference({points:[S]})},data:{text:"",handles:{points:[[...S],[...S]],activeHandleIndex:null,arrowFirst:V,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};fn(W,v);const q=Mt(v,this.getToolName());return this.editData={annotation:W,viewportIdsToRender:q,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),u.preventDefault(),We(N,q),W}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,[N,R]=O.handles.points,L=D.worldToCanvas(N),P=D.worldToCanvas(R),F={start:{x:L[0],y:L[1]},end:{x:P[0],y:P[1]}};return mi([F.start.x,F.start.y],[F.end.x,F.end.y],[m[0],m[1]])<=v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const{renderingEngine:R}=(0,j.getEnabledElement)(m);this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),D?this.configuration.getTextCallback(L=>{if(!L)return Ht(v.annotationUID),We(R,S),this.editData=null,void(this.isDrawing=!1);v.data.text=L,sn(v),We(R,S)}):Yt(v,m),this.editData=null,this.isDrawing=!1}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=P.world;N.handles.points[D]=[...F],v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"touchTapCallback",u=>{u.detail.taps==2&&this.doubleClickCallback(u)}),$(this,"doubleClickCallback",u=>{var g;const m=u.detail,{element:v}=m;let S=an(this.getToolName(),v);if(S=this.filterInteractableAnnotationsForElement(v,S),(g=S)===null||g===void 0||!g.length)return;const D=S.find(N=>this.isPointNearTool(v,N,m.currentPoints.canvas,6));if(!D)return;const O=D;this.configuration.changeTextCallback(D,u.detail,this._doneChangingTextCallback.bind(this,v,O)),this.editData=null,this.isDrawing=!1,u.stopImmediatePropagation(),u.preventDefault()}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const{renderingEngine:D}=(0,j.getEnabledElement)(u);return We(D,m),v&&sn(g),this.editData=null,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let L=0;L<N.length;L++){const P=N[L],{annotationUID:F,data:V}=P,{handles:G,text:W}=V,{points:q,activeHandleIndex:Y}=G;R.annotationUID=F;const{color:Z,lineWidth:ne,lineDash:oe}=this.getAnnotationStyle({annotation:P,styleSpecifier:R}),ue=q.map(Pe=>D.worldToCanvas(Pe));let ge;cr(P)||this.editData||Y===null||(ge=[ue[Y]]),ge&&Qn(g,F,"0",ue,{color:Z,lineWidth:ne});const me="1";if(this.configuration.arrowFirst?b1(g,F,me,ue[1],ue[0],{color:Z,width:ne,lineDash:oe}):b1(g,F,me,ue[0],ue[1],{color:Z,width:ne,lineDash:oe}),S=!0,!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;if(!W)continue;const xe=this.getLinkedTextBoxStyle(R,P);if(!xe.visibility){V.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!V.handles.textBox.hasMoved){const Pe=ue[1];V.handles.textBox.worldPosition=D.canvasToWorld(Pe)}const Ee=D.worldToCanvas(V.handles.textBox.worldPosition),Ie=Ki(g,F,"1",[W],Ee,ue,{},xe),{x:be,y:Ne,width:_e,height:Me}=Ie;V.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([be,Ne]),topRight:D.canvasToWorld([be+_e,Ne]),bottomLeft:D.canvasToWorld([be,Ne+Me]),bottomRight:D.canvasToWorld([be+_e,Ne+Me])}}return S})}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}_doneChangingTextCallback(u,g,m){g.data.text=m;const v=(0,j.getEnabledElement)(u),{renderingEngine:S}=v,D=Mt(u,this.getToolName());We(S,D),Yt(g,u)}_isInsideVolume(u,g,m){return j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)}}function Sq(E){return E(prompt("Enter your annotation:"))}function Eq(E,u,g){return g(prompt("Enter your annotation:"))}$(vw,"toolName",void 0),vw.toolName="ArrowAnnotate";const Tq=vw;class yw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:_q}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"angleStartedNotYetCompleted",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;Wt(v),this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F,...O.getViewReference({points:[S]})},data:{handles:{points:[[...S],[...S]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),u.preventDefault(),We(N,W),G}),$(this,"isPointNearTool",(u,g,m,v)=>{const S=(0,j.getEnabledElement)(u),{viewport:D}=S,{data:O}=g,[N,R,L]=O.handles.points,P=D.worldToCanvas(N),F=D.worldToCanvas(R),V={start:{x:P[0],y:P[1]},end:{x:F[0],y:F[1]}};if(mi([V.start.x,V.start.y],[V.end.x,V.end.y],[m[0],m[1]])<=v)return!0;if(!L)return!1;const G=D.worldToCanvas(L),W={start:{x:F[0],y:F[1]},end:{x:G[0],y:G[1]}};return mi([W.start.x,W.start.y],[W.end.x,W.end.y],[m[0],m[1]])<=v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S,movingTextBox:!1},this._activateModify(v),Wt(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;if(this.angleStartedNotYetCompleted&&N.handles.points.length===2)return void(this.editData.handleIndex=2);this.angleStartedNotYetCompleted=!1,N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(L,S),D&&sn(v),this.editData=null,this.isDrawing=!1}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=P.world;N.handles.points[D]=[...F],v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const D=(0,j.getEnabledElement)(u),{renderingEngine:O}=D;return We(O,m),v&&sn(g),this.editData=null,this.angleStartedNotYetCompleted=!1,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let V=0;V<N.length;V++){var F;const G=N[V],{annotationUID:W,data:q}=G,{points:Y,activeHandleIndex:Z}=q.handles;P.annotationUID=W;const{color:ne,lineWidth:oe,lineDash:ue}=this.getAnnotationStyle({annotation:G,styleSpecifier:P}),ge=Y.map(Ye=>D.worldToCanvas(Ye));let me;if(q.cachedStats[R]&&q.cachedStats[R].angle!=null?G.invalidated&&this._throttledCalculateCachedStats(G,L,u):(q.cachedStats[R]={angle:null},this._calculateCachedStats(G,L,u)),cr(G)||this.editData||Z===null||(me=[ge[Z]]),!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;me&&Qn(g,W,"0",ge,{color:ne,lineDash:ue,lineWidth:oe});let xe="1";if(Mn(g,W,xe,ge[0],ge[1],{color:ne,width:oe,lineDash:ue}),S=!0,ge.length!==3)return S;if(xe="2",Mn(g,W,xe,ge[1],ge[2],{color:ne,width:oe,lineDash:ue}),(F=q.cachedStats[R])===null||F===void 0||!F.angle)continue;const Ee=this.getLinkedTextBoxStyle(P,G);if(!Ee.visibility){q.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const Ie=this.configuration.getTextLines(q,R);if(!q.handles.textBox.hasMoved){const Ye=ge[1];q.handles.textBox.worldPosition=D.canvasToWorld(Ye)}const be=D.worldToCanvas(q.handles.textBox.worldPosition),Ne=Ki(g,W,"1",Ie,be,ge,{},Ee),{x:_e,y:Me,width:Pe,height:Ze}=Ne;q.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([_e,Me]),topRight:D.canvasToWorld([_e+Pe,Me]),bottomLeft:D.canvasToWorld([_e,Me+Ze]),bottomRight:D.canvasToWorld([_e+Pe,Me+Ze])}}return S}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}_calculateCachedStats(u,g,m){const v=u.data,{element:S}=m.viewport;if(v.handles.points.length!==3)return;const D=v.handles.points[0],O=v.handles.points[1],N=v.handles.points[2],{cachedStats:R}=v,L=Object.keys(R);for(let P=0;P<L.length;P++){const F=L[P],V=Qd([D,O],[O,N]),{dimensions:G,imageData:W}=this.getTargetIdImage(F,g);this.isHandleOutsideImage=[D,O,N].map(q=>j.utilities.transformWorldToIndex(W,q)).some(q=>!j.utilities.indexWithinDimensions(q,G)),R[F]={angle:isNaN(V)?"Incomplete Angle":V}}return u.invalidated=!1,Yt(u,S),R}}function _q(E,u){const g=E.cachedStats[u],{angle:m}=g;if(m!==void 0)return isNaN(m)?["".concat(m)]:["".concat(cn(m)," ").concat("")]}$(yw,"toolName",void 0),yw.toolName="Angle";const Dq=yw,Ns=function(){for(var E=arguments.length,u=new Array(E),g=0;g<E;g++)u[g]=arguments[g];const m=u[0].length===2?[0,0]:[0,0,0],v=u.length;for(const S of u)m[0]+=S[0]/v,m[1]+=S[1]/v,m.length===3&&(m[2]+=S[2]/v);return m};class ww extends ei{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:bq,showArcLines:!1}}),u=this,$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"angleStartedNotYetCompleted",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",g=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const m=g.detail,{currentPoints:v,element:S}=m,D=v.world,O=(0,j.getEnabledElement)(S),{viewport:N,renderingEngine:R}=O;Wt(S),this.isDrawing=!0;const L=N.getCamera(),{viewPlaneNormal:P,viewUp:F}=L,V=this.getReferencedImageId(N,D,P,F),G=N.getFrameOfReferenceUID(),W={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...P],viewUp:[...F],FrameOfReferenceUID:G,referencedImageId:V,...N.getViewReference({points:[D]})},data:{handles:{points:[[...D],[...D]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};fn(W,S);const q=Mt(S,this.getToolName());return this.editData={annotation:W,viewportIdsToRender:q,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(S),g.preventDefault(),We(R,q),W}),$(this,"isPointNearTool",(g,m,v,S)=>{const D=(0,j.getEnabledElement)(g),{viewport:O}=D,{data:N}=m,{distanceToPoint:R,distanceToPoint2:L}=this.distanceToLines({viewport:O,points:N.handles.points,canvasCoords:v,proximity:S});return R<=S||L<=S}),$(this,"toolSelectedCallback",function(g,m,v,S){let D=arguments.length>4&&arguments[4]!==void 0?arguments[4]:6;const O=g.detail,{element:N}=O;m.highlighted=!0;const R=Mt(N,u.getToolName()),L=(0,j.getEnabledElement)(N),{renderingEngine:P,viewport:F}=L,{isNearFirstLine:V,isNearSecondLine:G}=u.distanceToLines({viewport:F,points:m.data.handles.points,canvasCoords:S,proximity:D});u.editData={annotation:m,viewportIdsToRender:R,movingTextBox:!1,isNearFirstLine:V,isNearSecondLine:G},u._activateModify(N),Wt(N),We(P,R),g.preventDefault()}),$(this,"_mouseUpCallback",g=>{const m=g.detail,{element:v}=m,{annotation:S,viewportIdsToRender:D,newAnnotation:O,hasMoved:N}=this.editData,{data:R}=S;if(O&&!N)return;if(this.angleStartedNotYetCompleted&&R.handles.points.length<4)return rn(v),void(this.editData.handleIndex=R.handles.points.length);this.angleStartedNotYetCompleted=!1,R.handles.activeHandleIndex=null,this._deactivateModify(v),this._deactivateDraw(v),rn(v);const L=(0,j.getEnabledElement)(v),{renderingEngine:P}=L;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(S.annotationUID),We(P,D),O&&sn(S),this.editData=null,this.isDrawing=!1}),$(this,"_mouseDownCallback",g=>{const{annotation:m,handleIndex:v}=this.editData,S=g.detail,{element:D,currentPoints:O}=S,N=O.world,{data:R}=m;return v===1?(R.handles.points[1]=N,void(this.editData.hasMoved=R.handles.points[1][0]!==R.handles.points[0][0]||R.handles.points[1][1]!==R.handles.points[0][0])):v===3?(R.handles.points[3]=N,this.editData.hasMoved=R.handles.points[3][0]!==R.handles.points[2][0]||R.handles.points[3][1]!==R.handles.points[2][0],void(this.angleStartedNotYetCompleted=!1)):(this.editData.hasMoved=!1,Wt(D),R.handles.points[2]=R.handles.points[3]=N,void(this.editData.handleIndex=R.handles.points.length-1))}),$(this,"_mouseDragCallback",g=>{this.isDrawing=!0;const m=g.detail,{element:v}=m,{annotation:S,viewportIdsToRender:D,handleIndex:O,movingTextBox:N,isNearFirstLine:R,isNearSecondLine:L}=this.editData,{data:P}=S;if(N){const{deltaPoints:G}=m,W=G.world,{textBox:q}=P.handles,{worldPosition:Y}=q;Y[0]+=W[0],Y[1]+=W[1],Y[2]+=W[2],q.hasMoved=!0}else if(O===void 0&&(R||L)){const{deltaPoints:G}=m,W=G.world,q=P.handles.points;R?[q[0],q[1]].forEach(Y=>{Y[0]+=W[0],Y[1]+=W[1],Y[2]+=W[2]}):L&&[q[2],q[3]].forEach(Y=>{Y[0]+=W[0],Y[1]+=W[1],Y[2]+=W[2]}),S.invalidated=!0}else{const{currentPoints:G}=m,W=G.world;P.handles.points[O]=[...W],S.invalidated=!0}this.editData.hasMoved=!0;const F=(0,j.getEnabledElement)(v),{renderingEngine:V}=F;We(V,D)}),$(this,"cancel",g=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(g),this._deactivateModify(g),rn(g);const{annotation:m,viewportIdsToRender:v,newAnnotation:S}=this.editData,{data:D}=m;D.handles.points.length<4&&Ht(m.annotationUID),m.highlighted=!1,D.handles.activeHandleIndex=null;const O=(0,j.getEnabledElement)(g),{renderingEngine:N}=O;return We(N,v),S&&sn(m),this.editData=null,this.angleStartedNotYetCompleted=!1,m.annotationUID}),$(this,"_activateModify",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.addEventListener(Q.MOUSE_CLICK,this._mouseUpCallback)}),$(this,"_deactivateModify",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.removeEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._mouseUpCallback)}),$(this,"_activateDraw",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.addEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),g.addEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.addEventListener(Q.MOUSE_DOWN,this._mouseDownCallback)}),$(this,"_deactivateDraw",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.removeEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.removeEventListener(Q.MOUSE_DOWN,this._mouseDownCallback)}),$(this,"renderAnnotation",(g,m)=>{var v,S;let D=!1;const{viewport:O}=g,{element:N}=O;let R=an(this.getToolName(),N);if((v=R)===null||v===void 0||!v.length||(R=this.filterInteractableAnnotationsForElement(N,R),(S=R)===null||S===void 0||!S.length))return D;const L=this.getTargetId(O),P=O.getRenderingEngine(),F={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:g.viewport.id};for(let G=0;G<R.length;G++){var V;const W=R[G],{annotationUID:q,data:Y}=W,{points:Z,activeHandleIndex:ne}=Y.handles;F.annotationUID=q;const{color:oe,lineWidth:ue,lineDash:ge}=this.getAnnotationStyle({annotation:W,styleSpecifier:F}),me=Z.map(Dt=>O.worldToCanvas(Dt));let xe;if(Y.cachedStats[L]&&Y.cachedStats[L].angle!=null?W.invalidated&&this._throttledCalculateCachedStats(W,P,g):(Y.cachedStats[L]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(W,P,g)),cr(W)||this.editData||ne===null||(xe=[me[ne]]),!O.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),D;xe&&Qn(m,q,"0",me,{color:oe,lineDash:ge,lineWidth:ue});const Ee=[me[0],me[1]],Ie=[me[2],me[3]];let be="line1";if(Mn(m,q,be,Ee[0],Ee[1],{color:oe,width:ue,lineDash:ge}),D=!0,me.length<4)return D;be="line2",Mn(m,q,be,Ie[0],Ie[1],{color:oe,width:ue,lineDash:ge}),be="linkLine",Mn(m,q,be,Ns(Ee[0],Ee[1]),Ns(Ie[0],Ie[1]),{color:oe,lineWidth:"1",lineDash:"1,4"});const{arc1Start:Ne,arc1End:_e,arc2End:Me,arc2Start:Pe}=Y.cachedStats[L].points.canvas,{arc1Angle:Ze,arc2Angle:Ye}=Y.cachedStats[L];if(this.configuration.showArcLines&&(be="arc1",Mn(m,q,be,Ne,_e,{color:oe,lineWidth:"1"}),be="arc2",Mn(m,q,be,Pe,Me,{color:oe,lineWidth:"1"})),(V=Y.cachedStats[L])===null||V===void 0||!V.angle)continue;const at=this.getLinkedTextBoxStyle(F,W);if(!at.visibility){Y.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const ot=this.configuration.getTextLines(Y,L);if(!Y.handles.textBox.hasMoved){const Dt=Ha(me);Y.handles.textBox.worldPosition=O.canvasToWorld(Dt)}const st=O.worldToCanvas(Y.handles.textBox.worldPosition),ct=Ki(m,q,"cobbAngleText",ot,st,me,{},at),{x:Tt,y:pt,width:Ct,height:gt}=ct;if(Y.handles.textBox.worldBoundingBox={topLeft:O.canvasToWorld([Tt,pt]),topRight:O.canvasToWorld([Tt+Ct,pt]),bottomLeft:O.canvasToWorld([Tt,pt+gt]),bottomRight:O.canvasToWorld([Tt+Ct,pt+gt])},this.configuration.showArcLines){const Dt="arcAngle1",en=["".concat(Ze.toFixed(2)," ").concat("")],$t=Ns(Ne,_e);kc(m,q,Dt,en,$t,{...at,padding:3});const mn="arcAngle2",Cn=["".concat(Ye.toFixed(2)," ").concat("")],br=Ns(Pe,Me);kc(m,q,mn,Cn,br,{...at,padding:3})}}return D}),$(this,"distanceToLines",g=>{let{viewport:m,points:v,canvasCoords:S,proximity:D}=g;const[O,N,R,L]=v,P=m.worldToCanvas(O),F=m.worldToCanvas(N),V=m.worldToCanvas(R),G=m.worldToCanvas(L),W={start:{x:P[0],y:P[1]},end:{x:F[0],y:F[1]}},q={start:{x:V[0],y:V[1]},end:{x:G[0],y:G[1]}},Y=mi([W.start.x,W.start.y],[W.end.x,W.end.y],[S[0],S[1]]),Z=mi([q.start.x,q.start.y],[q.end.x,q.end.y],[S[0],S[1]]);let ne=!1,oe=!1;return Y<=D?ne=!0:Z<=D&&(oe=!0),{distanceToPoint:Y,distanceToPoint2:Z,isNearFirstLine:ne,isNearSecondLine:oe}}),$(this,"getArcsStartEndPoints",g=>{let{firstLine:m,secondLine:v,mid1:S,mid2:D}=g;const O=[S,D],N=Qd(m,O),R=Qd(v,O),L=N>90?1:0,P=R>90?0:1,F=Ns(O[0],O[1]),V=Math.sqrt((O[1][0]-O[0][0])**2+(O[1][1]-O[0][1])**2),G=.1,W=Ns(m[0],m[1]),q=Ns(v[0],v[1]),Y=[m[L][0]-W[0],m[L][1]-W[1]],Z=Math.sqrt(Y[0]**2+Y[1]**2),ne=[Y[0]/Z,Y[1]/Z],oe=[W[0]+ne[0]*V*G,W[1]+ne[1]*V*G],ue=[F[0]-S[0],F[1]-S[1]],ge=Math.sqrt(ue[0]**2+ue[1]**2),me=[ue[0]/ge,ue[1]/ge],xe=[S[0]+me[0]*V*G,S[1]+me[1]*V*G],Ee=[v[P][0]-q[0],v[P][1]-q[1]],Ie=Math.sqrt(Ee[0]**2+Ee[1]**2),be=[Ee[0]/Ie,Ee[1]/Ie],Ne=[q[0]+be[0]*V*G,q[1]+be[1]*V*G],_e=[F[0]-D[0],F[1]-D[1]],Me=Math.sqrt(_e[0]**2+_e[1]**2),Pe=[_e[0]/Me,_e[1]/Me];return{arc1Start:oe,arc1End:xe,arc2Start:Ne,arc2End:[D[0]+Pe[0]*V*G,D[1]+Pe[1]*V*G],arc1Angle:N>90?180-N:N,arc2Angle:R>90?180-R:R}}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;let O,N=!1;m.worldPosition?N=!0:O=D.handles.points.findIndex(F=>F===m);const R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:O,movingTextBox:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}_calculateCachedStats(u,g,m){const v=u.data;if(v.handles.points.length!==4)return;const S=[null,null],D=[null,null];let O=Number.MAX_VALUE;for(let me=0;me<2;me+=1)for(let xe=2;xe<4;xe+=1){const Ee=le.vec3.distance(v.handles.points[me],v.handles.points[xe]);Ee<O&&(O=Ee,S[1]=v.handles.points[me],S[0]=v.handles.points[(me+1)%2],D[0]=v.handles.points[xe],D[1]=v.handles.points[2+(xe-1)%2])}const{viewport:N}=m,{element:R}=N,L=v.handles.points.map(me=>N.worldToCanvas(me)),P=[L[0],L[1]],F=[L[2],L[3]],V=Ns(P[0],P[1]),G=Ns(F[0],F[1]),{arc1Start:W,arc1End:q,arc2End:Y,arc2Start:Z,arc1Angle:ne,arc2Angle:oe}=this.getArcsStartEndPoints({firstLine:P,secondLine:F,mid1:V,mid2:G}),{cachedStats:ue}=v,ge=Object.keys(ue);for(let me=0;me<ge.length;me++)ue[ge[me]]={angle:Qd(S,D),arc1Angle:ne,arc2Angle:oe,points:{canvas:{arc1Start:W,arc1End:q,arc2End:Y,arc2Start:Z},world:{arc1Start:N.canvasToWorld(W),arc1End:N.canvasToWorld(q),arc2End:N.canvasToWorld(Y),arc2Start:N.canvasToWorld(Z)}}};return u.invalidated=!1,Yt(u,R),ue}}function bq(E,u){const g=E.cachedStats[u],{angle:m}=g;if(m!==void 0)return["".concat(m.toFixed(2)," ").concat("")]}$(ww,"toolName",void 0),ww.toolName="CobbAngle";const Iq=ww,{transformWorldToIndex:QD}=j.utilities;class Cw extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Oq,displayBothAxesDistances:!1}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"startedDrawing",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{if(this.startedDrawing)return;this.startedDrawing=!0;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;if(!(O instanceof j.StackViewport))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");Wt(v),this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=O.getFrameOfReferenceUID(),G={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:V,referencedImageId:F},data:{handles:{points:[[...S],[...S]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};fn(G,v);const W=Mt(v,this.getToolName());return this.editData={annotation:G,viewportIdsToRender:W,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),u.preventDefault(),We(N,W),G}),$(this,"isPointNearTool",(u,g,m,v)=>!1),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;if(this.startedDrawing&&N.handles.points.length===1)return void(this.editData.handleIndex=1);this.startedDrawing=!1,N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(L,S),D&&sn(v),this.editData=null,this.isDrawing=!1}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D,movingTextBox:O}=this.editData,{data:N}=v;if(O){const{deltaPoints:P}=g,F=P.world,{textBox:V}=N.handles,{worldPosition:G}=V;G[0]+=F[0],G[1]+=F[1],G[2]+=F[2],V.hasMoved=!0}else if(D===void 0){const{deltaPoints:P}=g,F=P.world;N.handles.points.forEach(V=>{V[0]+=F[0],V[1]+=F[1],V[2]+=F[2]}),v.invalidated=!0}else{const{currentPoints:P}=g,F=P.world;N.handles.points[D]=[...F],v.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(m),{renderingEngine:L}=R;We(L,S)}),$(this,"cancel",u=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const D=(0,j.getEnabledElement)(u),{renderingEngine:O}=D;return We(O,m),v&&sn(g),this.editData=null,this.startedDrawing=!1,g.annotationUID}}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R=this.getTargetId(D),L=D.getRenderingEngine(),P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<N.length;F++){const V=N[F],{annotationUID:G,data:W}=V,{points:q}=W.handles;P.annotationUID=G;const Y=this.getStyle("color",P,V),Z=q.map(Ne=>D.worldToCanvas(Ne));if(W.cachedStats[R]&&W.cachedStats[R].xValues!=null?V.invalidated&&this._throttledCalculateCachedStats(V,L,u):(W.cachedStats[R]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(V,L,u)),!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let ne="0";if(n1(g,G,ne,Z[0],{color:Y},0),S=!0,Z.length!==2)return S;if(ne="1",n1(g,G,ne,Z[1],{color:Y},1),W.cachedStats[R].isUnitless){const Ne="".concat(G,"-line-1");Mn(g,G,"1",Z[0],Z[1],{color:Y,width:1,shadow:this.configuration.shadow},Ne)}else{const Ne=Z[0],_e=Z[1],Me=_e[1]-Ne[1],Pe=_e[0]-Ne[0];let Ze=[0,0];Ze=W.cachedStats[R].isHorizontal?[Ne[0]+Pe,Ne[1]]:[Ne[0],Ne[1]+Me];let Ye="".concat(G,"-line-1"),at="1";Mn(g,G,at,Z[0],Ze,{color:Y,width:1,shadow:this.configuration.shadow},Ye),Ye="".concat(G,"-line-2"),at="2",Mn(g,G,at,Z[1],Ze,{color:Y,width:1,lineDash:[1,1],shadow:this.configuration.shadow},Ye)}const oe=this.getLinkedTextBoxStyle(P,V);if(!oe.visibility){W.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const ue=this.configuration.getTextLines(W,R,this.configuration);if(!W.handles.textBox.hasMoved){const Ne=Z[1];W.handles.textBox.worldPosition=D.canvasToWorld(Ne)}const ge=D.worldToCanvas(W.handles.textBox.worldPosition),me=Ki(g,G,"1",ue,ge,Z,{},oe),{x:xe,y:Ee,width:Ie,height:be}=me;W.handles.textBox.worldBoundingBox={topLeft:D.canvasToWorld([xe,Ee]),topRight:D.canvasToWorld([xe+Ie,Ee]),bottomLeft:D.canvasToWorld([xe,Ee+be]),bottomRight:D.canvasToWorld([xe+Ie,Ee+be])}}return S}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(u,g,m,v){}handleSelectedCallback(u,g,m){const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;const O=Mt(S,this.getToolName());let N;m.worldPosition||(N=D.handles.points.findIndex(P=>P===m)),this.editData={handleIndex:N,annotation:g,viewportIdsToRender:O},this._activateModify(S),Wt(S);const R=(0,j.getEnabledElement)(S),{renderingEngine:L}=R;We(L,O),u.preventDefault()}_calculateCachedStats(u,g,m){const v=u.data,{element:S}=m.viewport;if(v.handles.points.length!==2)return;const{cachedStats:D}=v,O=Object.keys(D);for(let N=0;N<O.length;N++){const R=O[N],L=this.getTargetIdImage(R,g);if(!L)continue;const{imageData:P}=L,F=v.handles.points[0],V=v.handles.points[1],G=QD(P,F),W=QD(P,V),{values:q,units:Y}=Gp(L,[G]),{values:Z,units:ne}=Gp(L,[W]);let oe,ue,ge,me,xe=!1;if(Y[0]!==ne[0]||Y[1]!==ne[1]||Y[0]==="raw"&&ne[0]==="raw"){const Ee=$a(F,V);oe=[Ee,0],ue=[Ee,0],ge=["px"],xe=!0}else{const Ee=m.viewport.worldToCanvas(F),Ie=m.viewport.worldToCanvas(V),be=Ie[1]-Ee[1],Ne=Ie[0]-Ee[0];me=Math.abs(Ne)>Math.abs(be),oe=[q[0],Z[0]],ue=[q[1],Z[1]],ge=[Y[0],Y[1]]}D[R]={xValues:oe,yValues:ue,isHorizontal:me,units:ge,isUnitless:xe}}return u.invalidated=!1,Yt(u,S),D}}function Oq(E,u,g){const m=E.cachedStats[u],{xValues:v,yValues:S,units:D,isUnitless:O,isHorizontal:N}=m;if(O)return["".concat(cn(v[0])," px")];if(g.displayBothAxesDistances){const R=Math.abs(v[1]-v[0]),L=Math.abs(S[1]-S[0]);return["".concat(cn(R)," ").concat(D[0]),"".concat(cn(L)," ").concat(D[1])]}if(N){const R=Math.abs(v[1]-v[0]);return["".concat(cn(R)," ").concat(D[0])]}{const R=Math.abs(S[1]-S[0]);return["".concat(cn(R)," ").concat(D[1])]}}$(Cw,"toolName",void 0),Cw.toolName="UltrasoundDirectionalTool";const Mq=Cw;class nh extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Nq,changeTextCallback:Rq,canvasPosition:[10,10],canvasSize:10}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D,R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.getReferencedImageId(O,S,L,P),V=nh.createAnnotation({metadata:{...O.getViewReference(),referencedImageId:F}});fn(V,v);const G=Mt(v,this.getToolName());return u.preventDefault(),We(N,G),this.configuration.getTextCallback(W=>{if(!W)return Ht(V.annotationUID),We(N,G),void(this.isDrawing=!1);V.data.text=W,sn(V),We(N,G)}),V}),$(this,"isPointNearTool",(u,g,m,v)=>{(0,j.getEnabledElement)(u);const{canvasPosition:S,canvasSize:D}=this.configuration;return!(S==null||!S.length)&&Math.abs(m[0]-S[0]+D/2)<=D/2&&Math.abs(m[1]-S[1]+D/2)<=D/2}),$(this,"toolSelectedCallback",(u,g)=>{g.highlighted=!0,u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g;this._deactivateModify(m),rn(m)}),$(this,"doubleClickCallback",u=>{var g;const m=u.detail,{element:v}=m;let S=an(this.getToolName(),v);if(S=this.filterInteractableAnnotationsForElement(v,S),(g=S)===null||g===void 0||!g.length)return;const D=S.find(N=>this.isPointNearTool(v,N,m.currentPoints.canvas,6));if(!D)return;const O=D;this.configuration.changeTextCallback(D,u.detail,this._doneChangingTextCallback.bind(this,v,O)),this.isDrawing=!1,u.stopImmediatePropagation(),u.preventDefault()}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length||(N=this.filterInteractableAnnotationsForElement(O,N),(v=N)===null||v===void 0||!v.length))return S;const R={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let L=0;L<N.length;L++){const P=N[L],{annotationUID:F}=P;R.annotationUID=F;const{color:V}=this.getAnnotationStyle({annotation:P,styleSpecifier:R}),{canvasPosition:G,canvasSize:W}=this.configuration;if(G!=null&&G.length&&b1(g,F,"1",G.map(q=>q+W),G,{color:V,width:1}),S=!0,!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S}return S})}cancel(){}handleSelectedCallback(u,g,m){}_doneChangingTextCallback(u,g,m){g.data.text=m;const v=(0,j.getEnabledElement)(u),{renderingEngine:S}=v,D=Mt(u,this.getToolName());We(S,D),Yt(g,u)}_isInsideVolume(u,g,m){return j.utilities.indexWithinDimensions(u,m)&&j.utilities.indexWithinDimensions(g,m)}}function Nq(E){return E(prompt("Enter your annotation:"))}function Rq(E,u,g){return g(prompt("Enter your annotation:"))}$(nh,"toolName",void 0),nh.toolName="KeyImage";const Aq=nh,R1="magnify-viewport";class xw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}),$(this,"_bounds",void 0),$(this,"editData",void 0),$(this,"_hasBeenRemoved",!1),$(this,"preMouseDownCallback",u=>{const g=u.detail,{element:m,currentPoints:v}=g,S=(0,j.getEnabledElement)(m),{viewport:D,renderingEngine:O}=S;if(!(D instanceof j.StackViewport))throw new Error("MagnifyTool only works on StackViewports");const N=this._getReferencedImageId(D);if(!N)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const R=Mt(m,this.getToolName());return this.editData={referencedImageId:N,viewportIdsToRender:R,enabledElement:S,renderingEngine:O,currentPoints:v},this._createMagnificationViewport(),this._activateDraw(m),Wt(m),u.preventDefault(),We(O,R),!0}),$(this,"preTouchStartCallback",u=>{this.preMouseDownCallback(u)}),$(this,"_createMagnificationViewport",()=>{const{enabledElement:u,referencedImageId:g,viewportIdsToRender:m,renderingEngine:v,currentPoints:S}=this.editData,{viewport:D}=u,{element:O}=D,N=D.getProperties(),{canvas:R,world:L}=S;let P;if(P=O.querySelector(".magnifyTool"),P===null){const V=document.createElement("div");V.classList.add("magnifyTool"),V.style.display="block",V.style.width="".concat(this.configuration.magnifyWidth,"px"),V.style.height="".concat(this.configuration.magnifyHeight,"px"),V.style.position="absolute",P=V,O.querySelector(".viewport-element").appendChild(V);const G={viewportId:R1,type:j.Enums.ViewportType.STACK,element:P};v.enableElement(G)}P.style.top="".concat(R[1]-this.configuration.magnifyHeight/2,"px"),P.style.left="".concat(R[0]-this.configuration.magnifyWidth/2,"px");const F=v.getViewport(R1);F.setStack([g]).then(()=>{if(this._hasBeenRemoved)return;F.setProperties(N);const{parallelScale:V}=D.getCamera(),{focalPoint:G,position:W,viewPlaneNormal:q}=F.getCamera(),Y=Math.sqrt(Math.pow(G[0]-W[0],2)+Math.pow(G[1]-W[1],2)+Math.pow(G[2]-W[2],2)),Z=[L[0],L[1],L[2]],ne=[Z[0]+Y*q[0],Z[1]+Y*q[1],Z[2]+Y*q[2]];F.setCamera({parallelScale:V*(1/this.configuration.magnifySize),focalPoint:Z,position:ne}),F.render()}),P.style.display="block",We(v,m)}),$(this,"_dragCallback",u=>{const g=u.detail,{deltaPoints:m,element:v,currentPoints:S}=g,D=m.world,O=S.canvas,N=(0,j.getEnabledElement)(v),{renderingEngine:R}=N,L=R.getViewport(R1),P=v.querySelector(".magnifyTool");if(!P)return;P.style.top="".concat(O[1]-this.configuration.magnifyHeight/2,"px"),P.style.left="".concat(O[0]-this.configuration.magnifyWidth/2,"px");const{focalPoint:F,position:V}=L.getCamera(),G=[V[0]+D[0],V[1]+D[1],V[2]+D[2]],W=[F[0]+D[0],F[1]+D[1],F[2]+D[2]];L.setCamera({focalPoint:W,position:G}),L.render()}),$(this,"_dragEndCallback",u=>{const{element:g}=u.detail,m=(0,j.getEnabledElement)(g),{renderingEngine:v}=m;v.disableElement(R1);const S=g.querySelector(".viewport-element"),D=S.querySelector(".magnifyTool");S.removeChild(D),this._deactivateDraw(g),rn(g),this._hasBeenRemoved=!0}),$(this,"_activateDraw",u=>{Ke.isInteractingWithTool=!0,this._hasBeenRemoved=!1,u.addEventListener(Q.MOUSE_UP,this._dragEndCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._dragEndCallback),u.addEventListener(Q.TOUCH_END,this._dragEndCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateDraw",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._dragEndCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._dragEndCallback),u.removeEventListener(Q.TOUCH_END,this._dragEndCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)})}_getReferencedImageId(u){const g=this.getTargetId(u);let m;return u instanceof j.StackViewport&&(m=g.split("imageId:")[1]),m}}$(xw,"toolName",void 0),xw.toolName="Magnify";const Lq=xw,kq=125,eb=E=>E.uid!==E.referenceId;class Pq{constructor(u){let{magnifyViewportId:g,sourceEnabledElement:m,radius:v=kq,position:S=[0,0],zoomFactor:D,autoPan:O}=u;$(this,"_viewportId",void 0),$(this,"_sourceEnabledElement",void 0),$(this,"_enabledElement",null),$(this,"_sourceToolGroup",null),$(this,"_magnifyToolGroup",null),$(this,"_isViewportReady",!1),$(this,"_radius",0),$(this,"_resized",!1),$(this,"_resizeViewportAsync",void 0),$(this,"_canAutoPan",!1),$(this,"_autoPan",void 0),$(this,"position",void 0),$(this,"zoomFactor",void 0),$(this,"visible",void 0),this._viewportId=g??j.utilities.uuidv4(),this._sourceEnabledElement=m,this._autoPan=O,this.radius=v,this.position=S,this.zoomFactor=D,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=Vp(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(u){Math.abs(this._radius-u)>1e-5&&(this._radius=u,this._resized=!0)}update(){const{radius:u,position:g,visible:m}=this,{viewport:v}=this._enabledElement,{element:S}=v,D=2*u,[O,N]=g;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(S.style,{display:m?"block":"hidden",width:"".concat(D,"px"),height:"".concat(D,"px"),left:"".concat(-u,"px"),top:"".concat(-u,"px"),transform:"translate(".concat(O,"px, ").concat(N,"px)")}),this._isViewportReady&&(this._syncViewports(),v.render())}dispose(){const{viewport:u}=this._enabledElement,{element:g}=u,m=u.getRenderingEngine();this._removeEventListeners(g),m.disableElement(u.id),g.parentNode&&g.parentNode.removeChild(g)}_handleToolModeChanged(u){var g;const{_magnifyToolGroup:m}=this,{toolGroupId:v,toolName:S,mode:D,toolBindingsOptions:O}=u.detail;if(((g=this._sourceToolGroup)===null||g===void 0?void 0:g.id)===v)switch(D){case ke.Active:m.setToolActive(S,O);break;case ke.Passive:m.setToolPassive(S);break;case ke.Enabled:m.setToolEnabled(S);break;case ke.Disabled:m.setToolDisabled(S);break;default:throw new Error("Unknow tool mode (".concat(D,")"))}}_inheritBorderRadius(u){const g=u.querySelector(".viewport-element"),m=u.querySelector(".cornerstone-canvas");g.style.borderRadius="inherit",m.style.borderRadius="inherit"}_createViewportNode(){const u=document.createElement("div"),{radius:g}=this,m=2*g;return u.classList.add("advancedMagnifyTool"),Object.assign(u.style,{display:"block",width:"".concat(m,"px"),height:"".concat(m,"px"),position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:"".concat(-g,"px"),top:"".concat(-g,"px"),transform:"translate(-1000px, -1000px)"}),u}_convertZoomFactorToParallelScale(u,g,m){const{parallelScale:v}=u.getCamera();return v*(1/m)*(g.canvas.offsetWidth/u.canvas.offsetWidth)}_isStackViewport(u){return"setStack"in u}_isVolumeViewport(u){return"addVolumes"in u}_cloneToolGroups(u,g){const m=u.getActors(),v="".concat(g.id,"-toolGroup"),S=nr(u.id,u.renderingEngineId),D=S.clone(v,O=>{const N=S.getToolInstance(O);return N instanceof ei&&!(N instanceof rh)||O===k3.toolName});return D.addViewport(g.id,g.renderingEngineId),m.filter(eb).forEach(O=>{Bp(v,[{segmentationId:O.referenceId,type:Nt.Labelmap}])}),{sourceToolGroup:S,magnifyToolGroup:D}}_cloneStack(u,g){const m=u.getImageIds();g.setStack(m).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(u,g){const m=u.getActors().filter(v=>!eb(v)).map(v=>({volumeId:v.uid}));return g.setVolumes(m).then(()=>{this._isViewportReady=!0,this.update()}),g}_cloneViewport(u,g){const{viewportId:m}=this,v=u.getRenderingEngine(),{options:S}=u,D={element:g,viewportId:m,type:u.type,defaultOptions:{...S}};v.enableElement(D);const O=v.getViewport(m);this._isStackViewport(u)?this._cloneStack(u,O):this._isVolumeViewport(u)&&this._cloneVolumes(u,O),this._inheritBorderRadius(g);const N=this._cloneToolGroups(u,O);this._sourceToolGroup=N.sourceToolGroup,this._magnifyToolGroup=N.magnifyToolGroup}_cancelMouseEventCallback(u){u.stopPropagation(),u.preventDefault()}_browserMouseUpCallback(u){const{element:g}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),g.addEventListener("mouseup",this._cancelMouseEventCallback),g.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(u){var g;const{element:m}=this._enabledElement.viewport;this._canAutoPan=!((g=u.target)===null||g===void 0||!g.closest(".advancedMagnifyTool")),document.addEventListener("mouseup",this._browserMouseUpCallback),m.removeEventListener("mouseup",this._cancelMouseEventCallback),m.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(u){if(!Ke.isInteractingWithTool)return;const{_autoPan:g}=this;if(!g.enabled||!this._canAutoPan)return;const{currentPoints:m}=u.detail,{viewport:v}=this._enabledElement,{canvasToWorld:S}=v,{canvas:D}=m,{radius:O}=this,N=[O,O],R=$a(N,D),L=O-g.padding;if(R<=L)return;const P=R-L,F=le.vec2.sub(le.vec2.create(),D,N);le.vec2.normalize(F,F),le.vec2.scale(F,F,P);const V=le.vec2.add(le.vec2.create(),this.position,F),G=S(this.position),W=S(V),q=le.vec3.sub(le.vec3.create(),W,G),Y={points:{currentPosition:{canvas:this.position,world:G},newPosition:{canvas:V,world:W}},delta:{canvas:F,world:q}};g.callback(Y)}_addBrowserEventListeners(u){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),u.addEventListener("mousedown",this._cancelMouseEventCallback),u.addEventListener("mouseup",this._cancelMouseEventCallback),u.addEventListener("mousemove",this._cancelMouseEventCallback),u.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(u){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),u.removeEventListener("mousedown",this._cancelMouseEventCallback),u.removeEventListener("mouseup",this._cancelMouseEventCallback),u.removeEventListener("mousemove",this._cancelMouseEventCallback),u.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(u){j.eventTarget.addEventListener(Q.TOOL_MODE_CHANGED,this._handleToolModeChanged),u.addEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),u.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(u)}_removeEventListeners(u){j.eventTarget.removeEventListener(Q.TOOL_MODE_CHANGED,this._handleToolModeChanged),u.addEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),u.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(u)}_initialize(){const{_sourceEnabledElement:u}=this,{viewport:g}=u,{canvas:m}=g,v=this._createViewportNode();m.parentNode.appendChild(v),this._addEventListeners(v),this._cloneViewport(g,v),this._enabledElement=(0,j.getEnabledElement)(v)}_syncViewportsCameras(u,g){const m=u.canvasToWorld(this.position),v=this._convertZoomFactorToParallelScale(u,g,this.zoomFactor),{focalPoint:S,position:D,viewPlaneNormal:O}=g.getCamera(),N=Math.sqrt(Math.pow(S[0]-D[0],2)+Math.pow(S[1]-D[1],2)+Math.pow(S[2]-D[2],2)),R=[m[0],m[1],m[2]],L=[R[0]+N*O[0],R[1]+N*O[1],R[2]+N*O[2]];g.setCamera({parallelScale:v,focalPoint:R,position:L})}_syncStackViewports(u,g){g.setImageIdIndex(u.getCurrentImageIdIndex())}_syncViewports(){const{viewport:u}=this._sourceEnabledElement,{viewport:g}=this._enabledElement,m=u.getProperties();g.getImageData()&&(g.setProperties(m),this._syncViewportsCameras(u,g),this._isStackViewport(u)&&this._syncStackViewports(u,g),this._syncViewportsCameras(u,g),g.render())}_resizeViewport(){const{viewport:u}=this._enabledElement;u.getRenderingEngine().resize()}}const Fq=1-j.CONSTANTS.EPSILON,{Events:Cl}=j.Enums;class $c{constructor(){$(this,"_magnifyViewportsMap",void 0),$(this,"createViewport",(u,g)=>{const{magnifyViewportId:m,sourceEnabledElement:v,position:S,radius:D,zoomFactor:O,autoPan:N}=g,{viewport:R}=v,{element:L}=R,P=new Pq({magnifyViewportId:m,sourceEnabledElement:v,radius:D,position:S,zoomFactor:O,autoPan:N});return this._addSourceElementEventListener(L),this._magnifyViewportsMap.set(P.viewportId,{annotation:u,magnifyViewport:P,magnifyViewportInfo:g}),P}),$(this,"_annotationRemovedCallback",u=>{const{annotation:g}=u.detail;g.metadata.toolName==="AdvancedMagnify"&&this.destroyViewport(g.data.magnifyViewportId)}),$(this,"_newStackImageCallback",u=>{const{viewportId:g,imageId:m}=u.detail,v=this._getMagnifyViewportsMapEntriesBySourceViewportId(g),{viewport:S}=(0,j.getEnabledElementByViewportId)(g);S.stackActorReInitialized&&this._reset(g),v.forEach(D=>{let{annotation:O}=D;O.metadata.referencedImageId=m,O.invalidated=!0})}),$(this,"_newVolumeImageCallback",u=>{const{renderingEngineId:g,viewportId:m}=u.detail,v=(0,j.getRenderingEngine)(g).getViewport(m),{viewPlaneNormal:S}=v.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(m).forEach(D=>{let{annotation:O}=D;const{viewPlaneNormal:N}=O.metadata;if(!(Math.abs(le.vec3.dot(N,S))>Fq))return;const{handles:R}=O.data,L=v.canvasToWorld([0,0]),P=le.vec3.sub(le.vec3.create(),L,R.points[0]),F=le.vec3.dot(P,S),V=le.vec3.scale(le.vec3.create(),S,F);for(let G=0,W=R.points.length;G<W;G++){const q=R.points[G];q[0]+=V[0],q[1]+=V[1],q[2]+=V[2]}O.invalidated=!0})}),this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){var u;return $c._singleton=(u=$c._singleton)!==null&&u!==void 0?u:new $c,$c._singleton}getViewport(u){var g;return(g=this._magnifyViewportsMap.get(u))===null||g===void 0?void 0:g.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(u){const g=this._magnifyViewportsMap.get(u);if(g){const{magnifyViewport:m}=g,{viewport:v}=m.sourceEnabledElement,{element:S}=v;this._removeSourceElementEventListener(S),m.dispose(),this._magnifyViewportsMap.delete(u)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(u=>this.destroyViewport(u))}_getMagnifyViewportsMapEntriesBySourceViewportId(u){return Array.from(this._magnifyViewportsMap.values()).filter(g=>{let{magnifyViewport:m}=g;const{viewport:v}=m.sourceEnabledElement;return v.id===u})}_reset(u){this._getMagnifyViewportsMapEntriesBySourceViewportId(u).forEach(g=>{let{magnifyViewport:m,annotation:v,magnifyViewportInfo:S}=g;this.destroyViewport(m.viewportId);const D=(0,j.getEnabledElementByViewportId)(u);this.createViewport(v,{...S,sourceEnabledElement:{...D}})})}_addEventListeners(){j.eventTarget.addEventListener(Q.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){j.eventTarget.removeEventListener(Q.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(u){u.addEventListener(Cl.STACK_NEW_IMAGE,this._newStackImageCallback);const g=v=>{const{viewportId:S}=v.detail;this._reset(S)};u.addEventListener(Cl.STACK_VIEWPORT_NEW_STACK,g);const m=v=>{const{viewportId:S}=v.detail;this._reset(S)};u.addEventListener(Cl.VOLUME_VIEWPORT_NEW_VOLUME,m),u.addEventListener(Cl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),u.newStackHandler=g,u.newVolumeHandler=m}_removeSourceElementEventListener(u){u.removeEventListener(Cl.STACK_NEW_IMAGE,this._newStackImageCallback),u.removeEventListener(Cl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),u.removeEventListener(Cl.STACK_VIEWPORT_NEW_STACK,u.newStackHandler),u.removeEventListener(Cl.VOLUME_VIEWPORT_NEW_VOLUME,u.newVolumeHandler),delete u.newStackHandler,delete u.newVolumeHandler}_initialize(){this._addEventListeners()}}$($c,"_singleton",void 0);var tb=function(E){return E.ShowZoomFactorsList="showZoomFactorsList",E}(tb||{});class rh extends ei{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:Uc.Secondary,modifierKey:li.Shift}]}}}}),$(this,"magnifyViewportManager",void 0),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=(0,j.getEnabledElement)(v),{viewport:D,renderingEngine:O}=S,N=m.world,R=m.canvas,{magnifyingGlass:L}=this.configuration,{radius:P,zoomFactor:F,autoPan:V}=L,G=this._getCanvasHandlePoints(R,P),W=D.getCamera(),{viewPlaneNormal:q,viewUp:Y}=W,Z=this.getReferencedImageId(D,N,q,Y),ne=j.utilities.uuidv4(),oe=j.utilities.uuidv4(),ue=D.getFrameOfReferenceUID(),ge={annotationUID:ne,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...q],viewUp:[...Y],FrameOfReferenceUID:ue,referencedImageId:Z},data:{sourceViewportId:D.id,magnifyViewportId:oe,zoomFactor:F,isCanvasAnnotation:!0,handles:{points:G,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(ge,{magnifyViewportId:oe,sourceEnabledElement:S,position:R,radius:P,zoomFactor:F,autoPan:{enabled:V.enabled,padding:V.padding,callback:xe=>{const Ee=ge.data.handles.points,{canvas:Ie}=xe.delta;for(let be=0,Ne=Ee.length;be<Ne;be++){const _e=Ee[be];_e[0]+=Ie[0],_e[1]+=Ie[1],ge.invalidated=!0}}}}),fn(ge,v);const me=Mt(v,this.getToolName());return u.preventDefault(),We(O,me),ge}),$(this,"onSetToolDisabled",()=>{this.magnifyViewportManager.dispose(),Jt().forEach(u=>{u.metadata.toolName===this.getToolName()&&Ht(u.annotationUID)})}),$(this,"isPointNearTool",(u,g,m,v)=>{const{data:S}=g,{points:D}=S.handles,O=D,N=O[0],R=O[2],L=O[3],P=.5*Math.abs(R[1]-N[1]),F=I0([[L[0]+P,N[1]+P],m]);return Math.abs(F-P)<2*v}),$(this,"toolSelectedCallback",(u,g)=>{const m=u.detail,{element:v}=m;g.highlighted=!0;const S=Mt(v,this.getToolName());this.editData={annotation:g,viewportIdsToRender:S},Wt(v),this._activateModify(v);const D=(0,j.getEnabledElement)(v),{renderingEngine:O}=D;We(O,S),u.preventDefault()}),$(this,"handleSelectedCallback",(u,g,m)=>{const v=u.detail,{element:S}=v,{data:D}=g;g.highlighted=!0;const{points:O}=D.handles,N=O.findIndex(F=>F===m),R=Mt(S,this.getToolName());this.editData={annotation:g,viewportIdsToRender:R,handleIndex:N},this._activateModify(S),Wt(S);const L=(0,j.getEnabledElement)(S),{renderingEngine:P}=L;We(P,R),u.preventDefault()}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D}=this.editData,{data:O}=v;O.handles.activeHandleIndex=null,this._deactivateModify(m),rn(m);const N=(0,j.getEnabledElement)(m),{renderingEngine:R}=N;this.editData=null,this.isDrawing=!1,We(R,S),D&&sn(v)}),$(this,"_dragDrawCallback",u=>{var g;this.isDrawing=!0;const m=u.detail,{element:v,deltaPoints:S}=m,D=(g=S==null?void 0:S.canvas)!==null&&g!==void 0?g:[0,0,0],O=(0,j.getEnabledElement)(v),{renderingEngine:N}=O,{annotation:R,viewportIdsToRender:L}=this.editData,{points:P}=R.data.handles;P.forEach(F=>{F[0]+=D[0],F[1]+=D[1]}),R.invalidated=!0,this.editData.hasMoved=!0,We(N,L)}),$(this,"_dragModifyCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D}=this.editData,{data:O}=v;if(D===void 0){const{deltaPoints:L}=g,P=L.canvas;O.handles.points.forEach(F=>{F[0]+=P[0],F[1]+=P[1]}),v.invalidated=!0}else this._dragHandle(u),v.invalidated=!0;const N=(0,j.getEnabledElement)(m),{renderingEngine:R}=N;We(R,S)}),$(this,"_dragHandle",u=>{const g=u.detail,{annotation:m}=this.editData,{data:v}=m,{points:S}=v.handles,D=S,O=D[0],N=D[2],R=D[3],L=.5*Math.abs(N[1]-O[1]),P=[R[0]+L,O[1]+L],{currentPoints:F}=g,V=I0([P,F.canvas]),G=this._getCanvasHandlePoints(P,V);S[0]=G[0],S[1]=G[1],S[2]=G[2],S[3]=G[3]}),$(this,"cancel",u=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(u),rn(u);const{annotation:g,viewportIdsToRender:m,newAnnotation:v}=this.editData,{data:S}=g;g.highlighted=!1,S.handles.activeHandleIndex=null;const D=(0,j.getEnabledElement)(u),{renderingEngine:O}=D;return We(O,m),v&&sn(g),this.editData=null,g.annotationUID}),$(this,"_activateModify",u=>{Ke.isInteractingWithTool=!0,u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateModify",u=>{Ke.isInteractingWithTool=!1,u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragModifyCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragModifyCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D}=u,{element:O}=D;let N=an(this.getToolName(),O);if((m=N)===null||m===void 0||!m.length)return S;N=(v=N)===null||v===void 0?void 0:v.filter(P=>P.data.sourceViewportId===D.id);const R=this.filterInteractableAnnotationsForElement(O,N);if(R==null||!R.length)return S;const L={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let P=0;P<R.length;P++){const F=R[P],{annotationUID:V,data:G}=F,{magnifyViewportId:W,zoomFactor:q,handles:Y}=G,{points:Z,activeHandleIndex:ne}=Y;L.annotationUID=V,this.getStyle("lineWidth",L,F),this.getStyle("lineDash",L,F);const oe=this.getStyle("color",L,F),ue=Z,ge=ue[0],me=ue[2],xe=ue[3],Ee=.5*Math.abs(me[1]-ge[1]),Ie=[xe[0]+Ee,ge[1]+Ee];if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;let be;if(!mr(V))continue;cr(F)||this.editData||ne===null||(be=[ue[ne]]),be&&Qn(g,V,"0",be,{color:oe});const Ne="".concat(V,"-advancedMagnify");_a(g,V,"0",Ie,Ee,{color:oe,lineWidth:5},Ne);const _e=this.magnifyViewportManager.getViewport(W);_e.position=Ie,_e.radius=Ee,_e.zoomFactor=q,_e.update(),S=!0}return S}),$(this,"_getCanvasHandlePoints",(u,g)=>[[u[0],u[1]-g,0],[u[0]+g,u[1],0],[u[0],u[1]+g,0],[u[0]-g,u[1],0]]),this.magnifyViewportManager=$c.getInstance()}showZoomFactorsList(u,g){const{element:m,currentPoints:v}=u.detail,S=(0,j.getEnabledElement)(m),{viewport:D}=S,{canvas:O}=v,N=m.querySelector(":scope .viewport-element"),R=g.data.zoomFactor,L=this._getZoomFactorsListDropdown(R,P=>{P!==void 0&&(g.data.zoomFactor=Number.parseFloat(P),g.invalidated=!0),L.parentElement.removeChild(L),D.render()});Object.assign(L.style,{left:"".concat(O[0],"px"),top:"".concat(O[1],"px")}),N.appendChild(L),L.focus()}_getZoomFactorsListDropdown(u,g){const{zoomFactorList:m}=this.configuration.magnifyingGlass,v=document.createElement("select");return v.size=5,Object.assign(v.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(S=>{v.addEventListener(S,D=>D.stopPropagation())}),v.addEventListener("change",S=>{S.stopPropagation(),g(v.value)}),v.addEventListener("keydown",S=>{var D,O;(((D=S.keyCode)!==null&&D!==void 0?D:S.which===27)||((O=S.key)===null||O===void 0?void 0:O.toLowerCase())==="escape")&&(S.stopPropagation(),g())}),m.forEach(S=>{const D=document.createElement("option");D.label=S,D.title="Zoom factor ".concat(S.toFixed(1)),D.value=S,D.defaultSelected=S===u,v.add(D)}),v}}$(rh,"toolName",void 0),$(rh,"Actions",tb),rh.toolName="AdvancedMagnify";class Sw extends Lc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"isDrawing",!1),$(this,"isHandleOutsideImage",!1),$(this,"_elementWithCursor",null),$(this,"_currentCursorWorldPosition",null),$(this,"_currentCanvasPosition",null),$(this,"_disableCursorEnabled",!1),$(this,"mouseMoveCallback",u=>{const{detail:g}=u,{element:m,currentPoints:v}=g;this._currentCursorWorldPosition=v.world,this._currentCanvasPosition=v.canvas,this._elementWithCursor=m;const S=this.getActiveAnnotation(m);return S===null?(this.createInitialAnnotation(v.world,m),!1):(this.updateAnnotationPosition(m,S),!1)}),$(this,"createInitialAnnotation",(u,g)=>{const m=(0,j.getEnabledElement)(g);if(!m)throw new Error("No enabled element found");const{viewport:v,renderingEngine:S}=m;this.isDrawing=!0;const D=v.getCamera(),{viewPlaneNormal:O,viewUp:N}=D;if(!O||!N)throw new Error("Camera not found");const R=this.getReferencedImageId(v,u,O,N),L=v.getFrameOfReferenceUID(),P={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...O],viewUp:[...N],FrameOfReferenceUID:L,referencedImageId:R},data:{label:"",handles:{points:[[...u]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if(an(this.getToolName(),g).length>0)return null;if(fn(P,g)===null)return;const F=Mt(g,this.getToolName(),!1);We(S,F)}),$(this,"onCameraModified",u=>{const g=u.detail,{element:m,previousCamera:v,camera:S}=g,D=(0,j.getEnabledElement)(m).viewport;if(m!==this._elementWithCursor)return;const O=v.focalPoint,N=S.viewPlaneNormal,R=S.focalPoint,L=[0,0,0];if(hn().subtract(R,O,L),L.reduce((V,G)=>V+G,0)===0)return;const P=hn().dot(L,N);if(Math.abs(P)<.01||!this._currentCanvasPosition)return;const F=D.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=F,this.updateAnnotationPosition(m,this.getActiveAnnotation(m))}),$(this,"renderAnnotation",(u,g)=>{var m,v;let S=!1;const{viewport:D,FrameOfReferenceUID:O}=u,N=this._elementWithCursor===D.element;this.configuration.positionSync&&!N&&this.updateViewportImage(D);const{element:R}=D;let L=an(this.getToolName(),R);if((m=L)===null||m===void 0||!m.length||(L=this.filterInteractableAnnotationsForElement(R,L),(v=L)===null||v===void 0||!v.length))return S;const P={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let F=0;F<L.length;F++){const V=L[F],{annotationUID:G,data:W}=V,{handles:q}=W,{points:Y}=q;if(!G)return S;P.annotationUID=G;const Z=parseFloat(this.getStyle("lineWidth",P,V)),ne=this.getStyle("lineDash",P,V),oe=this.getStyle("color",P,V);if(Y[0].some(be=>isNaN(be)))return S;const ue=Y.map(be=>D.worldToCanvas(be));if(!D.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),S;if(!mr(G))continue;const ge={upper:"upper",right:"right",lower:"lower",left:"left"},[me,xe]=ue[0],Ee=N?20:7,Ie=N?5:7;Mn(g,G,ge.upper,[me,xe-(Ee/2+Ie)],[me,xe-Ee/2],{color:oe,lineDash:ne,lineWidth:Z}),Mn(g,G,ge.lower,[me,xe+(Ee/2+Ie)],[me,xe+Ee/2],{color:oe,lineDash:ne,lineWidth:Z}),Mn(g,G,ge.right,[me+(Ee/2+Ie),xe],[me+Ee/2,xe],{color:oe,lineDash:ne,lineWidth:Z}),Mn(g,G,ge.left,[me-(Ee/2+Ie),xe],[me-Ee/2,xe],{color:oe,lineDash:ne,lineWidth:Z}),S=!0}return S}),this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const u=qn(this.toolGroupId).viewportsInfo;u&&u.map(g=>(0,j.getEnabledElementByIds)(g.viewportId,g.renderingEngineId)).forEach(g=>{g&&Wt(g.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const u=qn(this.toolGroupId).viewportsInfo;u&&u.map(g=>(0,j.getEnabledElementByIds)(g.viewportId,g.renderingEngineId)).forEach(g=>{g&&rn(g.viewport.element)})}getActiveAnnotation(u){const g=an(this.getToolName(),u);return g.length?g[0]:null}updateAnnotationPosition(u,g){var m;const v=this._currentCursorWorldPosition;if(!v||(m=g.data)===null||m===void 0||(m=m.handles)===null||m===void 0||!m.points)return;g.data.handles.points=[[...v]],g.invalidated=!0;const S=Mt(u,this.getToolName(),!1),D=(0,j.getEnabledElement)(u);if(!D)return;const{renderingEngine:O}=D;We(O,S)}filterInteractableAnnotationsForElement(u,g){var m,v;if(!(g instanceof Array)||g.length===0)return[];const S=g[0],D=(m=(0,j.getEnabledElement)(u))===null||m===void 0?void 0:m.viewport;if(!D)return[];const O=D.getCamera(),{viewPlaneNormal:N,focalPoint:R}=O;if(!N||!R)return[];const L=(v=S.data)===null||v===void 0||(v=v.handles)===null||v===void 0?void 0:v.points;if(!(L instanceof Array)||L.length!==1)return[];const P=L[0],F=j.utilities.planar.planeEquation(N,R);return j.utilities.planar.planeDistanceToPoint(F,P)<this.configuration.displayThreshold?[S]:[]}updateViewportImage(u){const g=this._currentCursorWorldPosition;if(g&&!g.some(m=>isNaN(m))){if(u instanceof j.StackViewport){const m=j.utilities.getClosestStackImageIndexForPoint(g,u);if(m===null)return;m!==u.getCurrentImageIdIndex()&&u.setImageIdIndex(m)}else if(u instanceof j.VolumeViewport){const{focalPoint:m,viewPlaneNormal:v}=u.getCamera();if(!m||!v)return;const S=j.utilities.planar.planeEquation(v,m),D=j.utilities.planar.planeDistanceToPoint(S,g,!0);if(Math.abs(D)<.5)return;const O=le.vec3.normalize(le.vec3.create(),le.vec3.fromValues(...v)),N=le.vec3.scale(le.vec3.create(),O,D),R=le.vec3.add(le.vec3.create(),le.vec3.fromValues(...m),N);{u.setCamera({focalPoint:R});const L=u.getRenderingEngine();L&&L.renderViewport(u.id)}}}}}$(Sw,"toolName",void 0),Sw.toolName="ReferenceCursors";const Vq=Sw,nb=[];class Ew extends Lc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{configuration:{viewportId:"",scaleLocation:"bottom"}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",{}),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"_init",()=>{const u=(0,j.getRenderingEngines)()[0];if(!u)return;const g=qn(this.toolGroupId).viewportsInfo;if(!g)return;const m=g.map(P=>(0,j.getEnabledElementByIds)(P.viewportId,P.renderingEngineId));let{viewport:v}=m[0];const{FrameOfReferenceUID:S}=m[0];if(this.configuration.viewportId&&m.forEach(P=>{P.viewport.id==this.configuration.viewportId&&(v=P.viewport)}),!v)return;const{viewUp:D,viewPlaneNormal:O}=v.getCamera(),N=j.utilities.getViewportImageCornersInWorld(v);let R=this.editData.annotation;const L=an(this.getToolName(),v.element);if(L.length&&(R=L.filter(P=>P.data.viewportId==v.id)[0]),nb.includes(v.id))this.editData.annotation&&this.editData.annotation.data.viewportId==v.id&&(this.editData.annotation.data.handles.points=N,this.editData.annotation.data.viewportId=v.id);else{const P={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...O],viewUp:[...D],FrameOfReferenceUID:S,referencedImageId:null},data:{handles:{points:N},viewportId:v.id}};nb.push(v.id),fn(P,v.element),R=P}this.editData={viewport:v,renderingEngine:u,annotation:R}}),$(this,"onSetToolEnabled",()=>{this._init()}),$(this,"onCameraModified",u=>{this.configuration.viewportId=u.detail.viewportId,this._init()}),$(this,"computeScaleSize",(u,g,m)=>{const v=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let S;return S=m=="top"||m=="bottom"?v.filter(D=>D<.6*u&&D>.2*u):v.filter(D=>D<.6*g&&D>.2*g),S[0]}),$(this,"computeEndScaleTicks",(u,g)=>{const m={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]};return{endTick1:[[u[1][0]+m[g][0][0],u[1][1]+m[g][0][0]],[u[1][0]+m[g][1][0],u[1][1]+m[g][1][1]]],endTick2:[[u[0][0]+m[g][0][0],u[0][1]+m[g][0][0]],[u[0][0]+m[g][1][0],u[0][1]+m[g][1][1]]]}}),$(this,"computeInnerScaleTicks",(u,g,m,v,S)=>{let D;g=="bottom"||g=="top"?D=S[0][0]-v[0][0]:g!="left"&&g!="right"||(D=S[0][1]-v[0][1]);const O=[],N=[],R=[];let L=u;u>=50&&(L=u/10);const P=D/L;for(let F=0;F<L-1;F++){const V={bottom:[[P*(F+1),0],[P*(F+1),5]],top:[[P*(F+1),0],[P*(F+1),-5]],left:[[0,P*(F+1)],[-5,P*(F+1)]],right:[[0,P*(F+1)],[5,P*(F+1)]]};O.push("".concat(m,"-tick").concat(F)),N.push("tick".concat(F)),(F+1)%5==0?R.push([[v[0][0]+V[g][0][0],v[0][1]+V[g][0][1]],[v[1][0]+V[g][0][0],v[1][1]+V[g][0][1]]]):R.push([[v[0][0]+V[g][0][0],v[0][1]+V[g][0][1]],[v[1][0]+V[g][1][0],v[1][1]+V[g][1][1]]])}return{tickIds:O,tickUIDs:N,tickCoordinates:R}}),$(this,"computeWorldScaleCoordinates",(u,g,m)=>{let v,S=le.vec3.subtract(le.vec3.create(),m[0],m[1]);S=le.vec3.normalize(le.vec3.create(),S);let D=le.vec3.subtract(le.vec3.create(),m[2],m[0]);D=le.vec3.normalize(le.vec3.create(),D);const O={bottom:[m[1],m[2]],top:[m[0],m[3]],right:[m[2],m[3]],left:[m[0],m[1]]},N=le.vec3.add(le.vec3.create(),O[g][0],O[g][0]).map(L=>L/2),R=u/2/Math.sqrt(Math.pow(S[0],2)+Math.pow(S[1],2)+Math.pow(S[2],2));return g=="top"||g=="bottom"?v=[le.vec3.subtract(le.vec3.create(),N,D.map(L=>L*R)),le.vec3.add(le.vec3.create(),N,D.map(L=>L*R))]:g!="left"&&g!="right"||(v=[le.vec3.add(le.vec3.create(),N,S.map(L=>L*R)),le.vec3.subtract(le.vec3.create(),N,S.map(L=>L*R))]),v}),$(this,"computeCanvasScaleCoordinates",(u,g,m,v,S)=>{let D;if(S=="top"||S=="bottom"){const O=g[0][0]-g[1][0];D=[[u.width/2-O/2,m.height],[u.width/2+O/2,m.height]]}else if(S=="left"||S=="right"){const O=g[0][1]-g[1][1];D=[[v.width,u.height/2-O/2],[v.width,u.height/2+O/2]]}return D}),$(this,"computeScaleBounds",(u,g,m,v)=>{const S=g*Math.min(1e3,u.width),D=m*Math.min(1e3,u.height),O={bottom:[-D,-S],top:[D,S],left:[D,S],right:[-D,-S]},N={bottom:[u.height,u.width],top:[0,u.width],left:[u.height,0],right:[u.height,u.width]};return{height:N[v][0]+O[v][0],width:N[v][1]+O[v][1]}})}renderAnnotation(u,g){if(!this.editData.viewport)return;const m=this.configuration.scaleLocation,{viewport:v}=u,S=an(this.getToolName(),v.element).filter(ct=>ct.data.viewportId==v.id)[0],D=u.viewport.canvas,O=!1;if(!v)return O;const N={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id},R={width:D.width/window.devicePixelRatio||1,height:D.height/window.devicePixelRatio||1},L=S.data.handles.points[0],P=S.data.handles.points[1],F=S.data.handles.points[2],V=S.data.handles.points[3],G=[L,F,P,V],W=le.vec3.distance(F,V),q=le.vec3.distance(L,F),Y=this.computeScaleBounds(R,.05,.05,m),Z=this.computeScaleBounds(R,.05,.05,m),ne=this.computeScaleSize(W,q,m),oe=this.computeWorldScaleCoordinates(ne,m,G).map(ct=>v.worldToCanvas(ct)),ue=this.computeCanvasScaleCoordinates(R,oe,Z,Y,m),ge=this.computeEndScaleTicks(ue,m),{annotationUID:me}=S;N.annotationUID=me;const xe=this.getStyle("lineWidth",N,S),Ee=this.getStyle("lineDash",N,S),Ie=this.getStyle("color",N,S),be=this.getStyle("shadow",N,S),Ne="".concat(me,"-scaleline");Mn(g,me,"1",ue[0],ue[1],{color:Ie,width:xe,lineDash:Ee,shadow:be},Ne);const _e="".concat(me,"-left");Mn(g,me,"2",ge.endTick1[0],ge.endTick1[1],{color:Ie,width:xe,lineDash:Ee,shadow:be},_e);const Me="".concat(me,"-right");Mn(g,me,"3",ge.endTick2[0],ge.endTick2[1],{color:Ie,width:xe,lineDash:Ee,shadow:be},Me);const Pe={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},Ze=[ue[0][0]+Pe[m][0],ue[0][1]+Pe[m][1]],Ye=this._getTextLines(ne),{tickIds:at,tickUIDs:ot,tickCoordinates:st}=this.computeInnerScaleTicks(ne,m,me,ge.endTick1,ge.endTick2);for(let ct=0;ct<ot.length;ct++)Mn(g,me,ot[ct],st[ct][0],st[ct][1],{color:Ie,width:xe,lineDash:Ee,shadow:be},at[ct]);return kc(g,me,"text0",Ye,[Ze[0],Ze[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:Ie}),O}_getTextLines(u){let g,m;return u>=50?(g=u/10,m=" cm"):(g=u,m=" mm"),[g.toString().concat(m)]}}$(Ew,"toolName",void 0),Ew.toolName="ScaleOverlay";const Uq=Ew,rb=(E,u,g)=>{var m;if(u==null||(m=u.data)===null||m===void 0||(m=m.contour)===null||m===void 0||(m=m.polyline)===null||m===void 0||!m.length)return;const{polyline:v}=u.data.contour,{length:S}=v;let D=1/0;for(let O=0;O<S;O++){const N=$a(E.worldToCanvas(v[O]),g);D=Math.min(D,N)}return D===1/0||isNaN(D)?void 0:D};class ib{constructor(){$(this,"toolInfo",{toolSize:null,maxToolSize:null})}renderShape(u,g,m){_a(u,"SculptorTool","0",g,this.toolInfo.toolSize,m)}pushHandles(u,g){const{points:m,mouseCanvasPoint:v}=g,S={first:void 0,last:void 0};for(let D=0;D<m.length;D++){const O=$a(u.worldToCanvas(m[D]),v);O>this.toolInfo.toolSize||(this.pushOneHandle(D,O,g),S.first===void 0&&(S.first=D),S.last=D)}return S}configureToolSize(u){const g=this.toolInfo;if(g.toolSize&&g.maxToolSize)return;const m=u.detail.element,v=Math.min(m.clientWidth,m.clientHeight)/12;g.toolSize=v,g.maxToolSize=v}updateToolSize(u,g,m){const v=this.toolInfo,S=rb(g,m,u);S>0&&(v.toolSize=Math.min(v.maxToolSize,S))}getMaxSpacing(u){return Math.max(this.toolInfo.toolSize/4,u)}getInsertPosition(u,g,m){let v;const{points:S,element:D,mouseCanvasPoint:O}=m,N=this.toolInfo.toolSize,R=(0,j.getEnabledElement)(D),{viewport:L}=R,P=L.worldToCanvas(S[u]),F=L.worldToCanvas(S[g]),V=[(P[0]+F[0])/2,(P[1]+F[1])/2],G=$a(O,V);if(G<N){const W={x:(V[0]-O[0])/G,y:(V[1]-O[1])/G};v=[O[0]+N*W.x,O[1]+N*W.y]}else v=V;return L.canvasToWorld(v)}pushOneHandle(u,g,m){const{points:v,mousePoint:S}=m,D=this.toolInfo.toolSize,O=v[u],N=(O[0]-S[0])/g,R=(O[1]-S[1])/g,L=(O[2]-S[2])/g,P={x:S[0]+D*N,y:S[1]+D*R,z:S[2]+D*L};O[0]=P.x,O[1]=P.y,O[2]=P.z}}$(ib,"shapeName","Circle");const Tw=ib;class _w extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}),$(this,"registeredShapes",new Map),$(this,"isActive",!1),$(this,"selectedShape",void 0),$(this,"commonData",{activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0}),$(this,"sculptData",void 0),$(this,"preMouseDownCallback",u=>{const g=u.detail,m=g.element;if(this.configureToolSize(u),this.selectFreehandTool(g),this.commonData.activeAnnotationUID!==null)return this.isActive=!0,Wt(m),this.activateModify(m),!0}),$(this,"mouseMoveCallback",u=>{this.mode===ke.Active?(this.configureToolSize(u),this.updateCursor(u)):this.commonData.canvasLocation=void 0}),$(this,"endCallback",u=>{const g=u.detail,{element:m}=g,v=this.configuration,S=(0,j.getEnabledElement)(m);this.isActive=!1,this.deactivateModify(m),rn(m);const{renderingEngineId:D,viewportId:O}=S,N=nr(O,D).getToolInstance(v.referencedToolName),R=this.filterSculptableAnnotationsForElement(m).find(L=>L.annotationUID===this.commonData.activeAnnotationUID);N.configuration.calculateStats&&(R.invalidated=!0),Yt(R,m)}),$(this,"dragCallback",u=>{const g=u.detail,m=g.element;this.updateCursor(u);const v=this.filterSculptableAnnotationsForElement(m),S=v.find(O=>O.annotationUID===this.commonData.activeAnnotationUID);if(v==null||!v.length||!this.isActive)return;const D=S.data.contour.polyline;this.sculpt(g,D)}),this.registerShapes(Tw.shapeName,Tw),this.setToolShape(this.configuration.toolShape)}registerShapes(u,g){const m=new g;this.registeredShapes.set(u,m)}sculpt(u,g){const m=this.configuration,v=u.element,S=(0,j.getEnabledElement)(v),{viewport:D}=S,O=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:u.currentPoints.world,mouseCanvasPoint:u.currentPoints.canvas,points:g,maxSpacing:O.getMaxSpacing(m.minSpacing),element:v};const N=O.pushHandles(D,this.sculptData);N.first!==void 0&&this.insertNewHandles(N)}interpolatePointsWithinMaxSpacing(u,g,m,v){const{element:S}=this.sculptData,D=(0,j.getEnabledElement)(S),{viewport:O}=D,N=ab(u+1,g.length);$a(O.worldToCanvas(g[u]),O.worldToCanvas(g[N]))>v&&m.push(u)}updateCursor(u){const g=u.detail,m=g.element,v=(0,j.getEnabledElement)(m),{renderingEngine:S,viewport:D}=v;this.commonData.viewportIdsToRender=[D.id];const O=this.filterSculptableAnnotationsForElement(m);if(O==null||!O.length)return;const N=O.find(R=>R.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=g.currentPoints.canvas,this.isActive)N.highlighted=!0;else{const R=this.registeredShapes.get(this.selectedShape),L=g.currentPoints.canvas;R.updateToolSize(L,D,N)}h_(S,this.commonData.viewportIdsToRender)}filterSculptableAnnotationsForElement(u){const g=this.configuration,m=(0,j.getEnabledElement)(u),{renderingEngineId:v,viewportId:S}=m,D=[],O=nr(S,v).getToolInstance(g.referencedToolName);return g.referencedToolNames.forEach(N=>{const R=an(N,u);R&&D.push(...R)}),O.filterInteractableAnnotationsForElement(u,D)}configureToolSize(u){this.registeredShapes.get(this.selectedShape).configureToolSize(u)}insertNewHandles(u){const g=this.findNewHandleIndices(u);let m=0;for(let v=0;v<(g==null?void 0:g.length);v++){const S=g[v]+1+m;this.insertHandleRadially(S),m++}}findNewHandleIndices(u){const{points:g,maxSpacing:m}=this.sculptData,v=[];for(let S=u.first;S<=u.last;S++)this.interpolatePointsWithinMaxSpacing(S,g,v,m);return v}insertHandleRadially(u){const{points:g}=this.sculptData;if(u>g.length-1&&this.commonData.isEditingOpenContour)return;const m=this.registeredShapes.get(this.selectedShape),v=u-1,S=ab(u,g.length),D=m.getInsertPosition(v,S,this.sculptData);g.splice(u,0,D)}selectFreehandTool(u){const g=this.getClosestFreehandToolOnElement(u);g!==void 0&&(this.commonData.activeAnnotationUID=g)}getClosestFreehandToolOnElement(u){const{element:g}=u,m=(0,j.getEnabledElement)(g),{viewport:v}=m,S=this.configuration,D=this.filterSculptableAnnotationsForElement(g);if(D==null||!D.length)return;const O=u.currentPoints.canvas,N={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let R=0;R<(D==null?void 0:D.length);R++){if(D[R].isLocked||!D[R].isVisible)continue;const L=rb(v,D[R],O);L!==-1&&L<N.distance&&(N.distance=L,N.toolIndex=R,N.annotationUID=D[R].annotationUID)}return this.commonData.isEditingOpenContour=!D[N.toolIndex].data.contour.closed,S.referencedToolName=D[N.toolIndex].metadata.toolName,N.annotationUID}activateModify(u){u.addEventListener(Q.MOUSE_UP,this.endCallback),u.addEventListener(Q.MOUSE_CLICK,this.endCallback),u.addEventListener(Q.MOUSE_DRAG,this.dragCallback),u.addEventListener(Q.TOUCH_TAP,this.endCallback),u.addEventListener(Q.TOUCH_END,this.endCallback),u.addEventListener(Q.TOUCH_DRAG,this.dragCallback)}deactivateModify(u){u.removeEventListener(Q.MOUSE_UP,this.endCallback),u.removeEventListener(Q.MOUSE_CLICK,this.endCallback),u.removeEventListener(Q.MOUSE_DRAG,this.dragCallback),u.removeEventListener(Q.TOUCH_TAP,this.endCallback),u.removeEventListener(Q.TOUCH_END,this.endCallback),u.removeEventListener(Q.TOUCH_DRAG,this.dragCallback)}setToolShape(u){var g;this.selectedShape=(g=this.registeredShapes.get(u))!==null&&g!==void 0?g:Tw.shapeName}renderAnnotation(u,g){const{viewport:m}=u,{element:v}=m,S=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==ke.Active||!S.includes(m.id))return;const D=this.filterSculptableAnnotationsForElement(v);if(D==null||!D.length)return;const O={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};let N=y0("color",O,Is.Default,this.mode);this.isActive&&(N=y0("color",O,Is.Highlighted,this.mode)),this.registeredShapes.get(this.selectedShape).renderShape(g,this.commonData.canvasLocation,{color:N})}}$(_w,"toolName",void 0);const ab=(E,u)=>(E+u)%u;_w.toolName="SculptorTool";const Bq=_w;class Dw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]}),$(this,"preMouseDownCallback",u=>this._deleteNearbyAnnotations(u,"mouse")),$(this,"preTouchStartCallback",u=>this._deleteNearbyAnnotations(u,"touch"))}_deleteNearbyAnnotations(u,g){const{renderingEngineId:m,viewportId:v,element:S,currentPoints:D}=u.detail,O=nr(v,m);if(!O)return!1;const N=O._toolInstances,R=[];for(const L in N){const P=N[L];if(typeof P.isPointNearTool!="function"||typeof P.filterInteractableAnnotationsForElement!="function")continue;const F=an(L,S);if(!F.length)continue;const V=P.filterInteractableAnnotationsForElement(S,F)||[];for(const G of V)P.isPointNearTool(S,G,D.canvas,10,g)&&R.push(G.annotationUID)}for(const L of R)oa(L),Ht(L);return u.preventDefault(),!0}}$(Dw,"toolName",void 0),Dw.toolName="Eraser";const Gq=Dw,{transformWorldToIndex:zq}=j.utilities;function ob(E,u){(function(g,m){const{points:v,segmentsLocked:S,segmentIndex:D,segmentationId:O}=m,{viewport:N}=g,R=u9({operationData:m,viewport:g.viewport});if(!R)return void console.warn("No data found for fillRectangle");const{segmentationImageData:L,segmentationScalarData:P}=R;let F=v.map(Ie=>zq(L,Ie));F=F.map(Ie=>Ie.map(be=>Math.round(be)));const V=ml(F,L.getDimensions()),G=N instanceof j.StackViewport||c7(F),W=L.getDirection(),q=L.getSpacing(),{viewPlaneNormal:Y}=N.getCamera(),Z=j.utilities.getSpacingInNormalDirection({direction:W,spacing:q},Y),ne=S_(v);let[[oe,ue],[ge,me],[xe,Ee]]=ne;oe-=Z,ue+=Z,ge-=Z,me+=Z,xe-=Z,Ee+=Z,Ii(L,G?()=>!0:Ie=>{const[be,Ne,_e]=Ie;return be>=oe&&be<=ue&&Ne>=ge&&Ne<=me&&_e>=xe&&_e<=Ee},Ie=>{let{value:be,index:Ne}=Ie;S.includes(be)||(P[Ne]=D)},V),pi(O)})(E,u)}function Wq(E,u){(function(g,m){ob(g,Object.assign({},m,{segmentIndex:0}))})(E,u)}class bw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:ob,ERASE_INSIDE:Wq},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"preMouseDownCallback",u=>{if(this.isDrawing===!0)return;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R,F=this.toolGroupId,V=Ko(F);if(!V)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:G,segmentationId:W,type:q}=V,Y=vl(W),Z=Ac(W),ne=Es(F,G,Y),{representationData:oe}=dn(W),ue=oe[Nt.Labelmap],ge={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:O.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:ne},data:{handles:{points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null}}},me=Mt(v,this.getToolName());if(this.editData={annotation:ge,segmentIndex:Y,segmentationId:W,segmentsLocked:Z,segmentColor:ne,viewportIdsToRender:me,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,segmentationRepresentationUID:G},Zn(ue,O)){const{volumeId:xe}=ue,Ee=j.cache.getVolume(xe);this.editData={...this.editData,volumeId:xe,referencedVolumeId:Ee.referencedVolumeId}}else{const{imageIdReferenceMap:xe}=ue;this.editData={...this.editData,imageIdReferenceMap:xe}}return this._activateDraw(v),Wt(v),u.preventDefault(),We(N,me),!0}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,handleIndex:D}=this.editData,{data:O}=v,{currentPoints:N}=g,R=(0,j.getEnabledElement)(m),{worldToCanvas:L,canvasToWorld:P}=R.viewport,F=N.world,{points:V}=O.handles;let G,W,q,Y,Z,ne,oe,ue;switch(V[D]=[...F],D){case 0:case 3:G=L(V[0]),Y=L(V[3]),W=[Y[0],G[1]],q=[G[0],Y[1]],ne=P(W),oe=P(q),V[1]=ne,V[2]=oe;break;case 1:case 2:W=L(V[1]),q=L(V[2]),G=[q[0],W[1]],Y=[W[0],q[1]],Z=P(G),ue=P(Y),V[0]=Z,V[3]=ue}v.invalidated=!0,this.editData.hasMoved=!0;const{renderingEngine:ge}=R;We(ge,S)}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,newAnnotation:S,hasMoved:D}=this.editData,{data:O}=v;if(S&&!D)return;O.handles.activeHandleIndex=null,this._deactivateDraw(m),rn(m);const N=(0,j.getEnabledElement)(m),R={...this.editData,points:O.handles.points};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(N,R)}),$(this,"_activateDraw",u=>{u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"_deactivateDraw",u=>{u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"renderAnnotation",(u,g)=>{let m=!1;if(!this.editData)return m;const{viewport:v}=u,{annotation:S}=this.editData,D=S.metadata,O=S.annotationUID,N=S.data,{points:R}=N.handles,L=R.map(F=>v.worldToCanvas(F)),P="rgb(".concat(D.segmentColor.slice(0,3),")");return v.getRenderingEngine()?(Vd(g,O,"0",L[0],L[3],{color:P}),m=!0,m):(console.warn("Rendering Engine has been destroyed"),m)})}}$(bw,"toolName",void 0),bw.toolName="RectangleScissor";const jq=bw;class Iw extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:g9,ERASE_INSIDE:v9},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"preMouseDownCallback",u=>{if(this.isDrawing===!0)return;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=m.canvas,O=(0,j.getEnabledElement)(v),{viewport:N,renderingEngine:R}=O;this.isDrawing=!0;const L=N.getCamera(),{viewPlaneNormal:P,viewUp:F}=L,V=this.toolGroupId,G=Ko(V);if(!G)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:W,segmentationId:q,type:Y}=G,Z=vl(q),ne=Ac(q),oe=Es(V,W,Z),{representationData:ue}=dn(q),ge=ue[Y];if(!ge)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const me={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...P],viewUp:[...F],FrameOfReferenceUID:N.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:oe},data:{handles:{points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},xe=[N.id];if(this.editData={annotation:me,centerCanvas:D,segmentIndex:Z,segmentationId:q,segmentsLocked:ne,segmentColor:oe,viewportIdsToRender:xe,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,segmentationRepresentationUID:W},Zn(ge,N)){const{volumeId:Ee}=ge,Ie=j.cache.getVolume(Ee);this.editData={...this.editData,volumeId:Ee,referencedVolumeId:Ie.referencedVolumeId}}else{const{imageIdReferenceMap:Ee}=ge;this.editData={...this.editData,imageIdReferenceMap:Ee}}return this._activateDraw(v),Wt(v),u.preventDefault(),We(R,xe),!0}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{currentPoints:v}=g,S=v.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{canvasToWorld:R}=N,{annotation:L,viewportIdsToRender:P,centerCanvas:F}=this.editData,{data:V}=L,G=Math.abs(S[0]-F[0]),W=Math.abs(S[1]-F[1]),q=Math.sqrt(G*G+W*W),Y=[F[0],F[1]+q],Z=[F[0],F[1]-q],ne=[F[0]-q,F[1]],oe=[F[0]+q,F[1]];V.handles.points=[R(Y),R(Z),R(ne),R(oe)],L.invalidated=!0,this.editData.hasMoved=!0,We(O,P)}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,newAnnotation:S,hasMoved:D}=this.editData,{data:O}=v,{viewPlaneNormal:N,viewUp:R}=v.metadata;if(S&&!D)return;O.handles.activeHandleIndex=null,this._deactivateDraw(m),rn(m);const L=(0,j.getEnabledElement)(m),P={...this.editData,points:O.handles.points,viewPlaneNormal:N,viewUp:R,strategySpecificConfiguration:{}};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(L,P)}),$(this,"_activateDraw",u=>{u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback),u.addEventListener(Q.TOUCH_END,this._endCallback)}),$(this,"_deactivateDraw",u=>{u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{let m=!1;if(!this.editData)return m;const{viewport:v}=u,{viewportIdsToRender:S}=this.editData;if(!S.includes(v.id))return m;const{annotation:D}=this.editData,O=D.metadata,N=D.annotationUID,R=D.data,{points:L}=R.handles,P=L.map(Y=>v.worldToCanvas(Y)),F=P[0],V=P[1],G=[Math.floor((F[0]+V[0])/2),Math.floor((F[1]+V[1])/2)],W=Math.abs(F[1]-Math.floor((F[1]+V[1])/2)),q="rgb(".concat(O.segmentColor.slice(0,3),")");return v.getRenderingEngine()?(_a(g,N,"0",G,W,{color:q}),m=!0,m):(console.warn("Rendering Engine has been destroyed"),m)})}}$(Iw,"toolName",void 0),Iw.toolName="CircleScissor";const Hq=Iw;class Ow extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:p9,ERASE_INSIDE:m9},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"preMouseDownCallback",u=>{if(this.isDrawing===!0)return;const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=m.canvas,O=(0,j.getEnabledElement)(v),{viewport:N,renderingEngine:R}=O;this.isDrawing=!0;const L=N.getCamera(),{viewPlaneNormal:P,viewUp:F}=L,V=this.toolGroupId,G=Ko(V);if(!G)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:W,segmentationId:q}=G,Y=vl(q),Z=Ac(q),ne=Es(V,W,Y);this.isDrawing=!0;const oe={metadata:{viewPlaneNormal:[...P],viewUp:[...F],FrameOfReferenceUID:N.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:ne},data:{invalidated:!0,handles:{points:[[...S],[...S],[...S],[...S]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},ue=[N.id];this.editData={annotation:oe,centerCanvas:D,segmentationRepresentationUID:W,segmentIndex:Y,segmentationId:q,segmentsLocked:Z,segmentColor:ne,toolGroupId:V,viewportIdsToRender:ue,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1};const{representationData:ge}=dn(q),me=ge[Nt.Labelmap];if(Zn(me,N)){const{volumeId:xe}=me,Ee=j.cache.getVolume(xe);this.editData={...this.editData,volumeId:xe,referencedVolumeId:Ee.referencedVolumeId}}else{const{imageIdReferenceMap:xe}=me;this.editData={...this.editData,imageIdReferenceMap:xe}}return this._activateDraw(v),Wt(v),u.preventDefault(),We(R,ue),!0}),$(this,"_dragCallback",u=>{this.isDrawing=!0;const g=u.detail,{element:m}=g,{currentPoints:v}=g,S=v.canvas,D=(0,j.getEnabledElement)(m),{renderingEngine:O,viewport:N}=D,{canvasToWorld:R}=N,{annotation:L,viewportIdsToRender:P,centerCanvas:F}=this.editData,{data:V}=L,G=Math.abs(S[0]-F[0]),W=Math.abs(S[1]-F[1]),q=Math.sqrt(G*G+W*W),Y=[F[0],F[1]+q],Z=[F[0],F[1]-q],ne=[F[0]-q,F[1]],oe=[F[0]+q,F[1]];V.handles.points=[R(Y),R(Z),R(ne),R(oe)],L.invalidated=!0,this.editData.hasMoved=!0,We(O,P)}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,newAnnotation:S,hasMoved:D,segmentIndex:O,segmentationRepresentationUID:N,segmentsLocked:R}=this.editData,{data:L}=v,{viewPlaneNormal:P,viewUp:F}=v.metadata;if(S&&!D)return;v.highlighted=!1,L.handles.activeHandleIndex=null,this._deactivateDraw(m),rn(m);const V=(0,j.getEnabledElement)(m),G={...this.editData,points:L.handles.points,segmentIndex:O,segmentationRepresentationUID:N,segmentsLocked:R,viewPlaneNormal:P,viewUp:F};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(V,G)}),$(this,"_activateDraw",u=>{u.addEventListener(Q.MOUSE_UP,this._endCallback),u.addEventListener(Q.MOUSE_DRAG,this._dragCallback),u.addEventListener(Q.MOUSE_CLICK,this._endCallback),u.addEventListener(Q.MOUSE_MOVE,this._dragCallback),u.addEventListener(Q.TOUCH_END,this._endCallback),u.addEventListener(Q.TOUCH_TAP,this._endCallback),u.addEventListener(Q.TOUCH_DRAG,this._dragCallback)}),$(this,"_deactivateDraw",u=>{u.removeEventListener(Q.MOUSE_UP,this._endCallback),u.removeEventListener(Q.MOUSE_DRAG,this._dragCallback),u.removeEventListener(Q.MOUSE_CLICK,this._endCallback),u.removeEventListener(Q.MOUSE_MOVE,this._dragCallback),u.removeEventListener(Q.TOUCH_END,this._endCallback),u.removeEventListener(Q.TOUCH_DRAG,this._dragCallback),u.removeEventListener(Q.TOUCH_TAP,this._endCallback)}),$(this,"renderAnnotation",(u,g)=>{let m=!1;if(!this.editData)return m;const{viewport:v}=u,{viewportIdsToRender:S}=this.editData;if(!S.includes(v.id))return m;const{annotation:D}=this.editData,O=D.metadata,N=D.annotationUID,R=D.data,{points:L}=R.handles,P=L.map(Y=>v.worldToCanvas(Y)),F=P[0],V=P[1],G=[Math.floor((F[0]+V[0])/2),Math.floor((F[1]+V[1])/2)],W=Math.abs(F[1]-Math.floor((F[1]+V[1])/2)),q="rgb(".concat(O.segmentColor.slice(0,3),")");return v.getRenderingEngine()?(_a(g,N,"0",G,W,{color:q}),m=!0,m):(console.warn("Rendering Engine has been destroyed"),m)})}}$(Ow,"toolName",void 0),Ow.toolName="SphereScissor";const $q=Ow,{transformWorldToIndex:ih}=j.utilities;class Mw extends XD{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{numSlicesToPropagate:10,calculatePointsInsideVolume:!1,getTextLines:Kq,statsCalculator:ti,showTextBox:!1}}),$(this,"touchDragCallback",void 0),$(this,"mouseDragCallback",void 0),$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",!1),$(this,"addNewAnnotation",u=>{const g=u.detail,{currentPoints:m,element:v}=g,S=m.world,D=(0,j.getEnabledElement)(v),{viewport:O,renderingEngine:N}=D;this.isDrawing=!0;const R=O.getCamera(),{viewPlaneNormal:L,viewUp:P}=R;let F,V,G;if(O instanceof j.StackViewport)throw new Error("Stack Viewport Not implemented");{const ue=this.getTargetId(O);G=j.utilities.getVolumeId(ue),V=j.cache.getVolume(G),F=j.utilities.getClosestImageId(V,S,L)}const W=j.utilities.getSpacingInNormalDirection(V,L),q=this._getStartCoordinate(S,W,L),Y=this._getEndCoordinate(S,W,L),Z=O.getFrameOfReferenceUID(),ne={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...L],viewUp:[...P],FrameOfReferenceUID:Z,referencedImageId:F,volumeId:G,spacingInNormal:W,enabledElement:D},data:{label:"",startCoordinate:q,endCoordinate:Y,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...S],[...S]],activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(ne,V),fn(ne,v);const oe=Mt(v,this.getToolName());return this.editData={annotation:ne,viewportIdsToRender:oe,newAnnotation:!0,hasMoved:!1},this._activateDraw(v),Wt(v),u.preventDefault(),We(N,oe),ne}),$(this,"_endCallback",u=>{const g=u.detail,{element:m}=g,{annotation:v,viewportIdsToRender:S,newAnnotation:D,hasMoved:O}=this.editData,{data:N}=v;if(D&&!O)return;v.highlighted=!1,N.handles.activeHandleIndex=null,this._deactivateModify(m),this._deactivateDraw(m),rn(m);const R=(0,j.getEnabledElement)(m);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(v.annotationUID),We(R.renderingEngine,S),D&&sn(v)}),$(this,"renderAnnotation",(u,g)=>{var m;let v=!1;const{viewport:S}=u;let D=an(this.getToolName(),S.element);if((m=D)===null||m===void 0||!m.length)return v;D=o1(D,S.getCamera());const O={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:u.viewport.id};for(let N=0;N<D.length;N++){const R=D[N],{annotationUID:L,data:P}=R,{startCoordinate:F,endCoordinate:V}=P,{points:G,activeHandleIndex:W}=P.handles;O.annotationUID=L;const q=this.getStyle("lineWidth",O,R),Y=this.getStyle("lineDash",O,R),Z=this.getStyle("color",O,R),ne=G.map(Tt=>S.worldToCanvas(Tt)),oe=ne[0],ue=I0(ne),{centerPointRadius:ge}=this.configuration,me=eh(ne),xe=S.getCamera().focalPoint,Ee=S.getCamera().viewPlaneNormal;let Ie=F,be=V;Array.isArray(F)&&(Ie=this._getCoordinateForViewplaneNormal(Ie,Ee),P.startCoordinate=Ie),Array.isArray(V)&&(be=this._getCoordinateForViewplaneNormal(be,Ee),P.endCoordinate=be);const Ne=j.utilities.roundToPrecision(P.startCoordinate),_e=j.utilities.roundToPrecision(P.endCoordinate),Me=this._getCoordinateForViewplaneNormal(xe,Ee),Pe=j.utilities.roundToPrecision(Me);if(Pe<Math.min(Ne,_e)||Pe>Math.max(Ne,_e))continue;const Ze=j.utilities.roundToPrecision((P.startCoordinate+P.endCoordinate)/2);let Ye,at=!1;if(Pe===Ze&&(at=!0),P.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(Ee)]=Ze,R.invalidated&&this._throttledCalculateCachedStats(R,u),!S.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),v;if(!mr(L))continue;cr(R)||this.editData||W===null||!at||(Ye=[ne[W]]),Ye&&Qn(g,L,"0",Ye,{color:Z});let ot=q,st=Y;at?(ot=q,st=[]):st=[5,5];const ct="0";if(_a(g,L,ct,oe,ue,{color:Z,lineDash:st,lineWidth:ot}),ge>0&&ue>3*ge&&_a(g,L,"".concat(ct,"-center"),oe,ge,{color:Z,lineDash:Y,lineWidth:q}),v=!0,this.configuration.showTextBox==1&&this.configuration.calculatePointsInsideVolume==1){const Tt=this.getLinkedTextBoxStyle(O,R);if(!Tt.visibility){P.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const pt=this.configuration.getTextLines(P);if(!pt||pt.length===0)continue;let Ct;P.handles.textBox.hasMoved||(Ct=Ha(me),P.handles.textBox.worldPosition=S.canvasToWorld(Ct));const gt=S.worldToCanvas(P.handles.textBox.worldPosition),Dt=Ki(g,L,"1",pt,gt,ne,{},Tt),{x:en,y:$t,width:mn,height:Cn}=Dt;P.handles.textBox.worldBoundingBox={topLeft:S.canvasToWorld([en,$t]),topRight:S.canvasToWorld([en+mn,$t]),bottomLeft:S.canvasToWorld([en,$t+Cn]),bottomRight:S.canvasToWorld([en+mn,$t+Cn])}}}return v}),this._throttledCalculateCachedStats=$i(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(u,g){const{data:m,metadata:v}=u,{viewPlaneNormal:S,spacingInNormal:D}=v,{imageData:O}=g,{startCoordinate:N,endCoordinate:R}=m,{points:L}=m.handles,P=ih(O,L[0]),F=ih(O,L[0]),V=it()(L),G=le.vec3.create();O.indexToWorldVec3(P,G);const W=le.vec3.create();O.indexToWorldVec3(F,W),this._getIndexOfCoordinatesForViewplaneNormal(S)==2?(G[2]=N,W[2]=R,V[0][2]=N,V[1][2]=N):this._getIndexOfCoordinatesForViewplaneNormal(S)==0?(G[0]=N,W[0]=R,V[0][0]=N,V[1][0]=N):this._getIndexOfCoordinatesForViewplaneNormal(S)==1&&(G[1]=N,W[1]=R,V[0][1]=N,V[1][1]=N);const q=le.vec3.distance(G,W),Y=[];for(let Z=0;Z<q;Z+=D)Y.push(V.map(ne=>{const oe=le.vec3.create();return le.vec3.scaleAndAdd(oe,ne,S,Z),Array.from(oe)}));m.cachedStats.projectionPoints=Y}_computePointsInsideVolume(u,g,m,v){var S,D,O;const{data:N,metadata:R}=u,{viewPlaneNormal:L,viewUp:P}=R,{viewport:F,renderingEngine:V}=v,G=N.cachedStats.projectionPoints,W=[[]],q=this.getTargetIdImage(m,V),Y=N.handles.points.map(Me=>F.worldToCanvas(Me)),[Z,ne]=eh(Y),oe=F.canvasToWorld(Z),ue=F.canvasToWorld(ne),{worldWidth:ge,worldHeight:me}=I1(L,P,oe,ue),xe=za(q,N.handles),Ee=D5(q),Ie=Math.abs(Math.PI*(ge/xe.scale/2)*(me/Ee/xe.scale/2)),be={isPreScaled:qo(F,m),isSuvScaled:this.isSuvScaled(F,m,u.metadata.referencedImageId)},Ne=Pc(R.Modality,u.metadata.referencedImageId,be);for(let Me=0;Me<G.length;Me++){if(!g)continue;const Pe=G[Me][0],Ze=G[Me].map(mn=>F.worldToCanvas(mn)),[Ye,at]=eh(Ze),ot=F.canvasToWorld(Ye),st=F.canvasToWorld(at),ct=ot,Tt=st,{dimensions:pt,imageData:Ct}=g,gt=ih(Ct,ct),Dt=ih(Ct,Pe),en=this._getIndexOfCoordinatesForViewplaneNormal(L);gt[0]=Math.floor(gt[0]),gt[1]=Math.floor(gt[1]),gt[2]=Math.floor(gt[2]),gt[en]=Dt[en];const $t=ih(Ct,Tt);if($t[0]=Math.floor($t[0]),$t[1]=Math.floor($t[1]),$t[2]=Math.floor($t[2]),$t[en]=Dt[en],this._isInsideVolume(gt,$t,pt)){const mn=[[Math.min(gt[0],$t[0]),Math.max(gt[0],$t[0])],[Math.min(gt[1],$t[1]),Math.max(gt[1],$t[1])],[Math.min(gt[2],$t[2]),Math.max(gt[2],$t[2])]],Cn={center:Pe,xRadius:Math.abs(ot[0]-st[0])/2,yRadius:Math.abs(ot[1]-st[1])/2,zRadius:Math.abs(ot[2]-st[2])/2},br=Ii(Ct,ci=>t1(Cn,ci),this.configuration.statsCalculator.statsCallback,mn);W.push(br)}}const _e=this.configuration.statsCalculator.getStatistics();N.cachedStats.pointsInVolume=W,N.cachedStats.statistics={Modality:R.Modality,area:Ie,mean:(S=_e.mean)===null||S===void 0?void 0:S.value,stdDev:(D=_e.stdDev)===null||D===void 0?void 0:D.value,max:(O=_e.max)===null||O===void 0?void 0:O.value,statsArray:_e.array,areaUnit:xe.areaUnits,modalityUnit:Ne}}_calculateCachedStatsTool(u,g){const m=u.data,{viewport:v}=g,{cachedStats:S}=m,D=this.getTargetId(v),O=j.cache.getVolume(D.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(u,O),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(u,O,D,g),u.invalidated=!1,Yt(u,v.element),S}_getStartCoordinate(u,g,m){const v=this.configuration.numSlicesToPropagate,S=Math.round(v/2),D=le.vec3.create();return le.vec3.scaleAndAdd(D,u,m,S*-g),this._getCoordinateForViewplaneNormal(D,m)}_getEndCoordinate(u,g,m){const v=this.configuration.numSlicesToPropagate,S=v-Math.round(v/2),D=le.vec3.create();return le.vec3.scaleAndAdd(D,u,m,S*g),this._getCoordinateForViewplaneNormal(D,m)}_getIndexOfCoordinatesForViewplaneNormal(u){const g=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];return g.indexOf(Math.max(...g))}_getCoordinateForViewplaneNormal(u,g){return u[this._getIndexOfCoordinatesForViewplaneNormal(g)]}}function Kq(E){const u=E.cachedStats.statistics,{area:g,mean:m,max:v,stdDev:S,areaUnit:D,modalityUnit:O}=u;if(m===void 0)return;const N=[];return N.push("Area: ".concat(cn(g)," ").concat(D)),N.push("Mean: ".concat(cn(m)," ").concat(O)),N.push("Max: ".concat(cn(v)," ").concat(O)),N.push("Std Dev: ".concat(cn(S)," ").concat(O)),N}$(Mw,"toolName",void 0),Mw.toolName="CircleROIStartEndThreshold";const qq=Mw;var Xq=I(518),sb=I.n(Xq),Yq=I(744),lb=I.n(Yq),Jq=I(424),Zq=I.n(Jq),Qq=I(614),eX=I.n(Qq);const cb={ANNOTATED_CUBE:1,AXES:2,CUSTOM:3};class Ka extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{configuration:{orientationWidget:{enabled:!0,viewportCorner:sb().Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:Ka.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[Ka.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:u=>u/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[Ka.OVERLAY_MARKER_TYPES.AXES]:{},[Ka.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}),$(this,"orientationMarkers",void 0),$(this,"polyDataURL",void 0),$(this,"_resizeObservers",new Map),$(this,"onSetToolEnabled",()=>{this.initViewports(),this._subscribeToViewportEvents()}),$(this,"onSetToolActive",()=>{this.initViewports(),this._subscribeToViewportEvents()}),$(this,"onSetToolDisabled",()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()}),$(this,"_getViewportsInfo",()=>qn(this.toolGroupId).viewportsInfo),$(this,"resize",u=>{const g=this.orientationMarkers[u];if(!g)return;const{orientationWidget:m}=g;m.updateViewport()}),this.orientationMarkers={}}_unsubscribeToViewportNewVolumeSet(){const u=()=>{this._getViewportsInfo().forEach(g=>{let{viewportId:m,renderingEngineId:v}=g;const{viewport:S}=(0,j.getEnabledElementByIds)(m,v),{element:D}=S;D.removeEventListener(j.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this)),this._resizeObservers.get(m).unobserve(D)})};j.eventTarget.removeEventListener(Q.TOOLGROUP_VIEWPORT_ADDED,g=>{g.detail.toolGroupId===this.toolGroupId&&(u(),this.initViewports())})}_subscribeToViewportEvents(){const u=()=>{this._getViewportsInfo().forEach(g=>{let{viewportId:m,renderingEngineId:v}=g;const{viewport:S}=(0,j.getEnabledElementByIds)(m,v),{element:D}=S;this.initViewports(),D.addEventListener(j.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const O=new ResizeObserver(()=>{setTimeout(()=>{const N=(0,j.getEnabledElementByIds)(m,v);if(!N)return;const{viewport:R}=N;this.resize(m),R.render()},100)});O.observe(D),this._resizeObservers.set(m,O)})};u(),j.eventTarget.addEventListener(Q.TOOLGROUP_VIEWPORT_ADDED,g=>{g.detail.toolGroupId===this.toolGroupId&&(u(),this.initViewports())})}cleanUpData(){(0,j.getRenderingEngines)()[0].getViewports().forEach(u=>{const g=this.orientationMarkers[u.id];if(!g)return;const{actor:m,orientationWidget:v}=g;v==null||v.setEnabled(!1),v==null||v.delete(),m==null||m.delete(),u.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow().render(),u.getRenderingEngine().render(),delete this.orientationMarkers[u.id]})}initViewports(){const u=(0,j.getRenderingEngines)()[0];if(!u)return;let g=u.getViewports();g=Xp(g,this.getToolName()),g.forEach(m=>{m.getWidget(this.getToolName())||this.addAxisActorInViewport(m)})}async addAxisActorInViewport(u){const g=u.id,m=this.configuration.overlayMarkerType,v=this.configuration.overlayConfiguration[m];if(this.orientationMarkers[g]){const{actor:G,orientationWidget:W}=this.orientationMarkers[g];u.getRenderer().removeActor(G),W.setEnabled(!1)}let S;m===1?S=this.createAnnotationCube(v):m===2?S=Zq().newInstance():m===3&&(S=await this.createCustomActor());const D=u.getRenderer(),O=u.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow(),{enabled:N,viewportCorner:R,viewportSize:L,minPixelSize:P,maxPixelSize:F}=this.configuration.orientationWidget,V=sb().newInstance({actor:S,interactor:O.getInteractor(),parentRenderer:D});V.setEnabled(N),V.setViewportCorner(R),V.setViewportSize(L),V.setMinPixelSize(P),V.setMaxPixelSize(F),V.updateMarkerOrientation(),this.orientationMarkers[g]={orientationWidget:V,actor:S},u.addWidget(this.getToolName(),V),O.render(),u.getRenderingEngine().render()}async createCustomActor(){const u=this.configuration.overlayConfiguration[cb.CUSTOM].polyDataURL,g=await fetch(u),m=await g.arrayBuffer(),v=eX().newInstance();v.parseAsArrayBuffer(m),v.update();const S=c5().newInstance();S.shallowCopy(v.getOutputData()),S.getPointData().setActiveScalars("Color");const D=j6().newInstance();D.setInputData(S),D.setColorModeToDirectScalars();const O=H6().newInstance();return O.setMapper(D),O.rotateZ(180),O}createAnnotationCube(u){const g=lb().newInstance();return g.setDefaultStyle({...u.defaultStyle}),g.setXPlusFaceProperty({...u.faceProperties.xPlus}),g.setXMinusFaceProperty({...u.faceProperties.xMinus}),g.setYPlusFaceProperty({...u.faceProperties.yPlus}),g.setYMinusFaceProperty({...u.faceProperties.yMinus}),g.setZPlusFaceProperty({...u.faceProperties.zPlus}),g.setZMinusFaceProperty({...u.faceProperties.zMinus}),g}async createAnnotatedCubeActor(){const u=lb().newInstance(),{faceProperties:g,defaultStyle:m}=this.configuration.annotatedCube;return u.setDefaultStyle(m),Object.keys(g).forEach(v=>{const S="set".concat(v.charAt(0).toUpperCase()+v.slice(1),"FaceProperty");u[S](g[v])}),u}}$(Ka,"toolName",void 0),$(Ka,"CUBE",1),$(Ka,"AXIS",2),$(Ka,"VTPFILE",3),$(Ka,"OVERLAY_MARKER_TYPES",cb),Ka.toolName="OrientationMarker";const tX=Ka;class Kc extends kr{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:Kc.SelectMode.Border,searchRadius:6}}),$(this,"hoverTimer",void 0),$(this,"mouseMoveCallback",u=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(u),this.hoverTimer=null},this.configuration.hoverTimeout),!0)),$(this,"onSetToolEnabled",()=>{this.onSetToolActive()}),$(this,"onSetToolActive",()=>{this.hoverTimer=null}),$(this,"onSetToolDisabled",()=>{this.hoverTimer=null}),this.hoverTimer=null}_setActiveSegment(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ke.isInteractingWithTool)return;const{element:g,currentPoints:m}=u.detail,v=m.world,S=(0,j.getEnabledElement)(g);if(!S)return;const{viewport:D}=S,O=Ko(this.toolGroupId);O&&([Nt.Labelmap,Nt.Contour].includes(O.type)?this._setActiveSegmentForType(O,v,D):console.warn("SegmentSelectTool does not support the current segmentation type."))}_setActiveSegmentForType(u,g,m){if(!m.getImageData())return;const{segmentationId:v,type:S}=u;let D;if(this.configuration.mode===Kc.SelectMode.Inside)D=H9(v,g,{viewport:m});else switch(S){case Nt.Labelmap:D=$9(v,g,{viewport:m,searchRadius:this.configuration.searchRadius});break;case Nt.Contour:D=q9(v)}if(!D||D===0)return;T9(v,D);const O=m.getRenderingEngine(),N=O.getViewports().map(R=>R.id);Ta(v),We(O,N)}}$(Kc,"toolName",void 0),$(Kc,"SelectMode",{Inside:"Inside",Border:"Border"}),Kc.toolName="SegmentSelectTool";const nX=Kc,{transformWorldToIndex:ub,isEqual:Nw}=j.utilities;class Rw extends kr{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]}),u=this,$(this,"preMouseDownCallback",g=>{const m=g.detail,{currentPoints:v,element:S}=m,D=v.world,O=(0,j.getEnabledElement)(S),{viewport:N}=O,R=N.getCamera(),{viewPlaneNormal:L}=R,P=Ko(this.toolGroupId);if(!P)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:F,type:V}=P,G=vl(F),W=Ac(F),{representationData:q}=dn(F),Y=q[Nt.Labelmap];let Z,ne,oe,ue;if(Zn(Y,N)){const{volumeId:Pe}=q[V],Ze=j.cache.getVolume(Pe);({dimensions:Z,direction:ne}=Ze),oe=Ze.getScalarData(),ue=ub(Ze.imageData,D)}else{const{imageIdReferenceMap:Pe}=Y,Ze=O.viewport.getCurrentImageId(),Ye=Pe.get(Ze);if(!Ye)throw new Error("No active segmentation imageId detected, create one before using scissors tool");oe=j.cache.getImage(Ye).getPixelData();const{imageData:ot}=N.getImageData();Z=ot.getDimensions(),ne=ot.getDirection(),ue=ub(ot,D)}const ge=this.getFixedDimension(L,ne);if(ge===void 0)return void console.warn("Oblique paint fill not yet supported");const{floodFillGetter:me,getLabelValue:xe,getScalarDataPositionFromPlane:Ee,inPlaneSeedPoint:Ie,fixedDimensionValue:be}=this.generateHelpers(oe,Z,ue,ge);if(ue[0]<0||ue[0]>=Z[0]||ue[1]<0||ue[1]>=Z[1]||ue[2]<0||ue[2]>=Z[2])return;const Ne=xe(ue[0],ue[1],ue[2]);if(W.includes(Ne))return;const _e=e1(me,Ie),{flooded:Me}=_e;return Me.forEach(Pe=>{const Ze=Ee(Pe[0],Pe[1]);oe[Ze]=G}),pi(F,this.getFramesModified(ge,be,_e)),!0}),$(this,"getFramesModified",(g,m,v)=>{const{boundaries:S}=v;if(g===2)return[m];let D=1/0,O=-1/0;for(let R=0;R<S.length;R++){const L=S[R][1];L<D&&(D=L),L>O&&(O=L)}const N=[];for(let R=D;R<=O;R++)N.push(R);return N}),$(this,"generateHelpers",function(g,m,v){let S,D,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:2;switch(O){case 0:S=v[0],D=[v[1],v[2]];break;case 1:S=v[1],D=[v[0],v[2]];break;case 2:S=v[2],D=[v[0],v[1]];break;default:throw new Error("Invalid fixedDimension: ".concat(O))}const N=(P,F,V)=>V*m[1]*m[0]+F*m[0]+P,R=(P,F,V)=>g[N(P,F,V)],L=u.generateFloodFillGetter(m,O,S,R);return{getScalarDataPositionFromPlane:u.generateGetScalarDataPositionFromPlane(N,O,S),getLabelValue:R,floodFillGetter:L,inPlaneSeedPoint:D,fixedDimensionValue:S}}),$(this,"generateFloodFillGetter",(g,m,v,S)=>{let D;switch(m){case 0:D=(O,N)=>{if(!(O>=g[1]||O<0||N>=g[2]||N<0))return S(v,O,N)};break;case 1:D=(O,N)=>{if(!(O>=g[0]||O<0||N>=g[2]||N<0))return S(O,v,N)};break;case 2:D=(O,N)=>{if(!(O>=g[0]||O<0||N>=g[1]||N<0))return S(O,N,v)};break;default:throw new Error("Invalid fixedDimension: ".concat(m))}return D}),$(this,"generateGetScalarDataPositionFromPlane",(g,m,v)=>{let S;switch(m){case 0:S=(D,O)=>g(v,D,O);break;case 1:S=(D,O)=>g(D,v,O);break;case 2:S=(D,O)=>g(D,O,v);break;default:throw new Error("Invalid fixedDimension: ".concat(m))}return S})}getFixedDimension(u,g){const m=g.slice(0,3),v=g.slice(3,6),S=g.slice(6,9),D=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])],O=[Math.abs(m[0]),Math.abs(m[1]),Math.abs(m[2])];if(Nw(D,O))return 0;const N=[Math.abs(v[0]),Math.abs(v[1]),Math.abs(v[2])];if(Nw(D,N))return 1;const R=[Math.abs(S[0]),Math.abs(S[1]),Math.abs(S[2])];return Nw(D,R)?2:void 0}}$(Rw,"toolName",void 0),Rw.toolName="PaintFill";const rX=Rw;class fb extends ei{constructor(){var u;super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),u=this,$(this,"_throttledCalculateCachedStats",void 0),$(this,"editData",void 0),$(this,"_configuration",void 0),$(this,"isDrawing",void 0),$(this,"isHandleOutsideImage",void 0),$(this,"addNewAnnotation",g=>{const m=g.detail,{currentPoints:v,element:S}=m,D=v.world,O=(0,j.getEnabledElement)(S),{viewport:N,renderingEngine:R}=O;this.isDrawing=!0;const L=N.getCamera(),{viewPlaneNormal:P,viewUp:F}=L,V=this.getReferencedImageId(N,D,P,F),G={metadata:{viewPlaneNormal:[0,0,1],viewUp:[0,1,0],FrameOfReferenceUID:N.getFrameOfReferenceUID(),referencedImageId:V,toolName:this.getToolName()},data:{invalidated:!0,handles:{points:[[...D],[...D],[...D],[...D]],activeHandleIndex:null},cachedStats:{},active:!0}};fn(G,S);const W=Mt(S,this.getToolName(),!1);return this.editData={annotation:G,viewportUIDsToRender:W,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(S),Wt(S),g.preventDefault(),We(R,W),G}),$(this,"getHandleNearImagePoint",(g,m,v,S)=>{const D=(0,j.getEnabledElement)(g),{viewport:O}=D,{data:N}=m,{points:R}=N.handles;for(let L=0;L<R.length;L++){const P=R[L],F=O.worldToCanvas(P);if(le.vec2.distance(v,F)<S)return N.handles.activeHandleIndex=L,P}N.handles.activeHandleIndex=null}),$(this,"isPointNearTool",(g,m,v,S)=>{const D=(0,j.getEnabledElement)(g),{viewport:O}=D,{data:N}=m,{points:R}=N.handles,L=O.worldToCanvas(R[0]),P=O.worldToCanvas(R[3]),F=this._getRectangleImageCoordinates([L,P]),V=[v[0],v[1]],{left:G,top:W,width:q,height:Y}=F;if(n3([G,W,q,Y],V)<=S)return!0}),$(this,"toolSelectedCallback",function(g,m){const v=g.detail,{element:S}=v,{data:D}=m;D.active=!0;const O=Mt(S,u.getToolName(),!1);u.editData={annotation:m,viewportUIDsToRender:O},u._activateModify(S),Wt(S);const N=(0,j.getEnabledElement)(S),{renderingEngine:R}=N;We(R,O),g.preventDefault()}),$(this,"handleSelectedCallback",function(g,m,v){const S=g.detail,{element:D}=S,{data:O}=m;O.active=!0;let N;v.worldPosition||(N=O.handles.points.findIndex(F=>F===v));const R=Mt(D,u.getToolName(),!1);u.editData={annotation:m,viewportUIDsToRender:R,handleIndex:N},u._activateModify(D),Wt(D);const L=(0,j.getEnabledElement)(D),{renderingEngine:P}=L;We(P,R),g.preventDefault()}),$(this,"_mouseUpCallback",g=>{const m=g.detail,{element:v}=m,{annotation:S,viewportUIDsToRender:D,newAnnotation:O,hasMoved:N}=this.editData,{data:R}=S;if(O&&!N)return;R.active=!1,R.handles.activeHandleIndex=null,this._deactivateModify(v),this._deactivateDraw(v),rn(v);const L=(0,j.getEnabledElement)(v),{renderingEngine:P}=L;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&Ht(S.annotationUID),We(P,D)}),$(this,"_mouseDragCallback",g=>{this.isDrawing=!0;const m=g.detail,{element:v}=m,{annotation:S,viewportUIDsToRender:D,handleIndex:O}=this.editData,{data:N}=S;if(O===void 0){const{deltaPoints:P}=m,F=P.world,{points:V}=N.handles;V.forEach(G=>{G[0]+=F[0],G[1]+=F[1],G[2]+=F[2]}),N.invalidated=!0}else{const{currentPoints:P}=m,F=(0,j.getEnabledElement)(v),{worldToCanvas:V,canvasToWorld:G}=F.viewport,W=P.world,{points:q}=N.handles;let Y,Z,ne,oe,ue,ge,me,xe;switch(q[O]=[...W],O){case 0:case 3:Y=V(q[0]),oe=V(q[3]),Z=[oe[0],Y[1]],ne=[Y[0],oe[1]],ge=G(Z),me=G(ne),q[1]=ge,q[2]=me;break;case 1:case 2:Z=V(q[1]),ne=V(q[2]),Y=[ne[0],Z[1]],oe=[Z[0],ne[1]],ue=G(Y),xe=G(oe),q[0]=ue,q[3]=xe}N.invalidated=!0}this.editData.hasMoved=!0;const R=(0,j.getEnabledElement)(v),{renderingEngine:L}=R;We(L,D)}),$(this,"_activateDraw",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.addEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),g.addEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.addEventListener(Q.TOUCH_END,this._mouseUpCallback),g.addEventListener(Q.TOUCH_DRAG,this._mouseDragCallback)}),$(this,"_deactivateDraw",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.removeEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_MOVE,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.removeEventListener(Q.TOUCH_END,this._mouseUpCallback),g.removeEventListener(Q.TOUCH_DRAG,this._mouseDragCallback)}),$(this,"_activateModify",g=>{Ke.isInteractingWithTool=!0,g.addEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.addEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.addEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.addEventListener(Q.TOUCH_END,this._mouseUpCallback),g.addEventListener(Q.TOUCH_DRAG,this._mouseDragCallback)}),$(this,"_deactivateModify",g=>{Ke.isInteractingWithTool=!1,g.removeEventListener(Q.MOUSE_UP,this._mouseUpCallback),g.removeEventListener(Q.MOUSE_DRAG,this._mouseDragCallback),g.removeEventListener(Q.MOUSE_CLICK,this._mouseUpCallback),g.removeEventListener(Q.TOUCH_END,this._mouseUpCallback),g.removeEventListener(Q.TOUCH_DRAG,this._mouseDragCallback)}),$(this,"renderAnnotation",(g,m)=>{var v,S;const{viewport:O}=g,{element:N}=O;let R=an(this.getToolName(),N);if((v=R)===null||v===void 0||!v.length||(R=this.filterInteractableAnnotationsForElement(N,R),(S=R)===null||S===void 0||!S.length))return!1;this.getTargetId(O),O.getRenderingEngine();const L={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:g.viewport.id};for(let P=0;P<R.length;P++){const F=R[P],{annotationUID:V}=F,G=(F.metadata,F.data),{points:W,activeHandleIndex:q}=G.handles,Y=W.map(ge=>O.worldToCanvas(ge)),Z=this.getStyle("lineWidth",L,F),ne=this.getStyle("lineDash",L,F),oe=this.getStyle("color",L,F);if(!O.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");let ue;this.editData||q===null||(ue=[Y[q]]),ue&&Qn(m,V,"0",ue,{color:oe}),VD(m,V,"0",Y[0],Y[3],{color:"black",lineDash:ne,lineWidth:Z})}}),$(this,"_getRectangleImageCoordinates",g=>{const[m,v]=g;return{left:Math.min(m[0],v[0]),top:Math.min(m[1],v[1]),width:Math.abs(m[0]-v[0]),height:Math.abs(m[1]-v[1])}}),$(this,"_calculateCachedStats",(g,m,v,S,D)=>{const{data:O}=g,{viewportUID:N,renderingEngineUID:R,sceneUID:L}=D,P=O.handles.points[0],F=O.handles.points[3],{cachedStats:V}=O,G=Object.keys(V);for(let Y=0;Y<G.length;Y++){const Z=G[Y],{imageVolume:ne}=this._getImageVolumeFromTargetUID(Z,S),{dimensions:oe,scalarData:ue,vtkImageData:ge,metadata:me}=ne,xe=le.vec3.fromValues(0,0,0),Ee=le.vec3.fromValues(0,0,0);if(ge.worldToIndexVec3(P,xe),xe[0]=Math.floor(xe[0]),xe[1]=Math.floor(xe[1]),xe[2]=Math.floor(xe[2]),ge.worldToIndexVec3(F,Ee),Ee[0]=Math.floor(Ee[0]),Ee[1]=Math.floor(Ee[1]),Ee[2]=Math.floor(Ee[2]),this._isInsideVolume(xe,Ee,oe)){this.isHandleOutsideImage=!1;const Ie=Math.min(xe[0],Ee[0]),be=Math.max(xe[0],Ee[0]),Ne=Math.min(xe[1],Ee[1]),_e=Math.max(xe[1],Ee[1]),Me=Math.min(xe[2],Ee[2]),Pe=Math.max(xe[2],Ee[2]),{worldWidth:Ze,worldHeight:Ye}=I1(m,v,P,F),at=Ze*Ye;let ot=0,st=0,ct=0;const Tt=oe[0],pt=oe[0]*oe[1];for(let Ct=Me;Ct<=Pe;Ct++)for(let gt=Ne;gt<=_e;gt++)for(let Dt=Ie;Dt<=be;Dt++)ot++,st+=ue[Ct*pt+gt*Tt+Dt];st/=ot;for(let Ct=Me;Ct<=Pe;Ct++)for(let gt=Ne;gt<=_e;gt++)for(let Dt=Ie;Dt<=be;Dt++){const en=ue[Ct*pt+gt*Tt+Dt]-st;ct+=en*en}ct/=ot,ct=Math.sqrt(ct),V[Z]={Modality:me.Modality,area:at,mean:st,stdDev:ct}}else this.isHandleOutsideImage=!0,V[Z]={Modality:me.Modality}}O.invalidated=!1;const W=Q.ANNOTATION_MODIFIED,q={annotation:g,viewportUID:N,renderingEngineUID:R,sceneUID:L};return(0,j.triggerEvent)(j.eventTarget,W,q),V}),$(this,"_isInsideVolume",(g,m,v)=>j.utilities.indexWithinDimensions(g,v)&&j.utilities.indexWithinDimensions(m,v)),$(this,"_getTargetVolumeUID",g=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const m=g.getVolumeActors();return m||m.length?m[0].uid:void 0}),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}cancel(u){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(u),this._deactivateModify(u),rn(u);const{annotation:g,viewportUIDsToRender:m}=this.editData,{data:v}=g;v.active=!1,v.handles.activeHandleIndex=null;const S=(0,j.getEnabledElement)(u),{renderingEngine:D}=S;return We(D,m),this.editData=null,g.metadata.annotationUID}_getImageVolumeFromTargetUID(u,g){let m;if(u.startsWith("stackTarget")){const v=u.indexOf(":"),S=u.substring(v+1);m=g.getViewport(S).getImageData()}else m=j.cache.getVolume(u);return{imageVolume:m,viewport:void 0}}_getTargetStackUID(u){return"stackTarget:".concat(u.uid)}}fb.toolName="VideoRedaction";const iX=fb})(),A})())})(SG);var Xn=SG.exports;const{windowLevel:k3e}=o8;function P3e(t,e,n,r){const{numBitsPerVoxel:i,littleEndian:a,pixDims:o,dims:s}=t;let l=1/0,c=-1/0;const d=s[1]*s[2],f=Math.floor(s[3]/2),h=d*f;for(let y=h;y<h+d;y++){const w=n[y];w>c&&(c=w),w<l&&(l=w)}const{windowWidth:p,windowCenter:C}=k3e.toWindowLevel(l,c),x=zt(),T=zt(),_=zt();return Dn(x,e[0],e[1],e[2]),Dn(T,e[3],e[4],e[5]),Dn(_,e[6],e[7],e[8]),{volumeMetadata:{BitsAllocated:i,BitsStored:i,SamplesPerPixel:1,HighBit:a?i-1:1,PhotometricInterpretation:"MONOCHROME2",PixelRepresentation:r,ImageOrientationPatient:[x[0],x[1],x[2],T[0],T[1],T[2]],PixelSpacing:[o[1],o[2]],Columns:s[1],Rows:s[2],voiLut:[{windowCenter:C,windowWidth:p}],FrameOfReferenceUID:"1.2.3",Modality:"MR",VOILUTFunction:"LINEAR"},dimensions:[s[1],s[2],s[3]],direction:new Float32Array([x[0],x[1],x[2],T[0],T[1],T[2],_[0],_[1],_[2]])}}const F3e=2,V3e=4,U3e=8,B3e=16,G3e=256,z3e=512,W3e=768,{createFloat32SharedArray:j3e,createInt16SharedArray:VM,createUint8SharedArray:H3e,createUint16SharedArray:$3e}=o8;function K3e(t,e){const{datatypeCode:n,scl_slope:r,scl_inter:i}=t;let a=r,o=i;(!r||r===0||Number.isNaN(r))&&(a=1),(!i||Number.isNaN(i))&&(o=0);const s=o<0||a<0,l=o%1!==0||a%1!==0;let c,d,f=1;switch(n){case F3e:c=new Uint8Array(e),l?d=Xa("Float32Array",c):s?d=Xa("Int16Array",c):(f=0,d=Xa("Uint8Array",c));break;case V3e:c=new Int16Array(e),l?d=Xa("Float32Array",c):d=Xa("Int16Array",c);break;case U3e:c=new Int32Array(e),d=Xa("Float32Array",c);break;case B3e:{c=new Float32Array(e),d=Xa("Float32Array",c);break}case G3e:c=new Int8Array(e),l?d=Xa("Float32Array",c):d=Xa("Int8Array",c);break;case z3e:c=new Uint16Array(e),l||s?d=Xa("Float32Array",c):(f=0,d=Xa("Uint16Array",c));break;case W3e:c=new Uint32Array(e),d=Xa("Float32Array",c);break;default:throw new Error(`NIFTI datatypeCode ${n} is not yet supported`)}const h=d.length;if(a!==1&&o!==0)for(let p=0;p<h;p++)d[p]=q3e(d[p],a,o);return t.numBitsPerVoxel=d.byteLength/d.length*8,{scalarData:d,pixelRepresentation:f}}function q3e(t,e,n){return t*e+n}function Th(t,e){const n=t/8*e;if(!bt.isCacheable(n))throw new Error(xt.CACHE_SIZE_EXCEEDED);return bt.decacheIfNecessaryUntilBytesAvailable(n),n}function Xa(t,e){let n,r;const i=$u(),a=e.length;switch(t){case"Float32Array":n=32,Th(n,a),r=i?j3e(a):new Float32Array(a);break;case"Int16Array":n=16,Th(n,a),r=i?VM(a):new Int16Array(a);break;case"Int8Array":n=8,Th(n,a),r=i?VM(a):new Int16Array(a);break;case"Uint16Array":n=16,Th(n,a),r=i?$3e(a):new Uint16Array(a);break;case"Uint8Array":n=8,Th(n,a),r=i?H3e(a):new Uint8Array(a);break;default:throw new Error(`TypedArray ${t} is not yet supported`)}return r.set(e),r}var j0={};const X3e=Yr(q5e);var jf={},Uu={},_p={};Object.defineProperty(_p,"__esModule",{value:!0});_p.NIFTIEXTENSION=void 0;class Y3e{constructor(e,n,r,i){He(this,"esize");He(this,"ecode");He(this,"edata");He(this,"littleEndian");if(e%16!=0)throw new Error("This does not appear to be a NIFTI extension");this.esize=e,this.ecode=n,this.edata=r,this.littleEndian=i}toArrayBuffer(){let e=new Uint8Array(this.esize),n=new Uint8Array(this.edata);e.set(n,8);let r=new DataView(e.buffer);return r.setInt32(0,this.esize,this.littleEndian),r.setInt32(4,this.ecode,this.littleEndian),e.buffer}}_p.NIFTIEXTENSION=Y3e;Object.defineProperty(Uu,"__esModule",{value:!0});Uu.Utils=void 0;const J3e=_p,Ai=class Ai{static getStringAt(e,n,r){var i="",a,o;for(a=n;a<r;a+=1)o=e.getUint8(a),o!==0&&(i+=String.fromCharCode(o));return i}static getIntAt(e,n,r){return e.getInt32(n,r)}static getFloatAt(e,n,r){return e.getFloat32(n,r)}static getDoubleAt(e,n,r){return e.getFloat64(n,r)}static getLongAt(e,n,r){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=Ai.getByteAt(e,n+i);for(i=a.length-1;i>=0;i--)o=o*256+a[i];return o}static getExtensionsAt(e,n,r,i){let a=[],o=n;for(;o<i;){let s=r,l=Ai.getIntAt(e,o,r);if(!l)break;if(l+o>i&&(s=!s,l=Ai.getIntAt(e,o,s),l+o>i))throw new Error("This does not appear to be a valid NIFTI extension");if(l%16!=0)throw new Error("This does not appear to be a NIFTI extension");let c=Ai.getIntAt(e,o+4,s),d=e.buffer.slice(o+8,o+l);console.log("extensionByteIndex: "+(o+8)+" esize: "+l),console.log(d);let f=new J3e.NIFTIEXTENSION(l,c,d,s);a.push(f),o+=l}return a}static toArrayBuffer(e){var n,r,i;for(n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0;i<e.length;i+=1)r[i]=e[i];return n}static isString(e){return typeof e=="string"||e instanceof String}static formatNumber(e,n=void 0){let r;return Ai.isString(e)?r=Number(e):r=e,n?r=r.toPrecision(5):r=r.toPrecision(7),parseFloat(r)}static makeCRCTable(){let e,n=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;n[r]=e}return n}static crc32(e){Ai.crcTable||(Ai.crcTable=Ai.makeCRCTable());const n=Ai.crcTable;let r=-1;for(var i=0;i<e.byteLength;i++)r=r>>>8^n[(r^e.getUint8(i))&255];return(r^-1)>>>0}};He(Ai,"crcTable",null),He(Ai,"GUNZIP_MAGIC_COOKIE1",31),He(Ai,"GUNZIP_MAGIC_COOKIE2",139),He(Ai,"getByteAt",function(e,n){return e.getInt8(n)}),He(Ai,"getShortAt",function(e,n,r){return e.getInt16(n,r)});let Qx=Ai;Uu.Utils=Qx;Object.defineProperty(jf,"__esModule",{value:!0});jf.NIFTI1=void 0;const gn=Uu,Et=class Et{constructor(){He(this,"littleEndian",!1);He(this,"dim_info",0);He(this,"dims",[]);He(this,"intent_p1",0);He(this,"intent_p2",0);He(this,"intent_p3",0);He(this,"intent_code",0);He(this,"datatypeCode",0);He(this,"numBitsPerVoxel",0);He(this,"slice_start",0);He(this,"slice_end",0);He(this,"slice_code",0);He(this,"pixDims",[]);He(this,"vox_offset",0);He(this,"scl_slope",1);He(this,"scl_inter",0);He(this,"xyzt_units",0);He(this,"cal_max",0);He(this,"cal_min",0);He(this,"slice_duration",0);He(this,"toffset",0);He(this,"description","");He(this,"aux_file","");He(this,"intent_name","");He(this,"qform_code",0);He(this,"sform_code",0);He(this,"quatern_a",0);He(this,"quatern_b",0);He(this,"quatern_c",0);He(this,"quatern_d",0);He(this,"qoffset_x",0);He(this,"qoffset_y",0);He(this,"qoffset_z",0);He(this,"affine",[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]);He(this,"qfac",1);He(this,"quatern_R");He(this,"magic","0");He(this,"isHDR",!1);He(this,"extensionFlag",[0,0,0,0]);He(this,"extensionSize",0);He(this,"extensionCode",0);He(this,"extensions",[]);He(this,"getDatatypeCodeString",function(e){return e===Et.TYPE_UINT8?"1-Byte Unsigned Integer":e===Et.TYPE_INT16?"2-Byte Signed Integer":e===Et.TYPE_INT32?"4-Byte Signed Integer":e===Et.TYPE_FLOAT32?"4-Byte Float":e===Et.TYPE_FLOAT64?"8-Byte Float":e===Et.TYPE_RGB24?"RGB":e===Et.TYPE_INT8?"1-Byte Signed Integer":e===Et.TYPE_UINT16?"2-Byte Unsigned Integer":e===Et.TYPE_UINT32?"4-Byte Unsigned Integer":e===Et.TYPE_INT64?"8-Byte Signed Integer":e===Et.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"});He(this,"getTransformCodeString",function(e){return e===Et.XFORM_SCANNER_ANAT?"Scanner":e===Et.XFORM_ALIGNED_ANAT?"Aligned":e===Et.XFORM_TALAIRACH?"Talairach":e===Et.XFORM_MNI_152?"MNI":"Unknown"});He(this,"getUnitsCodeString",function(e){return e===Et.UNITS_METER?"Meters":e===Et.UNITS_MM?"Millimeters":e===Et.UNITS_MICRON?"Microns":e===Et.UNITS_SEC?"Seconds":e===Et.UNITS_MSEC?"Milliseconds":e===Et.UNITS_USEC?"Microseconds":e===Et.UNITS_HZ?"Hz":e===Et.UNITS_PPM?"PPM":e===Et.UNITS_RADS?"Rads":"Unknown"});He(this,"nifti_mat33_mul",function(e,n){var r=[[0,0,0],[0,0,0],[0,0,0]],i,a;for(i=0;i<3;i+=1)for(a=0;a<3;a+=1)r[i][a]=e[i][0]*n[0][a]+e[i][1]*n[1][a]+e[i][2]*n[2][a];return r});He(this,"nifti_mat33_determ",function(e){var n,r,i,a,o,s,l,c,d;return n=e[0][0],r=e[0][1],i=e[0][2],a=e[1][0],o=e[1][1],s=e[1][2],l=e[2][0],c=e[2][1],d=e[2][2],n*o*d-n*c*s-a*r*d+a*c*i+l*r*s-l*o*i})}readHeader(e){var n=new DataView(e),r=gn.Utils.getIntAt(n,0,this.littleEndian),i,a,o,s;if(r!==Et.MAGIC_COOKIE&&(this.littleEndian=!0,r=gn.Utils.getIntAt(n,0,this.littleEndian)),r!==Et.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=gn.Utils.getByteAt(n,39),i=0;i<8;i+=1)s=40+i*2,this.dims[i]=gn.Utils.getShortAt(n,s,this.littleEndian);for(this.intent_p1=gn.Utils.getFloatAt(n,56,this.littleEndian),this.intent_p2=gn.Utils.getFloatAt(n,60,this.littleEndian),this.intent_p3=gn.Utils.getFloatAt(n,64,this.littleEndian),this.intent_code=gn.Utils.getShortAt(n,68,this.littleEndian),this.datatypeCode=gn.Utils.getShortAt(n,70,this.littleEndian),this.numBitsPerVoxel=gn.Utils.getShortAt(n,72,this.littleEndian),this.slice_start=gn.Utils.getShortAt(n,74,this.littleEndian),i=0;i<8;i+=1)s=76+i*4,this.pixDims[i]=gn.Utils.getFloatAt(n,s,this.littleEndian);if(this.vox_offset=gn.Utils.getFloatAt(n,108,this.littleEndian),this.scl_slope=gn.Utils.getFloatAt(n,112,this.littleEndian),this.scl_inter=gn.Utils.getFloatAt(n,116,this.littleEndian),this.slice_end=gn.Utils.getShortAt(n,120,this.littleEndian),this.slice_code=gn.Utils.getByteAt(n,122),this.xyzt_units=gn.Utils.getByteAt(n,123),this.cal_max=gn.Utils.getFloatAt(n,124,this.littleEndian),this.cal_min=gn.Utils.getFloatAt(n,128,this.littleEndian),this.slice_duration=gn.Utils.getFloatAt(n,132,this.littleEndian),this.toffset=gn.Utils.getFloatAt(n,136,this.littleEndian),this.description=gn.Utils.getStringAt(n,148,228),this.aux_file=gn.Utils.getStringAt(n,228,252),this.qform_code=gn.Utils.getShortAt(n,252,this.littleEndian),this.sform_code=gn.Utils.getShortAt(n,254,this.littleEndian),this.quatern_b=gn.Utils.getFloatAt(n,256,this.littleEndian),this.quatern_c=gn.Utils.getFloatAt(n,260,this.littleEndian),this.quatern_d=gn.Utils.getFloatAt(n,264,this.littleEndian),this.quatern_a=Math.sqrt(1-(Math.pow(this.quatern_b,2)+Math.pow(this.quatern_c,2)+Math.pow(this.quatern_d,2))),this.qoffset_x=gn.Utils.getFloatAt(n,268,this.littleEndian),this.qoffset_y=gn.Utils.getFloatAt(n,272,this.littleEndian),this.qoffset_z=gn.Utils.getFloatAt(n,276,this.littleEndian),this.qform_code<1&&this.sform_code<1&&(this.affine[0][0]=this.pixDims[1],this.affine[1][1]=this.pixDims[2],this.affine[2][2]=this.pixDims[3]),this.qform_code>0&&this.sform_code<this.qform_code){const l=this.quatern_a,c=this.quatern_b,d=this.quatern_c,f=this.quatern_d;for(this.qfac=this.pixDims[0]===0?1:this.pixDims[0],this.quatern_R=[[l*l+c*c-d*d-f*f,2*c*d-2*l*f,2*c*f+2*l*d],[2*c*d+2*l*f,l*l+d*d-c*c-f*f,2*d*f-2*l*c],[2*c*f-2*l*d,2*d*f+2*l*c,l*l+f*f-d*d-c*c]],a=0;a<3;a+=1)for(o=0;o<3;o+=1)this.affine[a][o]=this.quatern_R[a][o]*this.pixDims[o+1],o===2&&(this.affine[a][o]*=this.qfac);this.affine[0][3]=this.qoffset_x,this.affine[1][3]=this.qoffset_y,this.affine[2][3]=this.qoffset_z}else if(this.sform_code>0)for(a=0;a<3;a+=1)for(o=0;o<4;o+=1)s=280+(a*4+o)*4,this.affine[a][o]=gn.Utils.getFloatAt(n,s,this.littleEndian);if(this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=gn.Utils.getStringAt(n,328,344),this.magic=gn.Utils.getStringAt(n,344,348),this.isHDR=this.magic===String.fromCharCode.apply(null,Et.MAGIC_NUMBER2),n.byteLength>Et.MAGIC_COOKIE){this.extensionFlag[0]=gn.Utils.getByteAt(n,348),this.extensionFlag[1]=gn.Utils.getByteAt(n,349),this.extensionFlag[2]=gn.Utils.getByteAt(n,350),this.extensionFlag[3]=gn.Utils.getByteAt(n,351);let l=!0;!this.isHDR&&this.vox_offset<=352&&(l=!1),n.byteLength<=368&&(l=!1),l&&this.extensionFlag[0]&&(this.extensions=gn.Utils.getExtensionsAt(n,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode)}}toFormattedString(){var e=gn.Utils.formatNumber,n="";return n+="Dim Info = "+this.dim_info+`
`,n+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,n+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,n+="Intent Code = "+this.intent_code+`
`,n+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,n+="Bits Per Voxel = "+this.numBitsPerVoxel+`
`,n+="Slice Start = "+this.slice_start+`
`,n+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+`
`,n+="Image Offset = "+this.vox_offset+`
`,n+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+`
`,n+="Slice End = "+this.slice_end+`
`,n+="Slice Code = "+this.slice_code+`
`,n+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(Et.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(Et.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,n+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+`
`,n+="Slice Duration = "+this.slice_duration+`
`,n+="Time Axis Shift = "+this.toffset+`
`,n+='Description: "'+this.description+`"
`,n+='Auxiliary File: "'+this.aux_file+`"
`,n+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,n+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,n+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+`
`,n+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,n+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+`
`,n+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+`
`,n+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+`
`,n+='Intent Name: "'+this.intent_name+`"
`,this.extensionFlag[0]&&(n+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+`
`),n}getQformMat(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])}convertNiftiQFormToNiftiSForm(e,n,r,i,a,o,s,l,c,d){var f=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],h,p=e,C=n,x=r,T,_,y;return f[3][0]=f[3][1]=f[3][2]=0,f[3][3]=1,h=1-(p*p+C*C+x*x),h<1e-7?(h=1/Math.sqrt(p*p+C*C+x*x),p*=h,C*=h,x*=h,h=0):h=Math.sqrt(h),T=s>0?s:1,_=l>0?l:1,y=c>0?c:1,d<0&&(y=-y),f[0][0]=(h*h+p*p-C*C-x*x)*T,f[0][1]=2*(p*C-h*x)*_,f[0][2]=2*(p*x+h*C)*y,f[1][0]=2*(p*C+h*x)*T,f[1][1]=(h*h+C*C-p*p-x*x)*_,f[1][2]=2*(C*x-h*p)*y,f[2][0]=2*(p*x-h*C)*T,f[2][1]=2*(C*x+h*p)*_,f[2][2]=(h*h+x*x-C*C-p*p)*y,f[0][3]=i,f[1][3]=a,f[2][3]=o,f}convertNiftiSFormToNEMA(e){var n,r,i,a,o,s,l,c,d,f,h,p,C,x,T,_,y,w,b,M,I,A,k,U,B,z,K,J,X,re,fe,pe,ie,te;if(T=0,K=[[0,0,0],[0,0,0],[0,0,0]],J=[[0,0,0],[0,0,0],[0,0,0]],n=e[0][0],r=e[0][1],i=e[0][2],a=e[1][0],o=e[1][1],s=e[1][2],l=e[2][0],c=e[2][1],d=e[2][2],f=Math.sqrt(n*n+a*a+l*l),f===0||(n/=f,a/=f,l/=f,f=Math.sqrt(r*r+o*o+c*c),f===0))return null;if(r/=f,o/=f,c/=f,f=n*r+a*o+l*c,Math.abs(f)>1e-4){if(r-=f*n,o-=f*a,c-=f*l,f=Math.sqrt(r*r+o*o+c*c),f===0)return null;r/=f,o/=f,c/=f}if(f=Math.sqrt(i*i+s*s+d*d),f===0?(i=a*c-l*o,s=l*r-c*n,d=n*o-a*r):(i/=f,s/=f,d/=f),f=n*i+a*s+l*d,Math.abs(f)>1e-4){if(i-=f*n,s-=f*a,d-=f*l,f=Math.sqrt(i*i+s*s+d*d),f===0)return null;i/=f,s/=f,d/=f}if(f=r*i+o*s+c*d,Math.abs(f)>1e-4){if(i-=f*r,s-=f*o,d-=f*c,f=Math.sqrt(i*i+s*s+d*d),f===0)return null;i/=f,s/=f,d/=f}if(K[0][0]=n,K[0][1]=r,K[0][2]=i,K[1][0]=a,K[1][1]=o,K[1][2]=s,K[2][0]=l,K[2][1]=c,K[2][2]=d,h=this.nifti_mat33_determ(K),h===0)return null;for(z=-666,b=A=k=U=1,M=2,I=3,C=1;C<=3;C+=1)for(x=1;x<=3;x+=1)if(C!==x){for(T=1;T<=3;T+=1)if(!(C===T||x===T))for(J[0][0]=J[0][1]=J[0][2]=J[1][0]=J[1][1]=J[1][2]=J[2][0]=J[2][1]=J[2][2]=0,_=-1;_<=1;_+=2)for(y=-1;y<=1;y+=2)for(w=-1;w<=1;w+=2)J[0][C-1]=_,J[1][x-1]=y,J[2][T-1]=w,p=this.nifti_mat33_determ(J),p*h>0&&(B=this.nifti_mat33_mul(J,K),f=B[0][0]+B[1][1]+B[2][2],f>z&&(z=f,b=C,M=x,I=T,A=_,k=y,U=w))}switch(X=re=fe=pe=ie=te="",b*A){case 1:X="X",pe="+";break;case-1:X="X",pe="-";break;case 2:X="Y",pe="+";break;case-2:X="Y",pe="-";break;case 3:X="Z",pe="+";break;case-3:X="Z",pe="-";break}switch(M*k){case 1:re="X",ie="+";break;case-1:re="X",ie="-";break;case 2:re="Y",ie="+";break;case-2:re="Y",ie="-";break;case 3:re="Z",ie="+";break;case-3:re="Z",ie="-";break}switch(I*U){case 1:fe="X",te="+";break;case-1:fe="X",te="-";break;case 2:fe="Y",te="+";break;case-2:fe="Y",te="-";break;case 3:fe="Z",te="+";break;case-3:fe="Z",te="-";break}return X+re+fe+pe+ie+te}getExtensionLocation(){return Et.MAGIC_COOKIE+4}getExtensionSize(e){return gn.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)}getExtensionCode(e){return gn.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)}addExtension(e,n=-1){n==-1?this.extensions.push(e):this.extensions.splice(n,0,e),this.vox_offset+=e.esize}removeExtension(e){let n=this.extensions[e];n&&(this.vox_offset-=n.esize),this.extensions.splice(e,1)}toArrayBuffer(e=!1){let i=352;if(e)for(let l of this.extensions)i+=l.esize;let a=new Uint8Array(i),o=new DataView(a.buffer);o.setInt32(0,348,this.littleEndian),o.setUint8(39,this.dim_info);for(let l=0;l<8;l++)o.setUint16(40+2*l,this.dims[l],this.littleEndian);o.setFloat32(56,this.intent_p1,this.littleEndian),o.setFloat32(60,this.intent_p2,this.littleEndian),o.setFloat32(64,this.intent_p3,this.littleEndian),o.setInt16(68,this.intent_code,this.littleEndian),o.setInt16(70,this.datatypeCode,this.littleEndian),o.setInt16(72,this.numBitsPerVoxel,this.littleEndian),o.setInt16(74,this.slice_start,this.littleEndian);for(let l=0;l<8;l++)o.setFloat32(76+4*l,this.pixDims[l],this.littleEndian);o.setFloat32(108,this.vox_offset,this.littleEndian),o.setFloat32(112,this.scl_slope,this.littleEndian),o.setFloat32(116,this.scl_inter,this.littleEndian),o.setInt16(120,this.slice_end,this.littleEndian),o.setUint8(122,this.slice_code),o.setUint8(123,this.xyzt_units),o.setFloat32(124,this.cal_max,this.littleEndian),o.setFloat32(128,this.cal_min,this.littleEndian),o.setFloat32(132,this.slice_duration,this.littleEndian),o.setFloat32(136,this.toffset,this.littleEndian),a.set(Buffer.from(this.description),148),a.set(Buffer.from(this.aux_file),228),o.setInt16(252,this.qform_code,this.littleEndian),o.setInt16(254,this.sform_code,this.littleEndian),o.setFloat32(256,this.quatern_b,this.littleEndian),o.setFloat32(260,this.quatern_c,this.littleEndian),o.setFloat32(264,this.quatern_d,this.littleEndian),o.setFloat32(268,this.qoffset_x,this.littleEndian),o.setFloat32(272,this.qoffset_y,this.littleEndian),o.setFloat32(276,this.qoffset_z,this.littleEndian);const s=this.affine.flat();for(let l=0;l<12;l++)o.setFloat32(280+4*l,s[l],this.littleEndian);if(a.set(Buffer.from(this.intent_name),328),a.set(Buffer.from(this.magic),344),e){a.set(Uint8Array.from([1,0,0,0]),348);let l=this.getExtensionLocation();for(const c of this.extensions)o.setInt32(l,c.esize,c.littleEndian),o.setInt32(l+4,c.ecode,c.littleEndian),a.set(new Uint8Array(c.edata),l+8),l+=c.esize}else a.set(new Uint8Array(4).fill(0),348);return a.buffer}};He(Et,"TYPE_NONE",0),He(Et,"TYPE_BINARY",1),He(Et,"TYPE_UINT8",2),He(Et,"TYPE_INT16",4),He(Et,"TYPE_INT32",8),He(Et,"TYPE_FLOAT32",16),He(Et,"TYPE_COMPLEX64",32),He(Et,"TYPE_FLOAT64",64),He(Et,"TYPE_RGB24",128),He(Et,"TYPE_INT8",256),He(Et,"TYPE_UINT16",512),He(Et,"TYPE_UINT32",768),He(Et,"TYPE_INT64",1024),He(Et,"TYPE_UINT64",1280),He(Et,"TYPE_FLOAT128",1536),He(Et,"TYPE_COMPLEX128",1792),He(Et,"TYPE_COMPLEX256",2048),He(Et,"XFORM_UNKNOWN",0),He(Et,"XFORM_SCANNER_ANAT",1),He(Et,"XFORM_ALIGNED_ANAT",2),He(Et,"XFORM_TALAIRACH",3),He(Et,"XFORM_MNI_152",4),He(Et,"SPATIAL_UNITS_MASK",7),He(Et,"TEMPORAL_UNITS_MASK",56),He(Et,"UNITS_UNKNOWN",0),He(Et,"UNITS_METER",1),He(Et,"UNITS_MM",2),He(Et,"UNITS_MICRON",3),He(Et,"UNITS_SEC",8),He(Et,"UNITS_MSEC",16),He(Et,"UNITS_USEC",24),He(Et,"UNITS_HZ",32),He(Et,"UNITS_PPM",40),He(Et,"UNITS_RADS",48),He(Et,"MAGIC_COOKIE",348),He(Et,"STANDARD_HEADER_SIZE",348),He(Et,"MAGIC_NUMBER_LOCATION",344),He(Et,"MAGIC_NUMBER",[110,43,49]),He(Et,"MAGIC_NUMBER2",[110,105,49]),He(Et,"EXTENSION_HEADER_SIZE",8);let eS=Et;jf.NIFTI1=eS;var ep={};Object.defineProperty(ep,"__esModule",{value:!0});ep.NIFTI2=void 0;const fa=jf,xn=Uu,as=class as{constructor(){He(this,"littleEndian",!1);He(this,"dim_info",0);He(this,"dims",[]);He(this,"intent_p1",0);He(this,"intent_p2",0);He(this,"intent_p3",0);He(this,"intent_code",0);He(this,"datatypeCode",0);He(this,"numBitsPerVoxel",0);He(this,"slice_start",0);He(this,"slice_end",0);He(this,"slice_code",0);He(this,"pixDims",[]);He(this,"vox_offset",0);He(this,"scl_slope",1);He(this,"scl_inter",0);He(this,"xyzt_units",0);He(this,"cal_max",0);He(this,"cal_min",0);He(this,"slice_duration",0);He(this,"toffset",0);He(this,"description","");He(this,"aux_file","");He(this,"intent_name","");He(this,"qform_code",0);He(this,"sform_code",0);He(this,"quatern_b",0);He(this,"quatern_c",0);He(this,"quatern_d",0);He(this,"qoffset_x",0);He(this,"qoffset_y",0);He(this,"qoffset_z",0);He(this,"affine",[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]);He(this,"magic","0");He(this,"extensionFlag",[0,0,0,0]);He(this,"extensions",[]);He(this,"extensionSize",0);He(this,"extensionCode",0);He(this,"getExtensionLocation",function(){return as.MAGIC_COOKIE+4});He(this,"getExtensionSize",fa.NIFTI1.prototype.getExtensionSize);He(this,"getExtensionCode",fa.NIFTI1.prototype.getExtensionCode);He(this,"addExtension",fa.NIFTI1.prototype.addExtension);He(this,"removeExtension",fa.NIFTI1.prototype.removeExtension);He(this,"getDatatypeCodeString",fa.NIFTI1.prototype.getDatatypeCodeString);He(this,"getTransformCodeString",fa.NIFTI1.prototype.getTransformCodeString);He(this,"getUnitsCodeString",fa.NIFTI1.prototype.getUnitsCodeString);He(this,"getQformMat",fa.NIFTI1.prototype.getQformMat);He(this,"convertNiftiQFormToNiftiSForm",fa.NIFTI1.prototype.convertNiftiQFormToNiftiSForm);He(this,"convertNiftiSFormToNEMA",fa.NIFTI1.prototype.convertNiftiSFormToNEMA);He(this,"nifti_mat33_mul",fa.NIFTI1.prototype.nifti_mat33_mul);He(this,"nifti_mat33_determ",fa.NIFTI1.prototype.nifti_mat33_determ)}readHeader(e){var n=new DataView(e),r=xn.Utils.getIntAt(n,0,this.littleEndian),i,a,o,s;if(r!==as.MAGIC_COOKIE&&(this.littleEndian=!0,r=xn.Utils.getIntAt(n,0,this.littleEndian)),r!==as.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.magic=xn.Utils.getStringAt(n,4,12),this.datatypeCode=xn.Utils.getShortAt(n,12,this.littleEndian),this.numBitsPerVoxel=xn.Utils.getShortAt(n,14,this.littleEndian),i=0;i<8;i+=1)s=16+i*8,this.dims[i]=xn.Utils.getLongAt(n,s,this.littleEndian);for(this.intent_p1=xn.Utils.getDoubleAt(n,80,this.littleEndian),this.intent_p2=xn.Utils.getDoubleAt(n,88,this.littleEndian),this.intent_p3=xn.Utils.getDoubleAt(n,96,this.littleEndian),i=0;i<8;i+=1)s=104+i*8,this.pixDims[i]=xn.Utils.getDoubleAt(n,s,this.littleEndian);for(this.vox_offset=xn.Utils.getLongAt(n,168,this.littleEndian),this.scl_slope=xn.Utils.getDoubleAt(n,176,this.littleEndian),this.scl_inter=xn.Utils.getDoubleAt(n,184,this.littleEndian),this.cal_max=xn.Utils.getDoubleAt(n,192,this.littleEndian),this.cal_min=xn.Utils.getDoubleAt(n,200,this.littleEndian),this.slice_duration=xn.Utils.getDoubleAt(n,208,this.littleEndian),this.toffset=xn.Utils.getDoubleAt(n,216,this.littleEndian),this.slice_start=xn.Utils.getLongAt(n,224,this.littleEndian),this.slice_end=xn.Utils.getLongAt(n,232,this.littleEndian),this.description=xn.Utils.getStringAt(n,240,320),this.aux_file=xn.Utils.getStringAt(n,320,344),this.qform_code=xn.Utils.getIntAt(n,344,this.littleEndian),this.sform_code=xn.Utils.getIntAt(n,348,this.littleEndian),this.quatern_b=xn.Utils.getDoubleAt(n,352,this.littleEndian),this.quatern_c=xn.Utils.getDoubleAt(n,360,this.littleEndian),this.quatern_d=xn.Utils.getDoubleAt(n,368,this.littleEndian),this.qoffset_x=xn.Utils.getDoubleAt(n,376,this.littleEndian),this.qoffset_y=xn.Utils.getDoubleAt(n,384,this.littleEndian),this.qoffset_z=xn.Utils.getDoubleAt(n,392,this.littleEndian),a=0;a<3;a+=1)for(o=0;o<4;o+=1)s=400+(a*4+o)*8,this.affine[a][o]=xn.Utils.getDoubleAt(n,s,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=xn.Utils.getIntAt(n,496,this.littleEndian),this.xyzt_units=xn.Utils.getIntAt(n,500,this.littleEndian),this.intent_code=xn.Utils.getIntAt(n,504,this.littleEndian),this.intent_name=xn.Utils.getStringAt(n,508,524),this.dim_info=xn.Utils.getByteAt(n,524),n.byteLength>as.MAGIC_COOKIE&&(this.extensionFlag[0]=xn.Utils.getByteAt(n,540),this.extensionFlag[1]=xn.Utils.getByteAt(n,541),this.extensionFlag[2]=xn.Utils.getByteAt(n,542),this.extensionFlag[3]=xn.Utils.getByteAt(n,543),this.extensionFlag[0]&&(this.extensions=xn.Utils.getExtensionsAt(n,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode))}toFormattedString(){var e=xn.Utils.formatNumber,n="";return n+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,n+="Bits Per Voxel =  = "+this.numBitsPerVoxel+`
`,n+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,n+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,n+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+`
`,n+="Image Offset = "+this.vox_offset+`
`,n+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+`
`,n+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+`
`,n+="Slice Duration = "+this.slice_duration+`
`,n+="Time Axis Shift = "+this.toffset+`
`,n+="Slice Start = "+this.slice_start+`
`,n+="Slice End = "+this.slice_end+`
`,n+='Description: "'+this.description+`"
`,n+='Auxiliary File: "'+this.aux_file+`"
`,n+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,n+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,n+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+`
`,n+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,n+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+`
`,n+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+`
`,n+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+`
`,n+="Slice Code = "+this.slice_code+`
`,n+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(fa.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(fa.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,n+="Intent Code = "+this.intent_code+`
`,n+='Intent Name: "'+this.intent_name+`"
`,n+="Dim Info = "+this.dim_info+`
`,n}toArrayBuffer(e=!1){let i=544;if(e)for(let l of this.extensions)i+=l.esize;let a=new Uint8Array(i),o=new DataView(a.buffer);o.setInt32(0,540,this.littleEndian),a.set(Buffer.from(this.magic),4),o.setInt16(12,this.datatypeCode,this.littleEndian),o.setInt16(14,this.numBitsPerVoxel,this.littleEndian);for(let l=0;l<8;l++)o.setBigInt64(16+8*l,BigInt(this.dims[l]),this.littleEndian);o.setFloat64(80,this.intent_p1,this.littleEndian),o.setFloat64(88,this.intent_p2,this.littleEndian),o.setFloat64(96,this.intent_p3,this.littleEndian);for(let l=0;l<8;l++)o.setFloat64(104+8*l,this.pixDims[l],this.littleEndian);o.setBigInt64(168,BigInt(this.vox_offset),this.littleEndian),o.setFloat64(176,this.scl_slope,this.littleEndian),o.setFloat64(184,this.scl_inter,this.littleEndian),o.setFloat64(192,this.cal_max,this.littleEndian),o.setFloat64(200,this.cal_min,this.littleEndian),o.setFloat64(208,this.slice_duration,this.littleEndian),o.setFloat64(216,this.toffset,this.littleEndian),o.setBigInt64(224,BigInt(this.slice_start),this.littleEndian),o.setBigInt64(232,BigInt(this.slice_end),this.littleEndian),a.set(Buffer.from(this.description),240),a.set(Buffer.from(this.aux_file),320),o.setInt32(344,this.qform_code,this.littleEndian),o.setInt32(348,this.sform_code,this.littleEndian),o.setFloat64(352,this.quatern_b,this.littleEndian),o.setFloat64(360,this.quatern_c,this.littleEndian),o.setFloat64(368,this.quatern_d,this.littleEndian),o.setFloat64(376,this.qoffset_x,this.littleEndian),o.setFloat64(384,this.qoffset_y,this.littleEndian),o.setFloat64(392,this.qoffset_z,this.littleEndian);const s=this.affine.flat();for(let l=0;l<12;l++)o.setFloat64(400+8*l,s[l],this.littleEndian);if(o.setInt32(496,this.slice_code,this.littleEndian),o.setInt32(500,this.xyzt_units,this.littleEndian),o.setInt32(504,this.intent_code,this.littleEndian),a.set(Buffer.from(this.intent_name),508),o.setUint8(524,this.dim_info),e){a.set(Uint8Array.from([1,0,0,0]),540);let l=this.getExtensionLocation();for(const c of this.extensions)o.setInt32(l,c.esize,c.littleEndian),o.setInt32(l+4,c.ecode,c.littleEndian),a.set(new Uint8Array(c.edata),l+8),l+=c.esize}else a.set(new Uint8Array(4).fill(0),540);return a.buffer}};He(as,"MAGIC_COOKIE",540),He(as,"MAGIC_NUMBER_LOCATION",4),He(as,"MAGIC_NUMBER",[110,43,50,0,13,10,26,10]),He(as,"MAGIC_NUMBER2",[110,105,50,0,13,10,26,10]);let tS=as;ep.NIFTI2=tS;(function(t){var e=Or&&Or.__createBinding||(Object.create?function(I,A,k,U){U===void 0&&(U=k);var B=Object.getOwnPropertyDescriptor(A,k);(!B||("get"in B?!A.__esModule:B.writable||B.configurable))&&(B={enumerable:!0,get:function(){return A[k]}}),Object.defineProperty(I,U,B)}:function(I,A,k,U){U===void 0&&(U=k),I[U]=A[k]}),n=Or&&Or.__setModuleDefault||(Object.create?function(I,A){Object.defineProperty(I,"default",{enumerable:!0,value:A})}:function(I,A){I.default=A}),r=Or&&Or.__importStar||function(I){if(I&&I.__esModule)return I;var A={};if(I!=null)for(var k in I)k!=="default"&&Object.prototype.hasOwnProperty.call(I,k)&&e(A,I,k);return n(A,I),A};Object.defineProperty(t,"__esModule",{value:!0}),t.readExtensionData=t.readExtension=t.readImage=t.hasExtension=t.readHeader=t.decompress=t.isCompressed=t.isNIFTI=t.isNIFTI2=t.isNIFTI1=t.NIFTIEXTENSION=t.Utils=t.NIFTI2=t.NIFTI1=void 0;const i=r(X3e),a=jf,o=ep,s=Uu;var l=jf;Object.defineProperty(t,"NIFTI1",{enumerable:!0,get:function(){return l.NIFTI1}});var c=ep;Object.defineProperty(t,"NIFTI2",{enumerable:!0,get:function(){return c.NIFTI2}});var d=Uu;Object.defineProperty(t,"Utils",{enumerable:!0,get:function(){return d.Utils}});var f=_p;Object.defineProperty(t,"NIFTIEXTENSION",{enumerable:!0,get:function(){return f.NIFTIEXTENSION}});function h(I,A=!1){var k,U,B,z;return I.byteLength<a.NIFTI1.STANDARD_HEADER_SIZE?!1:(k=new DataView(I),k&&(U=k.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION)),B=k.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION+1),z=k.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION+2),A&&U===a.NIFTI1.MAGIC_NUMBER2[0]&&B===a.NIFTI1.MAGIC_NUMBER2[1]&&z===a.NIFTI1.MAGIC_NUMBER2[2]?!0:U===a.NIFTI1.MAGIC_NUMBER[0]&&B===a.NIFTI1.MAGIC_NUMBER[1]&&z===a.NIFTI1.MAGIC_NUMBER[2])}t.isNIFTI1=h;function p(I,A=!1){var k,U,B,z;return I.byteLength<a.NIFTI1.STANDARD_HEADER_SIZE?!1:(k=new DataView(I),U=k.getUint8(o.NIFTI2.MAGIC_NUMBER_LOCATION),B=k.getUint8(o.NIFTI2.MAGIC_NUMBER_LOCATION+1),z=k.getUint8(o.NIFTI2.MAGIC_NUMBER_LOCATION+2),A&&U===o.NIFTI2.MAGIC_NUMBER2[0]&&B===o.NIFTI2.MAGIC_NUMBER2[1]&&z===o.NIFTI2.MAGIC_NUMBER2[2]?!0:U===o.NIFTI2.MAGIC_NUMBER[0]&&B===o.NIFTI2.MAGIC_NUMBER[1]&&z===o.NIFTI2.MAGIC_NUMBER[2])}t.isNIFTI2=p;function C(I,A=!1){return h(I,A)||p(I,A)}t.isNIFTI=C;function x(I){var A,k,U;return!!(I&&(A=new DataView(I),k=A.getUint8(0),U=A.getUint8(1),k===s.Utils.GUNZIP_MAGIC_COOKIE1||U===s.Utils.GUNZIP_MAGIC_COOKIE2))}t.isCompressed=x;function T(I){return i.decompressSync(new Uint8Array(I)).buffer}t.decompress=T;function _(I,A=!1){var k=null;return x(I)&&(I=T(I)),h(I,A)?k=new a.NIFTI1:p(I,A)&&(k=new o.NIFTI2),k?k.readHeader(I):console.error("That file does not appear to be NIFTI!"),k}t.readHeader=_;function y(I){return I.extensionFlag[0]!=0}t.hasExtension=y;function w(I,A){var k=I.vox_offset,U=1,B=1;I.dims[4]&&(U=I.dims[4]),I.dims[5]&&(B=I.dims[5]);var z=I.dims[1]*I.dims[2]*I.dims[3]*U*B*(I.numBitsPerVoxel/8);return A.slice(k,k+z)}t.readImage=w;function b(I,A){var k=I.getExtensionLocation(),U=I.extensionSize;return A.slice(k,k+U)}t.readExtension=b;function M(I,A){var k=I.getExtensionLocation(),U=I.extensionSize;return A.slice(k+8,k+U)}t.readExtensionData=M})(j0);class Z3e extends pp{constructor(e,n){super(e),this.cancelLoading=()=>{const{loadStatus:r}=this;!r||!r.loading||(r.loading=!1,this.clearLoadCallbacks(),this.controller.abort())},this.load=(r,i=5)=>{},this.loadStatus=n.loadStatus,this.controller=n.controller}clearLoadCallbacks(){this.loadStatus.callbacks=[]}decache(){bt.removeVolumeLoadObject(this.volumeId)}}function Q3e(t){const e=[t[0][3],t[1][3],t[2][3]],n=[Math.sqrt(t[0][0]**2+t[1][0]**2+t[2][0]**2),Math.sqrt(t[0][1]**2+t[1][1]**2+t[2][1]**2),Math.sqrt(t[0][2]**2+t[1][2]**2+t[2][2]**2)],r=[t[0][0]/n[0],t[0][1]/n[1],t[0][2]/n[2],t[1][0]/n[0],t[1][1]/n[1],t[1][2]/n[2],t[2][0]/n[0],t[2][1]/n[1],t[2][2]/n[2]];return{origin:e,orientation:r,spacing:n}}function ewe(t){const{affine:e}=t,{orientation:n,origin:r,spacing:i}=Q3e(e),a=[-r[0],-r[1],r[2]],o=[-n[0],-n[3],n[6],-n[1],-n[4],n[7],-n[2],-n[5],n[8]];return{origin:a,orientation:o,spacing:i}}var W2;(function(t){t.NIFTI_VOLUME_LOADED="CORNERSTONE_NIFTI_VOLUME_LOADED",t.NIFTI_VOLUME_PROGRESS="CORNERSTONE_NIFTI_VOLUME_PROGRESS"})(W2||(W2={}));const twe="nifti",UM=new Map;function nwe(t,e,n,r){return new Promise((i,a)=>{const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer";const s=function(c){r&&typeof r=="function"&&r(),n&&n.removeEventListener("abort",l),i(o.response)},l=()=>{o.abort(),o.removeEventListener("load",s),a(new Error("Request aborted"))};o.addEventListener("load",s),e&&typeof e=="function"&&(o.onprogress=function(c){e(c.loaded,c.total)}),n&&n.aborted?(o.abort(),a(new Error("Request aborted"))):n&&n.addEventListener("abort",l),o.send()})}async function rwe(t){const e=t.substring(twe.length+1),n=(_,y)=>{const w={volumeId:t,loaded:_,total:y};Kt(Hn,W2.NIFTI_VOLUME_PROGRESS,{data:w})},r=()=>{const _={volumeId:t};Kt(Hn,W2.NIFTI_VOLUME_LOADED,{data:_})},i=new AbortController,a=i.signal;UM.set(e,{controller:i,loading:!0});let o=await nwe(e,n,a,r);UM.delete(e);let s=null,l=null;j0.isCompressed(o)&&(o=j0.decompress(o)),j0.isNIFTI(o)&&(s=j0.readHeader(o),l=j0.readImage(s,o));const{scalarData:c,pixelRepresentation:d}=K3e(s,l),{orientation:f,origin:h,spacing:p}=ewe(s),{volumeMetadata:C,dimensions:x,direction:T}=P3e(s,f,c,d);return new Z3e({volumeId:t,metadata:C,dimensions:x,spacing:p,origin:h,direction:T,scalarData:c,sizeInBytes:c.byteLength,imageIds:[]},{loadStatus:{loaded:!1,loading:!1,callbacks:[]},controller:i})}function iwe(t){return{promise:rwe(t),cancel:()=>{}}}const awe=[230,25,75,255],owe=[0,130,200,255],swe=[128,0,0,255],lwe=[170,110,40,255],cwe=[128,128,0,255],uwe=[0,128,128,255],fwe=[145,30,180,255],dwe=[240,50,230,255],hwe=[240,50,230,255],BM=[awe,owe,swe,lwe,cwe,uwe,fwe,dwe,hwe],j2="myToolGroup",GM="3DToolGroup",Su="myRenderingEngine",gwe={fillAlpha:.5,fillAlphaInactive:.5,outlineOpacity:0,outlineOpacityInactive:0,outlineWidth:0,outlineWidthInactive:0},pwe={renderInactiveSegmentations:!0,representations:{[Xn.Enums.SegmentationRepresentations.Labelmap]:gwe}};async function mwe(t,e,n,r,i,a){Xn.init(),await _k(),t.current.oncontextmenu=f=>f.preventDefault(),e.current.oncontextmenu=f=>f.preventDefault(),n.current.oncontextmenu=f=>f.preventDefault(),r.current.oncontextmenu=f=>f.preventDefault(),wwe();const[o,s]=Cwe();o.addTool(Xn.StackScrollMouseWheelTool.toolName),o.addTool(Xn.SegmentationDisplayTool.toolName),o.setToolActive(Xn.StackScrollMouseWheelTool.toolName),o.setToolEnabled(Xn.SegmentationDisplayTool.toolName),s.addTool(Xn.TrackballRotateTool.toolName),s.addTool(Xn.StackScrollMouseWheelTool.toolName),s.setToolActive(Xn.TrackballRotateTool.toolName,{bindings:[{mouseButton:Xn.Enums.MouseBindings.Primary}]}),o.setToolActive(Xn.StackScrollMouseWheelTool.toolName),ZU("nifti",iwe);let l=mc(Su);l?(l.destroy(),l=new _2(Su)):l=new _2(Su);const c="nifti:"+i;return await vwe(c,l,o,s,t,e,n,r),await ywe(a)}async function vwe(t,e,n,r,i,a,o,s){await ky(t);const l="CT_NIFTI_AXIAL",c="CT_NIFTI_SAGITTAL",d="CT_NIFTI_CORONAL",f="CT_NIFTI_3DVOLUME",h=[l,c,d,f],p=[{viewportId:l,type:dr.ORTHOGRAPHIC,element:i.current,defaultOptions:{orientation:jl.AXIAL}},{viewportId:c,type:dr.ORTHOGRAPHIC,element:a.current,defaultOptions:{orientation:jl.SAGITTAL}},{viewportId:d,type:dr.ORTHOGRAPHIC,element:o.current,defaultOptions:{orientation:jl.CORONAL}},{viewportId:f,type:dr.VOLUME_3D,element:s.current,defaultOptions:{orientation:jl.SAGITTAL,background:[.2,0,.2]}}];e.setViewports(p),n.addViewport(l,Su),n.addViewport(c,Su),n.addViewport(d,Su),r.addViewport(f,Su),a8(e,[{volumeId:t}],h),e.render(),console.log("volume rendered")}async function ywe(t){const e=[],n=[],r=[];let i=0;t.forEach(o=>{Xn.segmentation.state.removeSegmentation(o.id);const s="nifti:"+o.url,l=ky(s);r.push(l),e.push({segmentationId:o.id,representation:{type:Xn.Enums.SegmentationRepresentations.Labelmap,data:{volumeId:s}}}),n.push({segmentationId:o.id,type:Xn.Enums.SegmentationRepresentations.Labelmap,options:{colorLUTOrIndex:[BM[i],BM[i]]}}),i++}),await Promise.all(r),Xn.segmentation.addSegmentations(e);const a=await Xn.segmentation.addSegmentationRepresentations(j2,n,pwe);return console.log("labelmaps rendered"),a}function wwe(){const t=Xn.state.tools;t.StackScrollMouseWheel||Xn.addTool(Xn.StackScrollMouseWheelTool),t.SegmentationDisplay||Xn.addTool(Xn.SegmentationDisplayTool),t.TrackballRotate||Xn.addTool(Xn.TrackballRotateTool)}function Cwe(){Xn.ToolGroupManager.destroyToolGroup(j2),Xn.ToolGroupManager.destroyToolGroup(GM);const t=Xn.ToolGroupManager.createToolGroup(j2),e=Xn.ToolGroupManager.createToolGroup(GM);return[t,e]}const xwe=async()=>{const t=sv()[0].viewport;t.getCamera(),t.getImageData();const e=sv()[1].viewport;e.getCamera(),e.getImageData();const n=sv()[2].viewport;n.getCamera(),n.getImageData(),console.log(Xn.state)};function Swe(t,e){let n=1;t.forEach(r=>{Xn.segmentation.config.visibility.setSegmentVisibility(j2,r,1,e[n]),n++})}function Ewe({niftiURL:t,maskData:e,setSegRepUIDs:n}){const r=vt.useRef(null),i=vt.useRef(null),a=vt.useRef(null),o=vt.useRef(null);return vt.useEffect(()=>{(async()=>{if(r&&i&&a){const s=await mwe(r,i,a,o,t,e);n(s)}})()},[]),yt.jsx("div",{className:"Visual",children:yt.jsxs("div",{className:"viewport",children:[yt.jsx("div",{className:"axial",ref:r}),yt.jsx("div",{className:"sagittal",ref:i}),yt.jsx("div",{className:"coronal",ref:a}),yt.jsx("div",{className:"3D",ref:o})]})})}function Qo({tissue:t,crossSectionArea:e,meanHU:n,isHeader:r}){const i=vt.useRef(),a=vt.useRef(),o=vt.useRef();return vt.useEffect(()=>{r===!0&&(i.current.style.fontFamily="AptosBold",a.current.style.fontFamily="AptosBold",o.current.style.fontFamily="AptosBold")}),yt.jsxs("div",{className:"ReportScreenItem",children:[yt.jsxs("div",{className:"tissue-column",ref:i,children:[" ",t," "]}),yt.jsxs("div",{className:"crossSectionArea-column",ref:a,children:[" ",e," "]}),yt.jsxs("div",{className:"meanHU-column",ref:o,children:[" ",n," "]})]})}function Twe(){return yt.jsxs("div",{className:"ReportScreen",children:[yt.jsx("div",{className:"header-line"}),yt.jsx(Qo,{tissue:"Tissue",crossSectionArea:"Cross-sectional Area",meanHU:"Mean HU",isHeader:!0}),yt.jsx("div",{className:"header-line"}),yt.jsxs("div",{className:"items",children:[yt.jsx(Qo,{tissue:"Aorta",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Gallbladder",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Kidney (L)",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Kidney (R)",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Liver",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Pancreas",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Postcava",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Spleen",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1}),yt.jsx(Qo,{tissue:"Stomach",crossSectionArea:"placeholder",meanHU:"placeholder",isHeader:!1})]}),yt.jsx("div",{className:"header-line"})]})}const _we=[{label:"All (Default)",id:0},{label:"Aorta",id:1},{label:"Gallbladder",id:2},{label:"Kidney (L)",id:3},{label:"Kideny (R)",id:4},{label:"Liver",id:5},{label:"Pancreas",id:6},{label:"Postcava",id:7},{label:"Spleen",id:8},{label:"Stomach",id:9}];function Dwe({itemData:t,checkStateProp:e,update:n}){const r=e[t.id];return yt.jsx(yt.Fragment,{children:yt.jsxs("div",{className:"item-label",children:[" ",t.label,yt.jsx("input",{className:"checkmark",type:"checkbox",checked:r,onChange:()=>n(t.id,!r)})]})})}function Dz({innerRef:t,checkState:e,update:n}){return yt.jsx("div",{className:"NestedCheckBox",style:{display:"block"},ref:t,children:_we.map(r=>yt.jsx(Dwe,{itemData:r,checkStateProp:e,update:n},r.id))})}const zM=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],bwe="[false,true,true,true,true,true,true,true,true,true]";function Iwe(){const[t,e]=vt.useState(null),[n,r]=vt.useState(null),[i,a]=vt.useState(zM),[o,s]=vt.useState(null);o&&i&&Swe(o,i);const l=vt.useRef(null),c=vt.useRef(null),d=vt.useRef(null),f=lA(),h=ZS();vt.useEffect(()=>{const T=h.state;if(!T){f("/");return}const _=URL.createObjectURL(T.file),y=[];Array.from(T.masks).forEach(w=>{y.push({id:w.name,url:URL.createObjectURL(w)})}),e(yt.jsx(Ewe,{niftiURL:_,maskData:y,setSegRepUIDs:s}))},[]),vt.useEffect(()=>{o&&r(yt.jsx(Dz,{innerRef:l,checkState:i,update:x}))},[o,i]);const p=()=>{l.current.style.display==="none"?l.current.style.display="block":l.current.style.display="none"},C=()=>{c.current.style.display==="none"?(c.current.style.display="block",d.current.style.opacity="25%"):(c.current.style.display="none",d.current.style.opacity="100%")},x=(T,_)=>{let y=[...i];y[T]=_,JSON.stringify(y)===bwe&&(y=zM),T!==0&&_===!1&&y[0]===!0&&(y[0]=!1),y=T===0?Array(10).fill(_):y,a(y)};return yt.jsxs("div",{className:"VisualizationPage",children:[yt.jsxs("div",{className:"sidebar",children:[yt.jsx("div",{className:"tasks-container",children:yt.jsxs("div",{className:"dropdown",children:[yt.jsx("div",{className:"dropdown-header",onClick:p,children:"Selected Task"}),n]})}),yt.jsx("div",{className:"report-container",children:yt.jsx("div",{className:"dropdown",children:yt.jsx("div",{className:"dropdown-header",onClick:C,children:"Report"})})}),yt.jsx("button",{onClick:()=>f("/"),children:"Back"}),yt.jsx("div",{children:yt.jsx("br",{})}),yt.jsx("button",{onClick:()=>xwe,children:"Debug"})]}),yt.jsx("div",{className:"visualization-container",ref:d,children:t}),yt.jsx("div",{className:"report",ref:c,style:{display:"none"},children:yt.jsx(Twe,{})})]})}const Owe="/assets/BodyMapsIcon-wk0KwT7L.png";function Mwe(){const[t,e]=vt.useState(),[n,r]=vt.useState(),i=lA(),a=s=>{const l=s.target.files[0];l&&e(l)},o=s=>{const l=Array.from(s.target.files);r(l)};return vt.useEffect(()=>{console.log(t),console.log(n),t&&n&&i("/visualization",{state:{file:t,masks:n}})}),yt.jsx("div",{className:"HomePage",children:yt.jsxs("div",{className:"container",children:[yt.jsx("div",{className:"header",children:"BodyMaps"}),yt.jsx("img",{className:"image",src:Owe,alt:"BodyMaps"}),yt.jsxs("div",{className:"input-container",children:[yt.jsxs("div",{className:"label-container",children:[yt.jsxs("div",{className:"input-label",children:["Drop ",yt.jsx("span",{style:{fontFamily:"AptosBold"},children:"NIFTI.nii.gz"})," here"]}),yt.jsx("div",{className:"input-label",children:"or Click to Upload"})]}),yt.jsx("input",{className:"fileInput",type:"file",onChange:a})]}),yt.jsxs("div",{className:"note",children:["By using this online service ",yt.jsx("br",{})," you agree that the data can be used to improve the model."]}),yt.jsx("br",{}),yt.jsx("div",{children:"Upload CT Masks Here: (Development Phase only)"})," ",yt.jsx("br",{}),yt.jsx("input",{type:"file",multiple:!0,onChange:o})]})})}function Nwe(){return yt.jsx(Dz,{})}function Rwe(){return yt.jsx("div",{className:"App",children:yt.jsx(bZ,{children:yt.jsxs(TZ,{children:[yt.jsx(Ym,{path:"/",element:yt.jsx(Mwe,{})}),yt.jsx(Ym,{path:"/visualization",element:yt.jsx(Iwe,{})}),yt.jsx(Ym,{path:"/test",element:yt.jsx(Nwe,{})})]})})})}Y4.createRoot(document.getElementById("root")).render(yt.jsx(Rwe,{}));
